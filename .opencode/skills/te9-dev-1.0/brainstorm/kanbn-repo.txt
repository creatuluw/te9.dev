Directory structure:
â””â”€â”€ kanbn-kan/
    â”œâ”€â”€ README.md
    â”œâ”€â”€ AGENTS.md
    â”œâ”€â”€ CHANGELOG.md
    â”œâ”€â”€ CONTRIBUTING.md
    â”œâ”€â”€ docker-compose.yml
    â”œâ”€â”€ LICENSE
    â”œâ”€â”€ package.json
    â”œâ”€â”€ pnpm-workspace.yaml
    â”œâ”€â”€ turbo.json
    â”œâ”€â”€ .dockerignore
    â”œâ”€â”€ .env.example
    â”œâ”€â”€ .npmrc
    â”œâ”€â”€ .nvmrc
    â”œâ”€â”€ apps/
    â”‚   â”œâ”€â”€ docs/
    â”‚   â”‚   â”œâ”€â”€ README.md
    â”‚   â”‚   â”œâ”€â”€ introduction.mdx
    â”‚   â”‚   â”œâ”€â”€ mint.json
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ api-reference/
    â”‚   â”‚   â”‚   â””â”€â”€ introduction.mdx
    â”‚   â”‚   â”œâ”€â”€ guides/
    â”‚   â”‚   â”‚   â””â”€â”€ self-hosting/
    â”‚   â”‚   â”‚       â”œâ”€â”€ introduction.mdx
    â”‚   â”‚   â”‚       â””â”€â”€ s3.mdx
    â”‚   â”‚   â””â”€â”€ imports/
    â”‚   â”‚       â””â”€â”€ trello.mdx
    â”‚   â””â”€â”€ web/
    â”‚       â”œâ”€â”€ bootstrap.cjs
    â”‚       â”œâ”€â”€ Dockerfile
    â”‚       â”œâ”€â”€ entrypoint.sh
    â”‚       â”œâ”€â”€ eslint.config.js
    â”‚       â”œâ”€â”€ i18n.json
    â”‚       â”œâ”€â”€ lingui.config.ts
    â”‚       â”œâ”€â”€ next.config.js
    â”‚       â”œâ”€â”€ package.json
    â”‚       â”œâ”€â”€ postcss.config.cjs
    â”‚       â”œâ”€â”€ tailwind.config.ts
    â”‚       â”œâ”€â”€ tsconfig.json
    â”‚       â”œâ”€â”€ turbo.json
    â”‚       â”œâ”€â”€ public/
    â”‚       â”‚   â””â”€â”€ testimonials/
    â”‚       â”‚       â””â”€â”€ avatars/
    â”‚       â”‚           â”œâ”€â”€ ehb.webp
    â”‚       â”‚           â””â”€â”€ hanno_braun.webp
    â”‚       â””â”€â”€ src/
    â”‚           â”œâ”€â”€ env.ts
    â”‚           â”œâ”€â”€ middleware.ts
    â”‚           â”œâ”€â”€ components/
    â”‚           â”‚   â”œâ”€â”€ AuthForm.tsx
    â”‚           â”‚   â”œâ”€â”€ Avatar.tsx
    â”‚           â”‚   â”œâ”€â”€ Badge.tsx
    â”‚           â”‚   â”œâ”€â”€ Button.tsx
    â”‚           â”‚   â”œâ”€â”€ CheckboxDropdown.tsx
    â”‚           â”‚   â”œâ”€â”€ CircularProgress.tsx
    â”‚           â”‚   â”œâ”€â”€ CommandPallette.tsx
    â”‚           â”‚   â”œâ”€â”€ Dashboard.tsx
    â”‚           â”‚   â”œâ”€â”€ DateSelector.tsx
    â”‚           â”‚   â”œâ”€â”€ DeleteLabelConfirmation.tsx
    â”‚           â”‚   â”œâ”€â”€ Dropdown.tsx
    â”‚           â”‚   â”œâ”€â”€ Editor.tsx
    â”‚           â”‚   â”œâ”€â”€ FeedbackModal.tsx
    â”‚           â”‚   â”œâ”€â”€ Input.tsx
    â”‚           â”‚   â”œâ”€â”€ LabelForm.tsx
    â”‚           â”‚   â”œâ”€â”€ LabelIcon.tsx
    â”‚           â”‚   â”œâ”€â”€ LanguageSelector.tsx
    â”‚           â”‚   â”œâ”€â”€ LoadingSpinner.tsx
    â”‚           â”‚   â”œâ”€â”€ LottieIcon.tsx
    â”‚           â”‚   â”œâ”€â”€ modal.tsx
    â”‚           â”‚   â”œâ”€â”€ NewWorkspaceForm.tsx
    â”‚           â”‚   â”œâ”€â”€ PageHead.tsx
    â”‚           â”‚   â”œâ”€â”€ PatternedBackground.tsx
    â”‚           â”‚   â”œâ”€â”€ Popup.tsx
    â”‚           â”‚   â”œâ”€â”€ ReactiveButton.tsx
    â”‚           â”‚   â”œâ”€â”€ SettingsLayout.tsx
    â”‚           â”‚   â”œâ”€â”€ SideNavigation.tsx
    â”‚           â”‚   â”œâ”€â”€ StrictModeDroppable.tsx
    â”‚           â”‚   â”œâ”€â”€ ThemeToggle.tsx
    â”‚           â”‚   â”œâ”€â”€ Toggle.tsx
    â”‚           â”‚   â”œâ”€â”€ Tooltip.tsx
    â”‚           â”‚   â”œâ”€â”€ UserMenu.tsx
    â”‚           â”‚   â”œâ”€â”€ WorkspaceMenu.tsx
    â”‚           â”‚   â””â”€â”€ YouTubeEmbed/
    â”‚           â”‚       â”œâ”€â”€ EditYouTubeModal.tsx
    â”‚           â”‚       â”œâ”€â”€ utils.ts
    â”‚           â”‚       â”œâ”€â”€ YouTubeCard.tsx
    â”‚           â”‚       â”œâ”€â”€ YouTubeDropdown.tsx
    â”‚           â”‚       â”œâ”€â”€ YouTubeNode.tsx
    â”‚           â”‚       â””â”€â”€ YouTubeNodeView.tsx
    â”‚           â”œâ”€â”€ hooks/
    â”‚           â”‚   â”œâ”€â”€ useClickOutside.ts
    â”‚           â”‚   â”œâ”€â”€ useClipboard.tsx
    â”‚           â”‚   â”œâ”€â”€ useDebounce.tsx
    â”‚           â”‚   â”œâ”€â”€ useDragToScroll.ts
    â”‚           â”‚   â”œâ”€â”€ useEventListener.ts
    â”‚           â”‚   â”œâ”€â”€ useIsomorphicLayoutEffect.ts
    â”‚           â”‚   â”œâ”€â”€ useLocalisation.ts
    â”‚           â”‚   â”œâ”€â”€ useMediaQuery.ts
    â”‚           â”‚   â”œâ”€â”€ useModalFormState.ts
    â”‚           â”‚   â””â”€â”€ usePermissions.ts
    â”‚           â”œâ”€â”€ locales/
    â”‚           â”‚   â”œâ”€â”€ index.ts
    â”‚           â”‚   â”œâ”€â”€ de/
    â”‚           â”‚   â”‚   â””â”€â”€ messages.ts
    â”‚           â”‚   â”œâ”€â”€ en/
    â”‚           â”‚   â”‚   â””â”€â”€ messages.ts
    â”‚           â”‚   â”œâ”€â”€ es/
    â”‚           â”‚   â”‚   â””â”€â”€ messages.ts
    â”‚           â”‚   â”œâ”€â”€ fr/
    â”‚           â”‚   â”‚   â””â”€â”€ messages.ts
    â”‚           â”‚   â”œâ”€â”€ it/
    â”‚           â”‚   â”‚   â””â”€â”€ messages.ts
    â”‚           â”‚   â”œâ”€â”€ nl/
    â”‚           â”‚   â”‚   â””â”€â”€ messages.ts
    â”‚           â”‚   â”œâ”€â”€ pl/
    â”‚           â”‚   â”‚   â””â”€â”€ messages.ts
    â”‚           â”‚   â””â”€â”€ pt-BR/
    â”‚           â”‚       â””â”€â”€ messages.ts
    â”‚           â”œâ”€â”€ pages/
    â”‚           â”‚   â”œâ”€â”€ _app.tsx
    â”‚           â”‚   â”œâ”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ [workspaceSlug]/
    â”‚           â”‚   â”‚   â”œâ”€â”€ [...boardSlug].tsx
    â”‚           â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ api/
    â”‚           â”‚   â”‚   â”œâ”€â”€ oss-friends.ts
    â”‚           â”‚   â”‚   â”œâ”€â”€ unsubscribe.ts
    â”‚           â”‚   â”‚   â”œâ”€â”€ auth/
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ [...all].ts
    â”‚           â”‚   â”‚   â”œâ”€â”€ download/
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ attatchment.ts
    â”‚           â”‚   â”‚   â”œâ”€â”€ stripe/
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ create_billing_session.ts
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ create_checkout_session.ts
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ webhook.ts
    â”‚           â”‚   â”‚   â”œâ”€â”€ trello/
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ authenticate.ts
    â”‚           â”‚   â”‚   â”œâ”€â”€ trpc/
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ [trpc].ts
    â”‚           â”‚   â”‚   â”œâ”€â”€ upload/
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ attachment.ts
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ avatar.ts
    â”‚           â”‚   â”‚   â””â”€â”€ v1/
    â”‚           â”‚   â”‚       â”œâ”€â”€ [...trpc].ts
    â”‚           â”‚   â”‚       â””â”€â”€ openapi.json.ts
    â”‚           â”‚   â”œâ”€â”€ boards/
    â”‚           â”‚   â”‚   â”œâ”€â”€ index.tsx
    â”‚           â”‚   â”‚   â””â”€â”€ [...boardId]/
    â”‚           â”‚   â”‚       â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ cards/
    â”‚           â”‚   â”‚   â””â”€â”€ [cardId]/
    â”‚           â”‚   â”‚       â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ invite/
    â”‚           â”‚   â”‚   â””â”€â”€ [code].tsx
    â”‚           â”‚   â”œâ”€â”€ login/
    â”‚           â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ members/
    â”‚           â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ oss-friends/
    â”‚           â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ pricing/
    â”‚           â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ privacy/
    â”‚           â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ settings/
    â”‚           â”‚   â”‚   â”œâ”€â”€ account.tsx
    â”‚           â”‚   â”‚   â”œâ”€â”€ api.tsx
    â”‚           â”‚   â”‚   â”œâ”€â”€ billing.tsx
    â”‚           â”‚   â”‚   â”œâ”€â”€ integrations.tsx
    â”‚           â”‚   â”‚   â”œâ”€â”€ permissions.tsx
    â”‚           â”‚   â”‚   â”œâ”€â”€ workspace.tsx
    â”‚           â”‚   â”‚   â””â”€â”€ trello/
    â”‚           â”‚   â”‚       â””â”€â”€ authorize.tsx
    â”‚           â”‚   â”œâ”€â”€ signup/
    â”‚           â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ templates/
    â”‚           â”‚   â”‚   â”œâ”€â”€ index.tsx
    â”‚           â”‚   â”‚   â””â”€â”€ [boardId]/
    â”‚           â”‚   â”‚       â”œâ”€â”€ index.tsx
    â”‚           â”‚   â”‚       â””â”€â”€ cards/
    â”‚           â”‚   â”‚           â””â”€â”€ [cardId]/
    â”‚           â”‚   â”‚               â””â”€â”€ index.tsx
    â”‚           â”‚   â”œâ”€â”€ terms/
    â”‚           â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚           â”‚   â””â”€â”€ unsubscribe/
    â”‚           â”‚       â””â”€â”€ index.tsx
    â”‚           â”œâ”€â”€ providers/
    â”‚           â”‚   â”œâ”€â”€ keyboard-shortcuts.tsx
    â”‚           â”‚   â”œâ”€â”€ lingui.tsx
    â”‚           â”‚   â”œâ”€â”€ modal.tsx
    â”‚           â”‚   â”œâ”€â”€ popup.tsx
    â”‚           â”‚   â”œâ”€â”€ theme.tsx
    â”‚           â”‚   â””â”€â”€ workspace.tsx
    â”‚           â”œâ”€â”€ styles/
    â”‚           â”‚   â””â”€â”€ globals.css
    â”‚           â”œâ”€â”€ types/
    â”‚           â”‚   â””â”€â”€ contenteditable.d.ts
    â”‚           â”œâ”€â”€ utils/
    â”‚           â”‚   â”œâ”€â”€ api.ts
    â”‚           â”‚   â”œâ”€â”€ cardInvalidation.ts
    â”‚           â”‚   â”œâ”€â”€ helpers.test.ts
    â”‚           â”‚   â”œâ”€â”€ helpers.ts
    â”‚           â”‚   â””â”€â”€ i18n.ts
    â”‚           â””â”€â”€ views/
    â”‚               â”œâ”€â”€ auth/
    â”‚               â”‚   â”œâ”€â”€ login/
    â”‚               â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚               â”‚   â””â”€â”€ signup/
    â”‚               â”‚       â””â”€â”€ index.tsx
    â”‚               â”œâ”€â”€ board/
    â”‚               â”‚   â”œâ”€â”€ index.tsx
    â”‚               â”‚   â””â”€â”€ components/
    â”‚               â”‚       â”œâ”€â”€ BoardDropdown.tsx
    â”‚               â”‚       â”œâ”€â”€ Card.tsx
    â”‚               â”‚       â”œâ”€â”€ DeleteBoardConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ DeleteListConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ Filters.tsx
    â”‚               â”‚       â”œâ”€â”€ List.tsx
    â”‚               â”‚       â”œâ”€â”€ NewCardForm.tsx
    â”‚               â”‚       â”œâ”€â”€ NewListForm.tsx
    â”‚               â”‚       â”œâ”€â”€ NewTemplateForm.tsx
    â”‚               â”‚       â”œâ”€â”€ UpdateBoardSlugButton.tsx
    â”‚               â”‚       â”œâ”€â”€ UpdateBoardSlugForm.tsx
    â”‚               â”‚       â””â”€â”€ VisibilityButton.tsx
    â”‚               â”œâ”€â”€ boards/
    â”‚               â”‚   â”œâ”€â”€ index.tsx
    â”‚               â”‚   â””â”€â”€ components/
    â”‚               â”‚       â”œâ”€â”€ BoardsList.tsx
    â”‚               â”‚       â”œâ”€â”€ ImportBoardsForm.tsx
    â”‚               â”‚       â”œâ”€â”€ NewBoardForm.tsx
    â”‚               â”‚       â””â”€â”€ TemplateBoards.tsx
    â”‚               â”œâ”€â”€ card/
    â”‚               â”‚   â”œâ”€â”€ index.tsx
    â”‚               â”‚   â””â”€â”€ components/
    â”‚               â”‚       â”œâ”€â”€ ActivityList.tsx
    â”‚               â”‚       â”œâ”€â”€ AttachmentThumbnails.tsx
    â”‚               â”‚       â”œâ”€â”€ AttachmentUpload.tsx
    â”‚               â”‚       â”œâ”€â”€ ChecklistItemRow.tsx
    â”‚               â”‚       â”œâ”€â”€ ChecklistNameInput.tsx
    â”‚               â”‚       â”œâ”€â”€ Checklists.tsx
    â”‚               â”‚       â”œâ”€â”€ Comment.tsx
    â”‚               â”‚       â”œâ”€â”€ DeleteCardConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ DeleteChecklistConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ DeleteCommentConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ Dropdown.tsx
    â”‚               â”‚       â”œâ”€â”€ DueDateSelector.tsx
    â”‚               â”‚       â”œâ”€â”€ LabelSelector.tsx
    â”‚               â”‚       â”œâ”€â”€ ListSelector.tsx
    â”‚               â”‚       â”œâ”€â”€ MemberSelector.tsx
    â”‚               â”‚       â”œâ”€â”€ NewChecklistForm.tsx
    â”‚               â”‚       â”œâ”€â”€ NewChecklistItemForm.tsx
    â”‚               â”‚       â””â”€â”€ NewCommentForm.tsx
    â”‚               â”œâ”€â”€ home/
    â”‚               â”‚   â”œâ”€â”€ index.tsx
    â”‚               â”‚   â””â”€â”€ components/
    â”‚               â”‚       â”œâ”€â”€ Cta.tsx
    â”‚               â”‚       â”œâ”€â”€ Faqs.tsx
    â”‚               â”‚       â”œâ”€â”€ Features.tsx
    â”‚               â”‚       â”œâ”€â”€ Footer.tsx
    â”‚               â”‚       â”œâ”€â”€ Header.tsx
    â”‚               â”‚       â”œâ”€â”€ Layout.tsx
    â”‚               â”‚       â”œâ”€â”€ Logos.tsx
    â”‚               â”‚       â””â”€â”€ Testimonials.tsx
    â”‚               â”œâ”€â”€ invite/
    â”‚               â”‚   â””â”€â”€ index.tsx
    â”‚               â”œâ”€â”€ members/
    â”‚               â”‚   â”œâ”€â”€ index.tsx
    â”‚               â”‚   â””â”€â”€ components/
    â”‚               â”‚       â”œâ”€â”€ DeleteMemberConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ EditMemberPermissionsModal.tsx
    â”‚               â”‚       â”œâ”€â”€ InviteMemberForm.tsx
    â”‚               â”‚       â””â”€â”€ MemberDropdown.tsx
    â”‚               â”œâ”€â”€ oss-friends/
    â”‚               â”‚   â””â”€â”€ index.tsx
    â”‚               â”œâ”€â”€ pricing/
    â”‚               â”‚   â”œâ”€â”€ index.tsx
    â”‚               â”‚   â””â”€â”€ components/
    â”‚               â”‚       â”œâ”€â”€ FeatureComparisonTable.tsx
    â”‚               â”‚       â”œâ”€â”€ Pricing.tsx
    â”‚               â”‚       â””â”€â”€ PricingTiers.tsx
    â”‚               â”œâ”€â”€ privacy/
    â”‚               â”‚   â””â”€â”€ index.tsx
    â”‚               â”œâ”€â”€ public/
    â”‚               â”‚   â”œâ”€â”€ board/
    â”‚               â”‚   â”‚   â”œâ”€â”€ CardModal.tsx
    â”‚               â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚               â”‚   â””â”€â”€ boards/
    â”‚               â”‚       â””â”€â”€ index.tsx
    â”‚               â”œâ”€â”€ settings/
    â”‚               â”‚   â”œâ”€â”€ AccountSettings.tsx
    â”‚               â”‚   â”œâ”€â”€ ApiSettings.tsx
    â”‚               â”‚   â”œâ”€â”€ BillingSettings.tsx
    â”‚               â”‚   â”œâ”€â”€ IntegrationsSettings.tsx
    â”‚               â”‚   â”œâ”€â”€ PermissionsSettings.tsx
    â”‚               â”‚   â”œâ”€â”€ WorkspaceSettings.tsx
    â”‚               â”‚   â””â”€â”€ components/
    â”‚               â”‚       â”œâ”€â”€ ApiKeyList.tsx
    â”‚               â”‚       â”œâ”€â”€ Avatar.tsx
    â”‚               â”‚       â”œâ”€â”€ ChangePasswordConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ ClearCustomPermissionsConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ DeleteAccountConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ DeleteWorkspaceConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ NewApiKeyForm.tsx
    â”‚               â”‚       â”œâ”€â”€ NewApiKeyModal.tsx
    â”‚               â”‚       â”œâ”€â”€ RevokeApiKeyConfirmation.tsx
    â”‚               â”‚       â”œâ”€â”€ RolePermissions.tsx
    â”‚               â”‚       â”œâ”€â”€ UpdateDisplayNameForm.tsx
    â”‚               â”‚       â”œâ”€â”€ UpdateWorkspaceDescriptionForm.tsx
    â”‚               â”‚       â”œâ”€â”€ UpdateWorkspaceEmailVisibilityForm.tsx
    â”‚               â”‚       â”œâ”€â”€ UpdateWorkspaceNameForm.tsx
    â”‚               â”‚       â”œâ”€â”€ UpdateWorkspaceUrlForm.tsx
    â”‚               â”‚       â””â”€â”€ UpgradeToProConfirmation.tsx
    â”‚               â””â”€â”€ terms/
    â”‚                   â””â”€â”€ index.tsx
    â”œâ”€â”€ cloud/
    â”‚   â””â”€â”€ docker-compose.yml
    â”œâ”€â”€ packages/
    â”‚   â”œâ”€â”€ api/
    â”‚   â”‚   â”œâ”€â”€ eslint.config.js
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ index.ts
    â”‚   â”‚       â”œâ”€â”€ openapi.ts
    â”‚   â”‚       â”œâ”€â”€ root.ts
    â”‚   â”‚       â”œâ”€â”€ trpc.ts
    â”‚   â”‚       â”œâ”€â”€ routers/
    â”‚   â”‚       â”‚   â”œâ”€â”€ attachment.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ board.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ card.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ checklist.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ feedback.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ health.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ import.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ integration.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ label.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ list.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ member.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ permission.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ user.ts
    â”‚   â”‚       â”‚   â””â”€â”€ workspace.ts
    â”‚   â”‚       â”œâ”€â”€ types/
    â”‚   â”‚       â”‚   â””â”€â”€ router.types.ts
    â”‚   â”‚       â””â”€â”€ utils/
    â”‚   â”‚           â”œâ”€â”€ activities.ts
    â”‚   â”‚           â”œâ”€â”€ auth.ts
    â”‚   â”‚           â”œâ”€â”€ notifications.ts
    â”‚   â”‚           â”œâ”€â”€ permissions.ts
    â”‚   â”‚           â””â”€â”€ rateLimit.ts
    â”‚   â”œâ”€â”€ auth/
    â”‚   â”‚   â”œâ”€â”€ eslint.config.js
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ auth.ts
    â”‚   â”‚       â”œâ”€â”€ client.ts
    â”‚   â”‚       â”œâ”€â”€ hooks.ts
    â”‚   â”‚       â”œâ”€â”€ index.ts
    â”‚   â”‚       â”œâ”€â”€ plugins.ts
    â”‚   â”‚       â”œâ”€â”€ providers.ts
    â”‚   â”‚       â”œâ”€â”€ server.ts
    â”‚   â”‚       â””â”€â”€ utils.ts
    â”‚   â”œâ”€â”€ db/
    â”‚   â”‚   â”œâ”€â”€ drizzle.config.ts
    â”‚   â”‚   â”œâ”€â”€ eslint.config.js
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ migrations/
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250508083758_SetupTables.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250522083748_AddEmailToWorkspaceMembers.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250527203813_AddDeletedAtToLabel.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250605101155_AddCascadeDeleteToCardRelations.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250608100932_AddIntegrationsTable.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250608175448_AddOnDeleteActionToUserDeletion.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250610200449_ReaddIntegrationTable.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250806202106_glossy_luminals.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250813141748_AddChecklistActivityTypes.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250902085406_AddSubscriptions.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250907185512_AddUnlimitedSeatsToSubscription.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250910195058_RemoveNotNullConstraintFromReferenceIdOnSubsriptions.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250910200416_AddWorkspaceSlugChecks.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250910202358_AddCascadeSetNullToReferenceIdOnSubsriptions.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250918201751_AddPausedMemberStatus.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20250923211958_AddWorkspaceInviteLinks.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20251001220136_AddFuzzySearchSupport.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20251007204129_AddBoardTypeAndSourceIdColumns.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20251009211316_AddBoardSourceIdToCardActivity.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20251110204423_AddCardAttachments.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20251201204335_AddCardDueDates.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20251229220153_UpdateCardTitleFromVarcharToText.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20260119164257_AddShowEmailsToMembersToWorkspace.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20260126135909_AddWorkspaceRoles.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20260129210000_AddWorkspaceWebhooks.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20260201215958_AddUserBoardFavouritesTable.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20260207214056_AddNotificationsTable.sql
    â”‚   â”‚   â”‚   â”œâ”€â”€ 20260208033314_AddAttachmentToActivity.sql
    â”‚   â”‚   â”‚   â””â”€â”€ meta/
    â”‚   â”‚   â”‚       â”œâ”€â”€ 20250608175448_snapshot.json
    â”‚   â”‚   â”‚       â”œâ”€â”€ 20250610200449_snapshot.json
    â”‚   â”‚   â”‚       â””â”€â”€ _journal.json
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ client.ts
    â”‚   â”‚       â”œâ”€â”€ redis.ts
    â”‚   â”‚       â”œâ”€â”€ repository/
    â”‚   â”‚       â”‚   â”œâ”€â”€ board.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ card.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ cardActivity.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ cardAttachment.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ cardComment.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ checklist.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ feedback.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ import.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ integration.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ inviteLink.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ label.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ list.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ member.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ notification.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ permission.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ subscription.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ user.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ webhook.repo.ts
    â”‚   â”‚       â”‚   â”œâ”€â”€ workspace.repo.ts
    â”‚   â”‚       â”‚   â””â”€â”€ workspaceSlug.repo.ts
    â”‚   â”‚       â””â”€â”€ schema/
    â”‚   â”‚           â”œâ”€â”€ auth.ts
    â”‚   â”‚           â”œâ”€â”€ boards.ts
    â”‚   â”‚           â”œâ”€â”€ cards.ts
    â”‚   â”‚           â”œâ”€â”€ checklists.ts
    â”‚   â”‚           â”œâ”€â”€ feedback.ts
    â”‚   â”‚           â”œâ”€â”€ imports.ts
    â”‚   â”‚           â”œâ”€â”€ index.ts
    â”‚   â”‚           â”œâ”€â”€ integrations.ts
    â”‚   â”‚           â”œâ”€â”€ labels.ts
    â”‚   â”‚           â”œâ”€â”€ lists.ts
    â”‚   â”‚           â”œâ”€â”€ notifications.ts
    â”‚   â”‚           â”œâ”€â”€ permissions.ts
    â”‚   â”‚           â”œâ”€â”€ subscriptions.ts
    â”‚   â”‚           â”œâ”€â”€ users.ts
    â”‚   â”‚           â”œâ”€â”€ webhooks.ts
    â”‚   â”‚           â”œâ”€â”€ workspaceInviteLinks.ts
    â”‚   â”‚           â””â”€â”€ workspaces.ts
    â”‚   â”œâ”€â”€ email/
    â”‚   â”‚   â”œâ”€â”€ readme.md
    â”‚   â”‚   â”œâ”€â”€ eslint.config.js
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â”œâ”€â”€ src/
    â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
    â”‚   â”‚   â”‚   â”œâ”€â”€ notificationClient.tsx
    â”‚   â”‚   â”‚   â”œâ”€â”€ sendEmail.tsx
    â”‚   â”‚   â”‚   â””â”€â”€ templates/
    â”‚   â”‚   â”‚       â”œâ”€â”€ join-workspace.tsx
    â”‚   â”‚   â”‚       â”œâ”€â”€ magic-link.tsx
    â”‚   â”‚   â”‚       â”œâ”€â”€ mention.tsx
    â”‚   â”‚   â”‚       â””â”€â”€ reset-password.tsx
    â”‚   â”‚   â””â”€â”€ .react-email/
    â”‚   â”‚       â”œâ”€â”€ next.config.js
    â”‚   â”‚       â”œâ”€â”€ package.json
    â”‚   â”‚       â”œâ”€â”€ postcss.config.js
    â”‚   â”‚       â”œâ”€â”€ tailwind.config.js
    â”‚   â”‚       â”œâ”€â”€ tsconfig.json
    â”‚   â”‚       â”œâ”€â”€ .eslintrc.json
    â”‚   â”‚       â”œâ”€â”€ .prettierignore
    â”‚   â”‚       â”œâ”€â”€ .prettierrc.js
    â”‚   â”‚       â”œâ”€â”€ emails/
    â”‚   â”‚       â”‚   â””â”€â”€ magic-link.tsx
    â”‚   â”‚       â””â”€â”€ src/
    â”‚   â”‚           â”œâ”€â”€ app/
    â”‚   â”‚           â”‚   â”œâ”€â”€ home.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ layout.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ page.tsx
    â”‚   â”‚           â”‚   â””â”€â”€ preview/
    â”‚   â”‚           â”‚       â””â”€â”€ [slug]/
    â”‚   â”‚           â”‚           â”œâ”€â”€ page.tsx
    â”‚   â”‚           â”‚           â””â”€â”€ preview.tsx
    â”‚   â”‚           â”œâ”€â”€ components/
    â”‚   â”‚           â”‚   â”œâ”€â”€ button.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ code-container.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ code.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ heading.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ icon-base.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ icon-button.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ icon-check.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ icon-clipboard.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ icon-download.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ index.ts
    â”‚   â”‚           â”‚   â”œâ”€â”€ logo.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ send.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ shell.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ sidebar.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ text.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ tooltip-content.tsx
    â”‚   â”‚           â”‚   â”œâ”€â”€ tooltip.tsx
    â”‚   â”‚           â”‚   â””â”€â”€ topbar.tsx
    â”‚   â”‚           â”œâ”€â”€ styles/
    â”‚   â”‚           â”‚   â””â”€â”€ globals.css
    â”‚   â”‚           â””â”€â”€ utils/
    â”‚   â”‚               â”œâ”€â”€ as.ts
    â”‚   â”‚               â”œâ”€â”€ copy-text-to-clipboard.ts
    â”‚   â”‚               â”œâ”€â”€ get-emails.ts
    â”‚   â”‚               â”œâ”€â”€ index.ts
    â”‚   â”‚               â”œâ”€â”€ language-map.ts
    â”‚   â”‚               â””â”€â”€ unreachable.ts
    â”‚   â”œâ”€â”€ shared/
    â”‚   â”‚   â”œâ”€â”€ eslint.config.js
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â””â”€â”€ src/
    â”‚   â”‚       â”œâ”€â”€ index.ts
    â”‚   â”‚       â”œâ”€â”€ permissions.ts
    â”‚   â”‚       â”œâ”€â”€ constants/
    â”‚   â”‚       â”‚   â”œâ”€â”€ colours.ts
    â”‚   â”‚       â”‚   â””â”€â”€ index.ts
    â”‚   â”‚       â””â”€â”€ utils/
    â”‚   â”‚           â”œâ”€â”€ dueDateFilters.ts
    â”‚   â”‚           â”œâ”€â”€ email.ts
    â”‚   â”‚           â”œâ”€â”€ generateSlug.ts
    â”‚   â”‚           â”œâ”€â”€ generateUID.ts
    â”‚   â”‚           â”œâ”€â”€ index.ts
    â”‚   â”‚           â”œâ”€â”€ mentions.ts
    â”‚   â”‚           â”œâ”€â”€ s3.ts
    â”‚   â”‚           â””â”€â”€ subscriptions.ts
    â”‚   â””â”€â”€ stripe/
    â”‚       â”œâ”€â”€ eslint.config.js
    â”‚       â”œâ”€â”€ package.json
    â”‚       â”œâ”€â”€ tsconfig.json
    â”‚       â””â”€â”€ src/
    â”‚           â””â”€â”€ index.ts
    â”œâ”€â”€ tooling/
    â”‚   â”œâ”€â”€ eslint/
    â”‚   â”‚   â”œâ”€â”€ base.js
    â”‚   â”‚   â”œâ”€â”€ nextjs.js
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ react.js
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â””â”€â”€ types.d.ts
    â”‚   â”œâ”€â”€ prettier/
    â”‚   â”‚   â”œâ”€â”€ index.js
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â””â”€â”€ tsconfig.json
    â”‚   â”œâ”€â”€ tailwind/
    â”‚   â”‚   â”œâ”€â”€ eslint.config.js
    â”‚   â”‚   â”œâ”€â”€ package.json
    â”‚   â”‚   â”œâ”€â”€ tsconfig.json
    â”‚   â”‚   â””â”€â”€ web.ts
    â”‚   â””â”€â”€ typescript/
    â”‚       â”œâ”€â”€ base.json
    â”‚       â”œâ”€â”€ internal-package.json
    â”‚       â””â”€â”€ package.json
    â”œâ”€â”€ turbo/
    â”‚   â””â”€â”€ generators/
    â”‚       â”œâ”€â”€ config.ts
    â”‚       â””â”€â”€ templates/
    â”‚           â”œâ”€â”€ eslint.config.js.hbs
    â”‚           â”œâ”€â”€ package.json.hbs
    â”‚           â””â”€â”€ tsconfig.json.hbs
    â””â”€â”€ .github/
        â”œâ”€â”€ funding.yml
        â”œâ”€â”€ ISSUE_TEMPLATE/
        â”‚   â”œâ”€â”€ bug_report.md
        â”‚   â””â”€â”€ feature_request.md
        â””â”€â”€ workflows/
            â””â”€â”€ docker-publish.yml

================================================
FILE: README.md
================================================
![github-background](https://github.com/user-attachments/assets/f728f52e-bf67-4357-9ba2-c24c437488e3)

<div align="center">
  <h3 align="center">Kan</h3>
  <p>The open-source project management alternative to Trello.</p>
</div>

<p align="center">
  <a href="https://kan.bn/kan/roadmap">Roadmap</a>
  Â·
  <a href="https://kan.bn">Website</a>
  Â·
  <a href="https://docs.kan.bn">Docs</a>
  Â·
  <a href="https://discord.gg/e6ejRb6CmT">Discord</a>
</p>

<div align="center">
  <a href="https://github.com/kanbn/kan/blob/main/LICENSE"><img alt="License" src="https://img.shields.io/badge/license-AGPLv3-purple"></a>
</div>

## Features ğŸ’«

- ğŸ‘ï¸ **Board Visibility**: Control who can view and edit your boards
- ğŸ¤ **Workspace Members**: Invite members and collaborate with your team
- ğŸš€ **Trello Imports**: Easily import your Trello boards
- ğŸ” **Labels & Filters**: Organise and find cards quickly
- ğŸ’¬ **Comments**: Discuss and collaborate with your team
- ğŸ“ **Activity Log**: Track all card changes with detailed activity history
- ğŸ¨ **Templates** : Save time with reusable custom board templates
- âš¡ï¸ **Integrations (coming soon)** : Connect your favourite tools

See our [roadmap](https://kan.bn/kan/roadmap) for upcoming features.

## Screenshot ğŸ‘ï¸

<img width="1507" alt="hero-dark" src="https://github.com/user-attachments/assets/8490104a-cd5d-49de-afc2-152fd8a93119" />

## Made With ğŸ› ï¸

- [Next.js](https://nextjs.org/?ref=kan.bn)
- [tRPC](https://trpc.io/?ref=kan.bn)
- [Better Auth](https://better-auth.com/?ref=kan.bn)
- [Tailwind CSS](https://tailwindcss.com/?ref=kan.bn)
- [Drizzle ORM](https://orm.drizzle.team/?ref=kan.bn)
- [React Email](https://react.email/?ref=kan.bn)

## Self Hosting ğŸ³

### One-click Deployments

The easiest way to deploy Kan is through Railway. We've partnered with Railway to maintain an official template that supports the development of the project.

<a href="https://railway.com/deploy/kan?referralCode=bZPsr2&utm_medium=integration&utm_source=template&utm_campaign=generic">
  <img src="https://railway.app/button.svg" alt="Deploy on Railway" height="40" />
</a>

### Docker Compose

Alternatively, you can self-host Kan with Docker Compose. This will set up everything for you including your postgres database and automatically run migrations.

1. Create a `.env` file with your environment variables (see [Environment Variables](#environment-variables-) section below)

2. Use the provided `docker-compose.yml` file or create your own with the following configuration:

```yaml
services:
  migrate:
    image: ghcr.io/kanbn/kan-migrate:latest
    container_name: kan-migrate
    networks:
      - kan-network
    build:
      context: .
      dockerfile: ./apps/web/Dockerfile
      target: migrate
    environment:
      - POSTGRES_URL=${POSTGRES_URL}
    depends_on:
      postgres:
        condition: service_healthy
    restart: "no"

  web:
    image: ghcr.io/kanbn/kan:latest
    container_name: kan-web
    ports:
      - "${WEB_PORT:-3000}:3000"
    networks:
      - kan-network
    build:
      context: .
      dockerfile: ./apps/web/Dockerfile
      target: web
    env_file:
      - .env
    environment:
      - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL}
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET}
      - POSTGRES_URL=${POSTGRES_URL}
      - NEXT_PUBLIC_ALLOW_CREDENTIALS=true
    depends_on:
      migrate:
        condition: service_completed_successfully
    restart: unless-stopped

  postgres:
    image: postgres:15
    container_name: kan-db
    environment:
      - POSTGRES_DB=kan_db
      - POSTGRES_USER=kan
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    ports:
      - 5432:5432
    volumes:
      - kan_postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U kan -d kan_db"]
      interval: 5s
      timeout: 5s
      retries: 10
    restart: unless-stopped
    networks:
      - kan-network

networks:
  kan-network:

volumes:
  kan_postgres_data:
```

3. Start the containers in detached mode:

```bash
docker compose up -d
```

The `migrate` service will automatically run database migrations before the web service starts. The application will be available at http://localhost:3000 (or the port specified in `WEB_PORT`).

**Managing containers:**

- To stop the containers: `docker compose down`
- To view logs: `docker compose logs -f`
- To view logs for a specific service: `docker compose logs -f web` or `docker compose logs -f migrate`
- To restart the containers: `docker compose restart`
- To rebuild after code changes: `docker compose up -d --build`

For the complete Docker Compose configuration with all optional features, see [docker-compose.yml](./docker-compose.yml) in the repository.

## Local Development ğŸ§‘â€ğŸ’»

1. Clone the repository (or fork)

```bash
git clone https://github.com/kanbn/kan.git
```

2. Install dependencies

```bash
pnpm install
```

3. Copy `.env.example` to `.env` and configure your environment variables
4. Migrate database

```bash
pnpm db:migrate
```

5. Start the development server

```bash
pnpm dev
```

## Environment Variables ğŸ”

| Variable                                  | Description                                               | Required                              | Example                                                     |
| ----------------------------------------- | --------------------------------------------------------- | ------------------------------------- | ----------------------------------------------------------- |
| `POSTGRES_URL`                            | PostgreSQL connection URL                                 | To use external database              | `postgres://user:pass@localhost:5432/db`                    |
| `REDIS_URL`                               | Redis connection URL                                      | For rate limiting (optional)          | `redis://localhost:6379` or `redis://redis:6379` (Docker)   |
| `EMAIL_FROM`                              | Sender email address                                      | For Email                             | `"Kan <hello@mail.kan.bn>"`                                 |
| `SMTP_HOST`                               | SMTP server hostname                                      | For Email                             | `smtp.resend.com`                                           |
| `SMTP_PORT`                               | SMTP server port                                          | For Email                             | `465`                                                       |
| `SMTP_USER`                               | SMTP username/email                                       | No                                    | `resend`                                                    |
| `SMTP_PASSWORD`                           | SMTP password/token                                       | No                                    | `re_xxxx`                                                   |
| `SMTP_SECURE`                             | Use secure SMTP connection (defaults to true if not set)  | For Email                             | `true`                                                      |
| `SMTP_REJECT_UNAUTHORIZED`                | Reject invalid certificates (defaults to true if not set) | For Email                             | `false`                                                     |
| `NEXT_PUBLIC_DISABLE_EMAIL`               | To disable all email features                             | For Email                             | `true`                                                      |
| `NEXT_PUBLIC_BASE_URL`                    | Base URL of your installation                             | Yes                                   | `http://localhost:3000`                                     |
| `NEXT_API_BODY_SIZE_LIMIT`                | Maximum API request body size (defaults to 1mb)           | No                                    | `50mb`                                                      |
| `BETTER_AUTH_ALLOWED_DOMAINS`             | Comma-separated list of allowed domains for OIDC logins   | For OIDC/Social login                 | `example.com,subsidiary.com`                                |
| `BETTER_AUTH_SECRET`                      | Auth encryption secret                                    | Yes                                   | Random 32+ char string                                      |
| `BETTER_AUTH_TRUSTED_ORIGINS`             | Allowed callback origins                                  | No                                    | `http://localhost:3000,http://localhost:3001`               |
| `GOOGLE_CLIENT_ID`                        | Google OAuth client ID                                    | For Google login                      | `xxx.apps.googleusercontent.com`                            |
| `GOOGLE_CLIENT_SECRET`                    | Google OAuth client secret                                | For Google login                      | `xxx`                                                       |
| `DISCORD_CLIENT_ID`                       | Discord OAuth client ID                                   | For Discord login                     | `xxx`                                                       |
| `DISCORD_CLIENT_SECRET`                   | Discord OAuth client secret                               | For Discord login                     | `xxx`                                                       |
| `GITHUB_CLIENT_ID`                        | GitHub OAuth client ID                                    | For GitHub login                      | `xxx`                                                       |
| `GITHUB_CLIENT_SECRET`                    | GitHub OAuth client secret                                | For GitHub login                      | `xxx`                                                       |
| `OIDC_CLIENT_ID`                          | Generic OIDC client ID                                    | For OIDC login                        | `xxx`                                                       |
| `OIDC_CLIENT_SECRET`                      | Generic OIDC client secret                                | For OIDC login                        | `xxx`                                                       |
| `OIDC_DISCOVERY_URL`                      | OIDC discovery URL                                        | For OIDC login                        | `https://auth.example.com/.well-known/openid-configuration` |
| `TRELLO_APP_API_KEY`                      | Trello app API key                                        | For Trello import                     | `xxx`                                                       |
| `TRELLO_APP_API_SECRET`                   | Trello app API secret                                     | For Trello import                     | `xxx`                                                       |
| `S3_REGION`                               | S3 storage region                                         | For file uploads                      | `WEUR`                                                      |
| `S3_ENDPOINT`                             | S3 endpoint URL                                           | For file uploads                      | `https://xxx.r2.cloudflarestorage.com`                      |
| `S3_ACCESS_KEY_ID`                        | S3 access key                                             | For file uploads (optional with IRSA) | `xxx`                                                       |
| `S3_SECRET_ACCESS_KEY`                    | S3 secret key                                             | For file uploads (optional with IRSA) | `xxx`                                                       |
| `S3_FORCE_PATH_STYLE`                     | Use path-style URLs for S3                                | For file uploads                      | `true`                                                      |
| `NEXT_PUBLIC_STORAGE_URL`                 | Storage service URL                                       | For file uploads                      | `https://storage.kanbn.com`                                 |
| `NEXT_PUBLIC_STORAGE_DOMAIN`              | Storage domain name                                       | For file uploads                      | `kanbn.com`                                                 |
| `NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS`     | Use virtual-hosted style URLs (bucket.domain.com)         | For file uploads (optional)           | `true`                                                      |
| `NEXT_PUBLIC_AVATAR_BUCKET_NAME`          | S3 bucket name for avatars                                | For file uploads                      | `avatars`                                                   |
| `NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME`     | S3 bucket name for attachments                            | For file uploads                      | `attachments`                                               |
| `NEXT_PUBLIC_ALLOW_CREDENTIALS`           | Allow email & password login                              | For authentication                    | `true`                                                      |
| `NEXT_PUBLIC_DISABLE_SIGN_UP`             | Disable sign up                                           | For authentication                    | `false`                                                     |
| `NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY` | Hide â€œPowered by kan.bnâ€ on public boards (self-host)     | For white labelling                   | `true`                                                      |
| `KAN_ADMIN_API_KEY`                       | Admin API key for stats and admin endpoints               | For admin/monitoring                  | `your-secret-admin-key`                                     |

See `.env.example` for a complete list of supported environment variables.

## Contributing ğŸ¤

We welcome contributions! Please read our [contribution guidelines](CONTRIBUTING.md) before submitting a pull request.

## Contributors ğŸ‘¥

<a href="https://github.com/kanbn/kan/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=kanbn/kan" />
</a>

## License ğŸ“

Kan is licensed under the [AGPLv3 license](LICENSE).

## Contact ğŸ“§

For support or to get in touch, please email [henry@kan.bn](mailto:henry@kan.bn) or join our [Discord server](https://discord.gg/e6ejRb6CmT).



================================================
FILE: AGENTS.md
================================================
# AGENTS.md

## Project Overview

Kan is an open-source project management tool (Trello alternative) built with:

- **Frontend**: Next.js, React, TypeScript, Tailwind CSS
- **Backend**: tRPC, Node.js
- **Database**: PostgreSQL with Drizzle ORM
- **Monorepo**: pnpm workspaces with Turbo
- **Auth**: Better Auth
- **Internationalization**: Lingui

## Setup Commands

- Install deps: `pnpm install`
- Start dev server: `pnpm dev`
- Create migrations: `cd packages/db && pnpm drizzle-kit generate --name "AddFieldToTable"`
- Run database migrations: `pnpm db:migrate`
- Run linter: `pnpm lint`
- Run type check: `pnpm typecheck`
- Format code: `pnpm format:fix`
- Extract i18n strings: `pnpm lingui:extract`

## Project Structure

- `apps/web/` - Next.js web application
- `packages/api/` - tRPC API routers
- `packages/db/` - Database schema, migrations, and repositories
- `packages/auth/` - Authentication package
- `packages/shared/` - Shared utilities
- `packages/email/` - Email templates and sending
- `packages/stripe/` - Stripe integration
- `tooling/` - Shared tooling configs (ESLint, Prettier, TypeScript)

## Code Style

### TypeScript

- Use TypeScript strictly - avoid `any` types
- Prefer explicit types over inference when it improves clarity
- Use `as const` for literal types when appropriate
- Follow existing patterns for type definitions

### Naming Conventions

- **Files**: kebab-case for files (e.g., `card-repo.ts`)
- **Components**: PascalCase for React components
- **Functions**: camelCase for functions
- **Constants**: UPPER_SNAKE_CASE for constants
- **Types/Interfaces**: PascalCase

### Database Layer (`packages/db/`)

- **Schema**: Define schemas in `src/schema/` using Drizzle ORM
- **Migrations**: Create migrations with `cd packages/db && pnpm drizzle-kit generate --name "MigrationName"`, then run with `pnpm db:migrate`
- **Repositories**: Put database queries in `src/repository/` files
- **Soft Deletes**: Use `deletedAt` timestamp for soft deletion (not hard deletes)
- **Index Management**: Cards have `index` fields that must be maintained sequentially per list
- **Activity Logging**: Use `card_activity` table to track all card changes

### API Layer (`packages/api/`)

- **Routers**: Create tRPC routers in `src/routers/`
- **Procedures**: Use `protectedProcedure` for authenticated endpoints, `publicProcedure` for public
- **Validation**: Use Zod schemas for input validation
- **Error Handling**: Use `TRPCError` with appropriate error codes
- **OpenAPI**: Add OpenAPI metadata for all endpoints
- **Authorization**: Always check workspace membership with `assertUserInWorkspace`

### Frontend (`apps/web/`)

- **Components**: React components in `src/components/`
- **Views**: Page-level components in `src/views/`
- **Hooks**: Custom hooks in `src/hooks/`
- **i18n**: Use `t` template literal for translations (Lingui)
- **Styling**: Use Tailwind CSS classes
- **State Management**: Use tRPC React Query hooks for server state
- **Modals**: Use `useModal` hook for modal management
- **Popups**: Use `usePopup` hook for toast notifications

## Key Concepts

### Cards

- Cards are the main entity in Kan
- Cards belong to Lists, which belong to Boards
- Cards have: title, description, labels, members, checklists, comments, attachments, due dates
- Cards use soft deletion (`deletedAt` field)
- Cards have an `index` field that must be maintained sequentially per list
- All card changes are tracked in `card_activity` table

### Activity Tracking

- Every significant card change creates an activity record
- Activity types include: created, updated (various fields), etc.
- Activities are displayed in card activity feeds

### Workspaces & Boards

- Users belong to Workspaces
- Boards belong to Workspaces
- Workspace members have different permission levels
- Boards can be public or private

### Soft Deletion Pattern

- Entities use `deletedAt` timestamp for soft deletion
- Queries filter with `isNull(table.deletedAt)` to exclude deleted items

## File Locations Reference

### Database

- Schema: `packages/db/src/schema/*.ts`
- Repositories: `packages/db/src/repository/*.repo.ts`
- Migrations: `packages/db/migrations/`

### API

- Routers: `packages/api/src/routers/*.ts`
- Utils: `packages/api/src/utils/`
- Types: `packages/api/src/types/`

### Frontend

- Components: `apps/web/src/components/`
- Views: `apps/web/src/views/`
- Pages: `apps/web/src/pages/`
- Hooks: `apps/web/src/hooks/`
- Utils: `apps/web/src/utils/`
- Locales: `apps/web/src/locales/`

## Database Patterns

- **Soft Deletes**: Always filter with `isNull(table.deletedAt)` in queries
- **Public IDs**: Use 12-character public IDs (`publicId`) for all user-facing entities
- **Internal IDs**: Never expose internal database IDs (e.g., `id`, `cardId`, `listId`) in API responses or URLs - always use `publicId` externally
- **Transactions**: Use database transactions for multi-step operations
- **Index Management**: When deleting/moving cards, maintain sequential indices
- **Activity Tracking**: Create activity records for all significant changes

## API Patterns

- **Input Validation**: Always validate inputs with Zod
- **Error Messages**: Provide clear, user-friendly error messages
- **Optimistic Updates**: Use tRPC's `onMutate` for optimistic UI updates
- **Cache Invalidation**: Properly invalidate queries after mutations
- **ID Exposure**: Never expose internal database IDs (`id`, `cardId`, `listId`, etc.) in API responses, URLs, or frontend code - always use `publicId` for external communication

## Important Patterns

### Card Index Management

When cards are created, moved, or deleted, their indices must be maintained:

- New cards: Append to end (max index + 1) or insert at position
- Moving cards: Adjust indices of affected cards
- Deleting cards: Decrement indices of cards after deleted one
- Always use transactions for index updates

### Activity Logging

Create activity records for:

- Card creation
- Card updates (title, description, list, etc.)
- Label/member additions/removals
- Comments
- Checklists and items
- Attachments
- Due dates

### Authorization

Always check:

1. User is authenticated
2. User has access to workspace
3. User has permission for the operation

Use `assertUserInWorkspace` helper for workspace checks.

### Error Handling

- Use TRPCError with appropriate codes (UNAUTHORIZED, NOT_FOUND, etc.)
- Provide user-friendly error messages
- Log errors appropriately
- Show popup notifications for user-facing errors

## Common Patterns

### Creating a Card

1. Create card in repository with proper index management
2. Create `card.created` activity
3. Handle label/member relationships if provided
4. Return the created card

### Updating a Card

1. Validate user has workspace access
2. Update card fields
3. Create appropriate activity records
4. Invalidate relevant queries

### Querying Cards

- Always filter by `isNull(cards.deletedAt)` in queries
- Include related data (labels, members, checklists) via Drizzle relations
- Order by `index` for proper card ordering

## Adding a New Feature

1. **Database**: Update schema in `packages/db/src/schema/`
2. **Migration**: Create migration with `cd packages/db && pnpm drizzle-kit generate --name "MigrationName"`, then run with `pnpm db:migrate`
3. **Repository**: Add repository functions in `packages/db/src/repository/`
4. **API**: Add tRPC router procedures in `packages/api/src/routers/`
5. **Frontend**: Add UI components in `apps/web/src/`
6. **i18n**: Add translations for new strings

## Database Changes

- Always create migrations (never modify existing migrations)
- Create migrations with: `cd packages/db && pnpm drizzle-kit generate --name "MigrationName"`
- Run migrations with: `pnpm db:migrate`
- Update schema files in `packages/db/src/schema/`
- Test migrations on development database first
- Update TypeScript types after schema changes
- Consider index management for card operations

## API Endpoints

- Use tRPC procedures (not REST)
- Add OpenAPI metadata for documentation
- Validate inputs with Zod
- Check workspace permissions
- Create activity records for significant changes

## Frontend Components

- Use Tailwind for styling
- Follow existing component patterns
- Use tRPC hooks for data fetching
- Implement optimistic updates where appropriate
- Add proper loading and error states

## Testing Instructions

- Test database operations in transactions that rollback
- Test authorization checks
- Test index management when moving/deleting cards
- Test activity logging
- Test UI interactions
- Run `pnpm lint` and `pnpm typecheck` before committing

## Performance Considerations

- Use database indexes appropriately
- Batch operations when possible
- Avoid N+1 queries
- Use transactions for related operations
- Implement optimistic updates in UI

## Security

- Always check workspace membership before operations
- Validate all inputs
- Never expose internal database IDs (`id`, `cardId`, `listId`, etc.) in API responses, URLs, or frontend code - always use `publicId` externally
- Sanitize user input

## Internationalization

- All user-facing strings must use `t` template literal
- Add translations to locale files in `apps/web/src/locales/`
- Run `pnpm lingui:extract` to update translation files
- Update locale files for all languages

## Dependencies

- Use workspace dependencies (`workspace:*`) for internal packages
- Keep dependencies up to date
- Use catalog for shared dependency versions

## When Implementing Features

### Adding New Card Fields

1. Update schema in `packages/db/src/schema/cards.ts`
2. Create migration
3. Update repository functions
4. Add API endpoints
5. Update frontend components
6. Add activity tracking if needed

### Adding New Activity Types

1. Add to `activityTypes` array in schema
2. Create migration to update enum
3. Use in activity creation code
4. Update activity display components if needed

## Git & Commits

- Use conventional commits: `feat:`, `fix:`, `refactor:`, `docs:`, etc.
- Keep commits focused on single changes
- Reference issue numbers when applicable

## PR Instructions

- Title format: `feat: description` or `fix: description`
- Always run `pnpm lint` and `pnpm typecheck` before committing
- Provide clear description of changes
- Include screenshots for UI changes
- Keep PRs focused on a single feature/fix



================================================
FILE: CHANGELOG.md
================================================
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased](https://github.com/kanbn/kan/compare/v0.2.4...HEAD)

## [0.2.4](https://github.com/kanbn/kan/compare/v0.2.3...v0.2.4) - 2025-01-14

### Added

- Button to view and update board public URL directly from board page
- Redirect from root to login page for self-hosted instances

### Changed

- Updated all label router endpoints to return consistent structure
- Added verbose error logging to magic link invitation process

### Fixed

- Updated tRPC dependencies and added OpenAPI meta to providers endpoint

## [0.2.3](https://github.com/kanbn/kan/compare/v0.2.2...v0.2.3) - 2025-07-07

### Added

- Mobile support with responsive navigation and layout
- Template selection when creating new boards with predefined lists and labels
- S3_FORCE_PATH_STYLE configuration for MinIO compatibility

### Changed

- Improved mobile UI styling and layout containers
- Enhanced iOS mobile support with viewport fixes and zoom prevention
- Improved card view layout for mobile devices

### Fixed

- Mobile dashboard min-width issues
- Dynamic viewport height on mobile devices
- Scroll functionality on card pages

## [0.2.2](https://github.com/kanbn/kan/compare/v0.2.1...v0.2.2) - 2025-06-28

### Added

- Localization and multi-language support
- URLs are now rendered as clickable links in card descriptions

### Changed

- Improved email configuration with optional SMTP authentication

## [0.2.1](https://github.com/kanbn/kan/compare/v0.2.0...v0.2.1) - 2025-06-19

### Added

- PostHog analytics integration
- Debug logging for email functionality
- Standalone mode support for Next.js
- Environment variable for configuring web port
- Docker Compose setup with PostgreSQL

### Changed

- SMTP authentication is now optional
- Added `SMTP_SECURE` configuration option
- Improved Docker build process with better context handling

### Fixed

- Default output mode for Next.js builds
- Container environment variable configuration
- Docker Compose volume naming
- Build context and static file copying in Docker
- Comment rendering inside contenteditable elements

## [0.2.0](https://github.com/kanbn/kan/compare/v0.1.0...v0.2.0) - 2025-06-10

### Added

- Trello integration with OAuth authentication and user field mapping
- Board visibility controls with dropdown menu and success notifications
- Markdown editor for card descriptions
- Email/password authentication for self-hosters
- Account deletion functionality with cascade delete for workspaces
- Enhanced scrollbar styles for dark mode

### Changed

- Simplified auth configuration to use `NEXT_PUBLIC_BASE_URL` instead of `BETTER_AUTH_URL`
- Updated self-hosting documentation
- Improved database schema with relation names

### Fixed

- List buttons stacking issue
- Editor onChange prop is now optional
- Renamed markdown prop to content in Editor component
- Router navigation for disabled signup redirects

## [0.1.0](https://github.com/kanbn/kan/releases/tag/v0.1.0) - 2025-06-02

### Added

- Initial release of Kan
- Core project management features
- Board, list, and card management
- User authentication system
- Workspace collaboration
- Comment system
- Activity logging
- Docker deployment support
- Self-hosting capabilities

### Changed

- Updated license link in footer



================================================
FILE: CONTRIBUTING.md
================================================
# Contributing to Kan

Thank you for your interest in contributing to Kan! This document provides guidelines and instructions for contributing to the project.

## Getting Started

1. Fork the repository
2. Clone your fork: `git clone https://github.com/YOUR-USERNAME/kan.git`
3. Create a new branch: `git checkout -b feat/your-feature-name`
4. Install dependencies: `pnpm install`
5. Copy `.env.example` to `.env` and configure your environment variables
6. Make your changes
7. Commit your changes: `git commit -m "feat: description of changes"`
8. Push to your fork: `git push origin feat/your-feature-name`
9. Open a Pull Request

## Development Guidelines

### Code Style

- Follow the existing code style
- Use meaningful variable and function names
- Add comments for complex logic
- Keep functions focused and concise

### Commits

- Use clear and descriptive commit messages
- Reference issue numbers when applicable
- Keep commits focused on single changes

### Pull Requests

- Provide a clear description of the changes
- Include screenshots for UI changes
- Keep PRs focused on a single feature/fix

## Need Help?

- Join our [Discord server](https://discord.gg/e6ejRb6CmT) for questions
- Check existing issues and pull requests
- Email [henry@kan.bn](mailto:henry@kan.bn) for major concerns

## Code of Conduct

Please note that this project is released with a Contributor Code of Conduct. By participating in this project you agree to abide by its terms.

We aim to foster an inclusive and welcoming community. Harassment and abusive behavior will not be tolerated.

## License

By contributing to Kan, you agree that your contributions will be licensed under the AGPLv3 License.



================================================
FILE: docker-compose.yml
================================================
services:
  migrate:
    image: ghcr.io/kanbn/kan-migrate:latest
    container_name: ${CONTAINER_NAME:-kan-migrate}
    networks:
      - kan-network
    build:
      context: .
      dockerfile: ./apps/web/Dockerfile
      target: migrate
    environment:
      - POSTGRES_URL=${POSTGRES_URL}
    depends_on:
      postgres:
        condition: service_healthy
    restart: "no"

  web:
    image: ghcr.io/kanbn/kan:latest
    container_name: ${CONTAINER_NAME:-kan-web}
    ports:
      - "${WEB_PORT:-3000}:3000"
    networks:
      - kan-network
    build:
      context: .
      dockerfile: ./apps/web/Dockerfile
      target: web
    env_file:
      - .env
    environment:
      # Required environment variables
      - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL}
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET}
      - POSTGRES_URL=${POSTGRES_URL}

      # Redis (optional - for rate limiting)
      - REDIS_URL=${REDIS_URL}

      # Admin API key (optional)
      - KAN_ADMIN_API_KEY=${KAN_ADMIN_API_KEY}

      # SMTP (optional)
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - EMAIL_FROM=${EMAIL_FROM}
      - SMTP_REJECT_UNAUTHORIZED=${SMTP_REJECT_UNAUTHORIZED}

      # Disable email features entirely (optional)
      - NEXT_PUBLIC_DISABLE_EMAIL=${NEXT_PUBLIC_DISABLE_EMAIL}

      # S3 storage (optional)
      - S3_ACCESS_KEY_ID=${S3_ACCESS_KEY_ID}
      - S3_SECRET_ACCESS_KEY=${S3_SECRET_ACCESS_KEY}
      - S3_REGION=${S3_REGION}
      - S3_ENDPOINT=${S3_ENDPOINT}
      - S3_FORCE_PATH_STYLE=${S3_FORCE_PATH_STYLE}
      - NEXT_PUBLIC_STORAGE_URL=${NEXT_PUBLIC_STORAGE_URL}
      - NEXT_PUBLIC_AVATAR_BUCKET_NAME=${NEXT_PUBLIC_AVATAR_BUCKET_NAME}
      - NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME=${NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME}
      - NEXT_PUBLIC_STORAGE_DOMAIN=${NEXT_PUBLIC_STORAGE_DOMAIN}
      - NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS=${NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS}

      # White label
      - NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY=${NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY}

      # Auth config (optional)
      - NEXT_PUBLIC_ALLOW_CREDENTIALS=${NEXT_PUBLIC_ALLOW_CREDENTIALS}
      - NEXT_PUBLIC_DISABLE_SIGN_UP=${NEXT_PUBLIC_DISABLE_SIGN_UP}

      # API configuration (optional)
      - NEXT_API_BODY_SIZE_LIMIT=${NEXT_API_BODY_SIZE_LIMIT}

      # Integration providers (optional)
      - TRELLO_APP_API_KEY=${TRELLO_APP_API_KEY}
      - TRELLO_APP_SECRET=${TRELLO_APP_SECRET}

      # Generic OIDC provider (optional)
      - OIDC_CLIENT_ID=${OIDC_CLIENT_ID}
      - OIDC_CLIENT_SECRET=${OIDC_CLIENT_SECRET}
      - OIDC_DISCOVERY_URL=${OIDC_DISCOVERY_URL}

      # OAuth providers (optional)
      - BETTER_AUTH_TRUSTED_ORIGINS=${BETTER_AUTH_TRUSTED_ORIGINS}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - BETTER_AUTH_ALLOWED_DOMAINS=${BETTER_AUTH_ALLOWED_DOMAINS}
      - DISCORD_CLIENT_ID=${DISCORD_CLIENT_ID}
      - DISCORD_CLIENT_SECRET=${DISCORD_CLIENT_SECRET}
      - GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
      - GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
      - GITLAB_CLIENT_ID=${GITLAB_CLIENT_ID}
      - GITLAB_CLIENT_SECRET=${GITLAB_CLIENT_SECRET}
      - GITLAB_ISSUER=${GITLAB_ISSUER}
      - MICROSOFT_CLIENT_ID=${MICROSOFT_CLIENT_ID}
      - MICROSOFT_CLIENT_SECRET=${MICROSOFT_CLIENT_SECRET}
      - TWITTER_CLIENT_ID=${TWITTER_CLIENT_ID}
      - TWITTER_CLIENT_SECRET=${TWITTER_CLIENT_SECRET}
      - KICK_CLIENT_ID=${KICK_CLIENT_ID}
      - KICK_CLIENT_SECRET=${KICK_CLIENT_SECRET}
      - ZOOM_CLIENT_ID=${ZOOM_CLIENT_ID}
      - ZOOM_CLIENT_SECRET=${ZOOM_CLIENT_SECRET}
      - DROPBOX_CLIENT_ID=${DROPBOX_CLIENT_ID}
      - DROPBOX_CLIENT_SECRET=${DROPBOX_CLIENT_SECRET}
      - VK_CLIENT_ID=${VK_CLIENT_ID}
      - VK_CLIENT_SECRET=${VK_CLIENT_SECRET}
      - LINKEDIN_CLIENT_ID=${LINKEDIN_CLIENT_ID}
      - LINKEDIN_CLIENT_SECRET=${LINKEDIN_CLIENT_SECRET}
      - REDDIT_CLIENT_ID=${REDDIT_CLIENT_ID}
      - REDDIT_CLIENT_SECRET=${REDDIT_CLIENT_SECRET}
      - ROBLOX_CLIENT_ID=${ROBLOX_CLIENT_ID}
      - ROBLOX_CLIENT_SECRET=${ROBLOX_CLIENT_SECRET}
      - SPOTIFY_CLIENT_ID=${SPOTIFY_CLIENT_ID}
      - SPOTIFY_CLIENT_SECRET=${SPOTIFY_CLIENT_SECRET}
      - TIKTOK_CLIENT_ID=${TIKTOK_CLIENT_ID}
      - TIKTOK_CLIENT_SECRET=${TIKTOK_CLIENT_SECRET}
      - TIKTOK_CLIENT_KEY=${TIKTOK_CLIENT_KEY}
      - TWITCH_CLIENT_ID=${TWITCH_CLIENT_ID}
      - TWITCH_CLIENT_SECRET=${TWITCH_CLIENT_SECRET}
      - APPLE_CLIENT_ID=${APPLE_CLIENT_ID}
      - APPLE_CLIENT_SECRET=${APPLE_CLIENT_SECRET}
      - APPLE_APP_BUNDLE_IDENTIFIER=${APPLE_APP_BUNDLE_IDENTIFIER}
    depends_on:
      migrate:
        condition: service_completed_successfully
    restart: unless-stopped

  postgres:
    image: postgres:15
    container_name: kan-db
    environment:
      - POSTGRES_DB=kan_db
      - POSTGRES_USER=kan
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    ports:
      - 5432:5432
    volumes:
      - kan_postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U kan -d kan_db"]
      interval: 5s
      timeout: 5s
      retries: 10
    restart: unless-stopped
    networks:
      - kan-network

networks:
  kan-network:

volumes:
  kan_postgres_data:



================================================
FILE: LICENSE
================================================
                    GNU AFFERO GENERAL PUBLIC LICENSE
                       Version 3, 19 November 2007

 Copyright (C) 2007 Free Software Foundation, Inc. <https://fsf.org/>
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.

                            Preamble

  The GNU Affero General Public License is a free, copyleft license for
software and other kinds of works, specifically designed to ensure
cooperation with the community in the case of network server software.

  The licenses for most software and other practical works are designed
to take away your freedom to share and change the works.  By contrast,
our General Public Licenses are intended to guarantee your freedom to
share and change all versions of a program--to make sure it remains free
software for all its users.

  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.

  Developers that use our General Public Licenses protect your rights
with two steps: (1) assert copyright on the software, and (2) offer
you this License which gives you legal permission to copy, distribute
and/or modify the software.

  A secondary benefit of defending all users' freedom is that
improvements made in alternate versions of the program, if they
receive widespread use, become available for other developers to
incorporate.  Many developers of free software are heartened and
encouraged by the resulting cooperation.  However, in the case of
software used on network servers, this result may fail to come about.
The GNU General Public License permits making a modified version and
letting the public access it on a server without ever releasing its
source code to the public.

  The GNU Affero General Public License is designed specifically to
ensure that, in such cases, the modified source code becomes available
to the community.  It requires the operator of a network server to
provide the source code of the modified version running there to the
users of that server.  Therefore, public use of a modified version, on
a publicly accessible server, gives the public access to the source
code of the modified version.

  An older license, called the Affero General Public License and
published by Affero, was designed to accomplish similar goals.  This is
a different license, not a version of the Affero GPL, but Affero has
released a new version of the Affero GPL which permits relicensing under
this license.

  The precise terms and conditions for copying, distribution and
modification follow.

                       TERMS AND CONDITIONS

  0. Definitions.

  "This License" refers to version 3 of the GNU Affero General Public License.

  "Copyright" also means copyright-like laws that apply to other kinds of
works, such as semiconductor masks.

  "The Program" refers to any copyrightable work licensed under this
License.  Each licensee is addressed as "you".  "Licensees" and
"recipients" may be individuals or organizations.

  To "modify" a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of an
exact copy.  The resulting work is called a "modified version" of the
earlier work or a work "based on" the earlier work.

  A "covered work" means either the unmodified Program or a work based
on the Program.

  To "propagate" a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy.  Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.

  To "convey" a work means any kind of propagation that enables other
parties to make or receive copies.  Mere interaction with a user through
a computer network, with no transfer of a copy, is not conveying.

  An interactive user interface displays "Appropriate Legal Notices"
to the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License.  If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.

  1. Source Code.

  The "source code" for a work means the preferred form of the work
for making modifications to it.  "Object code" means any non-source
form of a work.

  A "Standard Interface" means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.

  The "System Libraries" of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form.  A
"Major Component", in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.

  The "Corresponding Source" for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities.  However, it does not include the work's
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work.  For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.

  The Corresponding Source need not include anything that users
can regenerate automatically from other parts of the Corresponding
Source.

  The Corresponding Source for a work in source code form is that
same work.

  2. Basic Permissions.

  All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met.  This License explicitly affirms your unlimited
permission to run the unmodified Program.  The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work.  This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.

  You may make, run and propagate covered works that you do not
convey, without conditions so long as your license otherwise remains
in force.  You may convey covered works to others for the sole purpose
of having them make modifications exclusively for you, or provide you
with facilities for running those works, provided that you comply with
the terms of this License in conveying all material for which you do
not control copyright.  Those thus making or running the covered works
for you must do so exclusively on your behalf, under your direction
and control, on terms that prohibit them from making any copies of
your copyrighted material outside their relationship with you.

  Conveying under any other circumstances is permitted solely under
the conditions stated below.  Sublicensing is not allowed; section 10
makes it unnecessary.

  3. Protecting Users' Legal Rights From Anti-Circumvention Law.

  No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.

  When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such circumvention
is effected by exercising rights under this License with respect to
the covered work, and you disclaim any intention to limit operation or
modification of the work as a means of enforcing, against the work's
users, your or third parties' legal rights to forbid circumvention of
technological measures.

  4. Conveying Verbatim Copies.

  You may convey verbatim copies of the Program's source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.

  You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.

  5. Conveying Modified Source Versions.

  You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these conditions:

    a) The work must carry prominent notices stating that you modified
    it, and giving a relevant date.

    b) The work must carry prominent notices stating that it is
    released under this License and any conditions added under section
    7.  This requirement modifies the requirement in section 4 to
    "keep intact all notices".

    c) You must license the entire work, as a whole, under this
    License to anyone who comes into possession of a copy.  This
    License will therefore apply, along with any applicable section 7
    additional terms, to the whole of the work, and all its parts,
    regardless of how they are packaged.  This License gives no
    permission to license the work in any other way, but it does not
    invalidate such permission if you have separately received it.

    d) If the work has interactive user interfaces, each must display
    Appropriate Legal Notices; however, if the Program has interactive
    interfaces that do not display Appropriate Legal Notices, your
    work need not make them do so.

  A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
"aggregate" if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation's users
beyond what the individual works permit.  Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.

  6. Conveying Non-Source Forms.

  You may convey a covered work in object code form under the terms
of sections 4 and 5, provided that you also convey the
machine-readable Corresponding Source under the terms of this License,
in one of these ways:

    a) Convey the object code in, or embodied in, a physical product
    (including a physical distribution medium), accompanied by the
    Corresponding Source fixed on a durable physical medium
    customarily used for software interchange.

    b) Convey the object code in, or embodied in, a physical product
    (including a physical distribution medium), accompanied by a
    written offer, valid for at least three years and valid for as
    long as you offer spare parts or customer support for that product
    model, to give anyone who possesses the object code either (1) a
    copy of the Corresponding Source for all the software in the
    product that is covered by this License, on a durable physical
    medium customarily used for software interchange, for a price no
    more than your reasonable cost of physically performing this
    conveying of source, or (2) access to copy the
    Corresponding Source from a network server at no charge.

    c) Convey individual copies of the object code with a copy of the
    written offer to provide the Corresponding Source.  This
    alternative is allowed only occasionally and noncommercially, and
    only if you received the object code with such an offer, in accord
    with subsection 6b.

    d) Convey the object code by offering access from a designated
    place (gratis or for a charge), and offer equivalent access to the
    Corresponding Source in the same way through the same place at no
    further charge.  You need not require recipients to copy the
    Corresponding Source along with the object code.  If the place to
    copy the object code is a network server, the Corresponding Source
    may be on a different server (operated by you or a third party)
    that supports equivalent copying facilities, provided you maintain
    clear directions next to the object code saying where to find the
    Corresponding Source.  Regardless of what server hosts the
    Corresponding Source, you remain obligated to ensure that it is
    available for as long as needed to satisfy these requirements.

    e) Convey the object code using peer-to-peer transmission, provided
    you inform other peers where the object code and Corresponding
    Source of the work are being offered to the general public at no
    charge under subsection 6d.

  A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.

  A "User Product" is either (1) a "consumer product", which means any
tangible personal property which is normally used for personal, family,
or household purposes, or (2) anything designed or sold for incorporation
into a dwelling.  In determining whether a product is a consumer product,
doubtful cases shall be resolved in favor of coverage.  For a particular
product received by a particular user, "normally used" refers to a
typical or common use of that class of product, regardless of the status
of the particular user or of the way in which the particular user
actually uses, or expects or is expected to use, the product.  A product
is a consumer product regardless of whether the product has substantial
commercial, industrial or non-consumer uses, unless such uses represent
the only significant mode of use of the product.

  "Installation Information" for a User Product means any methods,
procedures, authorization keys, or other information required to install
and execute modified versions of a covered work in that User Product from
a modified version of its Corresponding Source.  The information must
suffice to ensure that the continued functioning of the modified object
code is in no case prevented or interfered with solely because
modification has been made.

  If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information.  But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).

  The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or updates
for a work that has been modified or installed by the recipient, or for
the User Product in which it has been modified or installed.  Access to a
network may be denied when the modification itself materially and
adversely affects the operation of the network or violates the rules and
protocols for communication across the network.

  Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.

  7. Additional Terms.

  "Additional permissions" are terms that supplement the terms of this
License by making exceptions from one or more of its conditions.
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law.  If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.

  When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.)  You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.

  Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders of
that material) supplement the terms of this License with terms:

    a) Disclaiming warranty or limiting liability differently from the
    terms of sections 15 and 16 of this License; or

    b) Requiring preservation of specified reasonable legal notices or
    author attributions in that material or in the Appropriate Legal
    Notices displayed by works containing it; or

    c) Prohibiting misrepresentation of the origin of that material, or
    requiring that modified versions of such material be marked in
    reasonable ways as different from the original version; or

    d) Limiting the use for publicity purposes of names of licensors or
    authors of the material; or

    e) Declining to grant rights under trademark law for use of some
    trade names, trademarks, or service marks; or

    f) Requiring indemnification of licensors and authors of that
    material by anyone who conveys the material (or modified versions of
    it) with contractual assumptions of liability to the recipient, for
    any liability that these contractual assumptions directly impose on
    those licensors and authors.

  All other non-permissive additional terms are considered "further
restrictions" within the meaning of section 10.  If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term.  If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.

  If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.

  Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions;
the above requirements apply either way.

  8. Termination.

  You may not propagate or modify a covered work except as expressly
provided under this License.  Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).

  However, if you cease all violation of this License, then your
license from a particular copyright holder is reinstated (a)
provisionally, unless and until the copyright holder explicitly and
finally terminates your license, and (b) permanently, if the copyright
holder fails to notify you of the violation by some reasonable means
prior to 60 days after the cessation.

  Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

  Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.

  9. Acceptance Not Required for Having Copies.

  You are not required to accept this License in order to receive or
run a copy of the Program.  Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance.  However,
nothing other than this License grants you permission to propagate or
modify any covered work.  These actions infringe copyright if you do
not accept this License.  Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.

  10. Automatic Licensing of Downstream Recipients.

  Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License.  You are not responsible
for enforcing compliance by third parties with this License.

  An "entity transaction" is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations.  If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party's predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.

  You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License.  For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.

  11. Patents.

  A "contributor" is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based.  The
work thus licensed is called the contributor's "contributor version".

  A contributor's "essential patent claims" are all patent claims
owned or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version.  For
purposes of this definition, "control" includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.

  Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor's essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.

  In the following three paragraphs, a "patent license" is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement).  To "grant" such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.

  If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients.  "Knowingly relying" means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient's use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.

  If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.

  A patent license is "discriminatory" if it does not include within
the scope of its coverage, prohibits the exercise of, or is
conditioned on the non-exercise of one or more of the rights that are
specifically granted under this License.  You may not convey a covered
work if you are a party to an arrangement with a third party that is
in the business of distributing software, under which you make payment
to the third party based on the extent of your activity of conveying
the work, and under which the third party grants, to any of the
parties who would receive the covered work from you, a discriminatory
patent license (a) in connection with copies of the covered work
conveyed by you (or copies made from those copies), or (b) primarily
for and in connection with specific products or compilations that
contain the covered work, unless you entered into that arrangement,
or that patent license was granted, prior to 28 March 2007.

  Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.

  12. No Surrender of Others' Freedom.

  If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot convey a
covered work so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you may
not convey it at all.  For example, if you agree to terms that obligate you
to collect a royalty for further conveying from those to whom you convey
the Program, the only way you could satisfy both those terms and this
License would be to refrain entirely from conveying the Program.

  13. Remote Network Interaction; Use with the GNU General Public License.

  Notwithstanding any other provision of this License, if you modify the
Program, your modified version must prominently offer all users
interacting with it remotely through a computer network (if your version
supports such interaction) an opportunity to receive the Corresponding
Source of your version by providing access to the Corresponding Source
from a network server at no charge, through some standard or customary
means of facilitating copying of software.  This Corresponding Source
shall include the Corresponding Source for any work covered by version 3
of the GNU General Public License that is incorporated pursuant to the
following paragraph.

  Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU General Public License into a single
combined work, and to convey the resulting work.  The terms of this
License will continue to apply to the part which is the covered work,
but the work with which it is combined will remain governed by version
3 of the GNU General Public License.

  14. Revised Versions of this License.

  The Free Software Foundation may publish revised and/or new versions of
the GNU Affero General Public License from time to time.  Such new versions
will be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

  Each version is given a distinguishing version number.  If the
Program specifies that a certain numbered version of the GNU Affero General
Public License "or any later version" applies to it, you have the
option of following the terms and conditions either of that numbered
version or of any later version published by the Free Software
Foundation.  If the Program does not specify a version number of the
GNU Affero General Public License, you may choose any version ever published
by the Free Software Foundation.

  If the Program specifies that a proxy can decide which future
versions of the GNU Affero General Public License can be used, that proxy's
public statement of acceptance of a version permanently authorizes you
to choose that version for the Program.

  Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.

  15. Disclaimer of Warranty.

  THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
ALL NECESSARY SERVICING, REPAIR OR CORRECTION.

  16. Limitation of Liability.

  IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
SUCH DAMAGES.

  17. Interpretation of Sections 15 and 16.

  If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.

                     END OF TERMS AND CONDITIONS

            How to Apply These Terms to Your New Programs

  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.

  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
state the exclusion of warranty; and each file should have at least
the "copyright" line and a pointer to where the full notice is found.

    <one line to give the program's name and a brief idea of what it does.>
    Copyright (C) <year>  <name of author>

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published
    by the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

Also add information on how to contact you by electronic and paper mail.

  If your software can interact with users remotely through a computer
network, you should also make sure that it provides a way for users to
get its source.  For example, if your program is a web application, its
interface could display a "Source" link that leads users to an archive
of the code.  There are many ways you could offer source, and different
solutions will be better for different programs; see section 13 for the
specific requirements.

  You should also get your employer (if you work as a programmer) or school,
if any, to sign a "copyright disclaimer" for the program, if necessary.
For more information on this, and how to apply and follow the GNU AGPL, see
<https://www.gnu.org/licenses/>.



================================================
FILE: package.json
================================================
{
  "name": "kan",
  "private": true,
  "engines": {
    "node": ">=20.18.1",
    "pnpm": "^9.14.2"
  },
  "packageManager": "pnpm@9.14.2",
  "scripts": {
    "build": "turbo run build",
    "clean": "git clean -xdf node_modules",
    "clean:workspaces": "turbo run clean",
    "db:migrate": "cd packages/db && pnpm migrate",
    "db:push": "turbo -F @kan/db push",
    "db:studio": "turbo -F @kan/db studio",
    "dev": "turbo watch dev --continue",
    "dev:next": "turbo watch dev -F @kan/web...",
    "format": "turbo run format --continue -- --cache --cache-location .cache/.prettiercache",
    "format:fix": "turbo run format --continue -- --write --cache --cache-location .cache/.prettiercache",
    "lint": "turbo run lint --continue -- --cache --cache-location .cache/.eslintcache",
    "lint:fix": "turbo run lint --continue -- --fix --cache --cache-location .cache/.eslintcache",
    "lint:ws": "pnpm dlx sherif@latest",
    "postinstall": "pnpm lint:ws",
    "typecheck": "turbo run typecheck",
    "ui-add": "turbo run ui-add"
  },
  "devDependencies": {
    "@kan/prettier-config": "workspace:*",
    "@turbo/gen": "^2.3.1",
    "prettier": "catalog:",
    "turbo": "^2.3.1",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config",
  "pnpm": {
    "overrides": {
      "@types/minimatch": "npm:minimatch@*",
      "@types/glob": "npm:@types/glob@^8.1.0"
    }
  }
}



================================================
FILE: pnpm-workspace.yaml
================================================
packages:
  - apps/*
  - packages/*
  - tooling/*

catalog:
  "@tanstack/react-query": ^5.59.15
  "@trpc/client": ^11.4.3
  "@trpc/react-query": ^11.4.3
  "@trpc/server": ^11.4.3
  eslint: ^9.12.0
  prettier: ^3.3.3
  tailwindcss: ^3.4.14
  typescript: ^5.6.3
  zod: ^3.23.8

catalogs:
  react18:
    react: 18.3.1
    react-dom: 18.3.1
    "@types/react": ^18.3.11
    "@types/react-dom": ^18.3.1



================================================
FILE: turbo.json
================================================
{
  "$schema": "https://turborepo.org/schema.json",
  "ui": "tui",
  "tasks": {
    "topo": {
      "dependsOn": ["^topo"]
    },
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".cache/tsbuildinfo.json", "dist/**"]
    },
    "dev": {
      "dependsOn": ["^dev"],
      "cache": false,
      "persistent": false
    },
    "format": {
      "outputs": [".cache/.prettiercache"],
      "outputLogs": "new-only"
    },
    "lint": {
      "dependsOn": ["^topo", "^build"],
      "outputs": [".cache/.eslintcache"]
    },
    "typecheck": {
      "dependsOn": ["^topo", "^build"],
      "outputs": [".cache/tsbuildinfo.json"]
    },
    "clean": {
      "cache": false
    },
    "//#clean": {
      "cache": false
    },
    "push": {
      "cache": false,
      "interactive": true
    },
    "studio": {
      "cache": false,
      "persistent": true
    },
    "ui-add": {
      "cache": false,
      "interactive": true
    }
  },
  "globalEnv": [
    "KAN_ADMIN_API_KEY",
    "POSTGRES_URL",
    "TRELLO_APP_API_KEY",
    "TRELLO_APP_SECRET",
    "GOOGLE_CLIENT_ID",
    "GOOGLE_CLIENT_SECRET",
    "BETTER_AUTH_ALLOWED_DOMAINS",
    "DISCORD_CLIENT_ID",
    "DISCORD_CLIENT_SECRET",
    "GITHUB_CLIENT_ID",
    "GITHUB_CLIENT_SECRET",
    "GITLAB_CLIENT_ID",
    "GITLAB_CLIENT_SECRET",
    "GITLAB_ISSUER",
    "MICROSOFT_CLIENT_ID",
    "MICROSOFT_CLIENT_SECRET",
    "TWITTER_CLIENT_ID",
    "TWITTER_CLIENT_SECRET",
    "KICK_CLIENT_ID",
    "KICK_CLIENT_SECRET",
    "ZOOM_CLIENT_ID",
    "ZOOM_CLIENT_SECRET",
    "DROPBOX_CLIENT_ID",
    "DROPBOX_CLIENT_SECRET",
    "VK_CLIENT_ID",
    "VK_CLIENT_SECRET",
    "LINKEDIN_CLIENT_ID",
    "LINKEDIN_CLIENT_SECRET",
    "OIDC_CLIENT_ID",
    "OIDC_CLIENT_SECRET",
    "OIDC_DISCOVERY_URL",
    "REDDIT_CLIENT_ID",
    "REDDIT_CLIENT_SECRET",
    "ROBLOX_CLIENT_ID",
    "ROBLOX_CLIENT_SECRET",
    "SPOTIFY_CLIENT_ID",
    "SPOTIFY_CLIENT_SECRET",
    "TIKTOK_CLIENT_ID",
    "TIKTOK_CLIENT_SECRET",
    "TIKTOK_CLIENT_KEY",
    "TWITCH_CLIENT_ID",
    "TWITCH_CLIENT_SECRET",
    "APPLE_CLIENT_ID",
    "APPLE_CLIENT_SECRET",
    "APPLE_APP_BUNDLE_IDENTIFIER",
    "NEXT_PUBLIC_DISABLE_EMAIL",
    "EMAIL_FROM",
    "SMTP_HOST",
    "SMTP_PORT",
    "SMTP_USER",
    "SMTP_PASSWORD",
    "SMTP_SECURE",
    "SMTP_REJECT_UNAUTHORIZED",
    "NEXT_PUBLIC_KAN_ENV",
    "NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY",
    "STRIPE_SECRET_KEY",
    "DISCORD_WEBHOOK_URL",
    "STRIPE_WEBHOOK_SECRET",
    "STRIPE_WEBHOOK_SECRET_LEGACY",
    "STRIPE_PRO_PLAN_MONTHLY_PRICE_ID",
    "STRIPE_PRO_PLAN_YEARLY_PRICE_ID",
    "STRIPE_TEAM_PLAN_MONTHLY_PRICE_ID",
    "STRIPE_TEAM_PLAN_YEARLY_PRICE_ID",
    "NEXT_PUBLIC_STORAGE_DOMAIN",
    "NEXT_PUBLIC_STORAGE_URL",
    "NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS",
    "NEXT_PUBLIC_AVATAR_BUCKET_NAME",
    "NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME",
    "NEXT_PUBLIC_ALLOW_CREDENTIALS",
    "NEXT_API_BODY_SIZE_LIMIT",
    "NEXT_PUBLIC_DISABLE_SIGN_UP",
    "NEXT_PUBLIC_USE_STANDALONE_OUTPUT",
    "S3_REGION",
    "S3_ACCESS_KEY_ID",
    "S3_SECRET_ACCESS_KEY",
    "S3_ENDPOINT",
    "S3_FORCE_PATH_STYLE",
    "PORT",
    "BETTER_AUTH_SECRET",
    "BETTER_AUTH_TRUSTED_ORIGINS",
    "NOVU_API_KEY",
    "EMAIL_UNSUBSCRIBE_SECRET",
    "REDIS_URL"
  ],
  "globalPassThroughEnv": [
    "NODE_ENV",
    "CI",
    "VERCEL",
    "VERCEL_ENV",
    "VERCEL_URL",
    "npm_lifecycle_event"
  ]
}



================================================
FILE: .dockerignore
================================================
# Environment
.env
.env.*
!.env.example

# Docker
docker-compose*.yml
.dockerignore

# Dependencies (rebuilt in Docker)
node_modules
**/node_modules

# Build outputs (rebuilt in Docker)
**/.next
**/dist
**/out
**/.turbo
**/.cache

# Git
.git
.gitignore
.gitattributes

# IDE
.vscode
.idea
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# CI/CD
.github
.husky
.changeset

# Documentation (not needed in build)
*.md
!packages/db/migrations/**
LICENSE
CONTRIBUTING.md
AGENTS.md
CHANGELOG.md

# Test files
**/*.test.ts
**/*.test.tsx
**/*.spec.ts
**/*.spec.tsx
**/__tests__
**/coverage

# Logs
pnpm-debug.log
**/pnpm-debug.log

# Cloud compose (separate deployment)
cloud/



================================================
FILE: .env.example
================================================
# https://github.com/kanbn/kan?tab=readme-ov-file#environment-variables-)

# Required environment variables
NEXT_PUBLIC_BASE_URL= # e.g. https://kan.bn
BETTER_AUTH_SECRET= # Random 32+ char string (can gen with: openssl rand -base64 24 | tr -dc 'a-zA-Z0-9' | head -c 32)

# Fill if you want to use an external database
POSTGRES_URL= # e.g. postgresql://kan:your_password@your_host:5432/kan

# Only required if deploying from compose
POSTGRES_PASSWORD=

# SMTP (optional)
SMTP_HOST=
SMTP_PORT=465
SMTP_USER=
SMTP_PASSWORD=
EMAIL_FROM= # e.g. "Kan <hello@mail.kan.bn>"
SMTP_SECURE= # set to "false" to use port 587
SMTP_REJECT_UNAUTHORIZED= # set to "false" to accept invalid certs

# Switch email features off entirely (optional)
NEXT_PUBLIC_DISABLE_EMAIL=

# S3 storage (optional)
S3_REGION=
S3_ENDPOINT=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_FORCE_PATH_STYLE=
NEXT_PUBLIC_STORAGE_URL=
NEXT_PUBLIC_AVATAR_BUCKET_NAME=
NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME=
NEXT_PUBLIC_STORAGE_DOMAIN=
NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS=

# Auth config (optional)
NEXT_PUBLIC_ALLOW_CREDENTIALS=
NEXT_PUBLIC_DISABLE_SIGN_UP=

# API configuration (optional)
NEXT_API_BODY_SIZE_LIMIT= # e.g. 50mb (defaults to 1mb)

# Integration providers (optional)
TRELLO_APP_API_KEY=
TRELLO_APP_SECRET=

# Redis (optional - for rate limiting)
# If not provided, rate limiting will use in-memory storage
REDIS_URL= # e.g. redis://default:your_password@your_host:6379

# OAuth providers (optional)
BETTER_AUTH_TRUSTED_ORIGINS=
# Optional: Restrict OIDC/Social sign-ins to specific email domains (comma-separated)
BETTER_AUTH_ALLOWED_DOMAINS=
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
DISCORD_CLIENT_ID=
DISCORD_CLIENT_SECRET=
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
GITLAB_CLIENT_ID=
GITLAB_CLIENT_SECRET=
GITLAB_ISSUER=
MICROSOFT_CLIENT_ID=
MICROSOFT_CLIENT_SECRET=
TWITTER_CLIENT_ID=
TWITTER_CLIENT_SECRET=
KICK_CLIENT_ID=
KICK_CLIENT_SECRET=
ZOOM_CLIENT_ID=
ZOOM_CLIENT_SECRET=
DROPBOX_CLIENT_ID=
DROPBOX_CLIENT_SECRET=
VK_CLIENT_ID=
VK_CLIENT_SECRET=
LINKEDIN_CLIENT_ID=
LINKEDIN_CLIENT_SECRET=
REDDIT_CLIENT_ID=
REDDIT_CLIENT_SECRET=
ROBLOX_CLIENT_ID=
ROBLOX_CLIENT_SECRET=
SPOTIFY_CLIENT_ID=
SPOTIFY_CLIENT_SECRET=
TIKTOK_CLIENT_ID=
TIKTOK_CLIENT_SECRET=
TIKTOK_CLIENT_KEY=
TWITCH_CLIENT_ID=
TWITCH_CLIENT_SECRET=
APPLE_CLIENT_ID=
APPLE_CLIENT_SECRET=
APPLE_APP_BUNDLE_IDENTIFIER=



================================================
FILE: .npmrc
================================================
node-linker=hoisted
link-workspace-packages=true
shamefully-hoist=true
hoist=true


================================================
FILE: .nvmrc
================================================
20.18


================================================
FILE: apps/docs/README.md
================================================
# Mintlify Starter Kit

Click on `Use this template` to copy the Mintlify starter kit. The starter kit contains examples including

- Guide pages
- Navigation
- Customizations
- API Reference pages
- Use of popular components

### Development

Install the [Mintlify CLI](https://www.npmjs.com/package/mintlify) to preview the documentation changes locally. To install, use the following command

```
npm i -g mintlify
```

Run the following command at the root of your documentation (where mint.json is)

```
mintlify dev
```

### Publishing Changes

Install our Github App to auto propagate changes from your repo to your deployment. Changes will be deployed to production automatically after pushing to the default branch. Find the link to install on your dashboard.

#### Troubleshooting

- Mintlify dev isn't running - Run `mintlify install` it'll re-install dependencies.
- Page loads as a 404 - Make sure you are running in a folder with `mint.json`

#BUMP



================================================
FILE: apps/docs/introduction.mdx
================================================
---
title: Introduction
description: "Kan is the open source alternative to Trello."
---

<Frame>
  <img
    className="block rounded-lg border border-gray-200 dark:hidden"
    src="/images/hero-light.png"
    alt="Hero Light"
  />
  <img
    className="hidden rounded-lg dark:block"
    src="/images/hero-dark.png"
    alt="Hero Dark"
  />
</Frame>

## Getting Started

Get started with Kan by choosing your preferred deployment option below.

<CardGroup cols={2}>
  <Card title="Cloud" icon="cloud" href="https://kan.bn/signup">
    Get started instantly with our hosted solution - we'll handle all the
    hosting, scaling, and maintenance for you.
  </Card>
  <Card
    title="Self-host"
    icon="code"
    href="https://github.com/kanbn/kan?tab=readme-ov-file#self-hosting-"
  >
    For full data ownership and control, you can self-host Kan on your
    infrastructure.
  </Card>
</CardGroup>



================================================
FILE: apps/docs/mint.json
================================================
{
  "$schema": "https://mintlify.com/schema.json",
  "name": "kan.bn",
  "logo": {
    "dark": "/logo/dark.svg",
    "light": "/logo/light.svg",
    "href": "https://kan.bn"
  },
  "favicon": "./favicon.png",
  "colors": {
    "primary": "#000000",
    "light": "#EDEDED",
    "dark": "#161616",
    "anchors": {
      "from": "#000000",
      "to": "#161616"
    }
  },
  "topbarLinks": [
    {
      "name": "Sign in",
      "url": "https://kan.bn/login"
    }
  ],
  "topbarCtaButton": {
    "name": "Go to app",
    "url": "https://kan.bn/boards"
  },
  "anchors": [
    {
      "name": "API Reference",
      "openapi": "https://kan.bn/api/v1/openapi.json",
      "url": "api-reference",
      "icon": "square-terminal"
    },
    {
      "name": "GitHub",
      "icon": "github",
      "url": "https://github.com/kanbn"
    }
  ],
  "navigation": [
    {
      "group": "Get Started",
      "pages": ["introduction"]
    },
    {
      "group": "Guides",
      "pages": [
        {
          "group": "Self-Hosting",
          "pages": [
            "guides/self-hosting/introduction",
            "guides/self-hosting/s3"
          ]
        }
      ]
    },
    {
      "group": "Import",
      "pages": ["imports/trello"]
    },
    {
      "group": "API Documentation",
      "pages": ["api-reference/introduction"]
    }
  ],
  "footerSocials": {
    "discord": "https://discord.gg/e6ejRb6CmT",
    "github": "https://github.com/kanbn"
  }
}



================================================
FILE: apps/docs/package.json
================================================
{
  "name": "@kan/docs",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "build": "pnpm with-env mint build",
    "clean": "git clean -xdf .cache .turbo node_modules",
    "dev": "pnpm with-env mintlify dev --port 3001",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "typecheck": "tsc --noEmit",
    "with-env": "dotenv -e ../../.env --"
  },
  "dependencies": {
    "mintlify": "^3.0.0"
  },
  "prettier": "@kan/prettier-config"
}



================================================
FILE: apps/docs/api-reference/introduction.mdx
================================================
---
title: "Introduction"
description: "Learn how to integrate with Kan's REST API."
---

## Base URL

```
https://kan.bn/api/v1
```

## Authentication

Most endpoints require authentication using your API key. You can create one in the [settings page](https://kan.bn/settings) of your account. Include this key in the `x-api-key` header of each request.

```
'x-api-key': kan_123456789
```

## Response codes

Kan uses standard HTTP codes to indicate the success or failure of your requests.

In general, `2xx` HTTP codes correspond to success, `4xx` codes are for user-related failures, and `5xx` codes are for infrastructure issues.

| Status | Description                     |
| ------ | ------------------------------- |
| `200`  | Success                         |
| `400`  | Invalid parameters              |
| `401`  | Missing token                   |
| `403`  | Invalid token                   |
| `404`  | Resource not found              |
| `500`  | Error with Kan's infrastructure |



================================================
FILE: apps/docs/guides/self-hosting/introduction.mdx
================================================
---
title: "Introduction"
description: "Overview and quick start to run Kan on your own infrastructure using Docker Compose."
mode: "wide"
tag: "NEW"
---

This guide introduces how to self-host Kan. It starts with the minimal Docker Compose setup (web + PostgreSQL) and points you to optional features like email and S3-based file storage.

## What youâ€™ll set up

<CardGroup cols={2}>
  <Card title="Kan" icon="globe" color="#0284c7" horizontal>
    Next.js application served on port 3000.
  </Card>
  <Card title="PostgreSQL 15" icon="database" color="#65a30d" horizontal>
    Primary database for Kan data.
  </Card>
</CardGroup>

<Note>
  For file uploads (avatars), OAuth, and other advanced options, see the
  Environment Variables section in the README and the dedicated [S3
  guide](/guides/self-hosting/s3). The [full
  compose](https://github.com/kanbn/kan/blob/main/docker-compose.yml) in the
  repo includes a richer configuration via <code>.env</code>.
</Note>

## Prerequisites

- Docker and Docker Compose
- A long random string for <code>BETTER_AUTH_SECRET</code> (32+ chars)

## Quick start

<Steps>
  <Step title="Create a docker-compose.yml">
    Paste the following minimal configuration into a new <code>docker-compose.yml</code> file:

    ```yaml
    services:
      web:
        image: ghcr.io/kanbn/kan:latest
        container_name: kan-web
        ports:
          - "3000:3000"
        networks:
          - kan-network
        environment:
          NEXT_PUBLIC_BASE_URL: http://localhost:3000
          BETTER_AUTH_SECRET: your_auth_secret
          POSTGRES_URL: postgresql://kan:your_postgres_password@postgres:5432/kan_db
          NEXT_PUBLIC_ALLOW_CREDENTIALS: true
        depends_on:
          - postgres
        restart: unless-stopped

      postgres:
        image: postgres:15
        container_name: kan-db
        environment:
          POSTGRES_DB: kan_db
          POSTGRES_USER: kan
          POSTGRES_PASSWORD: your_postgres_password
        ports:
          - 5432:5432
        volumes:
          - kan_postgres_data:/var/lib/postgresql/data
        restart: unless-stopped
        networks:
          - kan-network

    networks:
      kan-network:

    volumes:
      kan_postgres_data:
    ```

    <Tip>
      The example above is intentionally minimal. The repository provides a more feature-complete compose file at [docker-compose.yml](https://github.com/kanbn/kan/blob/main/docker-compose.yml) if you want environment-based configuration, OAuth, S3, and more.
    </Tip>

  </Step>

  <Step title="Start the stack">
    Bring everything up in detached mode:

    ```bash
    docker compose up -d
    ```

    Once started, open [http://localhost:3000](http://localhost:3000).

  </Step>

  <Step title="Manage the containers">
    Useful commands while developing or testing:

    - Stop the containers: <code>docker compose down</code>
    - View logs: <code>docker compose logs -f</code>
    - Restart: <code>docker compose restart</code>

  </Step>

  <Step title="Configure environment (optional)">
    For a production-like setup and more features (email, OAuth, file uploads, etc.), create a <code>.env</code> file and set the relevant variables shown in the READMEâ€™s Environment Variables section.

    <Accordion title="Common variables">
      ```bash
      # Required
      NEXT_PUBLIC_BASE_URL=http://localhost:3000
      BETTER_AUTH_SECRET=replace_with_long_random_string
      POSTGRES_URL=postgresql://kan:your_postgres_password@postgres:5432/kan_db

      # Optional: Email
      EMAIL_FROM="Kan <hello@mail.kan.bn>"
      SMTP_HOST=smtp.resend.com
      SMTP_PORT=465
      SMTP_USER=resend
      SMTP_PASSWORD=re_xxxx
      SMTP_SECURE=true

      # Optional: Auth toggles
      NEXT_PUBLIC_ALLOW_CREDENTIALS=true
      NEXT_PUBLIC_DISABLE_SIGN_UP=false
      ```

      <Note type="warning">
        If you plan to enable file uploads (avatars, etc.), youâ€™ll also need S3 variables (<code>S3_ENDPOINT</code>, <code>S3_ACCESS_KEY_ID</code>, <code>S3_SECRET_ACCESS_KEY</code>, <code>NEXT_PUBLIC_STORAGE_URL</code>, <code>NEXT_PUBLIC_STORAGE_DOMAIN</code>, â€¦). See the S3 guide linked at the top.
      </Note>
    </Accordion>

  </Step>
</Steps>

## Reference

- [GitHub README](https://github.com/kanbn/kan/blob/main/README.md#self-hosting-)
- [GitHub docker-compose.yml](https://github.com/kanbn/kan/blob/main/docker-compose.yml)



================================================
FILE: apps/docs/guides/self-hosting/s3.mdx
================================================
---
title: "Kan + MinIO (S3)"
mode: "wide"
tag: "NEW"
---

Deploy Kan with PostgreSQL and MinIO (S3-compatible storage) using Docker Compose, with clear steps and production notes.

## What youâ€™ll set up

<CardGroup cols={2}>
  <Card title="Kan" icon="globe" color="#0284c7" horizontal>
    Kan web app (Next.js), on port 3000.
  </Card>
  <Card title="PostgreSQL 15" icon="database" color="#65a30d" horizontal>
    PostgreSQL database for Kan.
  </Card>
</CardGroup>
<Card title="MinIO (S3-compatible)" icon="cloud" color="#ca8a04" horizontal>
  MinIO object storage (console port 9001, S3 API port 9000).
</Card>

## How it works

- Kan stores data in PostgreSQL.
- Kan uploads files (e.g., avatars) to MinIO over the S3 API.
- The browser fetches public files directly from MinIOâ€™s public URL.
- The Next.js image optimizer in Kan must be explicitly allowed to fetch from your storage host.

Key domain settings:

- <code>NEXT_PUBLIC_BASE_URL</code> â†’ the Kan site
- <code>NEXT_PUBLIC_STORAGE_URL</code> â†’ the public S3 base URL
- <code>NEXT_PUBLIC_STORAGE_DOMAIN</code> â†’ the exact S3 hostname (no scheme)

## Prerequisites

- Docker and Docker Compose
- Open local ports: 3000 (Kan), 5432 (Postgres), 9000/9001 (MinIO)
- A long random string for <code>BETTER_AUTH_SECRET</code> (32+ chars)

<Note type="warning">
  For production youâ€™ll want a reverse proxy (Traefik/Nginx/Caddy), valid TLS
  certificates, and DNS for your domains (e.g., <code>kan.example.com</code>,{" "}
  <code>s3.example.com</code>).
</Note>

## Quick start

<Tip type="info">
  Why <code>localtest.me</code>? It resolves to <code>127.0.0.1</code>{" "}
  automatically, so you can test domain-based configs locally without editing
  hosts.
</Tip>

<Steps>
  <Step title="Set environment variables">
    Provide the minimum required configuration (local example):

    ```bash
    NEXT_PUBLIC_BASE_URL=http://kan.localtest.me:3000
    BETTER_AUTH_SECRET=<long random string>
    POSTGRES_URL=postgresql://kan:<password>@postgres:5432/kan_db

    # MinIO/S3
    S3_ENDPOINT=http://s3.localtest.me:9000
    S3_ACCESS_KEY_ID=<minio-access-key>
    S3_SECRET_ACCESS_KEY=<minio-secret-key>
    S3_REGION=none
    S3_FORCE_PATH_STYLE=true

    # Public storage access
    NEXT_PUBLIC_STORAGE_URL=http://s3.localtest.me:9000
    NEXT_PUBLIC_STORAGE_DOMAIN=s3.localtest.me
    NEXT_PUBLIC_AVATAR_BUCKET_NAME=kan
    ```

    <Note type="info">
      Issue #109 fix: make sure <code>NEXT_PUBLIC_STORAGE_DOMAIN</code> exactly
      equals the hostname that serves your images (no scheme, no port).
    </Note>

    Optional (see README for full list): Email (`EMAIL_FROM`, `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASSWORD`, `SMTP_SECURE`), OAuth/OIDC (`GOOGLE_*`, `GITHUB_*`, `OIDC_*`), auth toggles, Trello import, etc.

  </Step>

  <Step title="Create or review Docker Compose files">
    You can start from the minimal compose at the repository root (<code>docker-compose.yml</code>) and review the production-oriented settings in <code>cloud/docker-compose.yml</code>.

    Start with the minimal setup (web + postgres + minio) and ensure environment variables are passed to the web service.

    <Accordion title="Docker Compose example">

    ```yaml
    services:
      postgres:
        image: postgres:15
        container_name: kan-db
        ports:
          - "5432:5432"
        environment:
          POSTGRES_USER: kan
          POSTGRES_PASSWORD: changeme
          POSTGRES_DB: kan_db
        volumes:
          - pg_data:/var/lib/postgresql/data
        restart: unless-stopped

      minio:
        image: minio/minio:latest
        container_name: kan-minio
        command: server /data --console-address ":9001"
        ports:
          - "9000:9000" # S3 API
          - "9001:9001" # Console
        environment:
          # Use the same credentials in your .env
          # as S3_ACCESS_KEY_ID / S3_SECRET_ACCESS_KEY
          MINIO_ROOT_USER: minio
          MINIO_ROOT_PASSWORD: minio123456789
        volumes:
          - minio_data:/data
        restart: unless-stopped

      web:
        image: ghcr.io/kanbn/kan:latest
        container_name: kan-web
        depends_on:
          - postgres
          - minio
        ports:
          - "3000:3000"
        # Load variables from .env
        # (see the "Set environment variables" step)
        env_file:
          - .env
        restart: unless-stopped

    volumes:
      pg_data:
      minio_data:
    ```

    <Note type="info">
      Ensure your <code>.env</code> contains values that match this compose file.
      For example:
      <ul>
        <li>
          <code>POSTGRES_URL=postgresql://kan:changeme@postgres:5432/kan_db</code>
        </li>
        <li>
          <code>S3_ENDPOINT=http://s3.localtest.me:9000</code>
        </li>
        <li>
          <code>S3_ACCESS_KEY_ID=minio</code> and{" "}
          <code>S3_SECRET_ACCESS_KEY=minio123456789</code>
        </li>
        <li>
          <code>S3_FORCE_PATH_STYLE=true</code>
        </li>
        <li>
          <code>NEXT_PUBLIC_STORAGE_URL=http://s3.localtest.me:9000</code>
        </li>
        <li>
          <code>NEXT_PUBLIC_STORAGE_DOMAIN=s3.localtest.me</code>
        </li>
        <li>
          <code>NEXT_PUBLIC_AVATAR_BUCKET_NAME=kan</code>
        </li>
      </ul>
    </Note>

    </Accordion>

  </Step>

  <Step title="Start services">

    ```bash
    docker compose up -d
    ```

    Then open:

    <ul>
      <li>
        Kan: <a href="http://kan.localtest.me:3000">http://kan.localtest.me:3000</a>
      </li>
      <li>
        MinIO Console:{" "}
        <a href="http://minio.localtest.me:9001">http://minio.localtest.me:9001</a>
      </li>
      <li>
        MinIO S3 API:{" "}
        <a href="http://s3.localtest.me:9000">http://s3.localtest.me:9000</a>
      </li>
    </ul>

  </Step>

  <Step title="Initialize MinIO">
    1) Log into the MinIO Console (http://minio.localtest.me:9001).

    2. Create a bucket (e.g., <code>kan</code>).

    3. For simple public avatars, apply a read-only policy so GET requests are allowed for objects:

    ```json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Principal": { "AWS": ["*"] },
          "Action": ["s3:GetBucketLocation", "s3:ListBucket"],
          "Resource": ["arn:aws:s3:::kan"]
        },
        {
          "Effect": "Allow",
          "Principal": { "AWS": ["*"] },
          "Action": ["s3:GetObject"],
          "Resource": ["arn:aws:s3:::kan/*"]
        }
      ]
    }
    ```

    <Note type="warning">
      Alternatively, keep the bucket private and use presigned URLs. In that case,
      ensure your server and browser access paths are correctly configured.
    </Note>

  </Step>

  <Step title="Verify the setup">
    <ul>
      <li>Sign in to Kan and upload an avatar (Settings).</li>
      <li>Confirm the object is created in your MinIO bucket.</li>
      <li>The avatar should render without errors.</li>
    </ul>

    If you see a 400 from <code>/\_next/image</code> with â€œurl parameter is not allowedâ€:

    <ul>
      <li>
        <code>NEXT_PUBLIC_STORAGE_DOMAIN</code> must exactly match the S3 hostname
        that serves images.
      </li>
      <li>
        <code>NEXT_PUBLIC_STORAGE_URL</code> should use the same host (with
        scheme/port).
      </li>
      <li>Ensure youâ€™re using the latest Kan image.</li>
    </ul>

  </Step>
</Steps>

## Production setup

<Tabs>
  <Tab title="Local">

  <ul>
    <li><code>NEXT_PUBLIC_BASE_URL=http://kan.localtest.me:3000</code></li>
    <li><code>S3_ENDPOINT=http://s3.localtest.me:9000</code></li>
    <li><code>NEXT_PUBLIC_STORAGE_URL=http://s3.localtest.me:9000</code></li>
    <li><code>NEXT_PUBLIC_STORAGE_DOMAIN=s3.localtest.me</code></li>
    <li>Keep <code>S3_FORCE_PATH_STYLE=true</code> for MinIO.</li>
  </ul>
  </Tab>
  <Tab title="Production">

  <ul>
    <li><code>NEXT_PUBLIC_BASE_URL=https://kan.example.com</code></li>
    <li><code>S3_ENDPOINT=https://s3.example.com</code></li>
    <li><code>NEXT_PUBLIC_STORAGE_URL=https://s3.example.com</code></li>
    <li><code>NEXT_PUBLIC_STORAGE_DOMAIN=s3.example.com</code></li>
    <li>Keep <code>S3_FORCE_PATH_STYLE=true</code> for MinIO.</li>
    <li>Put Kan and MinIO behind HTTPS with a reverse proxy (Traefik/Nginx) and valid TLS.</li>
  </ul>
  </Tab>
</Tabs>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Files upload but donâ€™t display">
    <ul>
      <li>If public: confirm GET is allowed on objects (bucket policy).</li>
      <li>If private: ensure presigned URLs are generated and valid.</li>
      <li>403 AccessDenied indicates permissions, not CORS. CORS is not required for simple <code>&lt;img&gt;</code> GETs.</li>
    </ul>
  </Accordion>

  <Accordion title="Make the bucket public (read-only) with mc" defaultOpen>
    Use your MinIO root credentials to allow anonymous reads:

    ```bash
    # Replace with your MINIO_ROOT_PASSWORD
    MINIO_PASS='<your-minio-password>'

    # Point mc at MinIO via the container network (no ports required)
    docker run --rm --network container:kan-minio minio/mc \
      mc alias set local http://127.0.0.1:9000 minio "$MINIO_PASS"

    # Allow public downloads from the bucket
    docker run --rm --network container:kan-minio minio/mc \
      mc anonymous set download local/kan

    # Optional: verify anonymous status
    docker run --rm --network container:kan-minio minio/mc \
      mc anonymous get local/kan
    ```

  </Accordion>

  <Accordion title="Alternative: S3 bucket policy (AWS CLI)">
    If you prefer a bucket policy, apply a public-read policy for objects:

    ```json policy.json
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "PublicReadGetObject",
          "Effect": "Allow",
          "Principal": "*",
          "Action": ["s3:GetObject"],
          "Resource": ["arn:aws:s3:::kan/*"]
        }
      ]
    }
    ```

    ```bash
    # Use your MinIO root credentials
    MINIO_PASS='<your-minio-password>'

    docker run --rm --network container:kan-minio \
      -e AWS_ACCESS_KEY_ID=minio \
      -e AWS_SECRET_ACCESS_KEY="$MINIO_PASS" \
      -e AWS_DEFAULT_REGION=us-east-1 -e AWS_S3_FORCE_PATH_STYLE=true \
      -v "$PWD:/work" amazon/aws-cli \
      s3api put-bucket-policy --bucket kan --policy file:///work/policy.json \
      --endpoint-url http://127.0.0.1:9000
    ```

  </Accordion>

<Accordion title="Next.js optimizer 400 â€” url parameter is not allowed">
  <ul>
    <li>
      Exact match on <code>NEXT_PUBLIC_STORAGE_DOMAIN</code> with your storage
      host.
    </li>
    <li>
      Same host in <code>NEXT_PUBLIC_STORAGE_URL</code>.
    </li>
    <li>Update to the latest Kan image.</li>
  </ul>
</Accordion>

  <Accordion title="Next/Image: â€œurl parameter is valid but upstream response is invalidâ€">
    <ul>
      <li>This means Next.js accepted the URL, but the upstream returned a non-image (e.g., 403 HTML/XML).</li>
      <li>Fix: make the bucket/object publicly readable (see above), or use presigned URLs.</li>
      <li>Sanity test from the web network (replace with your image URL):</li>
    </ul>

    ```bash
    IMG_URL="https://s3.example.com/kan/path/to/avatar.jpg"

    # Headers/content-type as seen from the app network
    docker run --rm --network container:kan-web curlimages/curl:8.9.1 \
      -I -L --max-redirs 5 "$IMG_URL"

    # Quick status + content-type summary
    docker run --rm --network container:kan-web curlimages/curl:8.9.1 \
      -s -o /dev/null -w "HTTP:%{http_code} CT:%{content_type} URL:%{url_effective}\n" -L "$IMG_URL"
    ```

  </Accordion>

  <Accordion title="Connectivity checks">
    <ul>
      <li>The Kan container must reach <code>S3_ENDPOINT</code>.</li>
      <li>Verify DNS/ports inside the container (e.g., <code>docker exec -it &lt;kan-container&gt; sh</code>).</li>
    </ul>
  </Accordion>
</AccordionGroup>

## References

- [Kan README](https://github.com/kanbn/kan/blob/main/README.md)
- [Cloud compose reference](https://github.com/kanbn/kan/blob/main/cloud/docker-compose.yml)
- [Kan #109 Issue](https://github.com/kanbn/kan/issues/109)



================================================
FILE: apps/docs/imports/trello.mdx
================================================
---
title: Trello
description: "Import your Trello boards to Kan."
---

## Authorizing Kan.bn for Trello

Before you can import your Trello boards, you need to authorize Kan.bn for Trello. Follow these steps (only takes a couple of minutes):

1. **Authorize Kan.bn for Trello**
   Go to [https://kan.bn/settings](https://kan.bn/settings) and click **Connect Trello**.

2. **Log in to your Trello account**
   You will be redirected to Trello to log in to your Trello account.

3. **Authorize Kan.bn for Trello**
   Approve the permissions and you will be redirected back to Kan.bn.

4. **Verify the connection**
   You should see a **Disconnect Trello** button.

## Importing your Trello boards

Once you have authorized Kan.bn for Trello, importing your Trello boards is easy. Follow these steps:

1. **Create a new import in Kan**  
   Navigate to **[https://kan.bn/boards](https://kan.dev/boards)** and click **Import**.

2. **Select Trello as the Import Source**  
   Choose **Trello** from the list of import options and click **Select source**.

3. **Start the Import**  
   Select the board you want to import and click **Import boards**. Once the import is complete, you'll see your boards in Kan.



================================================
FILE: apps/web/bootstrap.cjs
================================================
/**
 * Bootstrap script for the distroless production image.
 *
 * Distroless images have no shell, so this Node.js script handles two tasks
 * that would normally be done in an entrypoint.sh:
 *
 * 1. Regenerate `public/__ENV.js` with the current runtime NEXT_PUBLIC_*
 *    environment variables.  The file was originally created at build time by
 *    next-runtime-env's `configureRuntimeEnv()`, but in a Docker deployment the
 *    env vars are provided at *run* time via docker-compose / docker run.
 *
 * 2. Start the Next.js standalone server.
 */

const { writeFileSync, existsSync, mkdirSync } = require("fs");
const path = require("path");

// ---------------------------------------------------------------------------
// 1. Inject runtime NEXT_PUBLIC_* env vars into __ENV.js
// ---------------------------------------------------------------------------

const publicDir = path.join(__dirname, "apps", "web", "public");

if (!existsSync(publicDir)) {
  mkdirSync(publicDir, { recursive: true });
}

const envVars = {};
for (const [key, value] of Object.entries(process.env)) {
  if (key.startsWith("NEXT_PUBLIC_")) {
    envVars[key] = value;
  }
}

writeFileSync(
  path.join(publicDir, "__ENV.js"),
  `self.__ENV = ${JSON.stringify(envVars)};`,
);

// ---------------------------------------------------------------------------
// 2. Start the Next.js standalone server
// ---------------------------------------------------------------------------

require("./apps/web/server.js");



================================================
FILE: apps/web/Dockerfile
================================================
# syntax=docker/dockerfile:1.7

ARG NODE_VERSION=20
ARG DISTROLESS_NODE_IMAGE=gcr.io/distroless/nodejs${NODE_VERSION}-debian12

# ============================================
# Stage 1: Alpine base with pnpm and turbo
# ============================================
FROM node:${NODE_VERSION}-alpine AS alpine
RUN apk update && \
    apk add --no-cache libc6-compat && \
    rm -rf /var/cache/apk/* /tmp/* || true && \
    corepack enable && \
    npm install turbo@2.3.1 --global && \
    pnpm config set store-dir ~/.pnpm-store

# ============================================
# Stage 2: Prune the monorepo
# ============================================
FROM alpine AS pruner

RUN apk add --no-cache git

WORKDIR /app
COPY . .

# Generate version from git (fallback if APP_VERSION not provided)
RUN git fetch --tags --unshallow 2>/dev/null || git fetch --tags 2>/dev/null || true && \
    AUTO_VERSION=$(git describe --tags --always --long 2>/dev/null | \
    sed -E 's/^v?([0-9]+\.[0-9]+\.[0-9]+)-[0-9]+-g([a-f0-9]{7}).*/\1+\2/' | \
    sed 's/^v//' || \
    git rev-parse --short HEAD 2>/dev/null | head -c 7 || \
    echo "unknown") && \
    echo "$AUTO_VERSION" > /app/AUTO_VERSION

RUN turbo prune --scope=@kan/web --scope=@kan/db --docker

# ============================================
# Stage 3: Install dependencies
# ============================================
FROM alpine AS deps
WORKDIR /app

COPY --from=pruner /app/out/pnpm-lock.yaml ./pnpm-lock.yaml
COPY --from=pruner /app/out/pnpm-workspace.yaml ./pnpm-workspace.yaml
COPY --from=pruner /app/out/json/ .

ENV CI=true
RUN --mount=type=cache,id=pnpm,target=~/.pnpm-store pnpm install --frozen-lockfile

# ============================================
# Stage 4: Build the web application
# ============================================
FROM alpine AS builder
ARG APP_VERSION

WORKDIR /app

COPY --from=deps /app/ ./
COPY --from=pruner /app/out/full/ .
COPY --from=pruner /app/AUTO_VERSION /tmp/AUTO_VERSION

# Force standalone output for production Docker image
ENV NEXT_PUBLIC_USE_STANDALONE_OUTPUT=true
ENV CI=true

RUN VERSION="${APP_VERSION:-$(cat /tmp/AUTO_VERSION 2>/dev/null | tr -d '\n\r' || echo 'unknown')}" && \
    NEXT_PUBLIC_APP_VERSION="$VERSION" pnpm build --filter=@kan/web

# ============================================
# Stage 5: Migration image (run-once container)
# ============================================
FROM node:${NODE_VERSION}-alpine AS migrate
WORKDIR /db

COPY packages/db/drizzle.config.ts ./drizzle.config.ts
COPY packages/db/migrations/ ./migrations/

RUN npm init -y && \
    npm install drizzle-kit drizzle-orm pg --save-exact && \
    # Strip unnecessary files from node_modules
    find node_modules -type f \( \
      -name '*.d.ts' -o \
      -name '*.d.mts' -o \
      -name '*.d.cts' -o \
      -name '*.map' -o \
      -name '*.md' -o \
      -name '*.txt' -o \
      -name 'LICENSE*' -o \
      -name 'CHANGELOG*' -o \
      -name 'README*' -o \
      -name '.eslint*' -o \
      -name '.prettier*' -o \
      -name 'tsconfig*.json' \
    \) -delete && \
    find node_modules -type d -empty -delete && \
    rm -rf /root/.npm /tmp/*

CMD ["npx", "drizzle-kit", "migrate"]

# ============================================
# Stage 6: Production web image (distroless)
# ============================================
FROM ${DISTROLESS_NODE_IMAGE} AS web
WORKDIR /app

ENV NODE_ENV=production
ENV PORT=3000
ENV HOSTNAME=0.0.0.0

# Copy the standalone Next.js server
COPY --from=builder /app/apps/web/.next/standalone/ ./
# Copy static assets and public files
COPY --from=builder /app/apps/web/.next/static/ ./apps/web/.next/static/
COPY --from=builder /app/apps/web/public/ ./apps/web/public/

# Copy bootstrap script for runtime env var injection
COPY apps/web/bootstrap.cjs ./bootstrap.cjs

EXPOSE 3000
CMD ["bootstrap.cjs"]



================================================
FILE: apps/web/entrypoint.sh
================================================
#!/bin/sh

# Run migrations from the Turborepo root context
echo "Running database migrations..."
# Navigate to the Turborepo root to run the db:migrate command
pnpm --prefix /app db:migrate

# Check if migration was successful
if [ $? -ne 0 ]; then
  echo "\nDatabase migration failed! Exiting."
  exit 1
fi

echo "\nStarting Next.js application..."

# Check if we should use standalone mode
if [ "$NEXT_PUBLIC_USE_STANDALONE_OUTPUT" = "true" ]; then
  echo "Starting in standalone mode..."
  exec node .next/standalone/apps/web/server.js
else
  echo "Starting in standard mode..."
  exec pnpm start
fi


================================================
FILE: apps/web/eslint.config.js
================================================
import baseConfig, { restrictEnvAccess } from "@kan/eslint-config/base";
import nextjsConfig from "@kan/eslint-config/nextjs";
import reactConfig from "@kan/eslint-config/react";

/** @type {import('typescript-eslint').Config} */
export default [
  {
    ignores: [".next/**"],
  },
  ...baseConfig,
  ...reactConfig,
  ...nextjsConfig,
  ...restrictEnvAccess,
];



================================================
FILE: apps/web/i18n.json
================================================
{
  "version": 0,
  "locale": {
    "source": "en",
    "targets": ["fr", "de", "es", "it", "nl", "ru", "pl", "pt-BR"]
  },
  "buckets": {
    "po": {
      "include": ["src/locales/[locale]/messages.po"]
    }
  },
  "$schema": "https://lingo.dev/schema/i18n.json"
}



================================================
FILE: apps/web/lingui.config.ts
================================================
import type { LinguiConfig } from "@lingui/conf";

const config: LinguiConfig = {
  locales: ["en", "fr", "de", "es", "it", "nl", "ru", "pl","pt-BR"],
  sourceLocale: "en",
  catalogs: [
    {
      path: "src/locales/{locale}/messages",
      include: ["src"],
      exclude: ["**/node_modules/**"],
    },
  ],
};

export default config;



================================================
FILE: apps/web/next.config.js
================================================
import { fileURLToPath } from "url";
import createJiti from "jiti";
import { env } from "next-runtime-env";
import { configureRuntimeEnv } from "next-runtime-env/build/configure.js";

// Import env files to validate at build time. Use jiti so we can load .ts files in here.
createJiti(fileURLToPath(import.meta.url))("./src/env");

configureRuntimeEnv();

/** @type {import("next").NextConfig} */
const config = {
  output:
    env("NEXT_PUBLIC_USE_STANDALONE_OUTPUT") === "true"
      ? "standalone"
      : undefined,
  reactStrictMode: true,

  /** Exclude build tools and dev-only packages from the standalone output */
  outputFileTracingExcludes: {
    "**/*": [
      "@esbuild/**",
      "esbuild/**",
      "typescript/**",
      "webpack/**",
      "uglify-js/**",
      "terser/**",
    ],
  },

  /** Enables hot reloading for local packages without a build step */
  transpilePackages: [
    "@kan/api",
    "@kan/db",
    "@kan/shared",
    "@kan/auth",
    "@kan/stripe",
  ],

  /** We already do linting and typechecking as separate tasks in CI */
  typescript: { ignoreBuildErrors: true },

  // temporarily ignore eslint errors during build until we fix all the errors sigh
  eslint: { ignoreDuringBuilds: true },

  images: {
    remotePatterns: (() => {
      /** @type {Array<{protocol: "http" | "https", hostname: string}>} */
      const patterns = [
        {
          protocol: "https",
          hostname:
            env("S3_FORCE_PATH_STYLE") === "true"
              ? `${env("NEXT_PUBLIC_STORAGE_DOMAIN")}`
              : `*.${env("NEXT_PUBLIC_STORAGE_DOMAIN")}`,
        },
        {
          protocol: "http",
          hostname: "localhost",
        },
        {
          protocol: "https",
          hostname: "*.googleusercontent.com",
        },
        {
          protocol: "https",
          hostname: "cdn.discordapp.com",
        },
      ];

      // Extract root domain from S3_ENDPOINT and add wildcard pattern
      const s3Endpoint = env("S3_ENDPOINT");
      if (s3Endpoint) {
        try {
          const url = new URL(s3Endpoint);
          const hostname = url.hostname;
          const protocol = url.protocol.replace(":", "");

          // Extract root domain (last 2 parts: e.g. cloudflarestorage.com)
          const parts = hostname.split(".");
          if (parts.length >= 2) {
            const rootDomain = parts.slice(-2).join(".");
            patterns.push({
              protocol: protocol === "http" ? "http" : "https",
              hostname: `*.${rootDomain}`,
            });
          }
        } catch {
          // If S3_ENDPOINT is not a valid URL, ignore it
        }
      }

      return patterns;
    })(),
  },
  turbopack: {
    rules: {
      "*.svg": {
        loaders: ["@svgr/webpack"],
        as: "*.js",
      },
    },
  },
  experimental: {
    // instrumentationHook: true,
    swcPlugins: [["@lingui/swc-plugin", {}]],
  },

  async rewrites() {
    return [
      {
        source: "/settings",
        destination: "/settings/account",
      },
    ];
  },
};

// Only allow external images when OIDC is configured (for OIDC provider avatars)
if (
  env("OIDC_CLIENT_ID") &&
  env("OIDC_CLIENT_SECRET") &&
  env("OIDC_DISCOVERY_URL")
) {
  config.images?.remotePatterns?.push({
    protocol: "https",
    hostname: "**",
  });
}

export default config;



================================================
FILE: apps/web/package.json
================================================
{
  "name": "@kan/web",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "build": "pnpm with-env next build --turbo",
    "clean": "git clean -xdf .cache .next .turbo node_modules",
    "dev": "pnpm with-env next dev --turbo",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "start": "pnpm with-env next start",
    "test": "vitest run",
    "test:watch": "vitest",
    "typecheck": "tsc --noEmit",
    "with-env": "dotenv -e ../../.env --",
    "lingui:extract": "lingui extract",
    "lingui:compile": "lingui compile --typescript",
    "lingui:extract:watch": "lingui extract --watch"
  },
  "dependencies": {
    "@aws-sdk/client-s3": "^3.802.0",
    "@aws-sdk/lib-storage": "^3.802.0",
    "@aws-sdk/s3-request-presigner": "^3.812.0",
    "@headlessui/react": "^2.2.0",
    "@hookform/resolvers": "^3.3.4",
    "@kan/api": "workspace:*",
    "@kan/auth": "workspace:*",
    "@kan/db": "workspace:^",
    "@kan/shared": "workspace:^",
    "@lingui/babel-preset-react": "^2.9.2",
    "@lingui/conf": "^5.3.2",
    "@lingui/macro": "^5.3.2",
    "@lingui/react": "^5.3.2",
    "@novu/api": "^3.11.0",
    "@t3-oss/env-nextjs": "^0.11.1",
    "@tailwindcss/typography": "^0.5.16",
    "@tanstack/react-query": "catalog:",
    "@tiptap/extension-link": "^2.22.2",
    "@tiptap/extension-mention": "^3.0.9",
    "@tiptap/extension-placeholder": "^2.14.0",
    "@tiptap/extension-typography": "^3.18.0",
    "@tiptap/pm": "^2.14.0",
    "@tiptap/react": "^2.14.0",
    "@tiptap/starter-kit": "^2.14.0",
    "@tiptap/suggestion": "^2.14.0",
    "@trpc/client": "catalog:",
    "@trpc/next": "^11.0.0-rc.660",
    "@trpc/react-query": "catalog:",
    "@trpc/server": "catalog:",
    "date-fns": "^4.1.0",
    "framer-motion": "^12.26.2",
    "geist": "^1.3.1",
    "jose": "^6.1.2",
    "next": "15.5.9",
    "next-runtime-env": "^1.7.2",
    "next-themes": "^0.4.6",
    "nextjs-cors": "^2.2.0",
    "posthog-js": "^1.254.0",
    "react": "catalog:react18",
    "react-beautiful-dnd": "^13.1.1",
    "react-contenteditable": "^3.3.7",
    "react-dom": "catalog:react18",
    "react-hook-form": "^7.51.1",
    "react-icons": "^5.5.0",
    "react-image-crop": "^11.0.10",
    "react-lottie-player": "^1.5.5",
    "react-markdown": "^10.1.0",
    "superjson": "2.2.1",
    "tailwind-merge": "^2.5.2",
    "tippy.js": "^6.3.7",
    "tiptap-markdown": "^0.8",
    "zod": "catalog:"
  },
  "devDependencies": {
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/stripe": "workspace:*",
    "@kan/tailwind-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "@lingui/cli": "^5.3.2",
    "@lingui/loader": "^5.3.2",
    "@lingui/swc-plugin": "^5.5.2",
    "@svgr/webpack": "^8.1.0",
    "@types/node": "^20.17.7",
    "@types/react": "catalog:react18",
    "@types/react-beautiful-dnd": "^13.1.7",
    "@types/react-dom": "catalog:react18",
    "dotenv-cli": "^7.4.4",
    "eslint": "catalog:",
    "jiti": "^1.21.6",
    "prettier": "catalog:",
    "tailwindcss": "catalog:",
    "typescript": "catalog:",
    "vitest": "^3.0.0"
  },
  "prettier": "@kan/prettier-config"
}



================================================
FILE: apps/web/postcss.config.cjs
================================================
module.exports = {
  plugins: {
    tailwindcss: {},
  },
};



================================================
FILE: apps/web/tailwind.config.ts
================================================
import type { Config } from "tailwindcss";
import { fontFamily } from "tailwindcss/defaultTheme";

import baseConfig from "@kan/tailwind-config/web";

export default {
  darkMode: "class",
  content: [...baseConfig.content],
  plugins: [require("@tailwindcss/typography")],
  presets: [baseConfig],
  theme: {
    extend: {
      fontFamily: {
        sans: ["var(--font-geist-sans)", ...fontFamily.sans],
        mono: ["var(--font-geist-mono)", ...fontFamily.mono],
      },
    },
  },
} satisfies Config;



================================================
FILE: apps/web/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/base.json",
  "compilerOptions": {
    "lib": ["ES2022", "dom", "dom.iterable"],
    "jsx": "preserve",
    "baseUrl": ".",
    "paths": {
      "~/*": ["./src/*"]
    },
    "plugins": [{ "name": "next" }],
    "module": "esnext"
  },
  "include": [".", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}



================================================
FILE: apps/web/turbo.json
================================================
{
  "$schema": "https://turborepo.org/schema.json",
  "extends": ["//"],
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "!.next/cache/**", "next-env.d.ts"]
    },
    "dev": {
      "persistent": true
    }
  }
}



================================================
FILE: apps/web/public/testimonials/avatars/ehb.webp
================================================
[Binary file]


================================================
FILE: apps/web/public/testimonials/avatars/hanno_braun.webp
================================================
[Binary file]


================================================
FILE: apps/web/src/env.ts
================================================
import { createEnv } from "@t3-oss/env-nextjs";
import { vercel } from "@t3-oss/env-nextjs/presets";
import { z } from "zod";

export const env = createEnv({
  extends: [vercel()],
  shared: {
    NODE_ENV: z
      .enum(["development", "production", "test"])
      .default("development"),
  },
  /**
   * Specify your server-side environment variables schema here.
   * This way you can ensure the app isn't built with invalid env vars.
   */
  server: {
    KAN_ADMIN_API_KEY: z.string().optional(),
    BETTER_AUTH_SECRET: z.string(),
    BETTER_AUTH_TRUSTED_ORIGINS: z
      .string()
      .transform((s) => (s === "" ? undefined : s))
      .refine(
        (s) =>
          !s ||
          s.split(",").every((l) => z.string().url().safeParse(l).success),
      )
      .optional(),
    POSTGRES_URL: z.string().url().optional().or(z.literal("")),
    TRELLO_APP_API_KEY: z.string().optional(),
    TRELLO_APP_SECRET: z.string().optional(),
    STRIPE_SECRET_KEY: z.string().optional(),
    GOOGLE_CLIENT_ID: z.string().optional(),
    GOOGLE_CLIENT_SECRET: z.string().optional(),
    DISCORD_CLIENT_ID: z.string().optional(),
    DISCORD_CLIENT_SECRET: z.string().optional(),
    GITHUB_CLIENT_ID: z.string().optional(),
    GITHUB_CLIENT_SECRET: z.string().optional(),
    GITLAB_CLIENT_ID: z.string().optional(),
    GITLAB_CLIENT_SECRET: z.string().optional(),
    GITLAB_ISSUER: z.string().optional(),
    MICROSOFT_CLIENT_ID: z.string().optional(),
    MICROSOFT_CLIENT_SECRET: z.string().optional(),
    TWITTER_CLIENT_ID: z.string().optional(),
    TWITTER_CLIENT_SECRET: z.string().optional(),
    KICK_CLIENT_ID: z.string().optional(),
    KICK_CLIENT_SECRET: z.string().optional(),
    ZOOM_CLIENT_ID: z.string().optional(),
    ZOOM_CLIENT_SECRET: z.string().optional(),
    DROPBOX_CLIENT_ID: z.string().optional(),
    DROPBOX_CLIENT_SECRET: z.string().optional(),
    VK_CLIENT_ID: z.string().optional(),
    VK_CLIENT_SECRET: z.string().optional(),
    LINKEDIN_CLIENT_ID: z.string().optional(),
    LINKEDIN_CLIENT_SECRET: z.string().optional(),
    NOVU_API_KEY: z.string().optional(),
    EMAIL_UNSUBSCRIBE_SECRET: z.string().optional(),
    // Generic OIDC Provider
    OIDC_CLIENT_ID: z.string().optional(),
    OIDC_CLIENT_SECRET: z.string().optional(),
    OIDC_DISCOVERY_URL: z.string().optional(),
    REDDIT_CLIENT_ID: z.string().optional(),
    REDDIT_CLIENT_SECRET: z.string().optional(),
    ROBLOX_CLIENT_ID: z.string().optional(),
    ROBLOX_CLIENT_SECRET: z.string().optional(),
    SPOTIFY_CLIENT_ID: z.string().optional(),
    SPOTIFY_CLIENT_SECRET: z.string().optional(),
    TIKTOK_CLIENT_ID: z.string().optional(),
    TIKTOK_CLIENT_SECRET: z.string().optional(),
    TIKTOK_CLIENT_KEY: z.string().optional(),
    TWITCH_CLIENT_ID: z.string().optional(),
    TWITCH_CLIENT_SECRET: z.string().optional(),
    APPLE_CLIENT_ID: z.string().optional(),
    APPLE_CLIENT_SECRET: z.string().optional(),
    APPLE_APP_BUNDLE_IDENTIFIER: z.string().optional(),
    S3_ACCESS_KEY_ID: z.string().optional(),
    S3_SECRET_ACCESS_KEY: z.string().optional(),
    S3_REGION: z.string().optional(),
    S3_ENDPOINT: z.string().optional(),
    S3_FORCE_PATH_STYLE: z.string().optional(),
    EMAIL_FROM: z.string().optional(),
    REDIS_URL: z.string().url().optional().or(z.literal("")),
  },

  /**
   * Specify your client-side environment variables schema here.
   * For them to be exposed to the client, prefix them with `NEXT_PUBLIC_`.
   */
  client: {
    NEXT_PUBLIC_KAN_ENV: z.string().optional(),
    NEXT_PUBLIC_UMAMI_ID: z.string().optional(),
    NEXT_PUBLIC_POSTHOG_KEY: z.string().optional(),
    NEXT_PUBLIC_POSTHOG_HOST: z.string().optional(),
    NEXT_PUBLIC_USE_STANDALONE_OUTPUT: z.string().optional(),
    NEXT_PUBLIC_BASE_URL: z.string().url().optional(),
    NEXT_PUBLIC_STORAGE_URL: z.string().url().optional(),
    NEXT_PUBLIC_AVATAR_BUCKET_NAME: z.string().optional(),
    NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME: z.string().optional(),
    NEXT_PUBLIC_STORAGE_DOMAIN: z.string().optional(),
    NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS: z
      .string()
      .transform((s) => (s === "" ? undefined : s))
      .refine(
        (s) => !s || s.toLowerCase() === "true" || s.toLowerCase() === "false",
      )
      .optional(),
    NEXT_PUBLIC_APP_VERSION: z.string().optional(),
    NEXT_PUBLIC_ALLOW_CREDENTIALS: z
      .string()
      .transform((s) => (s === "" ? undefined : s))
      .refine(
        (s) => !s || s.toLowerCase() === "true" || s.toLowerCase() === "false",
      )
      .optional(),
    NEXT_PUBLIC_DISABLE_SIGN_UP: z
      .string()
      .transform((s) => (s === "" ? undefined : s))
      .refine(
        (s) => !s || s.toLowerCase() === "true" || s.toLowerCase() === "false",
      )
      .optional(),
    NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY: z
      .string()
      .transform((s) => (s === "" ? undefined : s))
      .refine(
        (s) => !s || s.toLowerCase() === "true" || s.toLowerCase() === "false",
      )
      .optional(),
  },
  /**
   * Destructure all variables from `process.env` to make sure they aren't tree-shaken away.
   */
  experimental__runtimeEnv: {
    NEXT_PUBLIC_KAN_ENV: process.env.NEXT_PUBLIC_KAN_ENV,
    NODE_ENV: process.env.NODE_ENV,
    NEXT_PUBLIC_UMAMI_ID: process.env.NEXT_PUBLIC_UMAMI_ID,
    NEXT_PUBLIC_POSTHOG_KEY: process.env.NEXT_PUBLIC_POSTHOG_KEY,
    NEXT_PUBLIC_POSTHOG_HOST: process.env.NEXT_PUBLIC_POSTHOG_HOST,
    NEXT_PUBLIC_BASE_URL: process.env.NEXT_PUBLIC_BASE_URL,
    NEXT_PUBLIC_STORAGE_URL: process.env.NEXT_PUBLIC_STORAGE_URL,
    NEXT_PUBLIC_AVATAR_BUCKET_NAME: process.env.NEXT_PUBLIC_AVATAR_BUCKET_NAME,
    NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME:
      process.env.NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME,
    NEXT_PUBLIC_STORAGE_DOMAIN: process.env.NEXT_PUBLIC_STORAGE_DOMAIN,
    NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS:
      process.env.NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS,
    NEXT_PUBLIC_APP_VERSION: process.env.NEXT_PUBLIC_APP_VERSION,
    NEXT_PUBLIC_ALLOW_CREDENTIALS: process.env.NEXT_PUBLIC_ALLOW_CREDENTIALS,
    NEXT_PUBLIC_DISABLE_SIGN_UP: process.env.NEXT_PUBLIC_DISABLE_SIGN_UP,
    NEXT_PUBLIC_USE_STANDALONE_OUTPUT:
      process.env.NEXT_PUBLIC_USE_STANDALONE_OUTPUT,
    NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY:
      process.env.NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY,
  },
  skipValidation:
    !!process.env.CI || process.env.npm_lifecycle_event === "lint",
});



================================================
FILE: apps/web/src/middleware.ts
================================================
import type { NextRequest } from "next/server";
import { NextResponse } from "next/server";
import { env } from "next-runtime-env";

export function middleware(request: NextRequest) {
  if (request.nextUrl.pathname === "/") {
    if (env("NEXT_PUBLIC_KAN_ENV") !== "cloud") {
      const loginUrl = new URL("/login", request.url);
      return NextResponse.redirect(loginUrl);
    }
  }

  return NextResponse.next();
}

export const config = {
  matcher: ["/"],
};



================================================
FILE: apps/web/src/components/AuthForm.tsx
================================================
import type { SocialProvider } from "better-auth/social-providers";
import { useSearchParams } from "next/navigation";
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";
import { useQuery } from "@tanstack/react-query";
import { env } from "next-runtime-env";
import { useEffect, useMemo, useRef, useState } from "react";
import { useForm } from "react-hook-form";
import {
  FaApple,
  FaDiscord,
  FaDropbox,
  FaFacebook,
  FaGithub,
  FaGitlab,
  FaGoogle,
  FaLinkedin,
  FaMicrosoft,
  FaOpenid,
  FaReddit,
  FaSpotify,
  FaTiktok,
  FaTwitch,
  FaTwitter,
  FaVk,
} from "react-icons/fa";
import { SiRoblox, SiZoom } from "react-icons/si";
import { TbBrandKick } from "react-icons/tb";
import { z } from "zod";

import { authClient } from "@kan/auth/client";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { usePopup } from "~/providers/popup";

type AuthProvider = SocialProvider | "oidc";

interface FormValues {
  name?: string;
  email: string;
  password?: string;
}

interface AuthProps {
  setIsMagicLinkSent: (value: boolean, recipient: string) => void;
  isSignUp?: boolean;
}

const EmailSchema = z.object({
  name: z.string().optional(),
  email: z.string().email(),
  password: z.string().optional(),
});

const availableSocialProviders = {
  google: {
    id: "google",
    name: "Google",
    icon: FaGoogle,
  },
  github: {
    id: "github",
    name: "GitHub",
    icon: FaGithub,
  },
  discord: {
    id: "discord",
    name: "Discord",
    icon: FaDiscord,
  },
  apple: {
    id: "apple",
    name: "Apple",
    icon: FaApple,
  },
  microsoft: {
    id: "microsoft",
    name: "Microsoft",
    icon: FaMicrosoft,
  },
  facebook: {
    id: "facebook",
    name: "Facebook",
    icon: FaFacebook,
  },
  spotify: {
    id: "spotify",
    name: "Spotify",
    icon: FaSpotify,
  },
  twitch: {
    id: "twitch",
    name: "Twitch",
    icon: FaTwitch,
  },
  twitter: {
    id: "twitter",
    name: "Twitter",
    icon: FaTwitter,
  },
  dropbox: {
    id: "dropbox",
    name: "Dropbox",
    icon: FaDropbox,
  },
  linkedin: {
    id: "linkedin",
    name: "LinkedIn",
    icon: FaLinkedin,
  },
  gitlab: {
    id: "gitlab",
    name: "GitLab",
    icon: FaGitlab,
  },
  tiktok: {
    id: "tiktok",
    name: "TikTok",
    icon: FaTiktok,
  },
  reddit: {
    id: "reddit",
    name: "Reddit",
    icon: FaReddit,
  },
  roblox: {
    id: "roblox",
    name: "Roblox",
    icon: SiRoblox,
  },
  vk: {
    id: "vk",
    name: "VK",
    icon: FaVk,
  },
  kick: {
    id: "kick",
    name: "Kick",
    icon: TbBrandKick,
  },
  zoom: {
    id: "zoom",
    name: "Zoom",
    icon: SiZoom,
  },
  oidc: {
    id: "oidc",
    name: "OIDC",
    icon: FaOpenid,
  },
};

export function Auth({ setIsMagicLinkSent, isSignUp }: AuthProps) {
  const [isCloudEnv, setIsCloudEnv] = useState(false);
  const [isLoginWithProviderPending, setIsLoginWithProviderPending] =
    useState<null | AuthProvider>(null);
  const [isCredentialsEnabled, setIsCredentialsEnabled] = useState(false);
  const [isEmailSendingEnabled, setIsEmailSendingEnabled] = useState(false);
  const [isLoginWithEmailPending, setIsLoginWithEmailPending] = useState(false);
  const [loginError, setLoginError] = useState<string | null>(null);
  const { showPopup } = usePopup();
  const oidcProviderName = "OIDC";
  const passwordRef = useRef<HTMLInputElement | null>(null);

  const redirect = useSearchParams().get("next");
  const callbackURL = redirect ?? "/boards";

  // Safely get environment variables on client side to avoid hydration mismatch
  useEffect(() => {
    const credentialsAllowed =
      env("NEXT_PUBLIC_ALLOW_CREDENTIALS")?.toLowerCase() === "true";
    const emailSendingEnabled =
      env("NEXT_PUBLIC_DISABLE_EMAIL")?.toLowerCase() !== "true";
    const isCloudEnv = env("NEXT_PUBLIC_KAN_ENV") === "cloud";
    setIsCloudEnv(isCloudEnv);
    setIsEmailSendingEnabled(emailSendingEnabled);
    setIsCredentialsEnabled(credentialsAllowed);
  }, []);

  const {
    register,
    handleSubmit,
    formState: { errors },
    watch,
  } = useForm<FormValues>({
    resolver: zodResolver(EmailSchema),
  });

  const { data: socialProviders } = useQuery({
    queryKey: ["social_providers"],
    queryFn: () => authClient.getSocialProviders(),
  });

  const handleLoginWithEmail = async (
    email: string,
    password?: string | null,
    name?: string,
  ) => {
    setIsLoginWithEmailPending(true);
    setLoginError(null);
    if (password) {
      if (isSignUp && name) {
        await authClient.signUp.email(
          {
            name,
            email,
            password,
            callbackURL,
          },
          {
            onSuccess: () =>
              showPopup({
                header: t`Success`,
                message: t`You have been signed up successfully.`,
                icon: "success",
              }),
            onError: ({ error }) => setLoginError(error.message),
          },
        );
      } else {
        await authClient.signIn.email(
          {
            email,
            password,
            callbackURL,
          },
          {
            onSuccess: () =>
              showPopup({
                header: t`Success`,
                message: t`You have been logged in successfully.`,
                icon: "success",
              }),
            onError: ({ error }) => setLoginError(error.message),
          },
        );
      }
    } else {
      // Only allow magic link if email sending is enabled and not in sign up mode
      if (isCloudEnv || (isEmailSendingEnabled && !isSignUp)) {
        await authClient.signIn.magicLink(
          {
            email,
            callbackURL,
          },
          {
            onSuccess: () => setIsMagicLinkSent(true, email),
            onError: ({ error }) => setLoginError(error.message),
          },
        );
      } else {
        // Provide a clear error feedback when password omitted but magic link unavailable
        setLoginError(
          isSignUp
            ? t`Password is required to sign up.`
            : t`Password is required to login.`,
        );
      }
    }

    setIsLoginWithEmailPending(false);
  };

  const handleLoginWithProvider = async (provider: AuthProvider) => {
    setIsLoginWithProviderPending(provider);
    setLoginError(null);

    let error;
    if (provider === "oidc") {
      // Use oauth2 signin for OIDC provider
      const result = await authClient.signIn.oauth2({
        providerId: "oidc",
        callbackURL,
      });
      error = result.error;
    } else {
      // Use social signin for traditional social providers
      const result = await authClient.signIn.social({
        provider,
        callbackURL,
      });
      error = result.error;
    }

    setIsLoginWithProviderPending(null);

    if (error) {
      setLoginError(
        t`Failed to login with ${provider.at(0)?.toUpperCase() + provider.slice(1)}. Please try again.`,
      );
    }
  };

  const onSubmit = async (values: FormValues) => {
    // Treat empty password string as undefined to trigger magic link path
    const sanitizedPassword = values.password?.trim()
      ? values.password
      : undefined;
    await handleLoginWithEmail(values.email, sanitizedPassword, values.name);
  };

  const password = watch("password");

  const isMagicLinkAvailable = useMemo(() => {
    return isCloudEnv || (isEmailSendingEnabled && !isSignUp);
  }, [isCloudEnv, isEmailSendingEnabled, isSignUp]);

  // Determine if we should operate in magic link mode for current form state (login only)
  const isMagicLinkMode = useMemo(() => {
    // Magic link only viable when email sending enabled AND not sign up.
    if (!isEmailSendingEnabled || isSignUp) return false;
    // If credentials disabled we always default to magic link.
    if (!isCredentialsEnabled) return true;
    // Credentials enabled: user chooses magic link by leaving password blank.
    return !password;
  }, [isEmailSendingEnabled, isSignUp, isCredentialsEnabled, password]);

  // Auto-focus password field when an error indicates it's required
  useEffect(() => {
    if (!isCredentialsEnabled) return;
    // Focus when: sign up and missing password; login error requiring password; validation error on password.
    const pwdEmpty = (password ?? "").length === 0;
    let needsPassword = false;
    if (isSignUp && pwdEmpty) {
      needsPassword = true;
    } else if (loginError?.toLowerCase().includes("password")) {
      needsPassword = true;
    } else if (errors.password) {
      needsPassword = true;
    }
    if (needsPassword && passwordRef.current) {
      passwordRef.current.focus();
    }
  }, [isSignUp, password, loginError, errors.password, isCredentialsEnabled]);

  return (
    <div className="space-y-6">
      {socialProviders?.length !== 0 && (
        <div className="space-y-2">
          {Object.entries(availableSocialProviders).map(([key, provider]) => {
            if (!socialProviders?.includes(key)) {
              return null;
            }
            return (
              <Button
                key={key}
                onClick={() => handleLoginWithProvider(key as AuthProvider)}
                isLoading={isLoginWithProviderPending === key}
                iconLeft={<provider.icon />}
                fullWidth
                size="lg"
              >
                <Trans>
                  Continue with{" "}
                  {key === "oidc" ? oidcProviderName : provider.name}
                </Trans>
              </Button>
            );
          })}
        </div>
      )}
      {!(isCredentialsEnabled || isMagicLinkAvailable) &&
        socialProviders?.length === 0 && (
          <div className="flex w-full items-center gap-4">
            <div className="h-[1px] w-1/3 bg-light-600 dark:bg-dark-600" />
            <span className="text-center text-sm text-light-900 dark:text-dark-900">
              {t`No authentication methods are currently available`}
            </span>
            <div className="h-[1px] w-1/3 bg-light-600 dark:bg-dark-600" />
          </div>
        )}
      {(isCredentialsEnabled || isMagicLinkAvailable) && (
        <form onSubmit={handleSubmit(onSubmit)}>
          {socialProviders?.length !== 0 && (
            <div className="mb-[1.5rem] flex w-full items-center gap-4">
              <div className="h-[1px] w-full bg-light-600 dark:bg-dark-600" />
              <span className="text-sm text-light-900 dark:text-dark-900">
                {t`or`}
              </span>
              <div className="h-[1px] w-full bg-light-600 dark:bg-dark-600" />
            </div>
          )}
          <div className="space-y-2">
            {isSignUp && isCredentialsEnabled && (
              <div>
                <Input
                  {...register("name", { required: true })}
                  placeholder={t`Enter your name`}
                />
                {errors.name && (
                  <p className="mt-2 text-xs text-red-400">
                    {t`Please enter a valid name`}
                  </p>
                )}
              </div>
            )}
            <div>
              <Input
                {...register("email", { required: true })}
                placeholder={t`Enter your email address`}
              />
              {errors.email && (
                <p className="mt-2 text-xs text-red-400">
                  {t`Please enter a valid email address`}
                </p>
              )}
            </div>

            {isCredentialsEnabled && (
              <div>
                <Input
                  type="password"
                  {...register("password", { required: true })}
                  placeholder={t`Enter your password`}
                />
                {errors.password && (
                  <p className="mt-2 text-xs text-red-400">
                    {errors.password.message ??
                      t`Please enter a valid password`}
                  </p>
                )}
              </div>
            )}
            {loginError && (
              <p className="mt-2 text-xs text-red-400">{loginError}</p>
            )}
          </div>
          <div className="mt-[1.5rem] flex items-center gap-4">
            <Button
              isLoading={isLoginWithEmailPending}
              fullWidth
              size="lg"
              variant="secondary"
            >
              {isSignUp ? t`Sign up with ` : t`Continue with `}
              {isMagicLinkMode ? t`magic link` : t`email`}
            </Button>
          </div>
        </form>
      )}
      {!(isCredentialsEnabled || isMagicLinkAvailable) && loginError && (
        <p className="mt-2 text-xs text-red-400">{loginError}</p>
      )}
    </div>
  );
}



================================================
FILE: apps/web/src/components/Avatar.tsx
================================================
import Image from "next/image";
import { twMerge } from "tailwind-merge";

import { getInitialsFromName, inferInitialsFromEmail } from "~/utils/helpers";

const sizeMap = {
  xs: 20,
  sm: 24,
  md: 36,
  lg: 48,
} as const;

const Avatar = ({
  size = "md",
  name,
  email,
  icon,
  imageUrl,
  isLoading,
}: {
  size?: "xs" | "sm" | "md" | "lg";
  name: string;
  email: string;
  imageUrl?: string;
  icon?: React.ReactNode;
  isLoading?: boolean;
}) => {
  const initials = name?.trim()
    ? getInitialsFromName(name)
    : inferInitialsFromEmail(email);

  return (
    <>
      {imageUrl ? (
        <Image
          src={imageUrl}
          className="rounded-full bg-gray-50"
          width={sizeMap[size]}
          height={sizeMap[size]}
          alt=""
        />
      ) : (
        <span
          className={twMerge(
            "inline-flex h-9 w-9 items-center justify-center rounded-full bg-light-1000 dark:bg-dark-400",
            isLoading && "animate-pulse bg-light-200 dark:bg-dark-200",
            size === "xs" && "h-5 w-5",
            size === "sm" && "h-6 w-6",
            size === "lg" && "h-12 w-12",
          )}
        >
          {icon ? (
            <span className="text-[12px] text-white">{icon}</span>
          ) : (
            <span
              className={twMerge(
                "text-sm font-medium leading-none text-white",
                size === "xs" && "text-[8px]",
                size === "sm" && "text-[10px]",
                size === "lg" && "text-md",
              )}
            >
              {initials}
            </span>
          )}
        </span>
      )}
    </>
  );
};

export default Avatar;



================================================
FILE: apps/web/src/components/Badge.tsx
================================================
import type { ReactNode } from "react";

const Badge = ({ value, iconLeft }: { value: string; iconLeft: ReactNode }) => (
  <span className="mt-1 inline-flex w-fit items-center gap-x-1.5 rounded-full px-2 py-1 text-[10px] font-medium text-neutral-600 ring-1 ring-inset ring-light-600 dark:text-dark-1000 dark:ring-dark-800">
    {iconLeft}
    <div>{value}</div>
  </span>
);

export default Badge;



================================================
FILE: apps/web/src/components/Button.tsx
================================================
import Link from "next/link";
import { twMerge } from "tailwind-merge";

import LoadingSpinner from "./LoadingSpinner";

interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: "primary" | "secondary" | "danger" | "ghost";
  size?: "xs" | "sm" | "md" | "lg";
  isLoading?: boolean;
  iconLeft?: React.ReactNode;
  iconRight?: React.ReactNode;
  href?: string;
  fullWidth?: boolean;
  openInNewTab?: boolean;
  iconOnly?: boolean;
}

const Button = ({
  children,
  size = "md",
  iconLeft,
  iconRight,
  isLoading,
  variant = "primary",
  href,
  fullWidth,
  openInNewTab,
  iconOnly,
  ...props
}: ButtonProps) => {
  const classes = twMerge(
    "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-2 text-sm font-semibold text-light-50 shadow-sm focus-visible:outline-none",
    size === "xs" && "text-xs px-2 py-1",
    size === "sm" && "text-xs",
    size === "lg" && "py-[0.65rem]",
    fullWidth && "w-full",
    iconOnly && "p-0",
    iconOnly &&
      (size === "xs"
        ? "h-6 w-6"
        : size === "sm"
          ? "h-8 w-8"
          : size === "lg"
            ? "h-10 w-10"
            : "h-9 w-9"),
    variant === "primary" &&
      "bg-light-1000 dark:bg-dark-1000 dark:text-dark-50",
    variant === "secondary" &&
      "border-[1px] border-light-600 bg-light-50 text-light-1000 dark:border-dark-600 dark:bg-dark-300 dark:text-dark-1000",
    variant === "danger" &&
      "dark:text-red-1000 border-[1px] border-red-600 bg-red-500 dark:border-red-600 dark:bg-red-500",
    variant === "ghost" &&
      "bg-none text-light-1000 shadow-none hover:bg-light-300 dark:text-dark-1000 dark:hover:bg-dark-200",
    props.disabled && "opacity-60",
  );

  const content = (
    <span className="relative flex items-center justify-center">
      {isLoading && (
        <span className="absolute">
          <LoadingSpinner size={size === "xs" ? "sm" : size} />
        </span>
      )}
      {iconOnly ? (
        <div
          className={twMerge(
            "flex items-center",
            isLoading ? "invisible" : "visible",
          )}
        >
          {iconLeft ?? iconRight}
        </div>
      ) : (
        <div
          className={twMerge(
            fullWidth
              ? "grid w-full grid-cols-[auto_1fr_auto] items-center gap-x-2"
              : "flex items-center",
            isLoading ? "invisible" : "visible",
          )}
        >
          {fullWidth && !iconLeft && iconRight && (
            <span className="col-start-1 opacity-0">{iconRight}</span>
          )}
          {iconLeft && (
            <span
              className={twMerge(
                fullWidth ? "col-start-1 justify-self-start" : "mr-2",
              )}
            >
              {iconLeft}
            </span>
          )}
          <span
            className={twMerge(
              fullWidth ? "col-start-2 justify-self-center text-center" : "",
            )}
          >
            {children}
          </span>
          {iconRight && (
            <span
              className={twMerge(
                fullWidth ? "col-start-3 justify-self-end" : "ml-1",
              )}
            >
              {iconRight}
            </span>
          )}
          {fullWidth && !iconRight && iconLeft && (
            <span className="col-start-3 opacity-0">{iconLeft}</span>
          )}
        </div>
      )}
    </span>
  );

  if (href) {
    return (
      <Link
        href={href}
        className={classes}
        target={openInNewTab ? "_blank" : undefined}
        rel={openInNewTab ? "noopener noreferrer" : undefined}
        {...(props as React.AnchorHTMLAttributes<HTMLAnchorElement>)}
      >
        {content}
      </Link>
    );
  }

  return (
    <button
      className={classes}
      disabled={isLoading ?? props.disabled}
      {...props}
    >
      {content}
    </button>
  );
};

export default Button;



================================================
FILE: apps/web/src/components/CheckboxDropdown.tsx
================================================
import { Menu, Transition } from "@headlessui/react";
import { Fragment, useState } from "react";
import { HiEllipsisHorizontal, HiMiniPlus } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

interface Item {
  key: string;
  value: string;
  selected: boolean;
  leftIcon?: React.ReactNode;
}

interface Group {
  key: string;
  label: string;
  icon: React.ReactNode;
  items: Item[];
}

interface CheckboxDropdownProps {
  children: React.ReactNode;
  items?: Item[];
  groups?: Group[];
  createNewItemLabel?: string;
  menuSpacing?: "sm" | "md" | "lg";
  position?: "left" | "right";
  handleSelect: (
    groupKey: string | null,
    item: { key: string; value: string },
  ) => void;
  handleEdit?: (key: string) => void;
  handleCreate?: () => void;
  asChild?: boolean;
  disabled?: boolean;
}

export default function CheckboxDropdown({
  children,
  items,
  groups,
  createNewItemLabel = "Create new",
  menuSpacing = "sm",
  position = "left",
  handleSelect,
  handleEdit,
  handleCreate,
  asChild = true,
  disabled = false,
}: CheckboxDropdownProps) {
  const [selectedGroup, setSelectedGroup] = useState<string | null>(null);

  const menuSpacingClass = {
    sm: "top-[26px]",
    md: "top-[32px]",
    lg: "top-[38px]",
  };

  const renderMenuItems = (items: Item[], groupKey: string | null) => (
    <>
      {items.length > 0 ? (
        items.map((item) => (
          <Menu.Item key={item.key}>
              <div
                className="group flex items-center rounded-[5px] p-2 hover:bg-light-200 dark:hover:bg-dark-300"
                onClick={(e) => {
                  e.preventDefault();
                  handleSelect(groupKey, { key: item.key, value: item.value });
                }}
              >
              <input
                id={item.key}
                name={item.key}
                type="checkbox"
                className="h-[14px] w-[14px] rounded bg-transparent"
                onClick={(event) => event.stopPropagation()}
                onChange={() =>
                  handleSelect(groupKey, { key: item.key, value: item.value })
                }
                checked={item.selected}
              />
              {item.leftIcon && (
                <span className="ml-3 flex items-center">{item.leftIcon}</span>
              )}
              <label
                htmlFor={item.key}
                className="ml-3 text-[12px] text-dark-900"
              >
                {item.value}
              </label>
              {handleEdit && (
                <button
                  type="button"
                  className="invisible ml-auto group-hover:visible"
                  onClick={(event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    handleEdit(item.key);
                  }}
                >
                  <HiEllipsisHorizontal size={20} className="text-dark-900" />
                </button>
              )}
            </div>
          </Menu.Item>
        ))
      ) : (
        !handleCreate && (
          <div className="flex items-center p-2 text-[12px] text-dark-900">
            No items
          </div>
        )
      )}
      {handleCreate && (
        <button
          type="button"
          className="flex w-full items-center rounded-[5px] p-2 px-2 text-[12px] text-dark-900 hover:bg-light-200 dark:hover:bg-dark-300"
          onClick={(e) => {
            e.preventDefault();
            handleCreate();
          }}
        >
          <HiMiniPlus size={20} className="pr-1.5" />
          {createNewItemLabel}
        </button>
      )}
    </>
  );

  return (
    <Menu
      as="div"
      className="relative flex w-full flex-wrap items-center text-left"
    >
      <>
        <Menu.Button
          as={asChild ? "div" : undefined}
          disabled={disabled}
          className="h-full w-full cursor-pointer focus-visible:outline-none disabled:cursor-not-allowed"
        >
          {children}
        </Menu.Button>

        <Transition
          as={Fragment}
          enter="transition ease-out duration-100"
          enterFrom="transform opacity-0 scale-95"
          enterTo="transform opacity-100 scale-100"
          leave="transition ease-in duration-75"
          leaveFrom="transform opacity-100 scale-100"
          leaveTo="transform opacity-0 scale-95"
          afterLeave={() => setSelectedGroup(null)}
        >
          <Menu.Items
            className={twMerge(
              "mt-2s absolute z-50 w-56 origin-top-left rounded-md border-[1px] border-light-200 bg-light-50 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:border-dark-500 dark:bg-dark-200",
              position === "left" ? "left-0" : "right-0",
              menuSpacingClass[menuSpacing],
            )}
          >
            <div className="max-h-[350px] overflow-y-auto p-1">
              {!selectedGroup ? (
                <>
                  {items && renderMenuItems(items, null)}

                  {groups?.map((group) => (
                    <Menu.Item key={group.key}>
                      <div
                        className="flex items-center rounded-[5px] p-2 hover:bg-light-200 dark:hover:bg-dark-300"
                        onClick={(e) => {
                          e.preventDefault();
                          setSelectedGroup(group.key);
                        }}
                      >
                        <span className="mr-2 text-dark-900">{group.icon}</span>
                        <span className="pointer-events-none text-[12px] text-dark-900">
                          {group.label}
                        </span>
                      </div>
                    </Menu.Item>
                  ))}
                </>
              ) : (
                <>
                  {groups?.find((g) => g.key === selectedGroup)?.items &&
                    renderMenuItems(
                      groups.find((g) => g.key === selectedGroup)?.items || [],
                      selectedGroup,
                    )}
                </>
              )}
            </div>
          </Menu.Items>
        </Transition>
      </>
    </Menu>
  );
}



================================================
FILE: apps/web/src/components/CircularProgress.tsx
================================================
import { twMerge } from "tailwind-merge";

interface CircularProgressProps {
  progress: number; // 0-100
  size?: "sm" | "md" | "lg";
  className?: string;
}

const CircularProgress = ({
  progress,
  size = "md",
  className,
}: CircularProgressProps) => {
  const radius = 40;
  const circumference = 2 * Math.PI * radius;
  const strokeDashoffset = circumference - (progress / 100) * circumference;

  return (
    <div className={twMerge("relative", className)}>
      <svg
        className={twMerge(
          "-rotate-90 transform",
          size === "sm" && "h-4 w-4",
          size === "md" && "h-5 w-5",
          size === "lg" && "h-8 w-8",
        )}
        viewBox="0 0 100 100"
      >
        <circle
          cx="50"
          cy="50"
          r={radius}
          fill="none"
          stroke="currentColor"
          strokeWidth="14"
          className="text-light-300 dark:text-dark-400"
        />
        <circle
          cx="50"
          cy="50"
          r={radius}
          fill="none"
          stroke="currentColor"
          strokeWidth="14"
          strokeDasharray={circumference}
          strokeDashoffset={strokeDashoffset}
          strokeLinecap="round"
          className={twMerge(
            "transition-all duration-300 ease-in-out",
            progress === 100 ? "text-green-500" : "text-blue-500",
          )}
        />
      </svg>
    </div>
  );
};

export default CircularProgress;



================================================
FILE: apps/web/src/components/CommandPallette.tsx
================================================
import { useRouter } from "next/router";
import {
  Combobox,
  ComboboxInput,
  ComboboxOption,
  ComboboxOptions,
  Dialog,
  DialogBackdrop,
  DialogPanel,
} from "@headlessui/react";
import { t } from "@lingui/macro";
import { useState } from "react";
import { HiDocumentText, HiFolder, HiMagnifyingGlass } from "react-icons/hi2";

import { useDebounce } from "~/hooks/useDebounce";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

type SearchResult =
  | {
      publicId: string;
      title: string;
      description: string | null;
      slug: string;
      updatedAt: Date | null;
      createdAt: Date;
      type: "board";
    }
  | {
      publicId: string;
      title: string;
      description: string | null;
      boardPublicId: string;
      boardName: string;
      listName: string;
      updatedAt: Date | null;
      createdAt: Date;
      type: "card";
    };

export default function CommandPallette({
  isOpen,
  onClose,
}: {
  isOpen: boolean;
  onClose: () => void;
}) {
  const [query, setQuery] = useState("");
  const { workspace } = useWorkspace();
  const router = useRouter();

  // Debounce to avoid too many reqs
  const [debouncedQuery] = useDebounce(query, 300);

  const {
    data: searchResults,
    isLoading,
    isFetched,
    isPlaceholderData,
  } = api.workspace.search.useQuery(
    {
      workspacePublicId: workspace.publicId,
      query: debouncedQuery,
    },
    {
      enabled: Boolean(workspace.publicId && debouncedQuery.trim().length > 0),
      placeholderData: (previousData) => previousData,
    },
  );

  // Clear results when query is empty, otherwise show search results
  const results =
    debouncedQuery.trim().length === 0
      ? []
      : ((searchResults ?? []) as SearchResult[]);

  const hasSearched = Boolean(debouncedQuery.trim().length > 0);

  return (
    <Dialog
      className="relative z-50"
      open={isOpen}
      onClose={() => {
        onClose();
        setQuery("");
      }}
    >
      <DialogBackdrop
        transition
        className="data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in fixed inset-0 bg-light-50 bg-opacity-40 transition-opacity dark:bg-dark-50 dark:bg-opacity-40"
      />

      <div className="fixed inset-0 z-50 w-screen overflow-y-auto">
        <div className="flex min-h-full items-start justify-center p-4 text-center sm:items-start sm:p-0">
          <DialogPanel
            transition
            className="data-closed:opacity-0 data-closed:translate-y-4 data-closed:sm:translate-y-0 data-closed:sm:scale-95 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in relative mt-[25vh] w-full max-w-[550px] transform divide-y divide-gray-100 overflow-hidden rounded-lg border border-light-600 bg-white/90 shadow-3xl-light backdrop-blur-[6px] transition-all dark:divide-white/10 dark:border-dark-600 dark:bg-dark-100/90 dark:shadow-3xl-dark"
          >
            <Combobox>
              <div className="grid grid-cols-1">
                <ComboboxInput
                  autoFocus
                  className="col-start-1 row-start-1 h-12 w-full border-0 bg-transparent pl-11 pr-4 text-sm text-light-900 placeholder:text-light-700 focus:outline-none focus:ring-0 dark:text-dark-900 dark:placeholder:text-dark-700"
                  placeholder={t`Search boards and cards...`}
                  value={query}
                  onChange={(event) => setQuery(event.target.value)}
                  onKeyDown={(event) => {
                    if (event.key === "Enter" && results.length > 0) {
                      event.preventDefault();

                      // Find the active option or fallback to first option
                      const targetOption =
                        document.querySelector(
                          '[data-headlessui-state*="active"][role="option"]',
                        ) ?? document.querySelector('[role="option"]');

                      if (targetOption) {
                        (targetOption as HTMLElement).click();
                      }
                    }
                  }}
                />
                <HiMagnifyingGlass
                  className="pointer-events-none col-start-1 row-start-1 ml-4 size-5 self-center text-light-700 dark:text-dark-700"
                  aria-hidden="true"
                />
              </div>

              {results.length > 0 && (
                <ComboboxOptions
                  static
                  className={`max-h-72 scroll-py-2 overflow-y-auto py-2 ${
                    isPlaceholderData ? "opacity-75" : ""
                  }`}
                >
                  {results.map((result) => {
                    const url =
                      result.type === "board"
                        ? `/boards/${result.publicId}`
                        : `/cards/${result.publicId}`;

                    return (
                      <ComboboxOption
                        key={`${result.type}-${result.publicId}`}
                        value={result}
                        className="cursor-pointer select-none px-4 py-3 data-[focus]:bg-light-200 hover:bg-light-200 focus:outline-none dark:data-[focus]:bg-dark-200 dark:hover:bg-dark-200"
                        onClick={() => {
                          console.log("clicked", url);
                          void router.push(url);
                          onClose();
                          setQuery("");
                        }}
                      >
                        <div className="flex items-start gap-3">
                          <div className="mt-0.5 flex-shrink-0">
                            {result.type === "board" ? (
                              <HiFolder className="h-4 w-4 text-light-600 dark:text-dark-600" />
                            ) : (
                              <HiDocumentText className="h-4 w-4 text-light-600 dark:text-dark-600" />
                            )}
                          </div>
                          <div className="min-w-0 flex-1 text-left">
                            <div className="truncate text-sm font-bold text-light-900 dark:text-dark-900">
                              {result.title}
                            </div>
                            {result.type === "card" && (
                              <div className="truncate text-xs text-light-700 dark:text-dark-700">
                                {`${t`in`} ${result.boardName} â†’ ${result.listName}`}
                              </div>
                            )}
                          </div>
                        </div>
                      </ComboboxOption>
                    );
                  })}
                </ComboboxOptions>
              )}

              {hasSearched &&
                !isLoading &&
                searchResults !== undefined &&
                results.length === 0 && (
                  <div className="p-4 text-sm text-light-950 dark:text-dark-950">
                    {t`No results found for "${debouncedQuery}".`}
                  </div>
                )}
            </Combobox>
          </DialogPanel>
        </div>
      </div>
    </Dialog>
  );
}



================================================
FILE: apps/web/src/components/Dashboard.tsx
================================================
import { useTheme } from "next-themes";
import { useEffect, useRef, useState } from "react";
import {
  TbLayoutSidebarLeftCollapse,
  TbLayoutSidebarLeftExpand,
  TbLayoutSidebarRightCollapse,
  TbLayoutSidebarRightExpand,
} from "react-icons/tb";

import { authClient } from "@kan/auth/client";

import { useClickOutside } from "~/hooks/useClickOutside";
import { useModal } from "~/providers/modal";
import { useWorkspace, WorkspaceProvider } from "~/providers/workspace";
import { api } from "~/utils/api";
import SideNavigation from "./SideNavigation";

interface DashboardProps {
  children: React.ReactNode;
  rightPanel?: React.ReactNode;
  hasRightPanel?: boolean;
}

export function getDashboardLayout(
  page: React.ReactElement,
  rightPanel?: React.ReactNode,
  hasRightPanel = false,
) {
  return (
    <WorkspaceProvider>
      <Dashboard rightPanel={rightPanel} hasRightPanel={hasRightPanel}>
        {page}
      </Dashboard>
    </WorkspaceProvider>
  );
}

export default function Dashboard({
  children,
  rightPanel,
  hasRightPanel = false,
}: DashboardProps) {
  const { resolvedTheme } = useTheme();
  const { openModal } = useModal();
  const { availableWorkspaces, hasLoaded } = useWorkspace();

  const { data: session, isPending: sessionLoading } = authClient.useSession();
  const { data: user, isLoading: userLoading } = api.user.getUser.useQuery(
    undefined,
    {
      enabled: !!session?.user,
    },
  );

  const [isSideNavOpen, setIsSideNavOpen] = useState(false);
  const [isRightPanelOpen, setIsRightPanelOpen] = useState(false);

  const sideNavRef = useRef<HTMLDivElement>(null);
  const rightPanelRef = useRef<HTMLDivElement>(null);
  const sideNavButtonRef = useRef<HTMLButtonElement>(null);
  const rightPanelButtonRef = useRef<HTMLButtonElement>(null);

  const toggleSideNav = () => {
    setIsSideNavOpen(!isSideNavOpen);
    if (!isSideNavOpen) {
      setIsRightPanelOpen(false);
    }
  };

  const closeSideNav = () => {
    setIsSideNavOpen(false);
  };

  const toggleRightPanel = () => {
    setIsRightPanelOpen(!isRightPanelOpen);
    if (!isRightPanelOpen) {
      setIsSideNavOpen(false);
    }
  };

  useClickOutside(sideNavRef, (event) => {
    if (sideNavButtonRef.current?.contains(event.target as Node)) {
      return;
    }
    if (isSideNavOpen) {
      setIsSideNavOpen(false);
    }
  });

  useClickOutside(rightPanelRef, (event) => {
    if (rightPanelButtonRef.current?.contains(event.target as Node)) {
      return;
    }
    if (isRightPanelOpen) {
      setIsRightPanelOpen(false);
    }
  });

  useEffect(() => {
    if (hasLoaded && availableWorkspaces.length === 0) {
      openModal("NEW_WORKSPACE", undefined, undefined, false);
    }
  }, [hasLoaded, availableWorkspaces.length, openModal]);

  const isDarkMode = resolvedTheme === "dark";

  return (
    <>
      <style jsx global>{`
        html {
          height: 100vh;
          overflow: hidden;
          min-width: 320px;
          background-color: ${!isDarkMode ? "hsl(0deg 0% 97.3%)" : "#1c1c1c"};
        }
      `}</style>
      <div className="relative flex h-screen flex-col bg-light-50 dark:bg-dark-50 md:bg-light-100 md:p-3 md:dark:bg-dark-100">
        {/* Mobile Header */}
        <div className="flex h-12 items-center justify-between border-b border-light-300 bg-light-50 px-3 dark:border-dark-300 dark:bg-dark-50 md:hidden">
          <button
            ref={sideNavButtonRef}
            onClick={toggleSideNav}
            className="rounded p-1.5 transition-all hover:bg-light-200 dark:hover:bg-dark-100"
          >
            {isSideNavOpen ? (
              <TbLayoutSidebarLeftCollapse
                size={20}
                className="text-light-900 dark:text-dark-900"
              />
            ) : (
              <TbLayoutSidebarLeftExpand
                size={20}
                className="text-light-900 dark:text-dark-900"
              />
            )}
          </button>

          {hasRightPanel && (
            <button
              ref={rightPanelButtonRef}
              onClick={toggleRightPanel}
              className="rounded p-1.5 transition-all hover:bg-light-200 dark:hover:bg-dark-100"
            >
              {isRightPanelOpen ? (
                <TbLayoutSidebarRightCollapse
                  size={20}
                  className="text-light-900 dark:text-dark-900"
                />
              ) : (
                <TbLayoutSidebarRightExpand
                  size={20}
                  className="text-light-900 dark:text-dark-900"
                />
              )}
            </button>
          )}
        </div>

        <div className="flex h-[calc(100dvh-4.5rem)] min-h-0 w-full md:h-[calc(100dvh-1.5rem)]">
          <div
            ref={sideNavRef}
            className={`fixed top-12 z-40 h-[calc(100dvh-3rem)] w-[calc(100vw-1.5rem)] transform transition-transform duration-300 ease-in-out md:relative md:top-0 md:h-full md:w-auto md:translate-x-0 ${isSideNavOpen ? "translate-x-0" : "-translate-x-full md:translate-x-0"} `}
          >
            <SideNavigation
              user={{
                displayName: user?.name ?? session?.user.name,
                email: user?.email ?? session?.user.email ?? "",
                image: user?.image ?? undefined,
              }}
              isLoading={sessionLoading || userLoading}
              onCloseSideNav={closeSideNav}
            />
          </div>

          <div className="relative h-full min-h-0 w-full overflow-hidden md:rounded-lg md:border md:border-light-300 md:bg-light-50 md:dark:border-dark-300 md:dark:bg-dark-50">
            <div className="relative flex h-full min-h-0 w-full overflow-hidden">
              <div className="h-full w-full overflow-y-auto">{children}</div>

              {/* Mobile Right Panel */}
              {hasRightPanel && rightPanel && (
                <div
                  ref={rightPanelRef}
                  className={`fixed right-0 top-12 z-40 h-[calc(100dvh-3rem)] w-80 transform border-l border-light-300 bg-light-200 transition-transform duration-300 ease-in-out dark:border-dark-300 dark:bg-dark-100 md:hidden ${
                    isRightPanelOpen ? "translate-x-0" : "translate-x-full"
                  }`}
                >
                  <div className="h-full">{rightPanel}</div>
                </div>
              )}

              {/* Desktop Right Panel */}
              {hasRightPanel && rightPanel && (
                <div className="hidden md:block">{rightPanel}</div>
              )}
            </div>
          </div>
        </div>
      </div>
    </>
  );
}



================================================
FILE: apps/web/src/components/DateSelector.tsx
================================================
import {
  addMonths,
  eachDayOfInterval,
  endOfMonth,
  endOfWeek,
  format,
  isSameDay,
  isToday,
  startOfMonth,
  startOfWeek,
  subMonths,
} from "date-fns";
import { useMemo, useState } from "react";
import { HiChevronLeft, HiChevronRight } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

interface DateSelectorProps {
  selectedDate?: Date | null;
  onDateSelect?: (date: Date | undefined) => void;
}

const DateSelector = ({ selectedDate, onDateSelect }: DateSelectorProps) => {
  const [currentMonth, setCurrentMonth] = useState(() => {
    return selectedDate ? startOfMonth(selectedDate) : startOfMonth(new Date());
  });

  const monthName = format(currentMonth, "MMMM");
  const year = format(currentMonth, "yyyy");

  const dayHeaders = useMemo(() => {
    const weekStart = startOfWeek(new Date(), { weekStartsOn: 1 }); // Monday
    return eachDayOfInterval({
      start: weekStart,
      end: new Date(weekStart.getTime() + 6 * 24 * 60 * 60 * 1000),
    }).map((date) => format(date, "EEEEEE")); // Shortest localized day name
  }, []);

  const days = useMemo(() => {
    const monthStart = startOfMonth(currentMonth);
    const monthEnd = endOfMonth(currentMonth);
    const calendarStart = startOfWeek(monthStart, { weekStartsOn: 1 }); // Monday
    const calendarEnd = endOfWeek(monthEnd, { weekStartsOn: 1 }); // Monday

    return eachDayOfInterval({ start: calendarStart, end: calendarEnd }).map(
      (date) => {
        const dateString = format(date, "yyyy-MM-dd");
        return {
          date: dateString,
          isToday: isToday(date),
          isSelected: selectedDate ? isSameDay(date, selectedDate) : false,
          isCurrentMonth: date >= monthStart && date <= monthEnd,
          dateObj: date,
        };
      },
    );
  }, [currentMonth, selectedDate]);

  const handlePreviousMonth = () => {
    setCurrentMonth(subMonths(currentMonth, 1));
  };

  const handleNextMonth = () => {
    setCurrentMonth(addMonths(currentMonth, 1));
  };

  const handleDateClick = (date: Date, e: React.MouseEvent) => {
    e.stopPropagation();
    // If clicking the same date that's already selected, unselect it
    if (selectedDate && isSameDay(date, selectedDate)) {
      onDateSelect?.(undefined);
    } else {
      onDateSelect?.(date);
    }
  };

  return (
    <div className="w-[250px] p-4">
      <div className="flex items-center text-light-1000 dark:text-dark-1000">
        <button
          type="button"
          onClick={handlePreviousMonth}
          className="flex flex-none items-center justify-center p-1.5 text-light-700 hover:text-light-900 dark:text-dark-700 dark:hover:text-dark-1000"
        >
          <span className="sr-only">Previous month</span>
          <HiChevronLeft aria-hidden="true" className="h-4 w-4" />
        </button>
        <div className="flex-1 text-center text-sm font-semibold">
          {monthName} {year}
        </div>
        <button
          type="button"
          onClick={handleNextMonth}
          className="flex flex-none items-center justify-center p-1.5 text-light-700 hover:text-light-900 dark:text-dark-700 dark:hover:text-dark-1000"
        >
          <span className="sr-only">Next month</span>
          <HiChevronRight aria-hidden="true" className="h-4 w-4" />
        </button>
      </div>
      <div className="mt-6 grid grid-cols-7 text-center text-xs/6 text-light-950 dark:text-dark-950">
        {dayHeaders.map((day, index) => (
          <div key={index}>{day}</div>
        ))}
      </div>
      <div className="isolate mt-2 grid grid-cols-7 text-sm">
        {days.map((day) => (
          <button
            key={day.date}
            type="button"
            onClick={(e) => handleDateClick(day.dateObj, e)}
            className={twMerge(
              "flex aspect-square items-center justify-center rounded-lg focus:z-10",
              day.isSelected
                ? "bg-light-1000 hover:bg-light-1000 dark:bg-dark-1000 dark:hover:bg-dark-1000"
                : "bg-transparent hover:bg-light-200 dark:bg-transparent dark:hover:bg-dark-200",
            )}
          >
            <time
              dateTime={day.date}
              className={twMerge(
                "mx-auto flex size-7 items-center justify-center rounded-full text-light-900 dark:text-dark-900",
                day.isCurrentMonth
                  ? "text-light-900 dark:text-dark-900"
                  : "text-light-700 dark:text-dark-600",
                day.isSelected && "text-light-50 dark:text-dark-50",
              )}
            >
              {day.date.split("-").pop()?.replace(/^0/, "")}
            </time>
          </button>
        ))}
      </div>
    </div>
  );
};

export default DateSelector;



================================================
FILE: apps/web/src/components/DeleteLabelConfirmation.tsx
================================================
import { t } from "@lingui/core/macro";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

export function DeleteLabelConfirmation({
  labelPublicId,
  refetch,
}: {
  labelPublicId: string;
  refetch: () => void;
}) {
  const { closeModal, closeModals } = useModal();
  const { showPopup } = usePopup();

  const deleteLabelMutation = api.label.delete.useMutation({
    onSuccess: () => {
      refetch();
      closeModals(2);
    },
    onError: () =>
      showPopup({
        header: t`Error deleting label`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      }),
  });

  const handleDeleteLabel = () => {
    deleteLabelMutation.mutate({
      labelPublicId,
    });
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          {t`Are you sure you want to delete this label?`}
        </h2>
        <p className="text-sm font-medium text-light-900 dark:text-dark-900">
          {t`This action can't be undone.`}
        </p>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button variant="secondary" onClick={() => closeModal()}>
          {t`Cancel`}
        </Button>
        <Button onClick={handleDeleteLabel}>{t`Delete`}</Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/components/Dropdown.tsx
================================================
import { Menu, Transition } from "@headlessui/react";
import { Fragment } from "react";

export default function Dropdown({
  items,
  children,
  disabled,
}: {
  items: { label: string; action?: () => void; icon?: React.ReactNode; disabled?: boolean }[];
  children: React.ReactNode;
  disabled?: boolean;
}) {
  return (
    <Menu as="div" className="relative inline-block text-left">
      <div>
        <Menu.Button
          disabled={disabled}
          className="flex h-7 w-7 items-center justify-center rounded-[5px] hover:bg-light-200 focus:outline-none dark:hover:bg-dark-200"
        >
          {children}
        </Menu.Button>
      </div>

      <Transition
        as={Fragment}
        enter="transition ease-out duration-100"
        enterFrom="transform opacity-0 scale-95"
        enterTo="transform opacity-100 scale-100"
        leave="transition ease-in duration-75"
        leaveFrom="transform opacity-100 scale-100"
        leaveTo="transform opacity-0 scale-95"
      >
        <Menu.Items className="absolute right-0 z-[100] isolate mt-2 w-56 origin-top-right rounded-md border border-light-200 bg-white p-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:border-dark-400 dark:bg-dark-300">
          <div className="flex flex-col">
            {items.map((item) => (
              <Menu.Item key={item.label} disabled={item.disabled}>
                <button
                  onClick={item.action}
                  disabled={item.disabled ?? !item.action}
                  className="flex w-auto items-center gap-2 rounded-[5px] px-2.5 py-1.5 text-left text-sm text-neutral-900 hover:bg-light-200 disabled:cursor-not-allowed disabled:opacity-60 dark:text-dark-950 dark:hover:bg-dark-400"
                >
                  {item.icon}
                  {item.label}
                </button>
              </Menu.Item>
            ))}
          </div>
        </Menu.Items>
      </Transition>
    </Menu>
  );
}



================================================
FILE: apps/web/src/components/Editor.tsx
================================================
import type { Range as TiptapRange } from "@tiptap/core";
import type { Editor as TiptapEditor } from "@tiptap/react";
import type {
  SuggestionKeyDownProps,
  SuggestionOptions,
} from "@tiptap/suggestion";
import type { Instance as TippyInstance } from "tippy.js";
import { Button } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import Link from "@tiptap/extension-link";
import Mention from "@tiptap/extension-mention";
import Placeholder from "@tiptap/extension-placeholder";
import {
  BubbleMenu,
  EditorContent,
  Extension,
  ReactRenderer,
  useEditor,
} from "@tiptap/react";
import Typography from "@tiptap/extension-typography";
import StarterKit from "@tiptap/starter-kit";
import Suggestion from "@tiptap/suggestion";
import {
  forwardRef,
  useEffect,
  useImperativeHandle,
  useRef,
  useState,
} from "react";
import {
  HiH1,
  HiH2,
  HiH3,
  HiOutlineBold,
  HiOutlineChatBubbleLeftEllipsis,
  HiOutlineCodeBracket,
  HiOutlineCodeBracketSquare,
  HiOutlineItalic,
  HiOutlineListBullet,
  HiOutlineNumberedList,
  HiOutlineStrikethrough,
} from "react-icons/hi2";
import { twMerge } from "tailwind-merge";
import tippy from "tippy.js";
import { Markdown } from "tiptap-markdown";

import { getAvatarUrl } from "~/utils/helpers";
import Avatar from "./Avatar";
import { YouTubeNode } from "./YouTubeEmbed/YouTubeNode";

declare module "@tiptap/core" {
  interface Commands<ReturnType> {
    slashSuggestion: {
      setSlashSuggestion: () => ReturnType;
    };
  }
}

export interface SlashCommandItem {
  title: string;
  icon?: React.ReactNode;
  command?: (props: { editor: TiptapEditor; range: TiptapRange }) => void;
  disabled?: boolean;
}

export interface SlashCommandsOptions {
  suggestion?: Partial<SuggestionOptions>;
  commandItems?: SlashCommandItem[];
  options?: any;
}

function filterSlashCommandItems(items: SlashCommandItem[], query: string) {
  return items.filter((item) =>
    item.title.toLowerCase().includes(query.toLowerCase()),
  );
}

export interface RenderSuggestionsProps {
  editor: TiptapEditor;
  clientRect: () => DOMRect;
  items: SlashCommandItem[];
  command: (item: SlashCommandItem) => void;
}

export interface WorkspaceMember {
  publicId: string;
  user: {
    id: string;
    name: string | null;
    image: string | null;
  } | null;
  email: string;
}

const CommandsList = forwardRef<
  { onKeyDown: (props: SuggestionKeyDownProps) => boolean },
  {
    items: SlashCommandItem[];
    command: (item: SlashCommandItem) => void;
  }
>(({ items, command }, ref) => {
  const [selectedIndex, setSelectedIndex] = useState(0);

  useImperativeHandle(ref, () => ({
    onKeyDown: ({ event }: SuggestionKeyDownProps) => {
      if (event.key === "ArrowUp") {
        setSelectedIndex((selectedIndex + items.length - 1) % items.length);
        return true;
      }

      if (event.key === "ArrowDown") {
        setSelectedIndex((selectedIndex + 1) % items.length);
        return true;
      }

      if (event.key === "Enter") {
        const item = items[selectedIndex];
        if (item) {
          command(item);
        }
        return true;
      }

      return false;
    },
  }));

  return (
    <div className="w-56 rounded-md border-[1px] border-light-200 bg-light-50 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:border-dark-500 dark:bg-dark-200">
      <div className="max-h-[350px] overflow-y-auto p-1">
        {items.map((item, index) => (
          <button
            key={item.title}
            onClick={() => command(item)}
            className={twMerge(
              "group flex w-full items-center rounded-[5px] p-2 hover:bg-light-200 dark:hover:bg-dark-300",
              index === selectedIndex && "bg-light-200 dark:bg-dark-300",
            )}
          >
            <span className="text-dark-700 dark:text-dark-800">
              {item.icon}
            </span>
            <span className="ml-3 text-[12px] font-medium text-dark-900 dark:text-dark-1000">
              {item.title}
            </span>
          </button>
        ))}
      </div>
    </div>
  );
});

CommandsList.displayName = "CommandsList";

const RenderSuggestions = () => {
  let reactRenderer: ReactRenderer;
  let popup: TippyInstance[];

  return {
    onStart: (props: RenderSuggestionsProps) => {
      reactRenderer = new ReactRenderer(CommandsList, {
        props,
        editor: props.editor,
      });

      if (!props.clientRect) return;

      popup = tippy("body", {
        getReferenceClientRect: props.clientRect,
        appendTo: () => document.body,
        content: reactRenderer.element,
        showOnCreate: true,
        interactive: true,
        trigger: "manual",
        placement: "bottom-start",
      });
    },
    onUpdate(props: RenderSuggestionsProps) {
      reactRenderer.updateProps(props);

      if (!props.clientRect) return;

      popup[0]?.setProps({
        getReferenceClientRect: props.clientRect,
      });
    },
    onKeyDown(props: SuggestionKeyDownProps): boolean {
      if (props.event.key === "Escape") {
        popup[0]?.hide();
        return true;
      }

      return (
        (
          reactRenderer.ref as {
            onKeyDown?: (props: SuggestionKeyDownProps) => boolean;
          }
        ).onKeyDown?.(props) ?? false
      );
    },
    onExit() {
      popup[0]?.destroy();
      reactRenderer.destroy();
    },
  };
};

interface MentionItem {
  id: string;
  label: string;
  image: string | null;
}

const MentionList = forwardRef<
  { onKeyDown: (props: SuggestionKeyDownProps) => boolean },
  {
    items: MentionItem[];
    command: (item: MentionItem) => void;
  }
>(({ items, command }, ref) => {
  const [selectedIndex, setSelectedIndex] = useState(0);

  useImperativeHandle(ref, () => ({
    onKeyDown: ({ event }: SuggestionKeyDownProps) => {
      if (event.key === "ArrowUp") {
        setSelectedIndex((selectedIndex + items.length - 1) % items.length);
        return true;
      }

      if (event.key === "ArrowDown") {
        setSelectedIndex((selectedIndex + 1) % items.length);
        return true;
      }

      if (event.key === "Enter") {
        const item = items[selectedIndex];
        if (item) {
          command(item);
        }
        return true;
      }

      return false;
    },
  }));

  return (
    <div className="w-56 rounded-md border-[1px] border-light-200 bg-light-50 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:border-dark-500 dark:bg-dark-200">
      <div className="max-h-[350px] overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-light-200 dark:scrollbar-thumb-dark-300">
        {items.length > 0 ? (
          items.map((item, index) => (
            <button
              key={item.id}
              onClick={() => command(item)}
              className={twMerge(
                "group flex w-full items-center rounded-[5px] p-2 hover:bg-light-200 dark:hover:bg-dark-300",
                index === selectedIndex && "bg-light-200 dark:bg-dark-300",
              )}
            >
              <Avatar
                size="xs"
                name={item.label}
                imageUrl={item.image ? getAvatarUrl(item.image) : undefined}
                email={item.label}
              />
              <span className="ml-3 text-[12px] font-medium text-dark-900 dark:text-dark-1000">
                {item.label}
              </span>
            </button>
          ))
        ) : (
          <div className="flex items-center justify-start p-2">
            <span className="text-[12px] text-dark-900 dark:text-dark-1000">
              No results
            </span>
          </div>
        )}
      </div>
    </div>
  );
});

MentionList.displayName = "MentionList";

const renderMentionSuggestions = () => {
  let reactRenderer: ReactRenderer;
  let popup: TippyInstance[];

  return {
    onStart: (props: any) => {
      reactRenderer = new ReactRenderer(MentionList, {
        props,
        editor: props.editor,
      });

      if (!props.clientRect) return;

      popup = tippy("body", {
        getReferenceClientRect: props.clientRect,
        appendTo: () => document.body,
        content: reactRenderer.element,
        showOnCreate: true,
        interactive: true,
        trigger: "manual",
        placement: "bottom-start",
      });
    },
    onUpdate(props: any) {
      reactRenderer.updateProps(props);
      if (!props.clientRect) return;
      popup[0]?.setProps({ getReferenceClientRect: props.clientRect });
    },
    onKeyDown(props: SuggestionKeyDownProps) {
      if (props.event.key === "Escape") {
        popup[0]?.hide();
        return true;
      }
      return (
        (
          reactRenderer.ref as {
            onKeyDown?: (props: SuggestionKeyDownProps) => boolean;
          }
        ).onKeyDown?.(props) ?? false
      );
    },
    onExit() {
      popup[0]?.destroy();
      reactRenderer.destroy();
    },
  };
};

const SlashCommands = Extension.create<SlashCommandsOptions>({
  name: "slash-commands",
  addOptions() {
    return {
      suggestion: {
        char: "/",
        command: ({ editor, range, props }) => {
          editor.chain().focus().deleteRange(range).run();
          props.command({ editor, range });
        },
        items: ({ query }: { query: string }) => {
          return filterSlashCommandItems(
            this.parent().commandItems ?? [],
            query,
          );
        },
        render: () => {
          let component: ReturnType<typeof RenderSuggestions>;
          return {
            onStart: (props: any) => {
              component = RenderSuggestions();
              component.onStart(props);
            },
            onUpdate(props: any) {
              component.onUpdate(props);
            },
            onKeyDown(props: any) {
              if (props.event.key === "Escape") {
                return true;
              }
              return component.onKeyDown(props) ?? false;
            },
            onExit: () => {
              component.onExit();
            },
          };
        },
      },
      commandItems: [] as SlashCommandItem[],
    };
  },
  addProseMirrorPlugins() {
    return [
      Suggestion({
        editor: this.editor,
        ...this.options.suggestion,
        render: RenderSuggestions,
      } as SuggestionOptions),
    ];
  },
});

export interface SlashNodeAttrs {
  id: string | null;
  label?: string | null;
}

const getCommandItems = (disableHeadings: boolean): SlashCommandItem[] => {
  const headingCommands: SlashCommandItem[] = disableHeadings
    ? []
    : [
        {
          title: "Heading 1",
          icon: <HiH1 />,
          command: ({ editor }) =>
            editor.chain().focus().setHeading({ level: 1 }).run(),
        },
        {
          title: "Heading 2",
          icon: <HiH2 />,
          command: ({ editor }) =>
            editor.chain().focus().setHeading({ level: 2 }).run(),
        },
        {
          title: "Heading 3",
          icon: <HiH3 />,
          command: ({ editor }) =>
            editor.chain().focus().setHeading({ level: 3 }).run(),
        },
      ];

  return [
    ...headingCommands,
    {
      title: "Bullet List",
      icon: <HiOutlineListBullet />,
      command: ({ editor }) => editor.chain().focus().toggleBulletList().run(),
    },
    {
      title: "Ordered List",
      icon: <HiOutlineNumberedList />,
      command: ({ editor }) => editor.chain().focus().toggleOrderedList().run(),
    },
    {
      title: "Blockquote",
      icon: <HiOutlineChatBubbleLeftEllipsis />,
      command: ({ editor }) => editor.chain().focus().toggleBlockquote().run(),
    },
    {
      title: "Code Block",
      icon: <HiOutlineCodeBracketSquare />,
      command: ({ editor }) => editor.chain().focus().toggleCodeBlock().run(),
    },
  ];
};

export default function Editor({
  content,
  onChange,
  onBlur,
  readOnly = false,
  workspaceMembers,
  enableYouTubeEmbed = true,
  placeholder,
  disableHeadings = false,
}: {
  content: string | null;
  onChange?: (value: string) => void;
  onBlur?: () => void;
  readOnly?: boolean;
  workspaceMembers: WorkspaceMember[];
  enableYouTubeEmbed?: boolean;
  placeholder?: string;
  disableHeadings?: boolean;
}) {
  const containerRef = useRef<HTMLDivElement>(null);

  const editor = useEditor(
    {
      extensions: [
        StarterKit.configure({
          heading: disableHeadings ? false : undefined,
        }),
        Markdown,
        Placeholder.configure({
          placeholder: readOnly
            ? ""
            : placeholder ??
              t`Add description... (type '/' to open commands or '@' to mention)`,
        }),
        Link.configure({
          openOnClick: true,
          HTMLAttributes: {
            class: "text-blue-600 hover:text-blue-800 underline cursor-pointer",
            target: "_blank",
            rel: "noopener noreferrer",
          },
          validate: (href) => /^https?:\/\//.test(href),
          autolink: true,
        }),
        SlashCommands.configure({
          commandItems: getCommandItems(disableHeadings),
          suggestion: {
            items: ({ query }: { query: string }) =>
              filterSlashCommandItems(getCommandItems(disableHeadings), query),
            startOfLine: true,
            char: "/",
          },
        }),
        Mention.configure({
          HTMLAttributes: {
            class: "mention",
          },
          suggestion: {
            char: "@",
            items: ({ query }: { query: string }) => {
              const withEmail = workspaceMembers.filter((member) => member.email);
              
              const mapped = withEmail.map((member: WorkspaceMember) => ({
                id: member.publicId,
                label: member?.user?.name?.trim() || member.email || "",
                image: member?.user?.image ?? null,
              }));
              
              const all: MentionItem[] = mapped.filter(
                (item) => item.label && item.label.length > 0,
              );
              
              const q = query.toLowerCase().trim();
              
              if (q === "") {
                return all;
              }
              
              const filtered = all.filter((u) =>
                u.label.toLowerCase().includes(q),
              );
              return filtered;
            },
            command: ({ editor, range, props }) => {
              const id = props.id ?? "";
              const label = props.label ?? "";
              const mentionHTML = `<span data-type="mention" data-id="${id}" data-label="${label}">@${label}</span>&nbsp;`;

              editor
                .chain()
                .focus()
                .deleteRange(range)
                .insertContent(mentionHTML)
                .focus()
                .run();
            },
            render: renderMentionSuggestions,
          },
          renderText({ options, node }) {
            return `${options.suggestion.char}${node.attrs.label ?? node.attrs.id}`;
          },
        }),
        Typography.configure({
            openDoubleQuote: false,
            closeDoubleQuote: false,
            openSingleQuote: false,
            closeSingleQuote: false,
            oneHalf: false,
            oneQuarter: false,
            threeQuarters: false,
            superscriptTwo: false,
            superscriptThree: false,
        }),
        ...(enableYouTubeEmbed ? [YouTubeNode] : []),
      ],
      content,
      onUpdate: ({ editor }) => onChange?.(editor.getHTML()),
      onBlur: ({ event }) => {
        if (
          document
            .querySelector(".tippy-box")
            ?.contains(event.relatedTarget as Node)
        )
          return;
        // Only trigger onBlur if the click was outside both the editor and menu
        if (!containerRef.current?.contains(event.relatedTarget as Node)) {
          onBlur?.();
        }
      },
      editorProps: {
        attributes: {
          class: "outline-none focus:outline-none focus-visible:ring-0",
        },
      },
      editable: !readOnly,
      injectCSS: false,
    },
    [], // creating the editor only once
  );

  // this will sync external content changes without re-creating the editor instance
  useEffect(() => {
    if (!editor) return;
    const currentHTML = editor.getHTML();
    const safeContent = content ?? "";
    if (safeContent !== currentHTML) {
      editor.commands.setContent(safeContent, false);
    }
  }, [content, editor]);

  return (
    <div ref={containerRef}>
      <style jsx global>{`
        .tiptap p.is-empty::before {
          content: attr(data-placeholder);
          float: left;
          height: 0;
          pointer-events: none;
        }
        .tiptap p {
          margin: 0 0 1rem 0 !important;
        }
        .tiptap .mention {
          background-color: rgba(59, 130, 246, 0.1);
          border-radius: 0.25rem;
          padding: 0.125rem 0.25rem;
          color: rgb(59, 130, 246);
          text-decoration: none;
          font-weight: 500;
        }
        .tiptap [data-youtube] {
          margin: 1rem 0;
        }
      `}</style>
      {!readOnly && editor && <EditorBubbleMenu editor={editor} />}
      <EditorContent
        editor={editor}
        className="prose dark:prose-invert prose-sm max-w-none overflow-y-auto [&_blockquote]:!text-xs [&_h1]:!text-lg [&_h2]:!text-base [&_h3]:!text-sm [&_ol]:!text-xs [&_p.is-empty::before]:text-light-900 [&_p.is-empty::before]:dark:text-dark-800 [&_p]:!text-sm [&_p]:text-light-950 [&_p]:dark:text-dark-950 [&_ul]:!text-xs"
      />
    </div>
  );
}

function EditorBubbleMenu({ editor }: { editor: TiptapEditor | null }) {
  const isMac = navigator.platform.includes("Mac");

  const bubbleMenuItems = [
    {
      title: "Bold",
      icon: <HiOutlineBold />,
      keys: ["meta", "b"],
      onClick: () => editor?.chain().focus().toggleBold().run(),
      active: editor?.isActive("bold"),
    },
    {
      title: "Italic",
      icon: <HiOutlineItalic />,
      keys: ["meta", "i"],
      onClick: () => editor?.chain().focus().toggleItalic().run(),
      active: editor?.isActive("italic"),
    },
    {
      title: "Strikethrough",
      icon: <HiOutlineStrikethrough />,
      keys: ["meta", "shift", "s"],
      onClick: () => editor?.chain().focus().toggleStrike().run(),
      active: editor?.isActive("strike"),
    },
    {
      title: "Code",
      icon: <HiOutlineCodeBracket />,
      keys: ["meta", "e"],
      onClick: () => editor?.chain().focus().toggleCode().run(),
      active: editor?.isActive("code"),
    },
  ];
  return (
    <BubbleMenu editor={editor}>
      <div className="flex items-center gap-2 rounded-md border border-light-600 bg-light-50 p-1 dark:border-dark-600 dark:bg-dark-50">
        {bubbleMenuItems.map((item) => (
          <Button
            key={item.title}
            className={twMerge(
              "rounded p-1 text-light-900 focus:ring-2 focus:ring-light-600 dark:text-dark-900 dark:focus:ring-dark-600",
              item.active && "bg-light-100 dark:bg-dark-400",
            )}
            title={`${item.title} [${item.keys.join(" + ").replace("meta", isMac ? "âŒ˜" : "ctrl")}]`}
            onClick={item.onClick}
            tabIndex={0}
            onKeyDown={(e) => {
              if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                item.onClick();
              }
            }}
          >
            {item.icon}
          </Button>
        ))}
      </div>
    </BubbleMenu>
  );
}



================================================
FILE: apps/web/src/components/FeedbackModal.tsx
================================================
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { useEffect } from "react";
import { useForm } from "react-hook-form";
import { HiXMark } from "react-icons/hi2";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

interface NewFeedbackFormInput {
  feedback: string;
}

export default function FeedbackModal() {
  const { closeModal } = useModal();
  const { showPopup } = usePopup();

  const { handleSubmit, setValue, watch, reset } =
    useForm<NewFeedbackFormInput>({
      defaultValues: {
        feedback: "",
      },
    });

  const createFeedback = api.feedback.create.useMutation({
    onSuccess: async () => {
      reset();
      closeModal();
      showPopup({
        header: t`Feedback sent`,
        message: t`Thank you for your feedback!`,
        icon: "success",
      });
    },
    onError: async () => {
      showPopup({
        header: t`Unable to send feedback`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const onSubmit = (values: NewFeedbackFormInput) => {
    createFeedback.mutate({
      feedback: values.feedback,
      url: window.location.href,
    });
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-4">
          <h2 className="text-sm font-bold text-neutral-900 dark:text-dark-1000">
            {t`Feedback`}
          </h2>
          <button
            type="button"
            className="rounded p-1 hover:bg-light-200 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>

        <Input
          id="feedback"
          placeholder={t`Ideas to improve this page...`}
          onChange={(e) => setValue("feedback", e.target.value)}
          contentEditable
          value={watch("feedback")}
          className="min-h-[120px]"
          onKeyDown={async (e) => {
            e.stopPropagation();
            if (e.key === "Enter" && e.shiftKey) {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
            if (e.key === "Escape") {
              closeModal();
            }
          }}
        />
      </div>
      <div className="mt-6 flex items-center justify-between border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <div className="text-xs text-neutral-600 dark:text-dark-800">
          <p>
            {t`Need help?`}{" "}
            <Link
              href="mailto:support@kan.bn"
              className="text-blue-600 underline dark:text-blue-300"
            >
              {t`Contact us`}
            </Link>
            {t`, or see our`}{" "}
            <Link
              href="https://docs.kan.bn"
              target="_blank"
              rel="noreferrer"
              className="text-blue-600 underline dark:text-blue-300"
            >
              {t`docs`}
            </Link>
            .
          </p>
        </div>
        <div>
          <Button type="submit" isLoading={createFeedback.isPending}>
            {t`Send feedback`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/components/Input.tsx
================================================
import React, { forwardRef, useState } from "react";
import ContentEditable from "react-contenteditable";
import { HiOutlineEye, HiOutlineEyeSlash } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  contentEditable?: boolean;
  prefix?: string;
  iconRight?: React.ReactNode;
  minHeight?: number;
  value?: string;
  errorMessage?: string;
  className?: string;
  onChange?: (
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>,
  ) => void;
  onKeyDown?: (e: React.KeyboardEvent) => void;
  type?: string;
}

const Input = forwardRef<HTMLInputElement, InputProps>(
  (
    {
      contentEditable,
      errorMessage,
      prefix,
      value,
      onChange,
      onKeyDown,
      iconRight,
      className,
      type = "text",
      ...props
    },
    ref,
  ) => {
    const [showPassword, setShowPassword] = useState(false);

    if (contentEditable) {
      return (
        <ContentEditable
          placeholder={props.placeholder}
          html={value ?? ""}
          onChange={onChange}
          onKeyDown={onKeyDown}
          className={twMerge(
            "block min-h-[70px] w-full cursor-text overflow-y-auto rounded-md border-0 bg-dark-300 bg-white/5 px-3 py-1.5 text-light-900 shadow-sm ring-1 ring-inset ring-light-600 focus:ring-2 focus:ring-inset focus:ring-light-600 focus-visible:outline-none dark:text-dark-1000 dark:ring-dark-700 dark:focus:ring-dark-700 sm:text-sm sm:leading-6",
            className && className,
          )}
        />
      );
    }

    return (
      <div className="flex w-full flex-col gap-1">
        <div className="relative flex">
          {prefix && (
            <div className="flex shrink-0 items-center rounded-l-md border border-r-0 border-light-600 px-3 text-sm dark:border-dark-700 dark:text-dark-1000 sm:text-sm/6">
              {prefix}
            </div>
          )}
          <input
            ref={ref}
            value={value}
            onChange={onChange}
            type={type === "password" && showPassword ? "text" : type}
            className={twMerge(
              "block w-full rounded-md border-0 bg-dark-300 bg-white/5 py-1.5 text-sm shadow-sm ring-1 ring-inset ring-light-600 placeholder:text-dark-800 focus:ring-2 focus:ring-inset focus:ring-light-700 dark:text-dark-1000 dark:ring-dark-700 dark:focus:ring-dark-700 sm:leading-6",
              prefix && "rounded-l-none",
              type === "password" && "pr-8",
              className && className,
            )}
            onKeyDown={onKeyDown}
            {...props}
          />
          {type === "password" && (
            <button
              type="button"
              className="absolute right-3 top-1/2 -translate-y-1/2 text-xs text-light-900 dark:text-dark-900"
              tabIndex={-1}
              onClick={() => setShowPassword((v) => !v)}
            >
              {showPassword ? (
                <HiOutlineEyeSlash className="h-4 w-4" />
              ) : (
                <HiOutlineEye className="h-4 w-4" />
              )}
            </button>
          )}
          {iconRight && type !== "password" && (
            <div className="absolute right-3 top-1/2 -translate-y-1/2">
              {iconRight}
            </div>
          )}
        </div>
        {errorMessage && (
          <div className="text-xs text-red-500">{errorMessage}</div>
        )}
      </div>
    );
  },
);

Input.displayName = "Input";

export default Input;



================================================
FILE: apps/web/src/components/LabelForm.tsx
================================================
import { Listbox, Transition } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { Fragment, useEffect } from "react";
import { Controller, useForm } from "react-hook-form";
import { HiChevronUpDown, HiXMark } from "react-icons/hi2";

import { colours } from "@kan/shared/constants";

import Button from "~/components/Button";
import Input from "~/components/Input";
import Toggle from "~/components/Toggle";
import { useModal } from "~/providers/modal";
import { api } from "~/utils/api";

interface LabelFormInput {
  name: string;
  colour: Colour;
  isCreateAnotherEnabled?: boolean;
}

interface Colour {
  name: string;
  code: string;
}

export function LabelForm({
  boardPublicId,
  refetch,
  isEdit,
}: {
  boardPublicId: string;
  refetch: () => void;
  isEdit?: boolean;
}) {
  const { closeModal, entityId, openModal, setModalState } = useModal();

  const label = api.label.byPublicId.useQuery(
    {
      labelPublicId: entityId,
    },
    {
      enabled: isEdit && !!entityId,
    },
  );

  const { control, register, reset, handleSubmit, setValue, watch } =
    useForm<LabelFormInput>({
      values: {
        name: isEdit && label.data?.name ? label.data.name : "",
        colour: (isEdit && label.data?.colourCode
          ? colours.find((c) => c.code === label.data?.colourCode)
          : colours[0]) as Colour,
        isCreateAnotherEnabled: false,
      },
    });

  const isCreateAnotherEnabled = watch("isCreateAnotherEnabled");

  const createLabel = api.label.create.useMutation({
    onSuccess: (newLabel) => {
      const currentColourIndex = colours.findIndex(
        (c) => c.code === watch("colour").code,
      );
      try {
        refetch();
        setModalState("NEW_LABEL_CREATED", newLabel.publicId);
        if (!isCreateAnotherEnabled) {
          closeModal();
        } else {
          const newFormState = {
            name: "",
            colour: colours[(currentColourIndex + 1) % colours.length],
            isCreateAnotherEnabled,
          };
          reset(newFormState);
        }
      } catch (e) {
        console.log(e);
      }
    },
  });

  const updateLabel = api.label.update.useMutation({
    onSuccess: () => {
      refetch();
      closeModal();
    },
  });

  const onSubmit = (values: LabelFormInput) => {
    if (!values.colour.code) return;

    if (isEdit) {
      updateLabel.mutate({
        labelPublicId: label.data?.publicId ?? "",
        name: values.name,
        colourCode: values.colour.code,
      });
    } else {
      createLabel.mutate({
        name: values.name,
        colourCode: values.colour.code,
        boardPublicId,
      });
    }
  };

  useEffect(() => {
    const nameElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#label-name");
    if (nameElement) nameElement.focus();
  }, []);

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-4 text-neutral-900 dark:text-dark-1000">
          <h2 className="text-sm font-medium">
            {isEdit ? t`Edit label` : t`New label`}
          </h2>
          <button
            type="button"
            className="rounded p-1 hover:bg-light-300 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>

        <Input
          id="label-name"
          placeholder={t`Name`}
          {...register("name")}
          onKeyDown={async (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
          }}
        />
        <Controller
          name="colour"
          control={control}
          render={({ field }) => (
            <Listbox {...field}>
              {({ open }) => (
                <>
                  <div className="relative mt-4">
                    <Listbox.Button className="block w-full rounded-md border-0 bg-white/5 px-4 py-1.5 shadow-sm ring-1 ring-inset ring-light-600 focus:ring-2 focus:ring-inset focus:ring-light-600 dark:bg-dark-300 dark:text-dark-1000 dark:ring-dark-700 dark:focus:ring-dark-700 sm:text-sm sm:leading-6">
                      <span className="flex items-center">
                        <span
                          style={{ backgroundColor: field.value.code }}
                          className={`inline-block h-2 w-2 flex-shrink-0 rounded-full`}
                        />
                        <span className="ml-3 block truncate">
                          {field.value.name}
                        </span>
                      </span>
                      <span className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                        <HiChevronUpDown
                          className="h-5 w-5 text-gray-400"
                          aria-hidden="true"
                        />
                      </span>
                    </Listbox.Button>

                    <Transition
                      show={open}
                      as={Fragment}
                      leave="transition ease-in duration-100"
                      leaveFrom="opacity-100"
                      leaveTo="opacity-0"
                    >
                      <Listbox.Options className="absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-light-50 py-2 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-dark-300 sm:text-sm">
                        {colours.map((colour, index) => (
                          <Listbox.Option
                            key={`colours_${index}`}
                            className="relative cursor-default select-none px-2 text-neutral-900 dark:text-dark-1000"
                            value={colour}
                          >
                            {() => (
                              <>
                                <div className="flex items-center rounded-[5px] p-2 hover:bg-light-200 dark:hover:bg-dark-400">
                                  <span
                                    style={{ backgroundColor: colour.code }}
                                    className="ml-2 inline-block h-2 w-2 flex-shrink-0 rounded-full"
                                    aria-hidden="true"
                                  />
                                  <span className="ml-3 block truncate font-normal">
                                    {colour.name}
                                  </span>
                                </div>
                              </>
                            )}
                          </Listbox.Option>
                        ))}
                      </Listbox.Options>
                    </Transition>
                  </div>
                </>
              )}
            </Listbox>
          )}
        />
      </div>

      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        {!isEdit && (
          <Toggle
            label={t`Create another`}
            isChecked={!!isCreateAnotherEnabled}
            onChange={() =>
              setValue("isCreateAnotherEnabled", !isCreateAnotherEnabled)
            }
          />
        )}

        <div className="space-x-2">
          {isEdit && (
            <Button
              type="button"
              variant="secondary"
              onClick={() => openModal("DELETE_LABEL", entityId)}
            >
              {t`Delete`}
            </Button>
          )}
          <Button
            type="submit"
            isLoading={updateLabel.isPending || createLabel.isPending}
            disabled={
              !watch("name")
            }
          >
            {isEdit ? t`Update label` : t`Create label`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/components/LabelIcon.tsx
================================================
const LabelIcon = ({ colourCode }: { colourCode: string | null }) => (
  <svg
    fill={colourCode ?? "#3730a3"}
    className="h-2 w-2"
    viewBox="0 0 6 6"
    aria-hidden="true"
  >
    <circle cx={3} cy={3} r={3} />
  </svg>
);

export default LabelIcon;



================================================
FILE: apps/web/src/components/LanguageSelector.tsx
================================================
import { HiLanguage } from "react-icons/hi2";

import { useLocalisation } from "~/hooks/useLocalisation";
import { localeNames } from "~/locales";

export function LanguageSelector() {
  const { locale, setLocale, availableLocales } = useLocalisation();

  return (
    <div className="relative">
      <HiLanguage className="pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" />
      <select
        id="language-select"
        value={locale}
        onChange={(e) => setLocale(e.target.value as any)}
        className="mt-8 block w-full max-w-[180px] rounded-lg border-0 bg-light-50 pl-10 text-sm shadow-sm ring-1 ring-inset ring-light-300 focus:ring-2 focus:ring-inset focus:ring-light-400 dark:bg-dark-50 dark:text-dark-1000 dark:ring-dark-300 dark:focus:ring-dark-500"
      >
        {availableLocales.map((loc) => (
          <option key={loc} value={loc}>
            {localeNames[loc]}
          </option>
        ))}
      </select>
    </div>
  );
}



================================================
FILE: apps/web/src/components/LoadingSpinner.tsx
================================================
import { twMerge } from "tailwind-merge";

const LoadingSpinner = ({ size = "md" }: { size?: "sm" | "md" | "lg" }) => {
  return (
    <svg
      className={twMerge(
        "animate-spin",
        size === "sm" && "h-3 w-3",
        size === "md" && "h-4 w-4",
        size === "lg" && "h-5 w-5",
      )}
      viewBox="0 0 100 100"
    >
      <circle
        fill="none"
        stroke-width="10"
        className="stroke-current opacity-40"
        cx="50"
        cy="50"
        r="40"
      />
      <circle
        fill="none"
        stroke-width="10"
        className="stroke-current"
        stroke-dasharray="280"
        stroke-dashoffset="210"
        cx="50"
        cy="50"
        r="40"
      />
    </svg>
  );
};

export default LoadingSpinner;



================================================
FILE: apps/web/src/components/LottieIcon.tsx
================================================
import dynamic from "next/dynamic";

const Lottie = dynamic(() => import("react-lottie-player"), { ssr: false });

interface IconProps {
  isPlaying: boolean;
  index: number;
  json: object;
}

const Icon: React.FC<IconProps> = ({ isPlaying, index, json }) => {
  return (
    <Lottie
      key={index}
      animationData={json}
      play={isPlaying}
      loop={false}
      style={{ width: 18, height: 18, fill: "white" }}
      rendererSettings={{ preserveAspectRatio: "xMidYMid slice" }}
    />
  );
};

export default Icon;



================================================
FILE: apps/web/src/components/modal.tsx
================================================
import { Dialog, Transition } from "@headlessui/react";
import { Fragment } from "react";

import { useModal } from "~/providers/modal";

interface Props {
  children: React.ReactNode;
  modalSize?: "sm" | "md" | "lg";
  positionFromTop?: "sm" | "md" | "lg";
  isVisible?: boolean;
  closeOnClickOutside?: boolean;
  centered?: boolean;
}

const Modal: React.FC<Props> = ({
  children,
  modalSize = "sm",
  positionFromTop = "md",
  isVisible,
  closeOnClickOutside,
  centered = false,
}) => {
  const {
    isOpen,
    closeModal,
    closeOnClickOutside: modalCloseOnClickOutside,
  } = useModal();

  const shouldShow = isVisible ?? isOpen;
  const shouldCloseOnClickOutside =
    closeOnClickOutside ?? modalCloseOnClickOutside;

  const modalSizeMap = {
    sm: "max-w-[400px]",
    md: "max-w-[550px]",
    lg: "max-w-[800px]",
  };

  const positionFromTopMap = {
    sm: "mt-[12vh]",
    md: "mt-[25vh]",
    lg: "mt-[50vh]",
  };

  return (
    <Transition.Root show={shouldShow} as={Fragment}>
      <Dialog
        as="div"
        className="relative z-50"
        onClose={shouldCloseOnClickOutside ? closeModal : () => null}
      >
        <Transition.Child
          as={Fragment}
          enter="ease-out duration-300"
          enterFrom="opacity-0"
          enterTo="opacity-100"
          leave="ease-in duration-200"
          leaveFrom="opacity-100"
          leaveTo="opacity-0"
        >
          <div className="fixed inset-0 bg-light-50 bg-opacity-40 transition-opacity dark:bg-dark-50 dark:bg-opacity-40" />
        </Transition.Child>

        <div className="fixed inset-0 z-50 w-screen overflow-y-auto">
          <div className={`flex min-h-full justify-center p-4 text-center sm:p-0 ${centered ? "items-center" : "items-start sm:items-start"}`}>
            <Transition.Child
              as={Fragment}
              enter="ease-out duration-300"
              enterFrom="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
              enterTo="opacity-100 translate-y-0 sm:scale-100"
              leave="ease-in duration-200"
              leaveFrom="opacity-100 translate-y-0 sm:scale-100"
              leaveTo="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
            >
              <Dialog.Panel
                className={`relative ${centered ? "" : positionFromTopMap[positionFromTop]} w-full transform rounded-lg border border-light-600 bg-white/90 text-left shadow-3xl-light backdrop-blur-[6px] transition-all dark:border-dark-600 dark:bg-dark-100/90 dark:shadow-3xl-dark ${modalSizeMap[modalSize]}`}
              >
                {children}
              </Dialog.Panel>
            </Transition.Child>
          </div>
        </div>
      </Dialog>
    </Transition.Root>
  );
};

export default Modal;



================================================
FILE: apps/web/src/components/NewWorkspaceForm.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useEffect, useState } from "react";
import { useForm } from "react-hook-form";
import {
  HiBolt,
  HiCheck,
  HiCheckBadge,
  HiInformationCircle,
  HiXMark,
} from "react-icons/hi2";
import { twMerge } from "tailwind-merge";
import { z } from "zod";

import Button from "~/components/Button";
import Input from "~/components/Input";
import Toggle from "~/components/Toggle";
import { useDebounce } from "~/hooks/useDebounce";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";
import LoadingSpinner from "./LoadingSpinner";

const schema = z.object({
  name: z
    .string()
    .min(1, { message: t`Workspace name is required` })
    .max(64, { message: t`Workspace name cannot exceed 64 characters` }),
  slug: z
    .string()
    .min(3, {
      message: t`URL must be at least 3 characters long`,
    })
    .max(64, { message: t`URL cannot exceed 64 characters` })
    .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/, {
      message: t`URL can only contain letters, numbers, and hyphens`,
    })
    .optional()
    .or(z.literal("")),
});

type FormValues = z.infer<typeof schema>;

export function NewWorkspaceForm() {
  const { closeModal } = useModal();
  const { showPopup } = usePopup();
  const { switchWorkspace, availableWorkspaces } = useWorkspace();
  const {
    register,
    handleSubmit,
    formState: { errors },
    watch,
    trigger,
    clearErrors,
    setValue,
  } = useForm<FormValues>({
    resolver: zodResolver(schema),
    defaultValues: {
      name: "",
      slug: "",
    },
    mode: "onSubmit",
  });
  const utils = api.useUtils();

  const hasAvailableWorkspaces = availableWorkspaces.length > 0;

  const isCloudEnv = env("NEXT_PUBLIC_KAN_ENV") === "cloud";

  const slug = watch("slug");
  const [debouncedSlug] = useDebounce(slug, 500);
  const isTyping = slug !== debouncedSlug;

  // Pro toggle state management
  const [isProToggleEnabled, setIsProToggleEnabled] = useState(false);
  const [lastAvailableSlug, setLastAvailableSlug] = useState<string>("");

  // Validate slug only after debounce
  useEffect(() => {
    if (isTyping) {
      // Clear errors while typing
      clearErrors("slug");
    } else if (debouncedSlug) {
      // Validate after debounce
      void trigger("slug");
    }
  }, [isTyping, debouncedSlug, trigger, clearErrors]);

  const checkWorkspaceSlugAvailability =
    api.workspace.checkSlugAvailability.useQuery(
      {
        workspaceSlug: debouncedSlug ?? "",
      },
      {
        enabled: !!debouncedSlug && debouncedSlug.length >= 3 && !errors.slug,
      },
    );

  const isWorkspaceSlugAvailable = checkWorkspaceSlugAvailability.data;

  const createWorkspace = api.workspace.create.useMutation({
    onSuccess: async (values, variables) => {
      if (values.publicId && values.name) {
        void utils.workspace.all.invalidate();
        switchWorkspace({
          publicId: values.publicId,
          name: values.name,
          description: values.description,
          slug: values.slug,
          plan: values.plan,
          role: "admin",
        });

        // If in cloud and Pro toggle is enabled, create checkout session for pro
        if (env("NEXT_PUBLIC_KAN_ENV") === "cloud" && isProToggleEnabled) {
          try {
            const response = await fetch(
              "/api/stripe/create_checkout_session",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  slug: slug || undefined,
                  workspacePublicId: values.publicId,
                  cancelUrl: "/settings/workspace?upgrade=pro",
                  successUrl: "/boards",
                }),
              },
            );

            const data = await response.json();
            const url = (data as { url: string }).url;

            if (url) {
              window.location.href = url;
              return; // Don't close modal if redirecting to checkout
            }
          } catch (error) {
            console.error("Error creating checkout session:", error);
            showPopup({
              header: t`Error upgrading to Pro`,
              message: t`Workspace created successfully. You can upgrade later in settings.`,
              icon: "warning",
            });
          }
        }

        closeModal();
      }
    },
    onError: () => {
      showPopup({
        header: t`Unable to create workspace`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  useEffect(() => {
    const nameElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#workspace-name");
    if (nameElement) nameElement.focus();
  }, []);

  const [shouldShowBenefits, setShouldShowBenefits] = useState(false);

  const isValidSlug = slug && slug.length >= 3 && !errors.slug;

  useEffect(() => {
    if (
      isCloudEnv &&
      !checkWorkspaceSlugAvailability.isPending &&
      isValidSlug
    ) {
      const isAvailable = isWorkspaceSlugAvailable?.isAvailable === true;
      setShouldShowBenefits(isAvailable);

      // Automatically enable Pro toggle when slug is available
      if (isAvailable) {
        setIsProToggleEnabled(true);
        setLastAvailableSlug(slug);
      }
    }
  }, [
    isValidSlug,
    isWorkspaceSlugAvailable?.isAvailable,
    checkWorkspaceSlugAvailability.isPending,
    slug,
    isCloudEnv,
  ]);

  // Reset benefits when slug becomes invalid
  useEffect(() => {
    if (!isValidSlug) {
      setShouldShowBenefits(false);
    }
  }, [isValidSlug]);

  // Handle Pro toggle changes
  const handleProToggleChange = () => {
    if (isProToggleEnabled) {
      // Turning off: clear the slug and disable Pro
      setValue("slug", "");
      setIsProToggleEnabled(false);
    } else {
      // Turning on: restore the last available slug if we have one
      if (lastAvailableSlug) {
        setValue("slug", lastAvailableSlug);
      }
      setIsProToggleEnabled(true);
    }
  };

  const showProBenefits = isProToggleEnabled;

  const onSubmit = (values: FormValues) => {
    // Don't submit if slug is provided but not available
    if (values.slug && isWorkspaceSlugAvailable?.isAvailable === false) {
      return;
    }

    createWorkspace.mutate({
      name: values.name,
      slug: !isCloudEnv && values.slug ? values.slug : undefined,
    });
  };

  const isSlugAvailable =
    isValidSlug &&
    isWorkspaceSlugAvailable?.isAvailable &&
    !isWorkspaceSlugAvailable?.isReserved;

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-4">
          <h2 className="text-sm font-bold text-neutral-900 dark:text-dark-1000">
            {t`New workspace`}
          </h2>
          <button
            type="button"
            className={twMerge(
              "rounded p-1 hover:bg-light-200 focus:outline-none dark:hover:bg-dark-300",
              !hasAvailableWorkspaces && "invisible",
            )}
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>

        <Input
          id="workspace-name"
          placeholder={t`Workspace name`}
          {...register("name")}
          errorMessage={errors.name?.message}
          onKeyDown={async (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
          }}
        />

        <div className="mt-4">
          <Input
            id="workspace-slug"
            placeholder={t`workspace-url`}
            {...register("slug")}
            className={`${
              isSlugAvailable
                ? "focus:ring-green-500 dark:focus:ring-green-500"
                : ""
            }`}
            errorMessage={
              errors.slug?.message ??
              (isWorkspaceSlugAvailable?.isAvailable === false &&
              isWorkspaceSlugAvailable?.isReserved === false
                ? t`This workspace URL has already been taken`
                : isWorkspaceSlugAvailable?.isReserved
                  ? t`This workspace URL is reserved`
                  : undefined)
            }
            prefix={
              env("NEXT_PUBLIC_KAN_ENV") === "cloud"
                ? "kan.bn/"
                : `${env("NEXT_PUBLIC_BASE_URL")}/`
            }
            iconRight={
              slug && slug.length >= 3 && !errors.slug ? (
                isWorkspaceSlugAvailable?.isAvailable ? (
                  <HiCheck className="h-4 w-4 text-green-500" />
                ) : checkWorkspaceSlugAvailability.isPending || isTyping ? (
                  <LoadingSpinner />
                ) : null
              ) : null
            }
            onKeyDown={async (e) => {
              if (e.key === "Enter") {
                e.preventDefault();
                await handleSubmit(onSubmit)();
              }
            }}
          />

          {slug && slug.length >= 3 && shouldShowBenefits && (
            <div className="mt-2 flex items-center gap-1">
              <HiInformationCircle className="h-4 w-4 text-dark-900" />
              <p className="text-xs text-gray-500 dark:text-dark-900">
                {t`Custom URLs require upgrading to a Pro plan`}
              </p>
            </div>
          )}
        </div>

        {showProBenefits && (
          <div className="mt-6">
            <div className="rounded-md bg-light-100 p-3 text-xs text-light-900 dark:bg-dark-200 dark:text-dark-900">
              <div className="space-y-3">
                <div className="flex items-center space-x-3">
                  <HiCheckBadge className="h-[18px] w-[18px] flex-shrink-0 text-light-1000 dark:text-dark-950" />
                  <div className="flex items-center space-x-2">
                    <span className="text-xs text-neutral-900 dark:text-dark-1000">
                      {t`Unlimited members`}
                    </span>
                    <span className="inline-flex items-center rounded-full bg-emerald-500/10 px-2 py-0.5 text-[10px] font-medium text-emerald-600 ring-1 ring-inset ring-emerald-500/20 dark:text-emerald-400 sm:text-[10px]">
                      {t`Launch offer`}
                    </span>
                  </div>
                </div>
                <div className="flex items-center space-x-3">
                  <HiCheckBadge className="h-[18px] w-[18px] flex-shrink-0 text-light-1000 dark:text-dark-950" />
                  <span className="text-xs text-neutral-900 dark:text-dark-1000">
                    {t`Custom workspace URL`}
                  </span>
                </div>
                <div className="flex items-center space-x-3">
                  <HiCheckBadge className="h-[18px] w-[18px] flex-shrink-0 text-light-1000 dark:text-dark-950" />
                  <div className="flex items-center space-x-2">
                    <span className="text-xs text-neutral-900 dark:text-dark-1000">
                      {t`Board analytics`}
                    </span>
                    <span className="inline-flex items-center rounded-full bg-gray-500/10 px-2 py-0.5 text-[10px] font-medium text-gray-600 ring-1 ring-inset ring-gray-500/20 dark:text-gray-400 sm:text-[10px]">
                      {t`Coming soon`}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
      <div
        className={twMerge(
          "mt-6 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600",
          !showProBenefits && "mt-12",
        )}
      >
        {/* Pro Toggle - only show in cloud environment */}
        {isCloudEnv && (
          <Toggle
            isChecked={isProToggleEnabled}
            onChange={handleProToggleChange}
            label={t`Upgrade to Pro ($29/month)`}
          />
        )}
        <div>
          <Button
            type="submit"
            isLoading={createWorkspace.isPending}
            disabled={
              createWorkspace.isPending ||
              (!!slug &&
                (checkWorkspaceSlugAvailability.isPending ||
                  isWorkspaceSlugAvailable?.isAvailable === false ||
                  isTyping))
            }
          >
            {t`Create workspace`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/components/PageHead.tsx
================================================
import Head from "next/head";

export const PageHead = ({ title }: { title: string }) => {
  return (
    <Head>
      <title>{title}</title>
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
    </Head>
  );
};



================================================
FILE: apps/web/src/components/PatternedBackground.tsx
================================================
const PatternedBackground = () => (
  <div className="absolute inset-0 h-full w-full">
    <svg className="h-full w-full">
      <pattern
        id="pattern"
        x="10"
        y="10"
        width="14.423223834988539"
        height="14.423223834988539"
        patternUnits="userSpaceOnUse"
        patternTransform="translate(-0.45072574484339184,-0.45072574484339184)"
      >
        <circle
          cx="0.45072574484339184"
          cy="0.45072574484339184"
          r="0.45072574484339184"
          fill="#3e3e3e"
        ></circle>
      </pattern>
      <rect x="0" y="0" width="100%" height="100%" fill="url(#pattern)"></rect>
    </svg>
  </div>
);

export default PatternedBackground;



================================================
FILE: apps/web/src/components/Popup.tsx
================================================
import { Transition } from "@headlessui/react";
import { useEffect } from "react";
import {
  HiOutlineCheckCircle,
  HiOutlineExclamationCircle,
  HiXMark,
} from "react-icons/hi2";

import { usePopup } from "~/providers/popup";

const Popup: React.FC = () => {
  const { isOpen, popupHeader, popupMessage, popupIcon, hidePopup } =
    usePopup();

  useEffect(() => {
    if (isOpen) {
      const timer = setTimeout(() => {
        hidePopup();
      }, 5000);

      return () => clearTimeout(timer);
    }
  }, [isOpen, hidePopup]);

  return (
    <div
      aria-live="assertive"
      className="pointer-events-none fixed inset-0 z-10 flex items-end p-3 sm:items-end m-3"
    >
      <div className="flex w-full flex-col items-center space-y-4 sm:items-end">
        <Transition
          show={isOpen}
          enter="ease-out duration-300"
          enterFrom="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          enterTo="opacity-100 translate-y-0 sm:scale-100"
          leave="ease-in duration-200"
          leaveFrom="opacity-100 translate-y-0 sm:scale-100"
          leaveTo="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        >
          <div className="pointer-events-auto w-full max-w-[350px] overflow-hidden rounded-xl border border-light-400 bg-light-50 shadow-lg ring-opacity-5 transition data-[closed]:data-[enter]:translate-y-2 data-[enter]:transform data-[closed]:opacity-0 data-[enter]:duration-300 data-[leave]:duration-100 data-[enter]:ease-out data-[leave]:ease-in dark:border-dark-300 dark:bg-dark-100 data-[closed]:data-[enter]:sm:translate-x-2 data-[closed]:data-[enter]:sm:translate-y-0">
            <div className="p-4 relative">
              <div className="flex items-start">
                <div className="flex-shrink-0 mt-1">
                  {popupIcon === "success" && (
                    <HiOutlineCheckCircle
                      aria-hidden="true"
                      className="h-5 w-5 text-green-400"
                    />
                  )}
                  {popupIcon === "error" && (
                    <HiOutlineExclamationCircle
                      aria-hidden="true"
                      className="h-5 w-5 text-red-400"
                    />
                  )}
                </div>
                <div className="ml-3 w-0 flex-1 pt-0.5">
                  <p className="text-[12px] font-bold text-neutral-900 dark:text-dark-950">
                    {popupHeader}
                  </p>
                  <p className="mt-1 text-[12px] text-neutral-500 dark:text-dark-900">
                    {popupMessage}
                  </p>
                </div>
                <div className="ml-4 flex flex-shrink-0 absolute right-3 top-3">
                  <button
                    type="button"
                    onClick={() => {
                      hidePopup();
                    }}
                    className="inline-flex h-fit items-center rounded-md p-1 px-1 text-sm font-semibold text-dark-50 hover:bg-light-100 dark:hover:bg-dark-200"
                  >
                    <span className="sr-only">Close</span>
                    <HiXMark
                      aria-hidden="true"
                      className="h-4 w-4 text-dark-900"
                    />
                  </button>
                </div>
              </div>
            </div>
          </div>
        </Transition>
      </div>
    </div>
  );
};

export default Popup;



================================================
FILE: apps/web/src/components/ReactiveButton.tsx
================================================
import Link from "next/link";
import { useState } from "react";
import { twMerge } from "tailwind-merge";

import type { KeyboardShortcut } from "~/providers/keyboard-shortcuts";
import LottieIcon from "~/components/LottieIcon";
import { useIsMobile } from "~/hooks/useMediaQuery";
import { useKeyboardShortcut } from "~/providers/keyboard-shortcuts";

const Button: React.FC<{
  href: string;
  current: boolean;
  name: string;
  json: object;
  isCollapsed?: boolean;
  onCloseSideNav?: () => void;
  keyboardShortcut: KeyboardShortcut;
}> = ({
  href,
  current,
  name,
  json,
  isCollapsed = false,
  keyboardShortcut,
  onCloseSideNav,
}) => {
  const [isHovered, setIsHovered] = useState(false);
  const [index, setIndex] = useState(0);
  const isMobile = useIsMobile();
  const { keys: shortcutKeys } = useKeyboardShortcut(keyboardShortcut);

  const handleMouseEnter = () => {
    setIsHovered(true);
    setIndex((index) => index + 1);
  };

  const handleClick = () => {
    if (onCloseSideNav && isMobile) {
      onCloseSideNav();
    }
  };

  return (
    <Link
      href={href}
      onMouseEnter={handleMouseEnter}
      onClick={handleClick}
      className={twMerge(
        "group flex h-[34px] items-center rounded-md p-1.5 text-sm font-normal leading-6 hover:bg-light-200 hover:text-light-1000 dark:hover:bg-dark-200 dark:hover:text-dark-1000",
        isCollapsed ? "md:justify-center" : "justify-between",
        current
          ? "bg-light-200 text-light-1000 dark:bg-dark-200 dark:text-dark-1000"
          : "text-neutral-600 dark:bg-dark-100 dark:text-dark-900",
      )}
      title={isCollapsed ? name : undefined}
    >
      <div
        className={twMerge(
          "flex items-center",
          isCollapsed
            ? "justify-start gap-x-3 md:justify-center md:gap-x-0"
            : "gap-x-3",
        )}
      >
        <LottieIcon index={index} json={json} isPlaying={isHovered} />
        <span className={twMerge(isCollapsed && "md:hidden")}>{name}</span>
      </div>
      {!isCollapsed && (
        <div className="hidden md:group-hover:inline-flex">{shortcutKeys}</div>
      )}
    </Link>
  );
};

export default Button;



================================================
FILE: apps/web/src/components/SettingsLayout.tsx
================================================
import Link from "next/link";
import { useRouter } from "next/router";
import {
  Listbox,
  ListboxButton,
  ListboxOption,
  ListboxOptions,
} from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useEffect, useState } from "react";
import {
  HiChevronDown,
  HiOutlineBanknotes,
  HiOutlineCodeBracketSquare,
  HiOutlineRectangleGroup,
  HiOutlineShieldCheck,
  HiOutlineUser,
} from "react-icons/hi2";
import { usePermissions } from "~/hooks/usePermissions";
import { useWorkspace } from "~/providers/workspace";

interface SettingsLayoutProps {
  children: React.ReactNode;
  currentTab: string;
}

export function SettingsLayout({ children, currentTab }: SettingsLayoutProps) {
  const router = useRouter();
  const { workspace } = useWorkspace();
  const { canViewWorkspace, canEditWorkspace } = usePermissions();
  const [selectedTabIndex, setSelectedTabIndex] = useState(0);

  const isAdmin = workspace.role === "admin";

  const settingsTabs = [
    {
      key: "account",
      icon: <HiOutlineUser />,
      label: t`Account`,
      condition: true,
    },
    {
      key: "workspace",
      icon: <HiOutlineRectangleGroup />,
      label: t`Workspace`,
      condition: canViewWorkspace,
    },
    {
      key: "permissions",
      icon: <HiOutlineShieldCheck />,
      label: t`Permissions`,
      condition: isAdmin,
    },
    {
      key: "billing",
      label: t`Billing`,
      icon: <HiOutlineBanknotes />,
      condition: env("NEXT_PUBLIC_KAN_ENV") === "cloud" && isAdmin,
    },
    {
      key: "api",
      icon: <HiOutlineCodeBracketSquare />,
      label: t`API`,
      condition: true,
    },
    {
      key: "integrations",
      icon: <HiOutlineCodeBracketSquare />,
      label: t`Integrations`,
      condition: canEditWorkspace,
    },
  ];

  const availableTabs = settingsTabs.filter((tab) => tab.condition);

  // Update selected tab when currentTab prop changes
  useEffect(() => {
    const tabIndex = availableTabs.findIndex((tab) => tab.key === currentTab);
    if (tabIndex !== -1) {
      setSelectedTabIndex(tabIndex);
    }
  }, [currentTab, availableTabs]);

  const isTabActive = (tabKey: string) => {
    return currentTab === tabKey;
  };

  return (
    <div className="flex h-full w-full flex-col overflow-hidden">
      <div className="h-full max-h-[calc(100vdh-3rem)] overflow-y-auto md:max-h-[calc(100vdh-4rem)]">
        <div className="m-auto max-w-[1100px] px-5 py-6 md:px-28 md:py-12">
          <div className="mb-8 flex w-full justify-between">
            <h1 className="font-bold tracking-tight text-neutral-900 dark:text-dark-1000 sm:text-[1.2rem]">
              {t`Settings`}
            </h1>
          </div>

          <div className="focus:outline-none">
            <div className="sm:hidden">
              {/* Mobile dropdown */}
              <Listbox
                value={selectedTabIndex}
                onChange={(index) => {
                  const tabKey = availableTabs[index]?.key;
                  if (tabKey) {
                    void router.push(`/settings/${tabKey}`);
                  }
                }}
              >
                <div className="relative mb-4">
                  <ListboxButton className="w-full appearance-none rounded-lg border-0 bg-light-50 py-2 pl-3 pr-10 text-left text-sm text-light-1000 shadow-sm ring-1 ring-inset ring-light-300 focus:ring-2 focus:ring-inset focus:ring-light-400 dark:bg-dark-50 dark:text-dark-1000 dark:ring-dark-300 dark:focus:ring-dark-500">
                    {availableTabs[selectedTabIndex]?.label ?? "Select a tab"}
                    <HiChevronDown
                      aria-hidden="true"
                      className="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-light-900 dark:text-dark-900"
                    />
                  </ListboxButton>
                  <ListboxOptions className="absolute z-10 mt-1 w-full rounded-lg bg-light-50 py-1 text-sm shadow-lg ring-1 ring-inset ring-light-300 dark:bg-dark-50 dark:ring-dark-300">
                    {availableTabs.map((tab) => (
                      <ListboxOption
                        key={tab.key}
                        value={availableTabs.indexOf(tab)}
                        className="relative cursor-pointer select-none py-2 pl-3 pr-9 text-light-1000 dark:text-dark-1000"
                      >
                        {tab.label}
                      </ListboxOption>
                    ))}
                  </ListboxOptions>
                </div>
              </Listbox>
            </div>
            <div className="hidden sm:block">
              <div className="border-b border-gray-200 dark:border-white/10">
                <nav
                  aria-label="Tabs"
                  className="-mb-px flex space-x-8 focus:outline-none"
                >
                  {availableTabs.map((tab) => (
                    <Link
                      key={tab.key}
                      href={`/settings/${tab.key}`}
                      className={`whitespace-nowrap border-b-2 px-1 py-4 text-sm font-medium transition-colors focus:outline-none ${
                        isTabActive(tab.key)
                          ? "border-light-1000 text-light-1000 dark:border-dark-1000 dark:text-dark-1000"
                          : "border-transparent text-light-900 hover:border-light-950 hover:text-light-950 dark:text-dark-900 dark:hover:border-white/20 dark:hover:text-dark-950"
                      }`}
                    >
                      {tab.label}
                    </Link>
                  ))}
                </nav>
              </div>
            </div>
            <div className="focus:outline-none">{children}</div>
          </div>
        </div>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/components/SideNavigation.tsx
================================================
import Link from "next/link";
import { useRouter } from "next/router";
import { Button } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useTheme } from "next-themes";
import { useEffect, useState } from "react";
import { HiBolt } from "react-icons/hi2";
import {
  TbLayoutSidebarLeftCollapse,
  TbLayoutSidebarLeftExpand,
} from "react-icons/tb";
import { twMerge } from "tailwind-merge";

import type { Subscription } from "@kan/shared/utils";
import { hasActiveSubscription } from "@kan/shared/utils";

import type { KeyboardShortcut } from "~/providers/keyboard-shortcuts";
import boardsIconDark from "~/assets/boards-dark.json";
import boardsIconLight from "~/assets/boards-light.json";
import membersIconDark from "~/assets/members-dark.json";
import membersIconLight from "~/assets/members-light.json";
import settingsIconDark from "~/assets/settings-dark.json";
import settingsIconLight from "~/assets/settings-light.json";
import templatesIconDark from "~/assets/templates-dark.json";
import templatesIconLight from "~/assets/templates-light.json";
import ButtonComponent from "~/components/Button";
import ReactiveButton from "~/components/ReactiveButton";
import UserMenu from "~/components/UserMenu";
import WorkspaceMenu from "~/components/WorkspaceMenu";
import { useModal } from "~/providers/modal";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

interface SideNavigationProps {
  user: UserType;
  isLoading: boolean;
  onCloseSideNav?: () => void;
}

interface UserType {
  displayName?: string | null | undefined;
  email?: string | null | undefined;
  image?: string | null | undefined;
}

export default function SideNavigation({
  user,
  isLoading,
  onCloseSideNav,
}: SideNavigationProps) {
  const router = useRouter();
  const { workspace } = useWorkspace();
  const [isCollapsed, setIsCollapsed] = useState(false);
  const [isInitialised, setIsInitialised] = useState(false);
  const { openModal } = useModal();

  const { data: workspaceData } = api.workspace.byId.useQuery(
    { workspacePublicId: workspace.publicId },
    { enabled: !!workspace.publicId && workspace.publicId.length >= 12 },
  );

  const subscriptions = workspaceData?.subscriptions as
    | Subscription[]
    | undefined;

  useEffect(() => {
    const savedState = localStorage.getItem("kan_sidebar-collapsed");
    if (savedState !== null) {
      setIsCollapsed(Boolean(JSON.parse(savedState)));
    }
    setIsInitialised(true);
  }, []);

  useEffect(() => {
    if (isInitialised) {
      localStorage.setItem(
        "kan_sidebar-collapsed",
        JSON.stringify(isCollapsed),
      );
    }
  }, [isCollapsed, isInitialised]);

  const { pathname } = router;

  const { resolvedTheme } = useTheme();

  const isCloudEnv = env("NEXT_PUBLIC_KAN_ENV") === "cloud";

  const isDarkMode = resolvedTheme === "dark";

  const navigation: {
    name: string;
    href: string;
    icon: object;
    keyboardShortcut: KeyboardShortcut;
  }[] = [
    {
      name: t`Boards`,
      href: "/boards",
      icon: isDarkMode ? boardsIconDark : boardsIconLight,
      keyboardShortcut: {
        type: "SEQUENCE",
        strokes: [{ key: "G" }, { key: "B" }],
        action: () => router.push("/boards"),
        group: "NAVIGATION",
        description: t`Go to boards`,
      },
    },
    {
      name: t`Templates`,
      href: "/templates",
      icon: isDarkMode ? templatesIconDark : templatesIconLight,
      keyboardShortcut: {
        type: "SEQUENCE",
        strokes: [{ key: "G" }, { key: "T" }],
        action: () => router.push("/templates"),
        group: "NAVIGATION",
        description: t`Go to templates`,
      },
    },
    {
      name: t`Members`,
      href: "/members",
      icon: isDarkMode ? membersIconDark : membersIconLight,
      keyboardShortcut: {
        type: "SEQUENCE",
        strokes: [{ key: "G" }, { key: "M" }],
        action: () => router.push("/members"),
        group: "NAVIGATION",
        description: t`Go to members`,
      },
    },
    {
      name: t`Settings`,
      href: "/settings",
      icon: isDarkMode ? settingsIconDark : settingsIconLight,
      keyboardShortcut: {
        type: "SEQUENCE",
        strokes: [{ key: "G" }, { key: "S" }],
        action: () => router.push("/settings"),
        group: "NAVIGATION",
        description: t`Go to settings`,
      },
    },
  ];

  const toggleCollapse = () => {
    setIsCollapsed(!isCollapsed);
  };

  return (
    <>
      <nav
        className={twMerge(
          "flex h-full w-64 flex-col justify-between border-r border-light-300 bg-light-100 p-3 dark:border-dark-300 dark:bg-dark-100 md:border-r-0 md:py-0 md:pl-0",
          isCollapsed && "md:w-auto",
        )}
      >
        <div>
          <div className="hidden h-[45px] items-center justify-between pb-3 md:flex">
            {!isCollapsed && (
              <Link href="/" className="block">
                <h1 className="pl-2 text-[16px] font-bold tracking-tight text-neutral-900 dark:text-dark-1000">
                  kan.bn
                </h1>
              </Link>
            )}
            <Button
              onClick={toggleCollapse}
              className={twMerge(
                "flex h-8 items-center justify-center rounded-md hover:bg-light-200 dark:hover:bg-dark-200",
                isCollapsed ? "w-full" : "w-8",
              )}
            >
              {isCollapsed ? (
                <TbLayoutSidebarLeftExpand
                  size={18}
                  className="text-light-900 dark:text-dark-900"
                />
              ) : (
                <TbLayoutSidebarLeftCollapse
                  size={18}
                  className="text-light-900 dark:text-dark-900"
                />
              )}
            </Button>
          </div>
          <div className="mx-1 mb-4 hidden w-auto border-b border-light-300 dark:border-dark-400 md:block" />

          <WorkspaceMenu isCollapsed={isCollapsed} />
          <ul role="list" className="space-y-1">
            {navigation.map((item) => (
              <li key={item.name}>
                <ReactiveButton
                  href={item.href}
                  current={pathname.includes(item.href)}
                  name={item.name}
                  json={item.icon}
                  isCollapsed={isCollapsed}
                  onCloseSideNav={onCloseSideNav}
                  keyboardShortcut={item.keyboardShortcut}
                />
              </li>
            ))}
          </ul>
        </div>

        <div className="space-y-2">
          <UserMenu
            displayName={user.displayName ?? undefined}
            email={user.email ?? "Email not provided?"}
            imageUrl={user.image ?? undefined}
            isLoading={isLoading}
            isCollapsed={isCollapsed}
            onCloseSideNav={onCloseSideNav}
          />
          {isCloudEnv &&
            !hasActiveSubscription(subscriptions, "pro") &&
            !hasActiveSubscription(subscriptions, "team") && (
              <div className={twMerge(isCollapsed && "flex justify-center")}>
                {isCollapsed ? (
                  <ButtonComponent
                    iconLeft={<HiBolt />}
                    variant="secondary"
                    href="/settings/workspace?upgrade=pro"
                    aria-label="Upgrade to Pro"
                    title="Upgrade to Pro"
                    iconOnly
                    onClick={() => openModal("UPGRADE_TO_PRO")}
                  />
                ) : (
                  <ButtonComponent
                    iconLeft={<HiBolt />}
                    fullWidth
                    variant="secondary"
                    href="/settings/workspace?upgrade=pro"
                    onClick={() => openModal("UPGRADE_TO_PRO")}
                  >
                    {t`Upgrade to Pro`}
                  </ButtonComponent>
                )}
              </div>
            )}
        </div>
      </nav>
    </>
  );
}



================================================
FILE: apps/web/src/components/StrictModeDroppable.tsx
================================================
import type { DroppableProps } from "react-beautiful-dnd";
import { useEffect, useState } from "react";
import { Droppable } from "react-beautiful-dnd";

export const StrictModeDroppable = ({ children, ...props }: DroppableProps) => {
  const [enabled, setEnabled] = useState(false);
  useEffect(() => {
    const animation = requestAnimationFrame(() => setEnabled(true));
    return () => {
      cancelAnimationFrame(animation);
      setEnabled(false);
    };
  }, []);
  if (!enabled) {
    return null;
  }
  return <Droppable {...props}>{children}</Droppable>;
};



================================================
FILE: apps/web/src/components/ThemeToggle.tsx
================================================
import { CgDarkMode } from "react-icons/cg";
import { useTheme } from "next-themes";

const ThemeToggle = () => {
  const { theme, resolvedTheme, setTheme } = useTheme();

  const toggleTheme = () => {
    setTheme(theme === "light" ? "dark" : "light");
  };

  return (
    <button
      onClick={toggleTheme}
      className="rounded p-1.5 transition-all hover:bg-light-200 dark:hover:bg-dark-100"
      aria-label={`Switch to ${resolvedTheme === "light" ? "dark" : "light"} theme`}
    >
      <CgDarkMode
        className={`h-4 w-4 text-light-900 transition-transform duration-200 dark:text-dark-900 ${
          resolvedTheme === "dark" ? "rotate-180" : "rotate-0"
        }`}
      />
    </button>
  );
};

export default ThemeToggle;



================================================
FILE: apps/web/src/components/Toggle.tsx
================================================
import { Switch } from "@headlessui/react";
import { twMerge } from "tailwind-merge";

const Toggle = ({
  isChecked,
  onChange,
  label,
  disabled,
  showLabel = true,
}: {
  isChecked: boolean;
  onChange: () => void;
  label: string;
  disabled?: boolean;
  showLabel?: boolean;
}) => (
  <div className="mr-4 flex items-center justify-end">
    {showLabel && (
      <span className="mr-2 text-xs text-light-900 dark:text-dark-900">
        {label}
      </span>
    )}
    <Switch
      checked={isChecked}
      onChange={onChange}
      disabled={disabled}
      className={twMerge(
        "relative inline-flex h-4 w-6 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent bg-light-800 transition-colors duration-200 ease-in-out focus:outline-none dark:bg-dark-800",
        isChecked && "bg-indigo-600 dark:bg-indigo-600",
      )}
    >
      <span className="sr-only">{label}</span>
      <span
        aria-hidden="true"
        className={twMerge(
          "pointer-events-none inline-block h-3 w-3 translate-x-0 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",
          isChecked && "translate-x-2",
        )}
      />
    </Switch>
  </div>
);

export default Toggle;



================================================
FILE: apps/web/src/components/Tooltip.tsx
================================================
import type { ReactNode } from "react";
import type { Root } from "react-dom/client";
import type { Placement } from "tippy.js";
import { useEffect, useRef } from "react";
import { createRoot } from "react-dom/client";
import tippy from "tippy.js";

interface TooltipProps {
  children: ReactNode;
  content?: ReactNode;
  placement?: Placement;
  delay?: number | [number, number];
}

export function Tooltip({
  children,
  content,
  placement = "bottom",
  delay = [500, 0],
}: TooltipProps) {
  const triggerRef = useRef<HTMLDivElement>(null);
  const rootRef = useRef<Root | null>(null);

  useEffect(() => {
    if (!triggerRef.current) return;

    if (!content) return;

    const container = document.createElement("div");
    const root = createRoot(container);
    rootRef.current = root;
    root.render(content);

    const instance = tippy(triggerRef.current, {
      content: container,
      placement,
      delay,
      interactive: false,
      theme: "tooltip",
      touch: false,
    });

    return () => {
      instance.destroy();
      rootRef.current?.unmount();
    };
  }, [content, placement, delay]);

  return (
    <div ref={triggerRef} className="inline-flex">
      {children}
    </div>
  );
}



================================================
FILE: apps/web/src/components/UserMenu.tsx
================================================
import Image from "next/image";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { Menu, Transition } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { useTheme } from "next-themes";
import { Fragment } from "react";
import { twMerge } from "tailwind-merge";

import { authClient } from "@kan/auth/client";

import { env } from "~/env";
import { useIsMobile } from "~/hooks/useMediaQuery";
import { useKeyboardShortcuts } from "~/providers/keyboard-shortcuts";
import { useModal } from "~/providers/modal";
import { getAvatarUrl } from "~/utils/helpers";

interface UserMenuProps {
  imageUrl: string | undefined;
  displayName: string | undefined;
  email: string;
  isLoading: boolean;
  isCollapsed?: boolean;
  onCloseSideNav?: () => void;
}

export default function UserMenu({
  imageUrl,
  email,
  displayName,
  isLoading,
  isCollapsed = false,
  onCloseSideNav,
}: UserMenuProps) {
  const router = useRouter();
  const { theme, setTheme } = useTheme();
  const { openModal } = useModal();
  const { openLegend } = useKeyboardShortcuts();
  const isMobile = useIsMobile();

  const handleLogout = async () => {
    if (onCloseSideNav && isMobile) {
      onCloseSideNav();
    }
    await authClient.signOut();
    router.push("/login");
  };

  const handleLinkClick = () => {
    if (onCloseSideNav && isMobile) {
      onCloseSideNav();
    }
  };

  const handleModalOpen = (modalType: string) => {
    if (onCloseSideNav && isMobile) {
      onCloseSideNav();
    }
    openModal(modalType);
  };

  const avatarUrl = imageUrl ? getAvatarUrl(imageUrl) : null;

  return (
    <Menu as="div" className="relative inline-block w-full text-left">
      <div>
        {isLoading ? (
          <div className={twMerge(!isCollapsed && "flex")}>
            <div className="h-[30px] w-[30px] animate-pulse rounded-full bg-light-200 dark:bg-dark-200" />
            <div
              className={twMerge(
                "mx-2 h-[30px] w-[175px] animate-pulse rounded-md bg-light-200 dark:bg-dark-200",
                isCollapsed && "md:hidden",
              )}
            />
          </div>
        ) : (
          <Menu.Button
            className="flex w-full items-center rounded-md p-1.5 text-neutral-900 hover:bg-light-200 dark:text-dark-900 dark:hover:bg-dark-200 dark:hover:text-dark-1000"
            title={isCollapsed ? (displayName || email) : undefined}
          >
            {avatarUrl ? (
              <Image
                src={avatarUrl}
                className="rounded-full bg-gray-50"
                width={24}
                height={24}
                alt=""
              />
            ) : (
              <span className="inline-block h-6 w-6 overflow-hidden rounded-full bg-light-400 dark:bg-dark-400">
                <svg
                  className="h-full w-full text-dark-700"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
              </span>
            )}
            <span
              className={twMerge(
                "mx-2 truncate text-sm",
                isCollapsed && "md:hidden",
              )}
            >
              {displayName || email}
            </span>
          </Menu.Button>
        )}
      </div>

      <Transition
        as={Fragment}
        enter="transition ease-out duration-100"
        enterFrom="transform opacity-0 scale-95"
        enterTo="transform opacity-100 scale-100"
        leave="transition ease-in duration-75"
        leaveFrom="transform opacity-100 scale-100"
        leaveTo="transform opacity-0 scale-95"
      >
        <Menu.Items
          className={twMerge(
            "absolute bottom-[40px] z-10 mt-2 origin-top-left rounded-md border border-light-600 bg-light-50 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:border-dark-600 dark:bg-dark-300",
            isCollapsed ? "left-0 w-48" : "left-0 w-full",
          )}
        >
          <div className="flex flex-col text-neutral-900 dark:text-dark-1000">
            <div className="p-1">
              <div className="flex w-full items-center px-3 py-2 text-left text-xs">
                <span>{t`Theme`}</span>
              </div>
              <Menu.Item>
                <button
                  onClick={() => setTheme("system")}
                  className="flex w-full items-center rounded-[5px] px-3 py-2 text-left text-xs hover:bg-light-200 dark:hover:bg-dark-400"
                >
                  <span
                    className={twMerge(
                      theme === "system" ? "visible" : "invisible",
                      "mr-4 h-[6px] w-[6px] rounded-full bg-light-900 dark:bg-dark-900",
                    )}
                  />
                  {t`System`}
                </button>
              </Menu.Item>
              <Menu.Item>
                <button
                  onClick={() => setTheme("dark")}
                  className="flex w-full items-center rounded-[5px] px-3 py-2 text-left text-xs hover:bg-light-200 dark:hover:bg-dark-400"
                >
                  <span
                    className={twMerge(
                      theme === "dark" ? "visible" : "invisible",
                      "mr-4 h-[6px] w-[6px] rounded-full bg-light-900 dark:bg-dark-900",
                    )}
                  />
                  {t`Dark`}
                </button>
              </Menu.Item>
              <Menu.Item>
                <button
                  onClick={() => setTheme("light")}
                  className="flex w-full items-center rounded-[5px] px-3 py-2 text-left text-xs hover:bg-light-200 dark:hover:bg-dark-400"
                >
                  <span
                    className={twMerge(
                      theme === "light" ? "visible" : "invisible",
                      "mr-4 h-[6px] w-[6px] rounded-full bg-light-900 dark:bg-dark-900",
                    )}
                  />
                  {t`Light`}
                </button>
              </Menu.Item>
            </div>
            <div className="light-border-600 border-t-[1px] p-1 dark:border-dark-600">
              <Menu.Item>
                <button
                  onClick={() => {
                    if (onCloseSideNav && isMobile) {
                      onCloseSideNav();
                    }
                    openLegend();
                  }}
                  className="flex w-full items-center rounded-[5px] px-3 py-2 text-left text-xs hover:bg-light-200 dark:hover:bg-dark-400"
                >
                  {t`Shortcuts`}
                </button>
              </Menu.Item>
              <Menu.Item>
                <Link
                  href="mailto:support@kan.bn"
                  target="_blank"
                  rel="noreferrer"
                  onClick={handleLinkClick}
                  className="flex w-full items-center rounded-[5px] px-3 py-2 text-left text-xs hover:bg-light-200 dark:hover:bg-dark-400"
                >
                  {t`Support`}
                </Link>
              </Menu.Item>
              <Menu.Item>
                <Link
                  href="https://docs.kan.bn"
                  target="_blank"
                  rel="noreferrer"
                  onClick={handleLinkClick}
                  className="flex w-full items-center rounded-[5px] px-3 py-2 text-left text-xs hover:bg-light-200 dark:hover:bg-dark-400"
                >
                  {t`Documentation`}
                </Link>
              </Menu.Item>
              <Menu.Item>
                <button
                  onClick={() => handleModalOpen("NEW_FEEDBACK")}
                  className="flex w-full items-center rounded-[5px] px-3 py-2 text-left text-xs hover:bg-light-200 dark:hover:bg-dark-400"
                >
                  {t`Feedback`}
                </button>
              </Menu.Item>
            </div>
            <div className="light-border-600 border-t-[1px] p-1 dark:border-dark-600">
              <Menu.Item>
                <button
                  onClick={handleLogout}
                  className="flex w-full items-center rounded-[5px] px-3 py-2 text-left text-xs hover:bg-light-200 dark:hover:bg-dark-400"
                >
                  {t`Logout`}
                </button>
              </Menu.Item>
            </div>
            {env.NEXT_PUBLIC_APP_VERSION && (
              <div className="light-border-600 border-t-[1px] p-1 dark:border-dark-600">
                <Menu.Item>
                  <Link
                    href={
                      env.NEXT_PUBLIC_APP_VERSION.includes("+")
                        ? `https://github.com/kanbn/kan/commit/${env.NEXT_PUBLIC_APP_VERSION.split("+")[1]}`
                        : `https://github.com/kanbn/kan/releases/tag/v${env.NEXT_PUBLIC_APP_VERSION}`
                    }
                    target="_blank"
                    rel="noreferrer"
                    onClick={handleLinkClick}
                    className="flex w-full items-center justify-center rounded-[5px] px-3 py-2 text-center text-xs text-light-900 hover:bg-light-200 dark:text-dark-900 dark:hover:bg-dark-400"
                  >
                    Version: {env.NEXT_PUBLIC_APP_VERSION}
                  </Link>
                </Menu.Item>
              </div>
            )}
          </div>
        </Menu.Items>
      </Transition>
    </Menu>
  );
}



================================================
FILE: apps/web/src/components/WorkspaceMenu.tsx
================================================
import { Button, Menu, Transition } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { Fragment, useState } from "react";
import { HiCheck, HiMagnifyingGlass } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

import { useKeyboardShortcut } from "~/providers/keyboard-shortcuts";
import { useModal } from "~/providers/modal";
import { useWorkspace } from "~/providers/workspace";
import CommandPallette from "./CommandPallette";
import { Tooltip } from "./Tooltip";

export default function WorkspaceMenu({
  isCollapsed = false,
}: {
  isCollapsed?: boolean;
}) {
  const { workspace, isLoading, availableWorkspaces, switchWorkspace } =
    useWorkspace();
  const { openModal } = useModal();
  const [isOpen, setIsOpen] = useState(false);

  const { tooltipContent: commandPaletteShortcutTooltipContent } =
    useKeyboardShortcut({
      type: "PRESS",
      stroke: {
        key: "k",
        modifiers: ["META"],
      },
      action: () => setIsOpen(true),
      description: t`Open command menu`,
      group: "GENERAL",
    });

  return (
    <>
      <CommandPallette isOpen={isOpen} onClose={() => setIsOpen(false)} />
      <Menu as="div" className="relative inline-block w-full pb-3 text-left">
        <div>
          {isLoading ? (
            <div className={twMerge("mb-1 flex", isCollapsed && "md:p-1.5")}>
              <div className="h-6 w-6 animate-pulse rounded-md bg-light-200 dark:bg-dark-200" />
              <div
                className={twMerge(
                  "ml-2 h-6 w-[150px] animate-pulse rounded-md bg-light-200 dark:bg-dark-200",
                  isCollapsed && "md:hidden",
                )}
              />
            </div>
          ) : (
            <div
              className={twMerge(
                "flex items-center justify-start gap-1",
                isCollapsed && "md:flex-col-reverse md:items-center",
              )}
            >
              <Menu.Button
                className={twMerge(
                  "mb-1 flex h-[34px] min-w-0 flex-1 items-center justify-start rounded-md p-1.5 hover:bg-light-200 dark:hover:bg-dark-200",
                  isCollapsed &&
                    "md:mb-1.5 md:h-9 md:w-9 md:flex-none md:justify-center md:p-0",
                )}
                title={isCollapsed ? workspace.name : undefined}
              >
                <span className="inline-flex h-6 w-6 items-center justify-center rounded-md bg-indigo-700">
                  <span className="text-xs font-bold leading-none text-white">
                    {workspace.name.charAt(0).toUpperCase()}
                  </span>
                </span>
                <span
                  className={twMerge(
                    "ml-2 min-w-0 flex-1 truncate text-left text-sm font-bold text-neutral-900 dark:text-dark-1000",
                    isCollapsed && "md:hidden",
                  )}
                >
                  {workspace.name}
                </span>
                {workspace.plan === "pro" && (
                  <span
                    className={twMerge(
                      "ml-2 inline-flex items-center rounded-md bg-indigo-100 px-2 py-1 text-[10px] font-medium text-indigo-700",
                      isCollapsed && "md:hidden",
                    )}
                  >
                    Pro
                  </span>
                )}
              </Menu.Button>
              <Tooltip content={commandPaletteShortcutTooltipContent}>
                <Button
                  className={twMerge(
                    "mb-1 h-[34px] w-[34px] flex-shrink-0 rounded-lg bg-light-200 p-2 hover:bg-light-300 focus:outline-none dark:bg-dark-200 dark:hover:bg-dark-300",
                    isCollapsed && "md:mb-2 md:h-9 md:w-9",
                  )}
                  onClick={() => setIsOpen(true)}
                >
                  <HiMagnifyingGlass className="h-4 w-4" aria-hidden="true" />
                </Button>
              </Tooltip>
            </div>
          )}
        </div>

        <Transition
          as={Fragment}
          enter="transition ease-out duration-100"
          enterFrom="transform opacity-0 scale-95"
          enterTo="transform opacity-100 scale-100"
          leave="transition ease-in duration-75"
          leaveFrom="transform opacity-100 scale-100"
          leaveTo="transform opacity-0 scale-95"
        >
          <Menu.Items
            className={twMerge(
              "absolute left-0 z-10 origin-top-left rounded-md border border-light-600 bg-light-50 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:border-dark-600 dark:bg-dark-300",
              isCollapsed ? "w-48" : "w-full",
            )}
          >
            <div className="p-1">
              {availableWorkspaces.map((availableWorkspace) => (
                <div key={availableWorkspace.publicId} className="flex">
                  <Menu.Item>
                    <button
                      onClick={() => switchWorkspace(availableWorkspace)}
                      className="flex w-full items-center justify-between rounded-[5px] px-3 py-2 text-left text-sm text-neutral-900 hover:bg-light-200 dark:text-dark-1000 dark:hover:bg-dark-400"
                    >
                      <div className="flex min-w-0 flex-1 items-center">
                        <span className="inline-flex h-5 w-5 flex-shrink-0 items-center justify-center rounded-[5px] bg-indigo-700">
                          <span className="text-xs font-medium leading-none text-white">
                            {availableWorkspace.name.charAt(0).toUpperCase()}
                          </span>
                        </span>
                        <span className="ml-2 truncate text-xs font-medium">
                          {availableWorkspace.name}
                        </span>
                      </div>
                      {workspace.publicId === availableWorkspace.publicId && (
                        <span>
                          <HiCheck className="h-4 w-4" aria-hidden="true" />
                        </span>
                      )}
                    </button>
                  </Menu.Item>
                </div>
              ))}
            </div>
            <div className="border-t-[1px] border-light-600 p-1 dark:border-dark-500">
              <Menu.Item>
                <button
                  onClick={() => openModal("NEW_WORKSPACE")}
                  className="flex w-full items-center justify-between rounded-[5px] px-3 py-2 text-left text-xs text-neutral-900 hover:bg-light-200 dark:text-dark-1000 dark:hover:bg-dark-400"
                >
                  {t`Create workspace`}
                </button>
              </Menu.Item>
            </div>
          </Menu.Items>
        </Transition>
      </Menu>
    </>
  );
}



================================================
FILE: apps/web/src/components/YouTubeEmbed/EditYouTubeModal.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";
import { useForm } from "react-hook-form";
import { HiXMark } from "react-icons/hi2";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useModal } from "~/providers/modal";
import { fetchYouTubeMetadata, isYouTubeUrl } from "./utils";

interface EditYouTubeFormInput {
  url: string;
  title: string;
}

interface EditYouTubeModalState {
  url: string;
  title: string;
  onSave: (url: string, title: string) => void;
}

export function EditYouTubeModal() {
  const { closeModal, getModalState } = useModal();
  const [isValidating, setIsValidating] = useState(false);
  const [urlError, setUrlError] = useState<string | null>(null);

  // Get initial values and callback from modal state
  const modalState = getModalState("EDIT_YOUTUBE") as
    | EditYouTubeModalState
    | undefined;
  const initialUrl = modalState?.url ?? "";
  const initialTitle = modalState?.title ?? "";
  const onSave = modalState?.onSave;

  const { register, handleSubmit, watch, reset } =
    useForm<EditYouTubeFormInput>({
      defaultValues: {
        url: initialUrl,
        title: initialTitle,
      },
    });

  // Reset form when modal state changes (when modal opens with new values)
  useEffect(() => {
    if (modalState) {
      reset({
        url: modalState.url,
        title: modalState.title,
      });
    }
  }, [modalState, reset]);

  const currentUrl = watch("url");

  const onSubmit = async (values: EditYouTubeFormInput) => {
    // Validate URL
    if (!isYouTubeUrl(values.url)) {
      setUrlError(t`Please enter a valid YouTube URL`);
      return;
    }

    setUrlError(null);
    setIsValidating(true);

    try {
      // If title is empty and URL changed, fetch new title
      let finalTitle = values.title;
      if (!finalTitle.trim() && values.url !== initialUrl) {
        const metadata = await fetchYouTubeMetadata(values.url);
        finalTitle = metadata?.title ?? "YouTube Video";
      } else if (!finalTitle.trim()) {
        // Keep existing title if no new title provided and URL unchanged
        finalTitle = initialTitle || "YouTube Video";
      }

      if (onSave) {
        onSave(values.url, finalTitle);
      }
      closeModal();
    } catch (error) {
      console.error(error);
      setUrlError(t`Failed to fetch video information`);
    } finally {
      setIsValidating(false);
    }
  };

  // Auto-focus on title input (more useful for editing)
  useEffect(() => {
    const titleElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#youtube-title");
    if (titleElement) titleElement.focus();
  }, []);

  // Validate URL on change
  useEffect(() => {
    if (currentUrl && !isYouTubeUrl(currentUrl)) {
      setUrlError(t`Please enter a valid YouTube URL`);
    } else {
      setUrlError(null);
    }
  }, [currentUrl]);

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-4 text-neutral-900 dark:text-dark-1000">
          <h2 className="text-sm font-medium">{t`Edit YouTube Video`}</h2>
          <button
            type="button"
            className="rounded p-1 hover:bg-light-300 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>

        <div className="space-y-4">
          <div>
            <label
              htmlFor="youtube-title"
              className="mb-2 block text-xs font-medium text-light-900 dark:text-dark-900"
            >
              {t`Title`}
            </label>
            <Input
              id="youtube-title"
              placeholder={t`Enter a custom title`}
              {...register("title")}
              onKeyDown={async (e) => {
                if (e.key === "Enter") {
                  e.preventDefault();
                  await handleSubmit(onSubmit)();
                }
              }}
            />
          </div>

          <div>
            <label
              htmlFor="youtube-url"
              className="mb-2 block text-xs font-medium text-light-900 dark:text-dark-900"
            >
              {t`YouTube URL`}
            </label>
            <Input
              id="youtube-url"
              placeholder={t`https://www.youtube.com/watch?v=...`}
              {...register("url", { required: true })}
              onKeyDown={async (e) => {
                if (e.key === "Enter") {
                  e.preventDefault();
                  await handleSubmit(onSubmit)();
                }
              }}
            />
            {urlError && (
              <p className="mt-1 text-xs text-red-600 dark:text-red-400">
                {urlError}
              </p>
            )}
          </div>
        </div>
      </div>

      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <div className="space-x-2">
          <Button
            type="button"
            variant="secondary"
            onClick={() => closeModal()}
          >
            {t`Cancel`}
          </Button>
          <Button
            type="submit"
            isLoading={isValidating}
            disabled={!watch("url") || !!urlError}
          >
            {t`Save`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/components/YouTubeEmbed/utils.ts
================================================
export function extractVideoId(url: string): string | null {
  if (!url) return null;
  url = url.trim();

  // youtube.com/watch?v=VIDEO_ID
  const watchMatch = /(?:youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/.exec(url);
  if (watchMatch) return watchMatch[1] ?? null;

  // youtu.be/VIDEO_ID
  const shortMatch = /(?:youtu\.be\/)([a-zA-Z0-9_-]{11})/.exec(url);
  if (shortMatch) return shortMatch[1] ?? null;

  // youtube.com/embed/VIDEO_ID
  const embedMatch = /(?:youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/.exec(url);
  if (embedMatch) return embedMatch[1] ?? null;

  return null;
}

/**
 * Check if a URL is a valid YouTube link
 */
export function isYouTubeUrl(url: string): boolean {
  if (!url) return false;
  const videoId = extractVideoId(url);
  return videoId !== null;
}

/**
 * Fetch YouTube video metadata using oEmbed API
 * Returns title, author, thumbnail URL, etc.
 * No API key required
 */
export async function fetchYouTubeMetadata(url: string): Promise<{
  title: string;
  author_name: string;
  thumbnail_url: string;
} | null> {
  try {
    const oembedUrl = `https://www.youtube.com/oembed?url=${encodeURIComponent(url)}&format=json`;
    const response = await fetch(oembedUrl);

    if (!response.ok) {
      return null;
    }

    const data = (await response.json()) as {
      title: string;
      author_name: string;
      thumbnail_url: string;
    };
    return {
      title: data.title || "YouTube Video",
      author_name: data.author_name || "",
      thumbnail_url: data.thumbnail_url || "",
    };
  } catch (error) {
    console.error("Failed to fetch YouTube metadata:", error);
    return null;
  }
}



================================================
FILE: apps/web/src/components/YouTubeEmbed/YouTubeCard.tsx
================================================
import YouTubeDropdown from "./YouTubeDropdown";

interface YouTubeCardProps {
  videoId: string;
  url: string;
  title: string;
  showEmbed?: boolean;
  onConvertToLink: () => void;
  onDelete: () => void;
  onUpdate: (url: string, title: string) => void;
}

const YouTubeCard = ({
  videoId,
  url,
  title,
  showEmbed = true,
  onConvertToLink,
  onDelete,
  onUpdate,
}: YouTubeCardProps) => {
  return (
    <div className="w-full max-w-md rounded-lg border border-light-300 bg-light-50 dark:border-dark-300 dark:bg-dark-50">
      <div className="flex items-center justify-between gap-6 p-0 px-6">
        <h3 className="truncate text-sm font-medium">{title}</h3>
        <div className="mt-3">
          <YouTubeDropdown
            url={url}
            title={title}
            onConvertToLink={onConvertToLink}
            onDelete={onDelete}
            onUpdate={onUpdate}
          />
        </div>
      </div>

      {showEmbed && videoId && (
        <div className="p-6 pt-1">
          <iframe
            src={`https://www.youtube.com/embed/${videoId}?rel=0`}
            title={title}
            className="aspect-video w-full rounded-lg"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerPolicy="strict-origin-when-cross-origin"
            allowFullScreen
          />
        </div>
      )}
    </div>
  );
};

export default YouTubeCard;



================================================
FILE: apps/web/src/components/YouTubeEmbed/YouTubeDropdown.tsx
================================================
import { t } from "@lingui/core/macro";
import {
  HiEllipsisHorizontal,
  HiLink,
  HiPencil,
  HiTrash,
} from "react-icons/hi2";

import { useModal } from "~/providers/modal";
import Dropdown from "../Dropdown";

interface YouTubeDropdownProps {
  url: string;
  title: string;
  onConvertToLink: () => void;
  onDelete: () => void;
  onUpdate: (url: string, title: string) => void;
}

const YouTubeDropdown = ({
  url,
  title,
  onConvertToLink,
  onDelete,
  onUpdate,
}: YouTubeDropdownProps) => {
  const { openModal, setModalState } = useModal();

  const handleEdit = () => {
    setModalState("EDIT_YOUTUBE", {
      url,
      title,
      onSave: onUpdate,
    });
    openModal("EDIT_YOUTUBE");
  };

  return (
    <Dropdown
      items={[
        {
          label: t`Edit`,
          action: handleEdit,
          icon: <HiPencil className="h-4 w-4 text-dark-900" />,
        },
        {
          label: t`Convert to link`,
          action: onConvertToLink,
          icon: <HiLink className="h-4 w-4 text-dark-900" />,
        },
        {
          label: t`Delete`,
          action: onDelete,
          icon: <HiTrash className="h-4 w-4 text-dark-900" />,
        },
      ]}
    >
      <HiEllipsisHorizontal className="h-5 w-5 text-dark-900" />
    </Dropdown>
  );
};

export default YouTubeDropdown;



================================================
FILE: apps/web/src/components/YouTubeEmbed/YouTubeNode.tsx
================================================
import { mergeAttributes, Node } from "@tiptap/core";
import { Plugin, PluginKey } from "@tiptap/pm/state";
import { ReactNodeViewRenderer } from "@tiptap/react";

import { extractVideoId, fetchYouTubeMetadata, isYouTubeUrl } from "./utils";
import YouTubeNodeView from "./YouTubeNodeView";

export interface YouTubeOptions {
  inline: boolean;
  HTMLAttributes: Record<string, undefined>;
}

declare module "@tiptap/core" {
  interface Commands<ReturnType> {
    youTube: {
      setYouTubeEmbed: (options: {
        videoId: string;
        url: string;
        title: string;
        thumbnailUrl?: string;
        showEmbed?: boolean;
      }) => ReturnType;
    };
  }
}

export const YouTubeNode = Node.create<YouTubeOptions>({
  name: "youtube",
  group: "block",
  atom: true,
  addOptions() {
    return {
      inline: false,
      HTMLAttributes: {},
    };
  },

  addAttributes() {
    return {
      videoId: {
        default: null,
        parseHTML: (element) => element.getAttribute("data-video-id"),
        renderHTML: (attributes) => {
          if (!attributes.videoId) return {};
          return { "data-video-id": attributes.videoId as string };
        },
      },
      url: {
        default: null,
        parseHTML: (element) => element.getAttribute("data-url"),
        renderHTML: (attributes) => {
          if (!attributes.url) return {};
          return { "data-url": attributes.url as string };
        },
      },
      title: {
        default: "YouTube Video",
        parseHTML: (element) => element.getAttribute("data-title"),
        renderHTML: (attributes) => {
          return { "data-title": attributes.title as string };
        },
      },
      thumbnailUrl: {
        default: null,
        parseHTML: (element) => element.getAttribute("data-thumbnail"),
        renderHTML: (attributes) => {
          if (!attributes.thumbnailUrl) return {};
          return { "data-thumbnail": attributes.thumbnailUrl as string };
        },
      },
      showEmbed: {
        default: true,
        parseHTML: (element) => element.getAttribute("data-show-embed"),
        renderHTML: (attributes) => {
          return { "data-show-embed": attributes.showEmbed as string };
        },
      },
    };
  },

  parseHTML() {
    return [
      {
        tag: "div[data-youtube]",
      },
    ];
  },

  renderHTML({ HTMLAttributes }) {
    return [
      "div",
      mergeAttributes(
        { "data-youtube": "" },
        this.options.HTMLAttributes,
        HTMLAttributes,
      ),
    ];
  },

  addNodeView() {
    return ReactNodeViewRenderer(YouTubeNodeView);
  },

  addProseMirrorPlugins() {
    const nodeType = this.type;

    return [
      new Plugin({
        key: new PluginKey("youtubePaste"),
        props: {
          handlePaste: (view, event) => {
            const text = event.clipboardData?.getData("text/plain");
            if (!text) return false;

            // Check if the pasted text is a YouTube URL
            const youtubeRegex =
              /(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([\w-]+)/;
            const match = youtubeRegex.exec(text);

            if (!match || !isYouTubeUrl(text)) return false;

            const videoId = extractVideoId(text);
            if (!videoId) return false;

            const { state, dispatch } = view;
            const { tr } = state;

            const node = nodeType.create({
              videoId,
              url: text,
              title: "Loading...",
              showEmbed: true,
            });

            tr.replaceSelectionWith(node);
            dispatch(tr);

            // Fetch metadata asynchronously and update the node
            void fetchYouTubeMetadata(text).then((metadata) => {
              const { state: newState, dispatch: newDispatch } = view;
              const { tr: newTr } = newState;

              newState.doc.descendants((n, pos) => {
                if (
                  n.type.name === "youtube" &&
                  n.attrs.videoId === videoId &&
                  n.attrs.title === "Loading..."
                ) {
                  newTr.setNodeMarkup(pos, undefined, {
                    ...n.attrs,
                    title: metadata?.title ?? "YouTube Video",
                    thumbnailUrl: metadata?.thumbnail_url ?? null,
                  });
                  return false;
                }
                return true;
              });

              if (newTr.docChanged) {
                newDispatch(newTr);
              }
            });

            return true;
          },
        },
      }),
    ];
  },

  // commands for the YouTube embed node
  addCommands() {
    return {
      setYouTubeEmbed:
        (options: {
          videoId: string;
          url: string;
          title?: string;
          thumbnailUrl?: string;
          showEmbed?: boolean;
        }) =>
        ({ editor }) => {
          return editor.commands.insertContent({
            type: this.name,
            attrs: {
              videoId: options.videoId,
              url: options.url,
              title: options.title ?? "YouTube Video",
              thumbnailUrl: options.thumbnailUrl,
              showEmbed: options.showEmbed ?? true,
            },
          });
        },
    };
  },
});



================================================
FILE: apps/web/src/components/YouTubeEmbed/YouTubeNodeView.tsx
================================================
import type { NodeViewProps } from "@tiptap/react";
import { NodeViewWrapper } from "@tiptap/react";

import { extractVideoId } from "./utils";
import YouTubeCard from "./YouTubeCard";

export default function YouTubeNodeView({
  node,
  editor,
  getPos,
  deleteNode,
  updateAttributes,
}: NodeViewProps) {
  const { videoId, title, url, showEmbed } = node.attrs as {
    videoId: string;
    title: string;
    url: string;
    showEmbed: boolean;
  };

  const handleConvertToLink = () => {
    const pos = getPos();
    if (typeof pos !== "number") return;

    const linkContent = {
      type: "paragraph",
      content: [
        {
          type: "text",
          text: url,
          marks: [
            {
              type: "link",
              attrs: {
                href: url,
                target: "_blank",
              },
            },
          ],
        },
      ],
    };

    editor
      .chain()
      .focus()
      .deleteRange({ from: pos, to: pos + node.nodeSize })
      .insertContentAt(pos, linkContent)
      .run();
  };

  const handleDelete = () => {
    deleteNode();
  };

  const handleUpdate = (newUrl: string, newTitle: string) => {
    if (newUrl !== url) {
      const newVideoId = extractVideoId(newUrl);
      updateAttributes({
        url: newUrl,
        title: newTitle,
        videoId: newVideoId,
      });
    } else {
      updateAttributes({ title: newTitle });
    }
  };

  return (
    <NodeViewWrapper>
      <YouTubeCard
        videoId={videoId}
        url={url}
        title={title}
        showEmbed={showEmbed}
        onConvertToLink={handleConvertToLink}
        onDelete={handleDelete}
        onUpdate={handleUpdate}
      />
    </NodeViewWrapper>
  );
}



================================================
FILE: apps/web/src/hooks/useClickOutside.ts
================================================
import type { RefObject } from "react";

import { useEventListener } from "./useEventListener";

/** Supported event types. */
type EventType =
  | "mousedown"
  | "mouseup"
  | "touchstart"
  | "touchend"
  | "focusin"
  | "focusout";

/**
 * Custom hook that handles clicks outside a specified element.
 * @template T - The type of the element's reference.
 * @param {RefObject<T> | RefObject<T>[]} ref - The React ref object(s) representing the element(s) to watch for outside clicks.
 * @param {(event: MouseEvent | TouchEvent | FocusEvent) => void} handler - The callback function to be executed when a click outside the element occurs.
 * @param {EventType} [eventType] - The mouse event type to listen for (optional, default is 'mousedown').
 * @param {?AddEventListenerOptions} [eventListenerOptions] - The options object to be passed to the `addEventListener` method (optional).
 * @returns {void}
 * @example
 * ```tsx
 * const containerRef = useRef(null);
 * useClickOutside([containerRef], () => {
 *   // Handle clicks outside the container.
 * });
 * ```
 */
export function useClickOutside<T extends HTMLElement = HTMLElement>(
  ref: RefObject<T> | RefObject<T>[],
  handler: (event: MouseEvent | TouchEvent | FocusEvent) => void,
  eventType: EventType = "mousedown",
  eventListenerOptions: AddEventListenerOptions = {},
): void {
  useEventListener(
    eventType,
    (event) => {
      const target = event.target as Node;

      // Do nothing if the target is not connected element with document
      if (!target.isConnected) {
        return;
      }

      const isOutside = Array.isArray(ref)
        ? ref
            .filter((r) => Boolean(r.current))
            .every((r) => r.current && !r.current.contains(target))
        : ref.current && !ref.current.contains(target);

      if (isOutside) {
        handler(event);
      }
    },
    undefined,
    eventListenerOptions,
  );
}



================================================
FILE: apps/web/src/hooks/useClipboard.tsx
================================================
import { useState } from "react";

export function useClipboard({ timeout = 500 } = {}) {
  const [error, setError] = useState<string | Error | null | undefined>(null);
  const [copied, setCopied] = useState<boolean>(false);
  const [copyTimeout, setCopyTimeout] = useState<number | undefined>(undefined);

  const handleCopyResult = (hasError: boolean) => {
    clearTimeout(copyTimeout);

    setCopyTimeout(
      setTimeout(() => setCopied(false), timeout) as unknown as number,
    );

    setCopied(hasError);
  };

  const copy = (value: string) => {
    if ("clipboard" in navigator) {
      navigator.clipboard
        .writeText(value)
        .then(() => handleCopyResult(true))
        .catch((err) => setError(err));
    } else {
      setError(new Error("Error: navigator.clipboard is not supported"));
    }
  };

  const reset = () => {
    setError(null);
    setCopied(false);
    clearTimeout(copyTimeout);
  };

  return { copy, reset, error, copied };
}



================================================
FILE: apps/web/src/hooks/useDebounce.tsx
================================================
import { useEffect, useState } from "react";

/**
 * A hook that delays updating a value until a specified delay has passed
 * @param value The value to debounce
 * @param delay The delay in milliseconds
 * @returns The debounced value
 */
export function useDebounce<T>(value: T, delay: number): [T] {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const timeoutId = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(timeoutId);
    };
  }, [value, delay]);

  return [debouncedValue];
}



================================================
FILE: apps/web/src/hooks/useDragToScroll.ts
================================================
import { useEffect, useRef, useState } from "react";

interface UseDragToScrollOptions {
  /**
   * Whether drag-to-scroll is enabled
   */
  enabled?: boolean;
  /**
   * The direction to scroll
   */
  direction?: "horizontal" | "vertical" | "both";
}

/**
 * Hook to enable drag-to-scroll functionality on a scrollable element
 * @param options Configuration options
 * @returns Ref to attach to the scrollable element and mouse event handlers
 */
export function useDragToScroll({
  enabled = true,
  direction = "horizontal",
}: UseDragToScrollOptions = {}) {
  const scrollRef = useRef<HTMLDivElement>(null);
  const [isDragging, setIsDragging] = useState(false);
  const startPosRef = useRef({ x: 0, y: 0 });
  const scrollStartRef = useRef({ x: 0, y: 0 });

  useEffect(() => {
    if (!enabled || !isDragging) return;

    const handleMouseMove = (e: MouseEvent) => {
      if (!scrollRef.current) return;

      const deltaX = e.clientX - startPosRef.current.x;
      const deltaY = e.clientY - startPosRef.current.y;

      if (direction === "horizontal" || direction === "both") {
        scrollRef.current.scrollLeft = scrollStartRef.current.x - deltaX;
      }
      if (direction === "vertical" || direction === "both") {
        scrollRef.current.scrollTop = scrollStartRef.current.y - deltaY;
      }
    };

    const handleMouseUp = () => {
      setIsDragging(false);
    };

    document.addEventListener("mousemove", handleMouseMove);
    document.addEventListener("mouseup", handleMouseUp);
    document.body.style.cursor = "grabbing";
    document.body.style.userSelect = "none";

    return () => {
      document.removeEventListener("mousemove", handleMouseMove);
      document.removeEventListener("mouseup", handleMouseUp);
      document.body.style.cursor = "";
      document.body.style.userSelect = "";
    };
  }, [enabled, isDragging, direction]);

  const handleMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {
    if (!scrollRef.current) return;

    const target = e.target as HTMLElement;
    const container = scrollRef.current;

    // Check if the click is on an interactive or draggable element
    // We need to be careful not to interfere with react-beautiful-dnd dragging
    const isInteractiveElement =
      target.closest("a") ||
      target.closest("button") ||
      target.closest("input") ||
      target.closest("textarea") ||
      target.closest("[role='button']") ||
      target.closest("[draggable='true']") ||
      target.closest(".react-beautiful-dnd-drag-handle") ||
      target.closest("[data-rbd-drag-handle-draggable-id]") ||
      target.closest("[data-rbd-draggable-id]");

    // Don't start dragging if clicking on interactive elements
    if (isInteractiveElement) return;

    // Enable drag-to-scroll for any non-interactive element within the container
    if (container.contains(target)) {
      e.preventDefault();
      setIsDragging(true);
      startPosRef.current = { x: e.clientX, y: e.clientY };
      scrollStartRef.current = {
        x: container.scrollLeft,
        y: container.scrollTop,
      };
    }
  };

  return {
    ref: scrollRef,
    onMouseDown: handleMouseDown,
    isDragging,
  };
}



================================================
FILE: apps/web/src/hooks/useEventListener.ts
================================================
import type { RefObject } from "react";
import { useEffect, useRef } from "react";

import { useIsomorphicLayoutEffect } from "./useIsomorphicLayoutEffect";

// MediaQueryList Event based useEventListener interface
function useEventListener<K extends keyof MediaQueryListEventMap>(
  eventName: K,
  handler: (event: MediaQueryListEventMap[K]) => void,
  element: RefObject<MediaQueryList>,
  options?: boolean | AddEventListenerOptions,
): void;

// Window Event based useEventListener interface
function useEventListener<K extends keyof WindowEventMap>(
  eventName: K,
  handler: (event: WindowEventMap[K]) => void,
  element?: undefined,
  options?: boolean | AddEventListenerOptions,
): void;

// Element Event based useEventListener interface
function useEventListener<
  K extends keyof HTMLElementEventMap & keyof SVGElementEventMap,
  T extends Element = K extends keyof HTMLElementEventMap
    ? HTMLDivElement
    : SVGElement,
>(
  eventName: K,
  handler:
    | ((event: HTMLElementEventMap[K]) => void)
    | ((event: SVGElementEventMap[K]) => void),
  element: RefObject<T>,
  options?: boolean | AddEventListenerOptions,
): void;

// Document Event based useEventListener interface
function useEventListener<K extends keyof DocumentEventMap>(
  eventName: K,
  handler: (event: DocumentEventMap[K]) => void,
  element: RefObject<Document>,
  options?: boolean | AddEventListenerOptions,
): void;

/**
 * Custom hook that attaches event listeners to DOM elements, the window, or media query lists.
 * @template KW - The type of event for window events.
 * @template KH - The type of event for HTML or SVG element events.
 * @template KM - The type of event for media query list events.
 * @template T - The type of the DOM element (default is `HTMLElement`).
 * @param {KW | KH | KM} eventName - The name of the event to listen for.
 * @param {(event: WindowEventMap[KW] | HTMLElementEventMap[KH] | SVGElementEventMap[KH] | MediaQueryListEventMap[KM] | Event) => void} handler - The event handler function.
 * @param {RefObject<T>} [element] - The DOM element or media query list to attach the event listener to (optional).
 * @param {boolean | AddEventListenerOptions} [options] - An options object that specifies characteristics about the event listener (optional).
 * @public
 * @see [Documentation](https://usehooks-ts.com/react-hook/use-event-listener)
 * @example
 * ```tsx
 * // Example 1: Attach a window event listener
 * useEventListener('resize', handleResize);
 * ```
 * @example
 * ```tsx
 * // Example 2: Attach a document event listener with options
 * const elementRef = useRef(document);
 * useEventListener('click', handleClick, elementRef, { capture: true });
 * ```
 * @example
 * ```tsx
 * // Example 3: Attach an element event listener
 * const buttonRef = useRef<HTMLButtonElement>(null);
 * useEventListener('click', handleButtonClick, buttonRef);
 * ```
 */
function useEventListener<
  KW extends keyof WindowEventMap,
  KH extends keyof HTMLElementEventMap & keyof SVGElementEventMap,
  KM extends keyof MediaQueryListEventMap,
  T extends HTMLElement | SVGAElement | MediaQueryList = HTMLElement,
>(
  eventName: KW | KH | KM,
  handler: (
    event:
      | WindowEventMap[KW]
      | HTMLElementEventMap[KH]
      | SVGElementEventMap[KH]
      | MediaQueryListEventMap[KM]
      | Event,
  ) => void,
  element?: RefObject<T>,
  options?: boolean | AddEventListenerOptions,
) {
  // Create a ref that stores handler
  const savedHandler = useRef(handler);

  useIsomorphicLayoutEffect(() => {
    savedHandler.current = handler;
  }, [handler]);

  useEffect(() => {
    // Define the listening target
    const targetElement: T | Window = element?.current ?? window;

    if (!(targetElement && targetElement.addEventListener)) return;

    // Create event listener that calls handler function stored in ref
    const listener: typeof handler = (event) => {
      savedHandler.current(event);
    };

    targetElement.addEventListener(eventName, listener, options);

    // Remove event listener on cleanup
    return () => {
      targetElement.removeEventListener(eventName, listener, options);
    };
  }, [eventName, element, options]);
}

export { useEventListener };



================================================
FILE: apps/web/src/hooks/useIsomorphicLayoutEffect.ts
================================================
import { useEffect, useLayoutEffect } from "react";

/**
 * Custom hook that uses either `useLayoutEffect` or `useEffect` based on the environment (client-side or server-side).
 * @param {Function} effect - The effect function to be executed.
 * @param {Array<any>} [dependencies] - An array of dependencies for the effect (optional).
 * @example
 * ```tsx
 * useIsomorphicLayoutEffect(() => {
 *   // Code to be executed during the layout phase on the client side
 * }, [dependency1, dependency2]);
 * ```
 */
export const useIsomorphicLayoutEffect =
  typeof window !== "undefined" ? useLayoutEffect : useEffect;



================================================
FILE: apps/web/src/hooks/useLocalisation.ts
================================================
import type { Locale as DateFnsLocale } from "date-fns";
import { useLingui } from "@lingui/react";
import { de, enGB, es, fr, it, nl, pl, ru, ptBR} from "date-fns/locale";

import type { Locale } from "~/locales";
import { useLinguiContext } from "~/providers/lingui";
import { activateLocale } from "~/utils/i18n";

export function useLocalisation() {
  const { i18n } = useLingui();
  const { locale, setLocale, availableLocales } = useLinguiContext();

  const dateLocaleMap: Partial<Record<Locale, DateFnsLocale>> = {
    en: enGB,
    fr,
    de,
    es,
    it,
    nl,
    ru,
    pl,
    "pt-BR": ptBR,
  };

  const currentDateLocale = dateLocaleMap[locale] ?? enGB;

  const handleSetLocale = async (newLocale: Locale) => {
    await activateLocale(newLocale);
    setLocale(newLocale);
  };

  return {
    locale,
    dateLocale: currentDateLocale,
    setLocale: handleSetLocale,
    availableLocales,
    formatNumber: i18n.number,
  };
}



================================================
FILE: apps/web/src/hooks/useMediaQuery.ts
================================================
import { useEffect, useState } from "react";

export function useMediaQuery(query: string): boolean {
  const [matches, setMatches] = useState(false);

  useEffect(() => {
    const media = window.matchMedia(query);
    setMatches(media.matches);

    const listener = (event: MediaQueryListEvent) => {
      setMatches(event.matches);
    };

    media.addEventListener("change", listener);
    return () => media.removeEventListener("change", listener);
  }, [query]);

  return matches;
}

export function useIsMobile(): boolean {
  return useMediaQuery("(max-width: 767px)");
}



================================================
FILE: apps/web/src/hooks/useModalFormState.ts
================================================
import { useEffect } from "react";
import { useModal } from "~/providers/modal";

interface UseModalFormStateOptions<T> {
  modalType: string;
  initialValues: T;
  resetOnClose?: boolean;
}

export function useModalFormState<T extends Record<string, any>>({
  modalType,
  initialValues,
  resetOnClose = false,
}: UseModalFormStateOptions<T>) {
  const { modalContentType, isOpen, getModalState, setModalState, clearModalState } = useModal();
  
  const isCurrentModal = modalContentType === modalType;
  const savedState = getModalState(modalType) as T | undefined;
  
  // get current form state (using the saved values if available, otherwise the initial values)
  const formState = savedState || initialValues;

  const saveFormState = (state: Partial<T>) => {
    if (!isCurrentModal) return;
    
    const currentState = getModalState(modalType) || initialValues;
    const newState = { ...currentState, ...state };
    setModalState(modalType, newState);
  };

  const clearFormState = () => {
    clearModalState(modalType);
  };

  useEffect(() => {
    if (resetOnClose && !isOpen && savedState) {
      clearModalState(modalType);
    }
  }, [isOpen, resetOnClose, savedState, modalType, clearModalState]);

  return {
    formState,
    saveFormState,
    clearFormState,
    isCurrentModal,
    hasSavedState: !!savedState,
  };
} 


================================================
FILE: apps/web/src/hooks/usePermissions.ts
================================================
import type { Permission } from "@kan/shared";
import { useContext } from "react";

import { WorkspaceContext } from "~/providers/workspace";
import { api } from "~/utils/api";

interface UsePermissionsResult {
  permissions: Permission[];
  role: string | null;
  isLoading: boolean;
  hasPermission: (permission: Permission) => boolean;
  canViewCard: boolean;
  canCreateCard: boolean;
  canEditCard: boolean;
  canDeleteCard: boolean;
  canCreateList: boolean;
  canEditList: boolean;
  canDeleteList: boolean;
  canCreateBoard: boolean;
  canEditBoard: boolean;
  canDeleteBoard: boolean;
  canViewComment: boolean;
  canCreateComment: boolean;
  canEditComment: boolean;
  canDeleteComment: boolean;
  canInviteMember: boolean;
  canEditMember: boolean;
  canRemoveMember: boolean;
  canViewWorkspace: boolean;
  canEditWorkspace: boolean;
}

export function usePermissions(): UsePermissionsResult {
  // Check if WorkspaceProvider is available (for public board views, it may not be)
  const workspaceContext = useContext(WorkspaceContext);
  
  // If WorkspaceProvider is not available, return safe defaults
  if (!workspaceContext) {
    const emptyPermissions: UsePermissionsResult = {
      permissions: [],
      role: null,
      isLoading: false,
      hasPermission: () => false,
      canViewCard: false,
      canCreateCard: false,
      canEditCard: false,
      canDeleteCard: false,
      canCreateList: false,
      canEditList: false,
      canDeleteList: false,
      canCreateBoard: false,
      canEditBoard: false,
      canDeleteBoard: false,
      canViewComment: false,
      canCreateComment: false,
      canEditComment: false,
      canDeleteComment: false,
      canInviteMember: false,
      canEditMember: false,
      canRemoveMember: false,
      canViewWorkspace: false,
      canEditWorkspace: false,
    };
    return emptyPermissions;
  }

  const { workspace } = workspaceContext;

  const { data, isLoading } = api.permission.getMyPermissions.useQuery(
    { workspacePublicId: workspace.publicId },
    {
      enabled: !!workspace.publicId,
    },
  );

  const permissions = (data?.permissions ?? []) as Permission[];
  const role = data?.role ?? null;

  const hasPermission = (permission: Permission): boolean => {
    return permissions.includes(permission);
  };

  return {
    permissions,
    role,
    isLoading,
    hasPermission,
    canViewCard: hasPermission("card:view"),
    canCreateCard: hasPermission("card:create"),
    canEditCard: hasPermission("card:edit"),
    canDeleteCard: hasPermission("card:delete"),
    canCreateList: hasPermission("list:create"),
    canEditList: hasPermission("list:edit"),
    canDeleteList: hasPermission("list:delete"),
    canCreateBoard: hasPermission("board:create"),
    canEditBoard: hasPermission("board:edit"),
    canDeleteBoard: hasPermission("board:delete"),
    canViewComment: hasPermission("comment:view"),
    canCreateComment: hasPermission("comment:create"),
    canEditComment: hasPermission("comment:edit"),
    canDeleteComment: hasPermission("comment:delete"),
    canInviteMember: hasPermission("member:invite"),
    canEditMember: hasPermission("member:edit"),
    canRemoveMember: hasPermission("member:remove"),
    canViewWorkspace: hasPermission("workspace:view"),
    canEditWorkspace: hasPermission("workspace:edit"),
  };
}




================================================
FILE: apps/web/src/locales/index.ts
================================================
export const locales = [
  "en",
  "fr",
  "de",
  "es",
  "it",
  "nl",
  "ru",
  "pl",
  "pt-BR"
] as const;

export type Locale = (typeof locales)[number];

export const defaultLocale: Locale = "en";

export const localeNames: Record<Locale, string> = {
  en: "English",
  fr: "FranÃ§ais",
  de: "Deutsch",
  es: "EspaÃ±ol",
  it: "Italiano",
  nl: "Nederlands",
  ru: "Ğ ÑƒÑÑĞºĞ¸Ğ¹",
  pl: "Polski",
  "pt-BR": "PortuguÃªs",
};



================================================
FILE: apps/web/src/locales/de/messages.ts
================================================
/*eslint-disable*/import type{Messages}from"@lingui/core";export const messages=JSON.parse("{\"++rVAm\":[\"Social Media\"],\"+3TYXa\":[\"FÃ¼r langfristige Nachhaltigkeit erkennen wir an, dass alle guten Open-Source-Projekte eine Einnahmequelle benÃ¶tigen. Unsere stammt aus dem kostenpflichtigen Cloud-Angebot fÃ¼r Workspaces mit mehreren Benutzern und fÃ¼r benutzerdefinierte Workspace-Slugs. Es besteht keine Verpflichtung, es zu nutzen, und Sie kÃ¶nnen die Software kostenlos auf Ihrer eigenen Infrastruktur selbst hosten.\"],\"+8Nek/\":[\"Monatlich\"],\"+EkBs0\":[\"Wir konnten ihre einstellungen nicht aktualisieren. Bitte versuchen sie es erneut.\"],\"+MdEsf\":[\"Neues Passwort ist erforderlich\"],\"+OhFss\":[\"Starten Sie kostenlos ohne NutzungsbeschrÃ¤nkungen. FÃ¼r die Zusammenarbeit wechseln Sie zu einem Plan, der zur GrÃ¶ÃŸe Ihres Teams passt.\"],\"+VoTOr\":[\"monatlich abgerechnet\"],\"+cilKj\":[\"Ideas, Research, Planning, Execution, Review, Next Steps, Complete\"],\"+djOzj\":[\"Mitglied einladen\"],\"+nvZ6j\":[\"Labels & Filter\"],\"/8pTF/\":[\"workspace-url\"],\"/Blkmk\":[\"Add description... (type '/' to open commands)\"],\"/DGOJs\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trelloâ€™s simplicity, in open source.\"],\"/K2CvV\":[\"Vorlage\"],\"/asTmx\":[\"Fehlerbericht\"],\"/f3t6v\":[\"Konfigurieren Sie, welche Aktionen fÃ¼r jede Workspace-Rolle erlaubt sind. Diese Berechtigungen gelten fÃ¼r alle Mitglieder mit dieser Rolle.\"],\"/gaSVU\":[\"Roadmap\"],\"/glL9Q\":[\"Keine \",[\"0\"]],\"/lDBHm\":[\"FAQ\"],\"/rn4RE\":[\"Eine leistungsstarke, flexible Kanban-App, die dir hilft, Arbeit zu organisieren, Fortschritte zu verfolgen und Ergebnisse zu liefern â€“ alles an einem Ort.\"],\"/tOdd2\":[\"Dein Profilbild wurde aktualisiert.\"],\"0+0/3e\":[\"Neues Label erstellen\"],\"0+ewPp\":[\"Verbesserung\"],\"0KjpAr\":[\"Kann Mitglieder ansehen\"],\"0StR7t\":[\"Geben Sie Ihr neues Passwort ein\"],\"0dyOHD\":[\"Backlog, To Do, In Progress, Code Review, Done\"],\"0jV46i\":[\"Checklistenelement kann nicht gelÃ¶scht werden\"],\"0qyZ4b\":[\"Berechtigungen werden geladen...\"],\"0rPv1T\":[\"Profilbild aktualisiert\"],\"0xWkkH\":[[\"boardCount\",\"plural\",{\"one\":[\"Board importieren (1)\"],\"other\":[\"Boards importieren (\",[\"boardCount\"],\")\"]}]],\"1/jlQw\":[\"Trusted by fast-moving teams\"],\"14Xi3Z\":[\"Das HinzufÃ¼gen eines neuen Mitglieds kostet zusÃ¤tzlich \",[\"price\"],\" (\",[\"billingType\"],\") pro Platz.\"],\"1H5u1m\":[\"Fragen?\"],\"1HPFNH\":[\"Preis pro Benutzer/Monat\"],\"1WuwiM\":[\"Zu Einstellungen gehen\"],\"1ZVGyT\":[\"Kommentar hinzufÃ¼gen...\"],\"1hzdxO\":[\"Workspace-Berechtigungen\"],\"1iShX0\":[\"Heute fÃ¤llig\"],\"1njn7W\":[\"Hell\"],\"1rVAfU\":[\"Weitere AktivitÃ¤ten laden\"],\"1rWxEw\":[\"Warten auf Kunden\"],\"1sRmLC\":[\"Diskutiere und arbeite gemeinsam an Karten.\"],\"1sSegR\":[\"Brainstorming, Writing, Editing, Design, Approval, Publishing, Done\"],\"1wCGT0\":[\"Unbegrenzte boards\"],\"25fAUC\":[\"Ihrem abmeldelink fehlt ein token. Bitte Ã¶ffnen sie die neueste e-mail und versuchen sie es erneut.\"],\"25mvI+\":[\"Einladungslinks erfordern ein Team- oder Pro-Abonnement. Bitte upgraden Sie Ihren Workspace.\"],\"29sSki\":[\"hat Checklistenelement <0>\",[\"0\"],\"</0> abgeschlossen\"],\"2BBAbc\":[\"Liste\"],\"2Bu8xj\":[\"Keine Boards gefunden\"],\"2M84k3\":[\"Benutzerdefinierte Berechtigungen\"],\"2MPcep\":[\"Import abgeschlossen\"],\"2POOFK\":[\"Kostenlos\"],\"2Py5S/\":[\"Ich bestÃ¤tige, dass alle Daten des Arbeitsbereichs dauerhaft gelÃ¶scht werden, und mÃ¶chte fortfahren.\"],\"2Q871c\":[\"Label konnte nicht hinzugefÃ¼gt werden\"],\"2QGEbi\":[\"Kommentar konnte nicht gelÃ¶scht werden\"],\"2SePRT\":[\"Du wurdest eingeladen, einem Arbeitsbereich auf kan.bn beizutreten.\"],\"2h4PVB\":[\"Der Name deines Arbeitsbereichs wurde aktualisiert.\"],\"2liqDZ\":[\"Ich bestÃ¤tige, dass alle meine Kontodaten dauerhaft gelÃ¶scht werden, und mÃ¶chte fortfahren.\"],\"2q/Q7x\":[\"Sichtbarkeit\"],\"2roTVj\":[\"Feedback gesendet\"],\"3LDCpD\":[\"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.\"],\"3ZjRJY\":[\"hat Checkliste <0>\",[\"0\"],\"</0> umbenannt\"],\"3bqt9U\":[\"Jeder mit diesem Link kann deinem Arbeitsbereich beitreten\"],\"3pIq39\":[\"Administratorrollen\"],\"479pdJ\":[\"BestÃ¤tigen Sie Ihr neues Passwort\"],\"4DOCMI\":[\"YouTube-URL\"],\"4RoY9J\":[\"Blogbeitrag\"],\"4XF0BB\":[\"Profilbild\"],\"4gAX8s\":[\"MenÃ¼ umschalten\"],\"4ix5kl\":[\"Fehler beim Aktualisieren des Profilbilds\"],\"4kJRen\":[\"Schreiben\"],\"4qu8Ec\":[\"14 Tage kostenlose Testversion\"],\"53QYh8\":[\"Board konnte nicht erstellt werden\"],\"55xJ/O\":[\"Fehler beim Ã„ndern des Passworts\"],\"58AiWX\":[\"Bitte bestÃ¤tigen Sie Ihr neues Passwort\"],\"5ACX4z\":[\"Newsletter\"],\"5IXWmO\":[\"ÃœberprÃ¼fe deinen Posteingang\"],\"5P4rhH\":[\"Mitglieder konnten nicht aktualisiert werden\"],\"5eZwRW\":[\"Verbinde dein Trello-Konto, um Boards zu importieren.\"],\"5h8ooz\":[\"API-SchlÃ¼ssel\"],\"5iplxh\":[\"Neues Passwort muss sich vom aktuellen Passwort unterscheiden\"],\"5k0NLb\":[\"ÃœberprÃ¼fung\"],\"5lWFkC\":[\"Anmelden\"],\"5wo3jF\":[\"Settings | \",[\"0\"]],\"69b7aE\":[\"BefehlsmenÃ¼ Ã¶ffnen\"],\"6E4pW0\":[\"White Label\"],\"6EWT6T\":[\"Personalbeschaffung\"],\"6FDocz\":[\"Registrieren mit \"],\"6FsGbN\":[\"Beginnen Sie, indem Sie eine(n) neue(n) \",[\"0\"],\" erstellen\"],\"6OTo9n\":[\"Vorlagenname ist erforderlich\"],\"6S8zjx\":[\"https://www.youtube.com/watch?v=...\"],\"6WSYbN\":[\"Neue(r) \",[\"0\"]],\"6YtxFj\":[\"Name\"],\"6mbe4b\":[\"Einzelpersonen\"],\"6tDFBe\":[\"Die Berechtigungen des Mitglieds wurden aktualisiert.\"],\"6zeSBB\":[\"Kann Karten erstellen\"],\"74F7N/\":[\"Bist du sicher, dass du dein Konto lÃ¶schen mÃ¶chtest?\"],\"7EhE4k\":[\"Label aktualisieren\"],\"7L01XJ\":[\"Aktionen\"],\"7PzzBU\":[\"Benutzer\"],\"7Ufoyg\":[\"Unbegrenzte listen\"],\"7b2yuC\":[\"Bitte gib ein gÃ¼ltiges Passwort ein\"],\"7d1a0d\":[\"Ã–ffentlich\"],\"7eMo+U\":[\"Zur Startseite\"],\"7hktsm\":[\"Erste Schritte\"],\"7i8j3G\":[\"Unternehmen\"],\"8+BY11\":[\"Board-URL in die Zwischenablage kopiert\"],\"86XI28\":[\"BestÃ¤tigen sie ihre e-mail-einstellungen:\"],\"8AbRER\":[\"FÃ¤lligkeitsdatum festlegen\"],\"8Is1ih\":[\"EinfÃ¼hrungsangebot\"],\"8RdLDU\":[\"PersÃ¶nliches Projekt\"],\"8TveY+\":[\"Boards\"],\"8Z4pNX\":[\"Kann Listen erstellen\"],\"8ZoISG\":[\"Confirm URL change\"],\"8iP0S8\":[\"Alles im kostenlosen Plan, plus:\"],\"8yFGGF\":[\"Mitglied konnte nicht entfernt werden\"],\"91W07W\":[\"Custom URLs are a premium feature. You'll be directed to upgrade your account.\"],\"99VIgC\":[\"Mitglied entfernen\"],\"9PaIxv\":[\"Kernfunktionen\"],\"9QmxLI\":[\"Create board\"],\"9cDpsw\":[\"Berechtigungen\"],\"9eF5oV\":[\"Willkommen zurÃ¼ck\"],\"9h7RDh\":[\"Angebot\"],\"9s9O5h\":[\"Fehler beim LÃ¶schen des Arbeitsbereichs\"],\"9u5BOr\":[\"Mitglieder | \",[\"0\"]],\"9wdpwp\":[\"Abrechnungsportal\"],\"9x4DAL\":[[\"0\"],\" nicht gefunden\"],\"9y1RcT\":[\"Wir stehen erst am anfang. \"],\"A23Y7X\":[\"Arbeitsbereich beitreten | kan.bn\"],\"A5hiCy\":[\"Vorlage erstellen\"],\"A8jqN7\":[\"Feedback konnte nicht gesendet werden\"],\"ABCjd9\":[\"VerÃ¶ffentlichung\"],\"ADEin1\":[\"Einstellungen | Abrechnung\"],\"ALhEZV\":[\"Kann Mitglieder einladen\"],\"ANyn0x\":[\"Alles was du brauchst, fÃ¼r immer kostenlos. Unbegrenzte Boards, unbegrenzte Listen, unbegrenzte Karten. Jederzeit upgraden.\"],\"ARvBT/\":[\"jÃ¤hrlich abgerechnet\"],\"ASjvm9\":[\"Workspace-URL\"],\"AUYALh\":[\"DemnÃ¤chst verfÃ¼gbar\"],\"AX4ktp\":[\"Content-Erstellung\"],\"AZI/wb\":[\"Labels & Filter\"],\"AeXO77\":[\"Konto\"],\"Ax/hYa\":[\"Workspace-Beschreibung darf nicht lÃ¤nger als 280 Zeichen sein\"],\"B3xxao\":[\"Karte hinzufÃ¼gen\"],\"BBUDfW\":[\"Dringend\"],\"BEVzjL\":[\"Import fehlgeschlagen\"],\"BJbLe4\":[\"Wir verwenden die <0>AGPL-3.0 lizenz</0>.\"],\"BMkVQ3\":[\"hat Checkliste <0>\",[\"0\"],\"</0> gelÃ¶scht\"],\"BOqTi5\":[\"hat die Karte von <0>\",[\"0\"],\"</0> nach <1>\",[\"1\"],\"</1> verschoben\"],\"BSZSHI\":[\"Board analytics (coming soon)\"],\"BZkYSt\":[[\"0\"],\" Labels entfernt: <0>\",[\"labelList\"],\"</0>\"],\"BhDZlc\":[\"Bist du sicher, dass du den Workspace \",[\"0\"],\" lÃ¶schen mÃ¶chtest?\"],\"Bhgd0l\":[\"Kontaktiere uns\"],\"Bosey8\":[\"Change the language of the app.\"],\"BzEFor\":[\"oder\"],\"C56tim\":[\"FÃ¤lligkeitsdatum konnte nicht aktualisiert werden\"],\"CAL6E9\":[\"Teams\"],\"CB/NpV\":[\"Hohe PrioritÃ¤t\"],\"CHZ1jC\":[\"hat Checklistenelement <0>\",[\"0\"],\"</0> gelÃ¶scht\"],\"CJ3zUq\":[\"Bitte gib einen gÃ¼ltigen Namen ein\"],\"CJWDTP\":[\"Dein Trello-Konto wurde getrennt.\"],\"CJukzS\":[[\"0\"],\" Labels\"],\"CTqTgr\":[\"KÃ¼rzel\"],\"CYWHT+\":[\"Fehler beim Hochladen des Profilbilds\"],\"Ci/KUX\":[\"Einstellungen | Arbeitsbereich\"],\"CkVV1t\":[\"Fehler beim Aktualisieren der Workspace-Beschreibung\"],\"Cmudpi\":[\"Kann Workspace lÃ¶schen\"],\"CozWO1\":[\"Name des Workspaces\"],\"D+NlUC\":[\"System\"],\"D0esZz\":[\"AktivitÃ¤tsprotokoll\"],\"D3C4Yx\":[\"Aktuelles Passwort ist erforderlich\"],\"D7/JvJ\":[\"Passe den quadratischen Zuschnitt an deinen Avatar an.\"],\"D9ROdV\":[\"Einladungslinks\"],\"DAV3uK\":[\"Berechtigungen aktualisiert\"],\"DFjdv0\":[\"Vorlage lÃ¶schen\"],\"DMeWZD\":[\"Sind Sie sicher, dass Sie diese(n) \",[\"0\"],\" lÃ¶schen mÃ¶chten?\"],\"DPfwMq\":[\"Erledigt\"],\"DahTzR\":[\"Checkliste kann nicht gelÃ¶scht werden\"],\"DbZgsJ\":[\"Als Vorlage speichern\"],\"DhLN1b\":[\"No boards\"],\"DtXlZq\":[\"Checkliste kann nicht aktualisiert werden\"],\"E0t3jO\":[\"hat Checklistenelement <0>\",[\"0\"],\"</0> hinzugefÃ¼gt\"],\"E8zYtd\":[\"hat <0>\",[\"0\"],\"</0> von der Karte entfernt\"],\"ECJKc4\":[\"API-SchlÃ¼ssel erstellt\"],\"EEHmPC\":[\"EinfÃ¼hrungsangebot: Erhalten Sie unbegrenzte Mitglieder mit Pro\"],\"EEQaqX\":[\"assigned <0>\",[\"memberName\"],\"</0> to the card\"],\"EH8IL3\":[\"Checklisten\"],\"EM/caO\":[\"moved the card from <0>\",[\"fromList\"],\"</0> to<1>\",[\"toList\"],\"</1>\"],\"ERpq2P\":[\"Keine Ergebnisse gefunden fÃ¼r \\\"\",[\"debouncedQuery\"],\"\\\".\"],\"ESClHO\":[\"PrioritÃ¤ts-E-Mail-Support\"],\"Eg99Sc\":[\"Derzeit sind keine Authentifizierungsmethoden verfÃ¼gbar\"],\"EifmPY\":[\"To Do, In Progress, Done\"],\"Eit43O\":[\"hat den FÃ¤lligkeitstermin festgelegt\"],\"EkH9pt\":[\"Aktualisieren\"],\"EvArWh\":[\"Arbeite nahtlos mit deinem Team zusammen.\"],\"F/FPk/\":[\"Einstellungen | Berechtigungen\"],\"F/Fhz0\":[\"Create Pro workspace\"],\"F/vB2g\":[\"Ideen zur Verbesserung dieser Seite...\"],\"F3bW6y\":[\"Plattform\"],\"F4KRmY\":[\"$8/Monat\"],\"F4PLG4\":[\"Workspace-Beschreibung aktualisiert\"],\"F8DaWi\":[\"Nur ansehen\"],\"FEr96N\":[\"Design\"],\"FUltnF\":[\"Benutzerdefinierte Vorlagen\"],\"FdtSNC\":[\"Arbeitsbereich erstellen\"],\"FmN5me\":[\"LÃ¶sung\"],\"FmfJjN\":[\"API-SchlÃ¼ssel anzeigen und verwalten.\"],\"Fpci8b\":[\"Sind Sie sicher, dass Sie diese Checkliste lÃ¶schen mÃ¶chten?\"],\"G1Gw0v\":[\"Neue Vorlage\"],\"GAD3Dx\":[\"Benutzerdefinierte Domain\"],\"GDvlUT\":[\"Rolle\"],\"GXsAby\":[\"Revoke\"],\"GYv20o\":[\"Berechtigungen kÃ¶nnen nicht aktualisiert werden\"],\"Gd7sEW\":[\"Benutzerdefinierter Workspace-Link\"],\"GnRmu4\":[\"Checklistenname\"],\"GnSSGm\":[\"Deine Workspace-Beschreibung wurde aktualisiert.\"],\"GoDLB9\":[\"Dein Konto wurde gelÃ¶scht.\"],\"Gxxi5J\":[\"Checkliste hinzufÃ¼gen\"],\"H5G+qG\":[\"Was ist der unterschied zwischen Kan und Trello?\"],\"HBI6nY\":[\"Brauchst du Hilfe?\"],\"HO+uOC\":[\"Priorisierung\"],\"HVIzNO\":[\"Kann Listen ansehen\"],\"HYV6Lq\":[\"Einladung konnte nicht angenommen werden. Bitte versuche es spÃ¤ter erneut oder kontaktiere den Kundensupport.\"],\"HeFWjW\":[\"NÃ¤chste Schritte\"],\"Hg1qE9\":[\"Dein Workspace-Slug wurde aktualisiert.\"],\"I+AROe\":[\"Kann Karten bearbeiten\"],\"I0gAKM\":[\"Liste konnte nicht aktualisiert werden\"],\"IDvohQ\":[\"hat ein Checklistenelement als unvollstÃ¤ndig markiert\"],\"IFgUX6\":[\"Kann Mitglieder entfernen\"],\"IelE1h\":[\"Upgrade auf Pro\"],\"IqjpYe\":[\"E-Mail-Sichtbarkeit\"],\"IrZaAn\":[\"Passwort geÃ¤ndert\"],\"J/hVSQ\":[[\"0\"]],\"J2Wbjt\":[\"Fortfahren mit \"],\"J5nbej\":[\"Kritisch\"],\"J5pbP6\":[\"Kann Mitgliederrollen und -berechtigungen bearbeiten\"],\"JArWcF\":[[\"0\"],\" | \",[\"1\"]],\"JCdzgZ\":[\"Feature-Anfrage\"],\"JUce1S\":[\"Zugewiesene Personen\"],\"JbXXUW\":[\"Beachten Sie, dass diese Aktion nicht rÃ¼ckgÃ¤ngig gemacht werden kann.\"],\"JcCDm9\":[\"Vorlage erstellt\"],\"Jgaz7E\":[\"Berechtigungen zurÃ¼ckgesetzt\"],\"JlFcis\":[\"Send\"],\"JnWJXY\":[\"Magic Link\"],\"JxhWxU\":[\"in\"],\"JyXBgS\":[\"Dokumente\"],\"K3iLeO\":[\"Erfahren Sie, was unsere Nutzer Ã¼ber Kan sagen\"],\"KAsRdK\":[\"Zu Mitgliedern gehen\"],\"KFJgmZ\":[\"Anzeigename muss mindestens 3 Zeichen lang sein\"],\"KLJ4eD\":[\"Einladungslink kopiert\"],\"KNKCTb\":[\"Backlog\"],\"KiVc+q\":[\"Vollzeit\"],\"KuSt9W\":[\"Wie kann ich selbst hosten?\"],\"L5ZPjz\":[\"hat ein Checklistenelement aktualisiert\"],\"LTGE7Y\":[\"Workspace erfolgreich erstellt. Du kannst spÃ¤ter in den Einstellungen upgraden.\"],\"LeM5RY\":[\"Ãœberschreibungen kÃ¶nnen nicht gelÃ¶scht werden\"],\"LoUCpj\":[\"Fehler beim Aktualisieren des Arbeitsbereichsnamens\"],\"LqWW5F\":[\"Dein Anzeigename wurde aktualisiert.\"],\"LrcnbT\":[\"Hosten Sie Kan auf Ihrer eigenen Infrastruktur. Ideal fÃ¼r Organisationen, die vollstÃ¤ndige Kontrolle Ã¼ber ihre Daten benÃ¶tigen.\"],\"Ls++vT\":[\"Schnell & leichtgewichtig\"],\"Lt+ZP3\":[\"hat ein Checklistenelement abgeschlossen\"],\"M43OaK\":[\"Upgrade to Team Plan\"],\"M9p3Vw\":[\"Unbegrenztes aktivitÃ¤tsprotokoll\"],\"MFKlMB\":[\"Einladen\"],\"MHrjPM\":[\"Titel\"],\"MI5OBT\":[\"URL darf nur Buchstaben, Zahlen und Bindestriche enthalten\"],\"MK16u2\":[\"Keine Termine\"],\"MKAScN\":[\"Kann Boards ansehen\"],\"MN6YzG\":[\"Workspace-Slug aktualisiert\"],\"MWrbWq\":[\"Einstellungen | Konto\"],\"MdN5zD\":[\"Sie mÃ¼ssen Administrator sein, um Workspace-Berechtigungen zu verwalten.\"],\"MdwUGG\":[\"Spare Zeit mit wiederverwendbaren Board-Vorlagen.\"],\"MeO/vH\":[\"Dies fÃ¼hrt zur permanenten LÃ¶schung aller mit diesem Workspace verbundenen Daten.\"],\"MlyjJu\":[\"Anzeigename darf nicht lÃ¤nger als 280 Zeichen sein\"],\"MxQXhL\":[\"Workspace konnte nicht erstellt werden\"],\"N/bcWA\":[\"Login | kan.bn\"],\"N3380t\":[\"Kann Boards erstellen\"],\"N7aud6\":[\"Intelligente Suche\"],\"NH54UR\":[\"hat Checklistenelement in <0>\",[\"0\"],\"</0> umbenannt\"],\"NgaR6B\":[\"Gib dein Passwort ein\"],\"NypLoL\":[\"hat eine Checkliste umbenannt\"],\"O0li0W\":[\"Geben Sie Ihr aktuelles Passwort ein und wÃ¤hlen Sie ein neues sicheres Passwort.\"],\"O1wAlQ\":[\"Gast\"],\"O3oNi5\":[\"E-Mail\"],\"O83K21\":[\"hat ein Checklistenelement hinzugefÃ¼gt\"],\"O9jVbx\":[\"Niedrige PrioritÃ¤t\"],\"OAYToL\":[\"Dadurch werden alle benutzerdefinierten Mitgliederberechtigungen in diesem Workspace entfernt. Mitglieder erben Berechtigungen nur von ihren Rollen.\"],\"OIA0ad\":[\"Workspace-Name aktualisiert\"],\"OZtEcz\":[\"API\"],\"OpNhRn\":[\"Keine Kreditkarte erforderlich\"],\"OtjenF\":[\"Bitte gib eine gÃ¼ltige E-Mail-Adresse ein\"],\"OvoEq7\":[\"Mitglied\"],\"Ozt2vv\":[\"Ihr Passwort wurde geÃ¤ndert.\"],\"P6dJdq\":[\"Ãœberschreibungen gelÃ¶scht\"],\"P8bryV\":[\"New Ticket, Triaging, In Progress, Awaiting Customer, Resolution, Done\"],\"PCIlOO\":[\"Mitglied hinzufÃ¼gen\"],\"PRjvDT\":[\"Bist du sicher, dass du diesen Kommentar lÃ¶schen mÃ¶chtest?\"],\"PRofO0\":[\"YouTube-Video bearbeiten\"],\"PTzsxH\":[\"Board-Sichtbarkeit aktualisiert\"],\"PZCqeW\":[\"Bitte versuche es spÃ¤ter erneut.\"],\"Pa9/o1\":[\"Create API keys to access the Kan API.\"],\"PpZkda\":[\"Features\"],\"PyYD/v\":[\"hat <0>\",[\"0\"],\"</0> der Karte zugewiesen\"],\"Q9pQaX\":[\"FÃ¼r diesen Workspace wurden noch keine Rollen gefunden.\"],\"QD8opX\":[\"Board\"],\"QHhZeE\":[\"Vorlage erfolgreich erstellt\"],\"QNtP5M\":[\"Vorlage verwenden\"],\"Qh7QmR\":[\"Aus Favoriten entfernt\"],\"QtACvI\":[\"Label erstellen\"],\"Qtzfdk\":[\"Pro-Plan âˆ\"],\"R+w/Va\":[\"Abrechnung\"],\"R1c3Mq\":[\"Boardname ist erforderlich\"],\"R275Pz\":[\"Sie haben unbegrenzte PlÃ¤tze mit Ihrem Pro-Plan. FÃ¼r neue Mitglieder fallen keine zusÃ¤tzlichen Kosten an!\"],\"R3FsF4\":[\"Download fehlgeschlagen\"],\"R6pB8R\":[\"Stern auf Github\"],\"RHZu7R\":[\"Von Teams weltweit geliebt\"],\"RJA+sg\":[\"Neues Ticket\"],\"RRn9jf\":[\"Klicke auf den Link, den wir an \",[\"magicLinkRecipient\"],\" gesendet haben, um dich anzumelden.\"],\"RSGOS1\":[\"Kann Listen lÃ¶schen\"],\"RfgJqw\":[\"hat den FÃ¤lligkeitstermin aktualisiert\"],\"RkXlPZ\":[\"GitHub\"],\"RoafuO\":[\"Feedback senden\"],\"RtlIYB\":[\"Sie sind dabei, Ihr Passwort zu Ã¤ndern.\"],\"SFnH1j\":[\"Warum ein open source Trello entwickeln?\"],\"SKqXzW\":[\"added label <0>\",[\"label\"],\"</0>\"],\"SMaFdc\":[\"Abmelden\"],\"SNfg0e\":[\"Kann Workspace ansehen\"],\"SPLN9O\":[\"Besitze deine Daten\"],\"STSYcd\":[\"Kann Kommentare lÃ¶schen\"],\"SWEskc\":[\"URL muss mindestens 3 Zeichen lang sein\"],\"Sb2gYF\":[\"Neue Liste\"],\"ScJ9fj\":[\"Datenschutzrichtlinie\"],\"Se/UIp\":[\"Zu erledigen\"],\"SkCNhl\":[\"Boards und Karten durchsuchen...\"],\"SlfejT\":[\"Fehler\"],\"T/pF0Z\":[\"Aus Favoriten entfernen\"],\"T21jY/\":[\"hat ein Label zur Karte hinzugefÃ¼gt\"],\"T7DJ2k\":[\"Kommentar konnte nicht hinzugefÃ¼gt werden\"],\"T7LJic\":[\"hat die Karte in eine andere Liste verschoben\"],\"T7Mywq\":[\"Tafel konnte nicht aktualisiert werden\"],\"TCOMOO\":[\"Berechtigungen bearbeiten\"],\"TFv5tM\":[\"Rolle kann nicht aktualisiert werden\"],\"TH3Irz\":[\"Berechtigung\"],\"TKFUnX\":[\"Konto gelÃ¶scht\"],\"TXO5TM\":[\"Keine TastaturkÃ¼rzel registriert.\"],\"TYli1B\":[\"Kann Kommentare bearbeiten\"],\"TbjyhA\":[\"Dokumente\"],\"TcXcmk\":[\"Code-Review\"],\"TjREUS\":[\"Neuer API-SchlÃ¼ssel\"],\"TmvrjU\":[\"Board-URL muss mindestens 3 Zeichen lang sein\"],\"TvY/XA\":[\"Dokumentation\"],\"Tz0i8g\":[\"Einstellungen\"],\"TztLaN\":[\"Liste konnte nicht erstellt werden\"],\"U3pytU\":[\"Admin\"],\"U5dMR6\":[\"Workspace anzeigen\"],\"UCLeG0\":[\"Nutzungsbedingungen\"],\"UQbwrz\":[\"Alle Systeme funktionieren\"],\"URAE3q\":[\"Pausiert\"],\"USVCGU\":[\"Fehler beim Deaktivieren des Einladungslinks\"],\"UbRKMZ\":[\"Ausstehend\"],\"UbYdrA\":[\"ZahlungshÃ¤ufigkeit\"],\"UeDFpo\":[\"Wie wird das Projekt finanziert?\"],\"UlhdTP\":[\"Workspace gelÃ¶scht\"],\"Un80BR\":[\"OSS-Freunde\"],\"UveK6V\":[\"Zur App\"],\"Uworke\":[\"Teilzeit\"],\"UxKoFf\":[\"Navigation\"],\"V3MPSQ\":[\"hat den Titel aktualisiert\"],\"V8YWP3\":[\"Benutzerdefinierten Titel eingeben\"],\"VHS0aJ\":[\"Alle benutzerdefinierten Berechtigungen lÃ¶schen?\"],\"VKoDQD\":[\"Neue(n) \",[\"0\"],\" erstellen\"],\"VUZDlr\":[\"Kundenstimmen\"],\"VXk54Y\":[\"hat sich selbst die Karte zugewiesen\"],\"VbyRUy\":[\"Kommentare\"],\"VhMDMg\":[\"Passwort Ã¤ndern\"],\"Vt50G1\":[\"Einfaches Kanban\"],\"W/Elkg\":[\"Mittlere PrioritÃ¤t\"],\"W/nQk1\":[\"Kostenloser Plan\"],\"W5r8Qh\":[\"hat ein Checklistenelement gelÃ¶scht\"],\"W8oT+L\":[\"Videoinformationen konnten nicht abgerufen werden\"],\"WHHLh9\":[\"Anhang kann nicht gelÃ¶scht werden\"],\"WI4eGo\":[\"Wie erhalte ich eine benutzerdefinierte URL?\"],\"WQPDcG\":[\"Checklistenelement kann nicht aktualisiert werden\"],\"WRkpB1\":[\"Registrierung deaktiviert\"],\"WRsbHO\":[\"Dein Trello-Konto ist verbunden.\"],\"WYDptz\":[\"Abonnement erforderlich\"],\"WYwN1G\":[\"Neuer Import\"],\"WbTDwg\":[\"In Bearbeitung\"],\"Weq9zb\":[\"Allgemein\"],\"WmPhYW\":[\"Beim Trennen deines Trello-Kontos ist ein Fehler aufgetreten.\"],\"WnEwDO\":[\"Du hast bereits ein Konto? <0><1>Anmelden</1></0>\"],\"Wy6pcF\":[\"Board-Sichtbarkeit konnte nicht aktualisiert werden\"],\"X0N0PA\":[\" (bearbeitet)\"],\"XDRXbZ\":[\"Workspace-Beschreibung muss mindestens 3 Zeichen lang sein\"],\"XILg0L\":[\"UngÃ¼ltige E-Mail-Adresse\"],\"XJOV1Y\":[\"AktivitÃ¤t\"],\"XTKtey\":[\"Liste erstellen\"],\"XXbgHS\":[\"Eingestellt\"],\"XYLcNv\":[\"Support\"],\"XicmhT\":[\"FÃ¤lligkeitsdatum\"],\"Xid3K6\":[\"Board-URL darf nur Buchstaben, Zahlen und Bindestriche enthalten\"],\"Xjj/kS\":[\"Kanban neu gedacht\"],\"XpcjLO\":[\"Board-URL kann nicht aktualisiert werden\"],\"XyuOHa\":[\"Board-Freigabe & Einladungen\"],\"YBBifR\":[\"Trello trennen\"],\"YKeYae\":[\"Checklisten-Element konnte nicht neu angeordnet werden\"],\"YQqv2e\":[\"Get started by creating a new board\"],\"YVT40D\":[\"hat Label <0>\",[\"0\"],\"</0> entfernt\"],\"YaZDYI\":[\"Fehler beim Upgrade des Abonnements\"],\"YcyP2z\":[\"Vorlage konnte nicht erstellt werden\"],\"Yf9FAx\":[\"Sie werden keinen Zugriff mehr auf diesen Workspace haben.\"],\"YhvWXb\":[\"Board-Analytik\"],\"YirHq7\":[\"Feedback\"],\"YoyKbT\":[\"Dieser API-SchlÃ¼ssel wird nur einmal angezeigt. Bitte speichern Sie ihn an einem sicheren Ort.\"],\"YtUfwW\":[\"Anmeldung mit \",[\"0\"],\" fehlgeschlagen. Bitte versuche es erneut.\"],\"Z3FXyt\":[\"Wird geladen...\"],\"Z3krJD\":[\"Workspace-Mitgliedern erlauben, die E-Mail-Adressen der anderen zu sehen\"],\"Z6r9z1\":[\"Karte konnte nicht gelÃ¶scht werden\"],\"Z7/Xyy\":[\"Applicants, Screening, Interviewing, Offer, Onboarding, Hired\"],\"ZDGm40\":[\"Konto lÃ¶schen\"],\"ZDIydz\":[\"Loslegen\"],\"ZDo4HN\":[\"Brainstorming\"],\"ZH7TVS\":[\"Kartentitel\"],\"ZL1A+p\":[\"Fehler beim Hochladen des Anhangs. Bitte versuchen Sie es erneut.\"],\"ZT4Khw\":[\"Bist du sicher, dass du diese Karte lÃ¶schen mÃ¶chtest?\"],\"ZU5IYI\":[\"Unbegrenzte boards, unbegrenzte listen, unbegrenzte karten. Keine kreditkarte erforderlich.\"],\"ZXSPJt\":[\"Ein unerwarteter Fehler ist aufgetreten. Bitte versuchen Sie es spÃ¤ter erneut.\"],\"ZqDqbi\":[\"Organisiere und finde Karten schnell mit leistungsstarken Filterwerkzeugen.\"],\"Zz1qkk\":[\"Unbegrenzte karten\"],\"aHCEmh\":[\"Preise\"],\"aHRWVI\":[\"hat den FÃ¤lligkeitstermin entfernt\"],\"aJ4pMe\":[\"HÃ¤ufig gestellte Fragen\"],\"aWDhU5\":[\"Kanban funktioniert besser im Team. Perfekt fÃ¼r kleine und wachsende Teams, die zusammenarbeiten mÃ¶chten.\"],\"aWlSc/\":[\"Neue Liste erstellen\"],\"abUZlY\":[\"Details hinzufÃ¼gen...\"],\"aelko+\":[\"Du kannst eine benutzerdefinierte workspace-URL, wie <0>kan.bn/kan</0>, erhalten, indem du in deine <1>workspace-einstellungen</1> gehst und ein pro-workspace-abonnement kaufst. Alle abonnements helfen, die entwicklung des projekts zu finanzieren!\"],\"aiHZVP\":[\"Dokumentation ansehen\"],\"aj40Mw\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users (free during the beta) and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"b/LfJo\":[\"E-Mail\"],\"b3Thhd\":[\"Hochladen fehlgeschlagen\"],\"b5FKyH\":[\"hat Label <0>\",[\"0\"],\"</0> hinzugefÃ¼gt\"],\"b9XOHo\":[[\"0\"],\" erstellen\"],\"bA2LQS\":[\"FunktionsÃ¼bersicht\"],\"bD8I7O\":[\"Abgeschlossen\"],\"bDI6VI\":[[\"0\"],\" wurde aus Ihren Favoriten entfernt.\"],\"bJZm1W\":[\"Bewerber\"],\"bJtM0P\":[\"Diese Workspace-URL ist reserviert\"],\"bZSICm\":[\"Checklistenelement kann nicht hinzugefÃ¼gt werden\"],\"bcIybO\":[\"Workspace-Name ist erforderlich\"],\"bdztP2\":[\"Recherche\"],\"bfZE+Y\":[\"Die Rolle des Mitglieds wurde aktualisiert.\"],\"bff61F\":[\"Team-Plan\"],\"bfgr/e\":[\"Frage\"],\"bgh/9n\":[\"kann Workspace-Einstellungen verwalten\"],\"bmXKoX\":[[\"0\"],\" Labels hinzugefÃ¼gt: <0>\",[\"labelList\"],\"</0>\"],\"bqAQaT\":[\"Fehler beim LÃ¶schen des Kontos\"],\"c/IAuR\":[\"Wichtig\"],\"c3b0B0\":[\"Loslegen\"],\"c9AJhn\":[\"Arbeitsbereich beitreten\"],\"cAgBMh\":[\"VollstÃ¤ndige Kontrolle und Eigentum:\"],\"cFQEU/\":[\"TastaturkÃ¼rzel Ã¶ffnen\"],\"cOh+MI\":[\"Vorauswahl\"],\"cWcxrL\":[\"Neue Checkliste\"],\"cWtfn1\":[\"Upgrade auf Pro ($29/Monat)\"],\"chyf4J\":[\"Workspace-Beschreibung\"],\"cji2nM\":[\"Fehler beim Erstellen des Einladungslinks\"],\"cnGeoo\":[\"LÃ¶schen\"],\"cp1rsD\":[\"Einladungslink deaktivieren\"],\"csFbe+\":[\"Zu Vorlagen gehen\"],\"curoK5\":[\"Neuer Workspace\"],\"d33Usy\":[\"Checkliste erstellen\"],\"d7XqZJ\":[\"A powerful, flexible kanban app that helps you organise work,\\n              track progress, and deliver resultsâ€”all in one place.\"],\"dEgA5A\":[\"Abbrechen\"],\"dUh9QW\":[\"Planung\"],\"ddrz1m\":[\"ÃœberfÃ¤llig\"],\"delOXn\":[\"Labels konnten nicht aktualisiert werden\"],\"dgr4Kq\":[\"Label bearbeiten\"],\"dmKdk0\":[\"Sobald Sie Ihren Arbeitsbereich lÃ¶schen, gibt es kein ZurÃ¼ck mehr. Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.\"],\"dsLT3m\":[\"Karte erstellen\"],\"dtbpdR\":[\"Trello\"],\"duf3Nr\":[\"Diese Workspace-URL ist bereits vergeben\"],\"e12o5C\":[\"Invite another\"],\"e4hPSt\":[\"Auf Rollenstandards zurÃ¼cksetzen\"],\"eEQyz+\":[\"Verfolge alle kartenÃ¤nderungen mit detaillierter aktivitÃ¤tshistorie.\"],\"ePK91l\":[\"Bearbeiten\"],\"eZCGbT\":[\"Ja, wir bieten einen dauerhaft kostenlosen plan fÃ¼r die individuelle nutzung an. Keine einschrÃ¤nkungen, keine paywalls, keine limits.\"],\"edWbV6\":[\"Link kopiert\"],\"en3oy5\":[\"Feature\"],\"evg7+A\":[\"Deine Boards wurden importiert.\"],\"evj0lK\":[\"Bietet ihr einen kostenlosen Plan an?\"],\"f8fH8W\":[\"Design\"],\"f8lDFq\":[\"hat die Karte erstellt\"],\"fEY2vP\":[\"Karte nicht gefunden\"],\"fJxqi6\":[\"Custom URLs require Pro plan ($29/month)\"],\"fQCrjt\":[\"Die Sichtbarkeit deines Boards wurde auf \",[\"0\"],\" gesetzt.\"],\"fR9laE\":[\"Geben Sie Ihr aktuelles Passwort ein\"],\"fSf2ee\":[\"Sieh dir unsere roadmap an.\"],\"fYVH36\":[\"Kommentar konnte nicht aktualisiert werden\"],\"fvLNDy\":[\"Es wurden noch keine Listen erstellt\"],\"fziA2d\":[\"Unbegrenzte kommentare\"],\"g2xBxu\":[\"Der Import Ihrer Trello-Boards in Kan ist einfach. Sie kÃ¶nnen unserer Schritt-fÃ¼r-Schritt-Anleitung <0>hier</0> folgen.\"],\"gGx5tM\":[\"Bearbeitung\"],\"gL/7jw\":[\"Beschreibung hinzufÃ¼gen... (tippe '/' um Befehle zu Ã¶ffnen oder '@' um jemanden zu erwÃ¤hnen)\"],\"gUX7b+\":[\"Die open source <0/> alternative zu Trello\"],\"gZxH/p\":[\"hat den FÃ¤lligkeitstermin auf <0>\",[\"formattedDate\"],\"</0> geÃ¤ndert\"],\"ghSJ4U\":[\"Der Workspace-Name darf 64 Zeichen nicht Ã¼berschreiten\"],\"gkzAEM\":[\"Fortfahren mit \",[\"0\"]],\"goklcJ\":[\"VorstellungsgesprÃ¤ch\"],\"gpfJ3v\":[\"Kostenlos, fÃ¼r immer\"],\"gukxZ5\":[\"Einarbeitung\"],\"gv5kbo\":[\"Board-URL darf 60 Zeichen nicht Ã¼berschreiten\"],\"h16FyT\":[\"Listen\"],\"h2FKMV\":[\"Sie haben keine Berechtigung\"],\"h4VV67\":[\"hat eine Checkliste hinzugefÃ¼gt\"],\"h7MgpO\":[\"TastaturkÃ¼rzel\"],\"h8DugX\":[\"Labels\"],\"hAMddS\":[\"hat sich selbst von der Karte entfernt\"],\"hXMFoN\":[\"Keine Listen\"],\"hYzsXr\":[\"Einstellungen | Integrationen\"],\"hh61gL\":[\"Import von Trello\"],\"iFxrHK\":[\"Find answers to common questions about the project. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"iHcdea\":[\"FÃ¤llig nÃ¤chste Woche\"],\"iLbjv+\":[\"Kann Workspace bearbeiten\"],\"iQmbPb\":[\"Lizenz\"],\"iTylMl\":[\"Vorlagen\"],\"iVIGZb\":[\"Anhang hochgeladen\"],\"isRobC\":[\"Neu\"],\"iwr7AP\":[\"Ideen\"],\"iy1wb+\":[\"Einstellungen | API\"],\"j2+d/o\":[\"API-Referenz\"],\"j9IZZ0\":[\"Benutzerdefinierte Workspace-URL\"],\"jDRt4n\":[\"MÃ¶chten sie sich abmelden?\"],\"jL82rC\":[\"Benutzerdefinierte Berechtigungen lÃ¶schen\"],\"jNuzV/\":[\"Kann Karten lÃ¶schen\"],\"jQ6I8X\":[\"Rolle aktualisiert\"],\"jZBHkN\":[\"Der Workspace-Name muss mindestens 3 Zeichen lang sein\"],\"jfC/xh\":[\"Kontakt\"],\"jkbHit\":[\"around the world\"],\"jl3aEJ\":[\"hat Checklistenelement <0>\",[\"0\"],\"</0> als unvollstÃ¤ndig markiert\"],\"jlB2RY\":[\"Das eingegebene aktuelle Passwort ist falsch.\"],\"jwI32v\":[\"Board nicht gefunden\"],\"kECVpo\":[\"Sind Sie sicher, dass Sie dieses Label lÃ¶schen mÃ¶chten?\"],\"kQwvU8\":[\"hat ein Label von der Karte entfernt\"],\"kSxwQL\":[\"Du kannst teammitglieder einladen, indem du auf die schaltflÃ¤che \\\"Einladen\\\" in der oberen rechten ecke der <0>mitgliederseite</0> klickst und ihre e-mail-adresse eingibst. Sie erhalten eine e-mail mit einem link zum beitreten zum workspace.\"],\"kYu0eF\":[\"Workspace lÃ¶schen\"],\"kfOGMr\":[\"Schneller Erfolg\"],\"klpSmb\":[\"Workspace-URL bearbeiten\"],\"kp6L3T\":[\"Dieser Workspace-Benutzername ist bereits vergeben\"],\"kryGs+\":[\"Karte\"],\"kuoc68\":[\"$10/Monat\"],\"kwkhPe\":[\"Upgrade\"],\"kxEs5t\":[\"Trello-importe\"],\"l2PIAy\":[\"Selbst hosten mit Github\"],\"l31EoQ\":[\"Finden Sie Antworten auf hÃ¤ufig gestellte Fragen Ã¼ber Kan. KÃ¶nnen Sie nicht finden, wonach Sie suchen? ZÃ¶gern Sie nicht, uns zu <0>kontaktieren</0>.\"],\"l3s5ri\":[\"Importieren\"],\"l4asa1\":[\"Dieses Board ist privat oder existiert nicht\"],\"lGjicL\":[\", oder besuche unsere\"],\"lKAvEd\":[\"Fehler beim Trennen von Trello\"],\"lSNkXg\":[\"All seats are free during the beta until Sept 1st!\"],\"lXvXNI\":[\"Einladungslink konnte nicht kopiert werden\"],\"lYT7pQ\":[\"Liste lÃ¶schen\"],\"lcokBr\":[\"Im Besitz von Atlassian\"],\"lkz85l\":[\"Der hauptunterschied zwischen Kan und Trello ist, dass Kan open source ist und jedem ermÃ¶glicht, unseren code einzusehen, zu Ã¤ndern und dazu beizutragen. Unser cloud-angebot bietet auÃŸerdem keine einschrÃ¤nkungen bei funktionen fÃ¼r die individuelle nutzung, wÃ¤hrend Trello grundlegende funktionen wie die anzahl der boards, die du erstellen kannst, hinter einer paywall versteckt.\"],\"lo8xBK\":[\"Bist du sicher, dass du \",[\"entityLabel\"],\" entfernen mÃ¶chtest?\"],\"lpIMne\":[\"PasswÃ¶rter stimmen nicht Ã¼berein\"],\"lsgnzd\":[\"Fehler beim Upgrade auf Pro\"],\"lyqwgn\":[\"Label hinzufÃ¼gen\"],\"m2nk0i\":[\"Einfache Preisgestaltung\"],\"mErq7F\":[\"Registrieren\"],\"mHhffx\":[\"Checkliste kann nicht erstellt werden\"],\"mTGd3+\":[\"hat eine Checkliste gelÃ¶scht\"],\"mTwGOf\":[\"Dieser Einladungslink ist ungÃ¼ltig oder abgelaufen.\"],\"mU+M00\":[[\"0\"],\" wurde zu Ihren Favoriten hinzugefÃ¼gt.\"],\"mVZH9V\":[\"Als Trello 2011 auf den Markt kam, begeisterte es alle mit seiner sorgfÃ¤ltig gestalteten Einfachheit, aber im Laufe der Jahre verlor es seinen Zauber und entwickelte sich zu etwas, das eher \\\"Jira Lite\\\" Ã¤hnelte. Dieses Projekt ist unser Versuch, den ursprÃ¼nglichen Zauber der Einfachheit von Trello als Open Source wiederzugewinnen.\"],\"mZGPxt\":[\"Einladungslink in die Zwischenablage kopiert\"],\"mchgzf\":[\"Sie haben sich erfolgreich registriert.\"],\"mgXgHu\":[\"Zu Boards gehen\"],\"mwBdZ2\":[\"Dies fÃ¼hrt zur permanenten LÃ¶schung aller mit deinem Konto verbundenen Daten.\"],\"mx8+1u\":[\"Unbegrenzte Mitglieder\"],\"n+xLOH\":[\"Kundensupport\"],\"n1GRql\":[\"Neues Label\"],\"n1ekoW\":[\"Anmelden\"],\"n9V+ps\":[\"Gib deinen Namen ein\"],\"nOhz3x\":[\"Abmelden\"],\"nabda1\":[\"Karte lÃ¶schen\"],\"nbfdhU\":[\"Integrationen\"],\"nhMhRr\":[\"Vielen Dank fÃ¼r dein Feedback!\"],\"njJFtc\":[\"Kommentar lÃ¶schen\"],\"nk7caK\":[\"Trello verbinden\"],\"nol/Fb\":[\"Wie lade ich Teammitglieder ein?\"],\"notwF1\":[\"Vorlagenname darf 100 Zeichen nicht Ã¼berschreiten\"],\"nq7q3Z\":[\"Der API-SchlÃ¼sselname darf 30 Zeichen nicht Ã¼berschreiten\"],\"nqdIhs\":[\"Benutzerdefinierte Board-Vorlagen\"],\"nryrgW\":[\"Alle individuellen BerechtigungsÃ¼berschreibungen wurden auf die Standardwerte ihrer Rolle zurÃ¼ckgesetzt.\"],\"nxb+xc\":[\"unassigned <0>\",[\"memberName\"],\"</0> from the card\"],\"o+JCfN\":[\"Von schnell agierenden Teams<0/>weltweit vertraut\"],\"o7J4JM\":[\"Filter\"],\"o9WLwO\":[\"Karte konnte nicht aktualisiert werden\"],\"oBndex\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"oVBq1w\":[\"pro Benutzer/Monat\"],\"oW13KZ\":[\"Starten Sie noch heute kostenlos\"],\"oXpmwC\":[\"Selbst hostbar\"],\"odFCYX\":[\"UngÃ¼ltige Einladung\"],\"ohktr7\":[\"Kommentare & ErwÃ¤hnungen\"],\"okpxfB\":[\"Neuen SchlÃ¼ssel erstellen\"],\"oyRjD/\":[\"Pro-Plan\"],\"p/hk9N\":[\"Sie haben sich erfolgreich angemeldet.\"],\"pBsoKL\":[\"Zu Favoriten hinzufÃ¼gen\"],\"pFGfsR\":[\"Entdecken Sie einige unserer liebsten Open-Source-Projekte.\"],\"pFKC6A\":[\"API-SchlÃ¼sselname\"],\"pL78ec\":[\"Zu Favoriten hinzugefÃ¼gt\"],\"pXVFJy\":[\"Kann Boards lÃ¶schen\"],\"pa9o5D\":[\"Schneide deinen Avatar zu\"],\"pfa8F0\":[\"Anzeigename\"],\"pmUArF\":[\"Arbeitsbereich\"],\"pnrmSP\":[\"Neue Karte\"],\"poDo/D\":[\"Create new board\"],\"ppaRWv\":[\"Selbst hosten\"],\"pvnfJD\":[\"Dunkel\"],\"q+lt9D\":[\"Fehler beim LÃ¶schen des Labels\"],\"qPP4lD\":[\"Das Einladen von Mitgliedern erfordert einen Team-Plan. Sie werden weitergeleitet, um Ihren Workspace zu upgraden.\"],\"qQXocp\":[\"Kann Workspace-Einstellungen verwalten\"],\"qfUS/w\":[\"Open-Source-Freunde\"],\"qkjvgj\":[\"Dein Arbeitsbereich wurde gelÃ¶scht.\"],\"qlAIQ1\":[\"Remote\"],\"qrT8WB\":[\"#1 Hacker News\"],\"qtE5nt\":[\"Element hinzufÃ¼gen...\"],\"qzdST2\":[\"Board-Sichtbarkeit\"],\"r6BgwX\":[\"Passwort ist fÃ¼r die Anmeldung erforderlich.\"],\"rD6UIt\":[\"In der Cloud starten\"],\"rF8SEQ\":[\"Kommentar bearbeiten\"],\"rRM7r0\":[\"Importieren Sie Ihre Trello-Boards und starten Sie sofort durch.\"],\"rYUZIe\":[\"Quelle auswÃ¤hlen\"],\"raHesj\":[\"Sie wurden abgemeldet!\"],\"rarRW/\":[\"Fehler beim Einladen des Mitglieds\"],\"ri1hHe\":[\"FÃ¤llig nÃ¤chsten Monat\"],\"rmN315\":[\"SpaÃŸ\"],\"rs7L54\":[\"hat ein Mitglied zur Karte hinzugefÃ¼gt\"],\"rtbVvN\":[\"Kann Listen bearbeiten\"],\"s+MGs7\":[\"Ressourcen\"],\"s6iE/c\":[\"Die Registrierung ist derzeit deaktiviert. Bitte versuche es spÃ¤ter erneut.\"],\"sBhOFG\":[\"Einfaches, visuelles Aufgabenmanagement, das einfach funktioniert. Ziehe Karten per Drag-and-drop, arbeite mit deinem Team zusammen und erledige mehr.\"],\"sDLCvT\":[\"Verbinde deine Lieblingstools, um deinen Arbeitsablauf zu optimieren.\"],\"sDuhfK\":[\"EinfÃ¼hrungsangebot: unbegrenzte PlÃ¤tze fÃ¼r nur $29/Monat mit Pro\"],\"sUZo7y\":[\"Registrieren | kan.bn\"],\"sVBn4K\":[\"Fehler beim Aktualisieren des Anzeigenamens\"],\"sY2lzr\":[\"FÃ¼r diesen Anhang ist keine Download-URL verfÃ¼gbar.\"],\"seaklU\":[\"Boards | \",[\"0\"]],\"t+R8+P\":[\"AusfÃ¼hrung\"],\"t/YqKh\":[\"Entfernen\"],\"t2nDzl\":[\"Verwalte deine Abrechnung und dein Abonnement.\"],\"t6FvJH\":[\"Kann Kommentare hinzufÃ¼gen\"],\"tGwwnq\":[\"hat die Beschreibung aktualisiert\"],\"tHcbLF\":[\"Kann Boards bearbeiten\"],\"tHjBUm\":[\"Kan\"],\"tIdipJ\":[\"Board-URL bearbeiten\"],\"tMYIu7\":[\"AktivitÃ¤tsprotokolle\"],\"tTbref\":[\"Passwort ist fÃ¼r die Registrierung erforderlich.\"],\"tYN21H\":[\"Benutzer ist bereits Mitglied dieses Arbeitsbereichs\"],\"tca56/\":[\"Ihre Datei wurde erfolgreich hochgeladen.\"],\"tfDRzk\":[\"Speichern\"],\"tmlJN1\":[\"Bitte geben Sie eine gÃ¼ltige YouTube-URL ein\"],\"tmpW+w\":[\"Board lÃ¶schen\"],\"tyHiOa\":[\"Bitte versuche es spÃ¤ter noch einmal oder kontaktiere den Kundensupport.\"],\"u2+JIh\":[\"Benutzerdefinierte URLs erfordern ein Upgrade auf einen Pro-Plan\"],\"u8JHrO\":[\"Filter lÃ¶schen\"],\"uOqaMC\":[\"Du wurdest eingeladen, einem Arbeitsbereich beizutreten.\"],\"uXGLuq\":[\"API-SchlÃ¼ssel erstellen\"],\"uZg2+w\":[\"Optimiere deinen Workspace fÃ¼r nur $29/Monat. Das bekommst du dafÃ¼r:\"],\"uck1tz\":[\"hat ein Mitglied von der Karte entfernt\"],\"usVytm\":[\"Sobald Sie Ihr Konto lÃ¶schen, gibt es kein ZurÃ¼ck mehr. Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.\"],\"uwBBCy\":[\"Kan ist besser im Team. Perfekt fÃ¼r kleine und wachsende Teams, die zusammenarbeiten mÃ¶chten.\"],\"v+Wp++\":[\"Open Source\"],\"v3YoMA\":[\"Senior\"],\"vAR/I8\":[\"Auf eigener Infrastruktur betreiben\"],\"vAj6xG\":[\"Sie kÃ¶nnen selbst hosten, indem sie den anweisungen in unserem <0>repo</0> folgen.\"],\"vMCCIc\":[\"URL darf nicht lÃ¤nger als 24 Zeichen sein\"],\"vSJd18\":[\"Video\"],\"vUr5JT\":[\"Du hast noch kein Konto? <0><1>Registrieren</1></0>\"],\"vXIe7J\":[\"Sprache\"],\"vXemf6\":[\"Bug\"],\"va/3u1\":[\"Kontrolliere, wer deine Boards ansehen und bearbeiten kann.\"],\"vbskQn\":[\"API-SchlÃ¼sselname ist erforderlich\"],\"veIDCY\":[\"14 Tage kostenlose Testversion starten\"],\"vfRdCZ\":[\"Berechtigungen kÃ¶nnen nicht zurÃ¼ckgesetzt werden\"],\"vgdzLf\":[\"Weitere erstellen\"],\"vifyyw\":[\"Rechtliches\"],\"vlxQFL\":[\"Die Berechtigungen dieses Mitglieds wurden auf die Rollenstandards zurÃ¼ckgesetzt.\"],\"vneRvS\":[\"monatliche Abrechnung\"],\"vuxdLS\":[\"Langfristig\"],\"vwGkYB\":[\"Passwort muss mindestens 8 Zeichen lang sein\"],\"wIb7Ng\":[\"Softwareentwicklung\"],\"wIkTTk\":[\"Workspace name cannot exceed 24 characters\"],\"wM8xd8\":[\"Junior\"],\"wPZBpR\":[\"Bitte wÃ¤hle eine Datei zum Hochladen aus.\"],\"wY+6Ye\":[\"Diese Board-URL ist bereits vergeben\"],\"wakO3W\":[\"hat Checkliste <0>\",[\"0\"],\"</0> hinzugefÃ¼gt\"],\"wewm3j\":[\"Der Name des Boards darf 100 Zeichen nicht Ã¼berschreiten\"],\"wgNoIs\":[\"Alle auswÃ¤hlen\"],\"wlQNTg\":[\"Mitglieder\"],\"wqkcin\":[\"Kann Kommentare ansehen\"],\"wqxglO\":[\"Lernen\"],\"wruKPE\":[\"UnterstÃ¼tze die Entwicklung des Projekts\"],\"wtxjAY\":[\"Workspace-mitglieder\"],\"wzR1hC\":[\"Board name cannot exceed 50 characters\"],\"x0kMO/\":[\"Fehler beim Aktualisieren der Workspace-URL\"],\"x8GeCD\":[\"Anzeigename aktualisiert\"],\"xEbBrW\":[\"Welche lizenz verwendet ihr?\"],\"xJO7ca\":[\"updated the title to <0>\",[\"toTitle\"],\"</0>\"],\"xMn+V9\":[\"Import von Trello\"],\"xRPn3U\":[\"Gib deine E-Mail-Adresse ein\"],\"xvcYhz\":[\"LÃ¶schen Sie alle benutzerdefinierten Mitgliederberechtigungen, sodass alle Mitglieder nur Berechtigungen von ihren Rollenstandards erben.\"],\"yCzSJ3\":[\"Unbegrenzte Workspaces\"],\"yD3ZSw\":[\"Ã„ndern Sie Ihre Spracheinstellungen.\"],\"yH4aFo\":[\"Share invite link\"],\"yV7o5I\":[\"Wie importiere ich meine Trello-Boards?\"],\"yb/fjw\":[\"Genehmigung\"],\"yz7wBu\":[\"SchlieÃŸen\"],\"zC8Whw\":[\"Beginne mit dem Erstellen einer neuen Liste\"],\"zDw80P\":[\"New board\"],\"zEGgv4\":[\"Vergleichen Sie unsere Funktionen, um zu sehen, warum Kan die beste Wahl ist.\"],\"zERArS\":[\"hat den Titel in <0>\",[\"0\"],\"</0> geÃ¤ndert\"],\"zKY5xi\":[\"Einladungslink erstellen\"],\"zLXwCk\":[\"my-workspace-name\"],\"zMjN8w\":[\"REST API\"],\"zMlxCA\":[\"1 Benutzer\"],\"zQPhSa\":[\"In Link umwandeln\"],\"zQX5Dj\":[\"Listenname\"],\"zdMPUq\":[\"removed label <0>\",[\"label\"],\"</0>\"],\"zkWmBh\":[\"JÃ¤hrlich\"],\"zl1b97\":[\"Karte konnte nicht erstellt werden\"],\"zoEbXq\":[\"Kann Karten ansehen\"],\"zto8aj\":[\"Trello getrennt\"],\"zwBp5t\":[\"Privat\"],\"zwWKhA\":[\"Mehr erfahren\"],\"zxKs+y\":[\"Morgen fÃ¤llig\"],\"zzDlyQ\":[\"Erfolg\"]}")as Messages;


================================================
FILE: apps/web/src/locales/en/messages.ts
================================================
/*eslint-disable*/import type{Messages}from"@lingui/core";export const messages=JSON.parse("{\"++rVAm\":[\"Social Media\"],\"+3TYXa\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"+8Nek/\":[\"Monthly\"],\"+EkBs0\":[\"We couldn't update your preferences. Please try again.\"],\"+MdEsf\":[\"New password is required\"],\"+OhFss\":[\"Get started for free, with no usage limits. For collaboration, upgrade to a plan that fits the size of your team.\"],\"+VoTOr\":[\"billed monthly\"],\"+cilKj\":[\"Ideas, Research, Planning, Execution, Review, Next Steps, Complete\"],\"+djOzj\":[\"Invite member\"],\"+nvZ6j\":[\"Labels & Filters\"],\"/8pTF/\":[\"workspace-url\"],\"/Blkmk\":[\"Add description... (type '/' to open commands)\"],\"/DGOJs\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trelloâ€™s simplicity, in open source.\"],\"/K2CvV\":[\"Template\"],\"/asTmx\":[\"Bug Report\"],\"/f3t6v\":[\"Configure which actions are allowed for each workspace role. These permissions apply to all members with that role.\"],\"/gaSVU\":[\"Roadmap\"],\"/glL9Q\":[\"No \",[\"0\"]],\"/lDBHm\":[\"FAQ\"],\"/rn4RE\":[\"A powerful, flexible kanban app that helps you organise work, track progress, and deliver resultsâ€”all in one place.\"],\"/tOdd2\":[\"Your profile image has been updated.\"],\"0+0/3e\":[\"Create new label\"],\"0+ewPp\":[\"Enhancement\"],\"0KjpAr\":[\"Can view members\"],\"0StR7t\":[\"Enter your new password\"],\"0dyOHD\":[\"Backlog, To Do, In Progress, Code Review, Done\"],\"0jV46i\":[\"Unable to delete checklist item\"],\"0qyZ4b\":[\"Loading permissions...\"],\"0rPv1T\":[\"Profile image updated\"],\"0xWkkH\":[[\"boardCount\",\"plural\",{\"one\":[\"Import board (1)\"],\"other\":[\"Import boards (\",[\"boardCount\"],\")\"]}]],\"1/jlQw\":[\"Trusted by fast-moving teams\"],\"14Xi3Z\":[\"Adding a new member will cost an additional \",[\"price\"],\" (\",[\"billingType\"],\") per seat.\"],\"1H5u1m\":[\"Questions?\"],\"1HPFNH\":[\"Price per user/month\"],\"1WuwiM\":[\"Go to settings\"],\"1ZVGyT\":[\"Add a comment...\"],\"1hzdxO\":[\"Workspace permissions\"],\"1iShX0\":[\"Due today\"],\"1njn7W\":[\"Light\"],\"1rVAfU\":[\"Load more activities\"],\"1rWxEw\":[\"Awaiting Customer\"],\"1sRmLC\":[\"Discuss and collaborate on cards.\"],\"1sSegR\":[\"Brainstorming, Writing, Editing, Design, Approval, Publishing, Done\"],\"1wCGT0\":[\"Unlimited boards\"],\"25fAUC\":[\"Your unsubscribe link is missing a token. Please open the latest email and try again.\"],\"25mvI+\":[\"Invite links require a Team or Pro subscription. Please upgrade your workspace.\"],\"29sSki\":[\"completed checklist item <0>\",[\"0\"],\"</0>\"],\"2BBAbc\":[\"List\"],\"2Bu8xj\":[\"No boards found\"],\"2M84k3\":[\"Custom permissions\"],\"2MPcep\":[\"Import complete\"],\"2POOFK\":[\"Free\"],\"2Py5S/\":[\"I acknowledge that all of the workspace data will be permanently deleted and want to proceed.\"],\"2Q871c\":[\"Unable to add label\"],\"2QGEbi\":[\"Unable to delete comment\"],\"2SePRT\":[\"You've been invited to join a workspace on kan.bn.\"],\"2h4PVB\":[\"Your workspace name has been updated.\"],\"2liqDZ\":[\"I acknowledge that all of my account data will be permanently deleted and want to proceed.\"],\"2q/Q7x\":[\"Visibility\"],\"2roTVj\":[\"Feedback sent\"],\"3LDCpD\":[\"This action can't be undone.\"],\"3ZjRJY\":[\"renamed checklist <0>\",[\"0\"],\"</0>\"],\"3bqt9U\":[\"Anyone with this link can join your workspace\"],\"3pIq39\":[\"Admin roles\"],\"479pdJ\":[\"Confirm your new password\"],\"4DOCMI\":[\"YouTube URL\"],\"4RoY9J\":[\"Blog Post\"],\"4XF0BB\":[\"Profile picture\"],\"4gAX8s\":[\"Toggle menu\"],\"4ix5kl\":[\"Error updating profile image\"],\"4kJRen\":[\"Writing\"],\"4qu8Ec\":[\"14 day free trial\"],\"53QYh8\":[\"Failed to create board\"],\"55xJ/O\":[\"Error Changing Password\"],\"58AiWX\":[\"Please confirm your new password\"],\"5ACX4z\":[\"Newsletter\"],\"5IXWmO\":[\"Check your inbox\"],\"5P4rhH\":[\"Unable to update members\"],\"5eZwRW\":[\"Connect your Trello account to import boards.\"],\"5h8ooz\":[\"API keys\"],\"5iplxh\":[\"New password must be different from current password\"],\"5k0NLb\":[\"Review\"],\"5lWFkC\":[\"Sign in\"],\"5wo3jF\":[\"Settings | \",[\"0\"]],\"69b7aE\":[\"Open command menu\"],\"6E4pW0\":[\"White label\"],\"6EWT6T\":[\"Recruitment\"],\"6FDocz\":[\"Sign up with \"],\"6FsGbN\":[\"Get started by creating a new \",[\"0\"]],\"6OTo9n\":[\"Template name is required\"],\"6S8zjx\":[\"https://www.youtube.com/watch?v=...\"],\"6WSYbN\":[\"New \",[\"0\"]],\"6YtxFj\":[\"Name\"],\"6mbe4b\":[\"Individuals\"],\"6tDFBe\":[\"The member's permissions have been updated.\"],\"6zeSBB\":[\"Can create cards\"],\"74F7N/\":[\"Are you sure you want to delete your account?\"],\"7EhE4k\":[\"Update label\"],\"7L01XJ\":[\"Actions\"],\"7PzzBU\":[\"User\"],\"7Ufoyg\":[\"Unlimited lists\"],\"7b2yuC\":[\"Please enter a valid password\"],\"7d1a0d\":[\"Public\"],\"7eMo+U\":[\"Go Home\"],\"7hktsm\":[\"Getting started\"],\"7i8j3G\":[\"Company\"],\"8+BY11\":[\"Board URL copied to clipboard\"],\"86XI28\":[\"Confirm your email preferences:\"],\"8AbRER\":[\"Set due date\"],\"8Is1ih\":[\"Launch offer\"],\"8RdLDU\":[\"Personal Project\"],\"8TveY+\":[\"Boards\"],\"8Z4pNX\":[\"Can create lists\"],\"8ZoISG\":[\"Confirm URL change\"],\"8iP0S8\":[\"Everything in the free plan, plus:\"],\"8yFGGF\":[\"Unable to remove member\"],\"91W07W\":[\"Custom URLs are a premium feature. You'll be directed to upgrade your account.\"],\"99VIgC\":[\"Remove member\"],\"9PaIxv\":[\"Core features\"],\"9QmxLI\":[\"Create board\"],\"9cDpsw\":[\"Permissions\"],\"9eF5oV\":[\"Welcome back\"],\"9h7RDh\":[\"Offer\"],\"9s9O5h\":[\"Error deleting workspace\"],\"9u5BOr\":[\"Members | \",[\"0\"]],\"9wdpwp\":[\"Billing portal\"],\"9x4DAL\":[[\"0\"],\" not found\"],\"9y1RcT\":[\"We're just getting started. \"],\"A23Y7X\":[\"Join workspace | kan.bn\"],\"A5hiCy\":[\"Create template\"],\"A8jqN7\":[\"Unable to send feedback\"],\"ABCjd9\":[\"Publishing\"],\"ADEin1\":[\"Settings | Billing\"],\"ALhEZV\":[\"Can invite members\"],\"ANyn0x\":[\"Everything you need, free forever. Unlimited boards, unlimited lists, unlimited cards. Upgrade any time.\"],\"ARvBT/\":[\"billed annually\"],\"ASjvm9\":[\"Workspace URL\"],\"AUYALh\":[\"Coming soon\"],\"AX4ktp\":[\"Content Creation\"],\"AZI/wb\":[\"Labels & filters\"],\"AeXO77\":[\"Account\"],\"Ax/hYa\":[\"Workspace description cannot exceed 280 characters\"],\"B3xxao\":[\"Add a card\"],\"BBUDfW\":[\"Urgent\"],\"BEVzjL\":[\"Import failed\"],\"BJbLe4\":[\"We are using the <0>AGPL-3.0 license</0>.\"],\"BMkVQ3\":[\"deleted checklist <0>\",[\"0\"],\"</0>\"],\"BOqTi5\":[\"moved the card from <0>\",[\"0\"],\"</0> to<1>\",[\"1\"],\"</1>\"],\"BSZSHI\":[\"Board analytics (coming soon)\"],\"BZkYSt\":[\"removed \",[\"0\"],\" labels: <0>\",[\"labelList\"],\"</0>\"],\"BhDZlc\":[\"Are you sure you want to delete the workspace \",[\"0\"],\"?\"],\"Bhgd0l\":[\"Contact us\"],\"Bosey8\":[\"Change the language of the app.\"],\"BzEFor\":[\"or\"],\"C56tim\":[\"Unable to update due date\"],\"CAL6E9\":[\"Teams\"],\"CB/NpV\":[\"High Priority\"],\"CHZ1jC\":[\"deleted checklist item <0>\",[\"0\"],\"</0>\"],\"CJ3zUq\":[\"Please enter a valid name\"],\"CJWDTP\":[\"Your Trello account has been disconnected.\"],\"CJukzS\":[[\"0\"],\" labels\"],\"CTqTgr\":[\"Shortcuts\"],\"CYWHT+\":[\"Error uploading profile image\"],\"Ci/KUX\":[\"Settings | Workspace\"],\"CkVV1t\":[\"Error updating workspace description\"],\"Cmudpi\":[\"Can delete workspace\"],\"CozWO1\":[\"Workspace name\"],\"D+NlUC\":[\"System\"],\"D0esZz\":[\"Activity log\"],\"D3C4Yx\":[\"Current password is required\"],\"D7/JvJ\":[\"Adjust the square crop to fit your avatar.\"],\"D9ROdV\":[\"Invite links\"],\"DAV3uK\":[\"Permissions updated\"],\"DFjdv0\":[\"Delete template\"],\"DMeWZD\":[\"Are you sure you want to delete this \",[\"0\"],\"?\"],\"DPfwMq\":[\"Done\"],\"DahTzR\":[\"Unable to delete checklist\"],\"DbZgsJ\":[\"Make template\"],\"DhLN1b\":[\"No boards\"],\"DtXlZq\":[\"Unable to update checklist\"],\"E0t3jO\":[\"added checklist item <0>\",[\"0\"],\"</0>\"],\"E8zYtd\":[\"unassigned <0>\",[\"0\"],\"</0> from the card\"],\"ECJKc4\":[\"API key created\"],\"EEHmPC\":[\"Launch offer: Get unlimited members with Pro\"],\"EEQaqX\":[\"assigned <0>\",[\"memberName\"],\"</0> to the card\"],\"EH8IL3\":[\"Checklists\"],\"EM/caO\":[\"moved the card from <0>\",[\"fromList\"],\"</0> to<1>\",[\"toList\"],\"</1>\"],\"ERpq2P\":[\"No results found for \\\"\",[\"debouncedQuery\"],\"\\\".\"],\"ESClHO\":[\"Priority email support\"],\"Eg99Sc\":[\"No authentication methods are currently available\"],\"EifmPY\":[\"To Do, In Progress, Done\"],\"Eit43O\":[\"set the due date\"],\"EkH9pt\":[\"Update\"],\"EvArWh\":[\"Collaborate seamlessly with your team.\"],\"F/FPk/\":[\"Settings | Permissions\"],\"F/Fhz0\":[\"Create Pro workspace\"],\"F/vB2g\":[\"Ideas to improve this page...\"],\"F3bW6y\":[\"Platform\"],\"F4KRmY\":[\"$8/month\"],\"F4PLG4\":[\"Workspace description updated\"],\"F8DaWi\":[\"View only\"],\"FEr96N\":[\"Theme\"],\"FUltnF\":[\"Custom templates\"],\"FdtSNC\":[\"Create workspace\"],\"FmN5me\":[\"Resolution\"],\"FmfJjN\":[\"View and manage your API keys.\"],\"Fpci8b\":[\"Are you sure you want to delete this checklist?\"],\"G1Gw0v\":[\"New template\"],\"GAD3Dx\":[\"Custom domain\"],\"GDvlUT\":[\"Role\"],\"GXsAby\":[\"Revoke\"],\"GYv20o\":[\"Unable to update permissions\"],\"Gd7sEW\":[\"Custom workspace link\"],\"GnRmu4\":[\"Checklist name\"],\"GnSSGm\":[\"Your workspace description has been updated.\"],\"GoDLB9\":[\"Your account has been deleted.\"],\"Gxxi5J\":[\"Add checklist\"],\"H5G+qG\":[\"What's the difference between Kan and Trello?\"],\"HBI6nY\":[\"Need help?\"],\"HO+uOC\":[\"Triaging\"],\"HVIzNO\":[\"Can view lists\"],\"HYV6Lq\":[\"Failed to accept invitation. Please try again later, or contact customer support.\"],\"HeFWjW\":[\"Next Steps\"],\"Hg1qE9\":[\"Your workspace slug has been updated.\"],\"I+AROe\":[\"Can edit cards\"],\"I0gAKM\":[\"Unable to update list\"],\"IDvohQ\":[\"marked a checklist item as incomplete\"],\"IFgUX6\":[\"Can remove members\"],\"IelE1h\":[\"Upgrade to Pro\"],\"IqjpYe\":[\"Email visibility\"],\"IrZaAn\":[\"Password Changed\"],\"J/hVSQ\":[[\"0\"]],\"J2Wbjt\":[\"Continue with \"],\"J5nbej\":[\"Critical\"],\"J5pbP6\":[\"Can edit member roles and permissions\"],\"JArWcF\":[[\"0\"],\" | \",[\"1\"]],\"JCdzgZ\":[\"Feature Request\"],\"JUce1S\":[\"Assignees\"],\"JbXXUW\":[\"Keep in mind that this action is irreversible.\"],\"JcCDm9\":[\"Template created\"],\"Jgaz7E\":[\"Permissions reset\"],\"JlFcis\":[\"Send\"],\"JnWJXY\":[\"magic link\"],\"JxhWxU\":[\"in\"],\"JyXBgS\":[\"docs\"],\"K3iLeO\":[\"See what our users are saying about Kan\"],\"KAsRdK\":[\"Go to members\"],\"KFJgmZ\":[\"Display name must be at least 3 characters long\"],\"KLJ4eD\":[\"Invite link copied\"],\"KNKCTb\":[\"Backlog\"],\"KiVc+q\":[\"Full-time\"],\"KuSt9W\":[\"How do I self-host?\"],\"L5ZPjz\":[\"updated a checklist item\"],\"LTGE7Y\":[\"Workspace created successfully. You can upgrade later in settings.\"],\"LeM5RY\":[\"Unable to clear overrides\"],\"LoUCpj\":[\"Error updating workspace name\"],\"LqWW5F\":[\"Your display name has been updated.\"],\"LrcnbT\":[\"Host Kan on your own infrastructure. Ideal for organisations that need complete control over their data.\"],\"Ls++vT\":[\"Fast & lightweight\"],\"Lt+ZP3\":[\"completed a checklist item\"],\"M43OaK\":[\"Upgrade to Team Plan\"],\"M9p3Vw\":[\"Unlimited activity log\"],\"MFKlMB\":[\"Invite\"],\"MHrjPM\":[\"Title\"],\"MI5OBT\":[\"URL can only contain letters, numbers, and hyphens\"],\"MK16u2\":[\"No dates\"],\"MKAScN\":[\"Can view boards\"],\"MN6YzG\":[\"Workspace slug updated\"],\"MWrbWq\":[\"Settings | Account\"],\"MdN5zD\":[\"You need to be an admin to manage workspace permissions.\"],\"MdwUGG\":[\"Save time with reusable board templates.\"],\"MeO/vH\":[\"This will result in the permanent deletion of all data associated with this workspace.\"],\"MlyjJu\":[\"Display name cannot exceed 280 characters\"],\"MxQXhL\":[\"Unable to create workspace\"],\"N/bcWA\":[\"Login | kan.bn\"],\"N3380t\":[\"Can create boards\"],\"N7aud6\":[\"Intelligent search\"],\"NH54UR\":[\"renamed checklist item to <0>\",[\"0\"],\"</0>\"],\"NgaR6B\":[\"Enter your password\"],\"NypLoL\":[\"renamed a checklist\"],\"O0li0W\":[\"Enter your current password and choose a new secure password.\"],\"O1wAlQ\":[\"Guest\"],\"O3oNi5\":[\"Email\"],\"O83K21\":[\"added a checklist item\"],\"O9jVbx\":[\"Low Priority\"],\"OAYToL\":[\"This will remove all custom member permissions in this workspace. Members will inherit permissions only from their roles.\"],\"OIA0ad\":[\"Workspace name updated\"],\"OZtEcz\":[\"API\"],\"OpNhRn\":[\"No credit card required\"],\"OtjenF\":[\"Please enter a valid email address\"],\"OvoEq7\":[\"Member\"],\"Ozt2vv\":[\"Your password has been changed.\"],\"P6dJdq\":[\"Overrides cleared\"],\"P8bryV\":[\"New Ticket, Triaging, In Progress, Awaiting Customer, Resolution, Done\"],\"PCIlOO\":[\"Add member\"],\"PRjvDT\":[\"Are you sure you want to delete this comment?\"],\"PRofO0\":[\"Edit YouTube Video\"],\"PTzsxH\":[\"Board visibility updated\"],\"PZCqeW\":[\"Please try again later.\"],\"Pa9/o1\":[\"Create API keys to access the Kan API.\"],\"PpZkda\":[\"Features\"],\"PyYD/v\":[\"assigned <0>\",[\"0\"],\"</0> to the card\"],\"Q9pQaX\":[\"No roles found for this workspace yet.\"],\"QD8opX\":[\"Board\"],\"QHhZeE\":[\"Template created successfully\"],\"QNtP5M\":[\"Use template\"],\"Qh7QmR\":[\"Removed from favorites\"],\"QtACvI\":[\"Create label\"],\"Qtzfdk\":[\"Pro Plan âˆ\"],\"R+w/Va\":[\"Billing\"],\"R1c3Mq\":[\"Board name is required\"],\"R275Pz\":[\"You have unlimited seats with your Pro Plan. There is no additional charge for new members!\"],\"R3FsF4\":[\"Download failed\"],\"R6pB8R\":[\"Star on Github\"],\"RHZu7R\":[\"Loved by teams worldwide\"],\"RJA+sg\":[\"New Ticket\"],\"RRn9jf\":[\"Click on the link we've sent to \",[\"magicLinkRecipient\"],\" to sign in.\"],\"RSGOS1\":[\"Can delete lists\"],\"RfgJqw\":[\"updated the due date\"],\"RkXlPZ\":[\"GitHub\"],\"RoafuO\":[\"Send feedback\"],\"RtlIYB\":[\"You are about to change your password.\"],\"SFnH1j\":[\"Why make an open source Trello?\"],\"SKqXzW\":[\"added label <0>\",[\"label\"],\"</0>\"],\"SMaFdc\":[\"Unsubscribe\"],\"SNfg0e\":[\"Can view workspace\"],\"SPLN9O\":[\"Own your data\"],\"STSYcd\":[\"Can delete comments\"],\"SWEskc\":[\"URL must be at least 3 characters long\"],\"Sb2gYF\":[\"New list\"],\"ScJ9fj\":[\"Privacy policy\"],\"Se/UIp\":[\"To Do\"],\"SkCNhl\":[\"Search boards and cards...\"],\"SlfejT\":[\"Error\"],\"T/pF0Z\":[\"Remove from favorites\"],\"T21jY/\":[\"added a label to the card\"],\"T7DJ2k\":[\"Unable to add comment\"],\"T7LJic\":[\"moved the card to another list\"],\"T7Mywq\":[\"Unable to update board\"],\"TCOMOO\":[\"Edit permissions\"],\"TFv5tM\":[\"Unable to update role\"],\"TH3Irz\":[\"Permission\"],\"TKFUnX\":[\"Account deleted\"],\"TXO5TM\":[\"No keyboard shortcuts registered.\"],\"TYli1B\":[\"Can edit comments\"],\"TbjyhA\":[\"Docs\"],\"TcXcmk\":[\"Code Review\"],\"TjREUS\":[\"New API key\"],\"TmvrjU\":[\"Board URL must be at least 3 characters long\"],\"TvY/XA\":[\"Documentation\"],\"Tz0i8g\":[\"Settings\"],\"TztLaN\":[\"Unable to create list\"],\"U3pytU\":[\"Admin\"],\"U5dMR6\":[\"View workspace\"],\"UCLeG0\":[\"Terms of service\"],\"UQbwrz\":[\"All systems operational\"],\"URAE3q\":[\"Paused\"],\"USVCGU\":[\"Error deactivating invite link\"],\"UbRKMZ\":[\"Pending\"],\"UbYdrA\":[\"Payment frequency\"],\"UeDFpo\":[\"How is the project funded?\"],\"UlhdTP\":[\"Workspace deleted\"],\"Un80BR\":[\"OSS Friends\"],\"UveK6V\":[\"Go to app\"],\"Uworke\":[\"Part-time\"],\"UxKoFf\":[\"Navigation\"],\"V3MPSQ\":[\"updated the title\"],\"V8YWP3\":[\"Enter a custom title\"],\"VHS0aJ\":[\"Clear all custom permissions?\"],\"VKoDQD\":[\"Create new \",[\"0\"]],\"VUZDlr\":[\"Testimonials\"],\"VXk54Y\":[\"self-assigned the card\"],\"VbyRUy\":[\"Comments\"],\"VhMDMg\":[\"Change Password\"],\"Vt50G1\":[\"Basic Kanban\"],\"W/Elkg\":[\"Medium Priority\"],\"W/nQk1\":[\"Free Plan\"],\"W5r8Qh\":[\"deleted a checklist item\"],\"W8oT+L\":[\"Failed to fetch video information\"],\"WHHLh9\":[\"Unable to delete attachment\"],\"WI4eGo\":[\"How do I get a custom URL?\"],\"WQPDcG\":[\"Unable to update checklist item\"],\"WRkpB1\":[\"Sign up disabled\"],\"WRsbHO\":[\"Your Trello account is connected.\"],\"WYDptz\":[\"Subscription Required\"],\"WYwN1G\":[\"New import\"],\"WbTDwg\":[\"In Progress\"],\"Weq9zb\":[\"General\"],\"WmPhYW\":[\"An error occurred while disconnecting your Trello account.\"],\"WnEwDO\":[\"Already have an account? <0><1>Sign in</1></0>\"],\"Wy6pcF\":[\"Unable to update board visibility\"],\"X0N0PA\":[\" (edited)\"],\"XDRXbZ\":[\"Workspace description must be at least 3 characters long\"],\"XILg0L\":[\"Invalid email address\"],\"XJOV1Y\":[\"Activity\"],\"XTKtey\":[\"Create list\"],\"XXbgHS\":[\"Hired\"],\"XYLcNv\":[\"Support\"],\"XicmhT\":[\"Due date\"],\"Xid3K6\":[\"Board URL can only contain letters, numbers, and hyphens\"],\"Xjj/kS\":[\"Kanban reimagined\"],\"XpcjLO\":[\"Unable to update board URL\"],\"XyuOHa\":[\"Board sharing & invites\"],\"YBBifR\":[\"Disconnect Trello\"],\"YKeYae\":[\"Unable to reorder checklist item\"],\"YQqv2e\":[\"Get started by creating a new board\"],\"YVT40D\":[\"removed label <0>\",[\"0\"],\"</0>\"],\"YaZDYI\":[\"Error upgrading subscription\"],\"YcyP2z\":[\"Unable to create template\"],\"Yf9FAx\":[\"They won't be able to access this workspace.\"],\"YhvWXb\":[\"Board analytics\"],\"YirHq7\":[\"Feedback\"],\"YoyKbT\":[\"This API key will only be shown once. Please save it in a secure location.\"],\"YtUfwW\":[\"Failed to login with \",[\"0\"],\". Please try again.\"],\"Z3FXyt\":[\"Loading...\"],\"Z3krJD\":[\"Allow workspace members to see each other's email addresses\"],\"Z6r9z1\":[\"Unable to delete card\"],\"Z7/Xyy\":[\"Applicants, Screening, Interviewing, Offer, Onboarding, Hired\"],\"ZDGm40\":[\"Delete account\"],\"ZDIydz\":[\"Get started\"],\"ZDo4HN\":[\"Brainstorming\"],\"ZH7TVS\":[\"Card title\"],\"ZL1A+p\":[\"Failed to upload attachment. Please try again.\"],\"ZT4Khw\":[\"Are you sure you want to delete this card?\"],\"ZU5IYI\":[\"Unlimited boards, unlimited lists, unlimited cards. No credit card required.\"],\"ZXSPJt\":[\"An unexpected error occurred. Please try again later.\"],\"ZqDqbi\":[\"Organize and find cards quickly with powerful filtering tools.\"],\"Zz1qkk\":[\"Unlimited cards\"],\"aHCEmh\":[\"Pricing\"],\"aHRWVI\":[\"removed the due date\"],\"aJ4pMe\":[\"FAQs\"],\"aWDhU5\":[\"Kanban is better with a team. Perfect for small and growing teams looking to collaborate.\"],\"aWlSc/\":[\"Create new list\"],\"abUZlY\":[\"Add details...\"],\"aelko+\":[\"You can get a custom workspace URL, like <0>kan.bn/kan</0>, by going into your <1>workspace settings</1> and purchasing a pro workspace subscription. All subscriptions help fund the development of the project!\"],\"aiHZVP\":[\"View docs\"],\"aj40Mw\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users (free during the beta) and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"b/LfJo\":[\"email\"],\"b3Thhd\":[\"Upload failed\"],\"b5FKyH\":[\"added label <0>\",[\"0\"],\"</0>\"],\"b9XOHo\":[\"Create \",[\"0\"]],\"bA2LQS\":[\"Feature breakdown\"],\"bD8I7O\":[\"Complete\"],\"bDI6VI\":[[\"0\"],\" has been removed from your favorites.\"],\"bJZm1W\":[\"Applicants\"],\"bJtM0P\":[\"This workspace URL is reserved\"],\"bZSICm\":[\"Unable to add checklist item\"],\"bcIybO\":[\"Workspace name is required\"],\"bdztP2\":[\"Research\"],\"bfZE+Y\":[\"The member's role has been updated.\"],\"bff61F\":[\"Team Plan\"],\"bfgr/e\":[\"Question\"],\"bgh/9n\":[\"can manage workspace settings\"],\"bmXKoX\":[\"added \",[\"0\"],\" labels: <0>\",[\"labelList\"],\"</0>\"],\"bqAQaT\":[\"Error deleting account\"],\"c/IAuR\":[\"Important\"],\"c3b0B0\":[\"Get Started\"],\"c9AJhn\":[\"Join workspace\"],\"cAgBMh\":[\"Complete control and ownership:\"],\"cFQEU/\":[\"Open keyboard shortcuts\"],\"cOh+MI\":[\"Screening\"],\"cWcxrL\":[\"New checklist\"],\"cWtfn1\":[\"Upgrade to Pro ($29/month)\"],\"chyf4J\":[\"Workspace description\"],\"cji2nM\":[\"Error creating invite link\"],\"cnGeoo\":[\"Delete\"],\"cp1rsD\":[\"Deactivate invite link\"],\"csFbe+\":[\"Go to templates\"],\"curoK5\":[\"New workspace\"],\"d33Usy\":[\"Create checklist\"],\"d7XqZJ\":[\"A powerful, flexible kanban app that helps you organise work,\\n              track progress, and deliver resultsâ€”all in one place.\"],\"dEgA5A\":[\"Cancel\"],\"dUh9QW\":[\"Planning\"],\"ddrz1m\":[\"Overdue\"],\"delOXn\":[\"Unable to update labels\"],\"dgr4Kq\":[\"Edit label\"],\"dmKdk0\":[\"Once you delete your workspace, there is no going back. This action cannot be undone.\"],\"dsLT3m\":[\"Create card\"],\"dtbpdR\":[\"Trello\"],\"duf3Nr\":[\"This workspace URL has already been taken\"],\"e12o5C\":[\"Invite another\"],\"e4hPSt\":[\"Reset to role defaults\"],\"eEQyz+\":[\"Track all card changes with detailed activity history.\"],\"ePK91l\":[\"Edit\"],\"eZCGbT\":[\"Yes, we offer an forever free plan for individual use. No restrictions, no paywalls, no limits.\"],\"edWbV6\":[\"Link copied\"],\"en3oy5\":[\"Feature\"],\"evg7+A\":[\"Your boards have been imported.\"],\"evj0lK\":[\"Do you offer a free plan?\"],\"f8fH8W\":[\"Design\"],\"f8lDFq\":[\"created the card\"],\"fEY2vP\":[\"Card not found\"],\"fJxqi6\":[\"Custom URLs require Pro plan ($29/month)\"],\"fQCrjt\":[\"The visibility of your board has been set to \",[\"0\"],\".\"],\"fR9laE\":[\"Enter your current password\"],\"fSf2ee\":[\"View our roadmap.\"],\"fYVH36\":[\"Unable to update comment\"],\"fvLNDy\":[\"No lists have been created yet\"],\"fziA2d\":[\"Unlimited comments\"],\"g2xBxu\":[\"Importing your Trello boards into Kan is easy. You can follow our step-by-step guide <0>here</0>.\"],\"gGx5tM\":[\"Editing\"],\"gL/7jw\":[\"Add description... (type '/' to open commands or '@' to mention)\"],\"gUX7b+\":[\"The open source <0/> alternative to Trello\"],\"gZxH/p\":[\"changed the due date to <0>\",[\"formattedDate\"],\"</0>\"],\"ghSJ4U\":[\"Workspace name cannot exceed 64 characters\"],\"gkzAEM\":[\"Continue with \",[\"0\"]],\"goklcJ\":[\"Interviewing\"],\"gpfJ3v\":[\"Free, forever\"],\"gukxZ5\":[\"Onboarding\"],\"gv5kbo\":[\"Board URL cannot exceed 60 characters\"],\"h16FyT\":[\"Lists\"],\"h2FKMV\":[\"You don't have permission\"],\"h4VV67\":[\"added a checklist\"],\"h7MgpO\":[\"Keyboard Shortcuts\"],\"h8DugX\":[\"Labels\"],\"hAMddS\":[\"unassigned themselves from the card\"],\"hXMFoN\":[\"No lists\"],\"hYzsXr\":[\"Settings | Integrations\"],\"hh61gL\":[\"Import from Trello\"],\"iFxrHK\":[\"Find answers to common questions about the project. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"iHcdea\":[\"Due next week\"],\"iLbjv+\":[\"Can edit workspace\"],\"iQmbPb\":[\"License\"],\"iTylMl\":[\"Templates\"],\"iVIGZb\":[\"Attachment uploaded\"],\"isRobC\":[\"New\"],\"iwr7AP\":[\"Ideas\"],\"iy1wb+\":[\"Settings | API\"],\"j2+d/o\":[\"API Reference\"],\"j9IZZ0\":[\"Custom workspace URL\"],\"jDRt4n\":[\"Do you want to unsubscribe?\"],\"jL82rC\":[\"Clear custom permissions\"],\"jNuzV/\":[\"Can delete cards\"],\"jQ6I8X\":[\"Role updated\"],\"jZBHkN\":[\"Workspace name must be at least 3 characters long\"],\"jfC/xh\":[\"Contact\"],\"jkbHit\":[\"around the world\"],\"jl3aEJ\":[\"marked checklist item <0>\",[\"0\"],\"</0> as incomplete\"],\"jlB2RY\":[\"The current password you entered is incorrect.\"],\"jwI32v\":[\"Board not found\"],\"kECVpo\":[\"Are you sure you want to delete this label?\"],\"kQwvU8\":[\"removed a label from the card\"],\"kSxwQL\":[\"You can invite team members by clicking the \\\"Invite\\\" button in the top right corner of the <0>members page</0> and entering their email address. They will receive an email with a link to join the workspace.\"],\"kYu0eF\":[\"Delete workspace\"],\"kfOGMr\":[\"Quick Win\"],\"klpSmb\":[\"Edit workspace URL\"],\"kp6L3T\":[\"This workspace username has already been taken\"],\"kryGs+\":[\"Card\"],\"kuoc68\":[\"$10/month\"],\"kwkhPe\":[\"Upgrade\"],\"kxEs5t\":[\"Trello imports\"],\"l2PIAy\":[\"Self host with Github\"],\"l31EoQ\":[\"Find answers to common questions about Kan. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"l3s5ri\":[\"Import\"],\"l4asa1\":[\"This board is private or does not exist\"],\"lGjicL\":[\", or see our\"],\"lKAvEd\":[\"Error disconnecting Trello\"],\"lSNkXg\":[\"All seats are free during the beta until Sept 1st!\"],\"lXvXNI\":[\"Failed to copy invite link\"],\"lYT7pQ\":[\"Delete list\"],\"lcokBr\":[\"Owned by Atlassian\"],\"lkz85l\":[\"The main difference between Kan and Trello is that Kan is open source, allowing anyone to view, modify, and contribute to our code. Our cloud offering also offers no restrictions on features for individual use, whereas Trello locks basic features such as the number of boards you can create behind a paywall.\"],\"lo8xBK\":[\"Are you sure want to remove \",[\"entityLabel\"],\"?\"],\"lpIMne\":[\"Passwords do not match\"],\"lsgnzd\":[\"Error upgrading to Pro\"],\"lyqwgn\":[\"Add label\"],\"m2nk0i\":[\"Simple pricing\"],\"mErq7F\":[\"Sign Up\"],\"mHhffx\":[\"Unable to create checklist\"],\"mTGd3+\":[\"deleted a checklist\"],\"mTwGOf\":[\"This invitation link is invalid or has expired.\"],\"mU+M00\":[[\"0\"],\" has been added to your favorites.\"],\"mVZH9V\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over the years it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"mZGPxt\":[\"Invite link copied to clipboard\"],\"mchgzf\":[\"You have been signed up successfully.\"],\"mgXgHu\":[\"Go to boards\"],\"mwBdZ2\":[\"This will result in the permanent deletion of all data associated with your account.\"],\"mx8+1u\":[\"Unlimited members\"],\"n+xLOH\":[\"Customer Support\"],\"n1GRql\":[\"New label\"],\"n1ekoW\":[\"Sign In\"],\"n9V+ps\":[\"Enter your name\"],\"nOhz3x\":[\"Logout\"],\"nabda1\":[\"Delete card\"],\"nbfdhU\":[\"Integrations\"],\"nhMhRr\":[\"Thank you for your feedback!\"],\"njJFtc\":[\"Delete comment\"],\"nk7caK\":[\"Connect Trello\"],\"nol/Fb\":[\"How do I invite team members?\"],\"notwF1\":[\"Template name cannot exceed 100 characters\"],\"nq7q3Z\":[\"API key name cannot exceed 30 characters\"],\"nqdIhs\":[\"Custom board templates\"],\"nryrgW\":[\"All member permission overrides have been reset to their role defaults.\"],\"nxb+xc\":[\"unassigned <0>\",[\"memberName\"],\"</0> from the card\"],\"o+JCfN\":[\"Trusted by fast-moving teams<0/>around the world\"],\"o7J4JM\":[\"Filter\"],\"o9WLwO\":[\"Unable to update card\"],\"oBndex\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"oVBq1w\":[\"per user/month\"],\"oW13KZ\":[\"Get started for free today\"],\"oXpmwC\":[\"Self-hostable\"],\"odFCYX\":[\"Invalid invitation\"],\"ohktr7\":[\"Comments & mentions\"],\"okpxfB\":[\"Create new key\"],\"oyRjD/\":[\"Pro Plan\"],\"p/hk9N\":[\"You have been logged in successfully.\"],\"pBsoKL\":[\"Add to favorites\"],\"pFGfsR\":[\"Check out some of our favorite open source projects.\"],\"pFKC6A\":[\"API key name\"],\"pL78ec\":[\"Added to favorites\"],\"pXVFJy\":[\"Can delete boards\"],\"pa9o5D\":[\"Crop your avatar\"],\"pfa8F0\":[\"Display name\"],\"pmUArF\":[\"Workspace\"],\"pnrmSP\":[\"New card\"],\"poDo/D\":[\"Create new board\"],\"ppaRWv\":[\"Self Host\"],\"pvnfJD\":[\"Dark\"],\"q+lt9D\":[\"Error deleting label\"],\"qPP4lD\":[\"Inviting members requires a Team Plan. You'll be redirected to upgrade your workspace.\"],\"qQXocp\":[\"Can manage workspace settings\"],\"qfUS/w\":[\"Open Source Friends\"],\"qkjvgj\":[\"Your workspace has been deleted.\"],\"qlAIQ1\":[\"Remote\"],\"qrT8WB\":[\"#1 Hacker News\"],\"qtE5nt\":[\"Add an item...\"],\"qzdST2\":[\"Board visibility\"],\"r6BgwX\":[\"Password is required to login.\"],\"rD6UIt\":[\"Get started on Cloud\"],\"rF8SEQ\":[\"Edit comment\"],\"rRM7r0\":[\"Import your Trello boards and hit the ground running.\"],\"rYUZIe\":[\"Select source\"],\"raHesj\":[\"You have been unsubscribed!\"],\"rarRW/\":[\"Error inviting member\"],\"ri1hHe\":[\"Due next month\"],\"rmN315\":[\"Fun\"],\"rs7L54\":[\"added a member to the card\"],\"rtbVvN\":[\"Can edit lists\"],\"s+MGs7\":[\"Resources\"],\"s6iE/c\":[\"Sign up is currently disabled. Please try again later.\"],\"sBhOFG\":[\"Simple, visual task management that just works. Drag and drop cards, collaborate with your team, and get more done.\"],\"sDLCvT\":[\"Connect your favorite tools to streamline your workflow.\"],\"sDuhfK\":[\"Launch offer: unlimited seats for just $29/month with Pro\"],\"sUZo7y\":[\"Sign up | kan.bn\"],\"sVBn4K\":[\"Error updating display name\"],\"sY2lzr\":[\"No download URL available for this attachment.\"],\"seaklU\":[\"Boards | \",[\"0\"]],\"t+R8+P\":[\"Execution\"],\"t/YqKh\":[\"Remove\"],\"t2nDzl\":[\"View and manage your billing and subscription.\"],\"t6FvJH\":[\"Can add comments\"],\"tGwwnq\":[\"updated the description\"],\"tHcbLF\":[\"Can edit boards\"],\"tHjBUm\":[\"Kan\"],\"tIdipJ\":[\"Edit board URL\"],\"tMYIu7\":[\"Activity logs\"],\"tTbref\":[\"Password is required to sign up.\"],\"tYN21H\":[\"User is already a member of this workspace\"],\"tca56/\":[\"Your file has been uploaded successfully.\"],\"tfDRzk\":[\"Save\"],\"tmlJN1\":[\"Please enter a valid YouTube URL\"],\"tmpW+w\":[\"Delete board\"],\"tyHiOa\":[\"Please try again later, or contact customer support.\"],\"u2+JIh\":[\"Custom URLs require upgrading to a Pro plan\"],\"u8JHrO\":[\"Clear filters\"],\"uOqaMC\":[\"You've been invited to join a workspace.\"],\"uXGLuq\":[\"Create API key\"],\"uZg2+w\":[\"Supercharge your workspace for just $29/month. Here's what you'll get:\"],\"uck1tz\":[\"removed a member from the card\"],\"usVytm\":[\"Once you delete your account, there is no going back. This action cannot be undone.\"],\"uwBBCy\":[\"Kan is better with a team. Perfect for small and growing teams looking to collaborate.\"],\"v+Wp++\":[\"Open source\"],\"v3YoMA\":[\"Senior\"],\"vAR/I8\":[\"Run on your own infrastructure\"],\"vAj6xG\":[\"You can self-host by following the instructions in our <0>repo</0>.\"],\"vMCCIc\":[\"URL cannot exceed 24 characters\"],\"vSJd18\":[\"Video\"],\"vUr5JT\":[\"Don't have an account? <0><1>Sign up</1></0>\"],\"vXIe7J\":[\"Language\"],\"vXemf6\":[\"Bug\"],\"va/3u1\":[\"Control who can view and edit your boards.\"],\"vbskQn\":[\"API key name is required\"],\"veIDCY\":[\"Start 14 day free trial\"],\"vfRdCZ\":[\"Unable to reset permissions\"],\"vgdzLf\":[\"Create another\"],\"vifyyw\":[\"Legal\"],\"vlxQFL\":[\"This member's permissions have been reset to their role defaults.\"],\"vneRvS\":[\"monthly billing\"],\"vuxdLS\":[\"Long-term\"],\"vwGkYB\":[\"Password must be at least 8 characters\"],\"wIb7Ng\":[\"Software Development\"],\"wIkTTk\":[\"Workspace name cannot exceed 24 characters\"],\"wM8xd8\":[\"Junior\"],\"wPZBpR\":[\"Please select a file to upload.\"],\"wY+6Ye\":[\"This board URL has already been taken\"],\"wakO3W\":[\"added checklist <0>\",[\"0\"],\"</0>\"],\"wewm3j\":[\"Board name cannot exceed 100 characters\"],\"wgNoIs\":[\"Select all\"],\"wlQNTg\":[\"Members\"],\"wqkcin\":[\"Can view comments\"],\"wqxglO\":[\"Learning\"],\"wruKPE\":[\"Support the development of the project\"],\"wtxjAY\":[\"Workspace members\"],\"wzR1hC\":[\"Board name cannot exceed 50 characters\"],\"x0kMO/\":[\"Error updating workspace URL\"],\"x8GeCD\":[\"Display name updated\"],\"xEbBrW\":[\"What license are you using?\"],\"xJO7ca\":[\"updated the title to <0>\",[\"toTitle\"],\"</0>\"],\"xMn+V9\":[\"Importing from Trello\"],\"xRPn3U\":[\"Enter your email address\"],\"xvcYhz\":[\"Clear any custom member permissions so that all members only inherit permissions from their role defaults.\"],\"yCzSJ3\":[\"Unlimited workspaces\"],\"yD3ZSw\":[\"Change your language preferences.\"],\"yH4aFo\":[\"Share invite link\"],\"yV7o5I\":[\"How do I import my Trello boards?\"],\"yb/fjw\":[\"Approval\"],\"yz7wBu\":[\"Close\"],\"zC8Whw\":[\"Get started by creating a new list\"],\"zDw80P\":[\"New board\"],\"zEGgv4\":[\"Compare our features to see why Kan is the best choice.\"],\"zERArS\":[\"updated the title to <0>\",[\"0\"],\"</0>\"],\"zKY5xi\":[\"Create invite link\"],\"zLXwCk\":[\"my-workspace-name\"],\"zMjN8w\":[\"REST API\"],\"zMlxCA\":[\"1 user\"],\"zQPhSa\":[\"Convert to link\"],\"zQX5Dj\":[\"List name\"],\"zdMPUq\":[\"removed label <0>\",[\"label\"],\"</0>\"],\"zkWmBh\":[\"Yearly\"],\"zl1b97\":[\"Unable to create card\"],\"zoEbXq\":[\"Can view cards\"],\"zto8aj\":[\"Trello disconnected\"],\"zwBp5t\":[\"Private\"],\"zwWKhA\":[\"Learn more\"],\"zxKs+y\":[\"Due tomorrow\"],\"zzDlyQ\":[\"Success\"]}")as Messages;


================================================
FILE: apps/web/src/locales/es/messages.ts
================================================
/*eslint-disable*/import type{Messages}from"@lingui/core";export const messages=JSON.parse("{\"++rVAm\":[\"Redes sociales\"],\"+3TYXa\":[\"Para la sostenibilidad a largo plazo, reconocemos que todos los buenos proyectos de cÃ³digo abierto necesitan una fuente de ingresos. La nuestra proviene de la oferta de nube de pago para espacios de trabajo con mÃºltiples usuarios y para slugs de espacio de trabajo personalizados. No hay obligaciÃ³n de usarla, y puedes alojar el software en tu propia infraestructura sin costo alguno.\"],\"+8Nek/\":[\"Mensual\"],\"+EkBs0\":[\"No pudimos actualizar tus preferencias. Por favor, intÃ©ntalo de nuevo.\"],\"+MdEsf\":[\"Se requiere una nueva contraseÃ±a\"],\"+OhFss\":[\"Comienza gratis, sin lÃ­mites de uso. Para colaboraciÃ³n, actualiza a un plan que se ajuste al tamaÃ±o de tu equipo.\"],\"+VoTOr\":[\"facturado mensualmente\"],\"+cilKj\":[\"Ideas, Research, Planning, Execution, Review, Next Steps, Complete\"],\"+djOzj\":[\"Invitar miembro\"],\"+nvZ6j\":[\"Etiquetas y filtros\"],\"/8pTF/\":[\"workspace-url\"],\"/Blkmk\":[\"Add description... (type '/' to open commands)\"],\"/DGOJs\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trelloâ€™s simplicity, in open source.\"],\"/K2CvV\":[\"Plantilla\"],\"/asTmx\":[\"Informe de error\"],\"/f3t6v\":[\"Configura quÃ© acciones estÃ¡n permitidas para cada rol del espacio de trabajo. Estos permisos se aplican a todos los miembros con ese rol.\"],\"/gaSVU\":[\"Hoja de ruta\"],\"/glL9Q\":[\"Sin \",[\"0\"]],\"/lDBHm\":[\"FAQ\"],\"/rn4RE\":[\"Una aplicaciÃ³n kanban potente y flexible que te ayuda a organizar el trabajo, seguir el progreso y entregar resultados, todo en un solo lugar.\"],\"/tOdd2\":[\"Tu imagen de perfil ha sido actualizada.\"],\"0+0/3e\":[\"Crear nueva etiqueta\"],\"0+ewPp\":[\"Mejora\"],\"0KjpAr\":[\"Puede ver miembros\"],\"0StR7t\":[\"Introduce tu nueva contraseÃ±a\"],\"0dyOHD\":[\"Backlog, To Do, In Progress, Code Review, Done\"],\"0jV46i\":[\"No se puede eliminar el elemento de la lista de verificaciÃ³n\"],\"0qyZ4b\":[\"Cargando permisos...\"],\"0rPv1T\":[\"Imagen de perfil actualizada\"],\"0xWkkH\":[[\"boardCount\",\"plural\",{\"one\":[\"Importar tablero (1)\"],\"other\":[\"Importar tableros (\",[\"boardCount\"],\")\"]}]],\"1/jlQw\":[\"Trusted by fast-moving teams\"],\"14Xi3Z\":[\"AÃ±adir un nuevo miembro costarÃ¡ \",[\"price\"],\" adicionales (\",[\"billingType\"],\") por asiento.\"],\"1H5u1m\":[\"Â¿Preguntas?\"],\"1HPFNH\":[\"Precio por usuario/mes\"],\"1WuwiM\":[\"Ir a configuraciÃ³n\"],\"1ZVGyT\":[\"AÃ±adir un comentario...\"],\"1hzdxO\":[\"Permisos del espacio de trabajo\"],\"1iShX0\":[\"Vence hoy\"],\"1njn7W\":[\"Claro\"],\"1rVAfU\":[\"Cargar mÃ¡s actividades\"],\"1rWxEw\":[\"Esperando al cliente\"],\"1sRmLC\":[\"Discute y colabora en las tarjetas.\"],\"1sSegR\":[\"Brainstorming, Writing, Editing, Design, Approval, Publishing, Done\"],\"1wCGT0\":[\"Tableros ilimitados\"],\"25fAUC\":[\"A tu enlace de baja le falta un token. Por favor, abre el Ãºltimo correo electrÃ³nico e intÃ©ntalo de nuevo.\"],\"25mvI+\":[\"Los enlaces de invitaciÃ³n requieren una suscripciÃ³n de Equipo o Pro. Por favor, actualiza tu espacio de trabajo.\"],\"29sSki\":[\"completÃ³ el elemento <0>\",[\"0\"],\"</0> de la lista de verificaciÃ³n\"],\"2BBAbc\":[\"Lista\"],\"2Bu8xj\":[\"No se encontraron tableros\"],\"2M84k3\":[\"Permisos personalizados\"],\"2MPcep\":[\"ImportaciÃ³n completada\"],\"2POOFK\":[\"Gratis\"],\"2Py5S/\":[\"Reconozco que todos los datos del espacio de trabajo serÃ¡n eliminados permanentemente y quiero continuar.\"],\"2Q871c\":[\"No se puede aÃ±adir la etiqueta\"],\"2QGEbi\":[\"No se puede eliminar el comentario\"],\"2SePRT\":[\"Has sido invitado a unirte a un espacio de trabajo en kan.bn.\"],\"2h4PVB\":[\"El nombre de tu espacio de trabajo ha sido actualizado.\"],\"2liqDZ\":[\"Reconozco que todos los datos de mi cuenta serÃ¡n eliminados permanentemente y quiero continuar.\"],\"2q/Q7x\":[\"Visibilidad\"],\"2roTVj\":[\"Comentarios enviados\"],\"3LDCpD\":[\"Esta acciÃ³n no se puede deshacer.\"],\"3ZjRJY\":[\"renombrÃ³ la lista de verificaciÃ³n <0>\",[\"0\"],\"</0>\"],\"3bqt9U\":[\"Cualquier persona con este enlace puede unirse a tu espacio de trabajo\"],\"3pIq39\":[\"Roles de administrador\"],\"479pdJ\":[\"Confirma tu nueva contraseÃ±a\"],\"4DOCMI\":[\"URL de YouTube\"],\"4RoY9J\":[\"Entrada de blog\"],\"4XF0BB\":[\"Foto de perfil\"],\"4gAX8s\":[\"Alternar menÃº\"],\"4ix5kl\":[\"Error al actualizar la imagen de perfil\"],\"4kJRen\":[\"Escritura\"],\"4qu8Ec\":[\"Prueba gratuita de 14 dÃ­as\"],\"53QYh8\":[\"Error al crear el tablero\"],\"55xJ/O\":[\"Error al cambiar la contraseÃ±a\"],\"58AiWX\":[\"Por favor, confirma tu nueva contraseÃ±a\"],\"5ACX4z\":[\"BoletÃ­n\"],\"5IXWmO\":[\"Revisa tu bandeja de entrada\"],\"5P4rhH\":[\"No se pueden actualizar los miembros\"],\"5eZwRW\":[\"Conecta tu cuenta de Trello para importar tableros.\"],\"5h8ooz\":[\"Claves API\"],\"5iplxh\":[\"La nueva contraseÃ±a debe ser diferente de la contraseÃ±a actual\"],\"5k0NLb\":[\"RevisiÃ³n\"],\"5lWFkC\":[\"Iniciar sesiÃ³n\"],\"5wo3jF\":[\"Settings | \",[\"0\"]],\"69b7aE\":[\"Abrir menÃº de comandos\"],\"6E4pW0\":[\"Marca blanca\"],\"6EWT6T\":[\"Reclutamiento\"],\"6FDocz\":[\"Registrarse con \"],\"6FsGbN\":[\"Comienza creando un nuevo \",[\"0\"]],\"6OTo9n\":[\"El nombre de la plantilla es obligatorio\"],\"6S8zjx\":[\"https://www.youtube.com/watch?v=...\"],\"6WSYbN\":[\"Nuevo \",[\"0\"]],\"6YtxFj\":[\"Nombre\"],\"6mbe4b\":[\"Individuos\"],\"6tDFBe\":[\"Los permisos del miembro se han actualizado.\"],\"6zeSBB\":[\"Puede crear tarjetas\"],\"74F7N/\":[\"Â¿EstÃ¡s seguro de que quieres eliminar tu cuenta?\"],\"7EhE4k\":[\"Actualizar etiqueta\"],\"7L01XJ\":[\"Acciones\"],\"7PzzBU\":[\"Usuario\"],\"7Ufoyg\":[\"Listas ilimitadas\"],\"7b2yuC\":[\"Por favor, introduce una contraseÃ±a vÃ¡lida\"],\"7d1a0d\":[\"PÃºblico\"],\"7eMo+U\":[\"Ir a inicio\"],\"7hktsm\":[\"Primeros pasos\"],\"7i8j3G\":[\"Empresa\"],\"8+BY11\":[\"URL del tablero copiada al portapapeles\"],\"86XI28\":[\"Confirma tus preferencias de correo electrÃ³nico:\"],\"8AbRER\":[\"Establecer fecha de vencimiento\"],\"8Is1ih\":[\"Oferta de lanzamiento\"],\"8RdLDU\":[\"Proyecto personal\"],\"8TveY+\":[\"Tableros\"],\"8Z4pNX\":[\"Puede crear listas\"],\"8ZoISG\":[\"Confirm URL change\"],\"8iP0S8\":[\"Todo lo que hay en el plan gratuito, mÃ¡s:\"],\"8yFGGF\":[\"No se puede eliminar al miembro\"],\"91W07W\":[\"Custom URLs are a premium feature. You'll be directed to upgrade your account.\"],\"99VIgC\":[\"Eliminar miembro\"],\"9PaIxv\":[\"CaracterÃ­sticas principales\"],\"9QmxLI\":[\"Create board\"],\"9cDpsw\":[\"Permisos\"],\"9eF5oV\":[\"Bienvenido de nuevo\"],\"9h7RDh\":[\"Oferta\"],\"9s9O5h\":[\"Error al eliminar el espacio de trabajo\"],\"9u5BOr\":[\"Miembros | \",[\"0\"]],\"9wdpwp\":[\"Portal de facturaciÃ³n\"],\"9x4DAL\":[[\"0\"],\" no encontrado\"],\"9y1RcT\":[\"Apenas estamos comenzando. \"],\"A23Y7X\":[\"Unirse al espacio de trabajo | kan.bn\"],\"A5hiCy\":[\"Crear plantilla\"],\"A8jqN7\":[\"No se pudieron enviar los comentarios\"],\"ABCjd9\":[\"PublicaciÃ³n\"],\"ADEin1\":[\"ConfiguraciÃ³n | FacturaciÃ³n\"],\"ALhEZV\":[\"Puede invitar miembros\"],\"ANyn0x\":[\"Todo lo que necesitas, gratis para siempre. Tableros ilimitados, listas ilimitadas, tarjetas ilimitadas. Actualiza en cualquier momento.\"],\"ARvBT/\":[\"facturado anualmente\"],\"ASjvm9\":[\"URL del espacio de trabajo\"],\"AUYALh\":[\"PrÃ³ximamente\"],\"AX4ktp\":[\"CreaciÃ³n de contenido\"],\"AZI/wb\":[\"Etiquetas y filtros\"],\"AeXO77\":[\"Cuenta\"],\"Ax/hYa\":[\"La descripciÃ³n del espacio de trabajo no puede exceder los 280 caracteres\"],\"B3xxao\":[\"AÃ±adir una tarjeta\"],\"BBUDfW\":[\"Urgente\"],\"BEVzjL\":[\"ImportaciÃ³n fallida\"],\"BJbLe4\":[\"Estamos usando la <0>licencia AGPL-3.0</0>.\"],\"BMkVQ3\":[\"eliminÃ³ la lista de verificaciÃ³n <0>\",[\"0\"],\"</0>\"],\"BOqTi5\":[\"moviÃ³ la tarjeta de <0>\",[\"0\"],\"</0> a<1>\",[\"1\"],\"</1>\"],\"BSZSHI\":[\"Board analytics (coming soon)\"],\"BZkYSt\":[\"eliminÃ³ \",[\"0\"],\" etiquetas: <0>\",[\"labelList\"],\"</0>\"],\"BhDZlc\":[\"Â¿EstÃ¡s seguro de que quieres eliminar el espacio de trabajo \",[\"0\"],\"?\"],\"Bhgd0l\":[\"ContÃ¡ctanos\"],\"Bosey8\":[\"Change the language of the app.\"],\"BzEFor\":[\"o\"],\"C56tim\":[\"No se puede actualizar la fecha de vencimiento\"],\"CAL6E9\":[\"Equipos\"],\"CB/NpV\":[\"Alta prioridad\"],\"CHZ1jC\":[\"eliminÃ³ el elemento <0>\",[\"0\"],\"</0> de la lista de verificaciÃ³n\"],\"CJ3zUq\":[\"Por favor, introduce un nombre vÃ¡lido\"],\"CJWDTP\":[\"Tu cuenta de Trello ha sido desconectada.\"],\"CJukzS\":[[\"0\"],\" etiquetas\"],\"CTqTgr\":[\"Atajos\"],\"CYWHT+\":[\"Error al subir la imagen de perfil\"],\"Ci/KUX\":[\"ConfiguraciÃ³n | Espacio de trabajo\"],\"CkVV1t\":[\"Error al actualizar la descripciÃ³n del espacio de trabajo\"],\"Cmudpi\":[\"Puede eliminar el espacio de trabajo\"],\"CozWO1\":[\"Nombre del espacio de trabajo\"],\"D+NlUC\":[\"Sistema\"],\"D0esZz\":[\"Registro de actividad\"],\"D3C4Yx\":[\"Se requiere la contraseÃ±a actual\"],\"D7/JvJ\":[\"Ajusta el recorte cuadrado para que se adapte a tu avatar.\"],\"D9ROdV\":[\"Enlaces de invitaciÃ³n\"],\"DAV3uK\":[\"Permisos actualizados\"],\"DFjdv0\":[\"Eliminar plantilla\"],\"DMeWZD\":[\"Â¿EstÃ¡s seguro de que quieres eliminar este \",[\"0\"],\"?\"],\"DPfwMq\":[\"Terminado\"],\"DahTzR\":[\"No se puede eliminar la lista de verificaciÃ³n\"],\"DbZgsJ\":[\"Crear plantilla\"],\"DhLN1b\":[\"No boards\"],\"DtXlZq\":[\"No se puede actualizar la lista de verificaciÃ³n\"],\"E0t3jO\":[\"aÃ±adiÃ³ el elemento <0>\",[\"0\"],\"</0> a la lista de verificaciÃ³n\"],\"E8zYtd\":[\"desasignÃ³ <0>\",[\"0\"],\"</0> de la tarjeta\"],\"ECJKc4\":[\"Clave API creada\"],\"EEHmPC\":[\"Oferta de lanzamiento: ObtÃ©n miembros ilimitados con Pro\"],\"EEQaqX\":[\"assigned <0>\",[\"memberName\"],\"</0> to the card\"],\"EH8IL3\":[\"Listas de verificaciÃ³n\"],\"EM/caO\":[\"moved the card from <0>\",[\"fromList\"],\"</0> to<1>\",[\"toList\"],\"</1>\"],\"ERpq2P\":[\"No se encontraron resultados para \\\"\",[\"debouncedQuery\"],\"\\\".\"],\"ESClHO\":[\"Soporte prioritario por email\"],\"Eg99Sc\":[\"No hay mÃ©todos de autenticaciÃ³n disponibles actualmente\"],\"EifmPY\":[\"To Do, In Progress, Done\"],\"Eit43O\":[\"estableciÃ³ la fecha de vencimiento\"],\"EkH9pt\":[\"Actualizar\"],\"EvArWh\":[\"Colabora sin problemas con tu equipo.\"],\"F/FPk/\":[\"ConfiguraciÃ³n | Permisos\"],\"F/Fhz0\":[\"Create Pro workspace\"],\"F/vB2g\":[\"Ideas para mejorar esta pÃ¡gina...\"],\"F3bW6y\":[\"Plataforma\"],\"F4KRmY\":[\"$8/mes\"],\"F4PLG4\":[\"DescripciÃ³n del espacio de trabajo actualizada\"],\"F8DaWi\":[\"Solo visualizaciÃ³n\"],\"FEr96N\":[\"Tema\"],\"FUltnF\":[\"Plantillas personalizadas\"],\"FdtSNC\":[\"Crear espacio de trabajo\"],\"FmN5me\":[\"ResoluciÃ³n\"],\"FmfJjN\":[\"Ver y gestionar tus claves API.\"],\"Fpci8b\":[\"Â¿EstÃ¡s seguro de que quieres eliminar esta lista de verificaciÃ³n?\"],\"G1Gw0v\":[\"Nueva plantilla\"],\"GAD3Dx\":[\"Dominio personalizado\"],\"GDvlUT\":[\"Rol\"],\"GXsAby\":[\"Revoke\"],\"GYv20o\":[\"No se pueden actualizar los permisos\"],\"Gd7sEW\":[\"Enlace de espacio de trabajo personalizado\"],\"GnRmu4\":[\"Nombre de la lista de verificaciÃ³n\"],\"GnSSGm\":[\"La descripciÃ³n de tu espacio de trabajo ha sido actualizada.\"],\"GoDLB9\":[\"Tu cuenta ha sido eliminada.\"],\"Gxxi5J\":[\"AÃ±adir lista de verificaciÃ³n\"],\"H5G+qG\":[\"Â¿CuÃ¡l es la diferencia entre Kan y Trello?\"],\"HBI6nY\":[\"Â¿Necesitas ayuda?\"],\"HO+uOC\":[\"ClasificaciÃ³n\"],\"HVIzNO\":[\"Puede ver listas\"],\"HYV6Lq\":[\"No se pudo aceptar la invitaciÃ³n. Por favor, intÃ©ntalo de nuevo mÃ¡s tarde o contacta con atenciÃ³n al cliente.\"],\"HeFWjW\":[\"PrÃ³ximos pasos\"],\"Hg1qE9\":[\"El slug de tu espacio de trabajo ha sido actualizado.\"],\"I+AROe\":[\"Puede editar tarjetas\"],\"I0gAKM\":[\"No se puede actualizar la lista\"],\"IDvohQ\":[\"marcÃ³ un elemento de la lista de verificaciÃ³n como incompleto\"],\"IFgUX6\":[\"Puede eliminar miembros\"],\"IelE1h\":[\"Actualizar a Pro\"],\"IqjpYe\":[\"Visibilidad del correo electrÃ³nico\"],\"IrZaAn\":[\"ContraseÃ±a cambiada\"],\"J/hVSQ\":[[\"0\"]],\"J2Wbjt\":[\"Continuar con \"],\"J5nbej\":[\"CrÃ­tico\"],\"J5pbP6\":[\"Puede editar roles y permisos de miembros\"],\"JArWcF\":[[\"0\"],\" | \",[\"1\"]],\"JCdzgZ\":[\"Solicitud de funciÃ³n\"],\"JUce1S\":[\"Asignados\"],\"JbXXUW\":[\"Ten en cuenta que esta acciÃ³n es irreversible.\"],\"JcCDm9\":[\"Plantilla creada\"],\"Jgaz7E\":[\"Permisos restablecidos\"],\"JlFcis\":[\"Send\"],\"JnWJXY\":[\"enlace mÃ¡gico\"],\"JxhWxU\":[\"en\"],\"JyXBgS\":[\"documentos\"],\"K3iLeO\":[\"Mira lo que nuestros usuarios estÃ¡n diciendo sobre Kan\"],\"KAsRdK\":[\"Ir a miembros\"],\"KFJgmZ\":[\"El nombre visible debe tener al menos 3 caracteres\"],\"KLJ4eD\":[\"Enlace de invitaciÃ³n copiado\"],\"KNKCTb\":[\"Pendientes\"],\"KiVc+q\":[\"Tiempo completo\"],\"KuSt9W\":[\"Â¿CÃ³mo puedo autoalojar?\"],\"L5ZPjz\":[\"actualizÃ³ un elemento de la lista de verificaciÃ³n\"],\"LTGE7Y\":[\"Espacio de trabajo creado con Ã©xito. Puedes actualizar mÃ¡s tarde en configuraciÃ³n.\"],\"LeM5RY\":[\"No se pueden borrar las anulaciones\"],\"LoUCpj\":[\"Error al actualizar el nombre del espacio de trabajo\"],\"LqWW5F\":[\"Tu nombre de visualizaciÃ³n ha sido actualizado.\"],\"LrcnbT\":[\"Aloja Kan en tu propia infraestructura. Ideal para organizaciones que necesitan control completo sobre sus datos.\"],\"Ls++vT\":[\"RÃ¡pido y ligero\"],\"Lt+ZP3\":[\"completÃ³ un elemento de la lista de verificaciÃ³n\"],\"M43OaK\":[\"Upgrade to Team Plan\"],\"M9p3Vw\":[\"Registro de actividad ilimitado\"],\"MFKlMB\":[\"Invitar\"],\"MHrjPM\":[\"TÃ­tulo\"],\"MI5OBT\":[\"La URL solo puede contener letras, nÃºmeros y guiones\"],\"MK16u2\":[\"Sin fechas\"],\"MKAScN\":[\"Puede ver tableros\"],\"MN6YzG\":[\"Slug del espacio de trabajo actualizado\"],\"MWrbWq\":[\"ConfiguraciÃ³n | Cuenta\"],\"MdN5zD\":[\"Necesitas ser administrador para gestionar los permisos del espacio de trabajo.\"],\"MdwUGG\":[\"Ahorra tiempo con plantillas de tableros reutilizables.\"],\"MeO/vH\":[\"Esto resultarÃ¡ en la eliminaciÃ³n permanente de todos los datos asociados con este espacio de trabajo.\"],\"MlyjJu\":[\"El nombre visible no puede exceder los 280 caracteres\"],\"MxQXhL\":[\"No se puede crear el espacio de trabajo\"],\"N/bcWA\":[\"Iniciar sesiÃ³n | kan.bn\"],\"N3380t\":[\"Puede crear tableros\"],\"N7aud6\":[\"BÃºsqueda inteligente\"],\"NH54UR\":[\"renombrÃ³ el elemento de la lista de verificaciÃ³n a <0>\",[\"0\"],\"</0>\"],\"NgaR6B\":[\"Introduce tu contraseÃ±a\"],\"NypLoL\":[\"renombrÃ³ una lista de verificaciÃ³n\"],\"O0li0W\":[\"Introduce tu contraseÃ±a actual y elige una nueva contraseÃ±a segura.\"],\"O1wAlQ\":[\"Invitado\"],\"O3oNi5\":[\"Correo electrÃ³nico\"],\"O83K21\":[\"aÃ±adiÃ³ un elemento a la lista de verificaciÃ³n\"],\"O9jVbx\":[\"Prioridad baja\"],\"OAYToL\":[\"Esto eliminarÃ¡ todos los permisos personalizados de miembros en este espacio de trabajo. Los miembros heredarÃ¡n permisos solo de sus roles.\"],\"OIA0ad\":[\"Nombre del espacio de trabajo actualizado\"],\"OZtEcz\":[\"API\"],\"OpNhRn\":[\"No se requiere tarjeta de crÃ©dito\"],\"OtjenF\":[\"Por favor, introduce una direcciÃ³n de correo electrÃ³nico vÃ¡lida\"],\"OvoEq7\":[\"Miembro\"],\"Ozt2vv\":[\"Tu contraseÃ±a ha sido cambiada.\"],\"P6dJdq\":[\"Anulaciones borradas\"],\"P8bryV\":[\"New Ticket, Triaging, In Progress, Awaiting Customer, Resolution, Done\"],\"PCIlOO\":[\"AÃ±adir miembro\"],\"PRjvDT\":[\"Â¿EstÃ¡s seguro de que quieres eliminar este comentario?\"],\"PRofO0\":[\"Editar vÃ­deo de YouTube\"],\"PTzsxH\":[\"Visibilidad del tablero actualizada\"],\"PZCqeW\":[\"Por favor, intÃ©ntalo de nuevo mÃ¡s tarde.\"],\"Pa9/o1\":[\"Create API keys to access the Kan API.\"],\"PpZkda\":[\"CaracterÃ­sticas\"],\"PyYD/v\":[\"asignÃ³ <0>\",[\"0\"],\"</0> a la tarjeta\"],\"Q9pQaX\":[\"AÃºn no se han encontrado roles para este espacio de trabajo.\"],\"QD8opX\":[\"Tablero\"],\"QHhZeE\":[\"Plantilla creada correctamente\"],\"QNtP5M\":[\"Usar plantilla\"],\"Qh7QmR\":[\"Eliminado de favoritos\"],\"QtACvI\":[\"Crear etiqueta\"],\"Qtzfdk\":[\"Plan Pro âˆ\"],\"R+w/Va\":[\"FacturaciÃ³n\"],\"R1c3Mq\":[\"El nombre del tablero es obligatorio\"],\"R275Pz\":[\"Tienes plazas ilimitadas con tu Plan Pro. Â¡No hay cargos adicionales por nuevos miembros!\"],\"R3FsF4\":[\"Error en la descarga\"],\"R6pB8R\":[\"Estrella en Github\"],\"RHZu7R\":[\"Amado por equipos en todo el mundo\"],\"RJA+sg\":[\"Nuevo ticket\"],\"RRn9jf\":[\"Haz clic en el enlace que hemos enviado a \",[\"magicLinkRecipient\"],\" para iniciar sesiÃ³n.\"],\"RSGOS1\":[\"Puede eliminar listas\"],\"RfgJqw\":[\"actualizÃ³ la fecha de vencimiento\"],\"RkXlPZ\":[\"GitHub\"],\"RoafuO\":[\"Enviar comentarios\"],\"RtlIYB\":[\"EstÃ¡s a punto de cambiar tu contraseÃ±a.\"],\"SFnH1j\":[\"Â¿Por quÃ© crear un Trello de cÃ³digo abierto?\"],\"SKqXzW\":[\"added label <0>\",[\"label\"],\"</0>\"],\"SMaFdc\":[\"Darse de baja\"],\"SNfg0e\":[\"Puede ver espacio de trabajo\"],\"SPLN9O\":[\"SÃ© dueÃ±o de tus datos\"],\"STSYcd\":[\"Puede eliminar comentarios\"],\"SWEskc\":[\"La URL debe tener al menos 3 caracteres\"],\"Sb2gYF\":[\"Nueva lista\"],\"ScJ9fj\":[\"PolÃ­tica de privacidad\"],\"Se/UIp\":[\"Por hacer\"],\"SkCNhl\":[\"Buscar tableros y tarjetas...\"],\"SlfejT\":[\"Error\"],\"T/pF0Z\":[\"Eliminar de favoritos\"],\"T21jY/\":[\"aÃ±adiÃ³ una etiqueta a la tarjeta\"],\"T7DJ2k\":[\"No se puede aÃ±adir el comentario\"],\"T7LJic\":[\"moviÃ³ la tarjeta a otra lista\"],\"T7Mywq\":[\"No se pudo actualizar el tablero\"],\"TCOMOO\":[\"Editar permisos\"],\"TFv5tM\":[\"No se puede actualizar el rol\"],\"TH3Irz\":[\"Permiso\"],\"TKFUnX\":[\"Cuenta eliminada\"],\"TXO5TM\":[\"No hay atajos de teclado registrados.\"],\"TYli1B\":[\"Puede editar comentarios\"],\"TbjyhA\":[\"Documentos\"],\"TcXcmk\":[\"RevisiÃ³n de cÃ³digo\"],\"TjREUS\":[\"Nueva clave API\"],\"TmvrjU\":[\"La URL del tablero debe tener al menos 3 caracteres\"],\"TvY/XA\":[\"DocumentaciÃ³n\"],\"Tz0i8g\":[\"ConfiguraciÃ³n\"],\"TztLaN\":[\"No se puede crear la lista\"],\"U3pytU\":[\"Administrador\"],\"U5dMR6\":[\"Ver espacio de trabajo\"],\"UCLeG0\":[\"TÃ©rminos de servicio\"],\"UQbwrz\":[\"Todos los sistemas operativos\"],\"URAE3q\":[\"Pausado\"],\"USVCGU\":[\"Error al desactivar el enlace de invitaciÃ³n\"],\"UbRKMZ\":[\"Pendiente\"],\"UbYdrA\":[\"Frecuencia de pago\"],\"UeDFpo\":[\"Â¿CÃ³mo se financia el proyecto?\"],\"UlhdTP\":[\"Espacio de trabajo eliminado\"],\"Un80BR\":[\"Amigos OSS\"],\"UveK6V\":[\"Ir a la aplicaciÃ³n\"],\"Uworke\":[\"Tiempo parcial\"],\"UxKoFf\":[\"NavegaciÃ³n\"],\"V3MPSQ\":[\"actualizÃ³ el tÃ­tulo\"],\"V8YWP3\":[\"Introduce un tÃ­tulo personalizado\"],\"VHS0aJ\":[\"Â¿Borrar todos los permisos personalizados?\"],\"VKoDQD\":[\"Crear nuevo \",[\"0\"]],\"VUZDlr\":[\"Testimonios\"],\"VXk54Y\":[\"se autoasignÃ³ la tarjeta\"],\"VbyRUy\":[\"Comentarios\"],\"VhMDMg\":[\"Cambiar contraseÃ±a\"],\"Vt50G1\":[\"Kanban bÃ¡sico\"],\"W/Elkg\":[\"Prioridad media\"],\"W/nQk1\":[\"Plan gratuito\"],\"W5r8Qh\":[\"eliminÃ³ un elemento de la lista de verificaciÃ³n\"],\"W8oT+L\":[\"Error al obtener la informaciÃ³n del vÃ­deo\"],\"WHHLh9\":[\"No se puede eliminar el archivo adjunto\"],\"WI4eGo\":[\"Â¿CÃ³mo obtengo una URL personalizada?\"],\"WQPDcG\":[\"No se puede actualizar el elemento de la lista de verificaciÃ³n\"],\"WRkpB1\":[\"Registro deshabilitado\"],\"WRsbHO\":[\"Tu cuenta de Trello estÃ¡ conectada.\"],\"WYDptz\":[\"SuscripciÃ³n requerida\"],\"WYwN1G\":[\"Nueva importaciÃ³n\"],\"WbTDwg\":[\"En progreso\"],\"Weq9zb\":[\"General\"],\"WmPhYW\":[\"OcurriÃ³ un error al desconectar tu cuenta de Trello.\"],\"WnEwDO\":[\"Â¿Ya tienes una cuenta? <0><1>Iniciar sesiÃ³n</1></0>\"],\"Wy6pcF\":[\"No se puede actualizar la visibilidad del tablero\"],\"X0N0PA\":[\" (editado)\"],\"XDRXbZ\":[\"La descripciÃ³n del espacio de trabajo debe tener al menos 3 caracteres\"],\"XILg0L\":[\"DirecciÃ³n de correo electrÃ³nico no vÃ¡lida\"],\"XJOV1Y\":[\"Actividad\"],\"XTKtey\":[\"Crear lista\"],\"XXbgHS\":[\"Contratado\"],\"XYLcNv\":[\"Soporte\"],\"XicmhT\":[\"Fecha de vencimiento\"],\"Xid3K6\":[\"La URL del tablero solo puede contener letras, nÃºmeros y guiones\"],\"Xjj/kS\":[\"Kanban reinventado\"],\"XpcjLO\":[\"No se puede actualizar la URL del tablero\"],\"XyuOHa\":[\"Compartir tablero e invitaciones\"],\"YBBifR\":[\"Desconectar Trello\"],\"YKeYae\":[\"No se puede reordenar el elemento de la lista de verificaciÃ³n\"],\"YQqv2e\":[\"Get started by creating a new board\"],\"YVT40D\":[\"eliminÃ³ la etiqueta <0>\",[\"0\"],\"</0>\"],\"YaZDYI\":[\"Error al actualizar la suscripciÃ³n\"],\"YcyP2z\":[\"No se puede crear la plantilla\"],\"Yf9FAx\":[\"No podrÃ¡n acceder a este espacio de trabajo.\"],\"YhvWXb\":[\"AnÃ¡lisis del tablero\"],\"YirHq7\":[\"Comentarios\"],\"YoyKbT\":[\"Esta clave API solo se mostrarÃ¡ una vez. Por favor, guÃ¡rdala en un lugar seguro.\"],\"YtUfwW\":[\"Error al iniciar sesiÃ³n con \",[\"0\"],\". Por favor, intÃ©ntalo de nuevo.\"],\"Z3FXyt\":[\"Cargando...\"],\"Z3krJD\":[\"Permitir que los miembros del espacio de trabajo vean las direcciones de correo electrÃ³nico de los demÃ¡s\"],\"Z6r9z1\":[\"No se puede eliminar la tarjeta\"],\"Z7/Xyy\":[\"Applicants, Screening, Interviewing, Offer, Onboarding, Hired\"],\"ZDGm40\":[\"Eliminar cuenta\"],\"ZDIydz\":[\"Comenzar\"],\"ZDo4HN\":[\"Lluvia de ideas\"],\"ZH7TVS\":[\"TÃ­tulo de la tarjeta\"],\"ZL1A+p\":[\"Error al subir el archivo adjunto. Por favor, intÃ©ntalo de nuevo.\"],\"ZT4Khw\":[\"Â¿EstÃ¡s seguro de que quieres eliminar esta tarjeta?\"],\"ZU5IYI\":[\"Tableros ilimitados, listas ilimitadas, tarjetas ilimitadas. No se requiere tarjeta de crÃ©dito.\"],\"ZXSPJt\":[\"Ha ocurrido un error inesperado. Por favor, intÃ©ntalo de nuevo mÃ¡s tarde.\"],\"ZqDqbi\":[\"Organiza y encuentra tarjetas rÃ¡pidamente con potentes herramientas de filtrado.\"],\"Zz1qkk\":[\"Tarjetas ilimitadas\"],\"aHCEmh\":[\"Precios\"],\"aHRWVI\":[\"eliminÃ³ la fecha de vencimiento\"],\"aJ4pMe\":[\"Preguntas frecuentes\"],\"aWDhU5\":[\"Kanban es mejor con un equipo. Perfecto para equipos pequeÃ±os y en crecimiento que buscan colaborar.\"],\"aWlSc/\":[\"Crear nueva lista\"],\"abUZlY\":[\"AÃ±adir detalles...\"],\"aelko+\":[\"Puedes obtener una URL personalizada para tu espacio de trabajo, como <0>kan.bn/kan</0>, yendo a la <1>configuraciÃ³n de tu espacio de trabajo</1> y comprando una suscripciÃ³n pro. Â¡Todas las suscripciones ayudan a financiar el desarrollo del proyecto!\"],\"aiHZVP\":[\"Ver documentaciÃ³n\"],\"aj40Mw\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users (free during the beta) and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"b/LfJo\":[\"correo electrÃ³nico\"],\"b3Thhd\":[\"Error al subir\"],\"b5FKyH\":[\"aÃ±adiÃ³ la etiqueta <0>\",[\"0\"],\"</0>\"],\"b9XOHo\":[\"Crear \",[\"0\"]],\"bA2LQS\":[\"Desglose de caracterÃ­sticas\"],\"bD8I7O\":[\"Completado\"],\"bDI6VI\":[[\"0\"],\" se ha eliminado de tus favoritos.\"],\"bJZm1W\":[\"Solicitantes\"],\"bJtM0P\":[\"Esta URL de espacio de trabajo estÃ¡ reservada\"],\"bZSICm\":[\"No se puede aÃ±adir el elemento a la lista de verificaciÃ³n\"],\"bcIybO\":[\"El nombre del espacio de trabajo es obligatorio\"],\"bdztP2\":[\"InvestigaciÃ³n\"],\"bfZE+Y\":[\"El rol del miembro se ha actualizado.\"],\"bff61F\":[\"Plan de Equipo\"],\"bfgr/e\":[\"Pregunta\"],\"bgh/9n\":[\"puede gestionar la configuraciÃ³n del espacio de trabajo\"],\"bmXKoX\":[\"aÃ±adiÃ³ \",[\"0\"],\" etiquetas: <0>\",[\"labelList\"],\"</0>\"],\"bqAQaT\":[\"Error al eliminar la cuenta\"],\"c/IAuR\":[\"Importante\"],\"c3b0B0\":[\"Comenzar\"],\"c9AJhn\":[\"Unirse al espacio de trabajo\"],\"cAgBMh\":[\"Control y propiedad completos:\"],\"cFQEU/\":[\"Abrir atajos de teclado\"],\"cOh+MI\":[\"PreselecciÃ³n\"],\"cWcxrL\":[\"Nueva lista de verificaciÃ³n\"],\"cWtfn1\":[\"Actualizar a Pro ($29/mes)\"],\"chyf4J\":[\"DescripciÃ³n del espacio de trabajo\"],\"cji2nM\":[\"Error al crear el enlace de invitaciÃ³n\"],\"cnGeoo\":[\"Eliminar\"],\"cp1rsD\":[\"Desactivar enlace de invitaciÃ³n\"],\"csFbe+\":[\"Ir a plantillas\"],\"curoK5\":[\"Nuevo espacio de trabajo\"],\"d33Usy\":[\"Crear lista de verificaciÃ³n\"],\"d7XqZJ\":[\"A powerful, flexible kanban app that helps you organise work,\\n              track progress, and deliver resultsâ€”all in one place.\"],\"dEgA5A\":[\"Cancelar\"],\"dUh9QW\":[\"PlanificaciÃ³n\"],\"ddrz1m\":[\"Vencido\"],\"delOXn\":[\"No se pueden actualizar las etiquetas\"],\"dgr4Kq\":[\"Editar etiqueta\"],\"dmKdk0\":[\"Una vez que elimines tu espacio de trabajo, no hay vuelta atrÃ¡s. Esta acciÃ³n no se puede deshacer.\"],\"dsLT3m\":[\"Crear tarjeta\"],\"dtbpdR\":[\"Trello\"],\"duf3Nr\":[\"Esta URL de espacio de trabajo ya ha sido tomada\"],\"e12o5C\":[\"Invite another\"],\"e4hPSt\":[\"Restablecer a valores predeterminados del rol\"],\"eEQyz+\":[\"Rastrea todos los cambios en las tarjetas con un historial de actividad detallado.\"],\"ePK91l\":[\"Editar\"],\"eZCGbT\":[\"SÃ­, ofrecemos un plan gratuito para siempre para uso individual. Sin restricciones, sin muros de pago, sin lÃ­mites.\"],\"edWbV6\":[\"Enlace copiado\"],\"en3oy5\":[\"FunciÃ³n\"],\"evg7+A\":[\"Tus tableros han sido importados.\"],\"evj0lK\":[\"Â¿Ofrecen un plan gratuito?\"],\"f8fH8W\":[\"DiseÃ±o\"],\"f8lDFq\":[\"creÃ³ la tarjeta\"],\"fEY2vP\":[\"Tarjeta no encontrada\"],\"fJxqi6\":[\"Custom URLs require Pro plan ($29/month)\"],\"fQCrjt\":[\"La visibilidad de tu tablero ha sido establecida a \",[\"0\"],\".\"],\"fR9laE\":[\"Introduce tu contraseÃ±a actual\"],\"fSf2ee\":[\"Ver nuestra hoja de ruta.\"],\"fYVH36\":[\"No se puede actualizar el comentario\"],\"fvLNDy\":[\"AÃºn no se han creado listas\"],\"fziA2d\":[\"Comentarios ilimitados\"],\"g2xBxu\":[\"Importar tus tableros de Trello a Kan es fÃ¡cil. Puedes seguir nuestra guÃ­a paso a paso <0>aquÃ­</0>.\"],\"gGx5tM\":[\"Editando\"],\"gL/7jw\":[\"AÃ±adir descripciÃ³n... (escribe '/' para abrir comandos o '@' para mencionar)\"],\"gUX7b+\":[\"La alternativa de cÃ³digo abierto <0/> a Trello\"],\"gZxH/p\":[\"cambiÃ³ la fecha de vencimiento a <0>\",[\"formattedDate\"],\"</0>\"],\"ghSJ4U\":[\"El nombre del espacio de trabajo no puede exceder los 64 caracteres\"],\"gkzAEM\":[\"Continuar con \",[\"0\"]],\"goklcJ\":[\"Entrevistando\"],\"gpfJ3v\":[\"Gratis, para siempre\"],\"gukxZ5\":[\"IncorporaciÃ³n\"],\"gv5kbo\":[\"La URL del tablero no puede exceder los 60 caracteres\"],\"h16FyT\":[\"Listas\"],\"h2FKMV\":[\"No tienes permiso\"],\"h4VV67\":[\"aÃ±adiÃ³ una lista de verificaciÃ³n\"],\"h7MgpO\":[\"Atajos de teclado\"],\"h8DugX\":[\"Etiquetas\"],\"hAMddS\":[\"se desasignÃ³ de la tarjeta\"],\"hXMFoN\":[\"Sin listas\"],\"hYzsXr\":[\"ConfiguraciÃ³n | Integraciones\"],\"hh61gL\":[\"Importar desde Trello\"],\"iFxrHK\":[\"Find answers to common questions about the project. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"iHcdea\":[\"Vence la prÃ³xima semana\"],\"iLbjv+\":[\"Puede editar el espacio de trabajo\"],\"iQmbPb\":[\"Licencia\"],\"iTylMl\":[\"Plantillas\"],\"iVIGZb\":[\"Archivo adjunto subido\"],\"isRobC\":[\"Nuevo\"],\"iwr7AP\":[\"Ideas\"],\"iy1wb+\":[\"ConfiguraciÃ³n | API\"],\"j2+d/o\":[\"Referencia de API\"],\"j9IZZ0\":[\"URL personalizada del espacio de trabajo\"],\"jDRt4n\":[\"Â¿Quieres darte de baja?\"],\"jL82rC\":[\"Borrar permisos personalizados\"],\"jNuzV/\":[\"Puede eliminar tarjetas\"],\"jQ6I8X\":[\"Rol actualizado\"],\"jZBHkN\":[\"El nombre del espacio de trabajo debe tener al menos 3 caracteres\"],\"jfC/xh\":[\"Contacto\"],\"jkbHit\":[\"around the world\"],\"jl3aEJ\":[\"marcÃ³ el elemento <0>\",[\"0\"],\"</0> de la lista de verificaciÃ³n como incompleto\"],\"jlB2RY\":[\"La contraseÃ±a actual que has introducido es incorrecta.\"],\"jwI32v\":[\"Tablero no encontrado\"],\"kECVpo\":[\"Â¿EstÃ¡s seguro de que quieres eliminar esta etiqueta?\"],\"kQwvU8\":[\"eliminÃ³ una etiqueta de la tarjeta\"],\"kSxwQL\":[\"Puedes invitar a miembros del equipo haciendo clic en el botÃ³n \\\"Invitar\\\" en la esquina superior derecha de la <0>pÃ¡gina de miembros</0> e introduciendo su direcciÃ³n de correo electrÃ³nico. RecibirÃ¡n un email con un enlace para unirse al espacio de trabajo.\"],\"kYu0eF\":[\"Eliminar espacio de trabajo\"],\"kfOGMr\":[\"Victoria rÃ¡pida\"],\"klpSmb\":[\"Editar URL del espacio de trabajo\"],\"kp6L3T\":[\"Este nombre de usuario del espacio de trabajo ya ha sido tomado\"],\"kryGs+\":[\"Tarjeta\"],\"kuoc68\":[\"$10/mes\"],\"kwkhPe\":[\"Upgrade\"],\"kxEs5t\":[\"Importaciones de Trello\"],\"l2PIAy\":[\"Autoalojamiento con Github\"],\"l31EoQ\":[\"Encuentra respuestas a preguntas frecuentes sobre Kan. Â¿No encuentras lo que buscas? No dudes en <0>contactarnos</0>.\"],\"l3s5ri\":[\"Importar\"],\"l4asa1\":[\"Este tablero es privado o no existe\"],\"lGjicL\":[\", o consulta nuestra\"],\"lKAvEd\":[\"Error al desconectar Trello\"],\"lSNkXg\":[\"All seats are free during the beta until Sept 1st!\"],\"lXvXNI\":[\"No se pudo copiar el enlace de invitaciÃ³n\"],\"lYT7pQ\":[\"Eliminar lista\"],\"lcokBr\":[\"Propiedad de Atlassian\"],\"lkz85l\":[\"La principal diferencia entre Kan y Trello es que Kan es de cÃ³digo abierto, permitiendo a cualquiera ver, modificar y contribuir a nuestro cÃ³digo. Nuestra oferta en la nube tambiÃ©n ofrece funciones sin restricciones para uso individual, mientras que Trello bloquea caracterÃ­sticas bÃ¡sicas como el nÃºmero de tableros que puedes crear detrÃ¡s de un muro de pago.\"],\"lo8xBK\":[\"Â¿EstÃ¡s seguro de que quieres eliminar \",[\"entityLabel\"],\"?\"],\"lpIMne\":[\"Las contraseÃ±as no coinciden\"],\"lsgnzd\":[\"Error al actualizar a Pro\"],\"lyqwgn\":[\"AÃ±adir etiqueta\"],\"m2nk0i\":[\"Precios simples\"],\"mErq7F\":[\"Registrarse\"],\"mHhffx\":[\"No se puede crear la lista de verificaciÃ³n\"],\"mTGd3+\":[\"eliminÃ³ una lista de verificaciÃ³n\"],\"mTwGOf\":[\"Este enlace de invitaciÃ³n no es vÃ¡lido o ha caducado.\"],\"mU+M00\":[[\"0\"],\" se ha aÃ±adido a tus favoritos.\"],\"mVZH9V\":[\"Cuando Trello se lanzÃ³ en 2011, impresionÃ³ a todos con su simplicidad cuidadosamente diseÃ±ada, pero con los aÃ±os perdiÃ³ su magia y se convirtiÃ³ en algo mÃ¡s parecido a \\\"Jira Lite\\\". Este proyecto es nuestro intento de recuperar la magia original de la simplicidad de Trello, en cÃ³digo abierto.\"],\"mZGPxt\":[\"Enlace de invitaciÃ³n copiado al portapapeles\"],\"mchgzf\":[\"Te has registrado correctamente.\"],\"mgXgHu\":[\"Ir a tableros\"],\"mwBdZ2\":[\"Esto resultarÃ¡ en la eliminaciÃ³n permanente de todos los datos asociados con tu cuenta.\"],\"mx8+1u\":[\"Miembros ilimitados\"],\"n+xLOH\":[\"AtenciÃ³n al cliente\"],\"n1GRql\":[\"Nueva etiqueta\"],\"n1ekoW\":[\"Iniciar sesiÃ³n\"],\"n9V+ps\":[\"Introduce tu nombre\"],\"nOhz3x\":[\"Cerrar sesiÃ³n\"],\"nabda1\":[\"Eliminar tarjeta\"],\"nbfdhU\":[\"Integraciones\"],\"nhMhRr\":[\"Â¡Gracias por tus comentarios!\"],\"njJFtc\":[\"Eliminar comentario\"],\"nk7caK\":[\"Conectar Trello\"],\"nol/Fb\":[\"Â¿CÃ³mo invito a miembros del equipo?\"],\"notwF1\":[\"El nombre de la plantilla no puede exceder los 100 caracteres\"],\"nq7q3Z\":[\"El nombre de la clave API no puede exceder los 30 caracteres\"],\"nqdIhs\":[\"Plantillas de tablero personalizadas\"],\"nryrgW\":[\"Todos los permisos personalizados de los miembros se han restablecido a los valores predeterminados de su rol.\"],\"nxb+xc\":[\"unassigned <0>\",[\"memberName\"],\"</0> from the card\"],\"o+JCfN\":[\"Equipos Ã¡giles de todo el mundo<0/>confÃ­an en nosotros\"],\"o7J4JM\":[\"Filtrar\"],\"o9WLwO\":[\"No se puede actualizar la tarjeta\"],\"oBndex\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"oVBq1w\":[\"por usuario/mes\"],\"oW13KZ\":[\"Comienza gratis hoy mismo\"],\"oXpmwC\":[\"Autoalojable\"],\"odFCYX\":[\"InvitaciÃ³n invÃ¡lida\"],\"ohktr7\":[\"Comentarios y menciones\"],\"okpxfB\":[\"Crear nueva clave\"],\"oyRjD/\":[\"Plan Pro\"],\"p/hk9N\":[\"Has iniciado sesiÃ³n correctamente.\"],\"pBsoKL\":[\"AÃ±adir a favoritos\"],\"pFGfsR\":[\"Descubre algunos de nuestros proyectos de cÃ³digo abierto favoritos.\"],\"pFKC6A\":[\"Nombre de la clave API\"],\"pL78ec\":[\"AÃ±adido a favoritos\"],\"pXVFJy\":[\"Puede eliminar tableros\"],\"pa9o5D\":[\"Recorta tu avatar\"],\"pfa8F0\":[\"Nombre visible\"],\"pmUArF\":[\"Espacio de trabajo\"],\"pnrmSP\":[\"Nueva tarjeta\"],\"poDo/D\":[\"Create new board\"],\"ppaRWv\":[\"Autoalojamiento\"],\"pvnfJD\":[\"Oscuro\"],\"q+lt9D\":[\"Error al eliminar la etiqueta\"],\"qPP4lD\":[\"Invitar miembros requiere un Plan de Equipo. SerÃ¡s redirigido para actualizar tu espacio de trabajo.\"],\"qQXocp\":[\"Puede gestionar la configuraciÃ³n del espacio de trabajo\"],\"qfUS/w\":[\"Amigos de cÃ³digo abierto\"],\"qkjvgj\":[\"Tu espacio de trabajo ha sido eliminado.\"],\"qlAIQ1\":[\"Remoto\"],\"qrT8WB\":[\"#1 Hacker News\"],\"qtE5nt\":[\"AÃ±adir un elemento...\"],\"qzdST2\":[\"Visibilidad del tablero\"],\"r6BgwX\":[\"Se requiere contraseÃ±a para iniciar sesiÃ³n.\"],\"rD6UIt\":[\"Comenzar en la nube\"],\"rF8SEQ\":[\"Editar comentario\"],\"rRM7r0\":[\"Importa tus tableros de Trello y comienza a trabajar de inmediato.\"],\"rYUZIe\":[\"Seleccionar origen\"],\"raHesj\":[\"Â¡Te has dado de baja!\"],\"rarRW/\":[\"Error al invitar al miembro\"],\"ri1hHe\":[\"Vence el prÃ³ximo mes\"],\"rmN315\":[\"DiversiÃ³n\"],\"rs7L54\":[\"aÃ±adiÃ³ un miembro a la tarjeta\"],\"rtbVvN\":[\"Puede editar listas\"],\"s+MGs7\":[\"Recursos\"],\"s6iE/c\":[\"El registro estÃ¡ actualmente deshabilitado. Por favor, intÃ©ntalo de nuevo mÃ¡s tarde.\"],\"sBhOFG\":[\"GestiÃ³n de tareas visual y sencilla que simplemente funciona. Arrastra y suelta tarjetas, colabora con tu equipo y logra mÃ¡s.\"],\"sDLCvT\":[\"Conecta tus herramientas favoritas para agilizar tu flujo de trabajo.\"],\"sDuhfK\":[\"Oferta de lanzamiento: asientos ilimitados por solo $29/mes con Pro\"],\"sUZo7y\":[\"Registrarse | kan.bn\"],\"sVBn4K\":[\"Error al actualizar el nombre visible\"],\"sY2lzr\":[\"No hay URL de descarga disponible para este archivo adjunto.\"],\"seaklU\":[\"Boards | \",[\"0\"]],\"t+R8+P\":[\"EjecuciÃ³n\"],\"t/YqKh\":[\"Eliminar\"],\"t2nDzl\":[\"Ver y gestionar tu facturaciÃ³n y suscripciÃ³n.\"],\"t6FvJH\":[\"Puede aÃ±adir comentarios\"],\"tGwwnq\":[\"actualizÃ³ la descripciÃ³n\"],\"tHcbLF\":[\"Puede editar tableros\"],\"tHjBUm\":[\"Kan\"],\"tIdipJ\":[\"Editar URL del tablero\"],\"tMYIu7\":[\"Registros de actividad\"],\"tTbref\":[\"Se requiere contraseÃ±a para registrarse.\"],\"tYN21H\":[\"El usuario ya es miembro de este espacio de trabajo\"],\"tca56/\":[\"Tu archivo se ha subido correctamente.\"],\"tfDRzk\":[\"Guardar\"],\"tmlJN1\":[\"Introduce una URL de YouTube vÃ¡lida\"],\"tmpW+w\":[\"Eliminar tablero\"],\"tyHiOa\":[\"Por favor, intÃ©ntalo de nuevo mÃ¡s tarde o contacta con atenciÃ³n al cliente.\"],\"u2+JIh\":[\"Las URLs personalizadas requieren actualizar a un plan Pro\"],\"u8JHrO\":[\"Borrar filtros\"],\"uOqaMC\":[\"Has sido invitado a unirte a un espacio de trabajo.\"],\"uXGLuq\":[\"Crear clave API\"],\"uZg2+w\":[\"Potencia tu espacio de trabajo por solo $29/mes. Esto es lo que obtendrÃ¡s:\"],\"uck1tz\":[\"eliminÃ³ un miembro de la tarjeta\"],\"usVytm\":[\"Una vez que elimines tu cuenta, no hay vuelta atrÃ¡s. Esta acciÃ³n no se puede deshacer.\"],\"uwBBCy\":[\"Kan es mejor con un equipo. Perfecto para equipos pequeÃ±os y en crecimiento que buscan colaborar.\"],\"v+Wp++\":[\"CÃ³digo abierto\"],\"v3YoMA\":[\"Senior\"],\"vAR/I8\":[\"Ejecuta en tu propia infraestructura\"],\"vAj6xG\":[\"Puedes autoalojar siguiendo las instrucciones en nuestro <0>repositorio</0>.\"],\"vMCCIc\":[\"La URL no puede exceder los 24 caracteres\"],\"vSJd18\":[\"Video\"],\"vUr5JT\":[\"Â¿No tienes una cuenta? <0><1>RegÃ­strate</1></0>\"],\"vXIe7J\":[\"Idioma\"],\"vXemf6\":[\"Error\"],\"va/3u1\":[\"Controla quiÃ©n puede ver y editar tus tableros.\"],\"vbskQn\":[\"El nombre de la clave API es obligatorio\"],\"veIDCY\":[\"Iniciar prueba gratuita de 14 dÃ­as\"],\"vfRdCZ\":[\"No se pueden restablecer los permisos\"],\"vgdzLf\":[\"Crear otro\"],\"vifyyw\":[\"Legal\"],\"vlxQFL\":[\"Los permisos de este miembro se han restablecido a los valores predeterminados de su rol.\"],\"vneRvS\":[\"facturaciÃ³n mensual\"],\"vuxdLS\":[\"Largo plazo\"],\"vwGkYB\":[\"La contraseÃ±a debe tener al menos 8 caracteres\"],\"wIb7Ng\":[\"Desarrollo de software\"],\"wIkTTk\":[\"Workspace name cannot exceed 24 characters\"],\"wM8xd8\":[\"Junior\"],\"wPZBpR\":[\"Por favor selecciona un archivo para subir.\"],\"wY+6Ye\":[\"Esta URL de tablero ya ha sido utilizada\"],\"wakO3W\":[\"aÃ±adiÃ³ la lista de verificaciÃ³n <0>\",[\"0\"],\"</0>\"],\"wewm3j\":[\"El nombre del tablero no puede exceder los 100 caracteres\"],\"wgNoIs\":[\"Seleccionar todo\"],\"wlQNTg\":[\"Miembros\"],\"wqkcin\":[\"Puede ver comentarios\"],\"wqxglO\":[\"Aprendizaje\"],\"wruKPE\":[\"Apoya el desarrollo del proyecto\"],\"wtxjAY\":[\"Miembros del espacio de trabajo\"],\"wzR1hC\":[\"Board name cannot exceed 50 characters\"],\"x0kMO/\":[\"Error al actualizar la URL del espacio de trabajo\"],\"x8GeCD\":[\"Nombre visible actualizado\"],\"xEbBrW\":[\"Â¿QuÃ© licencia estÃ¡n usando?\"],\"xJO7ca\":[\"updated the title to <0>\",[\"toTitle\"],\"</0>\"],\"xMn+V9\":[\"Importando desde Trello\"],\"xRPn3U\":[\"Introduce tu direcciÃ³n de correo electrÃ³nico\"],\"xvcYhz\":[\"Borra cualquier permiso personalizado de miembros para que todos los miembros solo hereden permisos de los valores predeterminados de su rol.\"],\"yCzSJ3\":[\"Espacios de trabajo ilimitados\"],\"yD3ZSw\":[\"Cambia tus preferencias de idioma.\"],\"yH4aFo\":[\"Share invite link\"],\"yV7o5I\":[\"Â¿CÃ³mo importo mis tableros de Trello?\"],\"yb/fjw\":[\"AprobaciÃ³n\"],\"yz7wBu\":[\"Cerrar\"],\"zC8Whw\":[\"Comienza creando una nueva lista\"],\"zDw80P\":[\"New board\"],\"zEGgv4\":[\"Compara nuestras caracterÃ­sticas para ver por quÃ© Kan es la mejor opciÃ³n.\"],\"zERArS\":[\"actualizÃ³ el tÃ­tulo a <0>\",[\"0\"],\"</0>\"],\"zKY5xi\":[\"Crear enlace de invitaciÃ³n\"],\"zLXwCk\":[\"my-workspace-name\"],\"zMjN8w\":[\"API REST\"],\"zMlxCA\":[\"1 usuario\"],\"zQPhSa\":[\"Convertir en enlace\"],\"zQX5Dj\":[\"Nombre de la lista\"],\"zdMPUq\":[\"removed label <0>\",[\"label\"],\"</0>\"],\"zkWmBh\":[\"Anual\"],\"zl1b97\":[\"No se puede crear la tarjeta\"],\"zoEbXq\":[\"Puede ver tarjetas\"],\"zto8aj\":[\"Trello desconectado\"],\"zwBp5t\":[\"Privado\"],\"zwWKhA\":[\"Saber mÃ¡s\"],\"zxKs+y\":[\"Vence maÃ±ana\"],\"zzDlyQ\":[\"Ã‰xito\"]}")as Messages;


================================================
FILE: apps/web/src/locales/fr/messages.ts
================================================
/*eslint-disable*/import type{Messages}from"@lingui/core";export const messages=JSON.parse("{\"++rVAm\":[\"RÃ©seaux sociaux\"],\"+3TYXa\":[\"Pour une durabilitÃ© Ã  long terme, nous reconnaissons que tous les bons projets open source ont besoin d'une source de revenus. La nÃ´tre provient de l'offre cloud payante pour les espaces de travail avec plusieurs utilisateurs et pour les slugs d'espace de travail personnalisÃ©s. Il n'y a aucune obligation de l'utiliser, et vous pouvez auto-hÃ©berger le logiciel sur votre propre infrastructure gratuitement.\"],\"+8Nek/\":[\"Mensuel\"],\"+EkBs0\":[\"Nous n'avons pas pu mettre Ã  jour vos prÃ©fÃ©rences. Veuillez rÃ©essayer.\"],\"+MdEsf\":[\"Le nouveau mot de passe est requis\"],\"+OhFss\":[\"Commencez gratuitement, sans limites d'utilisation. Pour la collaboration, passez Ã  un forfait adaptÃ© Ã  la taille de votre Ã©quipe.\"],\"+VoTOr\":[\"facturation mensuelle\"],\"+cilKj\":[\"Ideas, Research, Planning, Execution, Review, Next Steps, Complete\"],\"+djOzj\":[\"Inviter un membre\"],\"+nvZ6j\":[\"Ã‰tiquettes & filtres\"],\"/8pTF/\":[\"workspace-url\"],\"/Blkmk\":[\"Add description... (type '/' to open commands)\"],\"/DGOJs\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trelloâ€™s simplicity, in open source.\"],\"/K2CvV\":[\"ModÃ¨le\"],\"/asTmx\":[\"Rapport de bug\"],\"/f3t6v\":[\"Configurez les actions autorisÃ©es pour chaque rÃ´le d'espace de travail. Ces permissions s'appliquent Ã  tous les membres ayant ce rÃ´le.\"],\"/gaSVU\":[\"Feuille de route\"],\"/glL9Q\":[\"Aucun \",[\"0\"]],\"/lDBHm\":[\"FAQ\"],\"/rn4RE\":[\"Une application kanban puissante et flexible qui vous aide Ã  organiser le travail, suivre les progrÃ¨s et livrer des rÃ©sultatsâ€”le tout en un seul endroit.\"],\"/tOdd2\":[\"Votre image de profil a Ã©tÃ© mise Ã  jour.\"],\"0+0/3e\":[\"CrÃ©er une nouvelle Ã©tiquette\"],\"0+ewPp\":[\"AmÃ©lioration\"],\"0KjpAr\":[\"Peut voir les membres\"],\"0StR7t\":[\"Saisissez votre nouveau mot de passe\"],\"0dyOHD\":[\"Backlog, To Do, In Progress, Code Review, Done\"],\"0jV46i\":[\"Impossible de supprimer l'Ã©lÃ©ment de la liste de contrÃ´le\"],\"0qyZ4b\":[\"Chargement des permissions...\"],\"0rPv1T\":[\"Image de profil mise Ã  jour\"],\"0xWkkH\":[[\"boardCount\",\"plural\",{\"one\":[\"Importer le tableau (1)\"],\"other\":[\"Importer les tableaux (\",[\"boardCount\"],\")\"]}]],\"1/jlQw\":[\"Trusted by fast-moving teams\"],\"14Xi3Z\":[\"L'ajout d'un nouveau membre coÃ»tera \",[\"price\"],\" supplÃ©mentaires (\",[\"billingType\"],\") par siÃ¨ge.\"],\"1H5u1m\":[\"Des questions ?\"],\"1HPFNH\":[\"Prix par utilisateur/mois\"],\"1WuwiM\":[\"Aller aux paramÃ¨tres\"],\"1ZVGyT\":[\"Ajouter un commentaire...\"],\"1hzdxO\":[\"Permissions de l'espace de travail\"],\"1iShX0\":[\"Ã‰chÃ©ance aujourd'hui\"],\"1njn7W\":[\"Clair\"],\"1rVAfU\":[\"Charger plus d'activitÃ©s\"],\"1rWxEw\":[\"En attente du client\"],\"1sRmLC\":[\"Discutez et collaborez sur les cartes.\"],\"1sSegR\":[\"Brainstorming, Writing, Editing, Design, Approval, Publishing, Done\"],\"1wCGT0\":[\"Tableaux illimitÃ©s\"],\"25fAUC\":[\"Votre lien de dÃ©sabonnement ne contient pas de jeton. Veuillez ouvrir le dernier e-mail reÃ§u et rÃ©essayer.\"],\"25mvI+\":[\"Les liens d'invitation nÃ©cessitent un abonnement Team ou Pro. Veuillez mettre Ã  niveau votre espace de travail.\"],\"29sSki\":[\"a terminÃ© l'Ã©lÃ©ment <0>\",[\"0\"],\"</0> de la checklist\"],\"2BBAbc\":[\"Liste\"],\"2Bu8xj\":[\"Aucun tableau trouvÃ©\"],\"2M84k3\":[\"Permissions personnalisÃ©es\"],\"2MPcep\":[\"Importation terminÃ©e\"],\"2POOFK\":[\"Gratuit\"],\"2Py5S/\":[\"Je reconnais que toutes les donnÃ©es de l'espace de travail seront dÃ©finitivement supprimÃ©es et je souhaite continuer.\"],\"2Q871c\":[\"Impossible d'ajouter l'Ã©tiquette\"],\"2QGEbi\":[\"Impossible de supprimer le commentaire\"],\"2SePRT\":[\"Vous avez Ã©tÃ© invitÃ© Ã  rejoindre un espace de travail sur kan.bn.\"],\"2h4PVB\":[\"Le nom de votre espace de travail a Ã©tÃ© mis Ã  jour.\"],\"2liqDZ\":[\"Je reconnais que toutes les donnÃ©es de mon compte seront dÃ©finitivement supprimÃ©es et je souhaite continuer.\"],\"2q/Q7x\":[\"VisibilitÃ©\"],\"2roTVj\":[\"Commentaires envoyÃ©s\"],\"3LDCpD\":[\"Cette action ne peut pas Ãªtre annulÃ©e.\"],\"3ZjRJY\":[\"a renommÃ© la checklist <0>\",[\"0\"],\"</0>\"],\"3bqt9U\":[\"Toute personne disposant de ce lien peut rejoindre votre espace de travail\"],\"3pIq39\":[\"RÃ´les d'administrateur\"],\"479pdJ\":[\"Confirmez votre nouveau mot de passe\"],\"4DOCMI\":[\"URL YouTube\"],\"4RoY9J\":[\"Article de blog\"],\"4XF0BB\":[\"Photo de profil\"],\"4gAX8s\":[\"Basculer le menu\"],\"4ix5kl\":[\"Erreur lors de la mise Ã  jour de l'image de profil\"],\"4kJRen\":[\"Ã‰criture\"],\"4qu8Ec\":[\"Essai gratuit de 14 jours\"],\"53QYh8\":[\"Ã‰chec de la crÃ©ation du tableau\"],\"55xJ/O\":[\"Erreur lors du changement de mot de passe\"],\"58AiWX\":[\"Veuillez confirmer votre nouveau mot de passe\"],\"5ACX4z\":[\"Newsletter\"],\"5IXWmO\":[\"VÃ©rifiez votre boÃ®te de rÃ©ception\"],\"5P4rhH\":[\"Impossible de mettre Ã  jour les membres\"],\"5eZwRW\":[\"Connectez votre compte Trello pour importer des tableaux.\"],\"5h8ooz\":[\"ClÃ©s API\"],\"5iplxh\":[\"Le nouveau mot de passe doit Ãªtre diffÃ©rent du mot de passe actuel\"],\"5k0NLb\":[\"RÃ©vision\"],\"5lWFkC\":[\"Se connecter\"],\"5wo3jF\":[\"Settings | \",[\"0\"]],\"69b7aE\":[\"Ouvrir le menu de commandes\"],\"6E4pW0\":[\"Marque blanche\"],\"6EWT6T\":[\"Recrutement\"],\"6FDocz\":[\"S'inscrire avec \"],\"6FsGbN\":[\"Commencez par crÃ©er un nouveau \",[\"0\"]],\"6OTo9n\":[\"Le nom du modÃ¨le est requis\"],\"6S8zjx\":[\"https://www.youtube.com/watch?v=...\"],\"6WSYbN\":[\"Nouveau \",[\"0\"]],\"6YtxFj\":[\"Nom\"],\"6mbe4b\":[\"Particuliers\"],\"6tDFBe\":[\"Les permissions du membre ont Ã©tÃ© mises Ã  jour.\"],\"6zeSBB\":[\"Peut crÃ©er des cartes\"],\"74F7N/\":[\"ÃŠtes-vous sÃ»r de vouloir supprimer votre compte ?\"],\"7EhE4k\":[\"Mettre Ã  jour l'Ã©tiquette\"],\"7L01XJ\":[\"Actions\"],\"7PzzBU\":[\"Utilisateur\"],\"7Ufoyg\":[\"Listes illimitÃ©es\"],\"7b2yuC\":[\"Veuillez saisir un mot de passe valide\"],\"7d1a0d\":[\"Public\"],\"7eMo+U\":[\"Aller Ã  l'accueil\"],\"7hktsm\":[\"Premiers pas\"],\"7i8j3G\":[\"Entreprise\"],\"8+BY11\":[\"URL du tableau copiÃ©e dans le presse-papiers\"],\"86XI28\":[\"Confirmez vos prÃ©fÃ©rences d'e-mail :\"],\"8AbRER\":[\"DÃ©finir la date d'Ã©chÃ©ance\"],\"8Is1ih\":[\"Offre de lancement\"],\"8RdLDU\":[\"Projet personnel\"],\"8TveY+\":[\"Tableaux\"],\"8Z4pNX\":[\"Peut crÃ©er des listes\"],\"8ZoISG\":[\"Confirm URL change\"],\"8iP0S8\":[\"Tout ce qui est inclus dans le plan gratuit, plus :\"],\"8yFGGF\":[\"Impossible de supprimer le membre\"],\"91W07W\":[\"Custom URLs are a premium feature. You'll be directed to upgrade your account.\"],\"99VIgC\":[\"Supprimer le membre\"],\"9PaIxv\":[\"FonctionnalitÃ©s essentielles\"],\"9QmxLI\":[\"Create board\"],\"9cDpsw\":[\"Permissions\"],\"9eF5oV\":[\"Bienvenue Ã  nouveau\"],\"9h7RDh\":[\"Offre\"],\"9s9O5h\":[\"Erreur lors de la suppression de l'espace de travail\"],\"9u5BOr\":[\"Membres | \",[\"0\"]],\"9wdpwp\":[\"Portail de facturation\"],\"9x4DAL\":[[\"0\"],\" introuvable\"],\"9y1RcT\":[\"Nous ne faisons que commencer. \"],\"A23Y7X\":[\"Rejoindre l'espace de travail | kan.bn\"],\"A5hiCy\":[\"CrÃ©er un modÃ¨le\"],\"A8jqN7\":[\"Impossible d'envoyer les commentaires\"],\"ABCjd9\":[\"Publication\"],\"ADEin1\":[\"ParamÃ¨tres | Facturation\"],\"ALhEZV\":[\"Peut inviter des membres\"],\"ANyn0x\":[\"Tout ce dont vous avez besoin, gratuit pour toujours. Tableaux illimitÃ©s, listes illimitÃ©es, cartes illimitÃ©es. PossibilitÃ© de mise Ã  niveau Ã  tout moment.\"],\"ARvBT/\":[\"facturation annuelle\"],\"ASjvm9\":[\"URL de l'espace de travail\"],\"AUYALh\":[\"BientÃ´t disponible\"],\"AX4ktp\":[\"CrÃ©ation de contenu\"],\"AZI/wb\":[\"Ã‰tiquettes & filtres\"],\"AeXO77\":[\"Compte\"],\"Ax/hYa\":[\"La description de l'espace de travail ne peut pas dÃ©passer 280 caractÃ¨res\"],\"B3xxao\":[\"Ajouter une carte\"],\"BBUDfW\":[\"Urgent\"],\"BEVzjL\":[\"Ã‰chec de l'importation\"],\"BJbLe4\":[\"Nous utilisons la <0>licence AGPL-3.0</0>.\"],\"BMkVQ3\":[\"a supprimÃ© la checklist <0>\",[\"0\"],\"</0>\"],\"BOqTi5\":[\"a dÃ©placÃ© la carte de <0>\",[\"0\"],\"</0> vers <1>\",[\"1\"],\"</1>\"],\"BSZSHI\":[\"Board analytics (coming soon)\"],\"BZkYSt\":[\"a supprimÃ© \",[\"0\"],\" Ã©tiquettes : <0>\",[\"labelList\"],\"</0>\"],\"BhDZlc\":[\"ÃŠtes-vous sÃ»r de vouloir supprimer l'espace de travail \",[\"0\"],\" ?\"],\"Bhgd0l\":[\"Contactez-nous\"],\"Bosey8\":[\"Change the language of the app.\"],\"BzEFor\":[\"ou\"],\"C56tim\":[\"Impossible de mettre Ã  jour la date d'Ã©chÃ©ance\"],\"CAL6E9\":[\"Ã‰quipes\"],\"CB/NpV\":[\"Haute prioritÃ©\"],\"CHZ1jC\":[\"a supprimÃ© l'Ã©lÃ©ment <0>\",[\"0\"],\"</0> de la checklist\"],\"CJ3zUq\":[\"Veuillez saisir un nom valide\"],\"CJWDTP\":[\"Votre compte Trello a Ã©tÃ© dÃ©connectÃ©.\"],\"CJukzS\":[[\"0\"],\" Ã©tiquettes\"],\"CTqTgr\":[\"Raccourcis\"],\"CYWHT+\":[\"Erreur lors du tÃ©lÃ©chargement de l'image de profil\"],\"Ci/KUX\":[\"ParamÃ¨tres | Espace de travail\"],\"CkVV1t\":[\"Erreur lors de la mise Ã  jour de la description de l'espace de travail\"],\"Cmudpi\":[\"Peut supprimer l'espace de travail\"],\"CozWO1\":[\"Nom de l'espace de travail\"],\"D+NlUC\":[\"SystÃ¨me\"],\"D0esZz\":[\"Journal d'activitÃ©\"],\"D3C4Yx\":[\"Le mot de passe actuel est requis\"],\"D7/JvJ\":[\"Ajustez le recadrage carrÃ© pour adapter votre avatar.\"],\"D9ROdV\":[\"Liens d'invitation\"],\"DAV3uK\":[\"Permissions mises Ã  jour\"],\"DFjdv0\":[\"Supprimer le modÃ¨le\"],\"DMeWZD\":[\"ÃŠtes-vous sÃ»r de vouloir supprimer ce \",[\"0\"],\" ?\"],\"DPfwMq\":[\"Fait\"],\"DahTzR\":[\"Impossible de supprimer la liste de contrÃ´le\"],\"DbZgsJ\":[\"CrÃ©er un modÃ¨le\"],\"DhLN1b\":[\"No boards\"],\"DtXlZq\":[\"Impossible de mettre Ã  jour la liste de contrÃ´le\"],\"E0t3jO\":[\"a ajoutÃ© l'Ã©lÃ©ment <0>\",[\"0\"],\"</0> Ã  la checklist\"],\"E8zYtd\":[\"a dÃ©sassignÃ© <0>\",[\"0\"],\"</0> de la carte\"],\"ECJKc4\":[\"ClÃ© API crÃ©Ã©e\"],\"EEHmPC\":[\"Offre de lancement : obtenez des membres illimitÃ©s avec Pro\"],\"EEQaqX\":[\"assigned <0>\",[\"memberName\"],\"</0> to the card\"],\"EH8IL3\":[\"Listes de contrÃ´le\"],\"EM/caO\":[\"moved the card from <0>\",[\"fromList\"],\"</0> to<1>\",[\"toList\"],\"</1>\"],\"ERpq2P\":[\"Aucun rÃ©sultat trouvÃ© pour \\\"\",[\"debouncedQuery\"],\"\\\".\"],\"ESClHO\":[\"Support par e-mail prioritaire\"],\"Eg99Sc\":[\"Aucune mÃ©thode d'authentification n'est actuellement disponible\"],\"EifmPY\":[\"To Do, In Progress, Done\"],\"Eit43O\":[\"a dÃ©fini la date d'Ã©chÃ©ance\"],\"EkH9pt\":[\"Mettre Ã  jour\"],\"EvArWh\":[\"Collaborez en toute fluiditÃ© avec votre Ã©quipe.\"],\"F/FPk/\":[\"ParamÃ¨tres | Permissions\"],\"F/Fhz0\":[\"Create Pro workspace\"],\"F/vB2g\":[\"IdÃ©es pour amÃ©liorer cette page...\"],\"F3bW6y\":[\"Plateforme\"],\"F4KRmY\":[\"8 $/mois\"],\"F4PLG4\":[\"Description de l'espace de travail mise Ã  jour\"],\"F8DaWi\":[\"Affichage uniquement\"],\"FEr96N\":[\"ThÃ¨me\"],\"FUltnF\":[\"ModÃ¨les personnalisÃ©s\"],\"FdtSNC\":[\"CrÃ©er un espace de travail\"],\"FmN5me\":[\"RÃ©solution\"],\"FmfJjN\":[\"Consultez et gÃ©rez vos clÃ©s API.\"],\"Fpci8b\":[\"ÃŠtes-vous sÃ»r de vouloir supprimer cette checklist ?\"],\"G1Gw0v\":[\"Nouveau modÃ¨le\"],\"GAD3Dx\":[\"Domaine personnalisÃ©\"],\"GDvlUT\":[\"RÃ´le\"],\"GXsAby\":[\"Revoke\"],\"GYv20o\":[\"Impossible de mettre Ã  jour les permissions\"],\"Gd7sEW\":[\"Lien d'espace de travail personnalisÃ©\"],\"GnRmu4\":[\"Nom de la checklist\"],\"GnSSGm\":[\"La description de votre espace de travail a Ã©tÃ© mise Ã  jour.\"],\"GoDLB9\":[\"Votre compte a Ã©tÃ© supprimÃ©.\"],\"Gxxi5J\":[\"Ajouter une checklist\"],\"H5G+qG\":[\"Quelle est la diffÃ©rence entre Kan et Trello ?\"],\"HBI6nY\":[\"Besoin d'aide ?\"],\"HO+uOC\":[\"Triage\"],\"HVIzNO\":[\"Peut voir les listes\"],\"HYV6Lq\":[\"Ã‰chec de l'acceptation de l'invitation. Veuillez rÃ©essayer plus tard ou contacter le service client.\"],\"HeFWjW\":[\"Prochaines Ã©tapes\"],\"Hg1qE9\":[\"Le slug de votre espace de travail a Ã©tÃ© mis Ã  jour.\"],\"I+AROe\":[\"Peut modifier des cartes\"],\"I0gAKM\":[\"Impossible de mettre Ã  jour la liste\"],\"IDvohQ\":[\"a marquÃ© un Ã©lÃ©ment de la checklist comme incomplet\"],\"IFgUX6\":[\"Peut supprimer des membres\"],\"IelE1h\":[\"Passer Ã  Pro\"],\"IqjpYe\":[\"VisibilitÃ© des e-mails\"],\"IrZaAn\":[\"Mot de passe modifiÃ©\"],\"J/hVSQ\":[[\"0\"]],\"J2Wbjt\":[\"Continuer avec \"],\"J5nbej\":[\"Critique\"],\"J5pbP6\":[\"Peut modifier les rÃ´les et permissions des membres\"],\"JArWcF\":[[\"0\"],\" | \",[\"1\"]],\"JCdzgZ\":[\"Demande de fonctionnalitÃ©\"],\"JUce1S\":[\"AssignÃ©s\"],\"JbXXUW\":[\"Gardez Ã  l'esprit que cette action est irrÃ©versible.\"],\"JcCDm9\":[\"ModÃ¨le crÃ©Ã©\"],\"Jgaz7E\":[\"Permissions rÃ©initialisÃ©es\"],\"JlFcis\":[\"Send\"],\"JnWJXY\":[\"lien magique\"],\"JxhWxU\":[\"dans\"],\"JyXBgS\":[\"documentation\"],\"K3iLeO\":[\"DÃ©couvrez ce que nos utilisateurs disent de Kan\"],\"KAsRdK\":[\"Aller aux membres\"],\"KFJgmZ\":[\"Le nom d'affichage doit comporter au moins 3 caractÃ¨res\"],\"KLJ4eD\":[\"Lien d'invitation copiÃ©\"],\"KNKCTb\":[\"Backlog\"],\"KiVc+q\":[\"Temps plein\"],\"KuSt9W\":[\"Comment faire pour auto-hÃ©berger ?\"],\"L5ZPjz\":[\"a mis Ã  jour un Ã©lÃ©ment de la liste de contrÃ´le\"],\"LTGE7Y\":[\"Espace de travail crÃ©Ã© avec succÃ¨s. Vous pourrez effectuer la mise Ã  niveau ultÃ©rieurement dans les paramÃ¨tres.\"],\"LeM5RY\":[\"Impossible d'effacer les remplacements\"],\"LoUCpj\":[\"Erreur lors de la mise Ã  jour du nom de l'espace de travail\"],\"LqWW5F\":[\"Votre nom d'affichage a Ã©tÃ© mis Ã  jour.\"],\"LrcnbT\":[\"HÃ©bergez Kan sur votre propre infrastructure. IdÃ©al pour les organisations qui ont besoin d'un contrÃ´le total sur leurs donnÃ©es.\"],\"Ls++vT\":[\"Rapide & lÃ©ger\"],\"Lt+ZP3\":[\"a terminÃ© un Ã©lÃ©ment de la checklist\"],\"M43OaK\":[\"Upgrade to Team Plan\"],\"M9p3Vw\":[\"Journal d'activitÃ© illimitÃ©\"],\"MFKlMB\":[\"Inviter\"],\"MHrjPM\":[\"Titre\"],\"MI5OBT\":[\"L'URL ne peut contenir que des lettres, des chiffres et des traits d'union\"],\"MK16u2\":[\"Aucune date\"],\"MKAScN\":[\"Peut voir les tableaux\"],\"MN6YzG\":[\"Slug de l'espace de travail mis Ã  jour\"],\"MWrbWq\":[\"ParamÃ¨tres | Compte\"],\"MdN5zD\":[\"Vous devez Ãªtre administrateur pour gÃ©rer les permissions de l'espace de travail.\"],\"MdwUGG\":[\"Gagnez du temps avec des modÃ¨les de tableaux rÃ©utilisables.\"],\"MeO/vH\":[\"Cela entraÃ®nera la suppression dÃ©finitive de toutes les donnÃ©es associÃ©es Ã  cet espace de travail.\"],\"MlyjJu\":[\"Le nom d'affichage ne peut pas dÃ©passer 280 caractÃ¨res\"],\"MxQXhL\":[\"Impossible de crÃ©er l'espace de travail\"],\"N/bcWA\":[\"Connexion | kan.bn\"],\"N3380t\":[\"Peut crÃ©er des tableaux\"],\"N7aud6\":[\"Recherche intelligente\"],\"NH54UR\":[\"a renommÃ© l'Ã©lÃ©ment de la liste de contrÃ´le en <0>\",[\"0\"],\"</0>\"],\"NgaR6B\":[\"Saisissez votre mot de passe\"],\"NypLoL\":[\"a renommÃ© une checklist\"],\"O0li0W\":[\"Saisissez votre mot de passe actuel et choisissez un nouveau mot de passe sÃ©curisÃ©.\"],\"O1wAlQ\":[\"InvitÃ©\"],\"O3oNi5\":[\"E-mail\"],\"O83K21\":[\"a ajoutÃ© un Ã©lÃ©ment Ã  la checklist\"],\"O9jVbx\":[\"PrioritÃ© basse\"],\"OAYToL\":[\"Cela supprimera toutes les permissions personnalisÃ©es des membres dans cet espace de travail. Les membres hÃ©riteront des permissions uniquement de leurs rÃ´les.\"],\"OIA0ad\":[\"Nom de l'espace de travail mis Ã  jour\"],\"OZtEcz\":[\"API\"],\"OpNhRn\":[\"Aucune carte de crÃ©dit requise\"],\"OtjenF\":[\"Veuillez saisir une adresse e-mail valide\"],\"OvoEq7\":[\"Membre\"],\"Ozt2vv\":[\"Votre mot de passe a Ã©tÃ© modifiÃ©.\"],\"P6dJdq\":[\"Remplacements effacÃ©s\"],\"P8bryV\":[\"New Ticket, Triaging, In Progress, Awaiting Customer, Resolution, Done\"],\"PCIlOO\":[\"Ajouter un membre\"],\"PRjvDT\":[\"ÃŠtes-vous sÃ»r de vouloir supprimer ce commentaire ?\"],\"PRofO0\":[\"Modifier la vidÃ©o YouTube\"],\"PTzsxH\":[\"VisibilitÃ© du tableau mise Ã  jour\"],\"PZCqeW\":[\"Veuillez rÃ©essayer plus tard.\"],\"Pa9/o1\":[\"Create API keys to access the Kan API.\"],\"PpZkda\":[\"FonctionnalitÃ©s\"],\"PyYD/v\":[\"a assignÃ© <0>\",[\"0\"],\"</0> Ã  la carte\"],\"Q9pQaX\":[\"Aucun rÃ´le trouvÃ© pour cet espace de travail pour le moment.\"],\"QD8opX\":[\"Tableau\"],\"QHhZeE\":[\"ModÃ¨le crÃ©Ã© avec succÃ¨s\"],\"QNtP5M\":[\"Utiliser le modÃ¨le\"],\"Qh7QmR\":[\"RetirÃ© des favoris\"],\"QtACvI\":[\"CrÃ©er une Ã©tiquette\"],\"Qtzfdk\":[\"Plan Pro âˆ\"],\"R+w/Va\":[\"Facturation\"],\"R1c3Mq\":[\"Le nom du tableau est requis\"],\"R275Pz\":[\"Vous disposez de places illimitÃ©es avec votre Plan Pro. Il n'y a pas de frais supplÃ©mentaires pour les nouveaux membres !\"],\"R3FsF4\":[\"Ã‰chec du tÃ©lÃ©chargement\"],\"R6pB8R\":[\"Ã‰toile sur Github\"],\"RHZu7R\":[\"AdorÃ© par les Ã©quipes du monde entier\"],\"RJA+sg\":[\"Nouveau ticket\"],\"RRn9jf\":[\"Cliquez sur le lien que nous avons envoyÃ© Ã  \",[\"magicLinkRecipient\"],\" pour vous connecter.\"],\"RSGOS1\":[\"Peut supprimer des listes\"],\"RfgJqw\":[\"a mis Ã  jour la date d'Ã©chÃ©ance\"],\"RkXlPZ\":[\"GitHub\"],\"RoafuO\":[\"Envoyer des commentaires\"],\"RtlIYB\":[\"Vous Ãªtes sur le point de modifier votre mot de passe.\"],\"SFnH1j\":[\"Pourquoi crÃ©er un Trello open source ?\"],\"SKqXzW\":[\"added label <0>\",[\"label\"],\"</0>\"],\"SMaFdc\":[\"Se dÃ©sabonner\"],\"SNfg0e\":[\"Peut voir l'espace de travail\"],\"SPLN9O\":[\"MaÃ®trisez vos donnÃ©es\"],\"STSYcd\":[\"Peut supprimer des commentaires\"],\"SWEskc\":[\"L'URL doit comporter au moins 3 caractÃ¨res\"],\"Sb2gYF\":[\"Nouvelle liste\"],\"ScJ9fj\":[\"Politique de confidentialitÃ©\"],\"Se/UIp\":[\"Ã€ faire\"],\"SkCNhl\":[\"Rechercher des tableaux et des cartes...\"],\"SlfejT\":[\"Erreur\"],\"T/pF0Z\":[\"Retirer des favoris\"],\"T21jY/\":[\"a ajoutÃ© une Ã©tiquette Ã  la carte\"],\"T7DJ2k\":[\"Impossible d'ajouter un commentaire\"],\"T7LJic\":[\"a dÃ©placÃ© la carte vers une autre liste\"],\"T7Mywq\":[\"Impossible de mettre Ã  jour le tableau\"],\"TCOMOO\":[\"Modifier les permissions\"],\"TFv5tM\":[\"Impossible de mettre Ã  jour le rÃ´le\"],\"TH3Irz\":[\"Permission\"],\"TKFUnX\":[\"Compte supprimÃ©\"],\"TXO5TM\":[\"Aucun raccourci clavier enregistrÃ©.\"],\"TYli1B\":[\"Peut modifier des commentaires\"],\"TbjyhA\":[\"Documentation\"],\"TcXcmk\":[\"Revue de code\"],\"TjREUS\":[\"Nouvelle clÃ© API\"],\"TmvrjU\":[\"L'URL du tableau doit comporter au moins 3 caractÃ¨res\"],\"TvY/XA\":[\"Documentation\"],\"Tz0i8g\":[\"ParamÃ¨tres\"],\"TztLaN\":[\"Impossible de crÃ©er une liste\"],\"U3pytU\":[\"Administrateur\"],\"U5dMR6\":[\"Voir l'espace de travail\"],\"UCLeG0\":[\"Conditions d'utilisation\"],\"UQbwrz\":[\"Tous les systÃ¨mes opÃ©rationnels\"],\"URAE3q\":[\"En pause\"],\"USVCGU\":[\"Erreur lors de la dÃ©sactivation du lien d'invitation\"],\"UbRKMZ\":[\"En attente\"],\"UbYdrA\":[\"FrÃ©quence de paiement\"],\"UeDFpo\":[\"Comment le projet est-il financÃ© ?\"],\"UlhdTP\":[\"Espace de travail supprimÃ©\"],\"Un80BR\":[\"Amis OSS\"],\"UveK6V\":[\"AccÃ©der Ã  l'application\"],\"Uworke\":[\"Temps partiel\"],\"UxKoFf\":[\"Navigation\"],\"V3MPSQ\":[\"a mis Ã  jour le titre\"],\"V8YWP3\":[\"Saisir un titre personnalisÃ©\"],\"VHS0aJ\":[\"Effacer toutes les permissions personnalisÃ©es ?\"],\"VKoDQD\":[\"CrÃ©er un nouveau \",[\"0\"]],\"VUZDlr\":[\"TÃ©moignages\"],\"VXk54Y\":[\"s'est auto-assignÃ© la carte\"],\"VbyRUy\":[\"Commentaires\"],\"VhMDMg\":[\"Modifier le mot de passe\"],\"Vt50G1\":[\"Kanban basique\"],\"W/Elkg\":[\"PrioritÃ© moyenne\"],\"W/nQk1\":[\"Forfait gratuit\"],\"W5r8Qh\":[\"a supprimÃ© un Ã©lÃ©ment de la checklist\"],\"W8oT+L\":[\"Ã‰chec de la rÃ©cupÃ©ration des informations de la vidÃ©o\"],\"WHHLh9\":[\"Impossible de supprimer la piÃ¨ce jointe\"],\"WI4eGo\":[\"Comment obtenir une URL personnalisÃ©e ?\"],\"WQPDcG\":[\"Impossible de mettre Ã  jour l'Ã©lÃ©ment de la liste de contrÃ´le\"],\"WRkpB1\":[\"Inscription dÃ©sactivÃ©e\"],\"WRsbHO\":[\"Votre compte Trello est connectÃ©.\"],\"WYDptz\":[\"Abonnement requis\"],\"WYwN1G\":[\"Nouvel import\"],\"WbTDwg\":[\"En cours\"],\"Weq9zb\":[\"GÃ©nÃ©ral\"],\"WmPhYW\":[\"Une erreur s'est produite lors de la dÃ©connexion de votre compte Trello.\"],\"WnEwDO\":[\"Vous avez dÃ©jÃ  un compte ? <0><1>Connectez-vous</1></0>\"],\"Wy6pcF\":[\"Impossible de mettre Ã  jour la visibilitÃ© du tableau\"],\"X0N0PA\":[\" (modifiÃ©)\"],\"XDRXbZ\":[\"La description de l'espace de travail doit comporter au moins 3 caractÃ¨res\"],\"XILg0L\":[\"Adresse e-mail invalide\"],\"XJOV1Y\":[\"ActivitÃ©\"],\"XTKtey\":[\"CrÃ©er une liste\"],\"XXbgHS\":[\"EmbauchÃ©\"],\"XYLcNv\":[\"Assistance\"],\"XicmhT\":[\"Date d'Ã©chÃ©ance\"],\"Xid3K6\":[\"L'URL du tableau ne peut contenir que des lettres, des chiffres et des traits d'union\"],\"Xjj/kS\":[\"Kanban rÃ©inventÃ©\"],\"XpcjLO\":[\"Impossible de mettre Ã  jour l'URL du tableau\"],\"XyuOHa\":[\"Partage de tableau & invitations\"],\"YBBifR\":[\"DÃ©connecter Trello\"],\"YKeYae\":[\"Impossible de rÃ©organiser l'Ã©lÃ©ment de la liste de contrÃ´le\"],\"YQqv2e\":[\"Get started by creating a new board\"],\"YVT40D\":[\"a supprimÃ© l'Ã©tiquette <0>\",[\"0\"],\"</0>\"],\"YaZDYI\":[\"Erreur lors de la mise Ã  niveau de l'abonnement\"],\"YcyP2z\":[\"Impossible de crÃ©er le modÃ¨le\"],\"Yf9FAx\":[\"Ils ne pourront plus accÃ©der Ã  cet espace de travail.\"],\"YhvWXb\":[\"Analyses du tableau\"],\"YirHq7\":[\"Commentaires\"],\"YoyKbT\":[\"Cette clÃ© API ne sera affichÃ©e qu'une seule fois. Veuillez la sauvegarder dans un emplacement sÃ©curisÃ©.\"],\"YtUfwW\":[\"Ã‰chec de connexion avec \",[\"0\"],\". Veuillez rÃ©essayer.\"],\"Z3FXyt\":[\"Chargement...\"],\"Z3krJD\":[\"Permettre aux membres de l'espace de travail de voir les adresses e-mail des autres\"],\"Z6r9z1\":[\"Impossible de supprimer la carte\"],\"Z7/Xyy\":[\"Applicants, Screening, Interviewing, Offer, Onboarding, Hired\"],\"ZDGm40\":[\"Supprimer le compte\"],\"ZDIydz\":[\"Commencer\"],\"ZDo4HN\":[\"Brainstorming\"],\"ZH7TVS\":[\"Titre de la carte\"],\"ZL1A+p\":[\"Ã‰chec du tÃ©lÃ©versement de la piÃ¨ce jointe. Veuillez rÃ©essayer.\"],\"ZT4Khw\":[\"ÃŠtes-vous sÃ»r de vouloir supprimer cette carte ?\"],\"ZU5IYI\":[\"Tableaux illimitÃ©s, listes illimitÃ©es, cartes illimitÃ©es. Aucune carte de crÃ©dit requise.\"],\"ZXSPJt\":[\"Une erreur inattendue s'est produite. Veuillez rÃ©essayer plus tard.\"],\"ZqDqbi\":[\"Organisez et trouvez rapidement des cartes avec des outils de filtrage puissants.\"],\"Zz1qkk\":[\"Cartes illimitÃ©es\"],\"aHCEmh\":[\"Tarifs\"],\"aHRWVI\":[\"a supprimÃ© la date d'Ã©chÃ©ance\"],\"aJ4pMe\":[\"FAQ\"],\"aWDhU5\":[\"Kanban est meilleur en Ã©quipe. Parfait pour les petites Ã©quipes et celles en croissance qui cherchent Ã  collaborer.\"],\"aWlSc/\":[\"CrÃ©er une nouvelle liste\"],\"abUZlY\":[\"Ajouter des dÃ©tails...\"],\"aelko+\":[\"Vous pouvez obtenir une URL d'espace de travail personnalisÃ©e, comme <0>kan.bn/kan</0>, en accÃ©dant Ã  vos <1>paramÃ¨tres d'espace de travail</1> et en souscrivant Ã  un abonnement pro. Tous les abonnements contribuent Ã  financer le dÃ©veloppement du projet !\"],\"aiHZVP\":[\"Voir la documentation\"],\"aj40Mw\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users (free during the beta) and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"b/LfJo\":[\"e-mail\"],\"b3Thhd\":[\"Ã‰chec du tÃ©lÃ©versement\"],\"b5FKyH\":[\"a ajoutÃ© l'Ã©tiquette <0>\",[\"0\"],\"</0>\"],\"b9XOHo\":[\"CrÃ©er \",[\"0\"]],\"bA2LQS\":[\"DÃ©tail des fonctionnalitÃ©s\"],\"bD8I7O\":[\"TerminÃ©\"],\"bDI6VI\":[[\"0\"],\" a Ã©tÃ© retirÃ© de vos favoris.\"],\"bJZm1W\":[\"Candidats\"],\"bJtM0P\":[\"Cette URL d'espace de travail est rÃ©servÃ©e\"],\"bZSICm\":[\"Impossible d'ajouter l'Ã©lÃ©ment Ã  la liste de contrÃ´le\"],\"bcIybO\":[\"Le nom de l'espace de travail est requis\"],\"bdztP2\":[\"Recherche\"],\"bfZE+Y\":[\"Le rÃ´le du membre a Ã©tÃ© mis Ã  jour.\"],\"bff61F\":[\"Forfait d'Ã©quipe\"],\"bfgr/e\":[\"Question\"],\"bgh/9n\":[\"peut gÃ©rer les paramÃ¨tres de l'espace de travail\"],\"bmXKoX\":[\"a ajoutÃ© \",[\"0\"],\" Ã©tiquettes : <0>\",[\"labelList\"],\"</0>\"],\"bqAQaT\":[\"Erreur lors de la suppression du compte\"],\"c/IAuR\":[\"Important\"],\"c3b0B0\":[\"Commencer\"],\"c9AJhn\":[\"Rejoindre l'espace de travail\"],\"cAgBMh\":[\"ContrÃ´le et propriÃ©tÃ© complets :\"],\"cFQEU/\":[\"Ouvrir les raccourcis clavier\"],\"cOh+MI\":[\"PrÃ©sÃ©lection\"],\"cWcxrL\":[\"Nouvelle checklist\"],\"cWtfn1\":[\"Passer Ã  Pro (29 $/mois)\"],\"chyf4J\":[\"Description de l'espace de travail\"],\"cji2nM\":[\"Erreur lors de la crÃ©ation du lien d'invitation\"],\"cnGeoo\":[\"Supprimer\"],\"cp1rsD\":[\"DÃ©sactiver le lien d'invitation\"],\"csFbe+\":[\"Aller aux modÃ¨les\"],\"curoK5\":[\"Nouvel espace de travail\"],\"d33Usy\":[\"CrÃ©er une checklist\"],\"d7XqZJ\":[\"A powerful, flexible kanban app that helps you organise work,\\n              track progress, and deliver resultsâ€”all in one place.\"],\"dEgA5A\":[\"Annuler\"],\"dUh9QW\":[\"Planification\"],\"ddrz1m\":[\"En retard\"],\"delOXn\":[\"Impossible de mettre Ã  jour les Ã©tiquettes\"],\"dgr4Kq\":[\"Modifier l'Ã©tiquette\"],\"dmKdk0\":[\"Une fois que vous supprimez votre espace de travail, il n'y a pas de retour possible. Cette action ne peut pas Ãªtre annulÃ©e.\"],\"dsLT3m\":[\"CrÃ©er une carte\"],\"dtbpdR\":[\"Trello\"],\"duf3Nr\":[\"Cette URL d'espace de travail est dÃ©jÃ  prise\"],\"e12o5C\":[\"Invite another\"],\"e4hPSt\":[\"RÃ©initialiser aux valeurs par dÃ©faut du rÃ´le\"],\"eEQyz+\":[\"Suivez tous les changements de cartes avec un historique d'activitÃ© dÃ©taillÃ©.\"],\"ePK91l\":[\"Modifier\"],\"eZCGbT\":[\"Oui, nous proposons un plan gratuit Ã  vie pour un usage individuel. Aucune restriction, aucun paywall, aucune limite.\"],\"edWbV6\":[\"Lien copiÃ©\"],\"en3oy5\":[\"FonctionnalitÃ©\"],\"evg7+A\":[\"Vos tableaux ont Ã©tÃ© importÃ©s.\"],\"evj0lK\":[\"Proposez-vous un plan gratuit ?\"],\"f8fH8W\":[\"Design\"],\"f8lDFq\":[\"a crÃ©Ã© la carte\"],\"fEY2vP\":[\"Carte introuvable\"],\"fJxqi6\":[\"Custom URLs require Pro plan ($29/month)\"],\"fQCrjt\":[\"La visibilitÃ© de votre tableau a Ã©tÃ© dÃ©finie sur \",[\"0\"],\".\"],\"fR9laE\":[\"Saisissez votre mot de passe actuel\"],\"fSf2ee\":[\"Consultez notre feuille de route.\"],\"fYVH36\":[\"Impossible de mettre Ã  jour le commentaire\"],\"fvLNDy\":[\"Aucune liste n'a encore Ã©tÃ© crÃ©Ã©e\"],\"fziA2d\":[\"Commentaires illimitÃ©s\"],\"g2xBxu\":[\"L'importation de vos tableaux Trello dans Kan est simple. Vous pouvez suivre notre guide Ã©tape par Ã©tape <0>ici</0>.\"],\"gGx5tM\":[\"Ã‰dition\"],\"gL/7jw\":[\"Ajouter une description... (tapez '/' pour ouvrir les commandes ou '@' pour mentionner)\"],\"gUX7b+\":[\"L'alternative open source <0/> Ã  Trello\"],\"gZxH/p\":[\"a modifiÃ© la date d'Ã©chÃ©ance pour <0>\",[\"formattedDate\"],\"</0>\"],\"ghSJ4U\":[\"Le nom de l'espace de travail ne peut pas dÃ©passer 64 caractÃ¨res\"],\"gkzAEM\":[\"Continuer avec \",[\"0\"]],\"goklcJ\":[\"Entretien\"],\"gpfJ3v\":[\"Gratuit, pour toujours\"],\"gukxZ5\":[\"IntÃ©gration\"],\"gv5kbo\":[\"L'URL du tableau ne peut pas dÃ©passer 60 caractÃ¨res\"],\"h16FyT\":[\"Listes\"],\"h2FKMV\":[\"Vous n'avez pas la permission\"],\"h4VV67\":[\"a ajoutÃ© une checklist\"],\"h7MgpO\":[\"Raccourcis clavier\"],\"h8DugX\":[\"Ã‰tiquettes\"],\"hAMddS\":[\"s'est retirÃ© de la carte\"],\"hXMFoN\":[\"Aucune liste\"],\"hYzsXr\":[\"ParamÃ¨tres | IntÃ©grations\"],\"hh61gL\":[\"Importation depuis Trello\"],\"iFxrHK\":[\"Find answers to common questions about the project. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"iHcdea\":[\"Ã‰chÃ©ance la semaine prochaine\"],\"iLbjv+\":[\"Peut modifier l'espace de travail\"],\"iQmbPb\":[\"Licence\"],\"iTylMl\":[\"ModÃ¨les\"],\"iVIGZb\":[\"PiÃ¨ce jointe tÃ©lÃ©versÃ©e\"],\"isRobC\":[\"Nouveau\"],\"iwr7AP\":[\"IdÃ©es\"],\"iy1wb+\":[\"ParamÃ¨tres | API\"],\"j2+d/o\":[\"RÃ©fÃ©rence API\"],\"j9IZZ0\":[\"URL d'espace de travail personnalisÃ©e\"],\"jDRt4n\":[\"Voulez-vous vous dÃ©sabonner ?\"],\"jL82rC\":[\"Effacer les permissions personnalisÃ©es\"],\"jNuzV/\":[\"Peut supprimer des cartes\"],\"jQ6I8X\":[\"RÃ´le mis Ã  jour\"],\"jZBHkN\":[\"Le nom de l'espace de travail doit comporter au moins 3 caractÃ¨res\"],\"jfC/xh\":[\"Contact\"],\"jkbHit\":[\"around the world\"],\"jl3aEJ\":[\"a marquÃ© l'Ã©lÃ©ment <0>\",[\"0\"],\"</0> de la checklist comme incomplet\"],\"jlB2RY\":[\"Le mot de passe actuel que vous avez saisi est incorrect.\"],\"jwI32v\":[\"Tableau introuvable\"],\"kECVpo\":[\"ÃŠtes-vous sÃ»r de vouloir supprimer cette Ã©tiquette ?\"],\"kQwvU8\":[\"a supprimÃ© une Ã©tiquette de la carte\"],\"kSxwQL\":[\"Vous pouvez inviter des membres de l'Ã©quipe en cliquant sur le bouton \\\"Inviter\\\" dans le coin supÃ©rieur droit de la <0>page des membres</0> et en saisissant leur adresse e-mail. Ils recevront un e-mail avec un lien pour rejoindre l'espace de travail.\"],\"kYu0eF\":[\"Supprimer l'espace de travail\"],\"kfOGMr\":[\"Victoire rapide\"],\"klpSmb\":[\"Modifier l'URL de l'espace de travail\"],\"kp6L3T\":[\"Ce nom d'utilisateur d'espace de travail est dÃ©jÃ  pris\"],\"kryGs+\":[\"Carte\"],\"kuoc68\":[\"10 $/mois\"],\"kwkhPe\":[\"Upgrade\"],\"kxEs5t\":[\"Importations Trello\"],\"l2PIAy\":[\"Auto-hÃ©bergement avec Github\"],\"l31EoQ\":[\"Trouvez des rÃ©ponses aux questions frÃ©quentes sur Kan. Vous ne trouvez pas ce que vous cherchez ? N'hÃ©sitez pas Ã  <0>nous contacter</0>.\"],\"l3s5ri\":[\"Importer\"],\"l4asa1\":[\"Ce tableau est privÃ© ou n'existe pas\"],\"lGjicL\":[\", ou consultez notre\"],\"lKAvEd\":[\"Erreur lors de la dÃ©connexion de Trello\"],\"lSNkXg\":[\"All seats are free during the beta until Sept 1st!\"],\"lXvXNI\":[\"Ã‰chec de la copie du lien d'invitation\"],\"lYT7pQ\":[\"Supprimer la liste\"],\"lcokBr\":[\"DÃ©tenu par Atlassian\"],\"lkz85l\":[\"La principale diffÃ©rence entre Kan et Trello est que Kan est open source, permettant Ã  chacun de consulter, modifier et contribuer Ã  notre code. Notre offre cloud ne comporte Ã©galement aucune restriction sur les fonctionnalitÃ©s pour un usage individuel, alors que Trello verrouille des fonctionnalitÃ©s de base comme le nombre de tableaux que vous pouvez crÃ©er derriÃ¨re un paywall.\"],\"lo8xBK\":[\"ÃŠtes-vous sÃ»r de vouloir supprimer \",[\"entityLabel\"],\" ?\"],\"lpIMne\":[\"Les mots de passe ne correspondent pas\"],\"lsgnzd\":[\"Erreur lors de la mise Ã  niveau vers Pro\"],\"lyqwgn\":[\"Ajouter une Ã©tiquette\"],\"m2nk0i\":[\"Tarification simple\"],\"mErq7F\":[\"S'inscrire\"],\"mHhffx\":[\"Impossible de crÃ©er la liste de contrÃ´le\"],\"mTGd3+\":[\"a supprimÃ© une checklist\"],\"mTwGOf\":[\"Ce lien d'invitation est invalide ou a expirÃ©.\"],\"mU+M00\":[[\"0\"],\" a Ã©tÃ© ajoutÃ© Ã  vos favoris.\"],\"mVZH9V\":[\"Quand Trello a Ã©tÃ© lancÃ© en 2011, il a impressionnÃ© tout le monde par sa simplicitÃ© soigneusement conÃ§ue, mais au fil des ans, il a perdu sa magie et s'est transformÃ© en quelque chose de plus proche de \\\"Jira Lite\\\". Ce projet est notre tentative de retrouver la magie originelle de la simplicitÃ© de Trello, en open source.\"],\"mZGPxt\":[\"Lien d'invitation copiÃ© dans le presse-papiers\"],\"mchgzf\":[\"Vous vous Ãªtes inscrit avec succÃ¨s.\"],\"mgXgHu\":[\"Aller aux tableaux\"],\"mwBdZ2\":[\"Cela entraÃ®nera la suppression dÃ©finitive de toutes les donnÃ©es associÃ©es Ã  votre compte.\"],\"mx8+1u\":[\"Membres illimitÃ©s\"],\"n+xLOH\":[\"Support client\"],\"n1GRql\":[\"Nouvelle Ã©tiquette\"],\"n1ekoW\":[\"Se connecter\"],\"n9V+ps\":[\"Saisissez votre nom\"],\"nOhz3x\":[\"DÃ©connexion\"],\"nabda1\":[\"Supprimer la carte\"],\"nbfdhU\":[\"IntÃ©grations\"],\"nhMhRr\":[\"Merci pour vos commentaires !\"],\"njJFtc\":[\"Supprimer le commentaire\"],\"nk7caK\":[\"Connecter Trello\"],\"nol/Fb\":[\"Comment inviter des membres de l'Ã©quipe ?\"],\"notwF1\":[\"Le nom du modÃ¨le ne peut pas dÃ©passer 100 caractÃ¨res\"],\"nq7q3Z\":[\"Le nom de la clÃ© API ne peut pas dÃ©passer 30 caractÃ¨res\"],\"nqdIhs\":[\"ModÃ¨les de tableau personnalisÃ©s\"],\"nryrgW\":[\"Toutes les permissions personnalisÃ©es des membres ont Ã©tÃ© rÃ©initialisÃ©es aux valeurs par dÃ©faut de leur rÃ´le.\"],\"nxb+xc\":[\"unassigned <0>\",[\"memberName\"],\"</0> from the card\"],\"o+JCfN\":[\"ApprouvÃ© par des Ã©quipes dynamiques<0/>du monde entier\"],\"o7J4JM\":[\"Filtrer\"],\"o9WLwO\":[\"Impossible de mettre Ã  jour la carte\"],\"oBndex\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"oVBq1w\":[\"par utilisateur/mois\"],\"oW13KZ\":[\"Commencez gratuitement aujourd'hui\"],\"oXpmwC\":[\"Auto-hÃ©bergeable\"],\"odFCYX\":[\"Invitation invalide\"],\"ohktr7\":[\"Commentaires & mentions\"],\"okpxfB\":[\"CrÃ©er une nouvelle clÃ©\"],\"oyRjD/\":[\"Plan Pro\"],\"p/hk9N\":[\"Vous vous Ãªtes connectÃ© avec succÃ¨s.\"],\"pBsoKL\":[\"Ajouter aux favoris\"],\"pFGfsR\":[\"DÃ©couvrez certains de nos projets open source prÃ©fÃ©rÃ©s.\"],\"pFKC6A\":[\"Nom de la clÃ© API\"],\"pL78ec\":[\"AjoutÃ© aux favoris\"],\"pXVFJy\":[\"Peut supprimer des tableaux\"],\"pa9o5D\":[\"Recadrez votre avatar\"],\"pfa8F0\":[\"Nom d'affichage\"],\"pmUArF\":[\"Espace de travail\"],\"pnrmSP\":[\"Nouvelle carte\"],\"poDo/D\":[\"Create new board\"],\"ppaRWv\":[\"Auto-hÃ©bergement\"],\"pvnfJD\":[\"Sombre\"],\"q+lt9D\":[\"Erreur lors de la suppression de l'Ã©tiquette\"],\"qPP4lD\":[\"L'invitation de membres nÃ©cessite un forfait d'Ã©quipe. Vous serez redirigÃ© pour mettre Ã  niveau votre espace de travail.\"],\"qQXocp\":[\"Peut gÃ©rer les paramÃ¨tres de l'espace de travail\"],\"qfUS/w\":[\"Amis Open Source\"],\"qkjvgj\":[\"Votre espace de travail a Ã©tÃ© supprimÃ©.\"],\"qlAIQ1\":[\"Ã€ distance\"],\"qrT8WB\":[\"#1 Hacker News\"],\"qtE5nt\":[\"Ajouter un Ã©lÃ©ment...\"],\"qzdST2\":[\"VisibilitÃ© du tableau\"],\"r6BgwX\":[\"Le mot de passe est requis pour se connecter.\"],\"rD6UIt\":[\"Commencer sur le Cloud\"],\"rF8SEQ\":[\"Modifier le commentaire\"],\"rRM7r0\":[\"Importez vos tableaux Trello et commencez immÃ©diatement.\"],\"rYUZIe\":[\"SÃ©lectionner la source\"],\"raHesj\":[\"Vous avez Ã©tÃ© dÃ©sabonnÃ© !\"],\"rarRW/\":[\"Erreur lors de l'invitation du membre\"],\"ri1hHe\":[\"Ã‰chÃ©ance le mois prochain\"],\"rmN315\":[\"Amusant\"],\"rs7L54\":[\"a ajoutÃ© un membre Ã  la carte\"],\"rtbVvN\":[\"Peut modifier des listes\"],\"s+MGs7\":[\"Ressources\"],\"s6iE/c\":[\"L'inscription est actuellement dÃ©sactivÃ©e. Veuillez rÃ©essayer plus tard.\"],\"sBhOFG\":[\"Gestion de tÃ¢ches visuelle et simple qui fonctionne parfaitement. Glissez-dÃ©posez des cartes, collaborez avec votre Ã©quipe et accomplissez davantage.\"],\"sDLCvT\":[\"Connectez vos outils favoris pour simplifier votre flux de travail.\"],\"sDuhfK\":[\"Offre de lancement : siÃ¨ges illimitÃ©s pour seulement 29 $/mois avec Pro\"],\"sUZo7y\":[\"Inscription | kan.bn\"],\"sVBn4K\":[\"Erreur lors de la mise Ã  jour du nom d'affichage\"],\"sY2lzr\":[\"Aucune URL de tÃ©lÃ©chargement disponible pour cette piÃ¨ce jointe.\"],\"seaklU\":[\"Boards | \",[\"0\"]],\"t+R8+P\":[\"ExÃ©cution\"],\"t/YqKh\":[\"Supprimer\"],\"t2nDzl\":[\"Consultez et gÃ©rez votre facturation et votre abonnement.\"],\"t6FvJH\":[\"Peut ajouter des commentaires\"],\"tGwwnq\":[\"a mis Ã  jour la description\"],\"tHcbLF\":[\"Peut modifier des tableaux\"],\"tHjBUm\":[\"Kan\"],\"tIdipJ\":[\"Modifier l'URL du tableau\"],\"tMYIu7\":[\"Journaux d'activitÃ©\"],\"tTbref\":[\"Le mot de passe est requis pour s'inscrire.\"],\"tYN21H\":[\"L'utilisateur est dÃ©jÃ  membre de cet espace de travail\"],\"tca56/\":[\"Votre fichier a Ã©tÃ© tÃ©lÃ©versÃ© avec succÃ¨s.\"],\"tfDRzk\":[\"Enregistrer\"],\"tmlJN1\":[\"Veuillez saisir une URL YouTube valide\"],\"tmpW+w\":[\"Supprimer le tableau\"],\"tyHiOa\":[\"Veuillez rÃ©essayer plus tard ou contacter le service client.\"],\"u2+JIh\":[\"Les URL personnalisÃ©es nÃ©cessitent une mise Ã  niveau vers un forfait Pro\"],\"u8JHrO\":[\"Effacer les filtres\"],\"uOqaMC\":[\"Vous avez Ã©tÃ© invitÃ© Ã  rejoindre un espace de travail.\"],\"uXGLuq\":[\"CrÃ©er une clÃ© API\"],\"uZg2+w\":[\"Optimisez votre espace de travail pour seulement 29 $/mois. Voici ce que vous obtiendrez :\"],\"uck1tz\":[\"a retirÃ© un membre de la carte\"],\"usVytm\":[\"Une fois que vous supprimez votre compte, il n'y a pas de retour possible. Cette action ne peut pas Ãªtre annulÃ©e.\"],\"uwBBCy\":[\"Kan est meilleur en Ã©quipe. Parfait pour les petites Ã©quipes et celles en croissance qui cherchent Ã  collaborer.\"],\"v+Wp++\":[\"Open source\"],\"v3YoMA\":[\"Senior\"],\"vAR/I8\":[\"ExÃ©cutez sur votre propre infrastructure\"],\"vAj6xG\":[\"Vous pouvez auto-hÃ©berger en suivant les instructions dans notre <0>dÃ©pÃ´t</0>.\"],\"vMCCIc\":[\"L'URL ne peut pas dÃ©passer 24 caractÃ¨res\"],\"vSJd18\":[\"VidÃ©o\"],\"vUr5JT\":[\"Vous n'avez pas de compte ? <0><1>Inscrivez-vous</1></0>\"],\"vXIe7J\":[\"Langue\"],\"vXemf6\":[\"Bug\"],\"va/3u1\":[\"ContrÃ´lez qui peut voir et modifier vos tableaux.\"],\"vbskQn\":[\"Le nom de la clÃ© API est requis\"],\"veIDCY\":[\"Commencer l'essai gratuit de 14 jours\"],\"vfRdCZ\":[\"Impossible de rÃ©initialiser les permissions\"],\"vgdzLf\":[\"CrÃ©er un autre\"],\"vifyyw\":[\"Mentions lÃ©gales\"],\"vlxQFL\":[\"Les permissions de ce membre ont Ã©tÃ© rÃ©initialisÃ©es aux valeurs par dÃ©faut de son rÃ´le.\"],\"vneRvS\":[\"facturation mensuelle\"],\"vuxdLS\":[\"Long terme\"],\"vwGkYB\":[\"Le mot de passe doit comporter au moins 8 caractÃ¨res\"],\"wIb7Ng\":[\"DÃ©veloppement logiciel\"],\"wIkTTk\":[\"Workspace name cannot exceed 24 characters\"],\"wM8xd8\":[\"Junior\"],\"wPZBpR\":[\"Veuillez sÃ©lectionner un fichier Ã  tÃ©lÃ©charger.\"],\"wY+6Ye\":[\"Cette URL de tableau est dÃ©jÃ  utilisÃ©e\"],\"wakO3W\":[\"a ajoutÃ© la checklist <0>\",[\"0\"],\"</0>\"],\"wewm3j\":[\"Le nom du tableau ne peut pas dÃ©passer 100 caractÃ¨res\"],\"wgNoIs\":[\"SÃ©lectionner tout\"],\"wlQNTg\":[\"Membres\"],\"wqkcin\":[\"Peut voir les commentaires\"],\"wqxglO\":[\"Apprentissage\"],\"wruKPE\":[\"Soutenir le dÃ©veloppement du projet\"],\"wtxjAY\":[\"Membres de l'espace de travail\"],\"wzR1hC\":[\"Board name cannot exceed 50 characters\"],\"x0kMO/\":[\"Erreur lors de la mise Ã  jour de l'URL de l'espace de travail\"],\"x8GeCD\":[\"Nom d'affichage mis Ã  jour\"],\"xEbBrW\":[\"Quelle licence utilisez-vous ?\"],\"xJO7ca\":[\"updated the title to <0>\",[\"toTitle\"],\"</0>\"],\"xMn+V9\":[\"Importation depuis Trello\"],\"xRPn3U\":[\"Saisissez votre adresse e-mail\"],\"xvcYhz\":[\"Effacer toutes les permissions personnalisÃ©es des membres afin que tous les membres hÃ©ritent uniquement des permissions par dÃ©faut de leur rÃ´le.\"],\"yCzSJ3\":[\"Espaces de travail illimitÃ©s\"],\"yD3ZSw\":[\"Modifiez vos prÃ©fÃ©rences linguistiques.\"],\"yH4aFo\":[\"Share invite link\"],\"yV7o5I\":[\"Comment importer mes tableaux Trello ?\"],\"yb/fjw\":[\"Approbation\"],\"yz7wBu\":[\"Fermer\"],\"zC8Whw\":[\"Commencez par crÃ©er une nouvelle liste\"],\"zDw80P\":[\"New board\"],\"zEGgv4\":[\"Comparez nos fonctionnalitÃ©s pour voir pourquoi Kan est le meilleur choix.\"],\"zERArS\":[\"a mis Ã  jour le titre en <0>\",[\"0\"],\"</0>\"],\"zKY5xi\":[\"CrÃ©er un lien d'invitation\"],\"zLXwCk\":[\"my-workspace-name\"],\"zMjN8w\":[\"API REST\"],\"zMlxCA\":[\"1 utilisateur\"],\"zQPhSa\":[\"Convertir en lien\"],\"zQX5Dj\":[\"Nom de la liste\"],\"zdMPUq\":[\"removed label <0>\",[\"label\"],\"</0>\"],\"zkWmBh\":[\"Annuel\"],\"zl1b97\":[\"Impossible de crÃ©er la carte\"],\"zoEbXq\":[\"Peut voir les cartes\"],\"zto8aj\":[\"Trello dÃ©connectÃ©\"],\"zwBp5t\":[\"PrivÃ©\"],\"zwWKhA\":[\"En savoir plus\"],\"zxKs+y\":[\"Ã‰chÃ©ance demain\"],\"zzDlyQ\":[\"SuccÃ¨s\"]}")as Messages;


================================================
FILE: apps/web/src/locales/it/messages.ts
================================================
/*eslint-disable*/import type{Messages}from"@lingui/core";export const messages=JSON.parse("{\"++rVAm\":[\"Social media\"],\"+3TYXa\":[\"Per la sostenibilitÃ  a lungo termine, riconosciamo che tutti i buoni progetti open source necessitano di una fonte di entrate. La nostra proviene dall'offerta cloud a pagamento per gli spazi di lavoro con piÃ¹ utenti e per gli slug personalizzati degli spazi di lavoro. Non c'Ã¨ alcun obbligo di utilizzarla, e puoi ospitare autonomamente il software sulla tua infrastruttura gratuitamente.\"],\"+8Nek/\":[\"Mensile\"],\"+EkBs0\":[\"Non siamo riusciti ad aggiornare le tue preferenze. Riprova.\"],\"+MdEsf\":[\"La nuova password Ã¨ obbligatoria\"],\"+OhFss\":[\"Inizia gratuitamente, senza limiti di utilizzo. Per la collaborazione, passa a un piano adatto alle dimensioni del tuo team.\"],\"+VoTOr\":[\"fatturato mensilmente\"],\"+cilKj\":[\"Ideas, Research, Planning, Execution, Review, Next Steps, Complete\"],\"+djOzj\":[\"Invita membro\"],\"+nvZ6j\":[\"Etichette & Filtri\"],\"/8pTF/\":[\"workspace-url\"],\"/Blkmk\":[\"Add description... (type '/' to open commands)\"],\"/DGOJs\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trelloâ€™s simplicity, in open source.\"],\"/K2CvV\":[\"Template\"],\"/asTmx\":[\"Segnalazione bug\"],\"/f3t6v\":[\"Configura quali azioni sono consentite per ogni ruolo dello spazio di lavoro. Questi permessi si applicano a tutti i membri con quel ruolo.\"],\"/gaSVU\":[\"Roadmap\"],\"/glL9Q\":[\"Nessun \",[\"0\"]],\"/lDBHm\":[\"FAQ\"],\"/rn4RE\":[\"Un'app kanban potente e flessibile che ti aiuta a organizzare il lavoro, monitorare i progressi e ottenere risultati, tutto in un unico posto.\"],\"/tOdd2\":[\"La tua immagine del profilo Ã¨ stata aggiornata.\"],\"0+0/3e\":[\"Crea nuova etichetta\"],\"0+ewPp\":[\"Miglioramento\"],\"0KjpAr\":[\"PuÃ² visualizzare i membri\"],\"0StR7t\":[\"Inserisci la tua nuova password\"],\"0dyOHD\":[\"Backlog, To Do, In Progress, Code Review, Done\"],\"0jV46i\":[\"Impossibile eliminare l'elemento della checklist\"],\"0qyZ4b\":[\"Caricamento permessi...\"],\"0rPv1T\":[\"Immagine del profilo aggiornata\"],\"0xWkkH\":[[\"boardCount\",\"plural\",{\"one\":[\"Importa bacheca (1)\"],\"other\":[\"Importa bacheche (\",[\"boardCount\"],\")\"]}]],\"1/jlQw\":[\"Trusted by fast-moving teams\"],\"14Xi3Z\":[\"L'aggiunta di un nuovo membro costerÃ  un supplemento di \",[\"price\"],\" (\",[\"billingType\"],\") per posto.\"],\"1H5u1m\":[\"Domande?\"],\"1HPFNH\":[\"Prezzo per utente/mese\"],\"1WuwiM\":[\"Vai alle impostazioni\"],\"1ZVGyT\":[\"Aggiungi un commento...\"],\"1hzdxO\":[\"Permessi workspace\"],\"1iShX0\":[\"Scade oggi\"],\"1njn7W\":[\"Chiaro\"],\"1rVAfU\":[\"Carica altre attivitÃ \"],\"1rWxEw\":[\"In attesa del cliente\"],\"1sRmLC\":[\"Discuti e collabora sulle schede.\"],\"1sSegR\":[\"Brainstorming, Writing, Editing, Design, Approval, Publishing, Done\"],\"1wCGT0\":[\"Bacheche illimitate\"],\"25fAUC\":[\"Il tuo link per annullare l'iscrizione non contiene un token. Apri l'email piÃ¹ recente e riprova.\"],\"25mvI+\":[\"I link di invito richiedono un abbonamento Team o Pro. Per favore aggiorna il tuo spazio di lavoro.\"],\"29sSki\":[\"ha completato l'elemento <0>\",[\"0\"],\"</0> della checklist\"],\"2BBAbc\":[\"Lista\"],\"2Bu8xj\":[\"Nessuna bacheca trovata\"],\"2M84k3\":[\"Permessi personalizzati\"],\"2MPcep\":[\"Importazione completata\"],\"2POOFK\":[\"Gratuito\"],\"2Py5S/\":[\"Riconosco che tutti i dati dell'area di lavoro saranno eliminati permanentemente e voglio procedere.\"],\"2Q871c\":[\"Impossibile aggiungere l'etichetta\"],\"2QGEbi\":[\"Impossibile eliminare il commento\"],\"2SePRT\":[\"Sei stato invitato a unirti a uno spazio di lavoro su kan.bn.\"],\"2h4PVB\":[\"Il nome del tuo spazio di lavoro Ã¨ stato aggiornato.\"],\"2liqDZ\":[\"Riconosco che tutti i dati del mio account saranno eliminati permanentemente e voglio procedere.\"],\"2q/Q7x\":[\"VisibilitÃ \"],\"2roTVj\":[\"Feedback inviato\"],\"3LDCpD\":[\"Questa azione non puÃ² essere annullata.\"],\"3ZjRJY\":[\"ha rinominato la checklist <0>\",[\"0\"],\"</0>\"],\"3bqt9U\":[\"Chiunque abbia questo link puÃ² unirsi al tuo spazio di lavoro\"],\"3pIq39\":[\"Ruoli amministratore\"],\"479pdJ\":[\"Conferma la tua nuova password\"],\"4DOCMI\":[\"URL YouTube\"],\"4RoY9J\":[\"Post del blog\"],\"4XF0BB\":[\"Immagine del profilo\"],\"4gAX8s\":[\"Attiva/disattiva menu\"],\"4ix5kl\":[\"Errore durante l'aggiornamento dell'immagine del profilo\"],\"4kJRen\":[\"Scrittura\"],\"4qu8Ec\":[\"Prova gratuita di 14 giorni\"],\"53QYh8\":[\"Impossibile creare la bacheca\"],\"55xJ/O\":[\"Errore durante il cambio della password\"],\"58AiWX\":[\"Conferma la tua nuova password\"],\"5ACX4z\":[\"Newsletter\"],\"5IXWmO\":[\"Controlla la tua casella di posta\"],\"5P4rhH\":[\"Impossibile aggiornare i membri\"],\"5eZwRW\":[\"Connetti il tuo account Trello per importare le bacheche.\"],\"5h8ooz\":[\"Chiavi API\"],\"5iplxh\":[\"La nuova password deve essere diversa dalla password attuale\"],\"5k0NLb\":[\"Revisione\"],\"5lWFkC\":[\"Accedi\"],\"5wo3jF\":[\"Settings | \",[\"0\"]],\"69b7aE\":[\"Apri menu dei comandi\"],\"6E4pW0\":[\"White label\"],\"6EWT6T\":[\"Reclutamento\"],\"6FDocz\":[\"Registrati con \"],\"6FsGbN\":[\"Inizia creando un nuovo \",[\"0\"]],\"6OTo9n\":[\"Il nome del template Ã¨ obbligatorio\"],\"6S8zjx\":[\"https://www.youtube.com/watch?v=...\"],\"6WSYbN\":[\"Nuovo \",[\"0\"]],\"6YtxFj\":[\"Nome\"],\"6mbe4b\":[\"Privati\"],\"6tDFBe\":[\"I permessi del membro sono stati aggiornati.\"],\"6zeSBB\":[\"PuÃ² creare schede\"],\"74F7N/\":[\"Sei sicuro di voler eliminare il tuo account?\"],\"7EhE4k\":[\"Aggiorna etichetta\"],\"7L01XJ\":[\"Azioni\"],\"7PzzBU\":[\"Utente\"],\"7Ufoyg\":[\"Liste illimitate\"],\"7b2yuC\":[\"Inserisci una password valida\"],\"7d1a0d\":[\"Pubblico\"],\"7eMo+U\":[\"Vai alla home\"],\"7hktsm\":[\"Primi passi\"],\"7i8j3G\":[\"Azienda\"],\"8+BY11\":[\"URL della bacheca copiato negli appunti\"],\"86XI28\":[\"Conferma le tue preferenze email:\"],\"8AbRER\":[\"Imposta data di scadenza\"],\"8Is1ih\":[\"Offerta di lancio\"],\"8RdLDU\":[\"Progetto personale\"],\"8TveY+\":[\"Bacheche\"],\"8Z4pNX\":[\"PuÃ² creare liste\"],\"8ZoISG\":[\"Confirm URL change\"],\"8iP0S8\":[\"Tutto ciÃ² che Ã¨ incluso nel piano gratuito, piÃ¹:\"],\"8yFGGF\":[\"Impossibile rimuovere il membro\"],\"91W07W\":[\"Custom URLs are a premium feature. You'll be directed to upgrade your account.\"],\"99VIgC\":[\"Rimuovi membro\"],\"9PaIxv\":[\"FunzionalitÃ  principali\"],\"9QmxLI\":[\"Create board\"],\"9cDpsw\":[\"Permessi\"],\"9eF5oV\":[\"Bentornato\"],\"9h7RDh\":[\"Offerta\"],\"9s9O5h\":[\"Errore durante l'eliminazione dell'area di lavoro\"],\"9u5BOr\":[\"Membri | \",[\"0\"]],\"9wdpwp\":[\"Portale di fatturazione\"],\"9x4DAL\":[[\"0\"],\" non trovato\"],\"9y1RcT\":[\"Siamo solo all'inizio. \"],\"A23Y7X\":[\"Unisciti allo spazio di lavoro | kan.bn\"],\"A5hiCy\":[\"Crea template\"],\"A8jqN7\":[\"Impossibile inviare feedback\"],\"ABCjd9\":[\"Pubblicazione\"],\"ADEin1\":[\"Impostazioni | Fatturazione\"],\"ALhEZV\":[\"PuÃ² invitare membri\"],\"ANyn0x\":[\"Tutto ciÃ² di cui hai bisogno, gratis per sempre. Bacheche illimitate, liste illimitate, schede illimitate. Aggiorna in qualsiasi momento.\"],\"ARvBT/\":[\"fatturato annualmente\"],\"ASjvm9\":[\"URL dello spazio di lavoro\"],\"AUYALh\":[\"Prossimamente\"],\"AX4ktp\":[\"Creazione contenuti\"],\"AZI/wb\":[\"Etichette & filtri\"],\"AeXO77\":[\"Account\"],\"Ax/hYa\":[\"La descrizione dell'area di lavoro non puÃ² superare i 280 caratteri\"],\"B3xxao\":[\"Aggiungi una carta\"],\"BBUDfW\":[\"Urgente\"],\"BEVzjL\":[\"Importazione fallita\"],\"BJbLe4\":[\"Utilizziamo la <0>licenza AGPL-3.0</0>.\"],\"BMkVQ3\":[\"ha eliminato la checklist <0>\",[\"0\"],\"</0>\"],\"BOqTi5\":[\"ha spostato la scheda da <0>\",[\"0\"],\"</0> a<1>\",[\"1\"],\"</1>\"],\"BSZSHI\":[\"Board analytics (coming soon)\"],\"BZkYSt\":[\"ha rimosso \",[\"0\"],\" etichette: <0>\",[\"labelList\"],\"</0>\"],\"BhDZlc\":[\"Sei sicuro di voler eliminare lo spazio di lavoro \",[\"0\"],\"?\"],\"Bhgd0l\":[\"Contattaci\"],\"Bosey8\":[\"Change the language of the app.\"],\"BzEFor\":[\"o\"],\"C56tim\":[\"Impossibile aggiornare la data di scadenza\"],\"CAL6E9\":[\"Team\"],\"CB/NpV\":[\"Alta prioritÃ \"],\"CHZ1jC\":[\"ha eliminato l'elemento <0>\",[\"0\"],\"</0> della checklist\"],\"CJ3zUq\":[\"Inserisci un nome valido\"],\"CJWDTP\":[\"Il tuo account Trello Ã¨ stato disconnesso.\"],\"CJukzS\":[[\"0\"],\" etichette\"],\"CTqTgr\":[\"Scorciatoie\"],\"CYWHT+\":[\"Errore durante il caricamento dell'immagine del profilo\"],\"Ci/KUX\":[\"Impostazioni | Area di lavoro\"],\"CkVV1t\":[\"Errore durante l'aggiornamento della descrizione dell'area di lavoro\"],\"Cmudpi\":[\"PuÃ² eliminare lo spazio di lavoro\"],\"CozWO1\":[\"Nome dello spazio di lavoro\"],\"D+NlUC\":[\"Sistema\"],\"D0esZz\":[\"Registro attivitÃ \"],\"D3C4Yx\":[\"La password attuale Ã¨ obbligatoria\"],\"D7/JvJ\":[\"Regola il ritaglio quadrato per adattarlo al tuo avatar.\"],\"D9ROdV\":[\"Link di invito\"],\"DAV3uK\":[\"Permessi aggiornati\"],\"DFjdv0\":[\"Elimina template\"],\"DMeWZD\":[\"Sei sicuro di voler eliminare questo \",[\"0\"],\"?\"],\"DPfwMq\":[\"Fatto\"],\"DahTzR\":[\"Impossibile eliminare la checklist\"],\"DbZgsJ\":[\"Crea template\"],\"DhLN1b\":[\"No boards\"],\"DtXlZq\":[\"Impossibile aggiornare la checklist\"],\"E0t3jO\":[\"ha aggiunto l'elemento <0>\",[\"0\"],\"</0> alla checklist\"],\"E8zYtd\":[\"ha rimosso l'assegnazione di <0>\",[\"0\"],\"</0> dalla scheda\"],\"ECJKc4\":[\"Chiave API creata\"],\"EEHmPC\":[\"Offerta di lancio: ottieni membri illimitati con Pro\"],\"EEQaqX\":[\"assigned <0>\",[\"memberName\"],\"</0> to the card\"],\"EH8IL3\":[\"Checklist\"],\"EM/caO\":[\"moved the card from <0>\",[\"fromList\"],\"</0> to<1>\",[\"toList\"],\"</1>\"],\"ERpq2P\":[\"Nessun risultato trovato per \\\"\",[\"debouncedQuery\"],\"\\\".\"],\"ESClHO\":[\"Supporto email prioritario\"],\"Eg99Sc\":[\"Nessun metodo di autenticazione Ã¨ attualmente disponibile\"],\"EifmPY\":[\"To Do, In Progress, Done\"],\"Eit43O\":[\"ha impostato la data di scadenza\"],\"EkH9pt\":[\"Aggiorna\"],\"EvArWh\":[\"Collabora senza problemi con il tuo team.\"],\"F/FPk/\":[\"Impostazioni | Permessi\"],\"F/Fhz0\":[\"Create Pro workspace\"],\"F/vB2g\":[\"Idee per migliorare questa pagina...\"],\"F3bW6y\":[\"Piattaforma\"],\"F4KRmY\":[\"$8/mese\"],\"F4PLG4\":[\"Descrizione dell'area di lavoro aggiornata\"],\"F8DaWi\":[\"Solo visualizzazione\"],\"FEr96N\":[\"Tema\"],\"FUltnF\":[\"Template personalizzati\"],\"FdtSNC\":[\"Crea spazio di lavoro\"],\"FmN5me\":[\"Risoluzione\"],\"FmfJjN\":[\"Visualizza e gestisci le tue chiavi API.\"],\"Fpci8b\":[\"Sei sicuro di voler eliminare questa checklist?\"],\"G1Gw0v\":[\"Nuovo template\"],\"GAD3Dx\":[\"Dominio personalizzato\"],\"GDvlUT\":[\"Ruolo\"],\"GXsAby\":[\"Revoke\"],\"GYv20o\":[\"Impossibile aggiornare i permessi\"],\"Gd7sEW\":[\"Link personalizzato dell'area di lavoro\"],\"GnRmu4\":[\"Nome della checklist\"],\"GnSSGm\":[\"La descrizione della tua area di lavoro Ã¨ stata aggiornata.\"],\"GoDLB9\":[\"Il tuo account Ã¨ stato eliminato.\"],\"Gxxi5J\":[\"Aggiungi checklist\"],\"H5G+qG\":[\"Qual Ã¨ la differenza tra Kan e Trello?\"],\"HBI6nY\":[\"Hai bisogno di aiuto?\"],\"HO+uOC\":[\"Smistamento\"],\"HVIzNO\":[\"PuÃ² visualizzare liste\"],\"HYV6Lq\":[\"Impossibile accettare l'invito. Riprova piÃ¹ tardi o contatta l'assistenza clienti.\"],\"HeFWjW\":[\"Prossimi passi\"],\"Hg1qE9\":[\"Lo slug della tua area di lavoro Ã¨ stato aggiornato.\"],\"I+AROe\":[\"PuÃ² modificare schede\"],\"I0gAKM\":[\"Impossibile aggiornare la lista\"],\"IDvohQ\":[\"ha segnato un elemento della checklist come incompleto\"],\"IFgUX6\":[\"PuÃ² rimuovere membri\"],\"IelE1h\":[\"Passa a Pro\"],\"IqjpYe\":[\"VisibilitÃ  email\"],\"IrZaAn\":[\"Password modificata\"],\"J/hVSQ\":[[\"0\"]],\"J2Wbjt\":[\"Continua con \"],\"J5nbej\":[\"Critico\"],\"J5pbP6\":[\"PuÃ² modificare ruoli e permessi dei membri\"],\"JArWcF\":[[\"0\"],\" | \",[\"1\"]],\"JCdzgZ\":[\"Richiesta funzionalitÃ \"],\"JUce1S\":[\"Assegnatari\"],\"JbXXUW\":[\"Tieni presente che questa azione Ã¨ irreversibile.\"],\"JcCDm9\":[\"Template creato\"],\"Jgaz7E\":[\"Permessi ripristinati\"],\"JlFcis\":[\"Send\"],\"JnWJXY\":[\"link magico\"],\"JxhWxU\":[\"in\"],\"JyXBgS\":[\"documenti\"],\"K3iLeO\":[\"Scopri cosa dicono i nostri utenti su Kan\"],\"KAsRdK\":[\"Vai ai membri\"],\"KFJgmZ\":[\"Il nome visualizzato deve contenere almeno 3 caratteri\"],\"KLJ4eD\":[\"Link di invito copiato\"],\"KNKCTb\":[\"Backlog\"],\"KiVc+q\":[\"Tempo pieno\"],\"KuSt9W\":[\"Come posso effettuare il self-hosting?\"],\"L5ZPjz\":[\"ha aggiornato un elemento della checklist\"],\"LTGE7Y\":[\"Spazio di lavoro creato con successo. Puoi effettuare l'aggiornamento piÃ¹ tardi nelle impostazioni.\"],\"LeM5RY\":[\"Impossibile cancellare le sostituzioni\"],\"LoUCpj\":[\"Errore durante l'aggiornamento del nome dell'area di lavoro\"],\"LqWW5F\":[\"Il tuo nome visualizzato Ã¨ stato aggiornato.\"],\"LrcnbT\":[\"Ospita Kan sulla tua infrastruttura. Ideale per organizzazioni che necessitano di controllo completo sui propri dati.\"],\"Ls++vT\":[\"Veloce & leggero\"],\"Lt+ZP3\":[\"ha completato un elemento della checklist\"],\"M43OaK\":[\"Upgrade to Team Plan\"],\"M9p3Vw\":[\"Registro attivitÃ  illimitato\"],\"MFKlMB\":[\"Invita\"],\"MHrjPM\":[\"Titolo\"],\"MI5OBT\":[\"L'URL puÃ² contenere solo lettere, numeri e trattini\"],\"MK16u2\":[\"Nessuna data\"],\"MKAScN\":[\"PuÃ² visualizzare bacheche\"],\"MN6YzG\":[\"Slug dell'area di lavoro aggiornato\"],\"MWrbWq\":[\"Impostazioni | Account\"],\"MdN5zD\":[\"Devi essere un amministratore per gestire i permessi del workspace.\"],\"MdwUGG\":[\"Risparmia tempo con modelli di bacheca riutilizzabili.\"],\"MeO/vH\":[\"Questo comporterÃ  l'eliminazione permanente di tutti i dati associati a questo spazio di lavoro.\"],\"MlyjJu\":[\"Il nome visualizzato non puÃ² superare i 280 caratteri\"],\"MxQXhL\":[\"Impossibile creare lo spazio di lavoro\"],\"N/bcWA\":[\"Login | kan.bn\"],\"N3380t\":[\"PuÃ² creare bacheche\"],\"N7aud6\":[\"Ricerca intelligente\"],\"NH54UR\":[\"ha rinominato l'elemento della checklist in <0>\",[\"0\"],\"</0>\"],\"NgaR6B\":[\"Inserisci la tua password\"],\"NypLoL\":[\"ha rinominato una checklist\"],\"O0li0W\":[\"Inserisci la tua password attuale e scegli una nuova password sicura.\"],\"O1wAlQ\":[\"Ospite\"],\"O3oNi5\":[\"Email\"],\"O83K21\":[\"ha aggiunto un elemento alla checklist\"],\"O9jVbx\":[\"Bassa prioritÃ \"],\"OAYToL\":[\"Questo rimuoverÃ  tutti i permessi personalizzati dei membri in questo spazio di lavoro. I membri erediteranno i permessi solo dai loro ruoli.\"],\"OIA0ad\":[\"Nome dello spazio di lavoro aggiornato\"],\"OZtEcz\":[\"API\"],\"OpNhRn\":[\"Nessuna carta di credito richiesta\"],\"OtjenF\":[\"Inserisci un indirizzo email valido\"],\"OvoEq7\":[\"Membro\"],\"Ozt2vv\":[\"La tua password Ã¨ stata modificata.\"],\"P6dJdq\":[\"Sostituzioni cancellate\"],\"P8bryV\":[\"New Ticket, Triaging, In Progress, Awaiting Customer, Resolution, Done\"],\"PCIlOO\":[\"Aggiungi membro\"],\"PRjvDT\":[\"Sei sicuro di voler eliminare questo commento?\"],\"PRofO0\":[\"Modifica video YouTube\"],\"PTzsxH\":[\"VisibilitÃ  della bacheca aggiornata\"],\"PZCqeW\":[\"Riprova piÃ¹ tardi.\"],\"Pa9/o1\":[\"Create API keys to access the Kan API.\"],\"PpZkda\":[\"FunzionalitÃ \"],\"PyYD/v\":[\"ha assegnato <0>\",[\"0\"],\"</0> alla scheda\"],\"Q9pQaX\":[\"Nessun ruolo trovato per questo spazio di lavoro.\"],\"QD8opX\":[\"Bacheca\"],\"QHhZeE\":[\"Template creato con successo\"],\"QNtP5M\":[\"Usa template\"],\"Qh7QmR\":[\"Rimosso dai preferiti\"],\"QtACvI\":[\"Crea etichetta\"],\"Qtzfdk\":[\"Piano Pro âˆ\"],\"R+w/Va\":[\"Fatturazione\"],\"R1c3Mq\":[\"Il nome della bacheca Ã¨ obbligatorio\"],\"R275Pz\":[\"Hai posti illimitati con il tuo Piano Pro. Non ci sono costi aggiuntivi per i nuovi membri!\"],\"R3FsF4\":[\"Download fallito\"],\"R6pB8R\":[\"Metti una stella su Github\"],\"RHZu7R\":[\"Amato dai team di tutto il mondo\"],\"RJA+sg\":[\"Nuovo ticket\"],\"RRn9jf\":[\"Clicca sul link che abbiamo inviato a \",[\"magicLinkRecipient\"],\" per accedere.\"],\"RSGOS1\":[\"PuÃ² eliminare liste\"],\"RfgJqw\":[\"ha aggiornato la data di scadenza\"],\"RkXlPZ\":[\"GitHub\"],\"RoafuO\":[\"Invia feedback\"],\"RtlIYB\":[\"Stai per cambiare la tua password.\"],\"SFnH1j\":[\"PerchÃ© creare un Trello open source?\"],\"SKqXzW\":[\"added label <0>\",[\"label\"],\"</0>\"],\"SMaFdc\":[\"Annulla iscrizione\"],\"SNfg0e\":[\"PuÃ² visualizzare lo spazio di lavoro\"],\"SPLN9O\":[\"Possiedi i tuoi dati\"],\"STSYcd\":[\"PuÃ² eliminare commenti\"],\"SWEskc\":[\"L'URL deve contenere almeno 3 caratteri\"],\"Sb2gYF\":[\"Nuova lista\"],\"ScJ9fj\":[\"Informativa sulla privacy\"],\"Se/UIp\":[\"Da fare\"],\"SkCNhl\":[\"Cerca bacheche e schede...\"],\"SlfejT\":[\"Errore\"],\"T/pF0Z\":[\"Rimuovi dai preferiti\"],\"T21jY/\":[\"ha aggiunto un'etichetta alla carta\"],\"T7DJ2k\":[\"Impossibile aggiungere il commento\"],\"T7LJic\":[\"ha spostato la scheda in un'altra lista\"],\"T7Mywq\":[\"Impossibile aggiornare la bacheca\"],\"TCOMOO\":[\"Modifica permessi\"],\"TFv5tM\":[\"Impossibile aggiornare il ruolo\"],\"TH3Irz\":[\"Permesso\"],\"TKFUnX\":[\"Account eliminato\"],\"TXO5TM\":[\"Nessuna scorciatoia da tastiera registrata.\"],\"TYli1B\":[\"PuÃ² modificare commenti\"],\"TbjyhA\":[\"Documenti\"],\"TcXcmk\":[\"Revisione del codice\"],\"TjREUS\":[\"Nuova chiave API\"],\"TmvrjU\":[\"L'URL della bacheca deve contenere almeno 3 caratteri\"],\"TvY/XA\":[\"Documentazione\"],\"Tz0i8g\":[\"Impostazioni\"],\"TztLaN\":[\"Impossibile creare la lista\"],\"U3pytU\":[\"Amministratore\"],\"U5dMR6\":[\"Visualizza spazio di lavoro\"],\"UCLeG0\":[\"Termini di servizio\"],\"UQbwrz\":[\"Tutti i sistemi operativi\"],\"URAE3q\":[\"In pausa\"],\"USVCGU\":[\"Errore durante la disattivazione del link di invito\"],\"UbRKMZ\":[\"In attesa\"],\"UbYdrA\":[\"Frequenza di pagamento\"],\"UeDFpo\":[\"Come viene finanziato il progetto?\"],\"UlhdTP\":[\"Spazio di lavoro eliminato\"],\"Un80BR\":[\"Amici OSS\"],\"UveK6V\":[\"Vai all'app\"],\"Uworke\":[\"Part-time\"],\"UxKoFf\":[\"Navigazione\"],\"V3MPSQ\":[\"ha aggiornato il titolo\"],\"V8YWP3\":[\"Inserisci un titolo personalizzato\"],\"VHS0aJ\":[\"Cancellare tutti i permessi personalizzati?\"],\"VKoDQD\":[\"Crea nuovo \",[\"0\"]],\"VUZDlr\":[\"Testimonianze\"],\"VXk54Y\":[\"si Ã¨ auto-assegnato la scheda\"],\"VbyRUy\":[\"Commenti\"],\"VhMDMg\":[\"Cambia password\"],\"Vt50G1\":[\"Kanban base\"],\"W/Elkg\":[\"Media prioritÃ \"],\"W/nQk1\":[\"Piano gratuito\"],\"W5r8Qh\":[\"ha eliminato un elemento della checklist\"],\"W8oT+L\":[\"Impossibile recuperare le informazioni del video\"],\"WHHLh9\":[\"Impossibile eliminare l'allegato\"],\"WI4eGo\":[\"Come posso ottenere un URL personalizzato?\"],\"WQPDcG\":[\"Impossibile aggiornare l'elemento della checklist\"],\"WRkpB1\":[\"Registrazione disabilitata\"],\"WRsbHO\":[\"Il tuo account Trello Ã¨ connesso.\"],\"WYDptz\":[\"Abbonamento richiesto\"],\"WYwN1G\":[\"Nuova importazione\"],\"WbTDwg\":[\"In corso\"],\"Weq9zb\":[\"Generale\"],\"WmPhYW\":[\"Si Ã¨ verificato un errore durante la disconnessione del tuo account Trello.\"],\"WnEwDO\":[\"Hai giÃ  un account? <0><1>Accedi</1></0>\"],\"Wy6pcF\":[\"Impossibile aggiornare la visibilitÃ  della bacheca\"],\"X0N0PA\":[\" (modificato)\"],\"XDRXbZ\":[\"La descrizione dell'area di lavoro deve contenere almeno 3 caratteri\"],\"XILg0L\":[\"Indirizzo email non valido\"],\"XJOV1Y\":[\"AttivitÃ \"],\"XTKtey\":[\"Crea lista\"],\"XXbgHS\":[\"Assunto\"],\"XYLcNv\":[\"Supporto\"],\"XicmhT\":[\"Data di scadenza\"],\"Xid3K6\":[\"L'URL della bacheca puÃ² contenere solo lettere, numeri e trattini\"],\"Xjj/kS\":[\"Kanban reinventato\"],\"XpcjLO\":[\"Impossibile aggiornare l'URL della bacheca\"],\"XyuOHa\":[\"Condivisione bacheca & inviti\"],\"YBBifR\":[\"Disconnetti Trello\"],\"YKeYae\":[\"Impossibile riordinare elemento della checklist\"],\"YQqv2e\":[\"Get started by creating a new board\"],\"YVT40D\":[\"ha rimosso l'etichetta <0>\",[\"0\"],\"</0>\"],\"YaZDYI\":[\"Errore nell'aggiornamento dell'abbonamento\"],\"YcyP2z\":[\"Impossibile creare il template\"],\"Yf9FAx\":[\"Non potranno accedere a questo spazio di lavoro.\"],\"YhvWXb\":[\"Analisi della bacheca\"],\"YirHq7\":[\"Feedback\"],\"YoyKbT\":[\"Questa chiave API verrÃ  mostrata una sola volta. Salvala in un luogo sicuro.\"],\"YtUfwW\":[\"Accesso con \",[\"0\"],\" fallito. Riprova.\"],\"Z3FXyt\":[\"Caricamento in corso...\"],\"Z3krJD\":[\"Consenti ai membri dello spazio di lavoro di vedere gli indirizzi email degli altri\"],\"Z6r9z1\":[\"Impossibile eliminare la scheda\"],\"Z7/Xyy\":[\"Applicants, Screening, Interviewing, Offer, Onboarding, Hired\"],\"ZDGm40\":[\"Elimina account\"],\"ZDIydz\":[\"Inizia ora\"],\"ZDo4HN\":[\"Brainstorming\"],\"ZH7TVS\":[\"Titolo della carta\"],\"ZL1A+p\":[\"Impossibile caricare l'allegato. Riprova.\"],\"ZT4Khw\":[\"Sei sicuro di voler eliminare questa carta?\"],\"ZU5IYI\":[\"Bacheche illimitate, liste illimitate, schede illimitate. Nessuna carta di credito richiesta.\"],\"ZXSPJt\":[\"Si Ã¨ verificato un errore imprevisto. Riprova piÃ¹ tardi.\"],\"ZqDqbi\":[\"Organizza e trova le schede rapidamente con potenti strumenti di filtraggio.\"],\"Zz1qkk\":[\"Schede illimitate\"],\"aHCEmh\":[\"Prezzi\"],\"aHRWVI\":[\"ha rimosso la data di scadenza\"],\"aJ4pMe\":[\"FAQ\"],\"aWDhU5\":[\"Kanban Ã¨ migliore con un team. Perfetto per piccoli team in crescita che cercano di collaborare.\"],\"aWlSc/\":[\"Crea nuova lista\"],\"abUZlY\":[\"Aggiungi dettagli...\"],\"aelko+\":[\"Puoi ottenere un URL personalizzato per il tuo workspace, come <0>kan.bn/kan</0>, accedendo alle tue <1>impostazioni del workspace</1> e acquistando un abbonamento pro. Tutti gli abbonamenti contribuiscono a finanziare lo sviluppo del progetto!\"],\"aiHZVP\":[\"Visualizza documenti\"],\"aj40Mw\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users (free during the beta) and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"b/LfJo\":[\"email\"],\"b3Thhd\":[\"Caricamento fallito\"],\"b5FKyH\":[\"ha aggiunto l'etichetta <0>\",[\"0\"],\"</0>\"],\"b9XOHo\":[\"Crea \",[\"0\"]],\"bA2LQS\":[\"Dettaglio funzionalitÃ \"],\"bD8I7O\":[\"Completato\"],\"bDI6VI\":[[\"0\"],\" Ã¨ stato rimosso dai tuoi preferiti.\"],\"bJZm1W\":[\"Candidati\"],\"bJtM0P\":[\"Questo URL dello spazio di lavoro Ã¨ riservato\"],\"bZSICm\":[\"Impossibile aggiungere l'elemento della checklist\"],\"bcIybO\":[\"Il nome dello spazio di lavoro Ã¨ obbligatorio\"],\"bdztP2\":[\"Ricerca\"],\"bfZE+Y\":[\"Il ruolo del membro Ã¨ stato aggiornato.\"],\"bff61F\":[\"Piano Team\"],\"bfgr/e\":[\"Domanda\"],\"bgh/9n\":[\"puÃ² gestire le impostazioni dello spazio di lavoro\"],\"bmXKoX\":[\"ha aggiunto \",[\"0\"],\" etichette: <0>\",[\"labelList\"],\"</0>\"],\"bqAQaT\":[\"Errore durante l'eliminazione dell'account\"],\"c/IAuR\":[\"Importante\"],\"c3b0B0\":[\"Inizia ora\"],\"c9AJhn\":[\"Unisciti allo spazio di lavoro\"],\"cAgBMh\":[\"Controllo e proprietÃ  completi:\"],\"cFQEU/\":[\"Apri scorciatoie da tastiera\"],\"cOh+MI\":[\"Selezione\"],\"cWcxrL\":[\"Nuova checklist\"],\"cWtfn1\":[\"Passa a Pro ($29/mese)\"],\"chyf4J\":[\"Descrizione dello spazio di lavoro\"],\"cji2nM\":[\"Errore durante la creazione del link di invito\"],\"cnGeoo\":[\"Elimina\"],\"cp1rsD\":[\"Disattiva link di invito\"],\"csFbe+\":[\"Vai ai modelli\"],\"curoK5\":[\"Nuovo spazio di lavoro\"],\"d33Usy\":[\"Crea checklist\"],\"d7XqZJ\":[\"A powerful, flexible kanban app that helps you organise work,\\n              track progress, and deliver resultsâ€”all in one place.\"],\"dEgA5A\":[\"Annulla\"],\"dUh9QW\":[\"Pianificazione\"],\"ddrz1m\":[\"In ritardo\"],\"delOXn\":[\"Impossibile aggiornare le etichette\"],\"dgr4Kq\":[\"Modifica etichetta\"],\"dmKdk0\":[\"Una volta eliminata l'area di lavoro, non si puÃ² tornare indietro. Questa azione non puÃ² essere annullata.\"],\"dsLT3m\":[\"Crea carta\"],\"dtbpdR\":[\"Trello\"],\"duf3Nr\":[\"Questo URL dello spazio di lavoro Ã¨ giÃ  stato utilizzato\"],\"e12o5C\":[\"Invite another\"],\"e4hPSt\":[\"Ripristina ai valori predefiniti del ruolo\"],\"eEQyz+\":[\"Tieni traccia di tutte le modifiche alle schede con una cronologia dettagliata delle attivitÃ .\"],\"ePK91l\":[\"Modifica\"],\"eZCGbT\":[\"SÃ¬, offriamo un piano gratuito per sempre per uso individuale. Nessuna restrizione, nessun paywall, nessun limite.\"],\"edWbV6\":[\"Link copiato\"],\"en3oy5\":[\"FunzionalitÃ \"],\"evg7+A\":[\"Le tue bacheche sono state importate.\"],\"evj0lK\":[\"Offrite un piano gratuito?\"],\"f8fH8W\":[\"Design\"],\"f8lDFq\":[\"ha creato la carta\"],\"fEY2vP\":[\"Carta non trovata\"],\"fJxqi6\":[\"Custom URLs require Pro plan ($29/month)\"],\"fQCrjt\":[\"La visibilitÃ  della tua bacheca Ã¨ stata impostata su \",[\"0\"],\".\"],\"fR9laE\":[\"Inserisci la tua password attuale\"],\"fSf2ee\":[\"Visualizza la nostra roadmap.\"],\"fYVH36\":[\"Impossibile aggiornare il commento\"],\"fvLNDy\":[\"Nessuna lista Ã¨ stata ancora creata\"],\"fziA2d\":[\"Commenti illimitati\"],\"g2xBxu\":[\"Importare le tue bacheche Trello in Kan Ã¨ facile. Puoi seguire la nostra guida passo-passo <0>qui</0>.\"],\"gGx5tM\":[\"Modifica\"],\"gL/7jw\":[\"Aggiungi descrizione... (digita '/' per aprire i comandi o '@' per menzionare)\"],\"gUX7b+\":[\"L'alternativa open source <0/> a Trello\"],\"gZxH/p\":[\"ha cambiato la data di scadenza a <0>\",[\"formattedDate\"],\"</0>\"],\"ghSJ4U\":[\"Il nome dello spazio di lavoro non puÃ² superare i 64 caratteri\"],\"gkzAEM\":[\"Continua con \",[\"0\"]],\"goklcJ\":[\"Colloquio\"],\"gpfJ3v\":[\"Gratuito, per sempre\"],\"gukxZ5\":[\"Inserimento\"],\"gv5kbo\":[\"L'URL della bacheca non puÃ² superare i 60 caratteri\"],\"h16FyT\":[\"Liste\"],\"h2FKMV\":[\"Non hai i permessi\"],\"h4VV67\":[\"ha aggiunto una checklist\"],\"h7MgpO\":[\"Scorciatoie da tastiera\"],\"h8DugX\":[\"Etichette\"],\"hAMddS\":[\"si Ã¨ rimosso dall'assegnazione della scheda\"],\"hXMFoN\":[\"Nessuna lista\"],\"hYzsXr\":[\"Impostazioni | Integrazioni\"],\"hh61gL\":[\"Importa da Trello\"],\"iFxrHK\":[\"Find answers to common questions about the project. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"iHcdea\":[\"Scade la prossima settimana\"],\"iLbjv+\":[\"PuÃ² modificare lo spazio di lavoro\"],\"iQmbPb\":[\"Licenza\"],\"iTylMl\":[\"Template\"],\"iVIGZb\":[\"Allegato caricato\"],\"isRobC\":[\"Nuovo\"],\"iwr7AP\":[\"Idee\"],\"iy1wb+\":[\"Impostazioni | API\"],\"j2+d/o\":[\"Riferimento API\"],\"j9IZZ0\":[\"URL personalizzato dell'area di lavoro\"],\"jDRt4n\":[\"Vuoi annullare l'iscrizione?\"],\"jL82rC\":[\"Cancella permessi personalizzati\"],\"jNuzV/\":[\"PuÃ² eliminare schede\"],\"jQ6I8X\":[\"Ruolo aggiornato\"],\"jZBHkN\":[\"Il nome dello spazio di lavoro deve contenere almeno 3 caratteri\"],\"jfC/xh\":[\"Contatti\"],\"jkbHit\":[\"around the world\"],\"jl3aEJ\":[\"ha segnato l'elemento <0>\",[\"0\"],\"</0> della checklist come incompleto\"],\"jlB2RY\":[\"La password attuale inserita non Ã¨ corretta.\"],\"jwI32v\":[\"Bacheca non trovata\"],\"kECVpo\":[\"Sei sicuro di voler eliminare questa etichetta?\"],\"kQwvU8\":[\"ha rimosso un'etichetta dalla scheda\"],\"kSxwQL\":[\"Puoi invitare i membri del team cliccando sul pulsante \\\"Invita\\\" nell'angolo in alto a destra della <0>pagina dei membri</0> e inserendo il loro indirizzo email. Riceveranno un'email con un link per unirsi al workspace.\"],\"kYu0eF\":[\"Elimina spazio di lavoro\"],\"kfOGMr\":[\"Vittoria rapida\"],\"klpSmb\":[\"Modifica URL dell'area di lavoro\"],\"kp6L3T\":[\"Questo nome utente dell'area di lavoro Ã¨ giÃ  stato utilizzato\"],\"kryGs+\":[\"Carta\"],\"kuoc68\":[\"$10/mese\"],\"kwkhPe\":[\"Upgrade\"],\"kxEs5t\":[\"Importazioni da Trello\"],\"l2PIAy\":[\"Self host con Github\"],\"l31EoQ\":[\"Trova risposte alle domande comuni su Kan. Non trovi quello che stai cercando? Non esitare a <0>contattarci</0>.\"],\"l3s5ri\":[\"Importa\"],\"l4asa1\":[\"Questa bacheca Ã¨ privata o non esiste\"],\"lGjicL\":[\", o consulta i nostri\"],\"lKAvEd\":[\"Errore durante la disconnessione da Trello\"],\"lSNkXg\":[\"All seats are free during the beta until Sept 1st!\"],\"lXvXNI\":[\"Impossibile copiare il link di invito\"],\"lYT7pQ\":[\"Elimina lista\"],\"lcokBr\":[\"Di proprietÃ  di Atlassian\"],\"lkz85l\":[\"La principale differenza tra Kan e Trello Ã¨ che Kan Ã¨ open source, permettendo a chiunque di visualizzare, modificare e contribuire al nostro codice. La nostra offerta cloud non impone inoltre alcuna restrizione sulle funzionalitÃ  per uso individuale, mentre Trello blocca funzionalitÃ  di base come il numero di bacheche che puoi creare dietro un paywall.\"],\"lo8xBK\":[\"Sei sicuro di voler rimuovere \",[\"entityLabel\"],\"?\"],\"lpIMne\":[\"Le password non corrispondono\"],\"lsgnzd\":[\"Errore durante l'aggiornamento a Pro\"],\"lyqwgn\":[\"Aggiungi etichetta\"],\"m2nk0i\":[\"Prezzi semplici\"],\"mErq7F\":[\"Registrati\"],\"mHhffx\":[\"Impossibile creare la checklist\"],\"mTGd3+\":[\"ha eliminato una checklist\"],\"mTwGOf\":[\"Questo link di invito non Ã¨ valido o Ã¨ scaduto.\"],\"mU+M00\":[[\"0\"],\" Ã¨ stato aggiunto ai tuoi preferiti.\"],\"mVZH9V\":[\"Quando Trello fu lanciato nel 2011, lasciÃ² tutti a bocca aperta con la sua semplicitÃ  attentamente progettata, ma nel corso degli anni ha perso la sua magia e si Ã¨ trasformato in qualcosa di piÃ¹ simile a \\\"Jira Lite\\\". Questo progetto Ã¨ il nostro tentativo di recuperare la magia originale della semplicitÃ  di Trello, in open source.\"],\"mZGPxt\":[\"Link di invito copiato negli appunti\"],\"mchgzf\":[\"Ti sei registrato con successo.\"],\"mgXgHu\":[\"Vai alle bacheche\"],\"mwBdZ2\":[\"Questo comporterÃ  l'eliminazione permanente di tutti i dati associati al tuo account.\"],\"mx8+1u\":[\"Membri illimitati\"],\"n+xLOH\":[\"Assistenza clienti\"],\"n1GRql\":[\"Nuova etichetta\"],\"n1ekoW\":[\"Accedi\"],\"n9V+ps\":[\"Inserisci il tuo nome\"],\"nOhz3x\":[\"Esci\"],\"nabda1\":[\"Elimina carta\"],\"nbfdhU\":[\"Integrazioni\"],\"nhMhRr\":[\"Grazie per il tuo feedback!\"],\"njJFtc\":[\"Elimina commento\"],\"nk7caK\":[\"Connetti Trello\"],\"nol/Fb\":[\"Come posso invitare i membri del team?\"],\"notwF1\":[\"Il nome del template non puÃ² superare i 100 caratteri\"],\"nq7q3Z\":[\"Il nome della chiave API non puÃ² superare i 30 caratteri\"],\"nqdIhs\":[\"Template personalizzati per bacheca\"],\"nryrgW\":[\"Tutte le sostituzioni dei permessi dei membri sono state ripristinate ai valori predefiniti del loro ruolo.\"],\"nxb+xc\":[\"unassigned <0>\",[\"memberName\"],\"</0> from the card\"],\"o+JCfN\":[\"Team dinamici di tutto il mondo<0/>si fidano di noi\"],\"o7J4JM\":[\"Filtra\"],\"o9WLwO\":[\"Impossibile aggiornare la scheda\"],\"oBndex\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"oVBq1w\":[\"per utente/mese\"],\"oW13KZ\":[\"Inizia gratuitamente oggi\"],\"oXpmwC\":[\"Self-hostable\"],\"odFCYX\":[\"Invito non valido\"],\"ohktr7\":[\"Commenti & menzioni\"],\"okpxfB\":[\"Crea nuova chiave\"],\"oyRjD/\":[\"Piano Pro\"],\"p/hk9N\":[\"Hai effettuato l'accesso con successo.\"],\"pBsoKL\":[\"Aggiungi ai preferiti\"],\"pFGfsR\":[\"Dai un'occhiata ad alcuni dei nostri progetti open source preferiti.\"],\"pFKC6A\":[\"Nome chiave API\"],\"pL78ec\":[\"Aggiunto ai preferiti\"],\"pXVFJy\":[\"PuÃ² eliminare bacheche\"],\"pa9o5D\":[\"Ritaglia il tuo avatar\"],\"pfa8F0\":[\"Nome visualizzato\"],\"pmUArF\":[\"Spazio di lavoro\"],\"pnrmSP\":[\"Nuova carta\"],\"poDo/D\":[\"Create new board\"],\"ppaRWv\":[\"Self Host\"],\"pvnfJD\":[\"Scuro\"],\"q+lt9D\":[\"Errore durante l'eliminazione dell'etichetta\"],\"qPP4lD\":[\"L'invito di membri richiede un Piano Team. Sarai reindirizzato per aggiornare il tuo spazio di lavoro.\"],\"qQXocp\":[\"PuÃ² gestire le impostazioni dello spazio di lavoro\"],\"qfUS/w\":[\"Amici Open Source\"],\"qkjvgj\":[\"Il tuo spazio di lavoro Ã¨ stato eliminato.\"],\"qlAIQ1\":[\"Remoto\"],\"qrT8WB\":[\"#1 Hacker News\"],\"qtE5nt\":[\"Aggiungi un elemento...\"],\"qzdST2\":[\"VisibilitÃ  bacheca\"],\"r6BgwX\":[\"La password Ã¨ necessaria per accedere.\"],\"rD6UIt\":[\"Inizia su Cloud\"],\"rF8SEQ\":[\"Modifica commento\"],\"rRM7r0\":[\"Importa le tue bacheche Trello e parti subito.\"],\"rYUZIe\":[\"Seleziona fonte\"],\"raHesj\":[\"La tua iscrizione Ã¨ stata annullata!\"],\"rarRW/\":[\"Errore durante l'invito del membro\"],\"ri1hHe\":[\"Scade il mese prossimo\"],\"rmN315\":[\"Divertimento\"],\"rs7L54\":[\"ha aggiunto un membro alla carta\"],\"rtbVvN\":[\"PuÃ² modificare liste\"],\"s+MGs7\":[\"Risorse\"],\"s6iE/c\":[\"La registrazione Ã¨ attualmente disabilitata. Riprova piÃ¹ tardi.\"],\"sBhOFG\":[\"Gestione delle attivitÃ  semplice e visuale che funziona. Trascina e rilascia le schede, collabora con il tuo team e ottieni di piÃ¹.\"],\"sDLCvT\":[\"Connetti i tuoi strumenti preferiti per semplificare il tuo flusso di lavoro.\"],\"sDuhfK\":[\"Offerta di lancio: posti illimitati a soli $29/mese con Pro\"],\"sUZo7y\":[\"Registrati | kan.bn\"],\"sVBn4K\":[\"Errore durante l'aggiornamento del nome visualizzato\"],\"sY2lzr\":[\"Nessun URL di download disponibile per questo allegato.\"],\"seaklU\":[\"Boards | \",[\"0\"]],\"t+R8+P\":[\"Esecuzione\"],\"t/YqKh\":[\"Rimuovi\"],\"t2nDzl\":[\"Visualizza e gestisci la tua fatturazione e abbonamento.\"],\"t6FvJH\":[\"PuÃ² aggiungere commenti\"],\"tGwwnq\":[\"ha aggiornato la descrizione\"],\"tHcbLF\":[\"PuÃ² modificare bacheche\"],\"tHjBUm\":[\"Kan\"],\"tIdipJ\":[\"Modifica URL della bacheca\"],\"tMYIu7\":[\"Registri attivitÃ \"],\"tTbref\":[\"La password Ã¨ necessaria per registrarsi.\"],\"tYN21H\":[\"L'utente Ã¨ giÃ  membro di questo spazio di lavoro\"],\"tca56/\":[\"Il tuo file Ã¨ stato caricato con successo.\"],\"tfDRzk\":[\"Salva\"],\"tmlJN1\":[\"Inserisci un URL YouTube valido\"],\"tmpW+w\":[\"Elimina bacheca\"],\"tyHiOa\":[\"Riprova piÃ¹ tardi o contatta l'assistenza clienti.\"],\"u2+JIh\":[\"Gli URL personalizzati richiedono l'aggiornamento a un piano Pro\"],\"u8JHrO\":[\"Cancella filtri\"],\"uOqaMC\":[\"Sei stato invitato a unirti a uno spazio di lavoro.\"],\"uXGLuq\":[\"Crea chiave API\"],\"uZg2+w\":[\"Potenzia la tua area di lavoro per soli $29/mese. Ecco cosa otterrai:\"],\"uck1tz\":[\"ha rimosso un membro dalla scheda\"],\"usVytm\":[\"Una volta eliminato il tuo account, non si puÃ² tornare indietro. Questa azione non puÃ² essere annullata.\"],\"uwBBCy\":[\"Kan Ã¨ migliore con un team. Perfetto per piccoli team in crescita che cercano di collaborare.\"],\"v+Wp++\":[\"Open source\"],\"v3YoMA\":[\"Senior\"],\"vAR/I8\":[\"Esegui sulla tua infrastruttura\"],\"vAj6xG\":[\"Puoi effettuare il self-hosting seguendo le istruzioni nel nostro <0>repo</0>.\"],\"vMCCIc\":[\"L'URL non puÃ² superare i 24 caratteri\"],\"vSJd18\":[\"Video\"],\"vUr5JT\":[\"Non hai un account? <0><1>Registrati</1></0>\"],\"vXIe7J\":[\"Lingua\"],\"vXemf6\":[\"Bug\"],\"va/3u1\":[\"Controlla chi puÃ² visualizzare e modificare le tue bacheche.\"],\"vbskQn\":[\"Il nome della chiave API Ã¨ obbligatorio\"],\"veIDCY\":[\"Inizia la prova gratuita di 14 giorni\"],\"vfRdCZ\":[\"Impossibile ripristinare i permessi\"],\"vgdzLf\":[\"Crea un altro\"],\"vifyyw\":[\"Legale\"],\"vlxQFL\":[\"I permessi di questo membro sono stati ripristinati ai valori predefiniti del suo ruolo.\"],\"vneRvS\":[\"fatturazione mensile\"],\"vuxdLS\":[\"A lungo termine\"],\"vwGkYB\":[\"La password deve contenere almeno 8 caratteri\"],\"wIb7Ng\":[\"Sviluppo software\"],\"wIkTTk\":[\"Workspace name cannot exceed 24 characters\"],\"wM8xd8\":[\"Junior\"],\"wPZBpR\":[\"Seleziona un file da caricare.\"],\"wY+6Ye\":[\"Questo URL della bacheca Ã¨ giÃ  stato utilizzato\"],\"wakO3W\":[\"ha aggiunto la checklist <0>\",[\"0\"],\"</0>\"],\"wewm3j\":[\"Il nome della bacheca non puÃ² superare i 100 caratteri\"],\"wgNoIs\":[\"Seleziona tutto\"],\"wlQNTg\":[\"Membri\"],\"wqkcin\":[\"PuÃ² visualizzare commenti\"],\"wqxglO\":[\"Apprendimento\"],\"wruKPE\":[\"Sostieni lo sviluppo del progetto\"],\"wtxjAY\":[\"Membri del workspace\"],\"wzR1hC\":[\"Board name cannot exceed 50 characters\"],\"x0kMO/\":[\"Errore durante l'aggiornamento dell'URL dell'area di lavoro\"],\"x8GeCD\":[\"Nome visualizzato aggiornato\"],\"xEbBrW\":[\"Quale licenza state utilizzando?\"],\"xJO7ca\":[\"updated the title to <0>\",[\"toTitle\"],\"</0>\"],\"xMn+V9\":[\"Importazione da Trello\"],\"xRPn3U\":[\"Inserisci il tuo indirizzo email\"],\"xvcYhz\":[\"Cancella tutti i permessi personalizzati dei membri in modo che tutti i membri ereditino solo i permessi predefiniti del loro ruolo.\"],\"yCzSJ3\":[\"Aree di lavoro illimitate\"],\"yD3ZSw\":[\"Modifica le tue preferenze di lingua.\"],\"yH4aFo\":[\"Share invite link\"],\"yV7o5I\":[\"Come posso importare le mie bacheche Trello?\"],\"yb/fjw\":[\"Approvazione\"],\"yz7wBu\":[\"Chiudi\"],\"zC8Whw\":[\"Inizia creando una nuova lista\"],\"zDw80P\":[\"New board\"],\"zEGgv4\":[\"Confronta le nostre funzionalitÃ  per scoprire perchÃ© Kan Ã¨ la scelta migliore.\"],\"zERArS\":[\"ha aggiornato il titolo in <0>\",[\"0\"],\"</0>\"],\"zKY5xi\":[\"Crea link di invito\"],\"zLXwCk\":[\"my-workspace-name\"],\"zMjN8w\":[\"REST API\"],\"zMlxCA\":[\"1 utente\"],\"zQPhSa\":[\"Converti in link\"],\"zQX5Dj\":[\"Nome lista\"],\"zdMPUq\":[\"removed label <0>\",[\"label\"],\"</0>\"],\"zkWmBh\":[\"Annuale\"],\"zl1b97\":[\"Impossibile creare la scheda\"],\"zoEbXq\":[\"PuÃ² visualizzare schede\"],\"zto8aj\":[\"Trello disconnesso\"],\"zwBp5t\":[\"Privato\"],\"zwWKhA\":[\"Scopri di piÃ¹\"],\"zxKs+y\":[\"Scade domani\"],\"zzDlyQ\":[\"Operazione riuscita\"]}")as Messages;


================================================
FILE: apps/web/src/locales/nl/messages.ts
================================================
/*eslint-disable*/import type{Messages}from"@lingui/core";export const messages=JSON.parse("{\"++rVAm\":[\"Social media\"],\"+3TYXa\":[\"Voor duurzaamheid op lange termijn erkennen we dat alle goede open source projecten een inkomstenbron nodig hebben. De onze komt van de betaalde cloudoplossing voor werkruimtes met meerdere gebruikers en voor aangepaste werkruimte-slugs. Er is geen verplichting om het te gebruiken, en je kunt de software gratis op je eigen infrastructuur hosten.\"],\"+8Nek/\":[\"Maandelijks\"],\"+EkBs0\":[\"We konden je voorkeuren niet bijwerken. Probeer het opnieuw.\"],\"+MdEsf\":[\"Nieuw wachtwoord is vereist\"],\"+OhFss\":[\"Begin gratis, zonder gebruikslimieten. Voor samenwerking kun je upgraden naar een abonnement dat past bij de grootte van je team.\"],\"+VoTOr\":[\"maandelijks gefactureerd\"],\"+cilKj\":[\"Ideas, Research, Planning, Execution, Review, Next Steps, Complete\"],\"+djOzj\":[\"Lid uitnodigen\"],\"+nvZ6j\":[\"Labels & filters\"],\"/8pTF/\":[\"werkruimte-url\"],\"/Blkmk\":[\"Add description... (type '/' to open commands)\"],\"/DGOJs\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trelloâ€™s simplicity, in open source.\"],\"/K2CvV\":[\"Sjabloon\"],\"/asTmx\":[\"Bugrapport\"],\"/f3t6v\":[\"Configureer welke acties zijn toegestaan voor elke werkruimterol. Deze rechten gelden voor alle leden met die rol.\"],\"/gaSVU\":[\"Roadmap\"],\"/glL9Q\":[\"Geen \",[\"0\"]],\"/lDBHm\":[\"FAQ\"],\"/rn4RE\":[\"Een krachtige, flexibele kanban-app die je helpt werk te organiseren, voortgang bij te houden en resultaten te leverenâ€”allemaal op Ã©Ã©n plek.\"],\"/tOdd2\":[\"Je profielafbeelding is bijgewerkt.\"],\"0+0/3e\":[\"Maak nieuw label\"],\"0+ewPp\":[\"Verbetering\"],\"0KjpAr\":[\"Kan leden bekijken\"],\"0StR7t\":[\"Voer je nieuwe wachtwoord in\"],\"0dyOHD\":[\"Backlog, To Do, In Progress, Code Review, Done\"],\"0jV46i\":[\"Kan checklistitem niet verwijderen\"],\"0qyZ4b\":[\"Rechten laden...\"],\"0rPv1T\":[\"Profielafbeelding bijgewerkt\"],\"0xWkkH\":[[\"boardCount\",\"plural\",{\"one\":[\"Bord importeren (1)\"],\"other\":[\"Borden importeren (\",[\"boardCount\"],\")\"]}]],\"1/jlQw\":[\"Trusted by fast-moving teams\"],\"14Xi3Z\":[\"Het toevoegen van een nieuw lid kost een extra \",[\"price\"],\" (\",[\"billingType\"],\") per plaats.\"],\"1H5u1m\":[\"Vragen?\"],\"1HPFNH\":[\"Prijs per gebruiker/maand\"],\"1WuwiM\":[\"Ga naar instellingen\"],\"1ZVGyT\":[\"Voeg een reactie toe...\"],\"1hzdxO\":[\"Werkruimte machtigingen\"],\"1iShX0\":[\"Vervalt vandaag\"],\"1njn7W\":[\"Licht\"],\"1rVAfU\":[\"Meer activiteiten laden\"],\"1rWxEw\":[\"Wachten op klant\"],\"1sRmLC\":[\"Bespreek en werk samen aan kaarten.\"],\"1sSegR\":[\"Brainstorming, Writing, Editing, Design, Approval, Publishing, Done\"],\"1wCGT0\":[\"Onbeperkt aantal borden\"],\"25fAUC\":[\"Je uitschrijflink mist een token. Open de meest recente e-mail en probeer het opnieuw.\"],\"25mvI+\":[\"Uitnodigingslinks vereisen een Team- of Pro-abonnement. Upgrade je werkruimte.\"],\"29sSki\":[\"heeft checklistitem <0>\",[\"0\"],\"</0> voltooid\"],\"2BBAbc\":[\"Lijst\"],\"2Bu8xj\":[\"Geen borden gevonden\"],\"2M84k3\":[\"Aangepaste rechten\"],\"2MPcep\":[\"Import voltooid\"],\"2POOFK\":[\"Gratis\"],\"2Py5S/\":[\"Ik bevestig dat alle gegevens van de werkruimte permanent worden verwijderd en wil doorgaan.\"],\"2Q871c\":[\"Kan label niet toevoegen\"],\"2QGEbi\":[\"Kan opmerking niet verwijderen\"],\"2SePRT\":[\"Je bent uitgenodigd om deel te nemen aan een werkruimte op kan.bn.\"],\"2h4PVB\":[\"De naam van je werkruimte is bijgewerkt.\"],\"2liqDZ\":[\"Ik bevestig dat alle gegevens van mijn account permanent worden verwijderd en wil doorgaan.\"],\"2q/Q7x\":[\"Zichtbaarheid\"],\"2roTVj\":[\"Feedback verzonden\"],\"3LDCpD\":[\"Deze actie kan niet ongedaan worden gemaakt.\"],\"3ZjRJY\":[\"heeft checklist <0>\",[\"0\"],\"</0> hernoemd\"],\"3bqt9U\":[\"Iedereen met deze link kan deelnemen aan je werkruimte\"],\"3pIq39\":[\"Beheerdersrollen\"],\"479pdJ\":[\"Bevestig je nieuwe wachtwoord\"],\"4DOCMI\":[\"YouTube-URL\"],\"4RoY9J\":[\"Blogbericht\"],\"4XF0BB\":[\"Profielfoto\"],\"4gAX8s\":[\"Menu in-/uitschakelen\"],\"4ix5kl\":[\"Fout bij het bijwerken van profielafbeelding\"],\"4kJRen\":[\"Schrijven\"],\"4qu8Ec\":[\"14 dagen gratis proefperiode\"],\"53QYh8\":[\"Bord maken mislukt\"],\"55xJ/O\":[\"Fout bij wijzigen wachtwoord\"],\"58AiWX\":[\"Bevestig je nieuwe wachtwoord\"],\"5ACX4z\":[\"Nieuwsbrief\"],\"5IXWmO\":[\"Controleer je inbox\"],\"5P4rhH\":[\"Kan leden niet bijwerken\"],\"5eZwRW\":[\"Verbind je Trello-account om borden te importeren.\"],\"5h8ooz\":[\"API-sleutels\"],\"5iplxh\":[\"Nieuw wachtwoord moet verschillen van het huidige wachtwoord\"],\"5k0NLb\":[\"Beoordeling\"],\"5lWFkC\":[\"Inloggen\"],\"5wo3jF\":[\"Settings | \",[\"0\"]],\"69b7aE\":[\"Opdrachtmenu openen\"],\"6E4pW0\":[\"White label\"],\"6EWT6T\":[\"Werving\"],\"6FDocz\":[\"Registreren met \"],\"6FsGbN\":[\"Begin door een nieuwe \",[\"0\"],\" te maken\"],\"6OTo9n\":[\"Sjabloonnaam is verplicht\"],\"6S8zjx\":[\"https://www.youtube.com/watch?v=...\"],\"6WSYbN\":[\"Nieuwe \",[\"0\"]],\"6YtxFj\":[\"Naam\"],\"6mbe4b\":[\"Individuen\"],\"6tDFBe\":[\"De rechten van het lid zijn bijgewerkt.\"],\"6zeSBB\":[\"Kan kaarten aanmaken\"],\"74F7N/\":[\"Weet je zeker dat je je account wilt verwijderen?\"],\"7EhE4k\":[\"Label bijwerken\"],\"7L01XJ\":[\"Acties\"],\"7PzzBU\":[\"Gebruiker\"],\"7Ufoyg\":[\"Onbeperkt aantal lijsten\"],\"7b2yuC\":[\"Voer een geldig wachtwoord in\"],\"7d1a0d\":[\"Openbaar\"],\"7eMo+U\":[\"Naar startpagina\"],\"7hktsm\":[\"Aan de slag\"],\"7i8j3G\":[\"Bedrijf\"],\"8+BY11\":[\"Board URL gekopieerd naar klembord\"],\"86XI28\":[\"Bevestig je e-mailvoorkeuren:\"],\"8AbRER\":[\"Vervaldatum instellen\"],\"8Is1ih\":[\"Introductieaanbieding\"],\"8RdLDU\":[\"Persoonlijk project\"],\"8TveY+\":[\"Borden\"],\"8Z4pNX\":[\"Kan lijsten aanmaken\"],\"8ZoISG\":[\"Confirm URL change\"],\"8iP0S8\":[\"Alles in het gratis abonnement, plus:\"],\"8yFGGF\":[\"Kan lid niet verwijderen\"],\"91W07W\":[\"Custom URLs are a premium feature. You'll be directed to upgrade your account.\"],\"99VIgC\":[\"Lid verwijderen\"],\"9PaIxv\":[\"Kernfuncties\"],\"9QmxLI\":[\"Create board\"],\"9cDpsw\":[\"Rechten\"],\"9eF5oV\":[\"Welkom terug\"],\"9h7RDh\":[\"Aanbod\"],\"9s9O5h\":[\"Fout bij verwijderen werkruimte\"],\"9u5BOr\":[\"Leden | \",[\"0\"]],\"9wdpwp\":[\"Factureringsportaal\"],\"9x4DAL\":[[\"0\"],\" niet gevonden\"],\"9y1RcT\":[\"We zijn nog maar net begonnen. \"],\"A23Y7X\":[\"Deelnemen aan werkruimte | kan.bn\"],\"A5hiCy\":[\"Sjabloon maken\"],\"A8jqN7\":[\"Feedback kon niet worden verzonden\"],\"ABCjd9\":[\"Publiceren\"],\"ADEin1\":[\"Instellingen | Facturering\"],\"ALhEZV\":[\"Kan leden uitnodigen\"],\"ANyn0x\":[\"Alles wat je nodig hebt, voor altijd gratis. Onbeperkte borden, onbeperkte lijsten, onbeperkte kaarten. Upgrade wanneer je maar wilt.\"],\"ARvBT/\":[\"jaarlijks gefactureerd\"],\"ASjvm9\":[\"Werkruimte URL\"],\"AUYALh\":[\"Binnenkort beschikbaar\"],\"AX4ktp\":[\"Content creatie\"],\"AZI/wb\":[\"Labels & filters\"],\"AeXO77\":[\"Account\"],\"Ax/hYa\":[\"Werkruimtebeschrijving mag niet langer zijn dan 280 tekens\"],\"B3xxao\":[\"Voeg een kaart toe\"],\"BBUDfW\":[\"Urgent\"],\"BEVzjL\":[\"Import mislukt\"],\"BJbLe4\":[\"We gebruiken de <0>AGPL-3.0 licentie</0>.\"],\"BMkVQ3\":[\"heeft checklist <0>\",[\"0\"],\"</0> verwijderd\"],\"BOqTi5\":[\"heeft de kaart verplaatst van <0>\",[\"0\"],\"</0> naar<1>\",[\"1\"],\"</1>\"],\"BSZSHI\":[\"Board analytics (coming soon)\"],\"BZkYSt\":[[\"0\"],\" labels verwijderd: <0>\",[\"labelList\"],\"</0>\"],\"BhDZlc\":[\"Weet je zeker dat je de werkruimte \",[\"0\"],\" wilt verwijderen?\"],\"Bhgd0l\":[\"Neem contact op\"],\"Bosey8\":[\"Change the language of the app.\"],\"BzEFor\":[\"of\"],\"C56tim\":[\"Kan vervaldatum niet bijwerken\"],\"CAL6E9\":[\"Teams\"],\"CB/NpV\":[\"Hoge prioriteit\"],\"CHZ1jC\":[\"heeft checklistitem <0>\",[\"0\"],\"</0> verwijderd\"],\"CJ3zUq\":[\"Voer een geldige naam in\"],\"CJWDTP\":[\"Je Trello-account is ontkoppeld.\"],\"CJukzS\":[[\"0\"],\" labels\"],\"CTqTgr\":[\"Snelkoppelingen\"],\"CYWHT+\":[\"Fout bij het uploaden van profielafbeelding\"],\"Ci/KUX\":[\"Instellingen | Werkruimte\"],\"CkVV1t\":[\"Fout bij het bijwerken van werkruimtebeschrijving\"],\"Cmudpi\":[\"Kan werkruimte verwijderen\"],\"CozWO1\":[\"Naam werkruimte\"],\"D+NlUC\":[\"Systeem\"],\"D0esZz\":[\"Activiteitenlogboek\"],\"D3C4Yx\":[\"Huidig wachtwoord is vereist\"],\"D7/JvJ\":[\"Pas de vierkante uitsnede aan zodat je avatar goed past.\"],\"D9ROdV\":[\"Uitnodigingslinks\"],\"DAV3uK\":[\"Rechten bijgewerkt\"],\"DFjdv0\":[\"Sjabloon verwijderen\"],\"DMeWZD\":[\"Weet je zeker dat je deze \",[\"0\"],\" wilt verwijderen?\"],\"DPfwMq\":[\"Klaar\"],\"DahTzR\":[\"Kan checklist niet verwijderen\"],\"DbZgsJ\":[\"Sjabloon maken\"],\"DhLN1b\":[\"No boards\"],\"DtXlZq\":[\"Kan checklist niet bijwerken\"],\"E0t3jO\":[\"heeft checklistitem <0>\",[\"0\"],\"</0> toegevoegd\"],\"E8zYtd\":[\"<0>\",[\"0\"],\"</0> van de kaart verwijderd\"],\"ECJKc4\":[\"API-sleutel aangemaakt\"],\"EEHmPC\":[\"Lanceringsaanbieding: krijg onbeperkt aantal leden met Pro\"],\"EEQaqX\":[\"assigned <0>\",[\"memberName\"],\"</0> to the card\"],\"EH8IL3\":[\"Checklists\"],\"EM/caO\":[\"moved the card from <0>\",[\"fromList\"],\"</0> to<1>\",[\"toList\"],\"</1>\"],\"ERpq2P\":[\"Geen resultaten gevonden voor \\\"\",[\"debouncedQuery\"],\"\\\".\"],\"ESClHO\":[\"Prioriteit e-mailondersteuning\"],\"Eg99Sc\":[\"Er zijn momenteel geen authenticatiemethoden beschikbaar\"],\"EifmPY\":[\"To Do, In Progress, Done\"],\"Eit43O\":[\"heeft de vervaldatum ingesteld\"],\"EkH9pt\":[\"Bijwerken\"],\"EvArWh\":[\"Werk naadloos samen met je team.\"],\"F/FPk/\":[\"Instellingen | Rechten\"],\"F/Fhz0\":[\"Create Pro workspace\"],\"F/vB2g\":[\"IdeeÃ«n om deze pagina te verbeteren...\"],\"F3bW6y\":[\"Platform\"],\"F4KRmY\":[\"$8/maand\"],\"F4PLG4\":[\"Werkruimtebeschrijving bijgewerkt\"],\"F8DaWi\":[\"Alleen bekijken\"],\"FEr96N\":[\"Thema\"],\"FUltnF\":[\"Aangepaste sjablonen\"],\"FdtSNC\":[\"Werkruimte maken\"],\"FmN5me\":[\"Oplossing\"],\"FmfJjN\":[\"Bekijk en beheer je API-sleutels.\"],\"Fpci8b\":[\"Weet je zeker dat je deze checklist wilt verwijderen?\"],\"G1Gw0v\":[\"Nieuw sjabloon\"],\"GAD3Dx\":[\"Aangepast domein\"],\"GDvlUT\":[\"Rol\"],\"GXsAby\":[\"Revoke\"],\"GYv20o\":[\"Kan machtigingen niet bijwerken\"],\"Gd7sEW\":[\"Aangepaste werkruimtelink\"],\"GnRmu4\":[\"Naam checklist\"],\"GnSSGm\":[\"Je werkruimtebeschrijving is bijgewerkt.\"],\"GoDLB9\":[\"Je account is verwijderd.\"],\"Gxxi5J\":[\"Checklist toevoegen\"],\"H5G+qG\":[\"Wat is het verschil tussen Kan en Trello?\"],\"HBI6nY\":[\"Hulp nodig?\"],\"HO+uOC\":[\"Triage\"],\"HVIzNO\":[\"Kan lijsten bekijken\"],\"HYV6Lq\":[\"Uitnodiging accepteren mislukt. Probeer het later opnieuw of neem contact op met de klantenservice.\"],\"HeFWjW\":[\"Volgende stappen\"],\"Hg1qE9\":[\"Je werkruimte-slug is bijgewerkt.\"],\"I+AROe\":[\"Kan kaarten bewerken\"],\"I0gAKM\":[\"Kan lijst niet bijwerken\"],\"IDvohQ\":[\"heeft een checklistitem als onvoltooid gemarkeerd\"],\"IFgUX6\":[\"Kan leden verwijderen\"],\"IelE1h\":[\"Upgraden naar Pro\"],\"IqjpYe\":[\"E-mailzichtbaarheid\"],\"IrZaAn\":[\"Wachtwoord gewijzigd\"],\"J/hVSQ\":[[\"0\"]],\"J2Wbjt\":[\"Doorgaan met \"],\"J5nbej\":[\"Kritiek\"],\"J5pbP6\":[\"Kan rollen en rechten van leden bewerken\"],\"JArWcF\":[[\"0\"],\" | \",[\"1\"]],\"JCdzgZ\":[\"Functieverzoek\"],\"JUce1S\":[\"Toegewezen personen\"],\"JbXXUW\":[\"Houd er rekening mee dat deze actie onomkeerbaar is.\"],\"JcCDm9\":[\"Sjabloon gemaakt\"],\"Jgaz7E\":[\"Rechten hersteld\"],\"JlFcis\":[\"Send\"],\"JnWJXY\":[\"magische link\"],\"JxhWxU\":[\"in\"],\"JyXBgS\":[\"docs\"],\"K3iLeO\":[\"Bekijk wat onze gebruikers over Kan zeggen\"],\"KAsRdK\":[\"Ga naar leden\"],\"KFJgmZ\":[\"Weergavenaam moet minimaal 3 tekens lang zijn\"],\"KLJ4eD\":[\"Uitnodigingslink gekopieerd\"],\"KNKCTb\":[\"Backlog\"],\"KiVc+q\":[\"Fulltime\"],\"KuSt9W\":[\"Hoe kan ik zelf hosten?\"],\"L5ZPjz\":[\"een checklistitem bijgewerkt\"],\"LTGE7Y\":[\"Werkruimte succesvol aangemaakt. Je kunt later upgraden in de instellingen.\"],\"LeM5RY\":[\"Kan overschrijvingen niet wissen\"],\"LoUCpj\":[\"Fout bij bijwerken naam werkruimte\"],\"LqWW5F\":[\"Je weergavenaam is bijgewerkt.\"],\"LrcnbT\":[\"Host Kan op je eigen infrastructuur. Ideaal voor organisaties die volledige controle over hun gegevens nodig hebben.\"],\"Ls++vT\":[\"Snel & lichtgewicht\"],\"Lt+ZP3\":[\"heeft een checklistitem voltooid\"],\"M43OaK\":[\"Upgrade to Team Plan\"],\"M9p3Vw\":[\"Onbeperkt activiteitenlogboek\"],\"MFKlMB\":[\"Uitnodigen\"],\"MHrjPM\":[\"Titel\"],\"MI5OBT\":[\"URL kan alleen letters, cijfers en koppeltekens bevatten\"],\"MK16u2\":[\"Geen datums\"],\"MKAScN\":[\"Kan borden bekijken\"],\"MN6YzG\":[\"Werkruimte-slug bijgewerkt\"],\"MWrbWq\":[\"Instellingen | Account\"],\"MdN5zD\":[\"Je moet een beheerder zijn om werkruimte machtigingen te beheren.\"],\"MdwUGG\":[\"Bespaar tijd met herbruikbare bordsjablonen.\"],\"MeO/vH\":[\"Dit zal resulteren in het permanent verwijderen van alle gegevens die aan deze werkruimte zijn gekoppeld.\"],\"MlyjJu\":[\"Weergavenaam mag niet langer zijn dan 280 tekens\"],\"MxQXhL\":[\"Kan werkruimte niet aanmaken\"],\"N/bcWA\":[\"Login | kan.bn\"],\"N3380t\":[\"Kan borden aanmaken\"],\"N7aud6\":[\"Intelligente zoekopdracht\"],\"NH54UR\":[\"checklistitem hernoemd naar <0>\",[\"0\"],\"</0>\"],\"NgaR6B\":[\"Voer je wachtwoord in\"],\"NypLoL\":[\"heeft een checklist hernoemd\"],\"O0li0W\":[\"Voer je huidige wachtwoord in en kies een nieuw veilig wachtwoord.\"],\"O1wAlQ\":[\"Gast\"],\"O3oNi5\":[\"E-mail\"],\"O83K21\":[\"heeft een checklistitem toegevoegd\"],\"O9jVbx\":[\"Lage prioriteit\"],\"OAYToL\":[\"Dit verwijdert alle aangepaste rechten van leden in deze werkruimte. Leden erven alleen rechten over van hun rollen.\"],\"OIA0ad\":[\"Werkruimtenaam bijgewerkt\"],\"OZtEcz\":[\"API\"],\"OpNhRn\":[\"Geen creditcard vereist\"],\"OtjenF\":[\"Voer een geldig e-mailadres in\"],\"OvoEq7\":[\"Lid\"],\"Ozt2vv\":[\"Je wachtwoord is gewijzigd.\"],\"P6dJdq\":[\"Overschrijvingen gewist\"],\"P8bryV\":[\"New Ticket, Triaging, In Progress, Awaiting Customer, Resolution, Done\"],\"PCIlOO\":[\"Lid toevoegen\"],\"PRjvDT\":[\"Weet je zeker dat je deze opmerking wilt verwijderen?\"],\"PRofO0\":[\"YouTube-video bewerken\"],\"PTzsxH\":[\"Zichtbaarheid van bord bijgewerkt\"],\"PZCqeW\":[\"Probeer het later opnieuw.\"],\"Pa9/o1\":[\"Create API keys to access the Kan API.\"],\"PpZkda\":[\"Functies\"],\"PyYD/v\":[\"heeft <0>\",[\"0\"],\"</0> aan de kaart toegewezen\"],\"Q9pQaX\":[\"Nog geen rollen gevonden voor deze werkruimte.\"],\"QD8opX\":[\"Bord\"],\"QHhZeE\":[\"Sjabloon succesvol gemaakt\"],\"QNtP5M\":[\"Sjabloon gebruiken\"],\"Qh7QmR\":[\"Verwijderd uit favorieten\"],\"QtACvI\":[\"Maak label\"],\"Qtzfdk\":[\"Pro Plan âˆ\"],\"R+w/Va\":[\"Facturering\"],\"R1c3Mq\":[\"Bordnaam is verplicht\"],\"R275Pz\":[\"Je hebt onbeperkte plaatsen met je Pro Plan. Er zijn geen extra kosten voor nieuwe leden!\"],\"R3FsF4\":[\"Download mislukt\"],\"R6pB8R\":[\"Star op Github\"],\"RHZu7R\":[\"Geliefd door teams wereldwijd\"],\"RJA+sg\":[\"Nieuw ticket\"],\"RRn9jf\":[\"Klik op de link die we naar \",[\"magicLinkRecipient\"],\" hebben gestuurd om in te loggen.\"],\"RSGOS1\":[\"Kan lijsten verwijderen\"],\"RfgJqw\":[\"heeft de vervaldatum bijgewerkt\"],\"RkXlPZ\":[\"GitHub\"],\"RoafuO\":[\"Feedback versturen\"],\"RtlIYB\":[\"Je staat op het punt je wachtwoord te wijzigen.\"],\"SFnH1j\":[\"Waarom een open source Trello maken?\"],\"SKqXzW\":[\"added label <0>\",[\"label\"],\"</0>\"],\"SMaFdc\":[\"Uitschrijven\"],\"SNfg0e\":[\"Kan werkruimte bekijken\"],\"SPLN9O\":[\"Bezit je eigen data\"],\"STSYcd\":[\"Kan reacties verwijderen\"],\"SWEskc\":[\"URL moet minimaal 3 tekens lang zijn\"],\"Sb2gYF\":[\"Nieuwe lijst\"],\"ScJ9fj\":[\"Privacybeleid\"],\"Se/UIp\":[\"Te doen\"],\"SkCNhl\":[\"Zoek in borden en kaarten...\"],\"SlfejT\":[\"Fout\"],\"T/pF0Z\":[\"Verwijderen uit favorieten\"],\"T21jY/\":[\"heeft een label aan de kaart toegevoegd\"],\"T7DJ2k\":[\"Kan geen reactie toevoegen\"],\"T7LJic\":[\"heeft de kaart naar een andere lijst verplaatst\"],\"T7Mywq\":[\"Kan bord niet bijwerken\"],\"TCOMOO\":[\"Rechten bewerken\"],\"TFv5tM\":[\"Kan rol niet bijwerken\"],\"TH3Irz\":[\"Recht\"],\"TKFUnX\":[\"Account verwijderd\"],\"TXO5TM\":[\"Geen sneltoetsen geregistreerd.\"],\"TYli1B\":[\"Kan reacties bewerken\"],\"TbjyhA\":[\"Docs\"],\"TcXcmk\":[\"Code review\"],\"TjREUS\":[\"Nieuwe API-sleutel\"],\"TmvrjU\":[\"Board URL moet minimaal 3 tekens lang zijn\"],\"TvY/XA\":[\"Documentatie\"],\"Tz0i8g\":[\"Instellingen\"],\"TztLaN\":[\"Kan geen lijst maken\"],\"U3pytU\":[\"Beheerder\"],\"U5dMR6\":[\"Werkruimte bekijken\"],\"UCLeG0\":[\"Servicevoorwaarden\"],\"UQbwrz\":[\"Alle systemen operationeel\"],\"URAE3q\":[\"Gepauzeerd\"],\"USVCGU\":[\"Fout bij het deactiveren van uitnodigingslink\"],\"UbRKMZ\":[\"In behandeling\"],\"UbYdrA\":[\"Betalingsfrequentie\"],\"UeDFpo\":[\"Hoe wordt het project gefinancierd?\"],\"UlhdTP\":[\"Werkruimte verwijderd\"],\"Un80BR\":[\"OSS Vrienden\"],\"UveK6V\":[\"Naar de app\"],\"Uworke\":[\"Deeltijd\"],\"UxKoFf\":[\"Navigatie\"],\"V3MPSQ\":[\"titel bijgewerkt\"],\"V8YWP3\":[\"Voer een aangepaste titel in\"],\"VHS0aJ\":[\"Alle aangepaste rechten wissen?\"],\"VKoDQD\":[\"Nieuwe \",[\"0\"],\" maken\"],\"VUZDlr\":[\"Getuigenissen\"],\"VXk54Y\":[\"heeft de kaart aan zichzelf toegewezen\"],\"VbyRUy\":[\"Opmerkingen\"],\"VhMDMg\":[\"Wachtwoord wijzigen\"],\"Vt50G1\":[\"Basis kanban\"],\"W/Elkg\":[\"Gemiddelde prioriteit\"],\"W/nQk1\":[\"Gratis plan\"],\"W5r8Qh\":[\"heeft een checklistitem verwijderd\"],\"W8oT+L\":[\"Kan video-informatie niet ophalen\"],\"WHHLh9\":[\"Kan bijlage niet verwijderen\"],\"WI4eGo\":[\"Hoe krijg ik een aangepaste URL?\"],\"WQPDcG\":[\"Kan checklistitem niet bijwerken\"],\"WRkpB1\":[\"Registreren uitgeschakeld\"],\"WRsbHO\":[\"Je Trello-account is verbonden.\"],\"WYDptz\":[\"Abonnement vereist\"],\"WYwN1G\":[\"Nieuwe import\"],\"WbTDwg\":[\"In behandeling\"],\"Weq9zb\":[\"Algemeen\"],\"WmPhYW\":[\"Er is een fout opgetreden bij het verbreken van de verbinding met je Trello-account.\"],\"WnEwDO\":[\"Heb je al een account? <0><1>Log in</1></0>\"],\"Wy6pcF\":[\"Kan bordzichtbaarheid niet bijwerken\"],\"X0N0PA\":[\" (bewerkt)\"],\"XDRXbZ\":[\"Werkruimtebeschrijving moet minimaal 3 tekens lang zijn\"],\"XILg0L\":[\"Ongeldig e-mailadres\"],\"XJOV1Y\":[\"Activiteit\"],\"XTKtey\":[\"Lijst maken\"],\"XXbgHS\":[\"Aangenomen\"],\"XYLcNv\":[\"Ondersteuning\"],\"XicmhT\":[\"Vervaldatum\"],\"Xid3K6\":[\"Board URL kan alleen letters, cijfers en koppeltekens bevatten\"],\"Xjj/kS\":[\"Kanban opnieuw uitgevonden\"],\"XpcjLO\":[\"Kan board URL niet bijwerken\"],\"XyuOHa\":[\"Bord delen & uitnodigingen\"],\"YBBifR\":[\"Trello ontkoppelen\"],\"YKeYae\":[\"Kan checklistitem niet opnieuw ordenen\"],\"YQqv2e\":[\"Get started by creating a new board\"],\"YVT40D\":[\"heeft label <0>\",[\"0\"],\"</0> verwijderd\"],\"YaZDYI\":[\"Fout bij het upgraden van abonnement\"],\"YcyP2z\":[\"Kan sjabloon niet maken\"],\"Yf9FAx\":[\"Ze zullen geen toegang meer hebben tot deze werkruimte.\"],\"YhvWXb\":[\"Bordanalyses\"],\"YirHq7\":[\"Feedback\"],\"YoyKbT\":[\"Deze API-sleutel wordt slechts Ã©Ã©n keer getoond. Bewaar deze op een veilige plaats.\"],\"YtUfwW\":[\"Inloggen met \",[\"0\"],\" is mislukt. Probeer het opnieuw.\"],\"Z3FXyt\":[\"Laden...\"],\"Z3krJD\":[\"Sta werkruimteleden toe elkaars e-mailadressen te zien\"],\"Z6r9z1\":[\"Kan kaart niet verwijderen\"],\"Z7/Xyy\":[\"Applicants, Screening, Interviewing, Offer, Onboarding, Hired\"],\"ZDGm40\":[\"Account verwijderen\"],\"ZDIydz\":[\"Aan de slag\"],\"ZDo4HN\":[\"Brainstormen\"],\"ZH7TVS\":[\"Kaarttitel\"],\"ZL1A+p\":[\"Bijlage uploaden mislukt. Probeer het opnieuw.\"],\"ZT4Khw\":[\"Weet je zeker dat je deze kaart wilt verwijderen?\"],\"ZU5IYI\":[\"Onbeperkt aantal borden, onbeperkt aantal lijsten, onbeperkt aantal kaarten. Geen creditcard vereist.\"],\"ZXSPJt\":[\"Er is een onverwachte fout opgetreden. Probeer het later opnieuw.\"],\"ZqDqbi\":[\"Organiseer en vind kaarten snel met krachtige filtertools.\"],\"Zz1qkk\":[\"Onbeperkt aantal kaarten\"],\"aHCEmh\":[\"Prijzen\"],\"aHRWVI\":[\"heeft de vervaldatum verwijderd\"],\"aJ4pMe\":[\"Veelgestelde vragen\"],\"aWDhU5\":[\"Kanban werkt beter met een team. Perfect voor kleine en groeiende teams die willen samenwerken.\"],\"aWlSc/\":[\"Maak nieuwe lijst\"],\"abUZlY\":[\"Details toevoegen...\"],\"aelko+\":[\"Je kunt een aangepaste werkruimte-URL krijgen, zoals <0>kan.bn/kan</0>, door naar je <1>werkruimte-instellingen</1> te gaan en een pro-werkruimte-abonnement aan te schaffen. Alle abonnementen helpen de ontwikkeling van het project te financieren!\"],\"aiHZVP\":[\"Bekijk documentatie\"],\"aj40Mw\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users (free during the beta) and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"b/LfJo\":[\"e-mail\"],\"b3Thhd\":[\"Uploaden mislukt\"],\"b5FKyH\":[\"heeft label <0>\",[\"0\"],\"</0> toegevoegd\"],\"b9XOHo\":[[\"0\"],\" maken\"],\"bA2LQS\":[\"Functieoverzicht\"],\"bD8I7O\":[\"Voltooid\"],\"bDI6VI\":[[\"0\"],\" is verwijderd uit je favorieten.\"],\"bJZm1W\":[\"Sollicitanten\"],\"bJtM0P\":[\"Deze werkruimte-URL is gereserveerd\"],\"bZSICm\":[\"Kan checklistitem niet toevoegen\"],\"bcIybO\":[\"Naam van werkruimte is verplicht\"],\"bdztP2\":[\"Onderzoek\"],\"bfZE+Y\":[\"De rol van het lid is bijgewerkt.\"],\"bff61F\":[\"Teamplan\"],\"bfgr/e\":[\"Vraag\"],\"bgh/9n\":[\"kan werkruimte-instellingen beheren\"],\"bmXKoX\":[[\"0\"],\" labels toegevoegd: <0>\",[\"labelList\"],\"</0>\"],\"bqAQaT\":[\"Fout bij verwijderen account\"],\"c/IAuR\":[\"Belangrijk\"],\"c3b0B0\":[\"Aan de slag\"],\"c9AJhn\":[\"Deelnemen aan werkruimte\"],\"cAgBMh\":[\"Volledige controle en eigendom:\"],\"cFQEU/\":[\"Sneltoetsen openen\"],\"cOh+MI\":[\"Screening\"],\"cWcxrL\":[\"Nieuwe checklist\"],\"cWtfn1\":[\"Upgrade naar Pro ($29/maand)\"],\"chyf4J\":[\"Werkruimte beschrijving\"],\"cji2nM\":[\"Fout bij het maken van uitnodigingslink\"],\"cnGeoo\":[\"Verwijderen\"],\"cp1rsD\":[\"Uitnodigingslink deactiveren\"],\"csFbe+\":[\"Ga naar sjablonen\"],\"curoK5\":[\"Nieuwe werkruimte\"],\"d33Usy\":[\"Checklist maken\"],\"d7XqZJ\":[\"A powerful, flexible kanban app that helps you organise work,\\n              track progress, and deliver resultsâ€”all in one place.\"],\"dEgA5A\":[\"Annuleren\"],\"dUh9QW\":[\"Planning\"],\"ddrz1m\":[\"Achterstallig\"],\"delOXn\":[\"Kan labels niet bijwerken\"],\"dgr4Kq\":[\"Label bewerken\"],\"dmKdk0\":[\"Zodra je je werkruimte verwijdert, is er geen weg terug. Deze actie kan niet ongedaan worden gemaakt.\"],\"dsLT3m\":[\"Maak kaart\"],\"dtbpdR\":[\"Trello\"],\"duf3Nr\":[\"Deze werkruimte-URL is al in gebruik\"],\"e12o5C\":[\"Invite another\"],\"e4hPSt\":[\"Herstellen naar standaard rolrechten\"],\"eEQyz+\":[\"Volg alle kaartwijzigingen met gedetailleerde activiteitengeschiedenis.\"],\"ePK91l\":[\"Bewerken\"],\"eZCGbT\":[\"Ja, we bieden een voor altijd gratis plan voor individueel gebruik. Geen beperkingen, geen betaalmuren, geen limieten.\"],\"edWbV6\":[\"Link gekopieerd\"],\"en3oy5\":[\"Functie\"],\"evg7+A\":[\"Je borden zijn geÃ¯mporteerd.\"],\"evj0lK\":[\"Bieden jullie een gratis abonnement aan?\"],\"f8fH8W\":[\"Ontwerp\"],\"f8lDFq\":[\"heeft de kaart aangemaakt\"],\"fEY2vP\":[\"Kaart niet gevonden\"],\"fJxqi6\":[\"Custom URLs require Pro plan ($29/month)\"],\"fQCrjt\":[\"De zichtbaarheid van je bord is ingesteld op \",[\"0\"],\".\"],\"fR9laE\":[\"Voer je huidige wachtwoord in\"],\"fSf2ee\":[\"Bekijk onze roadmap.\"],\"fYVH36\":[\"Kan reactie niet bijwerken\"],\"fvLNDy\":[\"Er zijn nog geen lijsten aangemaakt\"],\"fziA2d\":[\"Onbeperkt aantal opmerkingen\"],\"g2xBxu\":[\"Het importeren van je Trello-borden naar Kan is eenvoudig. Je kunt onze stap-voor-stap handleiding <0>hier</0> volgen.\"],\"gGx5tM\":[\"Bewerken\"],\"gL/7jw\":[\"Beschrijving toevoegen... (typ '/' om commando's te openen of '@' om te vermelden)\"],\"gUX7b+\":[\"Het open source <0/> alternatief voor Trello\"],\"gZxH/p\":[\"heeft de vervaldatum gewijzigd naar <0>\",[\"formattedDate\"],\"</0>\"],\"ghSJ4U\":[\"Werkruimtenaam mag niet langer zijn dan 64 tekens\"],\"gkzAEM\":[\"Doorgaan met \",[\"0\"]],\"goklcJ\":[\"Interviewen\"],\"gpfJ3v\":[\"Altijd gratis\"],\"gukxZ5\":[\"Inwerktraject\"],\"gv5kbo\":[\"Board URL mag niet langer zijn dan 60 tekens\"],\"h16FyT\":[\"Lijsten\"],\"h2FKMV\":[\"Je hebt geen toestemming\"],\"h4VV67\":[\"heeft een checklist toegevoegd\"],\"h7MgpO\":[\"Sneltoetsen\"],\"h8DugX\":[\"Labels\"],\"hAMddS\":[\"zichzelf van de kaart verwijderd\"],\"hXMFoN\":[\"Geen lijsten\"],\"hYzsXr\":[\"Instellingen | Integraties\"],\"hh61gL\":[\"Importeren vanuit Trello\"],\"iFxrHK\":[\"Find answers to common questions about the project. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"iHcdea\":[\"Vervalt volgende week\"],\"iLbjv+\":[\"Kan werkruimte bewerken\"],\"iQmbPb\":[\"Licentie\"],\"iTylMl\":[\"Sjablonen\"],\"iVIGZb\":[\"Bijlage geÃ¼pload\"],\"isRobC\":[\"Nieuw\"],\"iwr7AP\":[\"IdeeÃ«n\"],\"iy1wb+\":[\"Instellingen | API\"],\"j2+d/o\":[\"API-referentie\"],\"j9IZZ0\":[\"Aangepaste werkruimte-URL\"],\"jDRt4n\":[\"Wil je je uitschrijven?\"],\"jL82rC\":[\"Aangepaste rechten wissen\"],\"jNuzV/\":[\"Kan kaarten verwijderen\"],\"jQ6I8X\":[\"Rol bijgewerkt\"],\"jZBHkN\":[\"Werkruimtenaam moet minimaal 3 tekens lang zijn\"],\"jfC/xh\":[\"Contact\"],\"jkbHit\":[\"around the world\"],\"jl3aEJ\":[\"heeft checklistitem <0>\",[\"0\"],\"</0> als onvoltooid gemarkeerd\"],\"jlB2RY\":[\"Het ingevoerde huidige wachtwoord is onjuist.\"],\"jwI32v\":[\"Bord niet gevonden\"],\"kECVpo\":[\"Weet je zeker dat je dit label wilt verwijderen?\"],\"kQwvU8\":[\"heeft een label van de kaart verwijderd\"],\"kSxwQL\":[\"Je kunt teamleden uitnodigen door op de knop \\\"Uitnodigen\\\" in de rechterbovenhoek van de <0>ledenpagina</0> te klikken en hun e-mailadres in te voeren. Ze ontvangen een e-mail met een link om deel te nemen aan de werkruimte.\"],\"kYu0eF\":[\"Werkruimte verwijderen\"],\"kfOGMr\":[\"Snelle winst\"],\"klpSmb\":[\"Werkruimte-URL bewerken\"],\"kp6L3T\":[\"Deze werkruimtegebruikersnaam is al in gebruik\"],\"kryGs+\":[\"Kaart\"],\"kuoc68\":[\"$10/maand\"],\"kwkhPe\":[\"Upgrade\"],\"kxEs5t\":[\"Trello-imports\"],\"l2PIAy\":[\"Zelf hosten met Github\"],\"l31EoQ\":[\"Vind antwoorden op veelgestelde vragen over Kan. Kun je niet vinden wat je zoekt? Voel je vrij om <0>contact met ons op te nemen</0>.\"],\"l3s5ri\":[\"Importeren\"],\"l4asa1\":[\"Dit bord is privÃ© of bestaat niet\"],\"lGjicL\":[\", of bekijk onze\"],\"lKAvEd\":[\"Fout bij ontkoppelen van Trello\"],\"lSNkXg\":[\"All seats are free during the beta until Sept 1st!\"],\"lXvXNI\":[\"KopiÃ«ren van uitnodigingslink mislukt\"],\"lYT7pQ\":[\"Lijst verwijderen\"],\"lcokBr\":[\"Eigendom van Atlassian\"],\"lkz85l\":[\"Het belangrijkste verschil tussen Kan en Trello is dat Kan open source is, waardoor iedereen onze code kan bekijken, wijzigen en eraan kan bijdragen. Onze cloudoplossing biedt ook geen beperkingen op functies voor individueel gebruik, terwijl Trello basisfuncties zoals het aantal borden dat je kunt maken achter een betaalmuur plaatst.\"],\"lo8xBK\":[\"Weet je zeker dat je \",[\"entityLabel\"],\" wilt verwijderen?\"],\"lpIMne\":[\"Wachtwoorden komen niet overeen\"],\"lsgnzd\":[\"Fout bij upgraden naar Pro\"],\"lyqwgn\":[\"Label toevoegen\"],\"m2nk0i\":[\"Eenvoudige prijzen\"],\"mErq7F\":[\"Registreren\"],\"mHhffx\":[\"Kan checklist niet maken\"],\"mTGd3+\":[\"heeft een checklist verwijderd\"],\"mTwGOf\":[\"Deze uitnodigingslink is ongeldig of verlopen.\"],\"mU+M00\":[[\"0\"],\" is toegevoegd aan je favorieten.\"],\"mVZH9V\":[\"Toen Trello in 2011 werd gelanceerd, blies het iedereen omver met zijn zorgvuldig ontworpen eenvoud, maar in de loop der jaren verloor het zijn magie en groeide het uit tot iets dat meer leek op \\\"Jira Lite\\\". Dit project is onze poging om de oorspronkelijke magie van Trello's eenvoud terug te brengen, in open source.\"],\"mZGPxt\":[\"Uitnodigingslink gekopieerd naar klembord\"],\"mchgzf\":[\"Je bent succesvol geregistreerd.\"],\"mgXgHu\":[\"Ga naar borden\"],\"mwBdZ2\":[\"Dit zal resulteren in het permanent verwijderen van alle gegevens die aan je account zijn gekoppeld.\"],\"mx8+1u\":[\"Onbeperkt aantal leden\"],\"n+xLOH\":[\"Klantenservice\"],\"n1GRql\":[\"Nieuw label\"],\"n1ekoW\":[\"Inloggen\"],\"n9V+ps\":[\"Voer je naam in\"],\"nOhz3x\":[\"Uitloggen\"],\"nabda1\":[\"Kaart verwijderen\"],\"nbfdhU\":[\"Integraties\"],\"nhMhRr\":[\"Bedankt voor je feedback!\"],\"njJFtc\":[\"Reactie verwijderen\"],\"nk7caK\":[\"Verbind Trello\"],\"nol/Fb\":[\"Hoe nodig ik teamleden uit?\"],\"notwF1\":[\"Sjabloonnaam mag niet langer zijn dan 100 tekens\"],\"nq7q3Z\":[\"API-sleutelnaam mag niet langer zijn dan 30 tekens\"],\"nqdIhs\":[\"Aangepaste bordsjablonen\"],\"nryrgW\":[\"Alle aangepaste rechten van leden zijn teruggezet naar de standaardinstellingen van hun rol.\"],\"nxb+xc\":[\"unassigned <0>\",[\"memberName\"],\"</0> from the card\"],\"o+JCfN\":[\"Vertrouwd door snelbewegende teams<0/>over de hele wereld\"],\"o7J4JM\":[\"Filter\"],\"o9WLwO\":[\"Kan kaart niet bijwerken\"],\"oBndex\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"oVBq1w\":[\"per gebruiker/maand\"],\"oW13KZ\":[\"Begin vandaag nog gratis\"],\"oXpmwC\":[\"Zelf te hosten\"],\"odFCYX\":[\"Ongeldige uitnodiging\"],\"ohktr7\":[\"Opmerkingen & vermeldingen\"],\"okpxfB\":[\"Nieuwe sleutel aanmaken\"],\"oyRjD/\":[\"Pro Plan\"],\"p/hk9N\":[\"Je bent succesvol ingelogd.\"],\"pBsoKL\":[\"Toevoegen aan favorieten\"],\"pFGfsR\":[\"Bekijk enkele van onze favoriete open source projecten.\"],\"pFKC6A\":[\"API-sleutelnaam\"],\"pL78ec\":[\"Toegevoegd aan favorieten\"],\"pXVFJy\":[\"Kan borden verwijderen\"],\"pa9o5D\":[\"Snijd je avatar bij\"],\"pfa8F0\":[\"Weergavenaam\"],\"pmUArF\":[\"Werkruimte\"],\"pnrmSP\":[\"Nieuwe kaart\"],\"poDo/D\":[\"Create new board\"],\"ppaRWv\":[\"Zelf hosten\"],\"pvnfJD\":[\"Donker\"],\"q+lt9D\":[\"Fout bij het verwijderen van label\"],\"qPP4lD\":[\"Voor het uitnodigen van leden is een teamplan vereist. Je wordt doorgestuurd om je werkruimte te upgraden.\"],\"qQXocp\":[\"Kan werkruimte-instellingen beheren\"],\"qfUS/w\":[\"Open Source Vrienden\"],\"qkjvgj\":[\"Je werkruimte is verwijderd.\"],\"qlAIQ1\":[\"Op afstand\"],\"qrT8WB\":[\"#1 Hacker News\"],\"qtE5nt\":[\"Voeg een item toe...\"],\"qzdST2\":[\"Bordzichtbaarheid\"],\"r6BgwX\":[\"Wachtwoord is vereist om in te loggen.\"],\"rD6UIt\":[\"Begin in de cloud\"],\"rF8SEQ\":[\"Reactie bewerken\"],\"rRM7r0\":[\"Importeer je Trello-borden en ga direct aan de slag.\"],\"rYUZIe\":[\"Selecteer bron\"],\"raHesj\":[\"Je bent uitgeschreven!\"],\"rarRW/\":[\"Fout bij het uitnodigen van lid\"],\"ri1hHe\":[\"Vervalt volgende maand\"],\"rmN315\":[\"Leuk\"],\"rs7L54\":[\"heeft een lid aan de kaart toegevoegd\"],\"rtbVvN\":[\"Kan lijsten bewerken\"],\"s+MGs7\":[\"Bronnen\"],\"s6iE/c\":[\"Registreren is momenteel uitgeschakeld. Probeer het later opnieuw.\"],\"sBhOFG\":[\"Eenvoudig, visueel taakbeheer dat gewoon werkt. Sleep kaarten, werk samen met je team en krijg meer gedaan.\"],\"sDLCvT\":[\"Verbind je favoriete tools om je werkstroom te stroomlijnen.\"],\"sDuhfK\":[\"Introductieaanbieding: onbeperkt aantal gebruikers voor slechts $29/maand met Pro\"],\"sUZo7y\":[\"Registreren | kan.bn\"],\"sVBn4K\":[\"Fout bij bijwerken weergavenaam\"],\"sY2lzr\":[\"Geen download-URL beschikbaar voor deze bijlage.\"],\"seaklU\":[\"Boards | \",[\"0\"]],\"t+R8+P\":[\"Uitvoering\"],\"t/YqKh\":[\"Verwijderen\"],\"t2nDzl\":[\"Bekijk en beheer je facturering en abonnement.\"],\"t6FvJH\":[\"Kan reacties toevoegen\"],\"tGwwnq\":[\"beschrijving bijgewerkt\"],\"tHcbLF\":[\"Kan borden bewerken\"],\"tHjBUm\":[\"Kan\"],\"tIdipJ\":[\"Board URL bewerken\"],\"tMYIu7\":[\"Activiteitenlogboeken\"],\"tTbref\":[\"Wachtwoord is vereist om je aan te melden.\"],\"tYN21H\":[\"Gebruiker is al lid van deze werkruimte\"],\"tca56/\":[\"Je bestand is succesvol geÃ¼pload.\"],\"tfDRzk\":[\"Opslaan\"],\"tmlJN1\":[\"Voer een geldige YouTube-URL in\"],\"tmpW+w\":[\"Board verwijderen\"],\"tyHiOa\":[\"Probeer het later opnieuw of neem contact op met de klantenservice.\"],\"u2+JIh\":[\"Aangepaste URL's vereisen een upgrade naar een Pro-abonnement\"],\"u8JHrO\":[\"Filters wissen\"],\"uOqaMC\":[\"Je bent uitgenodigd om deel te nemen aan een werkruimte.\"],\"uXGLuq\":[\"API-sleutel aanmaken\"],\"uZg2+w\":[\"Geef je werkruimte een boost voor slechts $29/maand. Dit krijg je:\"],\"uck1tz\":[\"heeft een lid van de kaart verwijderd\"],\"usVytm\":[\"Zodra je je account verwijdert, is er geen weg terug. Deze actie kan niet ongedaan worden gemaakt.\"],\"uwBBCy\":[\"Kan werkt beter met een team. Perfect voor kleine en groeiende teams die willen samenwerken.\"],\"v+Wp++\":[\"Open source\"],\"v3YoMA\":[\"Senior\"],\"vAR/I8\":[\"Draai op je eigen infrastructuur\"],\"vAj6xG\":[\"Je kunt zelf hosten door de instructies in onze <0>repo</0> te volgen.\"],\"vMCCIc\":[\"URL mag niet langer zijn dan 24 tekens\"],\"vSJd18\":[\"Video\"],\"vUr5JT\":[\"Heb je geen account? <0><1>Registreer je</1></0>\"],\"vXIe7J\":[\"Taal\"],\"vXemf6\":[\"Bug\"],\"va/3u1\":[\"Bepaal wie je borden kan bekijken en bewerken.\"],\"vbskQn\":[\"API-sleutelnaam is verplicht\"],\"veIDCY\":[\"Start 14 dagen gratis proefperiode\"],\"vfRdCZ\":[\"Kan machtigingen niet resetten\"],\"vgdzLf\":[\"Maak nog een\"],\"vifyyw\":[\"Juridisch\"],\"vlxQFL\":[\"De rechten van dit lid zijn hersteld naar de standaard rolrechten.\"],\"vneRvS\":[\"maandelijkse facturering\"],\"vuxdLS\":[\"Lange termijn\"],\"vwGkYB\":[\"Wachtwoord moet minimaal 8 tekens bevatten\"],\"wIb7Ng\":[\"Softwareontwikkeling\"],\"wIkTTk\":[\"Workspace name cannot exceed 24 characters\"],\"wM8xd8\":[\"Junior\"],\"wPZBpR\":[\"Selecteer een bestand om te uploaden.\"],\"wY+6Ye\":[\"Deze board URL is al in gebruik\"],\"wakO3W\":[\"heeft checklist <0>\",[\"0\"],\"</0> toegevoegd\"],\"wewm3j\":[\"Bordnaam mag niet langer zijn dan 100 tekens\"],\"wgNoIs\":[\"Alles selecteren\"],\"wlQNTg\":[\"Leden\"],\"wqkcin\":[\"Kan reacties bekijken\"],\"wqxglO\":[\"Leren\"],\"wruKPE\":[\"Ondersteun de ontwikkeling van het project\"],\"wtxjAY\":[\"Werkruimteleden\"],\"wzR1hC\":[\"Board name cannot exceed 50 characters\"],\"x0kMO/\":[\"Fout bij het bijwerken van werkruimte-URL\"],\"x8GeCD\":[\"Weergavenaam bijgewerkt\"],\"xEbBrW\":[\"Welke licentie gebruiken jullie?\"],\"xJO7ca\":[\"updated the title to <0>\",[\"toTitle\"],\"</0>\"],\"xMn+V9\":[\"Importeren vanuit Trello\"],\"xRPn3U\":[\"Voer je e-mailadres in\"],\"xvcYhz\":[\"Wis alle aangepaste rechten van leden zodat alle leden alleen rechten overerven van hun standaard rolrechten.\"],\"yCzSJ3\":[\"Onbeperkte werkruimtes\"],\"yD3ZSw\":[\"Wijzig je taalvoorkeuren.\"],\"yH4aFo\":[\"Share invite link\"],\"yV7o5I\":[\"Hoe importeer ik mijn Trello-borden?\"],\"yb/fjw\":[\"Goedkeuring\"],\"yz7wBu\":[\"Sluiten\"],\"zC8Whw\":[\"Begin door een nieuwe lijst te maken\"],\"zDw80P\":[\"New board\"],\"zEGgv4\":[\"Vergelijk onze functies om te zien waarom Kan de beste keuze is.\"],\"zERArS\":[\"titel bijgewerkt naar <0>\",[\"0\"],\"</0>\"],\"zKY5xi\":[\"Uitnodigingslink maken\"],\"zLXwCk\":[\"my-workspace-name\"],\"zMjN8w\":[\"REST API\"],\"zMlxCA\":[\"1 gebruiker\"],\"zQPhSa\":[\"Converteer naar link\"],\"zQX5Dj\":[\"Lijstnaam\"],\"zdMPUq\":[\"removed label <0>\",[\"label\"],\"</0>\"],\"zkWmBh\":[\"Jaarlijks\"],\"zl1b97\":[\"Kan kaart niet aanmaken\"],\"zoEbXq\":[\"Kan kaarten bekijken\"],\"zto8aj\":[\"Trello ontkoppeld\"],\"zwBp5t\":[\"PrivÃ©\"],\"zwWKhA\":[\"Meer informatie\"],\"zxKs+y\":[\"Vervalt morgen\"],\"zzDlyQ\":[\"Geslaagd\"]}")as Messages;


================================================
FILE: apps/web/src/locales/pl/messages.ts
================================================
/*eslint-disable*/import type{Messages}from"@lingui/core";export const messages=JSON.parse("{\"++rVAm\":[\"Media spoÅ‚ecznoÅ›ciowe\"],\"+3TYXa\":[\"Dla dÅ‚ugoterminowej trwaÅ‚oÅ›ci uznajemy, Å¼e wszystkie dobre projekty open source potrzebujÄ… ÅºrÃ³dÅ‚a dochodu. Nasze pochodzi z pÅ‚atnej oferty w chmurze dla przestrzeni roboczych z wieloma uÅ¼ytkownikami oraz dla niestandardowych nazw przestrzeni roboczych. Nie ma obowiÄ…zku korzystania z niej, a oprogramowanie moÅ¼na hostowaÄ‡ samodzielnie na wÅ‚asnej infrastrukturze bezpÅ‚atnie.\"],\"+8Nek/\":[\"MiesiÄ™cznie\"],\"+EkBs0\":[\"Nie udaÅ‚o siÄ™ zaktualizowaÄ‡ twoich preferencji. SprÃ³buj ponownie.\"],\"+MdEsf\":[\"Wymagane jest nowe hasÅ‚o\"],\"+OhFss\":[\"Rozpocznij za darmo, bez ograniczeÅ„ uÅ¼ytkowania. Aby wspÃ³Å‚pracowaÄ‡, przejdÅº na plan dopasowany do wielkoÅ›ci Twojego zespoÅ‚u.\"],\"+VoTOr\":[\"rozliczane miesiÄ™cznie\"],\"+cilKj\":[\"Ideas, Research, Planning, Execution, Review, Next Steps, Complete\"],\"+djOzj\":[\"ZaproÅ› czÅ‚onka\"],\"+nvZ6j\":[\"Etykiety i Filtry\"],\"/8pTF/\":[\"workspace-url\"],\"/Blkmk\":[\"Add description... (type '/' to open commands)\"],\"/DGOJs\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trelloâ€™s simplicity, in open source.\"],\"/K2CvV\":[\"Szablon\"],\"/asTmx\":[\"ZgÅ‚oszenie bÅ‚Ä™du\"],\"/f3t6v\":[\"Skonfiguruj, ktÃ³re akcje sÄ… dozwolone dla kaÅ¼dej roli w obszarze roboczym. Te uprawnienia dotyczÄ… wszystkich czÅ‚onkÃ³w z tÄ… rolÄ….\"],\"/gaSVU\":[\"Plan ulepszeÅ„\"],\"/glL9Q\":[\"Brak \",[\"0\"]],\"/lDBHm\":[\"FAQ\"],\"/rn4RE\":[\"PotÄ™Å¼na, elastyczna aplikacja kanban, ktÃ³ra pomaga organizowaÄ‡ pracÄ™, Å›ledziÄ‡ postÄ™py i dostarczaÄ‡ wyniki â€” wszystko w jednym miejscu.\"],\"/tOdd2\":[\"TwÃ³j obrazek profilowy zostaÅ‚ zaktualizowany.\"],\"0+0/3e\":[\"UtwÃ³rz nowÄ… etykietÄ™\"],\"0+ewPp\":[\"Ulepszenie\"],\"0KjpAr\":[\"MoÅ¼e wyÅ›wietlaÄ‡ czÅ‚onkÃ³w\"],\"0StR7t\":[\"WprowadÅº swoje nowe hasÅ‚o\"],\"0dyOHD\":[\"Backlog, To Do, In Progress, Code Review, Done\"],\"0jV46i\":[\"Nie moÅ¼na usunÄ…Ä‡ elementu listy kontrolnej\"],\"0qyZ4b\":[\"Åadowanie uprawnieÅ„...\"],\"0rPv1T\":[\"Zaktualizowano zdjÄ™cie profilowe\"],\"0xWkkH\":[[\"boardCount\",\"plural\",{\"one\":[\"Importuj tablicÄ™ (1)\"],\"other\":[\"Importuj tablice (\",[\"boardCount\"],\")\"]}]],\"1/jlQw\":[\"Trusted by fast-moving teams\"],\"14Xi3Z\":[\"Dodanie nowego czÅ‚onka bÄ™dzie kosztowaÄ‡ dodatkowe \",[\"price\"],\" (\",[\"billingType\"],\") za miejsce.\"],\"1H5u1m\":[\"Pytania?\"],\"1HPFNH\":[\"Cena za uÅ¼ytkownika/miesiÄ…c\"],\"1WuwiM\":[\"PrzejdÅº do ustawieÅ„\"],\"1ZVGyT\":[\"Dodaj komentarz...\"],\"1hzdxO\":[\"Uprawnienia przestrzeni roboczej\"],\"1iShX0\":[\"Termin na dziÅ›\"],\"1njn7W\":[\"Jasny\"],\"1rVAfU\":[\"ZaÅ‚aduj wiÄ™cej aktywnoÅ›ci\"],\"1rWxEw\":[\"Oczekuje na klienta\"],\"1sRmLC\":[\"Dyskutuj i wspÃ³Å‚pracuj nad kartami.\"],\"1sSegR\":[\"Brainstorming, Writing, Editing, Design, Approval, Publishing, Done\"],\"1wCGT0\":[\"Nieograniczona liczba tablic\"],\"25fAUC\":[\"TwÃ³j link do wypisania siÄ™ nie zawiera tokena. OtwÃ³rz najnowszy e-mail i sprÃ³buj ponownie.\"],\"25mvI+\":[\"Linki zaproszeÅ„ wymagajÄ… subskrypcji Team lub Pro. ProszÄ™ ulepszyÄ‡ swoje Å›rodowisko pracy.\"],\"29sSki\":[\"ukoÅ„czono element listy kontrolnej <0>\",[\"0\"],\"</0>\"],\"2BBAbc\":[\"Lista\"],\"2Bu8xj\":[\"Nie znaleziono tablic\"],\"2M84k3\":[\"Niestandardowe uprawnienia\"],\"2MPcep\":[\"Import zakoÅ„czony\"],\"2POOFK\":[\"Darmowy\"],\"2Py5S/\":[\"Potwierdzam, Å¼e wszystkie dane przestrzeni roboczej zostanÄ… trwale usuniÄ™te i chcÄ™ kontynuowaÄ‡.\"],\"2Q871c\":[\"Nie moÅ¼na dodaÄ‡ etykiety\"],\"2QGEbi\":[\"Nie moÅ¼na usunÄ…Ä‡ komentarza\"],\"2SePRT\":[\"ZostaÅ‚eÅ› zaproszony do doÅ‚Ä…czenia do przestrzeni roboczej na kan.bn.\"],\"2h4PVB\":[\"Nazwa twojej przestrzeni roboczej zostaÅ‚a zaktualizowana.\"],\"2liqDZ\":[\"Potwierdzam, Å¼e wszystkie dane mojego konta zostanÄ… trwale usuniÄ™te i chcÄ™ kontynuowaÄ‡.\"],\"2q/Q7x\":[\"WidocznoÅ›Ä‡\"],\"2roTVj\":[\"Opinia wysÅ‚ana\"],\"3LDCpD\":[\"Tej akcji nie moÅ¼na cofnÄ…Ä‡.\"],\"3ZjRJY\":[\"zmieniono nazwÄ™ listy kontrolnej <0>\",[\"0\"],\"</0>\"],\"3bqt9U\":[\"KaÅ¼dy z tym linkiem moÅ¼e doÅ‚Ä…czyÄ‡ do twojego obszaru roboczego\"],\"3pIq39\":[\"Role administratora\"],\"479pdJ\":[\"PotwierdÅº swoje nowe hasÅ‚o\"],\"4DOCMI\":[\"YouTube URL\"],\"4RoY9J\":[\"Post na blogu\"],\"4XF0BB\":[\"ZdjÄ™cie profilowe\"],\"4gAX8s\":[\"PrzeÅ‚Ä…cz menu\"],\"4ix5kl\":[\"BÅ‚Ä…d podczas aktualizacji zdjÄ™cia profilowego\"],\"4kJRen\":[\"Pisanie\"],\"4qu8Ec\":[\"14-dniowy bezpÅ‚atny okres prÃ³bny\"],\"53QYh8\":[\"Nie udaÅ‚o siÄ™ utworzyÄ‡ tablicy\"],\"55xJ/O\":[\"BÅ‚Ä…d podczas zmiany hasÅ‚a\"],\"58AiWX\":[\"ProszÄ™ potwierdziÄ‡ nowe hasÅ‚o\"],\"5ACX4z\":[\"Newsletter\"],\"5IXWmO\":[\"SprawdÅº swojÄ… skrzynkÄ™ odbiorczÄ…\"],\"5P4rhH\":[\"Nie moÅ¼na zaktualizowaÄ‡ czÅ‚onkÃ³w\"],\"5eZwRW\":[\"PoÅ‚Ä…cz swoje konto Trello, aby zaimportowaÄ‡ tablice.\"],\"5h8ooz\":[\"Klucze API\"],\"5iplxh\":[\"Nowe hasÅ‚o musi siÄ™ rÃ³Å¼niÄ‡ od obecnego hasÅ‚a\"],\"5k0NLb\":[\"PrzeglÄ…d\"],\"5lWFkC\":[\"Zaloguj siÄ™\"],\"5wo3jF\":[\"Settings | \",[\"0\"]],\"69b7aE\":[\"OtwÃ³rz menu poleceÅ„\"],\"6E4pW0\":[\"BiaÅ‚a etykieta\"],\"6EWT6T\":[\"Rekrutacja\"],\"6FDocz\":[\"Zarejestruj siÄ™ za pomocÄ… \"],\"6FsGbN\":[\"Rozpocznij, tworzÄ…c nowy \",[\"0\"]],\"6OTo9n\":[\"Nazwa szablonu jest wymagana\"],\"6S8zjx\":[\"https://www.youtube.com/watch?v=...\"],\"6WSYbN\":[\"Nowy \",[\"0\"]],\"6YtxFj\":[\"Nazwa\"],\"6mbe4b\":[\"Osoby\"],\"6tDFBe\":[\"Uprawnienia czÅ‚onka zostaÅ‚y zaktualizowane.\"],\"6zeSBB\":[\"MoÅ¼e tworzyÄ‡ karty\"],\"74F7N/\":[\"Czy na pewno chcesz usunÄ…Ä‡ swoje konto?\"],\"7EhE4k\":[\"Zaktualizuj etykietÄ™\"],\"7L01XJ\":[\"DziaÅ‚ania\"],\"7PzzBU\":[\"UÅ¼ytkownik\"],\"7Ufoyg\":[\"Nieograniczona liczba list\"],\"7b2yuC\":[\"ProszÄ™ wprowadziÄ‡ poprawne hasÅ‚o\"],\"7d1a0d\":[\"Publiczne\"],\"7eMo+U\":[\"WrÃ³Ä‡ do strony gÅ‚Ã³wnej\"],\"7hktsm\":[\"Pierwsze kroki\"],\"7i8j3G\":[\"Firma\"],\"8+BY11\":[\"Adres URL tablicy zostaÅ‚ skopiowany do schowka\"],\"86XI28\":[\"PotwierdÅº swoje preferencje dotyczÄ…ce e-maili:\"],\"8AbRER\":[\"Ustaw termin\"],\"8Is1ih\":[\"Oferta startowa\"],\"8RdLDU\":[\"Projekt osobisty\"],\"8TveY+\":[\"Tablice\"],\"8Z4pNX\":[\"MoÅ¼e tworzyÄ‡ listy\"],\"8ZoISG\":[\"Confirm URL change\"],\"8iP0S8\":[\"Wszystko w darmowym planie, plus:\"],\"8yFGGF\":[\"Nie moÅ¼na usunÄ…Ä‡ czÅ‚onka\"],\"91W07W\":[\"Custom URLs are a premium feature. You'll be directed to upgrade your account.\"],\"99VIgC\":[\"UsuÅ„ czÅ‚onka\"],\"9PaIxv\":[\"Podstawowe funkcje\"],\"9QmxLI\":[\"Create board\"],\"9cDpsw\":[\"Uprawnienia\"],\"9eF5oV\":[\"Witamy ponownie\"],\"9h7RDh\":[\"Oferta\"],\"9s9O5h\":[\"BÅ‚Ä…d podczas usuwania przestrzeni roboczej\"],\"9u5BOr\":[\"CzÅ‚onkowie | \",[\"0\"]],\"9wdpwp\":[\"Portal rozliczeniowy\"],\"9x4DAL\":[[\"0\"],\" nie znaleziono\"],\"9y1RcT\":[\"Dopiero zaczynamy. \"],\"A23Y7X\":[\"DoÅ‚Ä…cz do Å›rodowiska pracy | kan.bn\"],\"A5hiCy\":[\"UtwÃ³rz szablon\"],\"A8jqN7\":[\"Nie moÅ¼na wysÅ‚aÄ‡ opinii\"],\"ABCjd9\":[\"Publikowanie\"],\"ADEin1\":[\"Ustawienia | Rozliczenia\"],\"ALhEZV\":[\"MoÅ¼e zapraszaÄ‡ czÅ‚onkÃ³w\"],\"ANyn0x\":[\"Wszystko, czego potrzebujesz, za darmo na zawsze. Nielimitowane tablice, nieograniczone listy i nieograniczone karty. MoÅ¼esz ulepszyÄ‡ w dowolnym momencie.\"],\"ARvBT/\":[\"rozliczane rocznie\"],\"ASjvm9\":[\"URL przestrzeni roboczej\"],\"AUYALh\":[\"JuÅ¼ wkrÃ³tce\"],\"AX4ktp\":[\"Tworzenie treÅ›ci\"],\"AZI/wb\":[\"Etykiety i filtry\"],\"AeXO77\":[\"Konto\"],\"Ax/hYa\":[\"Opis przestrzeni roboczej nie moÅ¼e przekraczaÄ‡ 280 znakÃ³w\"],\"B3xxao\":[\"Dodaj kartÄ™\"],\"BBUDfW\":[\"Pilne\"],\"BEVzjL\":[\"Import nie powiÃ³dÅ‚ siÄ™\"],\"BJbLe4\":[\"UÅ¼ywamy licencji <0>AGPL-3.0</0>.\"],\"BMkVQ3\":[\"usuniÄ™to listÄ™ kontrolnÄ… <0>\",[\"0\"],\"</0>\"],\"BOqTi5\":[\"przeniesiono kartÄ™ z <0>\",[\"0\"],\"</0> do<1>\",[\"1\"],\"</1>\"],\"BSZSHI\":[\"Board analytics (coming soon)\"],\"BZkYSt\":[\"usuniÄ™to \",[\"0\"],\" etykiety: <0>\",[\"labelList\"],\"</0>\"],\"BhDZlc\":[\"Czy na pewno chcesz usunÄ…Ä‡ obszar roboczy \",[\"0\"],\"?\"],\"Bhgd0l\":[\"Skontaktuj siÄ™ z nami\"],\"Bosey8\":[\"Change the language of the app.\"],\"BzEFor\":[\"lub\"],\"C56tim\":[\"Nie moÅ¼na zaktualizowaÄ‡ terminu\"],\"CAL6E9\":[\"ZespoÅ‚y\"],\"CB/NpV\":[\"Wysoki priorytet\"],\"CHZ1jC\":[\"usuniÄ™to element listy kontrolnej <0>\",[\"0\"],\"</0>\"],\"CJ3zUq\":[\"ProszÄ™ wprowadziÄ‡ poprawne imiÄ™\"],\"CJWDTP\":[\"Twoje konto Trello zostaÅ‚o odÅ‚Ä…czone.\"],\"CJukzS\":[[\"0\"],\" etykiety\"],\"CTqTgr\":[\"SkrÃ³ty\"],\"CYWHT+\":[\"BÅ‚Ä…d podczas przesyÅ‚ania zdjÄ™cia profilowego\"],\"Ci/KUX\":[\"Ustawienia | Obszar roboczy\"],\"CkVV1t\":[\"BÅ‚Ä…d podczas aktualizacji opisu przestrzeni roboczej\"],\"Cmudpi\":[\"MoÅ¼e usuwaÄ‡ obszar roboczy\"],\"CozWO1\":[\"Nazwa przestrzeni roboczej\"],\"D+NlUC\":[\"System\"],\"D0esZz\":[\"Dziennik aktywnoÅ›ci\"],\"D3C4Yx\":[\"Wymagane jest obecne hasÅ‚o\"],\"D7/JvJ\":[\"Dostosuj kwadratowy kadr, aby dopasowaÄ‡ do swojego awatara.\"],\"D9ROdV\":[\"Linki zaproszeÅ„\"],\"DAV3uK\":[\"Uprawnienia zaktualizowane\"],\"DFjdv0\":[\"UsuÅ„ szablon\"],\"DMeWZD\":[\"Czy na pewno chcesz usunÄ…Ä‡ ten \",[\"0\"],\"?\"],\"DPfwMq\":[\"Gotowe\"],\"DahTzR\":[\"Nie moÅ¼na usunÄ…Ä‡ listy kontrolnej\"],\"DbZgsJ\":[\"UtwÃ³rz szablon\"],\"DhLN1b\":[\"No boards\"],\"DtXlZq\":[\"Nie moÅ¼na zaktualizowaÄ‡ listy kontrolnej\"],\"E0t3jO\":[\"dodaÅ‚(a) element listy kontrolnej <0>\",[\"0\"],\"</0>\"],\"E8zYtd\":[\"usuniÄ™to przypisanie <0>\",[\"0\"],\"</0> z karty\"],\"ECJKc4\":[\"Utworzono klucz API\"],\"EEHmPC\":[\"Oferta startowa: Nieograniczona liczba czÅ‚onkÃ³w z Pro\"],\"EEQaqX\":[\"assigned <0>\",[\"memberName\"],\"</0> to the card\"],\"EH8IL3\":[\"Listy kontrolne\"],\"EM/caO\":[\"moved the card from <0>\",[\"fromList\"],\"</0> to<1>\",[\"toList\"],\"</1>\"],\"ERpq2P\":[\"Nie znaleziono wynikÃ³w dla â€\",[\"debouncedQuery\"],\"â€.\"],\"ESClHO\":[\"Priorytetowe wsparcie e-mail\"],\"Eg99Sc\":[\"Obecnie brak dostÄ™pnych metod uwierzytelniania\"],\"EifmPY\":[\"To Do, In Progress, Done\"],\"Eit43O\":[\"ustawiono termin\"],\"EkH9pt\":[\"Aktualizuj\"],\"EvArWh\":[\"WspÃ³Å‚pracuj pÅ‚ynnie ze swoim zespoÅ‚em.\"],\"F/FPk/\":[\"Ustawienia | Uprawnienia\"],\"F/Fhz0\":[\"Create Pro workspace\"],\"F/vB2g\":[\"PomysÅ‚y na ulepszenie tej strony...\"],\"F3bW6y\":[\"Platforma\"],\"F4KRmY\":[\"8 USD/miesiÄ…c\"],\"F4PLG4\":[\"Opis przestrzeni roboczej zostaÅ‚ zaktualizowany\"],\"F8DaWi\":[\"Tylko podglÄ…d\"],\"FEr96N\":[\"Motyw\"],\"FUltnF\":[\"Niestandardowe szablony\"],\"FdtSNC\":[\"UtwÃ³rz przestrzeÅ„ roboczÄ…\"],\"FmN5me\":[\"Rezolucja\"],\"FmfJjN\":[\"Zobacz i zarzÄ…dzaj swoimi kluczami API.\"],\"Fpci8b\":[\"Czy na pewno chcesz usunÄ…Ä‡ tÄ™ listÄ™ kontrolnÄ…?\"],\"G1Gw0v\":[\"Nowy szablon\"],\"GAD3Dx\":[\"Niestandardowa domena\"],\"GDvlUT\":[\"Rola\"],\"GXsAby\":[\"Revoke\"],\"GYv20o\":[\"Nie moÅ¼na zaktualizowaÄ‡ uprawnieÅ„\"],\"Gd7sEW\":[\"Niestandardowy link do przestrzeni roboczej\"],\"GnRmu4\":[\"Nazwa listy kontrolnej\"],\"GnSSGm\":[\"Opis twojej przestrzeni roboczej zostaÅ‚ zaktualizowany.\"],\"GoDLB9\":[\"Twoje konto zostaÅ‚o usuniÄ™te.\"],\"Gxxi5J\":[\"Dodaj listÄ™ kontrolnÄ…\"],\"H5G+qG\":[\"Jaka jest rÃ³Å¼nica miÄ™dzy Kan a Trello?\"],\"HBI6nY\":[\"Potrzebujesz pomocy?\"],\"HO+uOC\":[\"Sortowanie\"],\"HVIzNO\":[\"MoÅ¼e wyÅ›wietlaÄ‡ listy\"],\"HYV6Lq\":[\"Nie udaÅ‚o siÄ™ zaakceptowaÄ‡ zaproszenia. SprÃ³buj ponownie pÃ³Åºniej lub skontaktuj siÄ™ z dziaÅ‚em obsÅ‚ugi klienta.\"],\"HeFWjW\":[\"NastÄ™pne kroki\"],\"Hg1qE9\":[\"Slug twojej przestrzeni roboczej zostaÅ‚ zaktualizowany.\"],\"I+AROe\":[\"MoÅ¼e edytowaÄ‡ karty\"],\"I0gAKM\":[\"Nie moÅ¼na zaktualizowaÄ‡ listy\"],\"IDvohQ\":[\"oznaczyÅ‚ element listy kontrolnej jako nieukoÅ„czony\"],\"IFgUX6\":[\"MoÅ¼e usuwaÄ‡ czÅ‚onkÃ³w\"],\"IelE1h\":[\"Ulepsz do planu Pro\"],\"IqjpYe\":[\"WidocznoÅ›Ä‡ adresu e-mail\"],\"IrZaAn\":[\"HasÅ‚o zostaÅ‚o zmienione\"],\"J/hVSQ\":[[\"0\"]],\"J2Wbjt\":[\"Kontynuuj z \"],\"J5nbej\":[\"Krytyczne\"],\"J5pbP6\":[\"MoÅ¼e edytowaÄ‡ role i uprawnienia czÅ‚onkÃ³w\"],\"JArWcF\":[[\"0\"],\" | \",[\"1\"]],\"JCdzgZ\":[\"ProÅ›ba o funkcjÄ™\"],\"JUce1S\":[\"Osoby przypisane\"],\"JbXXUW\":[\"PamiÄ™taj, Å¼e ta akcja jest nieodwracalna.\"],\"JcCDm9\":[\"Szablon utworzony\"],\"Jgaz7E\":[\"Uprawnienia zresetowane\"],\"JlFcis\":[\"Send\"],\"JnWJXY\":[\"magiczny link\"],\"JxhWxU\":[\"w\"],\"JyXBgS\":[\"dokumentacja\"],\"K3iLeO\":[\"Zobacz, co nasi uÅ¼ytkownicy mÃ³wiÄ… o Kan\"],\"KAsRdK\":[\"PrzejdÅº do czÅ‚onkÃ³w\"],\"KFJgmZ\":[\"WyÅ›wietlana nazwa musi mieÄ‡ co najmniej 3 znaki\"],\"KLJ4eD\":[\"Link zaproszenia skopiowany\"],\"KNKCTb\":[\"ZalegÅ‚oÅ›ci\"],\"KiVc+q\":[\"PeÅ‚ny etat\"],\"KuSt9W\":[\"Jak samodzielnie hostowaÄ‡?\"],\"L5ZPjz\":[\"zaktualizowano element listy kontrolnej\"],\"LTGE7Y\":[\"Obszar roboczy zostaÅ‚ pomyÅ›lnie utworzony. MoÅ¼esz go ulepszyÄ‡ pÃ³Åºniej w ustawieniach.\"],\"LeM5RY\":[\"Nie moÅ¼na wyczyÅ›ciÄ‡ nadpisaÅ„\"],\"LoUCpj\":[\"BÅ‚Ä…d podczas aktualizacji nazwy przestrzeni roboczej\"],\"LqWW5F\":[\"Twoja nazwa wyÅ›wietlana zostaÅ‚a zaktualizowana.\"],\"LrcnbT\":[\"Hostuj Kan na wÅ‚asnej infrastrukturze. Idealne dla organizacji, ktÃ³re potrzebujÄ… peÅ‚nej kontroli nad swoimi danymi.\"],\"Ls++vT\":[\"Szybki i lekki\"],\"Lt+ZP3\":[\"ukoÅ„czono element listy kontrolnej\"],\"M43OaK\":[\"Upgrade to Team Plan\"],\"M9p3Vw\":[\"Nieograniczony dziennik aktywnoÅ›ci\"],\"MFKlMB\":[\"ZaproÅ›\"],\"MHrjPM\":[\"TytuÅ‚\"],\"MI5OBT\":[\"Adres URL moÅ¼e zawieraÄ‡ tylko litery, cyfry i myÅ›lniki\"],\"MK16u2\":[\"Brak terminÃ³w\"],\"MKAScN\":[\"MoÅ¼e wyÅ›wietlaÄ‡ tablice\"],\"MN6YzG\":[\"Slug przestrzeni roboczej zostaÅ‚ zaktualizowany\"],\"MWrbWq\":[\"Ustawienia | Konto\"],\"MdN5zD\":[\"Musisz byÄ‡ administratorem, aby zarzÄ…dzaÄ‡ uprawnieniami przestrzeni roboczej.\"],\"MdwUGG\":[\"OszczÄ™dzaj czas przy tworzeniu powtarzalnych tablic dziÄ™ki szablonom.\"],\"MeO/vH\":[\"Spowoduje to trwaÅ‚e usuniÄ™cie wszystkich danych powiÄ…zanych z tym obszarem roboczym.\"],\"MlyjJu\":[\"WyÅ›wietlana nazwa nie moÅ¼e przekraczaÄ‡ 280 znakÃ³w\"],\"MxQXhL\":[\"Nie moÅ¼na utworzyÄ‡ przestrzeni roboczej\"],\"N/bcWA\":[\"Zaloguj siÄ™ | kan.bn\"],\"N3380t\":[\"MoÅ¼e tworzyÄ‡ tablice\"],\"N7aud6\":[\"Inteligentne wyszukiwanie\"],\"NH54UR\":[\"zmieniono nazwÄ™ elementu listy kontrolnej na <0>\",[\"0\"],\"</0>\"],\"NgaR6B\":[\"WprowadÅº swoje hasÅ‚o\"],\"NypLoL\":[\"zmieniono nazwÄ™ listy kontrolnej\"],\"O0li0W\":[\"WprowadÅº swoje obecne hasÅ‚o i wybierz nowe, bezpieczne hasÅ‚o.\"],\"O1wAlQ\":[\"GoÅ›Ä‡\"],\"O3oNi5\":[\"Email\"],\"O83K21\":[\"dodaÅ‚(a) element listy kontrolnej\"],\"O9jVbx\":[\"Niski priorytet\"],\"OAYToL\":[\"To usunie wszystkie niestandardowe uprawnienia czÅ‚onkÃ³w w tym obszarze roboczym. CzÅ‚onkowie bÄ™dÄ… dziedziczyÄ‡ uprawnienia tylko ze swoich rÃ³l.\"],\"OIA0ad\":[\"Nazwa przestrzeni roboczej zostaÅ‚a zaktualizowana\"],\"OZtEcz\":[\"API\"],\"OpNhRn\":[\"Nie wymagana karta kredytowa\"],\"OtjenF\":[\"ProszÄ™ wprowadziÄ‡ prawidÅ‚owy adres e-mail\"],\"OvoEq7\":[\"CzÅ‚onek\"],\"Ozt2vv\":[\"Twoje hasÅ‚o zostaÅ‚o zmienione.\"],\"P6dJdq\":[\"Nadpisania wyczyszczone\"],\"P8bryV\":[\"New Ticket, Triaging, In Progress, Awaiting Customer, Resolution, Done\"],\"PCIlOO\":[\"Dodaj czÅ‚onka\"],\"PRjvDT\":[\"Czy na pewno chcesz usunÄ…Ä‡ ten komentarz?\"],\"PRofO0\":[\"Edytuj wideo YouTube\"],\"PTzsxH\":[\"WidocznoÅ›Ä‡ tablicy zostaÅ‚a zaktualizowana\"],\"PZCqeW\":[\"ProszÄ™ sprÃ³bowaÄ‡ ponownie pÃ³Åºniej.\"],\"Pa9/o1\":[\"Create API keys to access the Kan API.\"],\"PpZkda\":[\"Funkcje\"],\"PyYD/v\":[\"przypisano <0>\",[\"0\"],\"</0> do karty\"],\"Q9pQaX\":[\"Nie znaleziono jeszcze Å¼adnych rÃ³l dla tego obszaru roboczego.\"],\"QD8opX\":[\"Tablica\"],\"QHhZeE\":[\"Szablon zostaÅ‚ pomyÅ›lnie utworzony\"],\"QNtP5M\":[\"UÅ¼yj szablonu\"],\"Qh7QmR\":[\"UsuniÄ™to z ulubionych\"],\"QtACvI\":[\"UtwÃ³rz etykietÄ™\"],\"Qtzfdk\":[\"Plan Pro âˆ\"],\"R+w/Va\":[\"Rozliczenia\"],\"R1c3Mq\":[\"Nazwa tablicy jest wymagana\"],\"R275Pz\":[\"Masz nielimitowanÄ… liczbÄ™ miejsc w swoim planie Pro. Nie ma dodatkowych opÅ‚at za nowych czÅ‚onkÃ³w!\"],\"R3FsF4\":[\"Pobieranie nie powiodÅ‚o siÄ™\"],\"R6pB8R\":[\"Oznacz gwiazdkÄ… na Githubie\"],\"RHZu7R\":[\"Uwielbiane przez zespoÅ‚y na caÅ‚ym Å›wiecie\"],\"RJA+sg\":[\"Nowe zgÅ‚oszenie\"],\"RRn9jf\":[\"Kliknij w link, ktÃ³ry wysÅ‚aliÅ›my na \",[\"magicLinkRecipient\"],\", aby siÄ™ zalogowaÄ‡.\"],\"RSGOS1\":[\"MoÅ¼e usuwaÄ‡ listy\"],\"RfgJqw\":[\"zaktualizowano termin\"],\"RkXlPZ\":[\"GitHub\"],\"RoafuO\":[\"PrzeÅ›lij opiniÄ™\"],\"RtlIYB\":[\"Zaraz zmienisz swoje hasÅ‚o.\"],\"SFnH1j\":[\"Dlaczego prÃ³bujecie stworzyÄ‡ Trello w wersji otwartoÅºrÃ³dÅ‚owej?\"],\"SKqXzW\":[\"added label <0>\",[\"label\"],\"</0>\"],\"SMaFdc\":[\"Wypisz siÄ™\"],\"SNfg0e\":[\"MoÅ¼e wyÅ›wietlaÄ‡ obszar roboczy\"],\"SPLN9O\":[\"Ty posiadasz swoje dane\"],\"STSYcd\":[\"MoÅ¼e usuwaÄ‡ komentarze\"],\"SWEskc\":[\"Adres URL musi mieÄ‡ co najmniej 3 znaki\"],\"Sb2gYF\":[\"Nowa lista\"],\"ScJ9fj\":[\"Polityka prywatnoÅ›ci\"],\"Se/UIp\":[\"Do zrobienia\"],\"SkCNhl\":[\"Wyszukaj tablice i karty...\"],\"SlfejT\":[\"BÅ‚Ä…d\"],\"T/pF0Z\":[\"UsuÅ„ z ulubionych\"],\"T21jY/\":[\"dodaÅ‚(a) etykietÄ™ do karty\"],\"T7DJ2k\":[\"Nie moÅ¼na dodaÄ‡ komentarza\"],\"T7LJic\":[\"przeniesiono kartÄ™ do innej listy\"],\"T7Mywq\":[\"Nie moÅ¼na zaktualizowaÄ‡ tablicy\"],\"TCOMOO\":[\"Edytuj uprawnienia\"],\"TFv5tM\":[\"Nie moÅ¼na zaktualizowaÄ‡ roli\"],\"TH3Irz\":[\"Uprawnienie\"],\"TKFUnX\":[\"Konto zostaÅ‚o usuniÄ™te\"],\"TXO5TM\":[\"Brak zarejestrowanych skrÃ³tÃ³w klawiaturowych.\"],\"TYli1B\":[\"MoÅ¼e edytowaÄ‡ komentarze\"],\"TbjyhA\":[\"Dokumentacja\"],\"TcXcmk\":[\"PrzeglÄ…d kodu\"],\"TjREUS\":[\"Nowy klucz API\"],\"TmvrjU\":[\"Adres URL tablicy musi mieÄ‡ co najmniej 3 znaki\"],\"TvY/XA\":[\"Dokumentacja\"],\"Tz0i8g\":[\"Ustawienia\"],\"TztLaN\":[\"Nie moÅ¼na utworzyÄ‡ listy\"],\"U3pytU\":[\"Administrator\"],\"U5dMR6\":[\"Zobacz obszar roboczy\"],\"UCLeG0\":[\"Warunki korzystania z usÅ‚ugi\"],\"UQbwrz\":[\"Wszystkie systemy dziaÅ‚ajÄ… poprawnie\"],\"URAE3q\":[\"Wstrzymane\"],\"USVCGU\":[\"BÅ‚Ä…d podczas dezaktywacji linku zaproszenia\"],\"UbRKMZ\":[\"OczekujÄ…ce\"],\"UbYdrA\":[\"CzÄ™stotliwoÅ›Ä‡ pÅ‚atnoÅ›ci\"],\"UeDFpo\":[\"Jak projekt jest finansowany?\"],\"UlhdTP\":[\"Obszar roboczy zostaÅ‚ usuniÄ™ty\"],\"Un80BR\":[\"Przyjaciele OSS\"],\"UveK6V\":[\"PrzejdÅº do aplikacji\"],\"Uworke\":[\"NiepeÅ‚ny etat\"],\"UxKoFf\":[\"Nawigacja\"],\"V3MPSQ\":[\"zaktualizowano tytuÅ‚\"],\"V8YWP3\":[\"WprowadÅº wÅ‚asny tytuÅ‚\"],\"VHS0aJ\":[\"WyczyÅ›ciÄ‡ wszystkie niestandardowe uprawnienia?\"],\"VKoDQD\":[\"UtwÃ³rz nowy \",[\"0\"]],\"VUZDlr\":[\"Opinie\"],\"VXk54Y\":[\"przypisaÅ‚(a) sobie kartÄ™\"],\"VbyRUy\":[\"Komentarze\"],\"VhMDMg\":[\"ZmieÅ„ hasÅ‚o\"],\"Vt50G1\":[\"Podstawowy Kanban\"],\"W/Elkg\":[\"Åšredni priorytet\"],\"W/nQk1\":[\"Darmowy plan\"],\"W5r8Qh\":[\"usuniÄ™to element listy kontrolnej\"],\"W8oT+L\":[\"Nie udaÅ‚o siÄ™ pobraÄ‡ informacji o wideo\"],\"WHHLh9\":[\"Nie moÅ¼na usunÄ…Ä‡ zaÅ‚Ä…cznika\"],\"WI4eGo\":[\"Jak uzyskaÄ‡ niestandardowy URL?\"],\"WQPDcG\":[\"Nie moÅ¼na zaktualizowaÄ‡ elementu listy kontrolnej\"],\"WRkpB1\":[\"Rejestracja wyÅ‚Ä…czona\"],\"WRsbHO\":[\"Twoje konto Trello jest poÅ‚Ä…czone.\"],\"WYDptz\":[\"Wymagana subskrypcja\"],\"WYwN1G\":[\"Nowy import\"],\"WbTDwg\":[\"W toku\"],\"Weq9zb\":[\"OgÃ³lne\"],\"WmPhYW\":[\"WystÄ…piÅ‚ bÅ‚Ä…d podczas odÅ‚Ä…czania konta Trello.\"],\"WnEwDO\":[\"Masz juÅ¼ konto? <0><1>Zaloguj siÄ™</1></0>\"],\"Wy6pcF\":[\"Nie moÅ¼na zaktualizowaÄ‡ widocznoÅ›ci tablicy\"],\"X0N0PA\":[\" (edytowano)\"],\"XDRXbZ\":[\"Opis przestrzeni roboczej musi mieÄ‡ co najmniej 3 znaki\"],\"XILg0L\":[\"NieprawidÅ‚owy adres e-mail\"],\"XJOV1Y\":[\"AktywnoÅ›Ä‡\"],\"XTKtey\":[\"UtwÃ³rz listÄ™\"],\"XXbgHS\":[\"Zatrudniony\"],\"XYLcNv\":[\"Wsparcie\"],\"XicmhT\":[\"Termin\"],\"Xid3K6\":[\"Adres URL tablicy moÅ¼e zawieraÄ‡ tylko litery, cyfry i myÅ›lniki\"],\"Xjj/kS\":[\"Kanban wymyÅ›lony na nowo\"],\"XpcjLO\":[\"Nie moÅ¼na zaktualizowaÄ‡ adresu URL tablicy\"],\"XyuOHa\":[\"UdostÄ™pnianie tablicy i zaproszenia\"],\"YBBifR\":[\"OdÅ‚Ä…cz Trello\"],\"YKeYae\":[\"Nie moÅ¼na zmieniÄ‡ kolejnoÅ›ci elementu listy kontrolnej\"],\"YQqv2e\":[\"Get started by creating a new board\"],\"YVT40D\":[\"usuniÄ™to etykietÄ™ <0>\",[\"0\"],\"</0>\"],\"YaZDYI\":[\"BÅ‚Ä…d podczas aktualizacji subskrypcji\"],\"YcyP2z\":[\"Nie moÅ¼na utworzyÄ‡ szablonu\"],\"Yf9FAx\":[\"Nie bÄ™dÄ… mieli dostÄ™pu do tego obszaru roboczego.\"],\"YhvWXb\":[\"Analiza tablicy\"],\"YirHq7\":[\"Opinie\"],\"YoyKbT\":[\"Ten klucz API zostanie wyÅ›wietlony tylko raz. ProszÄ™ zapisaÄ‡ go w bezpiecznym miejscu.\"],\"YtUfwW\":[\"Nie udaÅ‚o siÄ™ zalogowaÄ‡ za pomocÄ… \",[\"0\"],\". SprÃ³buj ponownie.\"],\"Z3FXyt\":[\"Åadowanie...\"],\"Z3krJD\":[\"ZezwÃ³l czÅ‚onkom workspace'u na widocznoÅ›Ä‡ swoich adresÃ³w e-mail\"],\"Z6r9z1\":[\"Nie moÅ¼na usunÄ…Ä‡ karty\"],\"Z7/Xyy\":[\"Applicants, Screening, Interviewing, Offer, Onboarding, Hired\"],\"ZDGm40\":[\"UsuÅ„ konto\"],\"ZDIydz\":[\"Rozpocznij\"],\"ZDo4HN\":[\"Burza mÃ³zgÃ³w\"],\"ZH7TVS\":[\"TytuÅ‚ karty\"],\"ZL1A+p\":[\"Nie udaÅ‚o siÄ™ przesÅ‚aÄ‡ zaÅ‚Ä…cznika. ProszÄ™ sprÃ³bowaÄ‡ ponownie.\"],\"ZT4Khw\":[\"Czy na pewno chcesz usunÄ…Ä‡ tÄ™ kartÄ™?\"],\"ZU5IYI\":[\"Nieograniczona liczba tablic, list i kart. Nie wymaga karty kredytowej.\"],\"ZXSPJt\":[\"WystÄ…piÅ‚ nieoczekiwany bÅ‚Ä…d. SprÃ³buj ponownie pÃ³Åºniej.\"],\"ZqDqbi\":[\"Organizuj i znajduj karty szybko dziÄ™ki zaawansowanym narzÄ™dziom filtrowania.\"],\"Zz1qkk\":[\"Nieograniczona liczba kart\"],\"aHCEmh\":[\"Cennik\"],\"aHRWVI\":[\"usuniÄ™to termin\"],\"aJ4pMe\":[\"Pytania i Odpowiedzi\"],\"aWDhU5\":[\"Kanban jest lepszy w zespole. Idealny dla maÅ‚ych i rozwijajÄ…cych siÄ™ zespoÅ‚Ã³w, ktÃ³re chcÄ… wspÃ³Å‚pracowaÄ‡.\"],\"aWlSc/\":[\"UtwÃ³rz nowÄ… listÄ™\"],\"abUZlY\":[\"Dodaj szczegÃ³Å‚y...\"],\"aelko+\":[\"MoÅ¼esz uzyskaÄ‡ niestandardowy URL przestrzeni roboczej, taki jak <0>kan.bn/kan</0>, przechodzÄ…c do <1>ustawieÅ„ przestrzeni roboczej</1> i wykupujÄ…c subskrypcjÄ™ pro przestrzeni roboczej. Wszystkie subskrypcje wspierajÄ… rozwÃ³j projektu!\"],\"aiHZVP\":[\"Zobacz dokumentacjÄ™\"],\"aj40Mw\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users (free during the beta) and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"b/LfJo\":[\"email\"],\"b3Thhd\":[\"PrzesyÅ‚anie nie powiodÅ‚o siÄ™\"],\"b5FKyH\":[\"dodaÅ‚(a) etykietÄ™ <0>\",[\"0\"],\"</0>\"],\"b9XOHo\":[\"UtwÃ³rz \",[\"0\"]],\"bA2LQS\":[\"PodziaÅ‚ funkcji\"],\"bD8I7O\":[\"ZakoÅ„cz\"],\"bDI6VI\":[[\"0\"],\" zostaÅ‚o usuniÄ™te z ulubionych.\"],\"bJZm1W\":[\"Kandydaci\"],\"bJtM0P\":[\"Ten adres URL obszaru roboczego jest zarezerwowany\"],\"bZSICm\":[\"Nie moÅ¼na dodaÄ‡ elementu listy kontrolnej\"],\"bcIybO\":[\"Nazwa przestrzeni roboczej jest wymagana\"],\"bdztP2\":[\"Badania\"],\"bfZE+Y\":[\"Rola czÅ‚onka zostaÅ‚a zaktualizowana.\"],\"bff61F\":[\"Plan zespoÅ‚owy\"],\"bfgr/e\":[\"Pytanie\"],\"bgh/9n\":[\"moÅ¼e zarzÄ…dzaÄ‡ ustawieniami obszaru roboczego\"],\"bmXKoX\":[\"dodano \",[\"0\"],\" etykiety: <0>\",[\"labelList\"],\"</0>\"],\"bqAQaT\":[\"BÅ‚Ä…d podczas usuwania konta\"],\"c/IAuR\":[\"WaÅ¼ne\"],\"c3b0B0\":[\"Rozpocznij\"],\"c9AJhn\":[\"DoÅ‚Ä…cz do Å›rodowiska pracy\"],\"cAgBMh\":[\"PeÅ‚na kontrola i wÅ‚asnoÅ›Ä‡:\"],\"cFQEU/\":[\"OtwÃ³rz skrÃ³ty klawiaturowe\"],\"cOh+MI\":[\"Selekcja\"],\"cWcxrL\":[\"Nowa lista kontrolna\"],\"cWtfn1\":[\"Ulepsz do planu Pro (29 USD/miesiÄ…c)\"],\"chyf4J\":[\"Opis obszaru roboczego\"],\"cji2nM\":[\"BÅ‚Ä…d podczas tworzenia linku zaproszenia\"],\"cnGeoo\":[\"UsuÅ„\"],\"cp1rsD\":[\"Dezaktywuj link zaproszenia\"],\"csFbe+\":[\"PrzejdÅº do szablonÃ³w\"],\"curoK5\":[\"Nowa przestrzeÅ„ robocza\"],\"d33Usy\":[\"UtwÃ³rz listÄ™ kontrolnÄ…\"],\"d7XqZJ\":[\"A powerful, flexible kanban app that helps you organise work,\\n              track progress, and deliver resultsâ€”all in one place.\"],\"dEgA5A\":[\"Anuluj\"],\"dUh9QW\":[\"Planowanie\"],\"ddrz1m\":[\"ZalegÅ‚e\"],\"delOXn\":[\"Nie moÅ¼na zaktualizowaÄ‡ etykiet\"],\"dgr4Kq\":[\"Edytuj etykietÄ™\"],\"dmKdk0\":[\"Po usuniÄ™ciu przestrzeni roboczej nie bÄ™dzie moÅ¼liwoÅ›ci jej przywrÃ³cenia. Tej operacji nie moÅ¼na cofnÄ…Ä‡.\"],\"dsLT3m\":[\"UtwÃ³rz kartÄ™\"],\"dtbpdR\":[\"Trello\"],\"duf3Nr\":[\"Ten adres URL obszaru roboczego jest juÅ¼ zajÄ™ty\"],\"e12o5C\":[\"Invite another\"],\"e4hPSt\":[\"PrzywrÃ³Ä‡ domyÅ›lne ustawienia roli\"],\"eEQyz+\":[\"ÅšledÅº wszystkie zmiany kart z szczegÃ³Å‚owÄ… historiÄ… aktywnoÅ›ci.\"],\"ePK91l\":[\"Edytuj\"],\"eZCGbT\":[\"Tak, oferujemy wiecznie darmowy plan dla uÅ¼ytkownikÃ³w indywidualnych. Bez ograniczeÅ„, bez pÅ‚atnych Å›cian, bez limitÃ³w.\"],\"edWbV6\":[\"Link skopiowany\"],\"en3oy5\":[\"Funkcja\"],\"evg7+A\":[\"Twoje tablice zostaÅ‚y zaimportowane.\"],\"evj0lK\":[\"Czy oferujecie darmowy plan?\"],\"f8fH8W\":[\"Projekt\"],\"f8lDFq\":[\"utworzyÅ‚(a) kartÄ™\"],\"fEY2vP\":[\"Nie moÅ¼na byÅ‚o znaleÅºÄ‡ karty\"],\"fJxqi6\":[\"Custom URLs require Pro plan ($29/month)\"],\"fQCrjt\":[\"WidocznoÅ›Ä‡ Twojej tablicy zostaÅ‚a ustawiona na \",[\"0\"],\".\"],\"fR9laE\":[\"WprowadÅº swoje obecne hasÅ‚o\"],\"fSf2ee\":[\"Zobacz nasz plan ulepszeÅ„.\"],\"fYVH36\":[\"Nie moÅ¼na zaktualizowaÄ‡ komentarza\"],\"fvLNDy\":[\"Nie utworzono jeszcze Å¼adnych list\"],\"fziA2d\":[\"Nieograniczona liczba komentarzy\"],\"g2xBxu\":[\"Importowanie tablic Trello do Kan jest proste. MoÅ¼esz skorzystaÄ‡ z naszego przewodnika krok po kroku <0>tutaj</0>.\"],\"gGx5tM\":[\"Edycja\"],\"gL/7jw\":[\"Dodaj opis... (wpisz '/' aby otworzyÄ‡ polecenia lub '@' aby wspomnieÄ‡)\"],\"gUX7b+\":[\"Otwarta alternatywa <0/> dla Trello\"],\"gZxH/p\":[\"zmieniono termin na <0>\",[\"formattedDate\"],\"</0>\"],\"ghSJ4U\":[\"Nazwa przestrzeni roboczej nie moÅ¼e przekraczaÄ‡ 64 znakÃ³w\"],\"gkzAEM\":[\"Kontynuuj z \",[\"0\"]],\"goklcJ\":[\"Rozmowy kwalifikacyjne\"],\"gpfJ3v\":[\"Darmowy, na zawsze\"],\"gukxZ5\":[\"Wprowadzenie\"],\"gv5kbo\":[\"Adres URL tablicy nie moÅ¼e przekraczaÄ‡ 60 znakÃ³w\"],\"h16FyT\":[\"Listy\"],\"h2FKMV\":[\"Nie masz uprawnieÅ„\"],\"h4VV67\":[\"dodaÅ‚ listÄ™ kontrolnÄ…\"],\"h7MgpO\":[\"SkrÃ³ty klawiaturowe\"],\"h8DugX\":[\"Etykiety\"],\"hAMddS\":[\"usunÄ™li swoje przypisanie z karty\"],\"hXMFoN\":[\"Brak list\"],\"hYzsXr\":[\"Ustawienia | Integracje\"],\"hh61gL\":[\"Importuj z Trello\"],\"iFxrHK\":[\"Find answers to common questions about the project. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"iHcdea\":[\"Termin w przyszÅ‚ym tygodniu\"],\"iLbjv+\":[\"MoÅ¼e edytowaÄ‡ obszar roboczy\"],\"iQmbPb\":[\"Licencja\"],\"iTylMl\":[\"Szablony\"],\"iVIGZb\":[\"ZaÅ‚Ä…cznik zostaÅ‚ przesÅ‚any\"],\"isRobC\":[\"Nowy\"],\"iwr7AP\":[\"PomysÅ‚y\"],\"iy1wb+\":[\"Ustawienia | API\"],\"j2+d/o\":[\"Dokumentacja API\"],\"j9IZZ0\":[\"Niestandardowy adres URL przestrzeni roboczej\"],\"jDRt4n\":[\"Czy chcesz siÄ™ wypisaÄ‡?\"],\"jL82rC\":[\"WyczyÅ›Ä‡ niestandardowe uprawnienia\"],\"jNuzV/\":[\"MoÅ¼e usuwaÄ‡ karty\"],\"jQ6I8X\":[\"Rola zaktualizowana\"],\"jZBHkN\":[\"Nazwa przestrzeni roboczej musi mieÄ‡ co najmniej 3 znaki\"],\"jfC/xh\":[\"Kontakt\"],\"jkbHit\":[\"around the world\"],\"jl3aEJ\":[\"oznaczyÅ‚ element listy kontrolnej <0>\",[\"0\"],\"</0> jako nieukoÅ„czony\"],\"jlB2RY\":[\"Wprowadzone obecne hasÅ‚o jest nieprawidÅ‚owe.\"],\"jwI32v\":[\"Tablica nie zostaÅ‚a znaleziona\"],\"kECVpo\":[\"Czy na pewno chcesz usunÄ…Ä‡ tÄ™ etykietÄ™?\"],\"kQwvU8\":[\"usunÄ…Å‚ etykietÄ™ z karty\"],\"kSxwQL\":[\"MoÅ¼esz zaprosiÄ‡ czÅ‚onkÃ³w zespoÅ‚u, klikajÄ…c przycisk \\\"ZaproÅ›\\\" w prawym gÃ³rnym rogu <0>strony czÅ‚onkÃ³w</0> i wpisujÄ…c ich adres e-mail. OtrzymajÄ… oni e-mail z linkiem do doÅ‚Ä…czenia do przestrzeni roboczej.\"],\"kYu0eF\":[\"UsuÅ„ przestrzeÅ„ roboczÄ…\"],\"kfOGMr\":[\"Szybkie zwyciÄ™stwo\"],\"klpSmb\":[\"Edytuj URL przestrzeni roboczej\"],\"kp6L3T\":[\"Ta nazwa uÅ¼ytkownika obszaru roboczego jest juÅ¼ zajÄ™ta\"],\"kryGs+\":[\"Karta\"],\"kuoc68\":[\"10 USD/miesiÄ…c\"],\"kwkhPe\":[\"Upgrade\"],\"kxEs5t\":[\"Importy Trello\"],\"l2PIAy\":[\"Hostuj samodzielnie z Github\"],\"l31EoQ\":[\"ZnajdÅº odpowiedzi na czÄ™sto zadawane pytania dotyczÄ…ce Kan. Nie moÅ¼esz znaleÅºÄ‡ tego, czego szukasz? Skontaktuj siÄ™ z nami <0>tutaj</0>.\"],\"l3s5ri\":[\"Importuj\"],\"l4asa1\":[\"Ta tablica jest prywatna lub nie istnieje\"],\"lGjicL\":[\", lub zobacz nasze\"],\"lKAvEd\":[\"BÅ‚Ä…d podczas odÅ‚Ä…czania Trello\"],\"lSNkXg\":[\"All seats are free during the beta until Sept 1st!\"],\"lXvXNI\":[\"Nie udaÅ‚o siÄ™ skopiowaÄ‡ linku zaproszenia\"],\"lYT7pQ\":[\"UsuÅ„ listÄ™\"],\"lcokBr\":[\"NaleÅ¼y do Atlassian\"],\"lkz85l\":[\"GÅ‚Ã³wna rÃ³Å¼nica miÄ™dzy Kan a Trello polega na tym, Å¼e Kan jest oprogramowaniem otwartoÅºrÃ³dÅ‚owym, co pozwala kaÅ¼demu przeglÄ…daÄ‡, modyfikowaÄ‡ i wspÃ³Å‚tworzyÄ‡ nasz kod. Nasza oferta w chmurze nie nakÅ‚ada rÃ³wnieÅ¼ Å¼adnych ograniczeÅ„ na funkcje do uÅ¼ytku indywidualnego, podczas gdy Trello blokuje podstawowe funkcje, takie jak liczba tablic, ktÃ³re moÅ¼na utworzyÄ‡, za dodatkowymi kosztami.\"],\"lo8xBK\":[\"Czy na pewno chcesz usunÄ…Ä‡ \",[\"entityLabel\"],\"?\"],\"lpIMne\":[\"HasÅ‚a nie pasujÄ… do siebie\"],\"lsgnzd\":[\"BÅ‚Ä…d podczas aktualizacji do wersji Pro\"],\"lyqwgn\":[\"Dodaj etykietÄ™\"],\"m2nk0i\":[\"Prosty cennik\"],\"mErq7F\":[\"Zarejestruj siÄ™\"],\"mHhffx\":[\"Nie moÅ¼na utworzyÄ‡ listy kontrolnej\"],\"mTGd3+\":[\"usuniÄ™to listÄ™ kontrolnÄ…\"],\"mTwGOf\":[\"Ten link zaproszenia jest nieprawidÅ‚owy lub wygasÅ‚.\"],\"mU+M00\":[[\"0\"],\" zostaÅ‚o dodane do ulubionych.\"],\"mVZH9V\":[\"Kiedy Trello zostaÅ‚o uruchomione w 2011 roku, zachwyciÅ‚o wszystkich swojÄ… starannie zaprojektowanÄ… prostotÄ…, ale z biegiem lat straciÅ‚o swÃ³j urok i staÅ‚o siÄ™ czymÅ› bliÅ¼szym â€Jira Liteâ€. Ten projekt to nasza prÃ³ba odzyskania oryginalnej magii prostoty Trello w formie open source.\"],\"mZGPxt\":[\"Link zaproszenia skopiowany do schowka\"],\"mchgzf\":[\"ZostaÅ‚eÅ› pomyÅ›lnie zarejestrowany.\"],\"mgXgHu\":[\"PrzejdÅº do tablic\"],\"mwBdZ2\":[\"Spowoduje to trwaÅ‚e usuniÄ™cie wszystkich danych powiÄ…zanych z Twoim kontem.\"],\"mx8+1u\":[\"Nieograniczona liczba czÅ‚onkÃ³w\"],\"n+xLOH\":[\"ObsÅ‚uga klienta\"],\"n1GRql\":[\"Nowa etykieta\"],\"n1ekoW\":[\"Zaloguj siÄ™\"],\"n9V+ps\":[\"WprowadÅº swoje imiÄ™\"],\"nOhz3x\":[\"Wyloguj siÄ™\"],\"nabda1\":[\"UsuÅ„ kartÄ™\"],\"nbfdhU\":[\"Integracje\"],\"nhMhRr\":[\"DziÄ™kujemy za TwojÄ… opiniÄ™!\"],\"njJFtc\":[\"UsuÅ„ komentarz\"],\"nk7caK\":[\"PoÅ‚Ä…cz Trello\"],\"nol/Fb\":[\"Jak zaprosiÄ‡ czÅ‚onkÃ³w zespoÅ‚u?\"],\"notwF1\":[\"Nazwa szablonu nie moÅ¼e przekraczaÄ‡ 100 znakÃ³w\"],\"nq7q3Z\":[\"Nazwa klucza API nie moÅ¼e przekraczaÄ‡ 30 znakÃ³w\"],\"nqdIhs\":[\"Niestandardowe szablony tablic\"],\"nryrgW\":[\"Wszystkie nadpisania uprawnieÅ„ czÅ‚onkÃ³w zostaÅ‚y zresetowane do domyÅ›lnych ustawieÅ„ rÃ³l.\"],\"nxb+xc\":[\"unassigned <0>\",[\"memberName\"],\"</0> from the card\"],\"o+JCfN\":[\"Zaufany przez dynamiczne zespoÅ‚y<0/>na caÅ‚ym Å›wiecie\"],\"o7J4JM\":[\"Filtr\"],\"o9WLwO\":[\"Nie moÅ¼na zaktualizowaÄ‡ karty\"],\"oBndex\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"oVBq1w\":[\"na uÅ¼ytkownika/miesiÄ…c\"],\"oW13KZ\":[\"Rozpocznij za darmo juÅ¼ dziÅ›\"],\"oXpmwC\":[\"Samodzielnie hostowalne\"],\"odFCYX\":[\"NieprawidÅ‚owe zaproszenie\"],\"ohktr7\":[\"Komentarze i wzmianki\"],\"okpxfB\":[\"UtwÃ³rz nowy klucz\"],\"oyRjD/\":[\"Plan Pro\"],\"p/hk9N\":[\"ZostaÅ‚eÅ› pomyÅ›lnie zalogowany.\"],\"pBsoKL\":[\"Dodaj do ulubionych\"],\"pFGfsR\":[\"SprawdÅº niektÃ³re z naszych ulubionych projektÃ³w otwartoÅºrÃ³dÅ‚owych.\"],\"pFKC6A\":[\"Nazwa klucza API\"],\"pL78ec\":[\"Dodano do ulubionych\"],\"pXVFJy\":[\"MoÅ¼e usuwaÄ‡ tablice\"],\"pa9o5D\":[\"Przytnij swÃ³j awatar\"],\"pfa8F0\":[\"WyÅ›wietlana nazwa\"],\"pmUArF\":[\"Obszar roboczy\"],\"pnrmSP\":[\"Nowa karta\"],\"poDo/D\":[\"Create new board\"],\"ppaRWv\":[\"Hostuj samodzielnie\"],\"pvnfJD\":[\"Ciemny\"],\"q+lt9D\":[\"BÅ‚Ä…d podczas usuwania etykiety\"],\"qPP4lD\":[\"Zapraszanie czÅ‚onkÃ³w wymaga planu Team. Zostaniesz przekierowany, aby ulepszyÄ‡ swoje Å›rodowisko pracy.\"],\"qQXocp\":[\"MoÅ¼e zarzÄ…dzaÄ‡ ustawieniami obszaru roboczego\"],\"qfUS/w\":[\"Przyjaciele Open Source\"],\"qkjvgj\":[\"Twoja przestrzeÅ„ robocza zostaÅ‚a usuniÄ™ta.\"],\"qlAIQ1\":[\"Zdalne\"],\"qrT8WB\":[\"#1 Hacker News\"],\"qtE5nt\":[\"Dodaj element...\"],\"qzdST2\":[\"WidocznoÅ›Ä‡ tablicy\"],\"r6BgwX\":[\"HasÅ‚o jest wymagane do zalogowania siÄ™.\"],\"rD6UIt\":[\"Rozpocznij w chmurze\"],\"rF8SEQ\":[\"Edytuj komentarz\"],\"rRM7r0\":[\"Zaimportuj swoje tablice Trello i zacznij dziaÅ‚aÄ‡ od razu.\"],\"rYUZIe\":[\"Wybierz ÅºrÃ³dÅ‚o\"],\"raHesj\":[\"ZostaÅ‚eÅ› wypisany!\"],\"rarRW/\":[\"BÅ‚Ä…d podczas zapraszania czÅ‚onka\"],\"ri1hHe\":[\"Termin w przyszÅ‚ym miesiÄ…cu\"],\"rmN315\":[\"Zabawa\"],\"rs7L54\":[\"dodaÅ‚(a) czÅ‚onka do karty\"],\"rtbVvN\":[\"MoÅ¼e edytowaÄ‡ listy\"],\"s+MGs7\":[\"Zasoby\"],\"s6iE/c\":[\"Rejestracja jest obecnie wyÅ‚Ä…czona. SprÃ³buj ponownie pÃ³Åºniej.\"],\"sBhOFG\":[\"Proste, wizualne zarzÄ…dzanie zadaniami, ktÃ³re po prostu dziaÅ‚a. PrzeciÄ…gaj i upuszczaj karty, wspÃ³Å‚pracuj z zespoÅ‚em i rÃ³b wiÄ™cej.\"],\"sDLCvT\":[\"PoÅ‚Ä…cz swoje ulubione narzÄ™dzia, aby usprawniÄ‡ przepÅ‚yw pracy.\"],\"sDuhfK\":[\"Oferta startowa: nieograniczona liczba miejsc za jedyne 29 USD/miesiÄ…c z Pro\"],\"sUZo7y\":[\"Zarejestruj siÄ™ | kan.bn\"],\"sVBn4K\":[\"BÅ‚Ä…d podczas aktualizacji wyÅ›wietlanej nazwy\"],\"sY2lzr\":[\"Brak dostÄ™pnego URL do pobrania tego zaÅ‚Ä…cznika.\"],\"seaklU\":[\"Boards | \",[\"0\"]],\"t+R8+P\":[\"Wykonanie\"],\"t/YqKh\":[\"UsuÅ„\"],\"t2nDzl\":[\"Zobacz i zarzÄ…dzaj swoimi pÅ‚atnoÅ›ciami i subskrypcjÄ….\"],\"t6FvJH\":[\"MoÅ¼e dodawaÄ‡ komentarze\"],\"tGwwnq\":[\"zaktualizowano opis\"],\"tHcbLF\":[\"MoÅ¼e edytowaÄ‡ tablice\"],\"tHjBUm\":[\"Kan\"],\"tIdipJ\":[\"Edytuj URL tablicy\"],\"tMYIu7\":[\"Dzienniki aktywnoÅ›ci\"],\"tTbref\":[\"HasÅ‚o jest wymagane do rejestracji.\"],\"tYN21H\":[\"UÅ¼ytkownik jest juÅ¼ czÅ‚onkiem tego obszaru roboczego\"],\"tca56/\":[\"TwÃ³j plik zostaÅ‚ pomyÅ›lnie przesÅ‚any.\"],\"tfDRzk\":[\"Zapisz\"],\"tmlJN1\":[\"WprowadÅº poprawny adres URL YouTube\"],\"tmpW+w\":[\"UsuÅ„ tablicÄ™\"],\"tyHiOa\":[\"ProszÄ™ sprÃ³bowaÄ‡ ponownie pÃ³Åºniej lub skontaktowaÄ‡ siÄ™ z obsÅ‚ugÄ… klienta.\"],\"u2+JIh\":[\"Niestandardowe adresy URL wymagajÄ… przejÅ›cia na plan Pro\"],\"u8JHrO\":[\"WyczyÅ›Ä‡ filtry\"],\"uOqaMC\":[\"ZostaÅ‚eÅ› zaproszony do doÅ‚Ä…czenia do przestrzeni roboczej.\"],\"uXGLuq\":[\"UtwÃ³rz klucz API\"],\"uZg2+w\":[\"ZwiÄ™ksz moÅ¼liwoÅ›ci swojego obszaru roboczego za jedyne 29 USD/miesiÄ…c. Oto, co otrzymasz:\"],\"uck1tz\":[\"usunÄ…Å‚ czÅ‚onka z karty\"],\"usVytm\":[\"Po usuniÄ™ciu konta nie bÄ™dzie moÅ¼liwoÅ›ci jego przywrÃ³cenia. Tej operacji nie moÅ¼na cofnÄ…Ä‡.\"],\"uwBBCy\":[\"Kan jest lepszy w zespole. Idealny dla maÅ‚ych i rozwijajÄ…cych siÄ™ zespoÅ‚Ã³w, ktÃ³re chcÄ… wspÃ³Å‚pracowaÄ‡.\"],\"v+Wp++\":[\"OtwartoÅºrÃ³dÅ‚owe\"],\"v3YoMA\":[\"Starszy\"],\"vAR/I8\":[\"Uruchom na wÅ‚asnej infrastrukturze\"],\"vAj6xG\":[\"MoÅ¼esz hostowaÄ‡ samodzielnie, postÄ™pujÄ…c zgodnie z instrukcjami w naszym <0>repozytorium</0>.\"],\"vMCCIc\":[\"Adres URL nie moÅ¼e przekraczaÄ‡ 24 znakÃ³w\"],\"vSJd18\":[\"Wideo\"],\"vUr5JT\":[\"Nie masz konta? <0><1>Zarejestruj siÄ™</1></0>\"],\"vXIe7J\":[\"JÄ™zyk\"],\"vXemf6\":[\"BÅ‚Ä…d\"],\"va/3u1\":[\"Kontroluj, kto moÅ¼e przeglÄ…daÄ‡ i edytowaÄ‡ twoje tablice.\"],\"vbskQn\":[\"Nazwa klucza API jest wymagana\"],\"veIDCY\":[\"Rozpocznij 14-dniowy bezpÅ‚atny okres prÃ³bny\"],\"vfRdCZ\":[\"Nie moÅ¼na zresetowaÄ‡ uprawnieÅ„\"],\"vgdzLf\":[\"UtwÃ³rz kolejny\"],\"vifyyw\":[\"Prawne\"],\"vlxQFL\":[\"Uprawnienia tego czÅ‚onka zostaÅ‚y przywrÃ³cone do domyÅ›lnych ustawieÅ„ roli.\"],\"vneRvS\":[\"rozliczenie miesiÄ™czne\"],\"vuxdLS\":[\"DÅ‚ugoterminowy\"],\"vwGkYB\":[\"HasÅ‚o musi mieÄ‡ co najmniej 8 znakÃ³w\"],\"wIb7Ng\":[\"RozwÃ³j oprogramowania\"],\"wIkTTk\":[\"Workspace name cannot exceed 24 characters\"],\"wM8xd8\":[\"Junior\"],\"wPZBpR\":[\"ProszÄ™ wybraÄ‡ plik do przesÅ‚ania.\"],\"wY+6Ye\":[\"Ten adres URL tablicy jest juÅ¼ zajÄ™ty\"],\"wakO3W\":[\"dodaÅ‚(a) listÄ™ kontrolnÄ… <0>\",[\"0\"],\"</0>\"],\"wewm3j\":[\"Nazwa tablicy nie moÅ¼e przekraczaÄ‡ 100 znakÃ³w\"],\"wgNoIs\":[\"Zaznacz wszystko\"],\"wlQNTg\":[\"CzÅ‚onkowie\"],\"wqkcin\":[\"MoÅ¼e wyÅ›wietlaÄ‡ komentarze\"],\"wqxglO\":[\"Nauka\"],\"wruKPE\":[\"Wspieraj rozwÃ³j projektu\"],\"wtxjAY\":[\"CzÅ‚onkowie przestrzeni roboczej\"],\"wzR1hC\":[\"Board name cannot exceed 50 characters\"],\"x0kMO/\":[\"BÅ‚Ä…d podczas aktualizacji adresu URL przestrzeni roboczej\"],\"x8GeCD\":[\"Zaktualizowano wyÅ›wietlanÄ… nazwÄ™\"],\"xEbBrW\":[\"Jakiej licencji uÅ¼ywacie?\"],\"xJO7ca\":[\"updated the title to <0>\",[\"toTitle\"],\"</0>\"],\"xMn+V9\":[\"Importowanie z Trello\"],\"xRPn3U\":[\"WprowadÅº swÃ³j adres e-mail\"],\"xvcYhz\":[\"WyczyÅ›Ä‡ wszelkie niestandardowe uprawnienia czÅ‚onkÃ³w, aby wszyscy dziedziczyli uprawnienia tylko z domyÅ›lnych ustawieÅ„ rÃ³l.\"],\"yCzSJ3\":[\"Nieograniczona liczba przestrzeni roboczych\"],\"yD3ZSw\":[\"ZmieÅ„ swoje preferencje jÄ™zykowe.\"],\"yH4aFo\":[\"Share invite link\"],\"yV7o5I\":[\"Jak zaimportowaÄ‡ moje tablice Trello?\"],\"yb/fjw\":[\"Zatwierdzenie\"],\"yz7wBu\":[\"Zamknij\"],\"zC8Whw\":[\"Rozpocznij, tworzÄ…c nowÄ… listÄ™\"],\"zDw80P\":[\"New board\"],\"zEGgv4\":[\"PorÃ³wnaj nasze funkcje, aby zobaczyÄ‡, dlaczego Kan jest najlepszym wyborem.\"],\"zERArS\":[\"zaktualizowano tytuÅ‚ na <0>\",[\"0\"],\"</0>\"],\"zKY5xi\":[\"UtwÃ³rz link zaproszenia\"],\"zLXwCk\":[\"my-workspace-name\"],\"zMjN8w\":[\"API REST'owe\"],\"zMlxCA\":[\"1 uÅ¼ytkownik\"],\"zQPhSa\":[\"Konwertuj na link\"],\"zQX5Dj\":[\"Nazwa listy\"],\"zdMPUq\":[\"removed label <0>\",[\"label\"],\"</0>\"],\"zkWmBh\":[\"Rocznie\"],\"zl1b97\":[\"Nie moÅ¼na utworzyÄ‡ karty\"],\"zoEbXq\":[\"MoÅ¼e wyÅ›wietlaÄ‡ karty\"],\"zto8aj\":[\"Trello odÅ‚Ä…czone\"],\"zwBp5t\":[\"Prywatne\"],\"zwWKhA\":[\"Dowiedz siÄ™ wiÄ™cej\"],\"zxKs+y\":[\"Termin na jutro\"],\"zzDlyQ\":[\"Sukces\"]}")as Messages;


================================================
FILE: apps/web/src/locales/pt-BR/messages.ts
================================================
/*eslint-disable*/import type{Messages}from"@lingui/core";export const messages=JSON.parse("{\"++rVAm\":[\"Redes sociais\"],\"+3TYXa\":[\"Para sustentabilidade a longo prazo, reconhecemos que todos os bons projetos de cÃ³digo aberto precisam de uma fonte de receita. A nossa vem da oferta paga na nuvem para workspaces com mÃºltiplos usuÃ¡rios e para slugs de workspace personalizados. NÃ£o hÃ¡ obrigaÃ§Ã£o de usÃ¡-la, e vocÃª pode hospedar o software em sua prÃ³pria infraestrutura gratuitamente.\"],\"+8Nek/\":[\"Mensal\"],\"+EkBs0\":[\"NÃ£o foi possÃ­vel atualizar suas preferÃªncias. Por favor, tente novamente.\"],\"+MdEsf\":[\"Nova senha Ã© obrigatÃ³ria\"],\"+OhFss\":[\"Comece gratuitamente, sem limites de uso. Para colaboraÃ§Ã£o, faÃ§a upgrade para um plano que se ajuste ao tamanho da sua equipe.\"],\"+VoTOr\":[\"cobrado mensalmente\"],\"+cilKj\":[\"Ideas, Research, Planning, Execution, Review, Next Steps, Complete\"],\"+djOzj\":[\"Convidar membro\"],\"+nvZ6j\":[\"Etiquetas e filtros\"],\"/8pTF/\":[\"workspace-url\"],\"/Blkmk\":[\"Add description... (type '/' to open commands)\"],\"/DGOJs\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trelloâ€™s simplicity, in open source.\"],\"/K2CvV\":[\"Modelo\"],\"/asTmx\":[\"RelatÃ³rio de bug\"],\"/f3t6v\":[\"Configure quais aÃ§Ãµes sÃ£o permitidas para cada funÃ§Ã£o do workspace. Essas permissÃµes se aplicam a todos os membros com essa funÃ§Ã£o.\"],\"/gaSVU\":[\"Roadmap\"],\"/glL9Q\":[\"Nenhum \",[\"0\"]],\"/lDBHm\":[\"FAQ\"],\"/rn4RE\":[\"Um aplicativo kanban poderoso e flexÃ­vel que ajuda vocÃª a organizar o trabalho, acompanhar o progresso e entregar resultadosâ€”tudo em um sÃ³ lugar.\"],\"/tOdd2\":[\"Sua imagem de perfil foi atualizada.\"],\"0+0/3e\":[\"Criar nova etiqueta\"],\"0+ewPp\":[\"Melhoria\"],\"0KjpAr\":[\"Pode visualizar membros\"],\"0StR7t\":[\"Digite sua nova senha\"],\"0dyOHD\":[\"Backlog, To Do, In Progress, Code Review, Done\"],\"0jV46i\":[\"NÃ£o foi possÃ­vel excluir item da checklist\"],\"0qyZ4b\":[\"Carregando permissÃµes...\"],\"0rPv1T\":[\"Imagem de perfil atualizada\"],\"0xWkkH\":[[\"boardCount\",\"plural\",{\"one\":[\"Importar quadro (1)\"],\"other\":[\"Importar quadros (\",[\"boardCount\"],\")\"]}]],\"1/jlQw\":[\"Trusted by fast-moving teams\"],\"14Xi3Z\":[\"Adicionar um novo membro custarÃ¡ \",[\"price\"],\" (\",[\"billingType\"],\") adicionais por assento.\"],\"1H5u1m\":[\"DÃºvidas?\"],\"1HPFNH\":[\"PreÃ§o por usuÃ¡rio/mÃªs\"],\"1WuwiM\":[\"Ir para configuraÃ§Ãµes\"],\"1ZVGyT\":[\"Adicionar um comentÃ¡rio...\"],\"1hzdxO\":[\"PermissÃµes do workspace\"],\"1iShX0\":[\"Vence hoje\"],\"1njn7W\":[\"Claro\"],\"1rVAfU\":[\"Carregar mais atividades\"],\"1rWxEw\":[\"Aguardando cliente\"],\"1sRmLC\":[\"Discuta e colabore em cartÃµes.\"],\"1sSegR\":[\"Brainstorming, Writing, Editing, Design, Approval, Publishing, Done\"],\"1wCGT0\":[\"Quadros ilimitados\"],\"25fAUC\":[\"Seu link de cancelamento de inscriÃ§Ã£o estÃ¡ sem um token. Por favor, abra o e-mail mais recente e tente novamente.\"],\"25mvI+\":[\"Links de convite exigem uma assinatura Team ou Pro. Por favor, faÃ§a upgrade do seu workspace.\"],\"29sSki\":[\"concluiu o item da lista de verificaÃ§Ã£o <0>\",[\"0\"],\"</0>\"],\"2BBAbc\":[\"Lista\"],\"2Bu8xj\":[\"Nenhum quadro encontrado\"],\"2M84k3\":[\"PermissÃµes personalizadas\"],\"2MPcep\":[\"ImportaÃ§Ã£o concluÃ­da\"],\"2POOFK\":[\"GrÃ¡tis\"],\"2Py5S/\":[\"ReconheÃ§o que todos os dados do workspace serÃ£o permanentemente excluÃ­dos e desejo prosseguir.\"],\"2Q871c\":[\"NÃ£o foi possÃ­vel adicionar etiqueta\"],\"2QGEbi\":[\"NÃ£o foi possÃ­vel excluir comentÃ¡rio\"],\"2SePRT\":[\"VocÃª foi convidado para entrar em um workspace no kan.bn.\"],\"2h4PVB\":[\"O nome do seu workspace foi atualizado.\"],\"2liqDZ\":[\"ReconheÃ§o que todos os dados da minha conta serÃ£o permanentemente excluÃ­dos e desejo prosseguir.\"],\"2q/Q7x\":[\"Visibilidade\"],\"2roTVj\":[\"Feedback enviado\"],\"3LDCpD\":[\"Esta aÃ§Ã£o nÃ£o pode ser desfeita.\"],\"3ZjRJY\":[\"renomeou a checklist <0>\",[\"0\"],\"</0>\"],\"3bqt9U\":[\"Qualquer pessoa com este link pode entrar no seu workspace\"],\"3pIq39\":[\"FunÃ§Ãµes de administrador\"],\"479pdJ\":[\"Confirme sua nova senha\"],\"4DOCMI\":[\"URL do YouTube\"],\"4RoY9J\":[\"Post de blog\"],\"4XF0BB\":[\"Foto de perfil\"],\"4gAX8s\":[\"Alternar menu\"],\"4ix5kl\":[\"Erro ao atualizar imagem de perfil\"],\"4kJRen\":[\"Escrita\"],\"4qu8Ec\":[\"14 dias de teste grÃ¡tis\"],\"53QYh8\":[\"Falha ao criar quadro\"],\"55xJ/O\":[\"Erro ao alterar senha\"],\"58AiWX\":[\"Por favor, confirme sua nova senha\"],\"5ACX4z\":[\"Newsletter\"],\"5IXWmO\":[\"Verifique sua caixa de entrada\"],\"5P4rhH\":[\"NÃ£o foi possÃ­vel atualizar membros\"],\"5eZwRW\":[\"Conecte sua conta do Trello para importar quadros.\"],\"5h8ooz\":[\"Chaves de API\"],\"5iplxh\":[\"Nova senha deve ser diferente da senha atual\"],\"5k0NLb\":[\"RevisÃ£o\"],\"5lWFkC\":[\"Entrar\"],\"5wo3jF\":[\"Settings | \",[\"0\"]],\"69b7aE\":[\"Abrir menu de comandos\"],\"6E4pW0\":[\"White label\"],\"6EWT6T\":[\"Recrutamento\"],\"6FDocz\":[\"Cadastrar-se com \"],\"6FsGbN\":[\"Comece criando um novo \",[\"0\"]],\"6OTo9n\":[\"O nome do modelo Ã© obrigatÃ³rio\"],\"6S8zjx\":[\"https://www.youtube.com/watch?v=...\"],\"6WSYbN\":[\"Novo \",[\"0\"]],\"6YtxFj\":[\"Nome\"],\"6mbe4b\":[\"IndivÃ­duos\"],\"6tDFBe\":[\"As permissÃµes do membro foram atualizadas.\"],\"6zeSBB\":[\"Pode criar cartÃµes\"],\"74F7N/\":[\"Tem certeza de que deseja excluir sua conta?\"],\"7EhE4k\":[\"Atualizar rÃ³tulo\"],\"7L01XJ\":[\"AÃ§Ãµes\"],\"7PzzBU\":[\"UsuÃ¡rio\"],\"7Ufoyg\":[\"Listas ilimitadas\"],\"7b2yuC\":[\"Por favor, insira uma senha vÃ¡lida\"],\"7d1a0d\":[\"PÃºblico\"],\"7eMo+U\":[\"Ir para inÃ­cio\"],\"7hktsm\":[\"Primeiros passos\"],\"7i8j3G\":[\"Empresa\"],\"8+BY11\":[\"URL do quadro copiada para a Ã¡rea de transferÃªncia\"],\"86XI28\":[\"Confirme suas preferÃªncias de e-mail:\"],\"8AbRER\":[\"Definir data de vencimento\"],\"8Is1ih\":[\"Oferta de lanÃ§amento\"],\"8RdLDU\":[\"Projeto pessoal\"],\"8TveY+\":[\"Quadros\"],\"8Z4pNX\":[\"Pode criar listas\"],\"8ZoISG\":[\"Confirm URL change\"],\"8iP0S8\":[\"Tudo do plano gratuito, mais:\"],\"8yFGGF\":[\"NÃ£o foi possÃ­vel remover membro\"],\"91W07W\":[\"Custom URLs are a premium feature. You'll be directed to upgrade your account.\"],\"99VIgC\":[\"Remover membro\"],\"9PaIxv\":[\"Recursos principais\"],\"9QmxLI\":[\"Create board\"],\"9cDpsw\":[\"PermissÃµes\"],\"9eF5oV\":[\"Bem-vindo de volta\"],\"9h7RDh\":[\"Oferta\"],\"9s9O5h\":[\"Erro ao excluir workspace\"],\"9u5BOr\":[\"Membros | \",[\"0\"]],\"9wdpwp\":[\"Portal de faturamento\"],\"9x4DAL\":[[\"0\"],\" nÃ£o encontrado\"],\"9y1RcT\":[\"Estamos apenas comeÃ§ando.\"],\"A23Y7X\":[\"Entrar no workspace | kan.bn\"],\"A5hiCy\":[\"Criar modelo\"],\"A8jqN7\":[\"NÃ£o foi possÃ­vel enviar feedback\"],\"ABCjd9\":[\"PublicaÃ§Ã£o\"],\"ADEin1\":[\"ConfiguraÃ§Ãµes | CobranÃ§a\"],\"ALhEZV\":[\"Pode convidar membros\"],\"ANyn0x\":[\"Tudo que vocÃª precisa, grÃ¡tis para sempre. Quadros ilimitados, listas ilimitadas, cartÃµes ilimitados. FaÃ§a upgrade a qualquer momento.\"],\"ARvBT/\":[\"cobrado anualmente\"],\"ASjvm9\":[\"URL do workspace\"],\"AUYALh\":[\"Em breve\"],\"AX4ktp\":[\"CriaÃ§Ã£o de conteÃºdo\"],\"AZI/wb\":[\"Etiquetas e filtros\"],\"AeXO77\":[\"Conta\"],\"Ax/hYa\":[\"A descriÃ§Ã£o do workspace nÃ£o pode exceder 280 caracteres\"],\"B3xxao\":[\"Adicionar um cartÃ£o\"],\"BBUDfW\":[\"Urgente\"],\"BEVzjL\":[\"ImportaÃ§Ã£o falhou\"],\"BJbLe4\":[\"Estamos usando a <0>licenÃ§a AGPL-3.0</0>.\"],\"BMkVQ3\":[\"excluiu a checklist <0>\",[\"0\"],\"</0>\"],\"BOqTi5\":[\"moveu o card de <0>\",[\"0\"],\"</0> para <1>\",[\"1\"],\"</1>\"],\"BSZSHI\":[\"Board analytics (coming soon)\"],\"BZkYSt\":[\"removeu \",[\"0\"],\" etiquetas: <0>\",[\"labelList\"],\"</0>\"],\"BhDZlc\":[\"Tem certeza de que deseja excluir o workspace \",[\"0\"],\"?\"],\"Bhgd0l\":[\"Entre em contato\"],\"Bosey8\":[\"Change the language of the app.\"],\"BzEFor\":[\"ou\"],\"C56tim\":[\"NÃ£o foi possÃ­vel atualizar data de vencimento\"],\"CAL6E9\":[\"Equipes\"],\"CB/NpV\":[\"Alta prioridade\"],\"CHZ1jC\":[\"excluiu o item da checklist <0>\",[\"0\"],\"</0>\"],\"CJ3zUq\":[\"Por favor, insira um nome vÃ¡lido\"],\"CJWDTP\":[\"Sua conta do Trello foi desconectada.\"],\"CJukzS\":[[\"0\"],\" etiquetas\"],\"CTqTgr\":[\"Atalhos\"],\"CYWHT+\":[\"Erro ao fazer upload da imagem de perfil\"],\"Ci/KUX\":[\"ConfiguraÃ§Ãµes | Workspace\"],\"CkVV1t\":[\"Erro ao atualizar descriÃ§Ã£o do workspace\"],\"Cmudpi\":[\"Pode excluir workspace\"],\"CozWO1\":[\"Nome do workspace\"],\"D+NlUC\":[\"Sistema\"],\"D0esZz\":[\"Registro de atividades\"],\"D3C4Yx\":[\"A senha atual Ã© obrigatÃ³ria\"],\"D7/JvJ\":[\"Ajuste o recorte quadrado para adequar seu avatar.\"],\"D9ROdV\":[\"Links de convite\"],\"DAV3uK\":[\"PermissÃµes atualizadas\"],\"DFjdv0\":[\"Excluir modelo\"],\"DMeWZD\":[\"Tem certeza de que deseja excluir este \",[\"0\"],\"?\"],\"DPfwMq\":[\"ConcluÃ­do\"],\"DahTzR\":[\"NÃ£o foi possÃ­vel excluir checklist\"],\"DbZgsJ\":[\"Criar modelo\"],\"DhLN1b\":[\"No boards\"],\"DtXlZq\":[\"NÃ£o foi possÃ­vel atualizar checklist\"],\"E0t3jO\":[\"adicionou o item da lista de verificaÃ§Ã£o <0>\",[\"0\"],\"</0>\"],\"E8zYtd\":[\"removeu a atribuiÃ§Ã£o de <0>\",[\"0\"],\"</0> do cartÃ£o\"],\"ECJKc4\":[\"Chave de API criada\"],\"EEHmPC\":[\"Oferta de lanÃ§amento: obtenha membros ilimitados com o Pro\"],\"EEQaqX\":[\"assigned <0>\",[\"memberName\"],\"</0> to the card\"],\"EH8IL3\":[\"Checklists\"],\"EM/caO\":[\"moved the card from <0>\",[\"fromList\"],\"</0> to<1>\",[\"toList\"],\"</1>\"],\"ERpq2P\":[\"Nenhum resultado encontrado para \\\"\",[\"debouncedQuery\"],\"\\\".\"],\"ESClHO\":[\"Suporte prioritÃ¡rio por e-mail\"],\"Eg99Sc\":[\"Nenhum mÃ©todo de autenticaÃ§Ã£o estÃ¡ disponÃ­vel no momento\"],\"EifmPY\":[\"To Do, In Progress, Done\"],\"Eit43O\":[\"definiu a data de vencimento\"],\"EkH9pt\":[\"Atualizar\"],\"EvArWh\":[\"Colabore perfeitamente com sua equipe.\"],\"F/FPk/\":[\"ConfiguraÃ§Ãµes | PermissÃµes\"],\"F/Fhz0\":[\"Create Pro workspace\"],\"F/vB2g\":[\"Ideias para melhorar esta pÃ¡gina...\"],\"F3bW6y\":[\"Plataforma\"],\"F4KRmY\":[\"$8/mÃªs\"],\"F4PLG4\":[\"DescriÃ§Ã£o do workspace atualizada\"],\"F8DaWi\":[\"Somente visualizaÃ§Ã£o\"],\"FEr96N\":[\"Tema\"],\"FUltnF\":[\"Modelos personalizados\"],\"FdtSNC\":[\"Criar workspace\"],\"FmN5me\":[\"ResoluÃ§Ã£o\"],\"FmfJjN\":[\"Visualize e gerencie suas chaves de API.\"],\"Fpci8b\":[\"Tem certeza de que deseja excluir esta checklist?\"],\"G1Gw0v\":[\"Novo modelo\"],\"GAD3Dx\":[\"DomÃ­nio personalizado\"],\"GDvlUT\":[\"FunÃ§Ã£o\"],\"GXsAby\":[\"Revoke\"],\"GYv20o\":[\"NÃ£o foi possÃ­vel atualizar as permissÃµes\"],\"Gd7sEW\":[\"Link de workspace personalizado\"],\"GnRmu4\":[\"Nome da checklist\"],\"GnSSGm\":[\"A descriÃ§Ã£o do seu workspace foi atualizada.\"],\"GoDLB9\":[\"Sua conta foi excluÃ­da.\"],\"Gxxi5J\":[\"Adicionar checklist\"],\"H5G+qG\":[\"Qual Ã© a diferenÃ§a entre Kan e Trello?\"],\"HBI6nY\":[\"Precisa de ajuda?\"],\"HO+uOC\":[\"Triagem\"],\"HVIzNO\":[\"Pode visualizar listas\"],\"HYV6Lq\":[\"Falha ao aceitar convite. Por favor, tente novamente mais tarde ou entre em contato com o suporte ao cliente.\"],\"HeFWjW\":[\"PrÃ³ximos passos\"],\"Hg1qE9\":[\"O slug do seu workspace foi atualizado.\"],\"I+AROe\":[\"Pode editar cartÃµes\"],\"I0gAKM\":[\"NÃ£o foi possÃ­vel atualizar lista\"],\"IDvohQ\":[\"marcou um item da checklist como incompleto\"],\"IFgUX6\":[\"Pode remover membros\"],\"IelE1h\":[\"Fazer upgrade para Pro\"],\"IqjpYe\":[\"Visibilidade do e-mail\"],\"IrZaAn\":[\"Senha alterada\"],\"J/hVSQ\":[[\"0\"]],\"J2Wbjt\":[\"Continuar com \"],\"J5nbej\":[\"CrÃ­tico\"],\"J5pbP6\":[\"Pode editar funÃ§Ãµes e permissÃµes de membros\"],\"JArWcF\":[[\"0\"],\" | \",[\"1\"]],\"JCdzgZ\":[\"SolicitaÃ§Ã£o de recurso\"],\"JUce1S\":[\"ResponsÃ¡veis\"],\"JbXXUW\":[\"Tenha em mente que esta aÃ§Ã£o Ã© irreversÃ­vel.\"],\"JcCDm9\":[\"Modelo criado\"],\"Jgaz7E\":[\"PermissÃµes redefinidas\"],\"JlFcis\":[\"Send\"],\"JnWJXY\":[\"link mÃ¡gico\"],\"JxhWxU\":[\"em\"],\"JyXBgS\":[\"docs\"],\"K3iLeO\":[\"Veja o que nossos usuÃ¡rios estÃ£o dizendo sobre o Kan\"],\"KAsRdK\":[\"Ir para membros\"],\"KFJgmZ\":[\"O nome de exibiÃ§Ã£o deve ter pelo menos 3 caracteres\"],\"KLJ4eD\":[\"Link de convite copiado\"],\"KNKCTb\":[\"Backlog\"],\"KiVc+q\":[\"Tempo integral\"],\"KuSt9W\":[\"Como faÃ§o auto-hospedagem?\"],\"L5ZPjz\":[\"atualizou um item da lista de verificaÃ§Ã£o\"],\"LTGE7Y\":[\"Workspace criado com sucesso. VocÃª pode fazer upgrade posteriormente nas configuraÃ§Ãµes.\"],\"LeM5RY\":[\"NÃ£o foi possÃ­vel limpar as substituiÃ§Ãµes\"],\"LoUCpj\":[\"Erro ao atualizar nome do workspace\"],\"LqWW5F\":[\"Seu nome de exibiÃ§Ã£o foi atualizado.\"],\"LrcnbT\":[\"Hospede o Kan na sua prÃ³pria infraestrutura. Ideal para organizaÃ§Ãµes que precisam de controle completo sobre seus dados.\"],\"Ls++vT\":[\"RÃ¡pido e leve\"],\"Lt+ZP3\":[\"concluiu um item da lista de verificaÃ§Ã£o\"],\"M43OaK\":[\"Upgrade to Team Plan\"],\"M9p3Vw\":[\"Log de atividades ilimitado\"],\"MFKlMB\":[\"Convidar\"],\"MHrjPM\":[\"TÃ­tulo\"],\"MI5OBT\":[\"A URL pode conter apenas letras, nÃºmeros e hÃ­fens\"],\"MK16u2\":[\"Sem datas\"],\"MKAScN\":[\"Pode visualizar quadros\"],\"MN6YzG\":[\"Slug do workspace atualizado\"],\"MWrbWq\":[\"ConfiguraÃ§Ãµes | Conta\"],\"MdN5zD\":[\"VocÃª precisa ser um administrador para gerenciar as permissÃµes do workspace.\"],\"MdwUGG\":[\"Economize tempo com modelos de quadro reutilizÃ¡veis.\"],\"MeO/vH\":[\"Isso resultarÃ¡ na exclusÃ£o permanente de todos os dados associados a este workspace.\"],\"MlyjJu\":[\"O nome de exibiÃ§Ã£o nÃ£o pode exceder 280 caracteres\"],\"MxQXhL\":[\"NÃ£o foi possÃ­vel criar workspace\"],\"N/bcWA\":[\"Login | kan.bn\"],\"N3380t\":[\"Pode criar quadros\"],\"N7aud6\":[\"Busca inteligente\"],\"NH54UR\":[\"renomeou o item da checklist para <0>\",[\"0\"],\"</0>\"],\"NgaR6B\":[\"Digite sua senha\"],\"NypLoL\":[\"renomeou uma lista de verificaÃ§Ã£o\"],\"O0li0W\":[\"Insira sua senha atual e escolha uma nova senha segura.\"],\"O1wAlQ\":[\"Convidado\"],\"O3oNi5\":[\"E-mail\"],\"O83K21\":[\"adicionou um item da lista de verificaÃ§Ã£o\"],\"O9jVbx\":[\"Prioridade baixa\"],\"OAYToL\":[\"Isso removerÃ¡ todas as permissÃµes personalizadas de membros neste workspace. Os membros herdarÃ£o permissÃµes apenas de suas funÃ§Ãµes.\"],\"OIA0ad\":[\"Nome do workspace atualizado\"],\"OZtEcz\":[\"API\"],\"OpNhRn\":[\"NÃ£o Ã© necessÃ¡rio cartÃ£o de crÃ©dito\"],\"OtjenF\":[\"Por favor, insira um endereÃ§o de e-mail vÃ¡lido\"],\"OvoEq7\":[\"Membro\"],\"Ozt2vv\":[\"Sua senha foi alterada.\"],\"P6dJdq\":[\"SubstituiÃ§Ãµes limpas\"],\"P8bryV\":[\"New Ticket, Triaging, In Progress, Awaiting Customer, Resolution, Done\"],\"PCIlOO\":[\"Adicionar membro\"],\"PRjvDT\":[\"Tem certeza de que deseja excluir este comentÃ¡rio?\"],\"PRofO0\":[\"Editar vÃ­deo do YouTube\"],\"PTzsxH\":[\"Visibilidade do quadro atualizada\"],\"PZCqeW\":[\"Por favor, tente novamente mais tarde.\"],\"Pa9/o1\":[\"Create API keys to access the Kan API.\"],\"PpZkda\":[\"Recursos\"],\"PyYD/v\":[\"atribuiu <0>\",[\"0\"],\"</0> ao card\"],\"Q9pQaX\":[\"Nenhuma funÃ§Ã£o encontrada para este workspace ainda.\"],\"QD8opX\":[\"Board\"],\"QHhZeE\":[\"Modelo criado com sucesso\"],\"QNtP5M\":[\"Usar modelo\"],\"Qh7QmR\":[\"Removido dos favoritos\"],\"QtACvI\":[\"Criar etiqueta\"],\"Qtzfdk\":[\"Plano Pro âˆ\"],\"R+w/Va\":[\"Faturamento\"],\"R1c3Mq\":[\"O nome do board Ã© obrigatÃ³rio\"],\"R275Pz\":[\"VocÃª tem assentos ilimitados com seu plano Pro. NÃ£o hÃ¡ cobranÃ§a adicional para novos membros!\"],\"R3FsF4\":[\"Falha no download\"],\"R6pB8R\":[\"Favoritar no Github\"],\"RHZu7R\":[\"Amado por equipes no mundo todo\"],\"RJA+sg\":[\"Novo ticket\"],\"RRn9jf\":[\"Clique no link que enviamos para \",[\"magicLinkRecipient\"],\" para fazer login.\"],\"RSGOS1\":[\"Pode excluir listas\"],\"RfgJqw\":[\"atualizou a data de vencimento\"],\"RkXlPZ\":[\"GitHub\"],\"RoafuO\":[\"Enviar feedback\"],\"RtlIYB\":[\"VocÃª estÃ¡ prestes a alterar sua senha.\"],\"SFnH1j\":[\"Por que criar um Trello de cÃ³digo aberto?\"],\"SKqXzW\":[\"added label <0>\",[\"label\"],\"</0>\"],\"SMaFdc\":[\"Cancelar inscriÃ§Ã£o\"],\"SNfg0e\":[\"Pode visualizar workspace\"],\"SPLN9O\":[\"Seja dono dos seus dados\"],\"STSYcd\":[\"Pode excluir comentÃ¡rios\"],\"SWEskc\":[\"A URL deve ter pelo menos 3 caracteres\"],\"Sb2gYF\":[\"Nova lista\"],\"ScJ9fj\":[\"PolÃ­tica de privacidade\"],\"Se/UIp\":[\"A fazer\"],\"SkCNhl\":[\"Pesquisar quadros e cartÃµes...\"],\"SlfejT\":[\"Erro\"],\"T/pF0Z\":[\"Remover dos favoritos\"],\"T21jY/\":[\"adicionou uma etiqueta ao cartÃ£o\"],\"T7DJ2k\":[\"NÃ£o foi possÃ­vel adicionar comentÃ¡rio\"],\"T7LJic\":[\"moveu o card para outra lista\"],\"T7Mywq\":[\"NÃ£o foi possÃ­vel atualizar o quadro\"],\"TCOMOO\":[\"Editar permissÃµes\"],\"TFv5tM\":[\"NÃ£o foi possÃ­vel atualizar a funÃ§Ã£o\"],\"TH3Irz\":[\"PermissÃ£o\"],\"TKFUnX\":[\"Conta excluÃ­da\"],\"TXO5TM\":[\"Nenhum atalho de teclado registrado.\"],\"TYli1B\":[\"Pode editar comentÃ¡rios\"],\"TbjyhA\":[\"Docs\"],\"TcXcmk\":[\"RevisÃ£o de cÃ³digo\"],\"TjREUS\":[\"Nova chave de API\"],\"TmvrjU\":[\"A URL do quadro deve ter pelo menos 3 caracteres\"],\"TvY/XA\":[\"DocumentaÃ§Ã£o\"],\"Tz0i8g\":[\"ConfiguraÃ§Ãµes\"],\"TztLaN\":[\"NÃ£o foi possÃ­vel criar lista\"],\"U3pytU\":[\"Administrador\"],\"U5dMR6\":[\"Ver workspace\"],\"UCLeG0\":[\"Termos de serviÃ§o\"],\"UQbwrz\":[\"Todos os sistemas operacionais\"],\"URAE3q\":[\"Pausado\"],\"USVCGU\":[\"Erro ao desativar link de convite\"],\"UbRKMZ\":[\"Pendente\"],\"UbYdrA\":[\"FrequÃªncia de pagamento\"],\"UeDFpo\":[\"Como o projeto Ã© financiado?\"],\"UlhdTP\":[\"Workspace excluÃ­do\"],\"Un80BR\":[\"Amigos OSS\"],\"UveK6V\":[\"Ir para o app\"],\"Uworke\":[\"Meio perÃ­odo\"],\"UxKoFf\":[\"NavegaÃ§Ã£o\"],\"V3MPSQ\":[\"atualizou o tÃ­tulo\"],\"V8YWP3\":[\"Insira um tÃ­tulo personalizado\"],\"VHS0aJ\":[\"Limpar todas as permissÃµes personalizadas?\"],\"VKoDQD\":[\"Criar novo \",[\"0\"]],\"VUZDlr\":[\"Depoimentos\"],\"VXk54Y\":[\"atribuiu o cartÃ£o a si mesmo\"],\"VbyRUy\":[\"ComentÃ¡rios\"],\"VhMDMg\":[\"Alterar senha\"],\"Vt50G1\":[\"Kanban bÃ¡sico\"],\"W/Elkg\":[\"Prioridade mÃ©dia\"],\"W/nQk1\":[\"Plano gratuito\"],\"W5r8Qh\":[\"excluiu um item da checklist\"],\"W8oT+L\":[\"Falha ao buscar informaÃ§Ãµes do vÃ­deo\"],\"WHHLh9\":[\"NÃ£o foi possÃ­vel excluir anexo\"],\"WI4eGo\":[\"Como obtenho uma URL personalizada?\"],\"WQPDcG\":[\"NÃ£o foi possÃ­vel atualizar item da checklist\"],\"WRkpB1\":[\"Cadastro desabilitado\"],\"WRsbHO\":[\"Sua conta do Trello estÃ¡ conectada.\"],\"WYDptz\":[\"Assinatura necessÃ¡ria\"],\"WYwN1G\":[\"Nova importaÃ§Ã£o\"],\"WbTDwg\":[\"Em andamento\"],\"Weq9zb\":[\"Geral\"],\"WmPhYW\":[\"Ocorreu um erro ao desconectar sua conta do Trello.\"],\"WnEwDO\":[\"JÃ¡ tem uma conta? <0><1>Entrar</1></0>\"],\"Wy6pcF\":[\"NÃ£o foi possÃ­vel atualizar visibilidade do quadro\"],\"X0N0PA\":[\" (editado)\"],\"XDRXbZ\":[\"A descriÃ§Ã£o do workspace deve ter pelo menos 3 caracteres\"],\"XILg0L\":[\"EndereÃ§o de e-mail invÃ¡lido\"],\"XJOV1Y\":[\"Atividade\"],\"XTKtey\":[\"Criar lista\"],\"XXbgHS\":[\"Contratado\"],\"XYLcNv\":[\"Suporte\"],\"XicmhT\":[\"Data de vencimento\"],\"Xid3K6\":[\"A URL do quadro pode conter apenas letras, nÃºmeros e hÃ­fens\"],\"Xjj/kS\":[\"Kanban reimaginado\"],\"XpcjLO\":[\"NÃ£o foi possÃ­vel atualizar URL do quadro\"],\"XyuOHa\":[\"Compartilhamento e convites do quadro\"],\"YBBifR\":[\"Desconectar Trello\"],\"YKeYae\":[\"NÃ£o foi possÃ­vel reordenar item da checklist\"],\"YQqv2e\":[\"Get started by creating a new board\"],\"YVT40D\":[\"removeu a etiqueta <0>\",[\"0\"],\"</0>\"],\"YaZDYI\":[\"Erro ao fazer upgrade da assinatura\"],\"YcyP2z\":[\"NÃ£o foi possÃ­vel criar template\"],\"Yf9FAx\":[\"Eles nÃ£o poderÃ£o acessar este workspace.\"],\"YhvWXb\":[\"AnÃ¡lise do board\"],\"YirHq7\":[\"Feedback\"],\"YoyKbT\":[\"Esta chave de API serÃ¡ exibida apenas uma vez. Salve-a em um local seguro.\"],\"YtUfwW\":[\"Falha ao fazer login com \",[\"0\"],\". Por favor, tente novamente.\"],\"Z3FXyt\":[\"Carregando...\"],\"Z3krJD\":[\"Permitir que membros do workspace vejam os endereÃ§os de e-mail uns dos outros\"],\"Z6r9z1\":[\"NÃ£o foi possÃ­vel excluir cartÃ£o\"],\"Z7/Xyy\":[\"Applicants, Screening, Interviewing, Offer, Onboarding, Hired\"],\"ZDGm40\":[\"Excluir conta\"],\"ZDIydz\":[\"ComeÃ§ar\"],\"ZDo4HN\":[\"Brainstorming\"],\"ZH7TVS\":[\"TÃ­tulo do cartÃ£o\"],\"ZL1A+p\":[\"Falha ao enviar anexo. Por favor, tente novamente.\"],\"ZT4Khw\":[\"Tem certeza de que deseja excluir este card?\"],\"ZU5IYI\":[\"Quadros ilimitados, listas ilimitadas, cartÃµes ilimitados. NÃ£o Ã© necessÃ¡rio cartÃ£o de crÃ©dito.\"],\"ZXSPJt\":[\"Ocorreu um erro inesperado. Por favor, tente novamente mais tarde.\"],\"ZqDqbi\":[\"Organize e encontre cartÃµes rapidamente com ferramentas de filtragem poderosas.\"],\"Zz1qkk\":[\"CartÃµes ilimitados\"],\"aHCEmh\":[\"PreÃ§os\"],\"aHRWVI\":[\"removeu a data de vencimento\"],\"aJ4pMe\":[\"FAQs\"],\"aWDhU5\":[\"Kanban Ã© melhor com uma equipe. Perfeito para equipes pequenas e em crescimento que buscam colaborar.\"],\"aWlSc/\":[\"Criar nova lista\"],\"abUZlY\":[\"Adicionar detalhes...\"],\"aelko+\":[\"VocÃª pode obter uma URL personalizada para o workspace, como <0>kan.bn/kan</0>, acessando as <1>configuraÃ§Ãµes do workspace</1> e adquirindo uma assinatura pro do workspace. Todas as assinaturas ajudam a financiar o desenvolvimento do projeto!\"],\"aiHZVP\":[\"Ver documentaÃ§Ã£o\"],\"aj40Mw\":[\"For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users (free during the beta) and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.\"],\"b/LfJo\":[\"e-mail\"],\"b3Thhd\":[\"Falha no upload\"],\"b5FKyH\":[\"adicionou a etiqueta <0>\",[\"0\"],\"</0>\"],\"b9XOHo\":[\"Criar \",[\"0\"]],\"bA2LQS\":[\"Detalhamento de recursos\"],\"bD8I7O\":[\"Concluir\"],\"bDI6VI\":[[\"0\"],\" foi removido dos seus favoritos.\"],\"bJZm1W\":[\"Candidatos\"],\"bJtM0P\":[\"Esta URL de workspace estÃ¡ reservada\"],\"bZSICm\":[\"NÃ£o foi possÃ­vel adicionar item da checklist\"],\"bcIybO\":[\"O nome do workspace Ã© obrigatÃ³rio\"],\"bdztP2\":[\"Pesquisa\"],\"bfZE+Y\":[\"A funÃ§Ã£o do membro foi atualizada.\"],\"bff61F\":[\"Plano de equipe\"],\"bfgr/e\":[\"Pergunta\"],\"bgh/9n\":[\"pode gerenciar configuraÃ§Ãµes do workspace\"],\"bmXKoX\":[\"adicionou \",[\"0\"],\" etiquetas: <0>\",[\"labelList\"],\"</0>\"],\"bqAQaT\":[\"Erro ao excluir conta\"],\"c/IAuR\":[\"Importante\"],\"c3b0B0\":[\"ComeÃ§ar\"],\"c9AJhn\":[\"Entrar no workspace\"],\"cAgBMh\":[\"Controle e propriedade completos:\"],\"cFQEU/\":[\"Abrir atalhos de teclado\"],\"cOh+MI\":[\"Triagem\"],\"cWcxrL\":[\"Nova checklist\"],\"cWtfn1\":[\"Fazer upgrade para Pro ($29/mÃªs)\"],\"chyf4J\":[\"DescriÃ§Ã£o do workspace\"],\"cji2nM\":[\"Erro ao criar link de convite\"],\"cnGeoo\":[\"Excluir\"],\"cp1rsD\":[\"Desativar link de convite\"],\"csFbe+\":[\"Ir para modelos\"],\"curoK5\":[\"Novo workspace\"],\"d33Usy\":[\"Criar checklist\"],\"d7XqZJ\":[\"A powerful, flexible kanban app that helps you organise work,\\n              track progress, and deliver resultsâ€”all in one place.\"],\"dEgA5A\":[\"Cancelar\"],\"dUh9QW\":[\"Planejamento\"],\"ddrz1m\":[\"Atrasado\"],\"delOXn\":[\"NÃ£o foi possÃ­vel atualizar etiquetas\"],\"dgr4Kq\":[\"Editar etiqueta\"],\"dmKdk0\":[\"Uma vez que vocÃª excluir seu workspace, nÃ£o hÃ¡ como voltar atrÃ¡s. Esta aÃ§Ã£o nÃ£o pode ser desfeita.\"],\"dsLT3m\":[\"Criar cartÃ£o\"],\"dtbpdR\":[\"Trello\"],\"duf3Nr\":[\"Esta URL de workspace jÃ¡ estÃ¡ em uso\"],\"e12o5C\":[\"Invite another\"],\"e4hPSt\":[\"Redefinir para padrÃµes da funÃ§Ã£o\"],\"eEQyz+\":[\"Acompanhe todas as alteraÃ§Ãµes de cartÃµes com histÃ³rico detalhado de atividades.\"],\"ePK91l\":[\"Editar\"],\"eZCGbT\":[\"Sim, oferecemos um plano gratuito permanente para uso individual. Sem restriÃ§Ãµes, sem barreiras de pagamento, sem limites.\"],\"edWbV6\":[\"Link copiado\"],\"en3oy5\":[\"Recurso\"],\"evg7+A\":[\"Seus quadros foram importados.\"],\"evj0lK\":[\"VocÃªs oferecem um plano gratuito?\"],\"f8fH8W\":[\"Design\"],\"f8lDFq\":[\"criou o cartÃ£o\"],\"fEY2vP\":[\"CartÃ£o nÃ£o encontrado\"],\"fJxqi6\":[\"Custom URLs require Pro plan ($29/month)\"],\"fQCrjt\":[\"A visibilidade do seu quadro foi definida como \",[\"0\"],\".\"],\"fR9laE\":[\"Insira sua senha atual\"],\"fSf2ee\":[\"Veja nosso roadmap.\"],\"fYVH36\":[\"NÃ£o foi possÃ­vel atualizar comentÃ¡rio\"],\"fvLNDy\":[\"Nenhuma lista foi criada ainda\"],\"fziA2d\":[\"ComentÃ¡rios ilimitados\"],\"g2xBxu\":[\"Importar seus quadros do Trello para o Kan Ã© fÃ¡cil. VocÃª pode seguir nosso guia passo a passo <0>aqui</0>.\"],\"gGx5tM\":[\"Editando\"],\"gL/7jw\":[\"Adicionar descriÃ§Ã£o... (digite '/' para abrir comandos ou '@' para mencionar)\"],\"gUX7b+\":[\"A alternativa open source <0/> ao Trello\"],\"gZxH/p\":[\"alterou a data de vencimento para <0>\",[\"formattedDate\"],\"</0>\"],\"ghSJ4U\":[\"O nome do workspace nÃ£o pode exceder 64 caracteres\"],\"gkzAEM\":[\"Continuar com \",[\"0\"]],\"goklcJ\":[\"Entrevistando\"],\"gpfJ3v\":[\"GrÃ¡tis, para sempre\"],\"gukxZ5\":[\"IntegraÃ§Ã£o\"],\"gv5kbo\":[\"A URL do quadro nÃ£o pode exceder 60 caracteres\"],\"h16FyT\":[\"Listas\"],\"h2FKMV\":[\"VocÃª nÃ£o tem permissÃ£o\"],\"h4VV67\":[\"adicionou uma lista de verificaÃ§Ã£o\"],\"h7MgpO\":[\"Atalhos de teclado\"],\"h8DugX\":[\"Etiquetas\"],\"hAMddS\":[\"removeu a prÃ³pria atribuiÃ§Ã£o do cartÃ£o\"],\"hXMFoN\":[\"Nenhuma lista\"],\"hYzsXr\":[\"ConfiguraÃ§Ãµes | IntegraÃ§Ãµes\"],\"hh61gL\":[\"Importar do Trello\"],\"iFxrHK\":[\"Find answers to common questions about the project. Can't find what you're looking for? Feel free to <0>contact us</0>.\"],\"iHcdea\":[\"Vence na prÃ³xima semana\"],\"iLbjv+\":[\"Pode editar workspace\"],\"iQmbPb\":[\"LicenÃ§a\"],\"iTylMl\":[\"Modelos\"],\"iVIGZb\":[\"Anexo enviado\"],\"isRobC\":[\"Novo\"],\"iwr7AP\":[\"Ideias\"],\"iy1wb+\":[\"ConfiguraÃ§Ãµes | API\"],\"j2+d/o\":[\"ReferÃªncia da API\"],\"j9IZZ0\":[\"URL de workspace personalizada\"],\"jDRt4n\":[\"VocÃª deseja cancelar a assinatura?\"],\"jL82rC\":[\"Limpar permissÃµes personalizadas\"],\"jNuzV/\":[\"Pode excluir cartÃµes\"],\"jQ6I8X\":[\"FunÃ§Ã£o atualizada\"],\"jZBHkN\":[\"O nome do workspace deve ter pelo menos 3 caracteres\"],\"jfC/xh\":[\"Contato\"],\"jkbHit\":[\"around the world\"],\"jl3aEJ\":[\"marcou o item da checklist <0>\",[\"0\"],\"</0> como incompleto\"],\"jlB2RY\":[\"A senha atual que vocÃª digitou estÃ¡ incorreta.\"],\"jwI32v\":[\"Quadro nÃ£o encontrado\"],\"kECVpo\":[\"Tem certeza de que deseja excluir esta etiqueta?\"],\"kQwvU8\":[\"removeu uma etiqueta do cartÃ£o\"],\"kSxwQL\":[\"VocÃª pode convidar membros da equipe clicando no botÃ£o \\\"Convidar\\\" no canto superior direito da <0>pÃ¡gina de membros</0> e inserindo o endereÃ§o de e-mail deles. Eles receberÃ£o um e-mail com um link para entrar no workspace.\"],\"kYu0eF\":[\"Excluir workspace\"],\"kfOGMr\":[\"VitÃ³ria rÃ¡pida\"],\"klpSmb\":[\"Editar URL do workspace\"],\"kp6L3T\":[\"Este nome de usuÃ¡rio de workspace jÃ¡ estÃ¡ em uso\"],\"kryGs+\":[\"CartÃ£o\"],\"kuoc68\":[\"$10/mÃªs\"],\"kwkhPe\":[\"Upgrade\"],\"kxEs5t\":[\"ImportaÃ§Ãµes do Trello\"],\"l2PIAy\":[\"Auto-hospede com Github\"],\"l31EoQ\":[\"Encontre respostas para perguntas comuns sobre o Kan. NÃ£o encontrou o que procura? Sinta-se Ã  vontade para <0>entrar em contato</0>.\"],\"l3s5ri\":[\"Importar\"],\"l4asa1\":[\"Este quadro Ã© privado ou nÃ£o existe\"],\"lGjicL\":[\", ou veja nosso\"],\"lKAvEd\":[\"Erro ao desconectar Trello\"],\"lSNkXg\":[\"All seats are free during the beta until Sept 1st!\"],\"lXvXNI\":[\"Falha ao copiar link de convite\"],\"lYT7pQ\":[\"Excluir lista\"],\"lcokBr\":[\"Propriedade da Atlassian\"],\"lkz85l\":[\"A principal diferenÃ§a entre Kan e Trello Ã© que o Kan Ã© open source, permitindo que qualquer pessoa visualize, modifique e contribua com nosso cÃ³digo. Nossa oferta em nuvem tambÃ©m nÃ£o oferece restriÃ§Ãµes de recursos para uso individual, enquanto o Trello bloqueia recursos bÃ¡sicos, como o nÃºmero de quadros que vocÃª pode criar, atrÃ¡s de um paywall.\"],\"lo8xBK\":[\"Tem certeza de que deseja remover \",[\"entityLabel\"],\"?\"],\"lpIMne\":[\"As senhas nÃ£o coincidem\"],\"lsgnzd\":[\"Erro ao fazer upgrade para Pro\"],\"lyqwgn\":[\"Adicionar etiqueta\"],\"m2nk0i\":[\"PreÃ§os simples\"],\"mErq7F\":[\"Cadastrar-se\"],\"mHhffx\":[\"NÃ£o foi possÃ­vel criar checklist\"],\"mTGd3+\":[\"excluiu uma checklist\"],\"mTwGOf\":[\"Este link de convite Ã© invÃ¡lido ou expirou.\"],\"mU+M00\":[[\"0\"],\" foi adicionado aos seus favoritos.\"],\"mVZH9V\":[\"Quando o Trello foi lanÃ§ado em 2011, impressionou a todos com sua simplicidade cuidadosamente projetada, mas ao longo dos anos perdeu sua magia e se transformou em algo mais prÃ³ximo do \\\"Jira Lite\\\". Este projeto Ã© nossa tentativa de resgatar a magia original da simplicidade do Trello, em cÃ³digo aberto.\"],\"mZGPxt\":[\"Link de convite copiado para a Ã¡rea de transferÃªncia\"],\"mchgzf\":[\"VocÃª se cadastrou com sucesso.\"],\"mgXgHu\":[\"Ir para quadros\"],\"mwBdZ2\":[\"Isso resultarÃ¡ na exclusÃ£o permanente de todos os dados associados Ã  sua conta.\"],\"mx8+1u\":[\"Membros ilimitados\"],\"n+xLOH\":[\"Suporte ao cliente\"],\"n1GRql\":[\"Nova etiqueta\"],\"n1ekoW\":[\"Entrar\"],\"n9V+ps\":[\"Insira seu nome\"],\"nOhz3x\":[\"Sair\"],\"nabda1\":[\"Excluir cartÃ£o\"],\"nbfdhU\":[\"IntegraÃ§Ãµes\"],\"nhMhRr\":[\"Obrigado pelo seu feedback!\"],\"njJFtc\":[\"Excluir comentÃ¡rio\"],\"nk7caK\":[\"Conectar Trello\"],\"nol/Fb\":[\"Como convido membros da equipe?\"],\"notwF1\":[\"O nome do modelo nÃ£o pode exceder 100 caracteres\"],\"nq7q3Z\":[\"O nome da chave de API nÃ£o pode exceder 30 caracteres\"],\"nqdIhs\":[\"Modelos de quadro personalizados\"],\"nryrgW\":[\"Todas as permissÃµes personalizadas dos membros foram redefinidas para os padrÃµes de suas funÃ§Ãµes.\"],\"nxb+xc\":[\"unassigned <0>\",[\"memberName\"],\"</0> from the card\"],\"o+JCfN\":[\"Confiado por equipes Ã¡geis<0/>ao redor do mundo\"],\"o7J4JM\":[\"Filtrar\"],\"o9WLwO\":[\"NÃ£o foi possÃ­vel atualizar cartÃ£o\"],\"oBndex\":[\"When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over time (and atlassification) it lost its magic and grew into something closer to \\\"Jira Lite\\\". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.\"],\"oVBq1w\":[\"por usuÃ¡rio/mÃªs\"],\"oW13KZ\":[\"Comece gratuitamente hoje\"],\"oXpmwC\":[\"Auto-hospedÃ¡vel\"],\"odFCYX\":[\"Convite invÃ¡lido\"],\"ohktr7\":[\"ComentÃ¡rios e menÃ§Ãµes\"],\"okpxfB\":[\"Criar nova chave\"],\"oyRjD/\":[\"Plano Pro\"],\"p/hk9N\":[\"VocÃª fez login com sucesso.\"],\"pBsoKL\":[\"Adicionar aos favoritos\"],\"pFGfsR\":[\"Confira alguns dos nossos projetos open source favoritos.\"],\"pFKC6A\":[\"Nome da chave de API\"],\"pL78ec\":[\"Adicionado aos favoritos\"],\"pXVFJy\":[\"Pode excluir quadros\"],\"pa9o5D\":[\"Recortar seu avatar\"],\"pfa8F0\":[\"Nome de exibiÃ§Ã£o\"],\"pmUArF\":[\"Workspace\"],\"pnrmSP\":[\"Novo card\"],\"poDo/D\":[\"Create new board\"],\"ppaRWv\":[\"Auto-hospedagem\"],\"pvnfJD\":[\"Escuro\"],\"q+lt9D\":[\"Erro ao excluir etiqueta\"],\"qPP4lD\":[\"Convidar membros exige um Plano Team. VocÃª serÃ¡ redirecionado para fazer upgrade do seu workspace.\"],\"qQXocp\":[\"Pode gerenciar configuraÃ§Ãµes do workspace\"],\"qfUS/w\":[\"Amigos de cÃ³digo aberto\"],\"qkjvgj\":[\"Seu workspace foi excluÃ­do.\"],\"qlAIQ1\":[\"Remoto\"],\"qrT8WB\":[\"#1 Hacker News\"],\"qtE5nt\":[\"Adicionar um item...\"],\"qzdST2\":[\"Visibilidade do quadro\"],\"r6BgwX\":[\"A senha Ã© obrigatÃ³ria para fazer login.\"],\"rD6UIt\":[\"Comece na nuvem\"],\"rF8SEQ\":[\"Editar comentÃ¡rio\"],\"rRM7r0\":[\"Importe seus quadros do Trello e comece a trabalhar imediatamente.\"],\"rYUZIe\":[\"Selecionar origem\"],\"raHesj\":[\"VocÃª cancelou a inscriÃ§Ã£o!\"],\"rarRW/\":[\"Erro ao convidar membro\"],\"ri1hHe\":[\"Vence no prÃ³ximo mÃªs\"],\"rmN315\":[\"DiversÃ£o\"],\"rs7L54\":[\"adicionou um membro ao cartÃ£o\"],\"rtbVvN\":[\"Pode editar listas\"],\"s+MGs7\":[\"Recursos\"],\"s6iE/c\":[\"O cadastro estÃ¡ temporariamente desabilitado. Por favor, tente novamente mais tarde.\"],\"sBhOFG\":[\"Gerenciamento visual de tarefas simples que funciona. Arraste e solte cartÃµes, colabore com sua equipe e realize mais.\"],\"sDLCvT\":[\"Conecte suas ferramentas favoritas para otimizar seu fluxo de trabalho.\"],\"sDuhfK\":[\"Oferta de lanÃ§amento: assentos ilimitados por apenas $29/mÃªs com o Pro\"],\"sUZo7y\":[\"Cadastrar-se | kan.bn\"],\"sVBn4K\":[\"Erro ao atualizar nome de exibiÃ§Ã£o\"],\"sY2lzr\":[\"Nenhuma URL de download disponÃ­vel para este anexo.\"],\"seaklU\":[\"Boards | \",[\"0\"]],\"t+R8+P\":[\"ExecuÃ§Ã£o\"],\"t/YqKh\":[\"Remover\"],\"t2nDzl\":[\"Visualize e gerencie sua cobranÃ§a e assinatura.\"],\"t6FvJH\":[\"Pode adicionar comentÃ¡rios\"],\"tGwwnq\":[\"atualizou a descriÃ§Ã£o\"],\"tHcbLF\":[\"Pode editar quadros\"],\"tHjBUm\":[\"Kan\"],\"tIdipJ\":[\"Editar URL do quadro\"],\"tMYIu7\":[\"Registros de atividades\"],\"tTbref\":[\"A senha Ã© obrigatÃ³ria para se cadastrar.\"],\"tYN21H\":[\"O usuÃ¡rio jÃ¡ Ã© membro deste workspace\"],\"tca56/\":[\"Seu arquivo foi enviado com sucesso.\"],\"tfDRzk\":[\"Salvar\"],\"tmlJN1\":[\"Por favor, insira uma URL vÃ¡lida do YouTube\"],\"tmpW+w\":[\"Excluir quadro\"],\"tyHiOa\":[\"Por favor, tente novamente mais tarde ou entre em contato com o suporte ao cliente.\"],\"u2+JIh\":[\"URLs personalizadas exigem upgrade para o plano Pro\"],\"u8JHrO\":[\"Limpar filtros\"],\"uOqaMC\":[\"VocÃª foi convidado para entrar em um workspace.\"],\"uXGLuq\":[\"Criar chave de API\"],\"uZg2+w\":[\"Turbine seu workspace por apenas $29/mÃªs. Veja o que vocÃª vai receber:\"],\"uck1tz\":[\"removeu um membro do cartÃ£o\"],\"usVytm\":[\"Uma vez que vocÃª excluir sua conta, nÃ£o hÃ¡ como voltar atrÃ¡s. Esta aÃ§Ã£o nÃ£o pode ser desfeita.\"],\"uwBBCy\":[\"Kan Ã© melhor com uma equipe. Perfeito para equipes pequenas e em crescimento que buscam colaborar.\"],\"v+Wp++\":[\"CÃ³digo aberto\"],\"v3YoMA\":[\"SÃªnior\"],\"vAR/I8\":[\"Execute na sua prÃ³pria infraestrutura\"],\"vAj6xG\":[\"VocÃª pode fazer self-host seguindo as instruÃ§Ãµes em nosso <0>repositÃ³rio</0>.\"],\"vMCCIc\":[\"A URL nÃ£o pode exceder 24 caracteres\"],\"vSJd18\":[\"VÃ­deo\"],\"vUr5JT\":[\"NÃ£o tem uma conta? <0><1>Cadastre-se</1></0>\"],\"vXIe7J\":[\"Idioma\"],\"vXemf6\":[\"Bug\"],\"va/3u1\":[\"Controle quem pode visualizar e editar seus quadros.\"],\"vbskQn\":[\"O nome da chave de API Ã© obrigatÃ³rio\"],\"veIDCY\":[\"Iniciar teste gratuito de 14 dias\"],\"vfRdCZ\":[\"NÃ£o foi possÃ­vel redefinir as permissÃµes\"],\"vgdzLf\":[\"Criar outro\"],\"vifyyw\":[\"JurÃ­dico\"],\"vlxQFL\":[\"As permissÃµes deste membro foram redefinidas para os padrÃµes de sua funÃ§Ã£o.\"],\"vneRvS\":[\"cobranÃ§a mensal\"],\"vuxdLS\":[\"Longo prazo\"],\"vwGkYB\":[\"A senha deve ter pelo menos 8 caracteres\"],\"wIb7Ng\":[\"Desenvolvimento de software\"],\"wIkTTk\":[\"Workspace name cannot exceed 24 characters\"],\"wM8xd8\":[\"JÃºnior\"],\"wPZBpR\":[\"Por favor, selecione um arquivo para fazer upload.\"],\"wY+6Ye\":[\"Esta URL de quadro jÃ¡ estÃ¡ em uso\"],\"wakO3W\":[\"adicionou a lista de verificaÃ§Ã£o <0>\",[\"0\"],\"</0>\"],\"wewm3j\":[\"O nome do board nÃ£o pode exceder 100 caracteres\"],\"wgNoIs\":[\"Selecionar tudo\"],\"wlQNTg\":[\"Membros\"],\"wqkcin\":[\"Pode visualizar comentÃ¡rios\"],\"wqxglO\":[\"Aprendizado\"],\"wruKPE\":[\"Apoie o desenvolvimento do projeto\"],\"wtxjAY\":[\"Membros do workspace\"],\"wzR1hC\":[\"Board name cannot exceed 50 characters\"],\"x0kMO/\":[\"Erro ao atualizar URL do workspace\"],\"x8GeCD\":[\"Nome de exibiÃ§Ã£o atualizado\"],\"xEbBrW\":[\"Qual licenÃ§a vocÃª estÃ¡ usando?\"],\"xJO7ca\":[\"updated the title to <0>\",[\"toTitle\"],\"</0>\"],\"xMn+V9\":[\"Importando do Trello\"],\"xRPn3U\":[\"Insira seu endereÃ§o de e-mail\"],\"xvcYhz\":[\"Limpe quaisquer permissÃµes personalizadas de membros para que todos os membros herdem apenas as permissÃµes padrÃ£o de suas funÃ§Ãµes.\"],\"yCzSJ3\":[\"Workspaces ilimitados\"],\"yD3ZSw\":[\"Altere suas preferÃªncias de idioma.\"],\"yH4aFo\":[\"Share invite link\"],\"yV7o5I\":[\"Como importo meus quadros do Trello?\"],\"yb/fjw\":[\"AprovaÃ§Ã£o\"],\"yz7wBu\":[\"Fechar\"],\"zC8Whw\":[\"Comece criando uma nova lista\"],\"zDw80P\":[\"New board\"],\"zEGgv4\":[\"Compare nossos recursos para ver por que Kan Ã© a melhor escolha.\"],\"zERArS\":[\"atualizou o tÃ­tulo para <0>\",[\"0\"],\"</0>\"],\"zKY5xi\":[\"Criar link de convite\"],\"zLXwCk\":[\"my-workspace-name\"],\"zMjN8w\":[\"REST API\"],\"zMlxCA\":[\"1 usuÃ¡rio\"],\"zQPhSa\":[\"Converter em link\"],\"zQX5Dj\":[\"Nome da lista\"],\"zdMPUq\":[\"removed label <0>\",[\"label\"],\"</0>\"],\"zkWmBh\":[\"Anual\"],\"zl1b97\":[\"NÃ£o foi possÃ­vel criar cartÃ£o\"],\"zoEbXq\":[\"Pode visualizar cartÃµes\"],\"zto8aj\":[\"Trello desconectado\"],\"zwBp5t\":[\"Privado\"],\"zwWKhA\":[\"Saiba mais\"],\"zxKs+y\":[\"Vence amanhÃ£\"],\"zzDlyQ\":[\"Sucesso\"]}")as Messages;


================================================
FILE: apps/web/src/pages/_app.tsx
================================================
import "~/styles/globals.css";
import "~/utils/i18n";

import type { NextPage, Viewport } from "next";
import type { AppProps, AppType } from "next/app";
import type { ReactElement, ReactNode } from "react";
import { Plus_Jakarta_Sans } from "next/font/google";
import Script from "next/script";
import { env } from "next-runtime-env";
import { ThemeProvider } from "next-themes";
import posthog from "posthog-js";
import { PostHogProvider } from "posthog-js/react";
import { useEffect } from "react";

import { KeyboardShortcutProvider } from "~/providers/keyboard-shortcuts";
import { LinguiProviderWrapper } from "~/providers/lingui";
import { ModalProvider } from "~/providers/modal";
import { PopupProvider } from "~/providers/popup";
import { api } from "~/utils/api";

const jakarta = Plus_Jakarta_Sans({
  subsets: ["latin"],
  display: "swap",
});

export const metadata = {
  title: "Kan",
  description: "The open source Trello alternative",
  icons: [{ rel: "icon", url: "/favicon.ico" }],
};

export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false,
};

export type NextPageWithLayout<P = {}, IP = P> = NextPage<P, IP> & {
  getLayout?: (page: ReactElement) => ReactNode;
};

type AppPropsWithLayout = AppProps & {
  Component: NextPageWithLayout;
};

const MyApp: AppType = ({ Component, pageProps }: AppPropsWithLayout) => {
  const posthogKey = env("NEXT_PUBLIC_POSTHOG_KEY");

  useEffect(() => {
    if (posthogKey) {
      posthog.init(posthogKey, {
        api_host: env("NEXT_PUBLIC_POSTHOG_HOST"),
        person_profiles: "identified_only",
        defaults: "2025-05-24",
        loaded: (posthog) => {
          if (process.env.NODE_ENV === "development") posthog.debug();
        },
      });
    }
  }, [posthogKey]);

  const getLayout = Component.getLayout ?? ((page) => page);

  return (
    <>
      <style jsx global>{`
        html {
          font-family: ${jakarta.style.fontFamily};
        }
        body {
          position: relative;
        }
      `}</style>
      {env("NEXT_PUBLIC_UMAMI_ID") && (
        <Script
          defer
          src="https://cloud.umami.is/script.js"
          data-website-id={env("NEXT_PUBLIC_UMAMI_ID")}
        />
      )}
      <script src="/__ENV.js" />
      <main className="font-sans">
        <KeyboardShortcutProvider>
          <LinguiProviderWrapper>
            <ThemeProvider attribute="class" defaultTheme="system" enableSystem>
              <ModalProvider>
                <PopupProvider>
                  {posthogKey ? (
                    <PostHogProvider client={posthog}>
                      {getLayout(<Component {...pageProps} />)}
                    </PostHogProvider>
                  ) : (
                    getLayout(<Component {...pageProps} />)
                  )}
                </PopupProvider>
              </ModalProvider>
            </ThemeProvider>
          </LinguiProviderWrapper>
        </KeyboardShortcutProvider>
      </main>
    </>
  );
};

export default api.withTRPC(MyApp);



================================================
FILE: apps/web/src/pages/index.tsx
================================================
import HomeView from "~/views/home";

export default function Home() {
  return <HomeView />;
}



================================================
FILE: apps/web/src/pages/[workspaceSlug]/[...boardSlug].tsx
================================================
import PublicBoardView from "~/views/public/board";

export default function PublicBoardsPage() {
  return <PublicBoardView />;
}



================================================
FILE: apps/web/src/pages/[workspaceSlug]/index.tsx
================================================
import PublicBoardsView from "~/views/public/boards";

export default function PublicBoardsPage() {
  return <PublicBoardsView />;
}



================================================
FILE: apps/web/src/pages/api/oss-friends.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";

import { withRateLimit } from "@kan/api/utils/rateLimit";

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const response = await fetch("https://formbricks.com/api/oss-friends");
    if (!response.ok) {
      throw new Error("Failed to fetch from Formbricks");
    }
    const data = await response.json();

    return res.status(200).json(data);
  } catch (error) {
    console.error("Error fetching OSS friends:", error);
    return res.status(500).json({ message: "Failed to fetch OSS friends" });
  }
  },
);



================================================
FILE: apps/web/src/pages/api/unsubscribe.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import { Novu } from "@novu/api";
import { jwtVerify } from "jose";
import { z } from "zod";

import { env } from "~/env";
import { withRateLimit } from "@kan/api/utils/rateLimit";

const requestSchema = z.object({
  token: z.string().min(1),
});

const tokenPayloadSchema = z.object({
  subscriberId: z.string(),
});

type ResponseData =
  | { success: true }
  | { success: false; error: string; code?: string };

const textEncoder = new TextEncoder();

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse<ResponseData>) => {
  if (process.env.NEXT_PUBLIC_KAN_ENV !== "cloud") {
    return res.status(404).json({
      success: false,
      error: "Unsubscribe endpoint is not available.",
      code: "UNAVAILABLE",
    });
  }

  if (req.method !== "POST") {
    res.setHeader("Allow", "POST");
    return res.status(405).json({
      success: false,
      error: "Method not allowed.",
      code: "METHOD_NOT_ALLOWED",
    });
  }

  const parsedBody = requestSchema.safeParse(req.body);

  if (!parsedBody.success) {
    return res.status(400).json({
      success: false,
      error: "Invalid request payload.",
      code: "BAD_REQUEST",
    });
  }

  if (!env.EMAIL_UNSUBSCRIBE_SECRET || !env.NOVU_API_KEY) {
    return res.status(500).json({
      success: false,
      error: "Unsubscribe service is not configured.",
      code: "NOT_CONFIGURED",
    });
  }

  let payload: z.infer<typeof tokenPayloadSchema>;

  try {
    const verified = await jwtVerify(
      parsedBody.data.token,
      textEncoder.encode(env.EMAIL_UNSUBSCRIBE_SECRET),
      {
        // We intentionally do not use exp/iat claims â€“
        // tokens are long-lived and validated only by signature + payload.
        clockTolerance: "0s",
      },
    );
    payload = tokenPayloadSchema.parse(verified.payload);
  } catch {
    return res.status(401).json({
      success: false,
      error: "Your unsubscribe link is invalid or has expired.",
      code: "INVALID_TOKEN",
    });
  }

  const novu = new Novu({ secretKey: env.NOVU_API_KEY });

  try {
    await novu.subscribers.preferences.update(
      {
        channels: {
          email: false,
        },
      },
      payload.subscriberId,
    );
  } catch (error) {
    console.error("Failed to update Novu preferences", error);
    return res.status(502).json({
      success: false,
      error:
        "We could not update your email preferences right now. Please try again later.",
      code: "NOVU_ERROR",
    });
  }

  return res.status(200).json({ success: true });
  },
);



================================================
FILE: apps/web/src/pages/api/auth/[...all].ts
================================================
import { toNodeHandler } from "better-auth/node";

import { initAuth } from "@kan/auth/server";
import { createDrizzleClient } from "@kan/db/client";
import { withRateLimit } from "@kan/api/utils/rateLimit";

export const config = { api: { bodyParser: false } };

export const auth = initAuth(createDrizzleClient());

const authHandler = toNodeHandler(auth.handler);

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req, res) => {
    /**
     * Better-auth behind proxies (Nginx/Cloudflare) can sometimes fail to parse the protocol
     * if headers are incorrectly set or if there are multiple values in X-Forwarded-Proto.
     * We sanitize these headers here to ensure better-auth gets a clean protocol and host.
     */
    const forwardedProto = req.headers["x-forwarded-proto"];
    if (forwardedProto) {
      const p = Array.isArray(forwardedProto) ? forwardedProto[0] : forwardedProto;
      req.headers["x-forwarded-proto"] = p?.split(",")[0]?.trim();
    }

    const forwardedHost = req.headers["x-forwarded-host"];
    if (forwardedHost) {
      const h = Array.isArray(forwardedHost) ? forwardedHost[0] : forwardedHost;
      req.headers["host"] = h?.split(",")[0]?.trim();
    }

    return await authHandler(req, res);
  },
);



================================================
FILE: apps/web/src/pages/api/download/attatchment.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";

import { withRateLimit } from "@kan/api/utils/rateLimit";

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  const { url, filename } = req.query;

  if (!url || typeof url !== "string") {
    return res.status(400).json({
      message: "url parameter is required",
    });
  }

  try {
    const downloadFilename = typeof filename === "string"
      ? encodeURIComponent(filename)
      : "attachment";

    const upstream = await fetch(url);

    if (!upstream.ok) {
      return res.status(upstream.status).json({
        message: "Failed to fetch attachment",
      });
    }

    const contentType =
      upstream.headers.get("Content-Type") ?? "application/octet-stream";

    res.setHeader("Content-Type", contentType);
    res.setHeader(
      "Content-Disposition",
      `attachment; filename="${downloadFilename}"; filename*=UTF-8''${downloadFilename}`,
    );

    const buffer = await upstream.arrayBuffer();
    return res.send(Buffer.from(buffer));
  } catch (error) {
    console.error("Error downloading attachment:", error);
    return res.status(500).json({ message: "Failed to download attachment" });
  }
  },
);



================================================
FILE: apps/web/src/pages/api/stripe/create_billing_session.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import { env } from "next-runtime-env";

import { createNextApiContext } from "@kan/api/trpc";
import { createStripeClient } from "@kan/stripe";
import { withRateLimit } from "@kan/api/utils/rateLimit";

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
  const stripe = createStripeClient();

  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { user } = await createNextApiContext(req);

    if (!user?.stripeCustomerId) {
      return res.status(404).json({ error: "No billing account found" });
    }

    const session = await stripe.billingPortal.sessions.create({
      customer: user.stripeCustomerId,
      return_url: `${env("NEXT_PUBLIC_BASE_URL")}/settings`,
    });

    return res.status(200).json({ url: session.url });
  } catch (error) {
    console.error("Error:", error);
    return res.status(500).json({ error: "Error creating portal session" });
  }
  },
);



================================================
FILE: apps/web/src/pages/api/stripe/create_checkout_session.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import { env } from "next-runtime-env";
import { z } from "zod";

import { createNextApiContext } from "@kan/api/trpc";
import * as subscriptionRepo from "@kan/db/repository/subscription.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import { createStripeClient } from "@kan/stripe";
import { withRateLimit } from "@kan/api/utils/rateLimit";

const workspaceSlugSchema = z
  .string()
  .min(3)
  .max(64)
  .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/);

interface CheckoutSessionRequest {
  successUrl: string;
  cancelUrl: string;
  slug: string;
  workspacePublicId: string;
  stripeCustomerId: string;
}

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
  const stripe = createStripeClient();

  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { user, db } = await createNextApiContext(req);

    if (!user) {
      return res.status(404).json({ error: "User not found" });
    }

    const body = req.body as CheckoutSessionRequest;
    const { successUrl, cancelUrl, slug, workspacePublicId } = body;

    if (!successUrl || !cancelUrl || !workspacePublicId) {
      return res.status(400).json({ error: "Missing required fields" });
    }

    if (slug) {
      const slugResult = workspaceSlugSchema.safeParse(slug);

      if (!slugResult.success) {
        return new Response(
          JSON.stringify({ error: "Invalid workspace slug" }),
          {
            status: 400,
            headers: { "Content-Type": "application/json" },
          },
        );
      }
    }

    const workspace = await workspaceRepo.getAllByUserId(db, user.id);

    const isMemberOfWorkspace = workspace.some(
      ({ workspace }) => workspace.publicId === body.workspacePublicId,
    );

    if (!isMemberOfWorkspace) {
      return new Response(JSON.stringify({ error: "Unauthorized" }), {
        status: 403,
        headers: { "Content-Type": "application/json" },
      });
    }

    const subscription = await subscriptionRepo.create(db, {
      plan: "pro",
      referenceId: workspacePublicId,
      userId: user.id,
      stripeCustomerId: user.stripeCustomerId ?? "",
      status: "incomplete",
    });

    const subscriptionId = subscription?.id;

    if (!subscriptionId) {
      return res.status(500).json({ error: "Error creating subscription" });
    }

    const session = await stripe.checkout.sessions.create({
      mode: "subscription",
      payment_method_collection: "always",
      line_items: [
        {
          price: process.env.STRIPE_PRO_PLAN_MONTHLY_PRICE_ID,
          quantity: 1,
        },
      ],
      subscription_data: {
        trial_period_days: 14,
      },
      success_url: `${env("NEXT_PUBLIC_BASE_URL")}${successUrl}`,
      cancel_url: `${env("NEXT_PUBLIC_BASE_URL")}${cancelUrl}`,
      client_reference_id: workspacePublicId,
      customer: user.stripeCustomerId ?? undefined,
      metadata: {
        ...(slug && { workspaceSlug: slug }),
        workspacePublicId,
        userId: user.id,
        subscriptionId,
      },
    });

    return res.status(200).json({ url: session.url });
  } catch (error) {
    console.error("Error:", error);
    return res.status(500).json({ error: "Error creating checkout session" });
  }
  },
);



================================================
FILE: apps/web/src/pages/api/stripe/webhook.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import type { Readable } from "node:stream";

import { createNextApiContext } from "@kan/api/trpc";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import { createStripeClient } from "@kan/stripe";

async function buffer(readable: Readable) {
  const chunks = [];
  for await (const chunk of readable) {
    chunks.push(typeof chunk === "string" ? Buffer.from(chunk) : chunk);
  }
  return Buffer.concat(chunks);
}

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse,
) {
  const stripe = createStripeClient();

  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  const sig = req.headers["stripe-signature"];

  if (!sig) {
    return res.status(400).json({ message: "No signature found" });
  }

  try {
    const buf = await buffer(req);
    const rawBody = buf.toString("utf8");

    const event = stripe.webhooks.constructEvent(
      rawBody,
      sig,
      process.env.STRIPE_WEBHOOK_SECRET_LEGACY!,
    );

    const { db } = await createNextApiContext(req);

    switch (event.type) {
      case "checkout.session.completed": {
        const checkoutSession = event.data.object;

        const metaData = checkoutSession.metadata;

        if (metaData?.workspacePublicId) {
          await workspaceRepo.update(db, metaData.workspacePublicId, {
            ...(metaData.workspaceSlug && { slug: metaData.workspaceSlug }),
            plan: "pro",
          });
        }
        break;
      }
      default:
        console.log(`Unhandled event type: ${event.type}`);
    }

    return res.status(200).json({ received: true });
  } catch (err) {
    console.error("Webhook error:", err);
    return res.status(400).json({ message: "Webhook handler failed" });
  }
}

export const config = {
  api: {
    bodyParser: false,
  },
};



================================================
FILE: apps/web/src/pages/api/trello/authenticate.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";

import { createNextApiContext } from "@kan/api/trpc";
import { integrations } from "@kan/db/schema";
import { addYears } from "date-fns";
import { withRateLimit } from "@kan/api/utils/rateLimit";

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  const { user } = await createNextApiContext(req);

  if (!user)
    return res.status(401).json({ message: "User not authenticated" });

  const apiKey = process.env.TRELLO_APP_API_KEY;

  if (!apiKey)
    return res.status(500).json({ message: "Trello API key not set in Environment Variables" });

  const token = req.body.token;

  if (!token)
    return res.status(400).json({ message: "No token found" });

  try {
    const { db } = await createNextApiContext(req);

    await db.insert(integrations).values({
      provider: "trello",
      userId: user.id,
      accessToken: token,
      expiresAt: addYears(new Date(), 1),
    }).onConflictDoUpdate({
      set: {
        accessToken: token,
        expiresAt: addYears(new Date(), 1),
      },
      target: [integrations.userId, integrations.provider],
    });

    return res.status(200).json({ message: "Trello authentication successful" });
  } catch (err) {
    console.error("Trello authentication error:", err);
    return res.status(400).json({ message: "Trello authentication failed" });
  }
  },
);


================================================
FILE: apps/web/src/pages/api/trpc/[trpc].ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import { createNextApiHandler } from "@trpc/server/adapters/next";

import { appRouter } from "@kan/api/root";
import { createTRPCContext } from "@kan/api/trpc";
import { env } from "~/env";
import { withRateLimit } from "@kan/api/utils/rateLimit";

const nextApiHandler = createNextApiHandler({
  router: appRouter,
  createContext: createTRPCContext,
  onError:
    env.NODE_ENV === "development"
      ? ({ path, error }) => {
          console.error(
            `âŒ tRPC failed on ${path ?? "<no-path>"}: ${error.message}`,
          );
        }
      : undefined,
});

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
    if (req.method === "OPTIONS") {
      res.writeHead(200);
      res.end();
      return;
    }

    const result = await nextApiHandler(req, res);
    return result;
  },
);



================================================
FILE: apps/web/src/pages/api/upload/attachment.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import { Upload } from "@aws-sdk/lib-storage";

import { createNextApiContext } from "@kan/api/trpc";
import { assertPermission } from "@kan/api/utils/permissions";
import { withRateLimit } from "@kan/api/utils/rateLimit";
import * as cardRepo from "@kan/db/repository/card.repo";
import * as cardActivityRepo from "@kan/db/repository/cardActivity.repo";
import * as cardAttachmentRepo from "@kan/db/repository/cardAttachment.repo";
import { createS3Client, generateUID } from "@kan/shared/utils";

import { env } from "~/env";

// FIXME: Respect the environment variable: NEXT_API_BODY_SIZE_LIMIT
const MAX_SIZE_BYTES = 50 * 1024 * 1024; // 50MB

export const config = {
  api: {
    bodyParser: false,
  },
};

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
    if (req.method !== "POST") {
      return res.status(405).json({ error: "Method not allowed" });
    }

    try {
      const { user, db } = await createNextApiContext(req);

      if (!user) {
        return res.status(401).json({ error: "Unauthorized" });
      }

      const bucket = env.NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME;
      if (!bucket) {
        return res.status(500).json({ error: "Attachments bucket not configured" });
      }

      const cardPublicId = req.query.cardPublicId;
      if (typeof cardPublicId !== "string" || cardPublicId.length < 12) {
        return res.status(400).json({ error: "Invalid cardPublicId" });
      }

      const contentType = req.headers["content-type"];
      const contentLengthHeader = req.headers["content-length"];
      const contentLength = contentLengthHeader
        ? Number.parseInt(contentLengthHeader, 10)
        : NaN;

      if (typeof contentType !== "string") {
        return res.status(400).json({ error: "Missing content type" });
      }

      if (!Number.isFinite(contentLength) || contentLength <= 0) {
        return res.status(400).json({ error: "Missing or invalid content length" });
      }

      if (contentLength > MAX_SIZE_BYTES) {
        return res.status(400).json({ error: "File too large" });
      }

      const originalFilenameHeader =
        (req.headers["x-original-filename"] as string | undefined) ?? "file";

      const sanitizedFilename = originalFilenameHeader
        .replace(/[^a-zA-Z0-9._-]/g, "_")
        .substring(0, 200);

      // Get card and check permissions
      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        db,
        cardPublicId,
      );

      if (!card) {
        return res.status(404).json({ error: "Card not found" });
      }

      // Check if user has permission to edit the card
      try {
        await assertPermission(db, user.id, card.workspaceId, "card:edit");
      } catch {
        return res.status(403).json({ error: "Permission denied" });
      }

      const s3Key = `${card.workspaceId}/${cardPublicId}/${generateUID()}-${sanitizedFilename}`;

      const client = createS3Client();

      const upload = new Upload({
        client,
        params: {
          Bucket: bucket,
          Key: s3Key,
          Body: req,
          ContentType: contentType,
          ContentLength: contentLength,
        },
        leavePartsOnError: false,
      });

      await upload.done();

      // Create attachment record and log activity
      const attachment = await cardAttachmentRepo.create(db, {
        cardId: card.id,
        filename: sanitizedFilename,
        originalFilename: originalFilenameHeader,
        contentType,
        size: contentLength,
        s3Key,
        createdBy: user.id,
      });

      if (!attachment) {
        return res.status(500).json({ error: "Failed to create attachment" });
      }

      await cardActivityRepo.create(db, {
        type: "card.updated.attachment.added",
        cardId: card.id,
        attachmentId: attachment.id,
        toTitle: originalFilenameHeader,
        createdBy: user.id,
      });

      return res.status(200).json({ attachment });
    } catch (error) {
      console.error("Attachment upload failed", error);
      return res.status(500).json({ error: "Internal server error" });
    }
  },
);



================================================
FILE: apps/web/src/pages/api/upload/avatar.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import { PutObjectCommand } from "@aws-sdk/client-s3";

import { createNextApiContext } from "@kan/api/trpc";
import * as userRepo from "@kan/db/repository/user.repo";

import { env } from "~/env";
import { withRateLimit } from "@kan/api/utils/rateLimit";
import { createS3Client } from "@kan/shared/utils";

const MAX_SIZE_BYTES = 2 * 1024 * 1024; // 2MB
const allowedContentTypes = ["image/jpeg", "image/png", "image/webp"];

export const config = {
  api: {
    bodyParser: false,
  },
};

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
    if (req.method !== "POST") {
      return res.status(405).json({ error: "Method not allowed" });
    }

    try {
      const { user, db } = await createNextApiContext(req);

      if (!user) {
        return res.status(401).json({ error: "Unauthorized" });
      }

      const bucket = env.NEXT_PUBLIC_AVATAR_BUCKET_NAME;
      if (!bucket) {
        return res.status(500).json({ error: "Avatar bucket not configured" });
      }

      const contentType = req.headers["content-type"];
      const contentLengthHeader = req.headers["content-length"];
      const contentLength = contentLengthHeader
        ? Number.parseInt(contentLengthHeader, 10)
        : NaN;

      if (typeof contentType !== "string") {
        return res.status(400).json({ error: "Missing content type" });
      }

      if (!allowedContentTypes.includes(contentType)) {
        return res.status(400).json({ error: "Invalid content type" });
      }

      if (!Number.isFinite(contentLength) || contentLength <= 0) {
        return res.status(400).json({ error: "Missing or invalid content length" });
      }

      if (contentLength > MAX_SIZE_BYTES) {
        return res.status(400).json({ error: "File too large" });
      }

      const originalFilenameHeader =
        (req.headers["x-original-filename"] as string | undefined) ?? "file";

      const sanitizedFilename = originalFilenameHeader
        .replace(/[^a-zA-Z0-9._-]/g, "_")
        .substring(0, 200);

      const s3Key = `${user.id}/${sanitizedFilename}`;

      const client = createS3Client();

      // Upload the file to S3
      await client.send(
        new PutObjectCommand({
          Bucket: bucket,
          Key: s3Key,
          Body: req,
          ContentType: contentType,
          ContentLength: contentLength,
        }),
      );

      // Update user image in database
      const updatedUser = await userRepo.update(db, user.id, {
        image: s3Key,
      });

      return res.status(200).json({
        key: s3Key,
        filename: sanitizedFilename,
        contentType,
        size: contentLength,
        user: updatedUser,
      });
    } catch (error) {
      console.error("Avatar upload failed", error);
      return res.status(500).json({ error: "Internal server error" });
    }
  },
);




================================================
FILE: apps/web/src/pages/api/v1/[...trpc].ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import cors from "nextjs-cors";
import { createOpenApiNextHandler } from "trpc-to-openapi";

import { appRouter } from "@kan/api";
import { createRESTContext } from "@kan/api/trpc";

import { env } from "~/env";
import { withRateLimit } from "@kan/api/utils/rateLimit";

export default withRateLimit(
  { points: 100, duration: 60 },
  async (req: NextApiRequest, res: NextApiResponse) => {
    await cors(req, res);

    const openApiHandler = createOpenApiNextHandler({
      router: appRouter,
      createContext: createRESTContext,
      onError:
        env.NODE_ENV === "development"
          ? ({ path, error }) => {
              console.error(
                `âŒ REST failed on ${path ?? "<no-path>"}: ${error.message}`,
              );
            }
          : undefined,
    });

    return await openApiHandler(req, res);
  },
);



================================================
FILE: apps/web/src/pages/api/v1/openapi.json.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";

import { openApiDocument } from "@kan/api/openapi";
import { withRateLimit } from "@kan/api/utils/rateLimit";

export default withRateLimit(
  { points: 100, duration: 60 },
  (req: NextApiRequest, res: NextApiResponse) => {
    res.status(200).send(openApiDocument);
  },
);



================================================
FILE: apps/web/src/pages/boards/index.tsx
================================================
import type { NextPageWithLayout } from "../_app";
import { getDashboardLayout } from "~/components/Dashboard";
import Popup from "~/components/Popup";
import BoardsView from "~/views/boards";

const BoardsPage: NextPageWithLayout = () => {
  return (
    <>
      <BoardsView />
      <Popup />
    </>
  );
};

BoardsPage.getLayout = (page) => getDashboardLayout(page);

export default BoardsPage;



================================================
FILE: apps/web/src/pages/boards/[...boardId]/index.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import Popup from "~/components/Popup";
import BoardView from "~/views/board";

const BoardPage: NextPageWithLayout = () => {
  return (
    <>
      <BoardView />
      <Popup />
    </>
  );
};

BoardPage.getLayout = (page) => getDashboardLayout(page);

export default BoardPage;



================================================
FILE: apps/web/src/pages/cards/[cardId]/index.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import Popup from "~/components/Popup";
import CardView, { CardRightPanel } from "~/views/card";

const CardPage: NextPageWithLayout = () => {
  return (
    <>
      <CardView />
      <Popup />
    </>
  );
};

CardPage.getLayout = (page) =>
  getDashboardLayout(page, <CardRightPanel />, true);

export default CardPage;



================================================
FILE: apps/web/src/pages/invite/[code].tsx
================================================
import InviteView from "~/views/invite";

export default function InvitePage() {
  return <InviteView />;
}



================================================
FILE: apps/web/src/pages/login/index.tsx
================================================
import LoginView from "~/views/auth/login";

export default function LoginPage() {
  return <LoginView />;
}



================================================
FILE: apps/web/src/pages/members/index.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import Popup from "~/components/Popup";
import MembersView from "~/views/members";

const MembersPage: NextPageWithLayout = () => {
  return (
    <>
      <MembersView />
      <Popup />
    </>
  );
};

MembersPage.getLayout = (page) => getDashboardLayout(page);

export default MembersPage;



================================================
FILE: apps/web/src/pages/oss-friends/index.tsx
================================================
import OSSFriendsView from "~/views/oss-friends";

export default function OSSFriends() {
  return <OSSFriendsView />;
}



================================================
FILE: apps/web/src/pages/pricing/index.tsx
================================================
import PricingView from "~/views/pricing";

export default function Pricing() {
  return <PricingView />;
}



================================================
FILE: apps/web/src/pages/privacy/index.tsx
================================================
import PrivacyView from "~/views/privacy";

export default function Privacy() {
  return <PrivacyView />;
}



================================================
FILE: apps/web/src/pages/settings/account.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import { SettingsLayout } from "~/components/SettingsLayout";
import AccountSettings from "~/views/settings/AccountSettings";

const AccountSettingsPage: NextPageWithLayout = () => {
  return (
    <SettingsLayout currentTab="account">
      <AccountSettings />
    </SettingsLayout>
  );
};

AccountSettingsPage.getLayout = (page) => getDashboardLayout(page);

export default AccountSettingsPage;



================================================
FILE: apps/web/src/pages/settings/api.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import { SettingsLayout } from "~/components/SettingsLayout";
import ApiSettings from "~/views/settings/ApiSettings";
import Popup from "~/components/Popup";

const ApiSettingsPage: NextPageWithLayout = () => {
  return (
    <SettingsLayout currentTab="api">
      <ApiSettings />
      <Popup />
    </SettingsLayout>
  );
};

ApiSettingsPage.getLayout = (page) => getDashboardLayout(page);

export default ApiSettingsPage;



================================================
FILE: apps/web/src/pages/settings/billing.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import { SettingsLayout } from "~/components/SettingsLayout";
import BillingSettings from "~/views/settings/BillingSettings";
import Popup from "~/components/Popup";

const BillingSettingsPage: NextPageWithLayout = () => {
  return (
    <SettingsLayout currentTab="billing">
      <BillingSettings />
      <Popup />
    </SettingsLayout>
  );
};

BillingSettingsPage.getLayout = (page) => getDashboardLayout(page);

export default BillingSettingsPage;



================================================
FILE: apps/web/src/pages/settings/integrations.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import { SettingsLayout } from "~/components/SettingsLayout";
import IntegrationsSettings from "~/views/settings/IntegrationsSettings";
import Popup from "~/components/Popup";

const IntegrationsSettingsPage: NextPageWithLayout = () => {
  return (
    <SettingsLayout currentTab="integrations">
      <IntegrationsSettings />
      <Popup />
    </SettingsLayout>
  );
};

IntegrationsSettingsPage.getLayout = (page) => getDashboardLayout(page);

export default IntegrationsSettingsPage;



================================================
FILE: apps/web/src/pages/settings/permissions.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import { SettingsLayout } from "~/components/SettingsLayout";
import Popup from "~/components/Popup";
import PermissionsSettings from "~/views/settings/PermissionsSettings";

const PermissionsSettingsPage: NextPageWithLayout = () => {
  return (
    <>
      <SettingsLayout currentTab="permissions">
        <PermissionsSettings />
        <Popup />
      </SettingsLayout>
      
    </>
  );
};

PermissionsSettingsPage.getLayout = (page) => getDashboardLayout(page);

export default PermissionsSettingsPage;





================================================
FILE: apps/web/src/pages/settings/workspace.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import { SettingsLayout } from "~/components/SettingsLayout";
import WorkspaceSettings from "~/views/settings/WorkspaceSettings";
import Popup from "~/components/Popup";

const WorkspaceSettingsPage: NextPageWithLayout = () => {
  return (
    <SettingsLayout currentTab="workspace">
      <WorkspaceSettings />
      <Popup />
    </SettingsLayout>
  );
};

WorkspaceSettingsPage.getLayout = (page) => getDashboardLayout(page);

export default WorkspaceSettingsPage;



================================================
FILE: apps/web/src/pages/settings/trello/authorize.tsx
================================================
import { useEffect } from "react";

export default function TrelloAuthorize() {
    useEffect(() => {
        const hash = window.location.hash;
        const token = hash.split("=")[1];
        if (token) {
            console.log("Posting token to /api/trello/authenticate", token);
            fetch("/api/trello/authenticate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ token }),
            }).then(() => {
                window.close();
            });
        }
    }, []);

    return <div className="flex h-[200px] items-center justify-center">
        <p className="text-center">Connecting to Trello...</p>
    </div>;
}


================================================
FILE: apps/web/src/pages/signup/index.tsx
================================================
import SignupView from "~/views/auth/signup";

export default function SignupPage() {
  return <SignupView />;
}



================================================
FILE: apps/web/src/pages/templates/index.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import Popup from "~/components/Popup";
import BoardsView from "~/views/boards";

const TemplatesPage: NextPageWithLayout = () => {
  return (
    <>
      <BoardsView isTemplate />
      <Popup />
    </>
  );
};

TemplatesPage.getLayout = (page) => getDashboardLayout(page);

export default TemplatesPage;



================================================
FILE: apps/web/src/pages/templates/[boardId]/index.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import Popup from "~/components/Popup";
import BoardView from "~/views/board";

const TemplatePage: NextPageWithLayout = () => {
  return (
    <>
      <BoardView isTemplate />
      <Popup />
    </>
  );
};

TemplatePage.getLayout = (page) => getDashboardLayout(page);

export default TemplatePage;



================================================
FILE: apps/web/src/pages/templates/[boardId]/cards/[cardId]/index.tsx
================================================
import type { NextPageWithLayout } from "~/pages/_app";
import { getDashboardLayout } from "~/components/Dashboard";
import Popup from "~/components/Popup";
import CardView, { CardRightPanel } from "~/views/card";

const CardPage: NextPageWithLayout = () => {
  return (
    <>
      <CardView isTemplate />
      <Popup />
    </>
  );
};

CardPage.getLayout = (page) =>
  getDashboardLayout(page, <CardRightPanel isTemplate />, true);

export default CardPage;



================================================
FILE: apps/web/src/pages/terms/index.tsx
================================================
import TermsView from "~/views/terms";

export default function Terms() {
  return <TermsView />;
}



================================================
FILE: apps/web/src/pages/unsubscribe/index.tsx
================================================
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";

import Button from "~/components/Button";
import { PageHead } from "~/components/PageHead";
import PatternedBackground from "~/components/PatternedBackground";

type UnsubscribeStatus = "idle" | "processing" | "success" | "error";

export default function UnsubscribePage() {
  const router = useRouter();
  const [token, setToken] = useState("");
  const [status, setStatus] = useState<UnsubscribeStatus>("idle");
  const [errorMessage, setErrorMessage] = useState<string | null>(null);

  useEffect(() => {
    if (!router.isReady) return;
    const value = router.query.token;
    if (typeof value === "string") {
      setToken(value);
    } else if (Array.isArray(value)) {
      setToken(value[0] ?? "");
    } else {
      setToken("");
    }
  }, [router.isReady, router.query.token]);

  const handleUnsubscribe = async () => {
    if (!token) {
      setStatus("error");
      setErrorMessage(
        t`Your unsubscribe link is missing a token. Please open the latest email and try again.`,
      );
      return;
    }

    setStatus("processing");
    setErrorMessage(null);

    try {
      const response = await fetch("/api/unsubscribe", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token }),
      });

      if (!response.ok) {
        const payload = (await response.json().catch(() => null)) as {
          error?: string;
        } | null;

        throw new Error(
          payload?.error ??
            "We couldn't update your preferences. Please try again.",
        );
      }

      setStatus("success");
    } catch (error) {
      setStatus("error");
      setErrorMessage(
        t`We couldn't update your preferences. Please try again.`,
      );
    }
  };

  const title = t`Unsubscribe`;

  return (
    <>
      <PageHead title={`${title} | kan.bn`} />
      <div className="relative flex min-h-screen items-center justify-center px-4 py-12 sm:px-6 lg:px-8">
        <PatternedBackground />
        <div className="z-10 w-full max-w-md space-y-6">
          <div>
            <h1 className="mt-6 text-center text-3xl font-bold tracking-tight text-light-1000 dark:text-dark-1000">
              {t`Do you want to unsubscribe?`}
            </h1>
            <p className="mt-4 text-center text-sm text-light-900 dark:text-dark-800">
              {t`Confirm your email preferences:`}
            </p>
          </div>

          <div className="flex justify-center">
            <Button
              onClick={handleUnsubscribe}
              disabled={status === "success"}
              isLoading={status === "processing"}
              variant="primary"
              size="md"
            >
              {t`Unsubscribe`}
            </Button>
          </div>
          {status === "success" && (
            <p className="text-center text-sm text-light-900 dark:text-dark-800">
              {t`You have been unsubscribed!`}
            </p>
          )}
          {status === "error" && (
            <p className="mx-auto max-w-[300px] text-center text-sm font-medium text-red-600 dark:text-red-400">
              {errorMessage}
            </p>
          )}
        </div>
      </div>
    </>
  );
}



================================================
FILE: apps/web/src/providers/keyboard-shortcuts.tsx
================================================
import type { ReactNode } from "react";
import React from "react";
import {
  Dialog,
  DialogBackdrop,
  DialogPanel,
  DialogTitle,
} from "@headlessui/react";
import { t } from "@lingui/core/macro";
import {
  createContext,
  useCallback,
  useContext,
  useEffect,
  useMemo,
  useRef,
  useState,
} from "react";
import { HiXMark } from "react-icons/hi2";

import { env } from "~/env";
import { useEventListener } from "~/hooks/useEventListener";

const ModifierKey = {
  CONTROL: "CONTROL",
  META: "META",
  ALT: "ALT",
  SHIFT: "SHIFT",
} as const;
type ModifierKey = (typeof ModifierKey)[keyof typeof ModifierKey];

const ModifierKeyInfo: Record<
  ModifierKey,
  {
    macSymbol: string;
    winName: string;
    linuxName: string;
  }
> = {
  CONTROL: { macSymbol: "âŒƒ", winName: "Ctrl", linuxName: "Ctrl" },
  META: { macSymbol: "âŒ˜", winName: "Win", linuxName: "Super" },
  ALT: { macSymbol: "âŒ¥", winName: "Alt", linuxName: "Alt" },
  SHIFT: { macSymbol: "â‡§", winName: "Shift", linuxName: "Shift" },
};

const ShortcutGroup = {
  GENERAL: "GENERAL",
  NAVIGATION: "NAVIGATION",
  ACTIONS: "ACTIONS",
} as const;
type ShortcutGroup = (typeof ShortcutGroup)[keyof typeof ShortcutGroup];

const getShortcutGroupInfo = (): Record<ShortcutGroup, { label: string }> => ({
  GENERAL: { label: t`General` },
  NAVIGATION: { label: t`Navigation` },
  ACTIONS: { label: t`Actions` },
});

interface KeyStroke {
  key: string;
  modifiers?: ModifierKey[];
}

interface Press {
  type: "PRESS";
  stroke: KeyStroke;
}

interface Sequence {
  type: "SEQUENCE";
  strokes: KeyStroke[];
}

export type KeyboardShortcut = {
  action: () => void;
  description: string;
  group: ShortcutGroup;
} & (Press | Sequence);

interface ShortcutTreeStepNode {
  type: "STEP";
  children: ShortcutTreeLevel;
}
interface ShortcutTreeActionNode {
  type: "ACTION";
  shortcut: KeyboardShortcut;
}
type ShortcutTreeNode = ShortcutTreeStepNode | ShortcutTreeActionNode;
type ShortcutTreeLevel = Record<string, ShortcutTreeNode>;

const SEQUENCE_TIMEOUT_MS = 1000;

const ShortcutConflictCode = {
  ACTION_ON_SEQUENCE: "ACTION_ON_SEQUENCE",
  DUPLICATE_ACTION: "DUPLICATE_ACTION",
  SEQUENCE_ON_ACTION: "SEQUENCE_ON_ACTION",
} as const;
type ShortcutConflictCode = keyof typeof ShortcutConflictCode;

interface ShortcutConflictErrorOptions {
  code: ShortcutConflictCode;
  shortcut: KeyboardShortcut;
  conflictPath: string;
  existingShortcut?: KeyboardShortcut;
}

class ShortcutConflictError extends Error {
  public readonly code: ShortcutConflictCode;
  public readonly shortcut: KeyboardShortcut;
  public readonly conflictPath: string;
  public readonly existingShortcut?: KeyboardShortcut;

  constructor(options: ShortcutConflictErrorOptions) {
    super(ShortcutConflictError.formatMessage(options));
    this.name = "ShortcutConflictError";
    this.code = options.code;
    this.shortcut = options.shortcut;
    this.conflictPath = options.conflictPath;
    this.existingShortcut = options.existingShortcut;
  }

  private static stringifyShortcut(shortcut: KeyboardShortcut): string {
    if (shortcut.type === "SEQUENCE") {
      return shortcut.strokes.map(serializeKeyStroke).join(" â†’ ");
    }
    return serializeKeyStroke(shortcut.stroke);
  }

  private static formatMessage(options: ShortcutConflictErrorOptions): string {
    const formatted = ShortcutConflictError.stringifyShortcut(options.shortcut);
    switch (options.code) {
      case ShortcutConflictCode.ACTION_ON_SEQUENCE:
        return `Cannot register "${formatted}": desired action conflicts with existing sequence at "${options.conflictPath}"`;
      case ShortcutConflictCode.DUPLICATE_ACTION:
        return `Cannot register "${formatted}": action already registered`;
      case ShortcutConflictCode.SEQUENCE_ON_ACTION:
        return `Cannot register "${formatted}": desired sequence conflicts with existing action at "${options.conflictPath}"`;
    }
  }
}

interface KeyboardShortcutContextType {
  registerShortcut: (shortcut: KeyboardShortcut) => () => void;
  openLegend: () => void;
  openLegendKeys: ReactNode;
}

const KeyboardShortcutContext = createContext<
  KeyboardShortcutContextType | undefined
>(undefined);

export function KeyboardShortcutProvider({
  children,
}: {
  children: ReactNode;
}) {
  const treeRootRef = useRef<ShortcutTreeLevel>({});
  const currentNodeRef = useRef<ShortcutTreeLevel>(treeRootRef.current);
  const shortcutsRef = useRef<Map<string, KeyboardShortcut>>(new Map());
  const sequenceTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  const [isLegendOpen, setIsLegendOpen] = useState(false);

  const openLegendShortcut: KeyboardShortcut = useMemo(
    () => ({
      type: "PRESS",
      stroke: {
        key: "/",
        modifiers: ["META"],
      },
      action: () => setIsLegendOpen(true),
      description: t`Open keyboard shortcuts`,
      group: ShortcutGroup.GENERAL,
    }),
    [setIsLegendOpen],
  );

  const handleKeyDown = useCallback((event: KeyboardEvent) => {
    if (isTypingInInput(event)) {
      return;
    }

    if (sequenceTimeoutRef.current) {
      clearTimeout(sequenceTimeoutRef.current);
      sequenceTimeoutRef.current = null;
    }

    const serializedKey = serializeEvent(event);
    const node = currentNodeRef.current[serializedKey];

    if (!node) {
      currentNodeRef.current = treeRootRef.current;
      return;
    }

    switch (node.type) {
      case "STEP":
        event.preventDefault();
        currentNodeRef.current = node.children;
        sequenceTimeoutRef.current = setTimeout(() => {
          currentNodeRef.current = treeRootRef.current;
        }, SEQUENCE_TIMEOUT_MS);
        return;
      case "ACTION":
        event.preventDefault();
        node.shortcut.action();
        currentNodeRef.current = treeRootRef.current;
        return;
      default:
        return;
    }
  }, []);

  const registerShortcut = useCallback(
    (shortcut: KeyboardShortcut): (() => void) => {
      const strokes =
        shortcut.type === "SEQUENCE" ? shortcut.strokes : [shortcut.stroke];

      const path = strokes.map(serializeKeyStroke);
      const pathKey = path.join(" â†’ ");

      path.reduce((currentLevel, key, i) => {
        const isLast = i === path.length - 1;
        const existingNode = currentLevel[key];

        if (env.NODE_ENV === "development" && existingNode) {
          const conflictPath = path.slice(0, i + 1).join(" â†’ ");
          validateNoConflict(existingNode, isLast, shortcut, conflictPath);
        }

        if (isLast) {
          currentLevel[key] = {
            type: "ACTION",
            shortcut,
          };
          return currentLevel;
        }

        if (existingNode?.type === "STEP") {
          return existingNode.children;
        }

        const newNode: ShortcutTreeStepNode = {
          type: "STEP",
          children: {},
        };
        currentLevel[key] = newNode;
        return newNode.children;
      }, treeRootRef.current);

      shortcutsRef.current.set(pathKey, shortcut);

      return () => {
        removePathAndPrune(treeRootRef.current, path);
        shortcutsRef.current.delete(pathKey);
      };
    },
    [],
  );

  useEventListener("keydown", handleKeyDown);

  // Register built-in shortcut to open legend
  useEffect(() => {
    const cleanup = registerShortcut(openLegendShortcut);
    return cleanup;
  }, [registerShortcut, openLegendShortcut]);

  // Cleanup timeout on unmount
  useEffect(() => {
    return () => {
      if (sequenceTimeoutRef.current) {
        clearTimeout(sequenceTimeoutRef.current);
      }
    };
  }, []);

  const shortcutsArray = Array.from(shortcutsRef.current.values());
  const groupedShortcuts = shortcutsArray.reduce<
    Partial<Record<ShortcutGroup, KeyboardShortcut[]>>
  >((acc, shortcut) => {
    const group = shortcut.group;
    acc[group] ??= [];
    acc[group].push(shortcut);
    return acc;
  }, {});

  const openLegend = useCallback(() => {
    setIsLegendOpen(true);
  }, []);

  const openLegendKeys = useMemo(
    () => <FormattedShortcut shortcut={openLegendShortcut} />,
    [openLegendShortcut],
  );

  return (
    <KeyboardShortcutContext.Provider
      value={{ registerShortcut, openLegend, openLegendKeys }}
    >
      {children}

      {/* Shortcut Legend */}
      <Dialog
        className="relative z-50"
        open={isLegendOpen}
        onClose={() => setIsLegendOpen(false)}
      >
        <DialogBackdrop
          transition
          className="data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in fixed inset-0 bg-light-50 bg-opacity-40 transition-opacity dark:bg-dark-50 dark:bg-opacity-40"
        />

        <div className="fixed inset-0 flex min-h-full w-screen items-center justify-center overflow-y-auto p-4">
          <DialogPanel
            transition
            className="relative w-full max-w-sm transform overflow-hidden rounded-lg border border-light-600 bg-white shadow-3xl-light dark:border-dark-600 dark:bg-dark-100 dark:shadow-3xl-dark"
          >
            <div className="flex items-center justify-between border-b border-light-300 px-6 py-4 dark:border-dark-300">
              <DialogTitle className="text-[14px] font-semibold text-neutral-900 dark:text-dark-1000">
                {t`Keyboard Shortcuts`}
              </DialogTitle>
              <button
                onClick={() => setIsLegendOpen(false)}
                className="rounded p-1 hover:bg-light-200 dark:hover:bg-dark-200"
              >
                <HiXMark className="h-5 w-5 text-neutral-700 dark:text-dark-700" />
              </button>
            </div>

            <div className="max-h-[60vh] overflow-y-auto p-6">
              {shortcutsArray.length === 0 ? (
                <p className="text-center text-sm text-neutral-600 dark:text-dark-600">
                  {t`No keyboard shortcuts registered.`}
                </p>
              ) : (
                <div className="space-y-6">
                  {Object.values(ShortcutGroup).map((group, idx) => {
                    const shortcuts = groupedShortcuts[group];
                    if (!shortcuts?.length) return null;
                    const groupInfo = getShortcutGroupInfo();
                    return (
                      <div key={`${group}-${idx}`}>
                        <h3 className="mb-3 text-xs font-semibold uppercase tracking-wide text-light-1000 dark:text-dark-1000">
                          {groupInfo[group].label}
                        </h3>
                        <div className="flex flex-col gap-y-2">
                          {shortcuts.map((shortcut) => (
                            <ShortcutListItem
                              key={shortcut.description}
                              shortcut={shortcut}
                            />
                          ))}
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </DialogPanel>
        </div>
      </Dialog>
    </KeyboardShortcutContext.Provider>
  );
}

/**
 * Hook to register a keyboard shortcut. Cleanup is handled automatically.
 * Returns both formatted keys and pre-built tooltip content.
 *
 * IMPORTANT: The shortcut object reference must be stable. If it changes
 * on every render, the shortcut will be continuously registered and unregistered.
 *
 * @example
 * ```tsx
 * const { keys, tooltipContent } = useKeyboardShortcut({
 *   type: "PRESS",
 *   stroke: { key: "k", modifiers: ["META"] },
 *   action: () => openCommandPalette(),
 *   description: "Open command palette",
 *   group: "GENERAL"
 * });
 *
 * // Use tooltip for Tooltip component
 * <Tooltip content={tooltipContent}>
 *   <button>Search</button>
 * </Tooltip>
 *
 * // Or use keys directly for custom formatting
 * <span>Press {keys} to search</span>
 * ```
 */
export function useKeyboardShortcuts(): KeyboardShortcutContextType {
  const context = useContext(KeyboardShortcutContext);

  if (!context) {
    throw new Error(
      "useKeyboardShortcuts must be used within KeyboardShortcutProvider",
    );
  }

  return context;
}

export function useKeyboardShortcut(shortcut: KeyboardShortcut): {
  keys: ReactNode;
  tooltipContent: ReactNode;
} {
  const context = useContext(KeyboardShortcutContext);

  if (!context) {
    throw new Error(
      "useKeyboardShortcut must be used within KeyboardShortcutProvider",
    );
  }

  const { registerShortcut } = context;

  useEffect(() => {
    const cleanup = registerShortcut(shortcut);
    return cleanup;
  }, [shortcut, registerShortcut]);

  const keys = <FormattedShortcut shortcut={shortcut} />;
  const tooltipContent = (
    <div className="flex flex-row items-center gap-2 text-[11px]">
      {shortcut.description} {keys}
    </div>
  );

  return { keys, tooltipContent };
}

function ShortcutListItem({ shortcut }: { shortcut: KeyboardShortcut }) {
  return (
    <div className="flex items-center justify-between gap-2">
      <span className="text-sm text-dark-50 dark:text-dark-900">
        {shortcut.description}
      </span>
      <FormattedShortcut shortcut={shortcut} />
    </div>
  );
}

function FormattedShortcut({ shortcut }: { shortcut: KeyboardShortcut }) {
  const kbdClassName =
    "inline-flex h-5 w-5 items-center justify-center rounded border border-light-400 bg-light-200 px-1.5 py-0.5 font-mono text-[8px] font-semibold text-center text-neutral-900 dark:border-dark-400 dark:bg-dark-200 dark:text-dark-950";

  const stringifyModifier = (modifier: ModifierKey): string => {
    const isMac =
      typeof navigator !== "undefined" && navigator.userAgent.includes("Mac");
    const isLinux =
      typeof navigator !== "undefined" && navigator.userAgent.includes("Linux");

    const info = ModifierKeyInfo[modifier];
    if (isMac) return info.macSymbol;
    if (isLinux) return info.linuxName;
    return info.winName;
  };

  const formatStroke = (stroke: KeyStroke): ReactNode[] => {
    const parts: ReactNode[] = [];
    const modifierStrings = stroke.modifiers
      ? stroke.modifiers.map(stringifyModifier)
      : [];

    modifierStrings.forEach((mod, index) => {
      parts.push(
        <kbd key={`mod-${index}-${mod}`} className={kbdClassName}>
          {mod}
        </kbd>,
      );
    });

    parts.push(
      <kbd key={`key-${stroke.key}`} className={kbdClassName}>
        {stroke.key.toUpperCase()}
      </kbd>,
    );

    return parts;
  };

  if (shortcut.type === "SEQUENCE") {
    const parts: ReactNode[] = [];
    shortcut.strokes.forEach((stroke, strokeIndex) => {
      const strokeParts = formatStroke(stroke);
      // Add stroke index to keys to ensure uniqueness across multiple strokes
      const keyedParts = strokeParts.map((part, partIndex) => {
        if (React.isValidElement(part)) {
          return React.cloneElement(part, {
            key: `stroke-${strokeIndex}-${part.key || partIndex}`,
          });
        }
        return part;
      });
      parts.push(...keyedParts);
    });
    return <span className="flex items-center gap-1 text-[11px]">{parts}</span>;
  }

  return (
    <span className="inline-flex flex-shrink-0 items-center gap-1 text-[11px]">
      {formatStroke(shortcut.stroke)}
    </span>
  );
}

/** Checks for conflicts given existing nodes and current path
 * Throws an error if conflict is found
 *
 */
function validateNoConflict(
  existingNode: ShortcutTreeNode,
  isLastKey: boolean,
  shortcut: KeyboardShortcut,
  conflictPath: string,
): void {
  if (isLastKey) {
    if (existingNode.type === "STEP") {
      throw new ShortcutConflictError({
        code: ShortcutConflictCode.ACTION_ON_SEQUENCE,
        shortcut,
        conflictPath,
      });
    } else {
      throw new ShortcutConflictError({
        code: ShortcutConflictCode.DUPLICATE_ACTION,
        shortcut,
        conflictPath,
        existingShortcut: existingNode.shortcut,
      });
    }
  } else if (existingNode.type === "ACTION") {
    throw new ShortcutConflictError({
      code: ShortcutConflictCode.SEQUENCE_ON_ACTION,
      shortcut,
      conflictPath,
      existingShortcut: existingNode.shortcut,
    });
  }
}

/**
 * Checks if the user is currently typing in an input field
 */
function isTypingInInput(event: KeyboardEvent): boolean {
  if (!event.target) return false;

  const target = event.target as HTMLElement;
  const tagName = target.tagName.toLowerCase();
  const isInput = tagName === "input" || tagName === "textarea";
  const isContentEditable = target.isContentEditable;

  return isInput || isContentEditable;
}

/**
 * Serializes a KeyStroke to a consistent string format
 * Returns lowercase string like "ctrl+shift+k" with alphabetically sorted modifiers
 */
function serializeKeyStroke(stroke: KeyStroke): string {
  const key = stroke.key.toLowerCase();
  if (!stroke.modifiers || stroke.modifiers.length === 0) return key;
  const sorted = [...stroke.modifiers].sort();
  return `${sorted.join("+")}+${key}`;
}

/**
 * Converts a keyboard event to a KeyStroke
 */
function eventToKeyStroke(event: KeyboardEvent): KeyStroke {
  const modifiers: ModifierKey[] = [];
  if (event.altKey) modifiers.push(ModifierKey.ALT);
  if (event.ctrlKey) modifiers.push(ModifierKey.CONTROL);
  if (event.metaKey) modifiers.push(ModifierKey.META);
  // Only include shift if the key is a letter (shift wasn't consumed to produce the character)
  if (event.shiftKey && /^[a-zA-Z]$/.test(event.key))
    modifiers.push(ModifierKey.SHIFT);
  return { key: event.key, modifiers };
}

/**
 * Serializes a keyboard event to a consistent string format
 */
function serializeEvent(event: KeyboardEvent): string {
  return serializeKeyStroke(eventToKeyStroke(event));
}

/**
 * Removes a path from the tree and prunes empty branches
 */
function removePathAndPrune(tree: ShortcutTreeLevel, path: string[]): void {
  const [first, ...rest] = path;
  if (!first) return;

  if (rest.length === 0) {
    delete tree[first];
    return;
  }

  const node = tree[first];
  if (!node || node.type !== "STEP") return;

  removePathAndPrune(node.children, rest);

  if (Object.keys(node.children).length === 0) {
    delete tree[first];
  }
}



================================================
FILE: apps/web/src/providers/lingui.tsx
================================================
import type { ReactNode } from "react";
import { I18nProvider } from "@lingui/react";
import { createContext, useContext, useEffect, useState } from "react";

import type { Locale } from "~/locales";
import { defaultLocale, locales } from "~/locales";
import { activateLocale, i18n, initializeI18n } from "~/utils/i18n";

interface LinguiContextType {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  availableLocales: Locale[];
}

const LinguiContext = createContext<LinguiContextType | undefined>(undefined);

export function useLinguiContext() {
  const context = useContext(LinguiContext);
  if (!context) {
    throw new Error("useLinguiContext must be used within a LinguiProvider");
  }
  return context;
}

interface LinguiProviderProps {
  children: ReactNode;
  initialLocale?: Locale;
}

function detectBrowserLocale(availableLocales: readonly string[]): Locale {
  if (typeof navigator === "undefined") {
    return defaultLocale;
  }

  const browserLanguages = navigator.languages || [navigator.language];

  for (const browserLang of browserLanguages) {
    const langCode = browserLang.split("-")[0];

    if (langCode && availableLocales.includes(langCode.toLowerCase())) {
      return langCode.toLowerCase() as Locale;
    }
  }

  return defaultLocale;
}

export function LinguiProviderWrapper({
  children,
  initialLocale = defaultLocale,
}: LinguiProviderProps) {
  const [locale, setLocale] = useState<Locale>(defaultLocale);
  const [isHydrated, setIsHydrated] = useState(false);

  initializeI18n();

  useEffect(() => {
    const savedLocale = localStorage.getItem("locale") as Locale;

    if (savedLocale && locales.includes(savedLocale)) {
      setLocale(savedLocale);
    } else {
      const detectedLocale = detectBrowserLocale(locales);
      setLocale(detectedLocale);
    }
    setIsHydrated(true);
  }, [initialLocale]);

  useEffect(() => {
    if (isHydrated && locale !== defaultLocale) {
      activateLocale(locale).then(() => {
        localStorage.setItem("locale", locale);
      });
    } else if (isHydrated) {
      localStorage.setItem("locale", locale);
    }
  }, [locale, isHydrated]);

  return (
    <LinguiContext.Provider
      value={{ locale, setLocale, availableLocales: [...locales] }}
    >
      <I18nProvider i18n={i18n} key={locale}>
        {children}
      </I18nProvider>
    </LinguiContext.Provider>
  );
}



================================================
FILE: apps/web/src/providers/modal.tsx
================================================
import { createContext, useCallback, useContext, useState } from "react";

interface ModalState {
  contentType: string;
  entityId?: string;
  entityLabel?: string;
  closeOnClickOutside?: boolean;
}

interface Props {
  children: React.ReactNode;
}

interface ModalContextType {
  isOpen: boolean;
  openModal: (
    contentType: string,
    entityId?: string,
    entityLabel?: string,
    closeOnClickOutside?: boolean,
  ) => void;
  closeModal: () => void;
  closeModals: (count: number) => void;
  clearAllModals: () => void;
  modalContentType: string;
  entityId: string;
  entityLabel: string;
  closeOnClickOutside: boolean;
  modalStates: Record<string, any>;
  setModalState: (modalType: string, state: any) => void;
  getModalState: (modalType: string) => any;
  clearModalState: (modalType: string) => void;
  clearAllModalStates: () => void;
}

const ModalContext = createContext<ModalContextType | undefined>(undefined);

export const ModalProvider: React.FC<Props> = ({ children }) => {
  const [modalStack, setModalStack] = useState<ModalState[]>([]);
  const [modalStates, setModalStates] = useState<Record<string, any>>({});

  const isOpen = modalStack.length > 0;
  const currentModal = modalStack[modalStack.length - 1];
  const modalContentType = currentModal?.contentType || "";
  const entityId = currentModal?.entityId || "";
  const entityLabel = currentModal?.entityLabel || "";
  const closeOnClickOutside = currentModal?.closeOnClickOutside ?? true;

  const openModal = useCallback(
    (
      contentType: string,
      entityId?: string,
      entityLabel?: string,
      closeOnClickOutside?: boolean,
    ) => {
      const newModal: ModalState = {
        contentType,
        entityId,
        entityLabel,
        closeOnClickOutside,
      };
      setModalStack((prev) => {
        const last = prev[prev.length - 1];
        if (
          last &&
          last.contentType === newModal.contentType &&
          last.entityId === newModal.entityId &&
          last.entityLabel === newModal.entityLabel
        ) {
          return prev; // prevent stacking duplicate modal on top
        }
        return [...prev, newModal];
      });
    },
    [],
  );

  const closeModal = useCallback(() => {
    setModalStack((prev) => {
      if (prev.length <= 1) {
        return [];
      }
      return prev.slice(0, -1);
    });
  }, []);

  const closeModals = useCallback((count: number) => {
    setModalStack((prev) => {
      const newLength = Math.max(0, prev.length - count);
      return prev.slice(0, newLength);
    });
  }, []);

  const clearAllModals = useCallback(() => {
    setModalStack([]);
  }, []);

  const setModalState = useCallback((modalType: string, state: any) => {
    setModalStates((prev) => ({
      ...prev,
      [modalType]: state,
    }));
  }, []);

  const getModalState = useCallback(
    (modalType: string) => {
      return modalStates[modalType];
    },
    [modalStates],
  );

  const clearModalState = useCallback((modalType: string) => {
    setModalStates((prev) => {
      const newStates = { ...prev };
      delete newStates[modalType];
      return newStates;
    });
  }, []);

  const clearAllModalStates = useCallback(() => {
    setModalStates({});
  }, []);

  return (
    <ModalContext.Provider
      value={{
        isOpen,
        openModal,
        closeModal,
        closeModals,
        clearAllModals,
        modalContentType,
        entityId,
        entityLabel,
        closeOnClickOutside,
        modalStates,
        setModalState,
        getModalState,
        clearModalState,
        clearAllModalStates,
      }}
    >
      {children}
    </ModalContext.Provider>
  );
};

export const useModal = () => {
  const context = useContext(ModalContext);
  if (context === undefined) {
    throw new Error("useModal must be used within a ModalProvider");
  }
  return context;
};



================================================
FILE: apps/web/src/providers/popup.tsx
================================================
import { createContext, useContext, useState } from "react";

interface PopupContextType {
  isOpen: boolean;
  showPopup: (params: {
    header: string;
    message: string;
    icon: string;
  }) => void;
  hidePopup: () => void;
  popupHeader: string;
  popupMessage: string;
  popupIcon: string;
}

interface Props {
  children: React.ReactNode;
}

const PopupContext = createContext<PopupContextType | undefined>(undefined);

export const PopupProvider: React.FC<Props> = ({ children }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [popupHeader, setPopupHeader] = useState("");
  const [popupMessage, setPopupMessage] = useState("");
  const [popupIcon, setPopupIcon] = useState("");

  const showPopup = ({
    header,
    message,
    icon,
  }: {
    header: string;
    message: string;
    icon: string;
  }) => {
    setIsOpen(true);
    setPopupHeader(header);
    setPopupMessage(message);
    setPopupIcon(icon);
  };

  const hidePopup = () => {
    setIsOpen(false);
  };

  return (
    <PopupContext.Provider
      value={{
        isOpen,
        showPopup,
        hidePopup,
        popupHeader,
        popupMessage,
        popupIcon,
      }}
    >
      {children}
    </PopupContext.Provider>
  );
};

export const usePopup = () => {
  const context = useContext(PopupContext);
  if (context === undefined) {
    throw new Error("usePopup must be used within a PopupProvider");
  }
  return context;
};



================================================
FILE: apps/web/src/providers/theme.tsx
================================================
import React, {
  createContext,
  useContext,
  useEffect,
  useState,
  type ReactNode,
} from "react";

interface ThemeContextProps {
  themePreference: "light" | "dark" | "system";
  activeTheme: "light" | "dark";
  switchTheme: (theme: "light" | "dark" | "system") => void;
}

const ThemeContext = createContext<ThemeContextProps | undefined>(undefined);

export const ThemeProvider: React.FC<{ children: ReactNode }> = ({
  children,
}) => {
  const [themePreference, setThemePreference] = useState<
    "light" | "dark" | "system"
  >("system");
  const [activeTheme, setActiveTheme] = useState<"light" | "dark">("light");

  const switchTheme = (theme: "light" | "dark" | "system") => {
    if (theme === "system") {
      localStorage.removeItem("theme");
      const isDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      setActiveTheme(isDark ? "dark" : "light");
      document.documentElement.classList.toggle("dark", isDark);
    } else {
      const isDark = theme === "dark";
      document.documentElement.classList.toggle("dark", isDark);
      localStorage.theme = theme;
      setActiveTheme(isDark ? "dark" : "light");
    }
    setThemePreference(theme);
  };

  useEffect(() => {
    if (!("theme" in localStorage)) {
      const isDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      document.documentElement.classList.toggle("dark", isDark);
      setActiveTheme(isDark ? "dark" : "light");
      setThemePreference("system");
    } else {
      const isDark = localStorage.theme === "dark";
      document.documentElement.classList.toggle("dark", isDark);
      setActiveTheme(isDark ? "dark" : "light");
      setThemePreference(localStorage.theme as "light" | "dark");
    }
  }, []);

  return (
    <ThemeContext.Provider
      value={{ switchTheme, themePreference, activeTheme }}
    >
      {themePreference.length ? children : null}
    </ThemeContext.Provider>
  );
};

export const useTheme = (): ThemeContextProps => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error("useTheme must be used within a ThemeProvider");
  }
  return context;
};



================================================
FILE: apps/web/src/providers/workspace.tsx
================================================
import type { ReactNode } from "react";
import { useRouter, useSearchParams } from "next/navigation";
import React, { createContext, useContext, useEffect, useState } from "react";

import { api } from "~/utils/api";

interface WorkspaceContextProps {
  workspace: Workspace;
  isLoading: boolean;
  hasLoaded: boolean;
  switchWorkspace: (_workspace: Workspace) => void;
  availableWorkspaces: Workspace[];
}

interface Workspace {
  name: string;
  description: string | null | undefined;
  publicId: string;
  slug: string | undefined;
  plan: "free" | "pro" | "enterprise" | undefined;
  role: "admin" | "member" | "guest";
}

const initialWorkspace: Workspace = {
  name: "",
  description: null,
  publicId: "",
  slug: "",
  plan: "free",
  role: "member",
};

const initialAvailableWorkspaces: Workspace[] = [];

export const WorkspaceContext = createContext<WorkspaceContextProps | undefined>(
  undefined,
);

export const WorkspaceProvider: React.FC<{ children: ReactNode }> = ({
  children,
}) => {
  const router = useRouter();
  const [workspace, setWorkspace] = useState<Workspace>(initialWorkspace);
  const [availableWorkspaces, setAvailableWorkspaces] = useState<Workspace[]>(
    initialAvailableWorkspaces,
  );
  const [hasLoaded, setHasLoaded] = useState(false);

  const workspacePublicId = useSearchParams().get("workspacePublicId");

  const { data, isLoading } = api.workspace.all.useQuery();
  const utils = api.useUtils();

  const switchWorkspace = (_workspace: Workspace) => {
    localStorage.setItem("workspacePublicId", _workspace.publicId);

    setWorkspace(_workspace);

    // Refetch workspace data to ensure availableWorkspaces is up to date
    void utils.workspace.all.refetch();

    router.push(`/boards`);
  };

  useEffect(() => {
    if (!data?.length) {
      if (!isLoading) setHasLoaded(true);
      return;
    }

    const storedWorkspaceId: string | null =
      workspacePublicId ?? localStorage.getItem("workspacePublicId");

    if (data.length) {
      const workspaces = data.map(({ workspace, role }) => ({
        role,
        publicId: workspace.publicId,
        name: workspace.name,
        slug: workspace.slug,
        description: workspace.description,
        plan: workspace.plan,
        hasLoaded: true,
      })) as Workspace[];

      if (workspaces.length) setAvailableWorkspaces(workspaces);
    }

    if (storedWorkspaceId !== null) {
      const newData = data;
      const selectedWorkspace = newData.find(
        ({ workspace }) => workspace.publicId === storedWorkspaceId,
      );

      if (!selectedWorkspace?.workspace) return;

      setWorkspace({
        publicId: selectedWorkspace.workspace.publicId,
        name: selectedWorkspace.workspace.name,
        slug: selectedWorkspace.workspace.slug,
        plan: selectedWorkspace.workspace.plan,
        description: selectedWorkspace.workspace.description,
        role: selectedWorkspace.role,
      });

      if (workspacePublicId) {
        router.push(`/boards`);
        localStorage.setItem("workspacePublicId", workspacePublicId);
      }
    } else {
      const primaryWorkspace = data[0]?.workspace;
      const primaryWorkspaceRole = data[0]?.role;

      if (!primaryWorkspace || !primaryWorkspaceRole) return;
      localStorage.setItem("workspacePublicId", primaryWorkspace.publicId);
      setWorkspace({
        publicId: primaryWorkspace.publicId,
        name: primaryWorkspace.name,
        slug: primaryWorkspace.slug,
        plan: primaryWorkspace.plan,
        description: primaryWorkspace.description,
        role: primaryWorkspaceRole,
      });
    }
  }, [data, isLoading, workspacePublicId, router]);

  return (
    <WorkspaceContext.Provider
      value={{
        workspace,
        isLoading,
        hasLoaded,
        availableWorkspaces,
        switchWorkspace,
      }}
    >
      {children}
    </WorkspaceContext.Provider>
  );
};

export const useWorkspace = (): WorkspaceContextProps => {
  const context = useContext(WorkspaceContext);
  if (!context) {
    throw new Error("useWorkspace must be used within a WorkspaceProvider");
  }
  return context;
};



================================================
FILE: apps/web/src/styles/globals.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

[contenteditable="true"]:empty:before {
  content: attr(placeholder);
  display: block;
  color: #707070;
  font-size: 0.8rem;
}

.gradient-border::before {
  background: conic-gradient(
    from 0deg,
    transparent 0deg,
    transparent 45deg,
    rgba(244, 114, 182, 0.4) 85deg,
    rgba(192, 132, 252, 0.4) 95deg,
    transparent 110deg,
    transparent 360deg
  );
  content: "";
  position: absolute;
  inset: -50%;
  width: 200%;
  height: 200%;
}

@layer utilities {
  @supports not (overflow-wrap: anywhere) {
    .break-anywhere {
      word-break: break-word;
    }
  }

  @supports (overflow-wrap: anywhere) {
    .break-anywhere {
      overflow-wrap: anywhere;
    }
  }
}

/* Tippy.js tooltip theme */
.tippy-box[data-theme~="tooltip"] {
  @apply rounded-md border border-light-600 bg-white px-2 py-1 text-sm text-neutral-900 shadow-lg dark:border-dark-600 dark:bg-dark-100 dark:text-dark-1000;
}

.tippy-box[data-theme~="tooltip"] > .tippy-arrow::before {
  @apply border-t-light-600 dark:border-t-dark-600;
}

.tippy-box[data-theme~="tooltip"][data-placement^="bottom"]
  > .tippy-arrow::before {
  @apply border-b-light-600 dark:border-b-dark-600;
}



================================================
FILE: apps/web/src/types/contenteditable.d.ts
================================================
declare module "react-contenteditable" {
  import React from "react";

  type ChangeEventHandler<T = Element> = (event: React.ChangeEvent<T>) => void;
  type KeyUpHandler<T = Element> = (event: React.KeyboardEvent<T>) => void;
  type KeyDownHandler<T = Element> = (event: React.KeyboardEvent<T>) => void;

  interface ContentEditableProps extends React.HTMLAttributes<HTMLDivElement> {
    html: string;
    onChange?: ChangeEventHandler<HTMLTextAreaElement | HTMLInputElement>;
    onBlur?: () => void;
    onKeyUp?: KeyUpHandler<HTMLTextAreaElement | HTMLInputElement>;
    onKeyDown?: KeyDownHandler<HTMLTextAreaElement | HTMLInputElement>;
    disabled?: boolean;
    tagName?: string;
    className?: string;
    style?: React.CSSProperties;
    innerRef?:
      | React.RefObject<HTMLElement>
      | ((instance: HTMLElement | null) => void);
    placeholder?: string;
  }

  class ContentEditable extends React.Component<ContentEditableProps> {}

  interface ContentEditableElement extends HTMLElement {
    value: string;
  }

  export default ContentEditable;
}



================================================
FILE: apps/web/src/utils/api.ts
================================================
import type { TRPCLink } from "@trpc/client";
import type { inferRouterInputs, inferRouterOutputs } from "@trpc/server";
import { QueryClient } from "@tanstack/react-query";
import { httpBatchLink, loggerLink } from "@trpc/client";
import { createTRPCNext } from "@trpc/next";
import { observable } from "@trpc/server/observable";
import superjson from "superjson";

import type { AppRouter } from "@kan/api/root";

/**
 * This is the client-side entrypoint for your tRPC API. It is used to create the `api` object which
 * contains the Next.js App-wrapper, as well as your type-safe React Query hooks.
 *
 * We also create a few inference helpers for input and output types.
 */

const authLink: TRPCLink<AppRouter> = () => {
  return ({ next, op }) => {
    return observable((observer) => {
      const unsubscribe = next(op).subscribe({
        next(value) {
          observer.next(value);
        },
        error(err) {
          if (typeof window !== "undefined" && err.message === "UNAUTHORIZED") {
            window.location.href = "/login";
          }
          observer.error(err);
        },
        complete() {
          observer.complete();
        },
      });
      return unsubscribe;
    });
  };
};

const getBaseUrl = () => {
  if (typeof window !== "undefined") return ""; // browser should use relative url
  if (process.env.VERCEL_URL) return `https://${process.env.VERCEL_URL}`; // SSR should use vercel url
  return `http://localhost:${process.env.PORT ?? 3000}`; // dev SSR should use localhost
};

const queryClient = new QueryClient();

// @ts-expect-error
export const api = createTRPCNext<AppRouter>({
  config() {
    return {
      links: [
        loggerLink({
          enabled: (opts) =>
            process.env.NODE_ENV === "development" ||
            (opts.direction === "down" && opts.result instanceof Error),
        }),
        authLink,
        httpBatchLink({
          url: `${getBaseUrl()}/api/trpc`,
          transformer: superjson,
        }),
      ],
      queryClient: queryClient,
    };
  },
  ssr: false,
});

/**
 * Inference helper for inputs.
 *
 * @example type HelloInput = RouterInputs['example']['hello']
 */
export type RouterInputs = inferRouterInputs<AppRouter>;

/**
 * Inference helper for outputs.
 *
 * @example type HelloOutput = RouterOutputs['example']['hello']
 */
export type RouterOutputs = inferRouterOutputs<AppRouter>;



================================================
FILE: apps/web/src/utils/cardInvalidation.ts
================================================
import type { api } from "~/utils/api";

/**
 * Invalidates all card-related queries for a given card.
 * Use this after any mutation that affects card data or activities.
 */
export async function invalidateCard(
  utils: ReturnType<typeof api.useUtils>,
  cardPublicId: string,
) {
  if (!cardPublicId || cardPublicId.length < 12) return;
  
  await Promise.all([
    utils.card.byId.invalidate({ cardPublicId }),
    utils.card.getActivities.invalidate({ cardPublicId }),
  ]);
}




================================================
FILE: apps/web/src/utils/helpers.test.ts
================================================
import { describe, it, expect, vi, beforeEach } from "vitest";

vi.mock("next-runtime-env", () => ({
  env: vi.fn(),
}));

import { env } from "next-runtime-env";
import { getAvatarUrl } from "./helpers";

const mockEnv = env as ReturnType<typeof vi.fn>;

describe("getAvatarUrl", () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it("returns empty string for null input", () => {
    expect(getAvatarUrl(null)).toBe("");
  });

  it("returns empty string for empty string input", () => {
    expect(getAvatarUrl("")).toBe("");
  });

  it("returns URL unchanged if already absolute http", () => {
    expect(getAvatarUrl("http://example.com/avatar.jpg")).toBe(
      "http://example.com/avatar.jpg",
    );
  });

  it("returns URL unchanged if already absolute https", () => {
    expect(getAvatarUrl("https://example.com/avatar.jpg")).toBe(
      "https://example.com/avatar.jpg",
    );
  });

  describe("path-style URLs (MinIO/LocalStack)", () => {
    it("constructs path-style URL when STORAGE_DOMAIN is not set", () => {
      mockEnv.mockImplementation((key: string) => {
        const vars: Record<string, string> = {
          NEXT_PUBLIC_STORAGE_URL: "http://s3.localtest.me:9000",
          NEXT_PUBLIC_AVATAR_BUCKET_NAME: "kan",
        };
        return vars[key];
      });

      expect(getAvatarUrl("user123/avatar.jpg")).toBe(
        "http://s3.localtest.me:9000/kan/user123/avatar.jpg",
      );
    });
  });

  describe("virtual-hosted URLs (Tigris/AWS S3)", () => {
    it("constructs virtual-hosted URL when USE_VIRTUAL_HOSTED_URLS is true and STORAGE_DOMAIN is set", () => {
      mockEnv.mockImplementation((key: string) => {
        const vars: Record<string, string> = {
          NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS: "true",
          NEXT_PUBLIC_STORAGE_DOMAIN: "fly.storage.tigris.dev",
          NEXT_PUBLIC_AVATAR_BUCKET_NAME: "kan-avatars",
          NEXT_PUBLIC_STORAGE_URL: "https://fly.storage.tigris.dev",
        };
        return vars[key];
      });

      expect(getAvatarUrl("user123/avatar.jpg")).toBe(
        "https://kan-avatars.fly.storage.tigris.dev/user123/avatar.jpg",
      );
    });

    it("uses path-style URL when USE_VIRTUAL_HOSTED_URLS is false even if STORAGE_DOMAIN is set", () => {
      mockEnv.mockImplementation((key: string) => {
        const vars: Record<string, string> = {
          NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS: "false",
          NEXT_PUBLIC_STORAGE_DOMAIN: "fly.storage.tigris.dev",
          NEXT_PUBLIC_AVATAR_BUCKET_NAME: "kan-avatars",
          NEXT_PUBLIC_STORAGE_URL: "https://fly.storage.tigris.dev",
        };
        return vars[key];
      });

      expect(getAvatarUrl("user123/avatar.jpg")).toBe(
        "https://fly.storage.tigris.dev/kan-avatars/user123/avatar.jpg",
      );
    });

    it("uses path-style URL when USE_VIRTUAL_HOSTED_URLS is not set even if STORAGE_DOMAIN is set", () => {
      mockEnv.mockImplementation((key: string) => {
        const vars: Record<string, string> = {
          NEXT_PUBLIC_STORAGE_DOMAIN: "fly.storage.tigris.dev",
          NEXT_PUBLIC_AVATAR_BUCKET_NAME: "kan-avatars",
          NEXT_PUBLIC_STORAGE_URL: "https://fly.storage.tigris.dev",
        };
        return vars[key];
      });

      expect(getAvatarUrl("user123/avatar.jpg")).toBe(
        "https://fly.storage.tigris.dev/kan-avatars/user123/avatar.jpg",
      );
    });
  });
});



================================================
FILE: apps/web/src/utils/helpers.ts
================================================
export const formatToArray = (
  value: string | string[] | undefined,
): string[] => {
  if (Array.isArray(value)) {
    return value.filter((item) => item !== undefined);
  }
  return value ? [value] : [];
};

export const inferInitialsFromEmail = (email: string) => {
  const localPart = email.split("@")[0];
  if (!localPart) return "";
  const separators = /[._-]/;
  const parts = localPart.split(separators);

  if (parts.length > 1) {
    return (
      (parts[0]?.[0] ?? "") + (parts[parts.length - 1]?.[0] ?? "")
    ).toUpperCase();
  } else {
    return localPart.slice(0, 2).toUpperCase();
  }
};

export const getInitialsFromName = (name: string) => {
  return name
    .split(" ")
    .map((namePart) => namePart.charAt(0).toUpperCase())
    .join("");
};

export const formatMemberDisplayName = (
  name: string | null,
  email: string | null,
) => {
  if (name) return name;
  if (!email) return "";

  const localPart = email.split("@")[0];

  if (!localPart) return "";

  return localPart.replace(/[_-]/g, ".");
};

export const getAvatarUrl = (imageOrKey: string | null) => {
  if (!imageOrKey) return "";

  if (imageOrKey.startsWith("http://") || imageOrKey.startsWith("https://")) {
    return imageOrKey;
  }

  return "";
};



================================================
FILE: apps/web/src/utils/i18n.ts
================================================
import { i18n } from "@lingui/core";

import type { Locale } from "~/locales";
import { defaultLocale } from "~/locales";
import { messages as enMessages } from "~/locales/en/messages";

const loadMessages = async (locale: Locale) => {
  switch (locale) {
    case "en":
      return enMessages;
    case "fr":
      return (await import("~/locales/fr/messages")).messages;
    case "de":
      return (await import("~/locales/de/messages")).messages;
    case "es":
      return (await import("~/locales/es/messages")).messages;
    case "it":
      return (await import("~/locales/it/messages")).messages;
    case "nl":
      return (await import("~/locales/nl/messages")).messages;
    case "ru":
      return (await import("~/locales/ru/messages")).messages;
    case "pl":
      return (await import("~/locales/pl/messages")).messages;
    case "pt-BR":
      return (await import("~/locales/pt-BR/messages")).messages;
    default:
      return enMessages;
  }
};

let isInitialized = false;
const loadedLocales = new Set<string>();

export function initializeI18n(locale: Locale = defaultLocale) {
  if (!isInitialized) {
    i18n.load(defaultLocale, enMessages);
    i18n.activate(defaultLocale);
    loadedLocales.add(defaultLocale);
    isInitialized = true;
  }

  return i18n;
}

export async function activateLocale(locale: Locale) {
  if (!loadedLocales.has(locale)) {
    const messages = await loadMessages(locale);
    i18n.load(locale, messages);
    loadedLocales.add(locale);
  }

  i18n.activate(locale);
  return i18n;
}

initializeI18n();

export { i18n };



================================================
FILE: apps/web/src/views/auth/login/index.tsx
================================================
import Link from "next/link";
import { useRouter, useSearchParams } from "next/navigation";
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";
import { env } from "next-runtime-env";
import { useState } from "react";

import { authClient } from "@kan/auth/client";

import { Auth } from "~/components/AuthForm";
import { PageHead } from "~/components/PageHead";
import PatternedBackground from "~/components/PatternedBackground";

export default function LoginPage() {
  const router = useRouter();
  const isSignUpDisabled = env("NEXT_PUBLIC_DISABLE_SIGN_UP") === "true";
  const [isMagicLinkSent, setIsMagicLinkSent] = useState<boolean>(false);
  const [magicLinkRecipient, setMagicLinkRecipient] = useState<string>("");

  const redirect = useSearchParams().get("next");

  const handleMagicLinkSent = (value: boolean, recipient: string) => {
    setIsMagicLinkSent(value);
    setMagicLinkRecipient(recipient);
  };

  const { data } = authClient.useSession();

  if (data?.user.id) router.push("/boards");

  return (
    <>
      <PageHead title={t`Login | kan.bn`} />
      <main className="h-screen bg-light-100 pt-20 dark:bg-dark-50 sm:pt-0">
        <div className="justify-top flex h-full flex-col items-center px-4 sm:justify-center">
          <div className="z-10 flex w-full flex-col items-center">
            <Link href="/">
              <h1 className="mb-6 text-lg font-bold tracking-tight text-light-1000 dark:text-dark-1000">
                kan.bn
              </h1>
            </Link>
            <p className="mb-10 text-3xl font-bold tracking-tight text-light-1000 dark:text-dark-1000">
              {isMagicLinkSent ? t`Check your inbox` : t`Welcome back`}
            </p>
            {isMagicLinkSent ? (
              <div className="sm:mx-auto sm:w-full sm:max-w-sm">
                <p className="text-md mt-2 text-center text-light-1000 dark:text-dark-1000">
                  <Trans>
                    Click on the link we've sent to {magicLinkRecipient} to sign
                    in.
                  </Trans>
                </p>
              </div>
            ) : (
              <div className="w-full rounded-lg border border-light-500 bg-light-300 px-4 py-10 dark:border-dark-400 dark:bg-dark-200 sm:max-w-md lg:px-10">
                <div className="sm:mx-auto sm:w-full sm:max-w-sm">
                  <Auth setIsMagicLinkSent={handleMagicLinkSent} />
                </div>
              </div>
            )}
            {!isSignUpDisabled && (
              <p className="mt-4 text-sm text-light-1000 dark:text-dark-1000">
                <Trans>
                  Don't have an account?{" "}
                  <span className="underline">
                    <Link
                      href={redirect ? `/signup?next=${redirect}` : "/signup"}
                    >
                      Sign up
                    </Link>
                  </span>
                </Trans>
              </p>
            )}
          </div>
          <PatternedBackground />
        </div>
      </main>
    </>
  );
}



================================================
FILE: apps/web/src/views/auth/signup/index.tsx
================================================
import Link from "next/link";
import { useRouter, useSearchParams } from "next/navigation";
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";
import { env } from "next-runtime-env";
import { useState } from "react";

import { authClient } from "@kan/auth/client";

import { Auth } from "~/components/AuthForm";
import { PageHead } from "~/components/PageHead";
import PatternedBackground from "~/components/PatternedBackground";

export default function SignUpPage() {
  const router = useRouter();
  const isSignUpDisabled = env("NEXT_PUBLIC_DISABLE_SIGN_UP") === "true";
  const [isMagicLinkSent, setIsMagicLinkSent] = useState<boolean>(false);
  const [magicLinkRecipient, setMagicLinkRecipient] = useState<string>("");

  const redirect = useSearchParams().get("next");

  const { data } = authClient.useSession();

  if (data?.user.id) router.push("/boards");

  const handleMagicLinkSent = (value: boolean, recipient: string) => {
    setIsMagicLinkSent(value);
    setMagicLinkRecipient(recipient);
  };

  if (isSignUpDisabled) {
    return (
      <>
        <PageHead title={t`Sign up | kan.bn`} />
        <main className="h-screen bg-light-100 pt-20 dark:bg-dark-50 sm:pt-0">
          <div className="justify-top flex h-full flex-col items-center px-4 sm:justify-center">
            <div className="z-10 flex w-full flex-col items-center">
              <Link href="/">
                <h1 className="mb-6 text-lg font-bold tracking-tight text-light-1000 dark:text-dark-1000">
                  kan.bn
                </h1>
              </Link>
              <p className="mb-10 text-3xl font-bold tracking-tight text-light-1000 dark:text-dark-1000">
                {t`Sign up disabled`}
              </p>
              <p className="text-md text-center text-light-1000 dark:text-dark-1000">
                {t`Sign up is currently disabled. Please try again later.`}
              </p>
            </div>
            <PatternedBackground />
          </div>
        </main>
      </>
    );
  }

  return (
    <>
      <PageHead title={t`Sign up | kan.bn`} />
      <main className="h-screen bg-light-100 pt-20 dark:bg-dark-50 sm:pt-0">
        <div className="justify-top flex h-full flex-col items-center px-4 sm:justify-center">
          <div className="z-10 flex w-full flex-col items-center">
            <Link href="/">
              <h1 className="mb-6 text-lg font-bold tracking-tight text-light-1000 dark:text-dark-1000">
                kan.bn
              </h1>
            </Link>
            <p className="mb-10 text-3xl font-bold tracking-tight text-light-1000 dark:text-dark-1000">
              {isMagicLinkSent ? t`Check your inbox` : t`Get started`}
            </p>
            {isMagicLinkSent ? (
              <div className="sm:mx-auto sm:w-full sm:max-w-sm">
                <p className="text-md mt-2 text-center text-light-1000 dark:text-dark-1000">
                  <Trans>
                    Click on the link we've sent to {magicLinkRecipient} to sign
                    in.
                  </Trans>
                </p>
              </div>
            ) : (
              <div className="w-full rounded-lg border border-light-500 bg-light-300 px-4 py-10 dark:border-dark-400 dark:bg-dark-200 sm:max-w-md lg:px-10">
                <div className="sm:mx-auto sm:w-full sm:max-w-sm">
                  <Auth setIsMagicLinkSent={handleMagicLinkSent} isSignUp />
                </div>
              </div>
            )}
            <p className="mt-4 text-sm text-light-1000 dark:text-dark-1000">
              <Trans>
                Already have an account?{" "}
                <span className="underline">
                  <Link href={redirect ? `/login?next=${redirect}` : "/login"}>
                    Sign in
                  </Link>
                </span>
              </Trans>
            </p>
          </div>
          <PatternedBackground />
        </div>
      </main>
    </>
  );
}



================================================
FILE: apps/web/src/views/board/index.tsx
================================================
import type { DropResult } from "react-beautiful-dnd";
import Link from "next/link";
import { useParams } from "next/navigation";
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { keepPreviousData } from "@tanstack/react-query";
import { useEffect, useState } from "react";
import { DragDropContext, Draggable } from "react-beautiful-dnd";
import { useForm } from "react-hook-form";
import {
  HiOutlinePlusSmall,
  HiOutlineRectangleStack,
  HiOutlineSquare3Stack3D,
} from "react-icons/hi2";

import type { UpdateBoardInput } from "@kan/api/types";

import Button from "~/components/Button";
import { DeleteLabelConfirmation } from "~/components/DeleteLabelConfirmation";
import { LabelForm } from "~/components/LabelForm";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import PatternedBackground from "~/components/PatternedBackground";
import { StrictModeDroppable as Droppable } from "~/components/StrictModeDroppable";
import { Tooltip } from "~/components/Tooltip";
import { EditYouTubeModal } from "~/components/YouTubeEmbed/EditYouTubeModal";
import { useDragToScroll } from "~/hooks/useDragToScroll";
import { usePermissions } from "~/hooks/usePermissions";
import { useKeyboardShortcut } from "~/providers/keyboard-shortcuts";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";
import { formatToArray } from "~/utils/helpers";
import BoardDropdown from "./components/BoardDropdown";
import Card from "./components/Card";
import { DeleteBoardConfirmation } from "./components/DeleteBoardConfirmation";
import { DeleteListConfirmation } from "./components/DeleteListConfirmation";
import Filters from "./components/Filters";
import List from "./components/List";
import { NewCardForm } from "./components/NewCardForm";
import { NewListForm } from "./components/NewListForm";
import { NewTemplateForm } from "./components/NewTemplateForm";
import UpdateBoardSlugButton from "./components/UpdateBoardSlugButton";
import { UpdateBoardSlugForm } from "./components/UpdateBoardSlugForm";
import VisibilityButton from "./components/VisibilityButton";

type PublicListId = string;

export default function BoardPage({ isTemplate }: { isTemplate?: boolean }) {
  const params = useParams() as { boardId: string | string[] } | null;
  const router = useRouter();
  const utils = api.useUtils();
  const { showPopup } = usePopup();
  const { workspace } = useWorkspace();
  const { openModal, modalContentType, entityId, isOpen } = useModal();
  const [selectedPublicListId, setSelectedPublicListId] =
    useState<PublicListId>("");
  const [isInitialLoading, setIsInitialLoading] = useState(true);

  const { ref: scrollRef, onMouseDown } = useDragToScroll({
    enabled: true,
    direction: "horizontal",
  });

  const { canCreateList, canEditList, canEditCard, canEditBoard } =
    usePermissions();

  const { tooltipContent: createListShortcutTooltipContent } =
    useKeyboardShortcut({
      type: "PRESS",
      stroke: { key: "C" },
      action: () => boardId && canCreateList && openNewListForm(boardId),
      description: t`Create new list`,
      group: "ACTIONS",
    });

  const boardId = params?.boardId
    ? Array.isArray(params.boardId)
      ? params.boardId[0]
      : params.boardId
    : null;

  const updateBoard = api.board.update.useMutation();

  const { register, handleSubmit, setValue } = useForm<UpdateBoardInput>({
    values: {
      boardPublicId: boardId ?? "",
      name: "",
    },
  });

  const onSubmit = (values: UpdateBoardInput) => {
    updateBoard.mutate({
      boardPublicId: values.boardPublicId,
      name: values.name,
    });
  };

  const semanticFilters = formatToArray(router.query.dueDate) as (
    | "overdue"
    | "today"
    | "tomorrow"
    | "next-week"
    | "next-month"
    | "no-due-date"
  )[];

  const boardType: "regular" | "template" = isTemplate ? "template" : "regular";

  const queryParams = {
    boardPublicId: boardId ?? "",
    members: formatToArray(router.query.members),
    labels: formatToArray(router.query.labels),
    lists: formatToArray(router.query.lists),
    ...(semanticFilters.length > 0 && {
      dueDateFilters: semanticFilters,
    }),
    type: boardType,
  };

  const {
    data: boardData,
    isSuccess,
    isLoading: isQueryLoading,
  } = api.board.byId.useQuery(queryParams, {
    enabled: !!boardId,
    placeholderData: keepPreviousData,
  });

  const refetchBoard = async () => {
    if (boardId) await utils.board.byId.refetch({ boardPublicId: boardId });
  };

  useEffect(() => {
    if (boardId) {
      setIsInitialLoading(false);
    }
  }, [boardId]);

  const isLoading = isInitialLoading || isQueryLoading;

  const updateListMutation = api.list.update.useMutation({
    onMutate: async (args) => {
      await utils.board.byId.cancel();

      const currentState = utils.board.byId.getData(queryParams);

      utils.board.byId.setData(queryParams, (oldBoard) => {
        if (!oldBoard) return oldBoard;

        const updatedLists = Array.from(oldBoard.lists);

        const sourceList = updatedLists.find(
          (list) => list.publicId === args.listPublicId,
        );

        const currentIndex = sourceList?.index;

        if (currentIndex === undefined) return oldBoard;

        const removedList = updatedLists.splice(currentIndex, 1)[0];

        if (removedList && args.index !== undefined) {
          updatedLists.splice(args.index, 0, removedList);

          return {
            ...oldBoard,
            lists: updatedLists,
          };
        }
      });

      return { previousState: currentState };
    },
    onError: (_error, _newList, context) => {
      utils.board.byId.setData(queryParams, context?.previousState);
      showPopup({
        header: t`Unable to update list`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await utils.board.byId.invalidate(queryParams);
    },
  });

  const updateCardMutation = api.card.update.useMutation({
    onMutate: async (args) => {
      await utils.board.byId.cancel();

      const currentState = utils.board.byId.getData(queryParams);

      utils.board.byId.setData(queryParams, (oldBoard) => {
        if (!oldBoard) return oldBoard;

        const updatedLists = Array.from(oldBoard.lists);

        const sourceList = updatedLists.find((list) =>
          list.cards.some((card) => card.publicId === args.cardPublicId),
        );
        const destinationList = updatedLists.find(
          (list) => list.publicId === args.listPublicId,
        );

        const cardToMove = sourceList?.cards.find(
          (card) => card.publicId === args.cardPublicId,
        );

        if (!cardToMove) return oldBoard;

        const removedCard = sourceList?.cards.splice(cardToMove.index, 1)[0];

        if (
          sourceList &&
          destinationList &&
          removedCard &&
          args.index !== undefined
        ) {
          destinationList.cards.splice(args.index, 0, removedCard);

          return {
            ...oldBoard,
            lists: updatedLists,
          };
        }
      });

      return { previousState: currentState };
    },
    onError: (_error, _newList, context) => {
      utils.board.byId.setData(queryParams, context?.previousState);
      showPopup({
        header: t`Unable to update card`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await utils.board.byId.invalidate(queryParams);
    },
  });

  useEffect(() => {
    if (isSuccess && boardData) {
      setValue("name", boardData.name || "");
    }
  }, [isSuccess, boardData, setValue]);

  const openNewListForm = (publicBoardId: string) => {
    openModal("NEW_LIST");
    setSelectedPublicListId(publicBoardId);
  };

  const onDragEnd = ({
    source: _source,
    destination,
    draggableId,
    type,
  }: DropResult): void => {
    if (!destination) {
      return;
    }

    if (type === "LIST" && canEditList) {
      updateListMutation.mutate({
        listPublicId: draggableId,
        index: destination.index,
      });
    }

    if (type === "CARD" && canEditCard) {
      updateCardMutation.mutate({
        cardPublicId: draggableId,

        listPublicId: destination.droppableId,
        index: destination.index,
      });
    }
  };

  const renderModalContent = () => {
    return (
      <>
        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "DELETE_BOARD"}
        >
          <DeleteBoardConfirmation
            isTemplate={!!isTemplate}
            boardPublicId={boardId ?? ""}
          />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "DELETE_LIST"}
        >
          <DeleteListConfirmation
            listPublicId={selectedPublicListId}
            queryParams={queryParams}
          />
        </Modal>

        <Modal
          modalSize="md"
          isVisible={isOpen && modalContentType === "NEW_CARD"}
        >
          <NewCardForm
            isTemplate={!!isTemplate}
            boardPublicId={boardId ?? ""}
            listPublicId={selectedPublicListId}
            queryParams={queryParams}
          />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "NEW_LIST"}
        >
          <NewListForm
            boardPublicId={boardId ?? ""}
            queryParams={queryParams}
          />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
        >
          <NewWorkspaceForm />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "NEW_LABEL"}
        >
          <LabelForm boardPublicId={boardId ?? ""} refetch={refetchBoard} />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "EDIT_LABEL"}
        >
          <LabelForm
            boardPublicId={boardId ?? ""}
            refetch={refetchBoard}
            isEdit
          />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "DELETE_LABEL"}
        >
          <DeleteLabelConfirmation
            refetch={refetchBoard}
            labelPublicId={entityId}
          />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "UPDATE_BOARD_SLUG"}
        >
          <UpdateBoardSlugForm
            boardPublicId={boardId ?? ""}
            workspaceSlug={workspace.slug ?? ""}
            boardSlug={boardData?.slug ?? ""}
            queryParams={queryParams}
          />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "CREATE_TEMPLATE"}
        >
          <NewTemplateForm
            workspacePublicId={workspace.publicId ?? ""}
            sourceBoardPublicId={boardId ?? ""}
            sourceBoardName={boardData?.name ?? ""}
          />
        </Modal>

        <Modal
          modalSize="sm"
          isVisible={isOpen && modalContentType === "EDIT_YOUTUBE"}
        >
          <EditYouTubeModal />
        </Modal>
      </>
    );
  };

  return (
    <>
      <PageHead
        title={`${boardData?.name ?? (isTemplate ? t`Board` : t`Template`)} | ${workspace.name ?? t`Workspace`}`}
      />
      <div className="relative flex h-full flex-col">
        <PatternedBackground />
        <div className="z-10 flex w-full flex-col justify-between p-6 md:flex-row md:p-8">
          {isLoading && !boardData && (
            <div className="flex space-x-2">
              <div className="h-[2.3rem] w-[150px] animate-pulse rounded-[5px] bg-light-200 dark:bg-dark-100" />
            </div>
          )}
          {boardData && (
            <form
              onSubmit={handleSubmit(onSubmit)}
              className="order-2 focus-visible:outline-none md:order-1"
            >
              <input
                id="name"
                type="text"
                {...register("name")}
                onBlur={canEditBoard ? handleSubmit(onSubmit) : undefined}
                readOnly={!canEditBoard}
                className="block border-0 bg-transparent p-0 py-0 font-bold leading-[2.3rem] tracking-tight text-neutral-900 focus:ring-0 focus-visible:outline-none disabled:cursor-not-allowed dark:text-dark-1000 sm:text-[1.2rem]"
              />
            </form>
          )}
          {!boardData && !isLoading && (
            <p className="order-2 block p-0 py-0 font-bold leading-[2.3rem] tracking-tight text-neutral-900 dark:text-dark-1000 sm:text-[1.2rem] md:order-1">
              {t`${isTemplate ? "Template" : "Board"} not found`}
            </p>
          )}
          <div className="order-1 mb-4 flex items-center justify-end space-x-2 md:order-2 md:mb-0">
            {isTemplate && (
              <div className="inline-flex cursor-default items-center justify-center whitespace-nowrap rounded-md border-[1px] border-light-300 bg-light-50 px-3 py-2 text-sm font-semibold text-light-950 shadow-sm dark:border-dark-300 dark:bg-dark-50 dark:text-dark-950">
                <span className="mr-2">
                  <HiOutlineRectangleStack />
                </span>
                {t`Template`}
              </div>
            )}
            {!isTemplate && (
              <>
                <UpdateBoardSlugButton
                  handleOnClick={() => openModal("UPDATE_BOARD_SLUG")}
                  isLoading={isLoading}
                  workspaceSlug={workspace.slug ?? ""}
                  boardSlug={boardData?.slug ?? ""}
                  boardPublicId={boardId ?? ""}
                  visibility={boardData?.visibility ?? "private"}
                  canEdit={canEditBoard}
                />
                <VisibilityButton
                  visibility={boardData?.visibility ?? "private"}
                  boardPublicId={boardId ?? ""}
                  boardSlug={boardData?.slug ?? ""}
                  queryParams={queryParams}
                  isLoading={!boardData}
                  isAdmin={workspace.role === "admin"}
                />
                {boardData && (
                  <Filters
                    labels={boardData.labels}
                    members={boardData.workspace.members.filter(
                      (member) => member.user !== null,
                    )}
                    lists={boardData.allLists}
                    position="left"
                    isLoading={!boardData}
                  />
                )}
              </>
            )}
            <Tooltip
              content={
                !canCreateList
                  ? t`You don't have permission`
                  : createListShortcutTooltipContent
              }
            >
              <Button
                iconLeft={
                  <HiOutlinePlusSmall
                    className="-mr-0.5 h-5 w-5"
                    aria-hidden="true"
                  />
                }
                onClick={() => {
                  if (boardId && canCreateList) openNewListForm(boardId);
                }}
                disabled={!boardData || !canCreateList}
              >
                {t`New list`}
              </Button>
            </Tooltip>
            <BoardDropdown
              isTemplate={!!isTemplate}
              isLoading={!boardData}
              boardPublicId={boardId ?? ""}
              workspacePublicId={workspace.publicId}
              isFavorite={boardData?.favorite}
              boardName={boardData?.name}
            />
          </div>
        </div>

        <div
          ref={scrollRef}
          onMouseDown={onMouseDown}
          className={`scrollbar-w-none scrollbar-track-rounded-[4px] scrollbar-thumb-rounded-[4px] scrollbar-h-[8px] z-0 flex-1 overflow-y-hidden overflow-x-scroll overscroll-contain scrollbar scrollbar-track-light-200 scrollbar-thumb-light-400 dark:scrollbar-track-dark-100 dark:scrollbar-thumb-dark-300`}
        >
          {isLoading ? (
            <div className="ml-[2rem] flex">
              <div className="0 mr-5 h-[500px] w-[18rem] animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
              <div className="0 mr-5 h-[275px] w-[18rem] animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
              <div className="0 mr-5 h-[375px] w-[18rem] animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
            </div>
          ) : boardData ? (
            <>
              {boardData.lists.length === 0 ? (
                <div className="z-10 flex h-full w-full flex-col items-center justify-center space-y-8 pb-[150px]">
                  <div className="flex flex-col items-center">
                    <HiOutlineSquare3Stack3D className="h-10 w-10 text-light-800 dark:text-dark-800" />
                    <p className="mb-2 mt-4 text-[14px] font-bold text-light-1000 dark:text-dark-950">
                      {t`No lists`}
                    </p>
                    <p className="text-[14px] text-light-900 dark:text-dark-900">
                      {canCreateList
                        ? t`Get started by creating a new list`
                        : t`No lists have been created yet`}
                    </p>
                  </div>
                  <Tooltip
                    content={
                      !canCreateList ? t`You don't have permission` : undefined
                    }
                  >
                    <Button
                      onClick={() => {
                        if (boardId && canCreateList) openNewListForm(boardId);
                      }}
                      disabled={!canCreateList}
                    >
                      {t`Create new list`}
                    </Button>
                  </Tooltip>
                </div>
              ) : (
                <DragDropContext onDragEnd={onDragEnd}>
                  <Droppable
                    droppableId="all-lists"
                    direction="horizontal"
                    type="LIST"
                  >
                    {(provided) => (
                      <div
                        className="flex"
                        ref={provided.innerRef}
                        {...provided.droppableProps}
                      >
                        <div className="min-w-[2rem]" />
                        {boardData.lists.map((list, index) => (
                          <List
                            index={index}
                            key={index}
                            list={list}
                            setSelectedPublicListId={(publicListId) =>
                              setSelectedPublicListId(publicListId)
                            }
                          >
                            <Droppable
                              droppableId={`${list.publicId}`}
                              type="CARD"
                            >
                              {(provided) => (
                                <div
                                  ref={provided.innerRef}
                                  {...provided.droppableProps}
                                  className="scrollbar-track-rounded-[4px] scrollbar-thumb-rounded-[4px] scrollbar-w-[8px] z-10 h-full max-h-[calc(100vh-225px)] min-h-[2rem] overflow-y-auto pr-1 scrollbar dark:scrollbar-track-dark-100 dark:scrollbar-thumb-dark-600"
                                >
                                  {list.cards.map((card, index) => (
                                    <Draggable
                                      key={card.publicId}
                                      draggableId={card.publicId}
                                      index={index}
                                      isDragDisabled={!canEditCard}
                                    >
                                      {(provided) => (
                                        <Link
                                          onClick={(e) => {
                                            if (
                                              card.publicId.startsWith(
                                                "PLACEHOLDER",
                                              )
                                            )
                                              e.preventDefault();
                                          }}
                                          key={card.publicId}
                                          href={
                                            isTemplate
                                              ? `/templates/${boardId}/cards/${card.publicId}`
                                              : `/cards/${card.publicId}`
                                          }
                                          className={`mb-2 flex !cursor-pointer flex-col ${
                                            card.publicId.startsWith(
                                              "PLACEHOLDER",
                                            )
                                              ? "pointer-events-none"
                                              : ""
                                          }`}
                                          ref={provided.innerRef}
                                          {...provided.draggableProps}
                                          {...provided.dragHandleProps}
                                        >
                                          <Card
                                            title={card.title}
                                            labels={card.labels}
                                            members={card.members}
                                            checklists={card.checklists ?? []}
                                            description={
                                              card.description ?? null
                                            }
                                            comments={card.comments ?? []}
                                            attachments={card.attachments}
                                            dueDate={card.dueDate ?? null}
                                          />
                                        </Link>
                                      )}
                                    </Draggable>
                                  ))}
                                  {provided.placeholder}
                                </div>
                              )}
                            </Droppable>
                          </List>
                        ))}
                        <div className="min-w-[0.75rem]" />
                        {provided.placeholder}
                      </div>
                    )}
                  </Droppable>
                </DragDropContext>
              )}
            </>
          ) : null}
        </div>
        {renderModalContent()}
      </div>
    </>
  );
}



================================================
FILE: apps/web/src/views/board/components/BoardDropdown.tsx
================================================
import { t } from "@lingui/core/macro";
import {
  HiEllipsisHorizontal,
  HiLink,
  HiOutlineDocumentDuplicate,
  HiOutlineTrash,
  HiOutlineStar,
  HiStar,
} from "react-icons/hi2";

import Dropdown from "~/components/Dropdown";
import { usePermissions } from "~/hooks/usePermissions";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

export default function BoardDropdown({
  isTemplate,
  isLoading,
  boardPublicId,
  isFavorite,
  boardName,
}: {
  isTemplate: boolean;
  isLoading: boolean;
  boardPublicId: string;
  isFavorite?: boolean;
  boardName?: string;
}) {
  const { openModal } = useModal();
  const { canEditBoard, canDeleteBoard, canCreateBoard } = usePermissions();
  const { showPopup } = usePopup();
  const utils = api.useUtils();

  const handleToggleFavorite = () => {
    updateBoard.mutate({
      boardPublicId,
      favorite: !isFavorite,
    });
  };

  const updateBoard = api.board.update.useMutation({
    onSuccess: (data, variables) => {
      void utils.board.all.invalidate();
      void utils.board.byId.invalidate();

      // Show popup notification
      if (variables.favorite !== undefined) {
        showPopup({
          header: variables.favorite
            ? t`Added to favorites`
            : t`Removed from favorites`,
          message: variables.favorite
            ? t`${boardName ?? "Board"} has been added to your favorites.`
            : t`${boardName ?? "Board"} has been removed from your favorites.`,
          icon: "success",
        });
      }
    },
    onError: () => {
      showPopup({
        header: t`Unable to update board`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });
  
  const items = [
    ...(isTemplate && canCreateBoard
      ? [
          {
            label: t`Make template`,
            action: () => openModal("CREATE_TEMPLATE"),
            icon: (
              <HiOutlineDocumentDuplicate className="h-[16px] w-[16px] text-dark-900" />
            ),
          },
        ]
      : []),
    ...(!isTemplate && canEditBoard
      ? [
          {
            label: t`Edit board URL`,
            action: () => openModal("UPDATE_BOARD_SLUG"),
            icon: <HiLink className="h-[16px] w-[16px] text-dark-900" />,
          },
        ]
      : []),
    {
      label: isFavorite
        ? t`Remove from favorites`
        : t`Add to favorites`,
      action: handleToggleFavorite,
      icon: isFavorite ? (
        <HiStar className="h-[16px] w-[16px] text-dark-900" />
      ) : (
        <HiOutlineStar className="h-[16px] w-[16px] text-dark-900" />
      ),
    },
    ...(canDeleteBoard
      ? [
          {
            label: isTemplate ? t`Delete template` : t`Delete board`,
            action: () => openModal("DELETE_BOARD"),
            icon: <HiOutlineTrash className="h-[16px] w-[16px] text-dark-900" />,
          },
        ]
      : []),
  ];
  

  if (items.length === 0) {
    return null;
  }

  return (
    <Dropdown disabled={isLoading} items={items}>
      <HiEllipsisHorizontal className="h-5 w-5 text-dark-900" />
    </Dropdown>
  );
}



================================================
FILE: apps/web/src/views/board/components/Card.tsx
================================================
import { format, isBefore, isSameYear, startOfDay } from "date-fns";
import { HiOutlinePaperClip } from "react-icons/hi";
import {
  HiBars3BottomLeft,
  HiChatBubbleLeft,
  HiOutlineClock,
} from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

import Avatar from "~/components/Avatar";
import Badge from "~/components/Badge";
import CircularProgress from "~/components/CircularProgress";
import LabelIcon from "~/components/LabelIcon";
import { useLocalisation } from "~/hooks/useLocalisation";
import { getAvatarUrl } from "~/utils/helpers";

const Card = ({
  title,
  labels,
  members,
  checklists,
  description,
  comments,
  attachments,
  dueDate,
}: {
  title: string;
  labels: { name: string; colourCode: string | null }[];
  members: {
    publicId: string;
    email: string;
    user: { name: string | null; email: string; image: string | null } | null;
  }[];
  checklists: {
    publicId: string;
    name: string;
    items: {
      publicId: string;
      title: string;
      completed: boolean;
      index: number;
    }[];
  }[];
  description: string | null;
  comments: { publicId: string }[];
  attachments?: { publicId: string }[];
  dueDate?: Date | null;
}) => {
  const { dateLocale } = useLocalisation();
  const showYear = dueDate ? !isSameYear(dueDate, new Date()) : false;
  const isOverdue = dueDate ? isBefore(dueDate, startOfDay(new Date())) : false;
  const completedItems = checklists.reduce((acc, checklist) => {
    return acc + checklist.items.filter((item) => item.completed).length;
  }, 0);

  const totalItems = checklists.reduce((acc, checklist) => {
    return acc + checklist.items.length;
  }, 0);

  const progress =
    totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;

  const hasDescription =
    description && description.replace(/<[^>]*>/g, "").trim().length > 0;
  const hasAttachments = attachments && attachments.length > 0;
  const hasDueDate = !!dueDate;

  return (
    <div className="flex flex-col overflow-hidden rounded-md border border-light-200 bg-light-50 px-3 py-2 text-sm text-neutral-900 dark:border-dark-200 dark:bg-dark-200 dark:text-dark-1000 dark:hover:bg-dark-300">
      <span className="break-words">{title}</span>
      {labels.length ||
      members.length ||
      checklists.length > 0 ||
      hasDescription ||
      comments.length > 0 ||
      hasDueDate ||
      hasAttachments ? (
        <div className="mt-2 flex flex-col justify-end">
          <div className="space-x-0.5">
            {labels.map((label) => (
              <Badge
                value={label.name}
                iconLeft={<LabelIcon colourCode={label.colourCode} />}
              />
            ))}
          </div>
          <div className="mt-2 flex items-center justify-between gap-1">
            <div className="flex items-center gap-2">
              {hasDescription && (
                <div className="flex items-center gap-1 text-light-700 dark:text-dark-800">
                  <HiBars3BottomLeft className="h-4 w-4" />
                </div>
              )}
              {hasDueDate && dueDate && (
                <div
                  className={twMerge(
                    "flex items-center gap-1",
                    isOverdue
                      ? "text-red-600 dark:text-red-400"
                      : "text-light-800 dark:text-dark-800",
                  )}
                >
                  <HiOutlineClock className="h-4 w-4" />
                  <span className="text-[11px]">
                    {format(dueDate, showYear ? "do MMM yyyy" : "do MMM", {
                      locale: dateLocale,
                    })}
                  </span>
                </div>
              )}
              {comments.length > 0 && (
                <div className="flex items-center gap-1 text-light-700 dark:text-dark-800">
                  <HiChatBubbleLeft className="h-4 w-4" />
                </div>
              )}
              {hasAttachments && (
                <div className="flex items-center gap-1 text-light-700 dark:text-dark-800">
                  <HiOutlinePaperClip className="h-4 w-4" />
                </div>
              )}
            </div>
            <div className="flex items-center justify-end gap-1">
              {checklists.length > 0 && (
                <div className="flex items-center gap-1 rounded-full border-[1px] border-light-300 px-2 py-1 dark:border-dark-600">
                  <CircularProgress
                    progress={progress || 2}
                    size="sm"
                    className="flex-shrink-0"
                  />
                  <span className="text-[10px] text-light-900 dark:text-dark-950">
                    {completedItems}/{totalItems}
                  </span>
                </div>
              )}
              {members.length > 0 && (
                <div className="isolate flex justify-end -space-x-1 overflow-hidden">
                  {members.map(({ user, email }) => {
                    const avatarUrl = user?.image
                      ? getAvatarUrl(user.image)
                      : undefined;

                    return (
                      <Avatar
                        name={user?.name ?? ""}
                        email={user?.email ?? email}
                        imageUrl={avatarUrl}
                        size="sm"
                      />
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        </div>
      ) : null}
    </div>
  );
};

export default Card;



================================================
FILE: apps/web/src/views/board/components/DeleteBoardConfirmation.tsx
================================================
import { useRouter } from "next/navigation";
import { t } from "@lingui/core/macro";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { api } from "~/utils/api";

export function DeleteBoardConfirmation({
  boardPublicId,
  isTemplate,
}: {
  boardPublicId: string;
  isTemplate: boolean;
}) {
  const router = useRouter();
  const { closeModal } = useModal();

  const deleteBoard = api.board.delete.useMutation({
    onSuccess: () => {
      closeModal();
      router.push(isTemplate ? `/templates` : `/boards`);
    },
  });

  const handleDeleteBoard = () => {
    if (boardPublicId)
      deleteBoard.mutate({
        boardPublicId: boardPublicId,
      });
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          {t`Are you sure you want to delete this ${isTemplate ? "template" : "board"}?`}
        </h2>
        <p className="text-sm font-medium text-light-900 dark:text-dark-900">
          {t`This action can't be undone.`}
        </p>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button onClick={() => closeModal()} variant="secondary">
          {t`Cancel`}
        </Button>
        <Button onClick={handleDeleteBoard} isLoading={deleteBoard.isPending}>
          {t`Delete`}
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/board/components/DeleteListConfirmation.tsx
================================================
import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

interface DeleteListConfirmationProps {
  listPublicId: string;
  queryParams: QueryParams;
}

interface QueryParams {
  boardPublicId: string;
  members: string[];
  labels: string[];
  lists: string[];
}

export function DeleteListConfirmation({
  listPublicId,
  queryParams,
}: DeleteListConfirmationProps) {
  const utils = api.useUtils();
  const { closeModal } = useModal();
  const { showPopup } = usePopup();

  const deleteList = api.list.delete.useMutation({
    onError: () => {
      showPopup({
        header: "Unable to delete list",
        message: "Please try again later, or contact customer support.",
        icon: "error",
      });
    },
    onSettled: async () => {
      closeModal();
      await utils.board.byId.invalidate(queryParams);
    },
  });

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          Are you sure you want to delete this list?
        </h2>
        <p className="text-sm font-medium text-light-900 dark:text-dark-900">
          {"This action can't be undone."}
        </p>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button onClick={() => closeModal()} variant="secondary">
          Cancel
        </Button>
        <Button
          isLoading={deleteList.isPending}
          onClick={() => deleteList.mutate({ listPublicId })}
        >
          Delete
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/board/components/Filters.tsx
================================================
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import {
  HiMiniXMark,
  HiOutlineClock,
  HiOutlineSquare3Stack3D,
  HiOutlineTag,
  HiOutlineUserCircle,
} from "react-icons/hi2";
import { IoFilterOutline } from "react-icons/io5";

import Avatar from "~/components/Avatar";
import Button from "~/components/Button";
import CheckboxDropdown from "~/components/CheckboxDropdown";
import LabelIcon from "~/components/LabelIcon";
import {
  formatMemberDisplayName,
  formatToArray,
  getAvatarUrl,
} from "~/utils/helpers";

interface Member {
  publicId: string;
  user: {
    name: string | null;
    image: string | null;
    email: string;
  } | null;
}

interface Label {
  publicId: string;
  name: string;
  colourCode: string | null;
}

interface List {
  publicId: string;
  name: string;
}

const Filters = ({
  position = "right",
  labels,
  members,
  lists,
  isLoading,
}: {
  position?: "left" | "right";
  labels: Label[];
  members: Member[];
  lists: List[];
  isLoading: boolean;
}) => {
  const router = useRouter();

  const clearFilters = async (e: React.MouseEvent<HTMLButtonElement>) => {
    e.preventDefault();
    e.stopPropagation();

    try {
      await router.push({
        pathname: router.pathname,
        query: {
          ...router.query,
          members: [],
          labels: [],
          lists: [],
          dueDate: [],
        },
      });
    } catch (error) {
      console.error(error);
    }
  };

  const formattedMembers = members.map((member) => ({
    key: member.publicId,
    value: formatMemberDisplayName(
      member.user?.name ?? null,
      member.user?.email ?? null,
    ),
    selected: !!router.query.members?.includes(member.publicId),
    leftIcon: (
      <Avatar
        size="xs"
        name={member.user?.name ?? ""}
        imageUrl={
          member.user?.image ? getAvatarUrl(member.user.image) : undefined
        }
        email={member.user?.email ?? ""}
      />
    ),
  }));

  const formattedLabels = labels.map((label) => ({
    key: label.publicId,
    value: label.name,
    selected: !!router.query.labels?.includes(label.publicId),
    leftIcon: <LabelIcon colourCode={label.colourCode} />,
  }));

  const formattedLists = lists.map((list) => ({
    key: list.publicId,
    value: list.name,
    selected: !!router.query.lists?.includes(list.publicId),
  }));

  const dueDateItems = [
    {
      key: "overdue",
      value: t`Overdue`,
      selected: !!router.query.dueDate?.includes("overdue"),
    },
    {
      key: "today",
      value: t`Due today`,
      selected: !!router.query.dueDate?.includes("today"),
    },
    {
      key: "tomorrow",
      value: t`Due tomorrow`,
      selected: !!router.query.dueDate?.includes("tomorrow"),
    },
    {
      key: "next-week",
      value: t`Due next week`,
      selected: !!router.query.dueDate?.includes("next-week"),
    },
    {
      key: "next-month",
      value: t`Due next month`,
      selected: !!router.query.dueDate?.includes("next-month"),
    },
    {
      key: "no-due-date",
      value: t`No dates`,
      selected: !!router.query.dueDate?.includes("no-due-date"),
    },
  ];

  const groups = [
    ...(formattedMembers.length
      ? [
          {
            key: "members",
            label: t`Members`,
            icon: <HiOutlineUserCircle size={16} />,
            items: formattedMembers,
          },
        ]
      : []),
    {
      key: "labels",
      label: t`Labels`,
      icon: <HiOutlineTag size={16} />,
      items: formattedLabels,
    },
    ...(formattedLists.length
      ? [
          {
            key: "lists",
            label: t`Lists`,
            icon: <HiOutlineSquare3Stack3D size={16} />,
            items: formattedLists,
          },
        ]
      : []),
    {
      key: "dueDate",
      label: t`Due date`,
      icon: <HiOutlineClock size={16} />,
      items: dueDateItems,
    },
  ];

  const handleSelect = async (
    groupKey: string | null,
    item: { key: string },
  ) => {
    if (groupKey === null) return;
    const currentQuery = router.query[groupKey] ?? [];
    const formattedCurrentQuery = Array.isArray(currentQuery)
      ? currentQuery
      : [currentQuery];

    const updatedQuery = formattedCurrentQuery.includes(item.key)
      ? formattedCurrentQuery.filter((key) => key !== item.key)
      : [...formattedCurrentQuery, item.key];

    try {
      await router.push({
        pathname: router.pathname,
        query: { ...router.query, [groupKey]: updatedQuery },
      });
    } catch (error) {
      console.error(error);
    }
  };

  const numOfFilters = [
    ...formatToArray(router.query.members),
    ...formatToArray(router.query.labels),
    ...formatToArray(router.query.lists),
    ...formatToArray(router.query.dueDate),
  ].length;

  return (
    <div className="relative">
      <CheckboxDropdown
        groups={groups}
        handleSelect={handleSelect}
        menuSpacing="md"
        position={position}
      >
        <Button
          variant="secondary"
          disabled={isLoading}
          iconLeft={<IoFilterOutline />}
        >
          {t`Filter`}
        </Button>
        {numOfFilters > 0 && (
          <button
            type="button"
            onClick={clearFilters}
            aria-label={t`Clear filters`}
            className="group absolute -right-[8px] -top-[8px] flex h-5 w-5 items-center justify-center rounded-full border-2 border-light-100 bg-light-1000 text-[8px] font-[700] text-light-600 dark:border-dark-50 dark:bg-dark-1000 dark:text-dark-600"
          >
            <span className="group-hover:hidden">{numOfFilters}</span>
            <span className="hidden text-light-50 group-hover:inline dark:text-dark-50">
              <HiMiniXMark size={12} />
            </span>
          </button>
        )}
      </CheckboxDropdown>
    </div>
  );
};

export default Filters;



================================================
FILE: apps/web/src/views/board/components/List.tsx
================================================
import type { ReactNode } from "react";
import { t } from "@lingui/core/macro";
import { Draggable } from "react-beautiful-dnd";
import { useForm } from "react-hook-form";
import {
  HiEllipsisHorizontal,
  HiOutlinePlusSmall,
  HiOutlineSquaresPlus,
  HiOutlineTrash,
} from "react-icons/hi2";

import { authClient } from "@kan/auth/client";

import Dropdown from "~/components/Dropdown";
import { Tooltip } from "~/components/Tooltip";
import { usePermissions } from "~/hooks/usePermissions";
import { useModal } from "~/providers/modal";
import { api } from "~/utils/api";

interface ListProps {
  children: ReactNode;
  index: number;
  list: List;
  setSelectedPublicListId: (publicListId: PublicListId) => void;
}

interface List {
  publicId: string;
  name: string;
  createdBy?: string | null;
}

interface FormValues {
  listPublicId: string;
  name: string;
}

type PublicListId = string;

export default function List({
  children,
  index,
  list,
  setSelectedPublicListId,
}: ListProps) {
  const { openModal } = useModal();
  const { canCreateCard, canEditList, canDeleteList } = usePermissions();
  const { data: session } = authClient.useSession();
  const isCreator = list.createdBy && session?.user.id === list.createdBy;
  const canEdit = canEditList || isCreator;
  const canDrag = canEditList || isCreator;

  const openNewCardForm = (publicListId: PublicListId) => {
    if (!canCreateCard) return;
    openModal("NEW_CARD");
    setSelectedPublicListId(publicListId);
  };

  const updateList = api.list.update.useMutation();

  const { register, handleSubmit } = useForm<FormValues>({
    defaultValues: {
      listPublicId: list.publicId,
      name: list.name,
    },
    values: {
      listPublicId: list.publicId,
      name: list.name,
    },
  });

  const onSubmit = (values: FormValues) => {
    if (!canEdit) return;
    updateList.mutate({
      listPublicId: values.listPublicId,
      name: values.name,
    });
  };

  const handleOpenDeleteListConfirmation = () => {
    setSelectedPublicListId(list.publicId);
    openModal("DELETE_LIST");
  };

  return (
    <Draggable
      key={list.publicId}
      draggableId={list.publicId}
      index={index}
      isDragDisabled={!canDrag}
    >
      {(provided) => (
        <div
          key={list.publicId}
          ref={provided.innerRef}
          {...provided.draggableProps}
          {...provided.dragHandleProps}
          className="dark-text-dark-1000 mr-5 h-fit min-w-[18rem] max-w-[18rem] rounded-md border border-light-400 bg-light-300 py-2 pl-2 pr-1 text-neutral-900 dark:border-dark-300 dark:bg-dark-100"
        >
          <div className="mb-2 flex justify-between">
            <form
              onSubmit={handleSubmit(onSubmit)}
              className="w-full focus-visible:outline-none"
            >
              <input
                id="name"
                type="text"
                {...register("name")}
                onBlur={handleSubmit(onSubmit)}
                readOnly={!canEdit}
                className="w-full border-0 bg-transparent px-4 pt-1 text-sm font-medium text-neutral-900 focus:ring-0 focus-visible:outline-none dark:text-dark-1000"
              />
            </form>
            <div className="flex items-center">
              <Tooltip
                content={
                  !canCreateCard ? t`You don't have permission` : undefined
                }
              >
                <button
                  className="mx-1 inline-flex h-fit items-center rounded-md p-1 px-1 text-sm font-semibold text-dark-50 hover:bg-light-400 disabled:opacity-60 disabled:cursor-not-allowed dark:hover:bg-dark-200"
                  onClick={() => openNewCardForm(list.publicId)}
                  disabled={!canCreateCard}
                >
                  <HiOutlinePlusSmall
                    className="h-5 w-5 text-dark-900"
                    aria-hidden="true"
                  />
                </button>
              </Tooltip>
              {(() => {
                const dropdownItems = [
                  ...(canCreateCard
                    ? [
                        {
                          label: t`Add a card`,
                          action: () => openNewCardForm(list.publicId),
                          icon: (
                            <HiOutlineSquaresPlus className="h-[18px] w-[18px] text-dark-900" />
                          ),
                        },
                      ]
                    : []),
                  ...(canDeleteList || isCreator
                    ? [
                        {
                          label: t`Delete list`,
                          action: handleOpenDeleteListConfirmation,
                          icon: (
                            <HiOutlineTrash className="h-[18px] w-[18px] text-dark-900" />
                          ),
                        },
                      ]
                    : []),
                ];

                if (dropdownItems.length === 0) {
                  return null;
                }

                return (
                  <div className="relative mr-1 inline-block">
                    <Dropdown items={dropdownItems}>
                      <HiEllipsisHorizontal className="h-5 w-5 text-dark-900" />
                    </Dropdown>
                  </div>
                );
              })()}
            </div>
          </div>
          {children}
        </div>
      )}
    </Draggable>
  );
}



================================================
FILE: apps/web/src/views/board/components/NewCardForm.tsx
================================================
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";
import { format } from "date-fns";
import { useEffect, useState } from "react";
import { useForm } from "react-hook-form";
import {
  HiOutlineBarsArrowDown,
  HiOutlineBarsArrowUp,
  HiXMark,
} from "react-icons/hi2";

import type { NewCardInput } from "@kan/api/types";
import { generateUID } from "@kan/shared/utils";

import type { WorkspaceMember } from "~/components/Editor";
import Avatar from "~/components/Avatar";
import Button from "~/components/Button";
import CheckboxDropdown from "~/components/CheckboxDropdown";
import DateSelector from "~/components/DateSelector";
import Editor from "~/components/Editor";
import Input from "~/components/Input";
import LabelIcon from "~/components/LabelIcon";
import Toggle from "~/components/Toggle";
import { useModalFormState } from "~/hooks/useModalFormState";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { formatMemberDisplayName, getAvatarUrl } from "~/utils/helpers";

type NewCardFormInput = NewCardInput & {
  isCreateAnotherEnabled: boolean;
  dueDate?: Date | null;
};

interface QueryParams {
  boardPublicId: string;
  members: string[];
  labels: string[];
  lists: string[];
}

interface NewCardFormProps {
  isTemplate: boolean;
  boardPublicId: string;
  listPublicId: string;
  queryParams: QueryParams;
}

export function NewCardForm({
  isTemplate,
  boardPublicId,
  listPublicId,
  queryParams,
}: NewCardFormProps) {
  const { showPopup } = usePopup();
  const { closeModal, openModal, modalStates, clearModalState } = useModal();

  const utils = api.useUtils();

  // persists the form values
  const { formState, saveFormState } = useModalFormState<NewCardFormInput>({
    modalType: "NEW_CARD",
    initialValues: {
      title: "",
      description: "",
      listPublicId,
      labelPublicIds: [],
      memberPublicIds: [],
      isCreateAnotherEnabled: false,
      position: "start",
      dueDate: null,
    },
    resetOnClose: true,
  });

  const { register, handleSubmit, reset, setValue, watch } =
    useForm<NewCardFormInput>({
      values: formState,
    });

  const labelPublicIds = watch("labelPublicIds") || [];
  const memberPublicIds = watch("memberPublicIds") || [];
  const isCreateAnotherEnabled = watch("isCreateAnotherEnabled");
  const position = watch("position");
  const title = watch("title");
  const description = watch("description");
  const dueDate = watch("dueDate");
  const [isDateSelectorOpen, setIsDateSelectorOpen] = useState(false);

  // saving form state whenever form values change
  useEffect(() => {
    const subscription = watch((data) => {
      saveFormState(data as NewCardFormInput);
    });
    return () => subscription.unsubscribe();
  }, [watch, saveFormState]);

  const { data: boardData } = api.board.byId.useQuery(queryParams, {
    enabled: !!boardPublicId,
  });

  // this adds the new created label to selected labels
  useEffect(() => {
    const newLabelId = modalStates.NEW_LABEL_CREATED;
    if (newLabelId !== undefined && !labelPublicIds.includes(newLabelId)) {
      setValue("labelPublicIds", [...labelPublicIds, newLabelId]);
    }
  }, [modalStates, labelPublicIds]);

  // this removes the deleted label from selected labels if it is selected
  useEffect(() => {
    if (boardData?.labels) {
      const availableLabelIds = boardData.labels.map((label) => label.publicId);
      const newLabelId = modalStates.NEW_LABEL_CREATED;

      if (newLabelId && availableLabelIds.includes(newLabelId)) {
        clearModalState("NEW_LABEL_CREATED");
      }

      const validLabelIds = labelPublicIds.filter(
        (id) => availableLabelIds.includes(id) || id === newLabelId,
      );

      if (validLabelIds.length !== labelPublicIds.length) {
        setValue("labelPublicIds", validLabelIds);
      }
    }
  }, [boardData?.labels, labelPublicIds, modalStates.NEW_LABEL_CREATED]);

  const createCard = api.card.create.useMutation({
    onMutate: async (args) => {
      await utils.board.byId.cancel();

      const currentState = utils.board.byId.getData(queryParams);

      utils.board.byId.setData(queryParams, (oldBoard) => {
        if (!oldBoard) return oldBoard;

        const updatedLists = oldBoard.lists.map((list) => {
          if (list.publicId === listPublicId) {
            const newCard = {
              publicId: `PLACEHOLDER_${generateUID()}`,
              title: args.title,
              listId: 2,
              description: "",
              dueDate: args.dueDate ?? null,
              labels: oldBoard.labels.filter((label) =>
                args.labelPublicIds.includes(label.publicId),
              ),
              members:
                oldBoard.workspace.members
                  .filter((member) =>
                    args.memberPublicIds.includes(member.publicId),
                  )
                  .map((member) => ({
                    ...member,
                    deletedAt: null,
                  })) ?? [],
              _filteredLabels: labelPublicIds.map((id) => ({ publicId: id })),
              _filteredMembers: memberPublicIds.map((id) => ({ publicId: id })),
              index: position === "start" ? 0 : list.cards.length,
            };

            const updatedCards =
              position === "start"
                ? [newCard, ...list.cards]
                : [...list.cards, newCard];
            return { ...list, cards: updatedCards };
          }
          return list;
        });

        return { ...oldBoard, lists: updatedLists };
      });

      return { previousState: currentState };
    },
    onError: (error, _newList, context) => {
      utils.board.byId.setData(queryParams, context?.previousState);
      showPopup({
        header: t`Unable to create card`,
        message: error.data?.zodError?.fieldErrors.title?.[0]
          ? `${error.data.zodError.fieldErrors.title[0].replace("String", "Title")}`
          : t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSuccess: async () => {
      const isCreateAnotherEnabled = watch("isCreateAnotherEnabled");
      if (!isCreateAnotherEnabled) {
        // close modal (state will auto-clear due to resetOnClose: true)
        closeModal();
      } else {
        // reset form for creating another card
        const newFormState = {
          title: "",
          description: "",
          listPublicId: watch("listPublicId"),
          labelPublicIds: [],
          memberPublicIds: [],
          isCreateAnotherEnabled,
          position,
          dueDate: null,
        };
        reset(newFormState);
        saveFormState(newFormState);
      }
      await utils.board.byId.invalidate(queryParams);
    },
  });

  useEffect(() => {
    const titleElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#title");
    if (titleElement) titleElement.focus();
  }, []);

  const formattedLabels =
    boardData?.labels.map((label) => ({
      key: label.publicId,
      value: label.name,
      leftIcon: <LabelIcon colourCode={label.colourCode} />,
      selected: labelPublicIds.includes(label.publicId),
    })) ?? [];

  const formattedLists =
    boardData?.lists.map((list) => ({
      key: list.publicId,
      value: list.name,
      selected: list.publicId === watch("listPublicId"),
    })) ?? [];

  const formattedMembers =
    boardData?.workspace.members.map((member) => ({
      key: member.publicId,
      value: formatMemberDisplayName(
        member.user?.name ?? null,
        member.user?.email ?? member.email,
      ),
      selected: memberPublicIds.includes(member.publicId),
      leftIcon: (
        <Avatar
          size="xs"
          name={member.user?.name ?? ""}
          imageUrl={
            member.user?.image ? getAvatarUrl(member.user.image) : undefined
          }
          email={member.user?.email ?? member.email}
        />
      ),
    })) ?? [];

  const onSubmit = (data: NewCardFormInput) => {
    createCard.mutate({
      title: data.title,
      description: data.description,
      listPublicId: data.listPublicId,
      labelPublicIds: data.labelPublicIds,
      memberPublicIds: data.memberPublicIds,
      position: data.position,
      dueDate: data.dueDate ?? null,
    });
  };

  const handleToggleCreateAnother = (): void => {
    setValue("isCreateAnotherEnabled", !isCreateAnotherEnabled);
  };

  const handleSelectList = (listPublicId: string): void => {
    setValue("listPublicId", listPublicId);
  };

  const handleSelectMembers = (memberPublicId: string): void => {
    const currentIndex = memberPublicIds.indexOf(memberPublicId);
    if (currentIndex === -1) {
      setValue("memberPublicIds", [...memberPublicIds, memberPublicId]);
    } else {
      const newMemberPublicIds = [...memberPublicIds];
      newMemberPublicIds.splice(currentIndex, 1);
      setValue("memberPublicIds", newMemberPublicIds);
    }
  };

  const handleSelectLabels = (labelPublicId: string): void => {
    const currentIndex = labelPublicIds.indexOf(labelPublicId);
    if (currentIndex === -1) {
      setValue("labelPublicIds", [...labelPublicIds, labelPublicId]);
    } else {
      const newLabelPublicIds = [...labelPublicIds];
      newLabelPublicIds.splice(currentIndex, 1);
      setValue("labelPublicIds", newLabelPublicIds);
    }
  };

  const selectedList = formattedLists.find((item) => item.selected);

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-5">
          <h2 className="text-sm font-bold text-neutral-900 dark:text-dark-1000">
            {t`New card`}
          </h2>
          <button
            type="button"
            className="rounded p-1 hover:bg-light-200 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              closeModal();
              e.preventDefault();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>

        <div>
          <Input
            id="title"
            placeholder={t`Card title`}
            {...register("title")}
            onKeyDown={async (e) => {
              if (e.key === "Enter") {
                e.preventDefault();
                await handleSubmit(onSubmit)();
              }
            }}
          />
        </div>
        <div className="mt-2">
          <div className="block max-h-48 min-h-24 w-full overflow-y-auto rounded-md border-0 bg-dark-300 bg-white/5 px-3 py-2 text-sm shadow-sm ring-1 ring-inset ring-light-600 focus-within:ring-2 focus-within:ring-inset focus-within:ring-light-700 dark:ring-dark-700 dark:focus-within:ring-dark-700 sm:leading-6">
            <Editor
              content={description}
              onChange={(value) => {
                setValue("description", value);
                saveFormState({ ...formState, description: value });
              }}
              workspaceMembers={
                boardData?.workspace.members.map(
                  (member): WorkspaceMember => ({
                    publicId: member.publicId,
                    email: member.email,
                    user: member.user
                      ? {
                          id: member.publicId,
                          name: member.user.name,
                          image: member.user.image ?? null,
                        }
                      : null,
                  }),
                ) ?? []
              }
              enableYouTubeEmbed={false}
            />
          </div>
        </div>
        <div className="mt-2 flex space-x-1">
          <div className="w-fit">
            <CheckboxDropdown
              items={formattedLists}
              handleSelect={(_groupKey, item) => handleSelectList(item.key)}
            >
              <div className="flex h-full w-full items-center rounded-[5px] border-[1px] border-light-600 bg-light-200 px-2 py-1 text-left text-xs text-light-800 hover:bg-light-300 dark:border-dark-600 dark:bg-dark-400 dark:text-dark-1000 dark:hover:bg-dark-500">
                {selectedList?.value}
              </div>
            </CheckboxDropdown>
          </div>
          {!isTemplate && (
            <div className="w-fit">
              <CheckboxDropdown
                items={formattedMembers}
                handleSelect={(_groupKey, item) =>
                  handleSelectMembers(item.key)
                }
              >
                <div className="flex h-full w-full items-center rounded-[5px] border-[1px] border-light-600 bg-light-200 px-2 py-1 text-left text-xs text-light-800 hover:bg-light-300 dark:border-dark-600 dark:bg-dark-400 dark:text-dark-1000 dark:hover:bg-dark-500">
                  {!memberPublicIds.length ? (
                    t`Members`
                  ) : (
                    <div className="flex -space-x-1 overflow-hidden">
                      {memberPublicIds.map((memberPublicId) => {
                        const member = formattedMembers.find(
                          (member) => member.key === memberPublicId,
                        );

                        return (
                          <span
                            key={member?.key}
                            className="inline-flex h-4 w-4 items-center justify-center rounded-full bg-gray-400 ring-1 ring-light-200 dark:ring-dark-500"
                          >
                            <span className="text-[8px] font-medium leading-none text-white">
                              {member?.value
                                .split(" ")
                                .map((namePart) =>
                                  namePart.charAt(0).toUpperCase(),
                                )
                                .join("")}
                            </span>
                          </span>
                        );
                      })}
                    </div>
                  )}
                </div>
              </CheckboxDropdown>
            </div>
          )}
          <div className="w-fit">
            <CheckboxDropdown
              items={formattedLabels}
              handleSelect={(_groupKey, item) => handleSelectLabels(item.key)}
              handleEdit={(labelPublicId) =>
                openModal("EDIT_LABEL", labelPublicId)
              }
              handleCreate={() => openModal("NEW_LABEL")}
              createNewItemLabel={t`Create new label`}
            >
              <div className="flex h-full w-full items-center rounded-[5px] border-[1px] border-light-600 bg-light-200 px-2 py-1 text-left text-xs text-light-800 hover:bg-light-300 dark:border-dark-600 dark:bg-dark-400 dark:text-dark-1000 dark:hover:bg-dark-500">
                {!labelPublicIds.length ? (
                  t`Labels`
                ) : (
                  <>
                    <div
                      className={
                        labelPublicIds.length > 1
                          ? "flex -space-x-[2px] overflow-hidden"
                          : "flex items-center"
                      }
                    >
                      {labelPublicIds.map((labelPublicId) => {
                        const label = boardData?.labels.find(
                          (label) => label.publicId === labelPublicId,
                        );

                        return (
                          <>
                            <svg
                              fill={label?.colourCode ?? "#3730a3"}
                              className="h-2 w-2"
                              viewBox="0 0 6 6"
                              aria-hidden="true"
                            >
                              <circle cx={3} cy={3} r={3} />
                            </svg>
                            {labelPublicIds.length === 1 && (
                              <div className="ml-1">{label?.name}</div>
                            )}
                          </>
                        );
                      })}
                    </div>
                    {labelPublicIds.length > 1 && (
                      <div className="ml-1">
                        <Trans>{`${labelPublicIds.length} labels`}</Trans>
                      </div>
                    )}
                  </>
                )}
              </div>
            </CheckboxDropdown>
          </div>
          <div className="relative w-fit">
            <button
              type="button"
              onClick={() => setIsDateSelectorOpen(!isDateSelectorOpen)}
              className="flex h-full w-full items-center rounded-[5px] border-[1px] border-light-600 bg-light-200 px-2 py-1 text-left text-xs text-light-800 hover:bg-light-300 dark:border-dark-600 dark:bg-dark-400 dark:text-dark-1000 dark:hover:bg-dark-500"
            >
              {dueDate ? (
                <span>{format(dueDate, "MMM d, yyyy")}</span>
              ) : (
                <>{t`Due date`}</>
              )}
            </button>
            {isDateSelectorOpen && (
              <>
                <div
                  className="fixed inset-0 z-10"
                  onClick={() => setIsDateSelectorOpen(false)}
                />
                <div
                  className="absolute left-0 top-full z-20 mt-2 rounded-md border border-light-200 bg-light-50 shadow-lg dark:border-dark-200 dark:bg-dark-100"
                  onClick={(e) => {
                    e.stopPropagation();
                  }}
                  onMouseDown={(e) => {
                    e.stopPropagation();
                  }}
                >
                  <DateSelector
                    selectedDate={dueDate ?? undefined}
                    onDateSelect={(date) => {
                      setValue("dueDate", date ?? null);
                      setIsDateSelectorOpen(false);
                    }}
                  />
                </div>
              </>
            )}
          </div>
          <button
            onClick={(e) => {
              e.preventDefault();
              setValue("position", position === "start" ? "end" : "start");
            }}
            className="flex h-auto items-center rounded-[5px] border-[1px] border-light-600 bg-light-200 px-1.5 py-1 text-left text-xs text-light-800 hover:bg-light-300 focus-visible:outline-none dark:border-dark-600 dark:bg-dark-400 dark:text-dark-1000 dark:hover:bg-dark-500"
          >
            {position === "start" ? (
              <HiOutlineBarsArrowUp size={14} />
            ) : (
              <HiOutlineBarsArrowDown size={14} />
            )}
          </button>
        </div>
      </div>

      <div className="mt-5 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <Toggle
          label={t`Create another`}
          isChecked={isCreateAnotherEnabled}
          onChange={handleToggleCreateAnother}
        />

        <div>
          <Button
            type="submit"
            disabled={title.length === 0 || createCard.isPending}
          >
            {t`Create card`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/views/board/components/NewListForm.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect } from "react";
import { useForm } from "react-hook-form";
import { HiXMark } from "react-icons/hi2";

import type { NewListInput } from "@kan/api/types";
import { generateUID } from "@kan/shared/utils";

import Button from "~/components/Button";
import Input from "~/components/Input";
import Toggle from "~/components/Toggle";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

type NewListFormInput = NewListInput & {
  isCreateAnotherEnabled: boolean;
};

interface QueryParams {
  boardPublicId: string;
  members: string[];
  labels: string[];
  lists: string[];
}

export function NewListForm({
  boardPublicId,
  queryParams,
}: {
  boardPublicId: string;
  queryParams: QueryParams;
}) {
  const { closeModal } = useModal();
  const { showPopup } = usePopup();

  const utils = api.useUtils();

  const { register, handleSubmit, reset, setValue, watch } =
    useForm<NewListFormInput>({
      defaultValues: {
        name: "",
        boardPublicId: boardPublicId,
        isCreateAnotherEnabled: false,
      },
    });

  const isCreateAnotherEnabled = watch("isCreateAnotherEnabled");

  const createList = api.list.create.useMutation({
    onMutate: async (args) => {
      await utils.board.byId.cancel();

      const currentState = utils.board.byId.getData(queryParams);

      utils.board.byId.setData(queryParams, (oldBoard) => {
        if (!oldBoard) return oldBoard;

        const newList = {
          publicId: generateUID(),
          name: args.name,
          boardId: 1,
          boardPublicId,
          cards: [],
          index: oldBoard.lists.length,
        };

        const updatedLists = [...oldBoard.lists, newList];

        return { ...oldBoard, lists: updatedLists };
      });

      return { previousState: currentState };
    },
    onError: (_error, _newList, context) => {
      utils.board.byId.setData(queryParams, context?.previousState);
      showPopup({
        header: t`Unable to create list`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await utils.board.byId.invalidate(queryParams);
    },
  });

  useEffect(() => {
    const nameElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#list-name");
    if (nameElement) nameElement.focus();
  }, []);

  const onSubmit = (data: NewListInput) => {
    const isCreateAnotherEnabled = watch("isCreateAnotherEnabled");
    if (!isCreateAnotherEnabled) closeModal();
    reset({
      name: "",
      isCreateAnotherEnabled,
    });

    createList.mutate({
      name: data.name,
      boardPublicId,
    });
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-4">
          <h2 className="text-sm font-bold text-neutral-900 dark:text-dark-1000">
            {t`New list`}
          </h2>
          <button
            type="button"
            className="rounded p-1 hover:bg-light-200 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>

        <Input
          id="list-name"
          placeholder={t`List name`}
          {...register("name")}
          onKeyDown={async (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
          }}
        />
      </div>
      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <Toggle
          label={t`Create another`}
          isChecked={isCreateAnotherEnabled}
          onChange={() =>
            setValue("isCreateAnotherEnabled", !isCreateAnotherEnabled)
          }
        />

        <div>
          <Button
            type="submit"
            disabled={createList.isPending || !watch("name")}
          >
            {t`Create list`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/views/board/components/NewTemplateForm.tsx
================================================
import { useRouter } from "next/navigation";
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { useEffect } from "react";
import { useForm } from "react-hook-form";
import { HiXMark } from "react-icons/hi2";
import { z } from "zod";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

const schema = z.object({
  name: z
    .string()
    .min(1, { message: t`Template name is required` })
    .max(100, { message: t`Template name cannot exceed 100 characters` }),
  workspacePublicId: z.string(),
  sourceBoardPublicId: z.string(),
});

interface NewBoardInputWithTemplate {
  name: string;
  workspacePublicId: string;
  sourceBoardPublicId: string;
}

export function NewTemplateForm({
  sourceBoardPublicId,
  workspacePublicId,
  sourceBoardName,
}: {
  sourceBoardPublicId: string;
  workspacePublicId: string;
  sourceBoardName: string;
}) {
  const router = useRouter();
  const { closeModal } = useModal();
  const { showPopup } = usePopup();

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<NewBoardInputWithTemplate>({
    resolver: zodResolver(schema),
    defaultValues: {
      name: sourceBoardName,
      workspacePublicId,
      sourceBoardPublicId,
    },
  });

  const createBoard = api.board.create.useMutation({
    onSuccess: (newTemplate) => {
      if (!newTemplate) {
        showPopup({
          header: t`Unable to create template`,
          message: t`Please try again later, or contact customer support.`,
          icon: "error",
        });
      } else {
        router.push(`/templates/${newTemplate.publicId}`);
        showPopup({
          header: t`Template created`,
          message: t`Template created successfully`,
          icon: "success",
        });
      }
      closeModal();
    },
    onError: () => {
      showPopup({
        header: t`Unable to create template`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const onSubmit = (data: NewBoardInputWithTemplate) => {
    createBoard.mutate({
      name: data.name,
      workspacePublicId: data.workspacePublicId,
      sourceBoardPublicId: data.sourceBoardPublicId,
      lists: [],
      labels: [],
      type: "template",
    });
  };

  useEffect(() => {
    const titleElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#name");
    if (titleElement) titleElement.focus();
  }, []);

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="text-neutral-9000 flex w-full items-center justify-between pb-4 dark:text-dark-1000">
          <h2 className="text-sm font-bold">{t`New template`}</h2>
          <button
            type="button"
            className="hover:bg-li ght-300 rounded p-1 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="dark:text-dark-9000 text-light-900" />
          </button>
        </div>
        <Input
          id="name"
          placeholder={t`Name`}
          {...register("name", { required: true })}
          errorMessage={errors.name?.message}
          onKeyDown={async (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
          }}
        />
      </div>
      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <div>
          <Button type="submit" isLoading={createBoard.isPending}>
            {t`Create template`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/views/board/components/UpdateBoardSlugButton.tsx
================================================
import { Fragment } from "react";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { HiLink } from "react-icons/hi";

import { Tooltip } from "~/components/Tooltip";
import { usePopup } from "~/providers/popup";

const displayBaseUrl =
  env("NEXT_PUBLIC_KAN_ENV") === "cloud"
    ? "kan.bn"
    : env("NEXT_PUBLIC_BASE_URL");

const linkBaseUrl = env("NEXT_PUBLIC_BASE_URL");

const pathSeparator = (
  <div className="mx-1.5 h-4 w-px rotate-[20deg] bg-gray-300 dark:bg-dark-600" />
);

const UpdateBoardSlugButton = ({
  handleOnClick,
  workspaceSlug,
  boardSlug,
  boardPublicId,
  visibility,
  isLoading,
  canEdit,
}: {
  handleOnClick: () => void;
  workspaceSlug: string;
  boardSlug: string;
  boardPublicId: string;
  visibility: "public" | "private";
  isLoading: boolean;
  canEdit: boolean;
}) => {
  const { showPopup } = usePopup();

  if (isLoading) {
    return (
      <div className="hidden h-[36px] w-[225px] animate-pulse rounded-full bg-light-200 dark:bg-dark-100 xl:flex" />
    );
  }

  if (!workspaceSlug || !boardSlug || !boardPublicId) return <></>;

  const isPublic = visibility === "public";
  const boardUrl = isPublic
    ? `${linkBaseUrl}/${workspaceSlug}/${boardSlug}`
    : `${linkBaseUrl}/boards/${boardPublicId}`;

  const pathSegments = isPublic
    ? [displayBaseUrl, workspaceSlug, boardSlug]
    : [displayBaseUrl, "boards", boardPublicId];

  return (
    <Tooltip
      content={!canEdit ? t`You don't have permission` : undefined}
    >
      <button
        onClick={canEdit ? handleOnClick : undefined}
        disabled={!canEdit || isLoading}
        className="hidden cursor-pointer items-center gap-2 rounded-full border-[1px] bg-light-50 p-1 pl-4 pr-1 text-sm text-light-950 hover:bg-light-100 disabled:cursor-not-allowed disabled:opacity-60 dark:border-dark-600 dark:bg-dark-50 dark:text-dark-900 dark:hover:bg-dark-100 xl:flex"
      >
        <div className="flex items-center">
          {pathSegments.map((segment, i) => (
            <Fragment key={i}>
              {i > 0 && pathSeparator}
              <span>{segment}</span>
            </Fragment>
          ))}
        </div>
        <button
          type="button"
          onClick={(e) => {
            e.stopPropagation();
            navigator.clipboard.writeText(boardUrl).then(
              () =>
                showPopup({
                  header: t`Link copied`,
                  icon: "success",
                  message: t`Board URL copied to clipboard`,
                }),
            ).catch(() => undefined);
          }}
          className="flex h-7 w-7 items-center justify-center rounded-full hover:bg-light-200 dark:hover:bg-dark-200"
          aria-label={t`Copy board link`}
        >
          <HiLink className="h-[13px] w-[13px]" />
        </button>
      </button>
    </Tooltip>
  );
};

export default UpdateBoardSlugButton;



================================================
FILE: apps/web/src/views/board/components/UpdateBoardSlugForm.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useEffect } from "react";
import { useForm } from "react-hook-form";
import { HiCheck, HiXMark } from "react-icons/hi2";
import { z } from "zod";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useDebounce } from "~/hooks/useDebounce";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

interface QueryParams {
  boardPublicId: string;
  members: string[];
  labels: string[];
  lists: string[];
}

export function UpdateBoardSlugForm({
  boardPublicId,
  workspaceSlug,
  boardSlug,
  queryParams,
}: {
  boardPublicId: string;
  workspaceSlug: string;
  boardSlug: string;
  queryParams: QueryParams;
}) {
  const { closeModal } = useModal();
  const { showPopup } = usePopup();
  const utils = api.useUtils();

  const schema = z.object({
    slug: z
      .string()
      .min(3, {
        message: t`Board URL must be at least 3 characters long`,
      })
      .max(60, { message: t`Board URL cannot exceed 60 characters` })
      .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/, {
        message: t`Board URL can only contain letters, numbers, and hyphens`,
      }),
  });

  type FormValues = z.infer<typeof schema>;

  const {
    register,
    handleSubmit,
    formState: { isDirty, errors },
    watch,
  } = useForm<FormValues>({
    resolver: zodResolver(schema),
    values: {
      slug: boardSlug,
    },
    mode: "onChange",
  });

  const slug = watch("slug");

  const [debouncedSlug] = useDebounce(slug, 500);

  const updateBoardSlug = api.board.update.useMutation({
    onError: () => {
      showPopup({
        header: t`Unable to update board URL`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      closeModal();
      await utils.board.byId.invalidate(queryParams);
    },
  });

  const checkBoardSlugAvailability = api.board.checkSlugAvailability.useQuery(
    {
      boardSlug: debouncedSlug,
      boardPublicId,
    },
    {
      enabled: !!debouncedSlug && debouncedSlug !== boardSlug && !errors.slug,
    },
  );

  const isBoardSlugAvailable = checkBoardSlugAvailability.data;

  useEffect(() => {
    const nameElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#board-slug");
    if (nameElement) nameElement.focus();
  }, []);

  const onSubmit = (data: FormValues) => {
    if (!isBoardSlugAvailable) return;
    if (isBoardSlugAvailable.isReserved) return;

    updateBoardSlug.mutate({
      slug: data.slug,
      boardPublicId,
    });
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-4">
          <h2 className="text-sm font-bold text-neutral-900 dark:text-dark-1000">
            {t`Edit board URL`}
          </h2>
          <button
            type="button"
            className="rounded p-1 hover:bg-light-200 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>

        <Input
          id="board-slug"
          {...register("slug")}
          errorMessage={
            errors.slug?.message ||
            (isBoardSlugAvailable?.isReserved
              ? t`This board URL has already been taken`
              : undefined)
          }
          prefix={`${env("NEXT_PUBLIC_KAN_ENV") === "cloud" ? "kan.bn" : env("NEXT_PUBLIC_BASE_URL")}/${workspaceSlug}/`}
          onKeyDown={async (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
          }}
          iconRight={
            !!errors.slug?.message || isBoardSlugAvailable?.isReserved ? (
              <HiXMark className="h-4 w-4 text-red-500" />
            ) : (
              <HiCheck className="h-4 w-4 dark:text-dark-1000" />
            )
          }
        />
      </div>
      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <div className="flex items-center gap-2">
          <Button
            variant="secondary"
            href="/settings/workspace"
            onClick={closeModal}
          >
            {t`Edit workspace URL`}
          </Button>
          <Button
            type="submit"
            isLoading={updateBoardSlug.isPending}
            disabled={
              !isDirty ||
              updateBoardSlug.isPending ||
              errors.slug?.message !== undefined ||
              isBoardSlugAvailable?.isReserved ||
              checkBoardSlugAvailability.isLoading
            }
          >
            {t`Update`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/views/board/components/VisibilityButton.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";
import { HiOutlineEye, HiOutlineEyeSlash } from "react-icons/hi2";

import Button from "~/components/Button";
import CheckboxDropdown from "~/components/CheckboxDropdown";
import { Tooltip } from "~/components/Tooltip";
import { usePermissions } from "~/hooks/usePermissions";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

interface QueryParams {
  boardPublicId: string;
  members: string[];
  labels: string[];
  lists: string[];
}

const VisibilityButton = ({
  visibility,
  boardPublicId,
  queryParams,
  isLoading,
  isAdmin,
}: {
  visibility: "public" | "private";
  boardPublicId: string;
  boardSlug: string;
  queryParams: QueryParams;
  isLoading: boolean;
  isAdmin: boolean;
}) => {
  const { showPopup } = usePopup();
  const { canEditBoard } = usePermissions();
  const utils = api.useUtils();
  const [stateVisibility, setStateVisibility] = useState<"public" | "private">(
    visibility,
  );

  useEffect(() => {
    setStateVisibility(visibility);
  }, [visibility]);

  const isPublic = stateVisibility === "public";

  const updateBoardVisibility = api.board.update.useMutation({
    onSuccess: () => {
      showPopup({
        header: t`Board visibility updated`,
        message: t`The visibility of your board has been set to ${isPublic ? "public" : "private"}.`,
        icon: "success",
      });
    },
    onError: () => {
      showPopup({
        header: t`Unable to update board visibility`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await utils.board.byId.invalidate(queryParams);
    },
  });

  const canEdit = canEditBoard || isAdmin;

  return (
    <div className="relative">
      <Tooltip
        content={
          !canEdit && !isLoading ? t`You don't have permission` : undefined
        }
      >
        <CheckboxDropdown
          items={[
            {
              key: "public",
              value: t`Public`,
              selected: isPublic,
            },
            {
              key: "private",
              value: t`Private`,
              selected: !isPublic,
            },
          ]}
          handleSelect={(_g, i) => {
            if (!canEdit) return;
            setStateVisibility(isPublic ? "private" : "public");
            updateBoardVisibility.mutate({
              visibility: i.key as "public" | "private",
              boardPublicId,
            });
          }}
          menuSpacing="md"
        >
          <Button
            variant="secondary"
            iconLeft={isPublic ? <HiOutlineEye /> : <HiOutlineEyeSlash />}
            disabled={isLoading || !canEdit}
          >
            {t`Visibility`}
          </Button>
        </CheckboxDropdown>
      </Tooltip>
    </div>
  );
};

export default VisibilityButton;



================================================
FILE: apps/web/src/views/boards/index.tsx
================================================
import { t } from "@lingui/core/macro";
import { HiArrowDownTray, HiOutlinePlusSmall } from "react-icons/hi2";

import Button from "~/components/Button";
import FeedbackModal from "~/components/FeedbackModal";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import { Tooltip } from "~/components/Tooltip";
import { usePermissions } from "~/hooks/usePermissions";
import { useKeyboardShortcut } from "~/providers/keyboard-shortcuts";
import { useModal } from "~/providers/modal";
import { useWorkspace } from "~/providers/workspace";
import { BoardsList } from "./components/BoardsList";
import { ImportBoardsForm } from "./components/ImportBoardsForm";
import { NewBoardForm } from "./components/NewBoardForm";

export default function BoardsPage({ isTemplate }: { isTemplate?: boolean }) {
  const { openModal, modalContentType, isOpen } = useModal();
  const { workspace } = useWorkspace();
  const { canCreateBoard } = usePermissions();

  const { tooltipContent: createModalShortcutTooltipContent } =
    useKeyboardShortcut({
      type: "PRESS",
      stroke: { key: "C" },
      action: () => canCreateBoard && openModal("NEW_BOARD"),
      description: t`Create new ${isTemplate ? "template" : "board"}`,
      group: "ACTIONS",
    });

  return (
    <>
      <PageHead
        title={t`${isTemplate ? "Templates" : "Boards"} | ${workspace.name ?? t`Workspace`}`}
      />
      <div className="m-auto h-full max-w-[1100px] p-6 px-5 md:px-28 md:py-12">
        <div className="relative z-10 mb-8 flex w-full items-center justify-between">
          <h1 className="font-bold tracking-tight text-neutral-900 dark:text-dark-1000 sm:text-[1.2rem]">
            {t`${isTemplate ? "Templates" : "Boards"}`}
          </h1>
          <div className="flex gap-2">
            {!isTemplate && (
              <Tooltip
                content={
                  !canCreateBoard ? t`You don't have permission` : undefined
                }
              >
                <Button
                  type="button"
                  variant="secondary"
                  onClick={() => {
                    if (canCreateBoard) openModal("IMPORT_BOARDS");
                  }}
                  disabled={!canCreateBoard}
                  iconLeft={
                    <HiArrowDownTray aria-hidden="true" className="h-4 w-4" />
                  }
                >
                  {t`Import`}
                </Button>
              </Tooltip>
            )}
            <Tooltip
              content={
                !canCreateBoard
                  ? t`You don't have permission`
                  : createModalShortcutTooltipContent
              }
            >
              <Button
                type="button"
                variant="primary"
                onClick={() => {
                  if (canCreateBoard) openModal("NEW_BOARD");
                }}
                disabled={!canCreateBoard}
                iconLeft={
                  <HiOutlinePlusSmall aria-hidden="true" className="h-4 w-4" />
                }
              >
                {t`New`}
              </Button>
            </Tooltip>
          </div>
        </div>

        <>
          <Modal
            modalSize="md"
            isVisible={isOpen && modalContentType === "NEW_FEEDBACK"}
          >
            <FeedbackModal />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "NEW_BOARD"}
          >
            <NewBoardForm isTemplate={!!isTemplate} />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "IMPORT_BOARDS"}
          >
            <ImportBoardsForm />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
          >
            <NewWorkspaceForm />
          </Modal>
        </>

        <div className="flex h-full flex-row">
          <BoardsList isTemplate={!!isTemplate} />
        </div>
      </div>
    </>
  );
}



================================================
FILE: apps/web/src/views/boards/components/BoardsList.tsx
================================================
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { HiOutlineRectangleStack, HiOutlineStar, HiStar } from "react-icons/hi2";
import { motion } from "framer-motion";
import Button from "~/components/Button";
import PatternedBackground from "~/components/PatternedBackground";
import { Tooltip } from "~/components/Tooltip";
import { usePermissions } from "~/hooks/usePermissions";
import { useModal } from "~/providers/modal";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

export function BoardsList({ isTemplate }: { isTemplate?: boolean }) {
  const { workspace } = useWorkspace();
  const { openModal } = useModal();
  const { canCreateBoard } = usePermissions();

  const utils = api.useUtils();
  const updateBoard = api.board.update.useMutation({
    onSuccess: () => {
      void utils.board.all.invalidate();
    },
  });

  const { data, isLoading } = api.board.all.useQuery(
    {
      workspacePublicId: workspace.publicId,
      type: isTemplate ? "template" : "regular",
    },
    { enabled: workspace.publicId ? true : false },
  );

  const handleToggleFavorite = (
    e: React.MouseEvent,
    boardPublicId: string,
    currentFavorite: boolean | undefined
  ) => {
    e.preventDefault();
    e.stopPropagation();
    updateBoard.mutate({
      boardPublicId,
      favorite: !currentFavorite,
    });
  };


  if (isLoading)
    return (
      <div className="3xl:grid-cols-4 grid h-fit w-full grid-cols-1 gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-3">
        <div className="mr-5 flex h-[150px] w-full animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
        <div className="mr-5 flex h-[150px] w-full animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
        <div className="mr-5 flex h-[150px] w-full animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
      </div>
    );

  if (data?.length === 0)
    return (
      <div className="z-10 flex h-full w-full flex-col items-center justify-center space-y-8 pb-[150px]">
        <div className="flex flex-col items-center">
          <HiOutlineRectangleStack className="h-10 w-10 text-light-800 dark:text-dark-800" />
          <p className="mb-2 mt-4 text-[14px] font-bold text-light-1000 dark:text-dark-950">
            {t`No ${isTemplate ? "templates" : "boards"}`}
          </p>
          <p className="text-[14px] text-light-900 dark:text-dark-900">
            {t`Get started by creating a new ${isTemplate ? "template" : "board"}`}
          </p>
        </div>
        <Tooltip
          content={
            !canCreateBoard ? t`You don't have permission` : undefined
          }
        >
          <Button
            onClick={() => {
              if (canCreateBoard) openModal("NEW_BOARD");
            }}
            disabled={!canCreateBoard}
          >
            {t`Create new ${isTemplate ? "template" : "board"}`}
          </Button>
        </Tooltip>
      </div>
    );

  return (
    <motion.div
      className="3xl:grid-cols-4 grid h-fit w-full grid-cols-1 gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-3"
      layout
    >
      {data?.map((board) => (
        <motion.div
          key={board.publicId}
          layout
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{
            layout: {
              type: "spring",
              stiffness: 300,
              damping: 30,
              mass: 1
            },
            opacity: { duration: 0.2 },
            scale: { duration: 0.2 }
          }}
        >
          <Link
            href={`${isTemplate ? "templates" : "boards"}/${board.publicId}`}
          >
            <div className="group relative mr-5 flex h-[150px] w-full items-center justify-center rounded-md border border-dashed border-light-400 bg-light-50 shadow-sm hover:bg-light-200 dark:border-dark-600 dark:bg-dark-50 dark:hover:bg-dark-100">
              <PatternedBackground />
                <button
                  onClick={(e) => handleToggleFavorite(e, board.publicId, board.favorite)}
                  className={`absolute right-3 top-3 z-10 rounded p-1 transition-all hover:bg-light-300 dark:hover:bg-dark-200 ${board.favorite ? "" : "md:opacity-0 md:group-hover:opacity-100"
                    }`}
                  aria-label={board.favorite ? "Remove from favorites" : "Add to favorites"}
                >
                  {board.favorite ? (
                    <HiStar className="h-5 w-5 text-neutral-700 dark:text-dark-1000" />
                  ) : (
                    <HiOutlineStar className="h-5 w-5 text-neutral-700 dark:text-dark-800" />
                  )}
                </button>
              <p className="px-4 text-[14px] font-bold text-neutral-700 dark:text-dark-1000">
                {board.name}
              </p>
            </div>
          </Link>
        </motion.div>
      ))}
    </motion.div>
  );
}



================================================
FILE: apps/web/src/views/boards/components/ImportBoardsForm.tsx
================================================
import Link from "next/link";
import { Listbox, Transition } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { Plural, Trans } from "@lingui/react/macro";
import { Fragment, useEffect, useState } from "react";
import { Controller, useForm } from "react-hook-form";
import { FaTrello } from "react-icons/fa";
import {
  HiChevronUpDown,
  HiMiniArrowTopRightOnSquare,
  HiOutlineQuestionMarkCircle,
  HiXMark,
} from "react-icons/hi2";

import Button from "~/components/Button";
import Toggle from "~/components/Toggle";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

const integrationProviders: Record<
  string,
  { name: string; icon: JSX.Element }
> = {
  trello: {
    name: "Trello",
    icon: <FaTrello />,
  },
};

const SelectSource = ({ handleNextStep }: { handleNextStep: () => void }) => {
  const { data: integrations, refetch: refetchIntegrations } =
    api.integration.providers.useQuery();
  const { control, handleSubmit } = useForm({
    defaultValues: {
      source: integrations?.[0]?.provider ?? "trello",
    },
  });

  const { data: trelloUrl } = api.integration.getAuthorizationUrl.useQuery(
    { provider: "trello" },
    {
      enabled: !integrations?.some(
        (integration) => integration.provider === "trello",
      ),
    },
  );

  const hasIntegrations = integrations && integrations.length > 0;

  useEffect(() => {
    const handleFocus = () => {
      refetchIntegrations();
    };
    window.addEventListener("focus", handleFocus);
    return () => {
      window.removeEventListener("focus", handleFocus);
    };
  }, [refetchIntegrations]);

  const onSubmit = () => {
    if (!hasIntegrations && trelloUrl) {
      window.open(trelloUrl.url, "trello_auth", "height=800,width=600");
    } else {
      handleNextStep();
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5">
        <Controller
          name="source"
          control={control}
          render={({ field }) => (
            <Listbox {...field}>
              {({ open }) => (
                <>
                  <div className="relative">
                    <Listbox.Button className="focus-ring-light-700 block w-full rounded-md border-0 bg-dark-300 bg-white/5 px-4 py-1.5 text-neutral-900 shadow-sm ring-1 ring-inset ring-light-600 focus:ring-2 focus:ring-inset dark:text-dark-1000 dark:ring-dark-700 dark:focus:ring-dark-700 sm:text-sm sm:leading-6">
                      <span className="flex items-center">
                        {integrationProviders[field.value]?.icon}
                        <span className="ml-2 block truncate text-sm">
                          {integrationProviders[field.value]?.name}
                        </span>
                      </span>
                      <span className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
                        <HiChevronUpDown
                          className="h-5 w-5 text-gray-400"
                          aria-hidden="true"
                        />
                      </span>
                    </Listbox.Button>

                    <Transition
                      show={open}
                      as={Fragment}
                      leave="transition ease-in duration-100"
                      leaveFrom="opacity-100"
                      leaveTo="opacity-0"
                    >
                      <Listbox.Options className="absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-light-50 py-1 text-base text-neutral-900 shadow-lg ring-1 ring-light-600 ring-opacity-5 focus:outline-none dark:bg-dark-300 dark:text-dark-1000 sm:text-sm">
                        {hasIntegrations ? (
                          integrations.map((integration, index) => (
                            <Listbox.Option
                              key={`source_${index}`}
                              className="relative cursor-default select-none px-1"
                              value={integration.provider}
                            >
                              <div className="flex items-center rounded-[5px] p-1 hover:bg-light-200 dark:hover:bg-dark-400">
                                {
                                  integrationProviders[integration.provider]
                                    ?.icon
                                }
                                <span className="ml-2 block truncate text-sm font-normal">
                                  {
                                    integrationProviders[integration.provider]
                                      ?.name
                                  }
                                </span>
                              </div>
                            </Listbox.Option>
                          ))
                        ) : (
                          <Listbox.Option
                            key="trello_placeholder"
                            className="font-sm relative cursor-default select-none px-1"
                            value="trello"
                          >
                            <div className="flex items-center rounded-[5px] p-1 text-sm hover:bg-light-200 dark:hover:bg-dark-400">
                              {integrationProviders.trello?.icon}
                              <span className="ml-2 block truncate text-sm">
                                {integrationProviders.trello?.name}
                              </span>
                            </div>
                          </Listbox.Option>
                        )}
                      </Listbox.Options>
                    </Transition>
                  </div>
                </>
              )}
            </Listbox>
          )}
        />
      </div>

      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <div>
          <Button
            type="submit"
            iconRight={
              !hasIntegrations ? <HiMiniArrowTopRightOnSquare /> : undefined
            }
          >
            {hasIntegrations ? t`Select source` : t`Connect Trello`}
          </Button>
        </div>
      </div>
    </form>
  );
};

const ImportTrello: React.FC = () => {
  const utils = api.useUtils();
  const { closeModal } = useModal();
  const { workspace } = useWorkspace();
  const { showPopup } = usePopup();
  const [isSelectAllEnabled, setIsSelectAllEnabled] = useState(false);

  const refetchBoards = () => utils.board.all.refetch();

  const { data: boards, isLoading: boardsLoading } =
    api.import.trello.getBoards.useQuery();

  const {
    register: registerBoards,
    handleSubmit: handleSubmitBoards,
    setValue,
    watch,
  } = useForm({
    defaultValues: Object.fromEntries(
      boards?.map((board) => [board.id, true]) ?? [],
    ),
  });

  const importBoards = api.import.trello.importBoards.useMutation({
    onSuccess: async () => {
      showPopup({
        header: t`Import complete`,
        message: t`Your boards have been imported.`,
        icon: "success",
      });
      try {
        await refetchBoards();
        closeModal();
      } catch (e) {
        console.log(e);
      }
    },
    onError: () => {
      showPopup({
        header: t`Import failed`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const boardWatchers = boards?.map((board) => ({
    id: board.id,
    value: watch(board.id),
  }));

  const boardCount = boardWatchers?.filter((w) => w.value === true).length || 0;

  const onSubmitBoards = (values: Record<string, boolean>) => {
    const boardIds = Object.keys(values).filter((key) => values[key] === true);

    importBoards.mutate({
      boardIds,
      workspacePublicId: workspace.publicId,
    });
  };

  const renderContent = () => {
    if (boardsLoading) {
      return (
        <div className="flex h-full w-full flex-col items-center justify-center gap-1">
          <div className="h-[30px] w-full animate-pulse rounded-[5px] bg-light-200 dark:bg-dark-300" />
          <div className="h-[30px] w-full animate-pulse rounded-[5px] bg-light-200 dark:bg-dark-300" />
          <div className="h-[30px] w-full animate-pulse rounded-[5px] bg-light-200 dark:bg-dark-300" />
        </div>
      );
    }

    if (!boards?.length) {
      return (
        <div className="flex h-full w-full items-center justify-center">
          <p className="text-sm text-neutral-500 dark:text-dark-900">
            {t`No boards found`}
          </p>
        </div>
      );
    }

    return boards.map((board) => (
      <div key={board.id}>
        <label
          className="flex cursor-pointer items-center rounded-[5px] p-2 hover:bg-light-100 dark:hover:bg-dark-300"
          htmlFor={board.id}
        >
          <input
            id={board.id}
            type="checkbox"
            className="h-[14px] w-[14px] rounded bg-transparent ring-0 focus:outline-none focus:ring-0 focus:ring-offset-0"
            {...registerBoards(board.id)}
          />
          <span className="ml-3 text-sm text-neutral-900 dark:text-dark-1000">
            {board.name}
          </span>
        </label>
      </div>
    ));
  };

  return (
    <form onSubmit={handleSubmitBoards(onSubmitBoards)}>
      <div className="h-[105px] overflow-scroll px-5">{renderContent()}</div>

      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <Toggle
          label={t`Select all`}
          isChecked={!!isSelectAllEnabled}
          onChange={() => {
            const newState = !isSelectAllEnabled;
            setIsSelectAllEnabled(newState);

            for (const board of boards || []) {
              setValue(board.id, newState);
            }
          }}
        />
        <div className="space-x-2">
          <Button
            type="submit"
            isLoading={importBoards.isPending}
            disabled={
              importBoards.isPending ||
              boardsLoading ||
              !boards?.length ||
              !boards.some(
                (board) =>
                  boardWatchers?.find((w) => w.id === board.id)?.value === true,
              )
            }
          >
            <Trans>
              <Plural
                value={boardCount}
                one={`Import board (1)`}
                other={`Import boards (${boardCount})`}
              />
            </Trans>
          </Button>
        </div>
      </div>
    </form>
  );
};

export function ImportBoardsForm() {
  const { closeModal } = useModal();
  const [step, setStep] = useState(1);

  return (
    <div>
      <div className="flex w-full items-center justify-between px-5 pb-4 pt-5">
        <div className="flex items-center">
          <h2 className="text-sm font-medium text-neutral-900 dark:text-dark-1000">
            {t`New import`}
          </h2>
          <Link
            href="https://docs.kan.bn/imports/trello"
            target="_blank"
            className="ml-2 text-neutral-500 hover:text-neutral-700 dark:text-dark-900 dark:hover:text-dark-700"
          >
            <HiOutlineQuestionMarkCircle className="h-4.5 w-4.5" />
          </Link>
        </div>

        <button
          type="button"
          className="rounded p-1 hover:bg-light-200 dark:hover:bg-dark-300"
          onClick={() => closeModal()}
        >
          <HiXMark size={18} className="text-dark-900" />
        </button>
      </div>

      {step === 1 && <SelectSource handleNextStep={() => setStep(step + 1)} />}
      {step === 2 && <ImportTrello />}
    </div>
  );
}



================================================
FILE: apps/web/src/views/boards/components/NewBoardForm.tsx
================================================
import { useRouter } from "next/navigation";
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";
import { useForm } from "react-hook-form";
import { HiXMark } from "react-icons/hi2";
import { z } from "zod";

import type { Template } from "./TemplateBoards";
import Button from "~/components/Button";
import Input from "~/components/Input";
import Toggle from "~/components/Toggle";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";
import TemplateBoards from "./TemplateBoards";

const schema = z.object({
  name: z
    .string()
    .min(1, { message: t`Board name is required` })
    .max(100, { message: t`Board name cannot exceed 100 characters` }),
  workspacePublicId: z.string(),
  template: z.custom<Template | null>(),
});

interface NewBoardInputWithTemplate {
  name: string;
  workspacePublicId: string;
  template: Template | null;
}

export function NewBoardForm({ isTemplate }: { isTemplate?: boolean }) {
  const utils = api.useUtils();
  const { closeModal } = useModal();
  const router = useRouter();
  const { showPopup } = usePopup();
  const { workspace } = useWorkspace();
  const [showTemplates, setShowTemplates] = useState(false);
  const { data: templates } = api.board.all.useQuery(
    { workspacePublicId: workspace.publicId ?? "", type: "template" },
    { enabled: !!workspace.publicId },
  );

  const formattedTemplates = templates?.map((template) => ({
    id: template.publicId,
    sourceBoardPublicId: template.publicId,
    name: template.name,
    lists: template.lists.map((list) => list.name),
    labels: template.labels.map((label) => label.name),
  }));

  const {
    register,
    handleSubmit,
    watch,
    setValue,
    formState: { errors },
  } = useForm<NewBoardInputWithTemplate>({
    resolver: zodResolver(schema),
    defaultValues: {
      name: "",
      workspacePublicId: workspace.publicId || "",
      template: null,
    },
  });

  const currentTemplate = watch("template");

  const refetchBoards = () => utils.board.all.refetch();

  const createBoard = api.board.create.useMutation({
    onSuccess: async (board) => {
      if (!board) {
        showPopup({
          header: t`Error`,
          message: t`Failed to create board`,
          icon: "error",
        });
      } else {
        router.push(
          `${isTemplate ? "/templates" : "/boards"}/${board.publicId}`,
        );
      }
      closeModal();

      await refetchBoards();
    },
    onError: () => {
      showPopup({
        header: t`Error`,
        message: t`Failed to create board`,
        icon: "error",
      });
    },
  });

  const onSubmit = (data: NewBoardInputWithTemplate) => {
    createBoard.mutate({
      name: data.name,
      workspacePublicId: data.workspacePublicId,
      sourceBoardPublicId: data.template?.sourceBoardPublicId ?? undefined,
      lists: data.template?.lists ?? [],
      labels: data.template?.labels ?? [],
      type: isTemplate ? "template" : "regular",
    });
  };

  useEffect(() => {
    const titleElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#name");
    if (titleElement) titleElement.focus();
  }, []);

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="text-neutral-9000 flex w-full items-center justify-between pb-4 dark:text-dark-1000">
          <h2 className="text-sm font-bold">{t`New ${isTemplate ? "template" : "board"}`}</h2>
          <button
            type="button"
            className="hover:bg-li ght-300 rounded p-1 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="dark:text-dark-9000 text-light-900" />
          </button>
        </div>
        <Input
          id="name"
          placeholder={t`Name`}
          {...register("name", { required: true })}
          errorMessage={errors.name?.message}
          onKeyDown={async (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
          }}
        />
      </div>
      <TemplateBoards
        currentBoard={currentTemplate}
        setCurrentBoard={(t) => setValue("template", t)}
        showTemplates={showTemplates}
        customTemplates={formattedTemplates ?? []}
      />
      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        {!isTemplate && (
          <Toggle
            label={t`Use template`}
            isChecked={showTemplates}
            onChange={() => {
              setShowTemplates(!showTemplates);
              if (!showTemplates && !currentTemplate) {
                setValue("template", (templates?.[0] as any) ?? null);
              }
            }}
          />
        )}
        <div>
          <Button type="submit" isLoading={createBoard.isPending}>
            {t`Create ${isTemplate ? "template" : "board"}`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/views/boards/components/TemplateBoards.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect, useRef, useState } from "react";
import { HiCheckCircle } from "react-icons/hi2";

export interface Template {
  id: string;
  sourceBoardPublicId?: string;
  name: string;
  lists: string[];
  labels: string[];
}

export const getTemplates = (): Template[] => [
  {
    id: "basic",
    name: t`Basic Kanban`,
    lists: [t`To Do`, t`In Progress`, t`Done`],
    labels: [t`High Priority`, t`Medium Priority`, t`Low Priority`],
  },
  {
    id: "software-dev",
    name: t`Software Development`,
    lists: [t`Backlog`, t`To Do`, t`In Progress`, t`Code Review`, t`Done`],
    labels: [t`Bug`, t`Feature`, t`Enhancement`, t`Critical`, t`Documentation`],
  },
  {
    id: "roadmap-basic",
    name: t`Basic Roadmap`,
    lists: [t`Requested`, t`Planned`, t`In Progress`, t`Done`],
    labels: [t`Feature`, t`Enhancement`, t`Critical`, t`Documentation`],
  },
  {
    id: "roadmap-extended",
    name: t`Extended Roadmap`,
    lists: [t`Requested`, t`Under Review`, t`Planned`, t`In Progress`, t`Done`, t`Rejected`],
    labels: [t`Feature`, t`Enhancement`, t`Critical`, t`Documentation`],
  },
  {
    id: "content-creation",
    name: t`Content Creation`,
    lists: [
      t`Brainstorming`,
      t`Writing`,
      t`Editing`,
      t`Design`,
      t`Approval`,
      t`Publishing`,
      t`Done`,
    ],
    labels: [t`Blog Post`, t`Social Media`, t`Video`, t`Newsletter`, t`Urgent`],
  },
  {
    id: "customer-support",
    name: t`Customer Support`,
    lists: [
      t`New Ticket`,
      t`Triaging`,
      t`In Progress`,
      t`Awaiting Customer`,
      t`Resolution`,
      t`Done`,
    ],
    labels: [
      t`Bug Report`,
      t`Feature Request`,
      t`Question`,
      t`Urgent`,
      t`Billing`,
    ],
  },
  {
    id: "recruitment",
    name: t`Recruitment`,
    lists: [
      t`Applicants`,
      t`Screening`,
      t`Interviewing`,
      t`Offer`,
      t`Onboarding`,
      t`Hired`,
    ],
    labels: [t`Remote`, t`Full-time`, t`Part-time`, t`Senior`, t`Junior`],
  },
  {
    id: "personal-project",
    name: t`Personal Project`,
    lists: [
      t`Ideas`,
      t`Research`,
      t`Planning`,
      t`Execution`,
      t`Review`,
      t`Next Steps`,
      t`Complete`,
    ],
    labels: [t`Important`, t`Quick Win`, t`Long-term`, t`Learning`, t`Fun`],
  },
];

export default function TemplateBoards({
  currentBoard,
  setCurrentBoard,
  showTemplates,
  customTemplates,
}: {
  currentBoard: Template | null;
  setCurrentBoard: (board: Template | null) => void;
  showTemplates: boolean;
  customTemplates: Template[] | null;
}) {
  const [showFade, setShowFade] = useState(false);
  const [showTopFade, setShowTopFade] = useState(false);
  const scrollRef = useRef<HTMLDivElement>(null);

  const templates = [...(customTemplates ?? []), ...getTemplates()];

  const handleScroll = () => {
    if (!scrollRef.current) return;

    const { scrollTop, scrollHeight, clientHeight } = scrollRef.current;
    const isAtBottom = scrollTop + clientHeight >= scrollHeight - 5;
    const isAtTop = scrollTop <= 5;

    setShowFade(!isAtBottom);
    setShowTopFade(!isAtTop);
  };

  useEffect(() => {
    const scrollElement = scrollRef.current;
    if (!scrollElement) return;

    handleScroll();

    scrollElement.addEventListener("scroll", handleScroll);
    return () => scrollElement.removeEventListener("scroll", handleScroll);
  }, [showTemplates]);

  useEffect(() => {
    if (showTemplates && currentBoard && scrollRef.current) {
      const selectedElement = scrollRef.current.querySelector(
        `[data-template-id="${currentBoard.id}"]`,
      );
      if (selectedElement) {
        selectedElement.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    }
  }, [showTemplates, currentBoard]);

  const handleBoardSelect = (boardId: string) => {
    if (currentBoard?.id === boardId) {
      setCurrentBoard(null);
    } else {
      setCurrentBoard(
        templates.find((template) => template.id === boardId) ?? null,
      );
    }
  };

  if (!showTemplates) {
    return null;
  }

  return (
    <div className="px-5 pt-4">
      <div className="relative">
        <div
          ref={scrollRef}
          className="scroll-container -mr-2 flex max-h-[200px] flex-col gap-3 overflow-y-auto pr-2 pt-0.5"
        >
          {templates.map((template) => (
            <label
              key={template.id}
              data-template-id={template.id}
              onClick={() => handleBoardSelect(template.id)}
              className={`scroll-container relative flex cursor-pointer rounded-lg border p-3 transition-all hover:bg-light-100 dark:hover:bg-dark-200 ${
                currentBoard?.id === template.id
                  ? "border-light-700 bg-light-100 ring-1 ring-inset ring-light-700 dark:border-dark-700 dark:bg-dark-200 dark:ring-dark-700"
                  : "border-light-600 dark:border-dark-600"
              }`}
            >
              <div className="flex-1">
                <h4 className="text-sm font-medium text-gray-900 dark:text-gray-100">
                  {template.name}
                </h4>
                <p className="text-xs text-light-950 dark:text-dark-900">
                  {template.lists.join(", ")}
                </p>
              </div>
              {currentBoard?.id === template.id && (
                <div className="absolute right-3 top-3 text-light-1000 dark:text-dark-1000">
                  <HiCheckCircle className="h-5 w-5" />
                </div>
              )}
            </label>
          ))}
        </div>
        {showTopFade && (
          <div className="pointer-events-none absolute left-0 right-0 top-0 h-6 bg-gradient-to-b from-white/80 to-transparent dark:from-dark-100/80" />
        )}
        {showFade && (
          <div className="pointer-events-none absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-white/80 to-transparent dark:from-dark-100/80" />
        )}
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/card/index.tsx
================================================
import Link from "next/link";
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";
import { useForm } from "react-hook-form";
import { IoChevronForwardSharp } from "react-icons/io5";
import { HiXMark } from "react-icons/hi2";

import { authClient } from "@kan/auth/client";

import Avatar from "~/components/Avatar";
import Editor from "~/components/Editor";
import FeedbackModal from "~/components/FeedbackModal";
import { LabelForm } from "~/components/LabelForm";
import LabelIcon from "~/components/LabelIcon";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import { EditYouTubeModal } from "~/components/YouTubeEmbed/EditYouTubeModal";
import { usePermissions } from "~/hooks/usePermissions";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";
import { formatMemberDisplayName, getAvatarUrl } from "~/utils/helpers";
import { DeleteLabelConfirmation } from "../../components/DeleteLabelConfirmation";
import ActivityList from "./components/ActivityList";
import { AttachmentThumbnails } from "./components/AttachmentThumbnails";
import { AttachmentUpload } from "./components/AttachmentUpload";
import Checklists from "./components/Checklists";
import { DeleteCardConfirmation } from "./components/DeleteCardConfirmation";
import { DeleteChecklistConfirmation } from "./components/DeleteChecklistConfirmation";
import { DeleteCommentConfirmation } from "./components/DeleteCommentConfirmation";
import Dropdown from "./components/Dropdown";
import { DueDateSelector } from "./components/DueDateSelector";
import LabelSelector from "./components/LabelSelector";
import ListSelector from "./components/ListSelector";
import MemberSelector from "./components/MemberSelector";
import { NewChecklistForm } from "./components/NewChecklistForm";
import NewCommentForm from "./components/NewCommentForm";

interface FormValues {
  cardId: string;
  title: string;
  description: string;
}

export function CardRightPanel({ isTemplate }: { isTemplate?: boolean }) {
  const router = useRouter();
  const { canEditCard } = usePermissions();
  const { data: session } = authClient.useSession();
  const cardId = Array.isArray(router.query.cardId)
    ? router.query.cardId[0]
    : router.query.cardId;

  const { data: card } = api.card.byId.useQuery(
    { cardPublicId: cardId ?? "" },
    { enabled: !!cardId && cardId.length >= 12 },
  );

  const isCreator = card?.createdBy && session?.user.id === card.createdBy;
  const canEdit = canEditCard || isCreator;

  const board = card?.list.board;
  const labels = board?.labels;
  const workspaceMembers = board?.workspace.members;
  const selectedLabels = card?.labels;
  const selectedMembers = card?.members;

  const formattedLabels =
    labels?.map((label) => {
      const isSelected = selectedLabels?.some(
        (selectedLabel) => selectedLabel.publicId === label.publicId,
      );

      return {
        key: label.publicId,
        value: label.name,
        selected: isSelected ?? false,
        leftIcon: <LabelIcon colourCode={label.colourCode} />,
      };
    }) ?? [];

  const formattedLists =
    board?.lists.map((list) => ({
      key: list.publicId,
      value: list.name,
      selected: list.publicId === card?.list.publicId,
    })) ?? [];

  const formattedMembers =
    workspaceMembers?.map((member) => {
      const isSelected = selectedMembers?.some(
        (assignedMember) => assignedMember.publicId === member.publicId,
      );

      return {
        key: member.publicId,
        value: formatMemberDisplayName(
          member.user?.name ?? null,
          member.user?.email ?? member.email,
        ),
        imageUrl: member.user?.image
          ? getAvatarUrl(member.user.image)
          : undefined,
        selected: isSelected ?? false,
        leftIcon: (
          <Avatar
            size="xs"
            name={member.user?.name ?? ""}
            imageUrl={
              member.user?.image ? getAvatarUrl(member.user.image) : undefined
            }
            email={member.user?.email ?? member.email}
          />
        ),
      };
    }) ?? [];

  return (
    <div className="h-full w-[360px] border-l-[1px] border-light-300 bg-light-50 p-8 text-light-900 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900">
      <div className="mb-4 flex w-full flex-row pt-[18px]">
        <p className="my-2 mb-2 w-[100px] text-sm font-medium">{t`List`}</p>
        <ListSelector
          cardPublicId={cardId ?? ""}
          lists={formattedLists}
          isLoading={!card}
          disabled={!canEdit}
        />
      </div>
      <div className="mb-4 flex w-full flex-row">
        <p className="my-2 mb-2 w-[100px] text-sm font-medium">{t`Labels`}</p>
        <LabelSelector
          cardPublicId={cardId ?? ""}
          labels={formattedLabels}
          isLoading={!card}
          disabled={!canEdit}
        />
      </div>
      {!isTemplate && (
        <div className="mb-4 flex w-full flex-row">
          <p className="my-2 mb-2 w-[100px] text-sm font-medium">{t`Members`}</p>
          <MemberSelector
            cardPublicId={cardId ?? ""}
            members={formattedMembers}
            isLoading={!card}
            disabled={!canEdit}
          />
        </div>
      )}
      <div className="mb-4 flex w-full flex-row">
        <p className="my-2 mb-2 w-[100px] text-sm font-medium">{t`Due date`}</p>
        <DueDateSelector
          cardPublicId={cardId ?? ""}
          dueDate={card?.dueDate}
          isLoading={!card}
          disabled={!canEdit}
        />
      </div>
    </div>
  );
}

export default function CardPage({ isTemplate }: { isTemplate?: boolean }) {
  const router = useRouter();
  const utils = api.useUtils();
  const {
    modalContentType,
    entityId,
    getModalState,
    clearModalState,
    isOpen,
    modalStates,
  } = useModal();
  const { showPopup } = usePopup();
  const { workspace } = useWorkspace();
  const { canEditCard } = usePermissions();
  const { data: session } = authClient.useSession();
  const [activeChecklistForm, setActiveChecklistForm] = useState<string | null>(
    null,
  );

  const cardId = Array.isArray(router.query.cardId)
    ? router.query.cardId[0]
    : router.query.cardId;

  const { data: card, isLoading } = api.card.byId.useQuery(
    { cardPublicId: cardId ?? "" },
    { enabled: !!cardId && cardId.length >= 12 },
  );

  const isCreator = card?.createdBy && session?.user.id === card.createdBy;
  const canEdit = canEditCard || isCreator;

  const refetchCard = async () => {
    if (cardId) await utils.card.byId.refetch({ cardPublicId: cardId });
  };

  const board = card?.list.board;
  const workspaceMembers = board?.workspace.members;
  const boardId = board?.publicId;

  const editorWorkspaceMembers =
    workspaceMembers
      ?.filter((member) => member.email)
      .map((member) => ({
        publicId: member.publicId,
        email: member.email,
        user: member.user
          ? {
              id: member.user.id,
              name: member.user.name ?? null,
              image: member.user.image ?? null,
            }
          : null,
      })) ?? [];

  const updateCard = api.card.update.useMutation({
    onError: () => {
      showPopup({
        header: t`Unable to update card`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      if (cardId) await invalidateCard(utils, cardId);
    },
  });

  const addOrRemoveLabel = api.card.addOrRemoveLabel.useMutation({
    onError: () => {
      showPopup({
        header: t`Unable to add label`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      if (cardId) {
        await utils.card.byId.invalidate({ cardPublicId: cardId });
      }
    },
  });

  const { register, handleSubmit, setValue, watch } = useForm<FormValues>({
    values: {
      cardId: cardId ?? "",
      title: card?.title ?? "",
      description: card?.description ?? "",
    },
  });

  const onSubmit = (values: FormValues) => {
    updateCard.mutate({
      cardPublicId: values.cardId,
      title: values.title,
      description: values.description,
    });
  };

  // this adds the new created label to selected labels
  useEffect(() => {
    const newLabelId = modalStates.NEW_LABEL_CREATED;
    if (newLabelId && cardId) {
      const isAlreadyAdded = card?.labels.some(
        (label) => label.publicId === newLabelId,
      );

      if (!isAlreadyAdded) {
        addOrRemoveLabel.mutate({
          cardPublicId: cardId,
          labelPublicId: newLabelId,
        });
      }
      clearModalState("NEW_LABEL_CREATED");
    }
  }, [modalStates.NEW_LABEL_CREATED, card, cardId]);

  // Open the new item form after creating a new checklist
  useEffect(() => {
    if (!card) return;
    const state = getModalState("ADD_CHECKLIST");
    const createdId: string | undefined = state?.createdChecklistId;
    if (createdId) {
      setActiveChecklistForm(createdId);
      clearModalState("ADD_CHECKLIST");
    }
  }, [card, getModalState, clearModalState]);

  // Auto-resize title textarea
  useEffect(() => {
    const titleTextarea = document.getElementById(
      "title",
    ) as HTMLTextAreaElement;
    if (titleTextarea) {
      titleTextarea.style.height = "auto";
      titleTextarea.style.height = `${titleTextarea.scrollHeight}px`;
    }
  }, [card]);

  if (!cardId) return <></>;


  return (
    <>
      <PageHead
        title={t`${card?.title ?? t`Card`} | ${board?.name ?? t`Board`}`}
      />
      <div className="flex h-full flex-1 flex-col overflow-hidden">
        {/* Full-width top strip with board link and dropdown */}
        <div className="flex w-full items-center justify-between border-b-[1px] border-light-300 bg-light-50 px-8 py-2 dark:border-dark-300 dark:bg-dark-50">
          {!card && isLoading && (
            <div className="flex space-x-2">
              <div className="h-[1.5rem] w-[150px] animate-pulse rounded-[5px] bg-light-300 dark:bg-dark-300" />
            </div>
          )}
          {card && (
            <>
              <div className="flex items-center gap-1">
                <Link
                  className="whitespace-nowrapleading-[1.5rem] text-sm font-bold text-light-900 dark:text-dark-950"
                  href={`${isTemplate ? "/templates" : "/boards"}`}
                >
                  {workspace.name}
                </Link>
                <IoChevronForwardSharp className="h-[10px] w-[10px] text-light-900 dark:text-dark-900" />
                <Link
                  className="whitespace-nowrap text-sm font-bold leading-[1.5rem] text-light-900 dark:text-dark-950"
                  href={`${isTemplate ? "/templates" : "/boards"}/${board?.publicId}`}
                >
                  {board?.name}
                </Link>
              </div>
              <div className="flex items-center gap-2">
                <Dropdown
                  cardPublicId={cardId}
                  isTemplate={isTemplate}
                  boardPublicId={boardId}
                  cardCreatedBy={card?.createdBy}
                />
                <Link
                  href={`/${isTemplate ? "templates" : "boards"}/${boardId}`}
                  className="flex h-7 w-7 items-center justify-center rounded-[5px] text-light-900 hover:bg-light-200 dark:text-dark-900 dark:hover:bg-dark-200"
                  aria-label={t`Close`}
                >
                  <HiXMark className="h-5 w-5" />
                </Link>
              </div>
            </>
          )}
          {!card && !isLoading && (
            <p className="block p-0 py-0 font-bold leading-[1.5rem] tracking-tight text-light-900 dark:text-dark-900 sm:text-[1rem]">
              {t`Card not found`}
            </p>
          )}
        </div>
        <div className="scrollbar-thumb-rounded-[4px] scrollbar-track-rounded-[4px] w-full flex-1 overflow-y-auto scrollbar scrollbar-track-light-200 scrollbar-thumb-light-400 hover:scrollbar-thumb-light-400 dark:scrollbar-track-dark-100 dark:scrollbar-thumb-dark-300 dark:hover:scrollbar-thumb-dark-300">
          <div className="p-auto mx-auto flex h-full w-full max-w-[800px] flex-col">
            <div className="p-6 md:p-8">
              <div className="mb-8 md:mt-4">
                {!card && isLoading && (
                  <div className="flex space-x-2">
                    <div className="h-[2.3rem] w-[300px] animate-pulse rounded-[5px] bg-light-300 dark:bg-dark-300" />
                  </div>
                )}
                {card && (
                  <form
                    onSubmit={handleSubmit(onSubmit)}
                    className="w-full space-y-6"
                  >
                    <div>
                      <textarea
                        id="title"
                        {...register("title")}
                        onBlur={canEdit ? handleSubmit(onSubmit) : undefined}
                        rows={1}
                        disabled={!canEdit}
                        className={`block w-full resize-none overflow-hidden border-0 bg-transparent p-0 py-0 font-bold leading-relaxed text-neutral-900 focus:ring-0 dark:text-dark-1000 sm:text-[1.2rem] ${!canEdit ? "cursor-default" : ""}`}
                        onInput={(e) => {
                          const target = e.target as HTMLTextAreaElement;
                          target.style.height = "auto";
                          target.style.height = `${target.scrollHeight}px`;
                        }}
                      />
                    </div>
                  </form>
                )}
                {!card && !isLoading && (
                  <p className="block p-0 py-0 font-bold leading-[2.3rem] tracking-tight text-neutral-900 dark:text-dark-1000 sm:text-[1.2rem]">
                    {t`Card not found`}
                  </p>
                )}
              </div>
              {card && (
                <>
                  <div className="mb-10 flex w-full max-w-2xl flex-col justify-between">
                    <form
                      onSubmit={handleSubmit(onSubmit)}
                      className="w-full space-y-6"
                    >
                      <div className="mt-2">
                        <Editor
                          content={card.description}
                          onChange={
                            canEdit
                              ? (e) => setValue("description", e)
                              : undefined
                          }
                          onBlur={
                            canEdit ? () => handleSubmit(onSubmit)() : undefined
                          }
                          workspaceMembers={workspaceMembers ?? []}
                          readOnly={!canEdit}
                        />
                      </div>
                    </form>
                  </div>
                  <Checklists
                    checklists={card.checklists}
                    cardPublicId={cardId}
                    activeChecklistForm={activeChecklistForm}
                    setActiveChecklistForm={setActiveChecklistForm}
                    viewOnly={!canEdit}
                  />
                  {!isTemplate && (
                    <>
                      {card?.attachments.length > 0 && (
                        <div className="mt-6">
                          <AttachmentThumbnails
                            attachments={card.attachments}
                            cardPublicId={cardId ?? ""}
                            isReadOnly={!canEdit}
                          />
                        </div>
                      )}
                      {canEdit && (
                        <div className="mt-6">
                          <AttachmentUpload cardPublicId={cardId} />
                        </div>
                      )}
                    </>
                  )}
                  <div className="border-t-[1px] border-light-300 pt-12 dark:border-dark-300">
                    <h2 className="text-md pb-4 font-medium text-light-1000 dark:text-dark-1000">
                      {t`Activity`}
                    </h2>
                    <div>
                      <ActivityList
                        cardPublicId={cardId}
                        isLoading={!card}
                        isAdmin={workspace.role === "admin"}
                      />
                    </div>
                    {!isTemplate && (
                      <div className="mt-6">
                        <NewCommentForm
                          cardPublicId={cardId}
                          workspaceMembers={editorWorkspaceMembers}
                        />
                      </div>
                    )}
                  </div>
                </>
              )}
            </div>
          </div>
        </div>

        <>
          <Modal
            modalSize="md"
            isVisible={isOpen && modalContentType === "NEW_FEEDBACK"}
          >
            <FeedbackModal />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "NEW_LABEL"}
          >
            <LabelForm boardPublicId={boardId ?? ""} refetch={refetchCard} />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "EDIT_LABEL"}
          >
            <LabelForm
              boardPublicId={boardId ?? ""}
              refetch={refetchCard}
              isEdit
            />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "DELETE_LABEL"}
          >
            <DeleteLabelConfirmation
              refetch={refetchCard}
              labelPublicId={entityId}
            />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "DELETE_CARD"}
          >
            <DeleteCardConfirmation
              boardPublicId={boardId ?? ""}
              cardPublicId={cardId}
            />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "DELETE_COMMENT"}
          >
            <DeleteCommentConfirmation
              cardPublicId={cardId}
              commentPublicId={entityId}
            />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
          >
            <NewWorkspaceForm />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "ADD_CHECKLIST"}
          >
            <NewChecklistForm cardPublicId={cardId} />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "DELETE_CHECKLIST"}
          >
            <DeleteChecklistConfirmation
              cardPublicId={cardId}
              checklistPublicId={entityId}
            />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "EDIT_YOUTUBE"}
          >
            <EditYouTubeModal />
          </Modal>
        </>
      </div>
    </>
  );
}



================================================
FILE: apps/web/src/views/card/components/ActivityList.tsx
================================================
import type { Locale as DateFnsLocale } from "date-fns";
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";
import { format, formatDistanceToNow, isSameYear } from "date-fns";
import { useEffect, useRef, useState } from "react";
import {
  HiOutlineArrowLeft,
  HiOutlineArrowRight,
  HiOutlineCheckCircle,
  HiOutlineClock,
  HiOutlinePaperClip,
  HiOutlinePencil,
  HiOutlinePlus,
  HiOutlineTag,
  HiOutlineTrash,
  HiOutlineUserMinus,
  HiOutlineUserPlus,
} from "react-icons/hi2";

import type {
  GetCardActivitiesOutput,
  GetCardByIdOutput,
} from "@kan/api/types";
import { authClient } from "@kan/auth/client";

import Avatar from "~/components/Avatar";
import { useLocalisation } from "~/hooks/useLocalisation";
import { api } from "~/utils/api";
import { getAvatarUrl } from "~/utils/helpers";
import Comment from "./Comment";

type ActivityType =
  NonNullable<GetCardByIdOutput>["activities"][number]["type"];

type ActivityWithMergedLabels =
  GetCardActivitiesOutput["activities"][number] & {
    mergedLabels?: string[];
    attachment?: {
      publicId: string;
      filename: string;
      originalFilename: string;
    } | null;
  };

const truncate = (value: string | null, maxLength = 50) => {
  if (!value) return value;
  return value.length > maxLength ? `${value.slice(0, maxLength - 1)}â€¦` : value;
};

const getUserDisplayName = (
  user: { name?: string | null; email?: string | null } | null | undefined,
): string => {
  if (user?.name?.trim()) return user.name;
  if (user?.email) return user.email;
  return t`Member`;
};

const getActivityText = ({
  type,
  toTitle,
  fromList,
  toList,
  memberName,
  memberEmail,
  isSelf,
  label,
  fromTitle,
  toDueDate,
  dateLocale,
  mergedLabels,
  attachmentName,
}: {
  type: ActivityType;
  toTitle: string | null;
  fromList: string | null;
  toList: string | null;
  memberName: string | null;
  memberEmail: string | null;
  isSelf: boolean;
  label: string | null;
  fromTitle?: string | null;
  fromDueDate?: Date | null;
  toDueDate?: Date | null;
  dateLocale: DateFnsLocale;
  mergedLabels?: string[];
  attachmentName?: string | null;
}) => {
  const displayName = memberName ?? memberEmail ?? t`Member`;
  const TextHighlight = ({ children }: { children: React.ReactNode }) => (
    <span className="font-medium text-light-1000 dark:text-dark-1000">
      {children}
    </span>
  );

  if (
    type === "card.updated.label.added" &&
    mergedLabels &&
    mergedLabels.length > 1
  ) {
    const labelList = mergedLabels.join(", ");
    return (
      <Trans>
        added {mergedLabels.length} labels:{" "}
        <TextHighlight>{labelList}</TextHighlight>
      </Trans>
    );
  }

  if (
    type === "card.updated.label.removed" &&
    mergedLabels &&
    mergedLabels.length > 1
  ) {
    const labelList = mergedLabels.join(", ");
    return (
      <Trans>
        removed {mergedLabels.length} labels:{" "}
        <TextHighlight>{labelList}</TextHighlight>
      </Trans>
    );
  }

  const ACTIVITY_TYPE_MAP = {
    "card.created": t`created the card`,
    "card.updated.title": t`updated the title`,
    "card.updated.description": t`updated the description`,
    "card.updated.list": t`moved the card to another list`,
    "card.updated.label.added": t`added a label to the card`,
    "card.updated.label.removed": t`removed a label from the card`,
    "card.updated.member.added": t`added a member to the card`,
    "card.updated.member.removed": t`removed a member from the card`,
    "card.updated.checklist.added": t`added a checklist`,
    "card.updated.checklist.renamed": t`renamed a checklist`,
    "card.updated.checklist.deleted": t`deleted a checklist`,
    "card.updated.checklist.item.added": t`added a checklist item`,
    "card.updated.checklist.item.updated": t`updated a checklist item`,
    "card.updated.checklist.item.completed": t`completed a checklist item`,
    "card.updated.checklist.item.uncompleted": t`marked a checklist item as incomplete`,
    "card.updated.checklist.item.deleted": t`deleted a checklist item`,
    "card.updated.attachment.added": t`added an attachment`,
    "card.updated.attachment.removed": t`removed an attachment`,
    "card.updated.dueDate.added": t`set the due date`,
    "card.updated.dueDate.updated": t`updated the due date`,
    "card.updated.dueDate.removed": t`removed the due date`,
  } as const;

  if (!(type in ACTIVITY_TYPE_MAP)) return null;
  const baseText = ACTIVITY_TYPE_MAP[type as keyof typeof ACTIVITY_TYPE_MAP];

  if (type === "card.updated.title" && toTitle) {
    return (
      <Trans>
        updated the title to <TextHighlight>{truncate(toTitle)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.list" && fromList && toList) {
    return (
      <Trans>
        moved the card from <TextHighlight>{truncate(fromList)}</TextHighlight>{" "}
        to
        <TextHighlight>{truncate(toList)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.member.added" && displayName) {
    if (isSelf) return <Trans>self-assigned the card</Trans>;

    return (
      <Trans>
        assigned <TextHighlight>{truncate(displayName)}</TextHighlight> to the
        card
      </Trans>
    );
  }

  if (type === "card.updated.member.removed" && displayName) {
    if (isSelf) return <Trans>unassigned themselves from the card</Trans>;

    return (
      <Trans>
        unassigned <TextHighlight>{truncate(displayName)}</TextHighlight> from
        the card
      </Trans>
    );
  }

  if (type === "card.updated.label.added" && label) {
    return (
      <Trans>
        added label <TextHighlight>{truncate(label)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.label.removed" && label) {
    return (
      <Trans>
        removed label <TextHighlight>{truncate(label)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.checklist.added" && toTitle) {
    return (
      <Trans>
        added checklist <TextHighlight>{truncate(toTitle)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.checklist.renamed" && toTitle) {
    return (
      <Trans>
        renamed checklist <TextHighlight>{truncate(toTitle)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.checklist.deleted" && fromTitle) {
    return (
      <Trans>
        deleted checklist <TextHighlight>{truncate(fromTitle)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.checklist.item.added" && toTitle) {
    return (
      <Trans>
        added checklist item <TextHighlight>{truncate(toTitle)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.checklist.item.updated" && toTitle) {
    return (
      <Trans>
        renamed checklist item to{" "}
        <TextHighlight>{truncate(toTitle)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.checklist.item.completed" && toTitle) {
    return (
      <Trans>
        completed checklist item{" "}
        <TextHighlight>{truncate(toTitle)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.checklist.item.uncompleted" && toTitle) {
    return (
      <Trans>
        marked checklist item <TextHighlight>{truncate(toTitle)}</TextHighlight>{" "}
        as incomplete
      </Trans>
    );
  }

  if (type === "card.updated.checklist.item.deleted" && fromTitle) {
    return (
      <Trans>
        deleted checklist item{" "}
        <TextHighlight>{truncate(fromTitle)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.attachment.added") {
    const filename = attachmentName ?? toTitle;
    if (!filename) return baseText;
    return (
      <Trans>
        added an attachment <TextHighlight>{truncate(filename)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.attachment.removed") {
    const filename = attachmentName ?? fromTitle;
    if (!filename) return baseText;
    return (
      <Trans>
        removed an attachment{" "}
        <TextHighlight>{truncate(filename)}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.dueDate.added" && toDueDate) {
    const showYear = !isSameYear(toDueDate, new Date());
    const formattedDate = format(
      toDueDate,
      showYear ? "do MMM yyyy" : "do MMM",
      { locale: dateLocale },
    );
    return (
      <Trans>
        changed the due date to <TextHighlight>{formattedDate}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.dueDate.updated" && toDueDate) {
    const showYear = !isSameYear(toDueDate, new Date());
    const formattedDate = format(
      toDueDate,
      showYear ? "do MMM yyyy" : "do MMM",
      { locale: dateLocale },
    );
    return (
      <Trans>
        changed the due date to <TextHighlight>{formattedDate}</TextHighlight>
      </Trans>
    );
  }

  if (type === "card.updated.dueDate.removed") {
    return <Trans>removed the due date</Trans>;
  }

  return baseText;
};

const ACTIVITY_ICON_MAP: Partial<Record<ActivityType, React.ReactNode | null>> =
  {
    "card.created": <HiOutlinePlus />,
    "card.updated.title": <HiOutlinePencil />,
    "card.updated.description": <HiOutlinePencil />,
    "card.updated.label.added": <HiOutlineTag />,
    "card.updated.label.removed": <HiOutlineTag />,
    "card.updated.member.added": <HiOutlineUserPlus />,
    "card.updated.member.removed": <HiOutlineUserMinus />,
    "card.updated.checklist.added": <HiOutlinePlus />,
    "card.updated.checklist.renamed": <HiOutlinePencil />,
    "card.updated.checklist.deleted": <HiOutlineTrash />,
    "card.updated.checklist.item.added": <HiOutlinePlus />,
    "card.updated.checklist.item.updated": <HiOutlinePencil />,
    "card.updated.checklist.item.completed": <HiOutlineCheckCircle />,
    "card.updated.checklist.item.uncompleted": <HiOutlineCheckCircle />,
    "card.updated.checklist.item.deleted": <HiOutlineTrash />,
    "card.updated.attachment.added": <HiOutlinePaperClip />,
    "card.updated.attachment.removed": <HiOutlinePaperClip />,
    "card.updated.dueDate.added": <HiOutlineClock />,
    "card.updated.dueDate.updated": <HiOutlineClock />,
    "card.updated.dueDate.removed": <HiOutlineClock />,
  } as const;

const getActivityIcon = (
  type: ActivityType,
  fromIndex?: number | null,
  toIndex?: number | null,
): React.ReactNode | null => {
  if (type === "card.updated.list" && fromIndex != null && toIndex != null) {
    return fromIndex > toIndex ? (
      <HiOutlineArrowLeft />
    ) : (
      <HiOutlineArrowRight />
    );
  }
  return ACTIVITY_ICON_MAP[type] ?? null;
};

const ACTIVITIES_PAGE_SIZE = 20;

const ActivityList = ({
  cardPublicId,
  isLoading: cardIsLoading,
  isAdmin,
  isViewOnly,
}: {
  cardPublicId: string;
  isLoading: boolean;
  isAdmin?: boolean;
  isViewOnly?: boolean;
}) => {
  const { dateLocale } = useLocalisation();
  const { data: sessionData } = authClient.useSession();
  const utils = api.useUtils();
  const [allActivities, setAllActivities] = useState<
    GetCardActivitiesOutput["activities"]
  >([]);
  const [hasMore, setHasMore] = useState(true);
  const [isLoadingMore, setIsLoadingMore] = useState(false);

  const isFullyExpandedRef = useRef(false);
  const lastDataUpdatedAtRef = useRef<number | null>(null);

  const {
    data: firstPageData,
    isFetching: isFetchingFirst,
    dataUpdatedAt,
  } = api.card.getActivities.useQuery(
    {
      cardPublicId,
      limit: ACTIVITIES_PAGE_SIZE,
    },
    {
      enabled: !!cardPublicId && cardPublicId.length >= 12,
    },
  );

  useEffect(() => {
    if (firstPageData && dataUpdatedAt !== lastDataUpdatedAtRef.current) {
      lastDataUpdatedAtRef.current = dataUpdatedAt;

      if (isFullyExpandedRef.current && firstPageData.hasMore) {
        setAllActivities(firstPageData.activities);
        setHasMore(firstPageData.hasMore);

        const fetchAllRemaining = async () => {
          let currentActivities = [...firstPageData.activities];
          let currentHasMore = firstPageData.hasMore;

          while (currentHasMore) {
            const lastActivity =
              currentActivities[currentActivities.length - 1];
            if (!lastActivity) break;

            const nextCursor = new Date(lastActivity.createdAt).toISOString();
            const nextPage = await utils.card.getActivities.fetch({
              cardPublicId,
              limit: ACTIVITIES_PAGE_SIZE,
              cursor: nextCursor,
            });

            const existingIds = new Set(
              currentActivities.map((a) => a.publicId),
            );
            const newActivities = nextPage.activities.filter(
              (a: { publicId: string }) => !existingIds.has(a.publicId),
            );
            currentActivities = [...currentActivities, ...newActivities];
            currentHasMore = nextPage.hasMore;
          }

          setAllActivities(currentActivities);
          setHasMore(false);
        };

        void fetchAllRemaining();
      } else {
        setAllActivities(firstPageData.activities);
        setHasMore(firstPageData.hasMore);

        if (!firstPageData.hasMore) {
          isFullyExpandedRef.current = true;
        }
      }
    }
  }, [firstPageData, dataUpdatedAt, cardPublicId, utils.card.getActivities]);

  const handleLoadMore = async () => {
    if (isLoadingMore || !hasMore || allActivities.length === 0) return;

    const lastActivity = allActivities[allActivities.length - 1];
    if (!lastActivity) return;

    setIsLoadingMore(true);
    try {
      const nextCursor = new Date(lastActivity.createdAt).toISOString();
      const nextPage = await utils.card.getActivities.fetch({
        cardPublicId,
        limit: ACTIVITIES_PAGE_SIZE,
        cursor: nextCursor,
      });

      const existingIds = new Set(allActivities.map((a) => a.publicId));
      const newActivities = nextPage.activities.filter(
        (a: { publicId: string }) => !existingIds.has(a.publicId),
      );
      setAllActivities((prev) => [...prev, ...newActivities]);
      setHasMore(nextPage.hasMore);

      if (!nextPage.hasMore) {
        isFullyExpandedRef.current = true;
      }
    } finally {
      setIsLoadingMore(false);
    }
  };

  const isFetching = isFetchingFirst || isLoadingMore;
  const isLoading =
    cardIsLoading || (isFetchingFirst && allActivities.length === 0);

  return (
    <div className="flex flex-col space-y-4 pt-4">
      {allActivities.map((activity, index) => {
        const activityText = getActivityText({
          type: activity.type,
          toTitle: activity.toTitle,
          fromList: activity.fromList?.name ?? null,
          toList: activity.toList?.name ?? null,
          memberName: activity.member?.user?.name ?? null,
          memberEmail: activity.member?.user?.email ?? null,
          isSelf: activity.member?.user?.id === sessionData?.user.id,
          label: activity.label?.name ?? null,
          fromTitle: activity.fromTitle ?? null,
          fromDueDate: activity.fromDueDate ?? null,
          toDueDate: activity.toDueDate ?? null,
          dateLocale: dateLocale,
          mergedLabels: (activity as ActivityWithMergedLabels).mergedLabels,
          attachmentName:
            (activity as ActivityWithMergedLabels).attachment?.originalFilename ??
            null,
        });

        if (activity.type === "card.updated.comment.added")
          return (
            <Comment
              key={activity.publicId}
              publicId={activity.comment?.publicId}
              cardPublicId={cardPublicId}
              name={activity.user?.name ?? ""}
              email={activity.user?.email ?? ""}
              image={activity.user?.image ?? null}
              isLoading={isLoading}
              createdAt={activity.createdAt.toISOString()}
              comment={activity.comment?.comment}
              isEdited={!!activity.comment?.updatedAt}
              isAuthor={activity.comment?.createdBy === sessionData?.user.id}
              isAdmin={isAdmin ?? false}
              isViewOnly={!!isViewOnly}
            />
          );

        if (!activityText) return null;

        return (
          <div
            key={activity.publicId}
            className="relative flex items-center space-x-2"
          >
            <div className="relative">
              <Avatar
                size="sm"
                name={activity.user?.name ?? ""}
                email={activity.user?.email ?? ""}
                imageUrl={getAvatarUrl(activity.user?.image ?? null) || undefined}
                icon={getActivityIcon(
                  activity.type,
                  activity.fromList?.index,
                  activity.toList?.index,
                )}
                isLoading={isLoading}
              />
              {index !== allActivities.length - 1 && (
                <div className="absolute bottom-[-14px] left-1/2 top-[30px] w-0.5 -translate-x-1/2 bg-light-600 dark:bg-dark-600" />
              )}
            </div>
            <p className="text-sm">
              <span className="font-medium dark:text-dark-1000">{`${getUserDisplayName(activity.user)} `}</span>
              <span className="space-x-1 text-light-900 dark:text-dark-800">
                {activityText}
              </span>
              <span className="mx-1 text-light-900 dark:text-dark-800">Â·</span>
              <span className="space-x-1 text-light-900 dark:text-dark-800">
                {formatDistanceToNow(new Date(activity.createdAt), {
                  addSuffix: true,
                  locale: dateLocale,
                })}
              </span>
            </p>
          </div>
        );
      })}
      {hasMore && (
        <div className="flex justify-center pt-4">
          <button
            onClick={handleLoadMore}
            disabled={isFetching}
            className="text-sm font-medium text-light-900 hover:text-light-1000 disabled:opacity-50 dark:text-dark-800 dark:hover:text-dark-1000"
          >
            {isFetching ? t`Loading...` : t`Load more activities`}
          </button>
        </div>
      )}
    </div>
  );
};

export default ActivityList;



================================================
FILE: apps/web/src/views/card/components/AttachmentThumbnails.tsx
================================================
import Image from "next/image";
import { Dialog, Transition } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { Fragment, useEffect, useState } from "react";
import {
  HiArrowDownTray,
  HiChevronLeft,
  HiChevronRight,
  HiDocumentText,
  HiOutlineTrash,
  HiXMark,
} from "react-icons/hi2";

import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface Attachment {
  publicId: string;
  contentType: string;
  url: string | null;
  originalFilename: string | null;
  s3Key: string;
  size?: number | null;
}

export function AttachmentThumbnails({
  attachments,
  cardPublicId,
  isReadOnly = false,
}: {
  attachments?: Attachment[];
  cardPublicId: string;
  isReadOnly?: boolean;
}) {
  const { showPopup } = usePopup();
  const utils = api.useUtils();
  const imageAttachments =
    attachments?.filter(
      (attachment) =>
        attachment.contentType.startsWith("image/") && attachment.url,
    ) ?? [];

  const nonImageAttachments =
    attachments?.filter(
      (attachment) =>
        !attachment.contentType.startsWith("image/") && attachment.url,
    ) ?? [];

  const [selectedIndex, setSelectedIndex] = useState<number | null>(null);

  const deleteAttachment = api.attachment.delete.useMutation({
    onMutate: async (args) => {
      if (isReadOnly) return;

      await utils.card.byId.cancel({ cardPublicId });
      const currentState = utils.card.byId.getData({ cardPublicId });

      utils.card.byId.setData({ cardPublicId }, (oldCard) => {
        if (!oldCard) return oldCard;
        const updatedAttachments = oldCard.attachments.filter(
          (attachment) => attachment.publicId !== args.attachmentPublicId,
        );
        return { ...oldCard, attachments: updatedAttachments };
      });

      return { previousState: currentState };
    },
    onError: (_error, _args, context) => {
      if (isReadOnly) return;
      utils.card.byId.setData({ cardPublicId }, context?.previousState);
      showPopup({
        header: t`Unable to delete attachment`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSuccess: () => {
      if (isReadOnly) return;
      // Close viewer if the deleted image was being viewed
      setSelectedIndex(null);
    },
    onSettled: async () => {
      if (isReadOnly) return;
      await invalidateCard(utils, cardPublicId);
    },
  });

  // Keyboard navigation
  useEffect(() => {
    if (selectedIndex === null) return;

    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") {
        setSelectedIndex(null);
      } else if (e.key === "ArrowLeft") {
        setSelectedIndex((prev) => {
          if (prev === null) return null;
          return prev === 0 ? imageAttachments.length - 1 : prev - 1;
        });
      } else if (e.key === "ArrowRight") {
        setSelectedIndex((prev) => {
          if (prev === null) return null;
          return prev === imageAttachments.length - 1 ? 0 : prev + 1;
        });
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [selectedIndex, imageAttachments.length]);

  if (imageAttachments.length === 0 && nonImageAttachments.length === 0) {
    return null;
  }

  const openViewer = (index: number) => {
    setSelectedIndex(index);
  };

  const closeViewer = () => {
    setSelectedIndex(null);
  };

  const goToPrevious = () => {
    if (selectedIndex === null) return;
    const newIndex =
      selectedIndex === 0 ? imageAttachments.length - 1 : selectedIndex - 1;
    setSelectedIndex(newIndex);
  };

  const goToNext = () => {
    if (selectedIndex === null) return;
    const newIndex =
      selectedIndex === imageAttachments.length - 1 ? 0 : selectedIndex + 1;
    setSelectedIndex(newIndex);
  };

  const handleDownload = (attachment: Attachment) => {
    if (!attachment.url) {
      showPopup({
        header: t`Download failed`,
        message: t`No download URL available for this attachment.`,
        icon: "error",
      });
      return;
    }

    const downloadUrl = `/api/download/attatchment?url=${encodeURIComponent(attachment.url)}&filename=${encodeURIComponent(attachment.originalFilename ?? "attachment")}`;

    const link = document.createElement("a");
    link.href = downloadUrl;
    link.style.display = "none";
    document.body.appendChild(link);
    link.click();
  };

  const selectedAttachment =
    selectedIndex !== null ? imageAttachments[selectedIndex] : null;

  return (
    <>
      <div className="mb-3 flex flex-wrap gap-2 pt-1">
        {imageAttachments.map((attachment, index) => {
          if (!attachment.url) return null;
          return (
            <AttachmentThumbnail
              key={attachment.publicId}
              attachment={{
                publicId: attachment.publicId,
                url: attachment.url,
                originalFilename: attachment.originalFilename ?? "",
                contentType: attachment.contentType,
              }}
              onClick={() => openViewer(index)}
              isImage={true}
            />
          );
        })}
      </div>

      {nonImageAttachments.length > 0 && (
        <div className="mb-3 flex flex-col gap-2">
          {nonImageAttachments.map((attachment) => {
            if (!attachment.url) return null;
            return (
              <FileListItem
                key={attachment.publicId}
                attachment={attachment}
                onDownload={() => handleDownload(attachment)}
                onDelete={
                  isReadOnly
                    ? undefined
                    : () => {
                        deleteAttachment.mutate({
                          attachmentPublicId: attachment.publicId,
                        });
                      }
                }
              />
            );
          })}
        </div>
      )}

      <Transition.Root show={selectedIndex !== null} as={Fragment}>
        <Dialog
          as="div"
          className="relative z-50"
          onClose={() => {
            // Dialog closing is handled by the background overlay click
          }}
          static
        >
          <Transition.Child
            as={Fragment}
            enter="ease-out duration-300"
            enterFrom="opacity-0"
            enterTo="opacity-100"
            leave="ease-in duration-200"
            leaveFrom="opacity-100"
            leaveTo="opacity-0"
          >
            <div
              className="fixed inset-0 bg-light-50 transition-opacity dark:bg-dark-50"
              onClick={(e) => {
                // Only close if clicking directly on the background, not on buttons
                if (e.target === e.currentTarget) {
                  closeViewer();
                }
              }}
            />
          </Transition.Child>

          <div className="fixed inset-0 z-10 overflow-y-auto">
            {selectedIndex !== null && selectedAttachment && (
              <div
                className="fixed left-2 top-2 z-20 flex gap-1"
                onMouseDown={(e) => e.stopPropagation()}
                onClick={(e) => e.stopPropagation()}
              >
                {!isReadOnly && (
                  <button
                    onMouseDown={(e) => {
                      e.preventDefault();
                      e.stopPropagation();
                    }}
                    onClick={(e) => {
                      e.preventDefault();
                      e.stopPropagation();
                      deleteAttachment.mutate({
                        attachmentPublicId: selectedAttachment.publicId,
                      });
                    }}
                    className="rounded-full bg-light-50 p-1.5 text-light-1000 transition-colors hover:bg-light-100 focus:outline-none dark:bg-dark-50 dark:text-dark-1000 dark:hover:bg-dark-100"
                    aria-label="Delete image"
                    disabled={deleteAttachment.isPending}
                  >
                    <HiOutlineTrash className="h-4 w-4" />
                  </button>
                )}
                <button
                  onMouseDown={(e) => {
                    e.preventDefault();
                    e.stopPropagation();
                  }}
                  onClick={(e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    handleDownload(selectedAttachment);
                  }}
                  className="rounded-full bg-light-50 p-1.5 text-light-1000 transition-colors hover:bg-light-100 focus:outline-none dark:bg-dark-50 dark:text-dark-1000 dark:hover:bg-dark-100"
                  aria-label="Download image"
                >
                  <HiArrowDownTray className="h-4 w-4" />
                </button>
              </div>
            )}

            <div className="fixed right-2 top-2 z-20 flex gap-1">
              {imageAttachments.length > 1 && selectedIndex !== null && (
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    goToPrevious();
                  }}
                  className="rounded-full bg-light-50 p-1.5 text-light-1000 transition-colors hover:bg-light-100 focus:outline-none dark:bg-dark-50 dark:text-dark-1000 dark:hover:bg-dark-100"
                  aria-label="Previous image"
                >
                  <HiChevronLeft className="h-4 w-4" />
                </button>
              )}

              {imageAttachments.length > 1 && selectedIndex !== null && (
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    goToNext();
                  }}
                  className="rounded-full bg-light-50 p-1.5 text-light-1000 transition-colors hover:bg-light-100 focus:outline-none dark:bg-dark-50 dark:text-dark-1000 dark:hover:bg-dark-100"
                  aria-label="Next image"
                >
                  <HiChevronRight className="h-4 w-4" />
                </button>
              )}

              {selectedIndex !== null && (
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    closeViewer();
                  }}
                  className="rounded-full bg-light-50 p-1.5 text-light-1000 transition-colors hover:bg-light-100 focus:outline-none dark:bg-dark-50 dark:text-dark-1000 dark:hover:bg-dark-100"
                  aria-label="Close"
                >
                  <HiXMark className="h-4 w-4" />
                </button>
              )}
            </div>

            <div className="flex min-h-full items-center justify-center p-4">
              <Transition.Child
                as={Fragment}
                enter="ease-out duration-300"
                enterFrom="opacity-0 scale-95"
                enterTo="opacity-100 scale-100"
                leave="ease-in duration-200"
                leaveFrom="opacity-100 scale-100"
                leaveTo="opacity-0 scale-95"
              >
                <Dialog.Panel
                  className="relative w-full max-w-7xl"
                  onClick={(e) => e.stopPropagation()}
                >
                  {selectedAttachment?.url && (
                    <div className="relative">
                      <div className="relative mx-auto max-h-[90vh] w-full">
                        <Image
                          src={selectedAttachment.url}
                          alt={
                            selectedAttachment.originalFilename ?? "Attachment"
                          }
                          width={1920}
                          height={1080}
                          className="mx-auto max-h-[90vh] w-auto object-contain"
                          unoptimized
                        />
                      </div>

                      {imageAttachments.length > 1 && (
                        <div className="absolute bottom-4 left-1/2 -translate-x-1/2 rounded-full bg-black/50 px-3 py-1.5 text-[10px] text-white">
                          {selectedIndex !== null && selectedIndex + 1} /{" "}
                          {imageAttachments.length}
                        </div>
                      )}
                    </div>
                  )}
                </Dialog.Panel>
              </Transition.Child>
            </div>
          </div>
        </Dialog>
      </Transition.Root>
    </>
  );
}

function AttachmentThumbnail({
  attachment,
  onClick,
  isImage,
}: {
  attachment: {
    publicId: string;
    url: string;
    originalFilename: string;
    contentType: string;
  };
  onClick: () => void;
  isImage: boolean;
}) {
  return (
    <button
      onClick={onClick}
      className="relative h-16 w-16 overflow-hidden rounded-xl border border-light-300 transition-transform hover:scale-105 dark:border-dark-300"
      aria-label={`View ${attachment.originalFilename}`}
    >
      {isImage ? (
        <Image
          src={attachment.url}
          alt={attachment.originalFilename}
          fill
          className="object-cover"
          sizes="64px"
        />
      ) : (
        <div className="flex h-full w-full items-center justify-center bg-light-100 dark:bg-dark-100">
          <HiDocumentText className="h-6 w-6 text-light-700 dark:text-dark-700" />
        </div>
      )}
    </button>
  );
}

function formatFileSize(bytes: number | null | undefined): string {
  if (!bytes || bytes === 0 || isNaN(bytes)) return "0 B";
  const k = 1024;
  const sizes = ["B", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return `${(bytes / Math.pow(k, i)).toFixed(1)} ${sizes[i] ?? "B"}`;
}

function FileListItem({
  attachment,
  onDownload,
  onDelete,
}: {
  attachment: Attachment;
  onDownload: () => void;
  onDelete?: () => void;
}) {
  return (
    <div className="group flex w-full items-center gap-3 rounded-lg border border-light-300 bg-light-50 px-3 py-2 dark:border-dark-200 dark:bg-dark-100">
      <div className="flex-shrink-0">
        <HiDocumentText className="h-5 w-5 text-light-700 dark:text-dark-700" />
      </div>
      <div className="min-w-0 flex-1 truncate text-sm text-light-1000 dark:text-dark-1000">
        {attachment.originalFilename ?? "File"}
      </div>
      <div className="flex items-center gap-2 opacity-0 transition-opacity group-hover:opacity-100">
        <div className="text-xs text-light-500 dark:text-dark-900">
          {attachment.size != null &&
            !isNaN(attachment.size) &&
            `${formatFileSize(attachment.size)}`}
        </div>
        <div className="flex items-center gap-1">
          <button
            onClick={(e) => {
              e.stopPropagation();
              onDownload();
            }}
            className="flex-shrink-0 rounded-full bg-light-100 p-1.5 text-light-1000 transition-colors hover:bg-light-200 focus:outline-none dark:bg-dark-100 dark:text-dark-950 dark:hover:bg-dark-300"
            aria-label={`Download ${attachment.originalFilename}`}
          >
            <HiArrowDownTray className="h-4 w-4" />
          </button>
          {onDelete && (
            <button
              onClick={(e) => {
                e.stopPropagation();
                onDelete();
              }}
              className="flex-shrink-0 rounded-full bg-light-100 p-1.5 text-light-1000 transition-colors hover:bg-light-200 focus:outline-none dark:bg-dark-100 dark:text-dark-950 dark:hover:bg-dark-300"
              aria-label={`Delete ${attachment.originalFilename}`}
            >
              <HiXMark className="h-4 w-4" />
            </button>
          )}
        </div>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/card/components/AttachmentUpload.tsx
================================================
import { t } from "@lingui/core/macro";
import { useRef, useState } from "react";
import { HiOutlinePaperClip } from "react-icons/hi";
import { HiCheckBadge } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { env } from "next-runtime-env";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

export function AttachmentUpload({ cardPublicId }: { cardPublicId: string }) {
  const { openModal } = useModal();
  const { showPopup } = usePopup();
  const utils = api.useUtils();
  const [uploading, setUploading] = useState(false);
  const [isDragging, setIsDragging] = useState(false);
  const inputRef = useRef<HTMLInputElement | null>(null);

  const uploadFile = async (file: File) => {
    setUploading(true);

    try {
      const baseUrl = env("NEXT_PUBLIC_BASE_URL") ?? "";
      const response = await fetch(
        `${baseUrl}/api/upload/attachment?cardPublicId=${encodeURIComponent(cardPublicId)}`,
        {
          method: "POST",
          headers: {
            "Content-Type": file.type,
            "x-original-filename": file.name,
          },
          body: file,
        },
      );

      if (!response.ok) {
        throw new Error("Upload failed");
      }

      await invalidateCard(utils, cardPublicId);
      showPopup({
        header: t`Attachment uploaded`,
        message: t`Your file has been uploaded successfully.`,
        icon: "success",
      });
    } catch {
      showPopup({
        header: t`Upload failed`,
        message: t`Failed to upload attachment. Please try again.`,
        icon: "error",
      });
      setUploading(false);
    }
  };

  const handleFileSelect = async (
    event: React.ChangeEvent<HTMLInputElement>,
  ) => {
    const file = event.target.files?.[0];
    if (!file) return;

    // Reset input
    event.target.value = "";

    await uploadFile(file);
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    if (!uploading) {
      setIsDragging(true);
    }
  };

  const handleDragLeave = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);
  };

  const handleDrop = async (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);

    if (uploading) return;

    const files = Array.from(e.dataTransfer.files);
    if (files.length === 0) return;

    // Upload the first file (or could upload all files)
    await uploadFile(files[0] ?? new File([], ""));
  };

  return (
    <div className="mb-6">
      <input
        ref={inputRef}
        type="file"
        id="attachment-upload"
        className="hidden"
        onChange={handleFileSelect}
        disabled={uploading}
      />
      <div
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
        className={twMerge(
          "rounded-lg border-2 border-dashed transition-colors",
          isDragging
            ? "border-light-300 bg-light-100 dark:border-dark-300 dark:bg-dark-100"
            : "border-transparent",
        )}
      >
        <div className="flex items-center justify-between p-2">
          <Button
            type="button"
            variant="ghost"
            iconLeft={
              <HiCheckBadge className="h-4 w-4 text-light-950 dark:text-dark-950" />
            }
            iconOnly
            size="sm"
            onClick={() => openModal("ADD_CHECKLIST")}
          />
          <Button
            type="button"
            variant="ghost"
            iconLeft={
              <HiOutlinePaperClip className="h-4 w-4 text-light-950 dark:text-dark-950" />
            }
            isLoading={uploading}
            disabled={uploading}
            iconOnly
            size="sm"
            onClick={() => inputRef.current?.click()}
          />
        </div>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/card/components/ChecklistItemRow.tsx
================================================
import type { DraggableProvided } from "react-beautiful-dnd";
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";
import ContentEditable from "react-contenteditable";
import { HiXMark } from "react-icons/hi2";
import { RiDraggable } from "react-icons/ri";
import { twMerge } from "tailwind-merge";

import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface ChecklistItemRowProps {
  item: {
    publicId: string;
    title: string;
    completed: boolean;
  };
  cardPublicId: string;
  onCreateNewItem?: () => void;
  viewOnly?: boolean;
  dragHandleProps?: DraggableProvided["dragHandleProps"];
  isDragging?: boolean;
}

export default function ChecklistItemRow({
  item,
  cardPublicId,
  onCreateNewItem,
  viewOnly = false,
  dragHandleProps,
  isDragging = false,
}: ChecklistItemRowProps) {
  const utils = api.useUtils();
  const { showPopup } = usePopup();

  const [title, setTitle] = useState("");
  const [completed, setCompleted] = useState(false);

  const updateItem = api.checklist.updateItem.useMutation({
    onMutate: async (vars) => {
      await utils.card.byId.cancel({ cardPublicId });
      const previous = utils.card.byId.getData({ cardPublicId });
      utils.card.byId.setData({ cardPublicId }, (old) => {
        if (!old) return old as any;
        const updatedChecklists = old.checklists.map((cl) => ({
          ...cl,
          items: cl.items.map((ci) =>
            ci.publicId === item.publicId
              ? {
                  ...ci,
                  ...(vars.title !== undefined ? { title: vars.title } : {}),
                  ...(vars.completed !== undefined
                    ? { completed: vars.completed }
                    : {}),
                }
              : ci,
          ),
        }));
        return { ...old, checklists: updatedChecklists } as typeof old;
      });
      return { previous };
    },
    onError: (_err, _vars, ctx) => {
      if (ctx?.previous)
        utils.card.byId.setData({ cardPublicId }, ctx.previous);
      showPopup({
        header: t`Unable to update checklist item`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
    },
  });

  const deleteItem = api.checklist.deleteItem.useMutation({
    onMutate: async () => {
      await utils.card.byId.cancel({ cardPublicId });
      const previous = utils.card.byId.getData({ cardPublicId });
      utils.card.byId.setData({ cardPublicId }, (old) => {
        if (!old) return old as any;
        const updatedChecklists = old.checklists.map((cl) => ({
          ...cl,
          items: cl.items.filter((ci) => ci.publicId !== item.publicId),
        }));
        return { ...old, checklists: updatedChecklists } as typeof old;
      });
      return { previous };
    },
    onError: (_err, _vars, ctx) => {
      if (ctx?.previous)
        utils.card.byId.setData({ cardPublicId }, ctx.previous);
      showPopup({
        header: t`Unable to delete checklist item`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
    },
  });

  // Only resync from props when switching items to avoid clobbering edits
  useEffect(() => {
    setTitle(item.title);
    setCompleted(item.completed);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [item.publicId]);

  const sanitizeHtmlToPlainText = (html: string): string =>
    html
      .replace(/<br\s*\/?>(\n)?/gi, "\n")
      .replace(/<div><br\s*\/?><\/div>/gi, "")
      .replace(/<[^>]*>/g, "")
      .replace(/&nbsp;/g, " ")
      .trim();

  const handleToggleCompleted = () => {
    if (viewOnly) return;
    setCompleted((prev) => !prev);
    updateItem.mutate({
      checklistItemPublicId: item.publicId,
      completed: !completed,
    });
  };

  const commitTitle = (rawHtml: string) => {
    if (viewOnly) return;
    const plain = sanitizeHtmlToPlainText(rawHtml);
    if (!plain || plain === item.title) {
      setTitle(item.title);
      return;
    }
    setTitle(plain);
    updateItem.mutate({
      checklistItemPublicId: item.publicId,
      title: plain,
    });
  };

  const handleDelete = () => {
    if (viewOnly) return;
    deleteItem.mutate({ checklistItemPublicId: item.publicId });
  };

  return (
    <div
      className={twMerge(
        "group relative flex items-start gap-3 rounded-md py-2 pl-4 hover:bg-light-100 dark:hover:bg-dark-100",
        isDragging && "opacity-80",
      )}
    >
      {!viewOnly && (
        <div
          {...dragHandleProps}
          className="absolute left-0 top-1/2 flex h-[20px] w-[20px] -translate-x-full -translate-y-1/2 cursor-grab items-center justify-center pr-1 opacity-0 transition-opacity group-hover:opacity-75 hover:opacity-100 active:cursor-grabbing"
        >
          <RiDraggable className="h-4 w-4 text-light-700 dark:text-dark-700" />
        </div>
      )}

      {viewOnly && <div className="w-[20px] flex-shrink-0" />}

      <label
        className={`relative mt-[2px] inline-flex h-[16px] w-[16px] flex-shrink-0 items-center justify-center`}
      >
        <input
          type="checkbox"
          checked={completed}
          onChange={(e) => {
            if (viewOnly) {
              e.preventDefault();
              return;
            }
            handleToggleCompleted();
          }}
          className={twMerge(
            "h-[16px] w-[16px] appearance-none rounded-md border border-light-500 bg-transparent outline-none ring-0 checked:bg-blue-600 focus:shadow-none focus:ring-0 focus:ring-offset-0 focus-visible:outline-none dark:border-dark-500 dark:hover:border-dark-500",
            viewOnly ? "cursor-default" : "cursor-pointer",
          )}
        />
      </label>
      <div className="flex-1 pr-7">
        <ContentEditable
          html={title}
          disabled={viewOnly}
          onChange={(e) => setTitle(e.target.value)}
          // @ts-expect-error - valid event
          onBlur={(e: Event) => {
            const innerHTML = (e.target as HTMLElement).innerHTML;
            commitTitle(innerHTML);
          }}
          className={twMerge(
            "m-0 min-h-[20px] w-full p-0 text-sm leading-[20px] text-light-950 outline-none focus-visible:outline-none dark:text-dark-950",
            viewOnly && "cursor-default",
          )}
          placeholder={t`Add details...`}
          onKeyDown={(e) => {
            if (viewOnly) return;
            if (e.key === "Enter") {
              e.preventDefault();
              const innerHTML = (e.currentTarget as HTMLElement).innerHTML;
              commitTitle(innerHTML);
              onCreateNewItem?.();
            }
            if (e.key === "Escape") {
              e.preventDefault();
              setTitle(item.title);
            }
          }}
        />
      </div>
      {!viewOnly && (
        <button
          type="button"
          onClick={handleDelete}
          className="absolute right-1 top-1/2 hidden -translate-y-1/2 rounded-md p-1 text-light-900 group-hover:block hover:bg-light-200 dark:text-dark-700 dark:hover:bg-dark-200"
        >
          <HiXMark size={16} />
        </button>
      )}
    </div>
  );
}



================================================
FILE: apps/web/src/views/card/components/ChecklistNameInput.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect, useRef, useState } from "react";
import { twMerge } from "tailwind-merge";

import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

export default function ChecklistNameInput({
  checklistPublicId,
  initialName,
  cardPublicId,
  viewOnly = false,
}: {
  checklistPublicId: string;
  initialName: string;
  cardPublicId: string;
  viewOnly?: boolean;
}) {
  const utils = api.useUtils();
  const { showPopup } = usePopup();
  const [name, setName] = useState(initialName);
  const inputRef = useRef<HTMLInputElement | null>(null);

  useEffect(() => {
    setName(initialName);
  }, [initialName, checklistPublicId]);

  const update = api.checklist.update.useMutation({
    onMutate: async (vars) => {
      await utils.card.byId.cancel({ cardPublicId });
      const previous = utils.card.byId.getData({ cardPublicId });
      utils.card.byId.setData({ cardPublicId }, (old) => {
        if (!old) return old as any;
        const updated = old.checklists.map((cl) =>
          cl.publicId === checklistPublicId ? { ...cl, name: vars.name } : cl,
        );
        return { ...old, checklists: updated } as typeof old;
      });
      return { previous };
    },
    onError: (_err, _vars, ctx) => {
      if (ctx?.previous)
        utils.card.byId.setData({ cardPublicId }, ctx.previous);
      showPopup({
        header: t`Unable to update checklist`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
    },
  });

  const commit = () => {
    if (viewOnly) return;
    const trimmed = name.trim();
    if (!trimmed || trimmed === initialName) return;
    update.mutate({ checklistPublicId, name: trimmed });
  };

  return (
    <input
      ref={inputRef}
      type="text"
      value={name}
      readOnly={viewOnly}
      onChange={(e) => setName(e.target.value)}
      onBlur={commit}
      onKeyDown={(e) => {
        if (viewOnly) return;
        if (e.key === "Enter") {
          e.preventDefault();
          commit();
          inputRef.current?.blur();
        }
        if (e.key === "Escape") {
          e.preventDefault();
          setName(initialName);
          inputRef.current?.blur();
        }
      }}
      title={name}
      className={twMerge(
        "text-md block w-full truncate border-0 bg-transparent p-0 py-0 font-medium text-light-1000 outline-none focus:ring-0 dark:text-dark-1000",
        viewOnly && "cursor-default",
      )}
    />
  );
}



================================================
FILE: apps/web/src/views/card/components/Checklists.tsx
================================================
import type { DropResult } from "react-beautiful-dnd";
import { t } from "@lingui/core/macro";
import { DragDropContext, Draggable } from "react-beautiful-dnd";
import { HiPlus, HiXMark } from "react-icons/hi2";

import CircularProgress from "~/components/CircularProgress";
import { StrictModeDroppable as Droppable } from "~/components/StrictModeDroppable";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import ChecklistItemRow from "./ChecklistItemRow";
import ChecklistNameInput from "./ChecklistNameInput";
import NewChecklistItemForm from "./NewChecklistItemForm";

interface ChecklistItem {
  publicId: string;
  title: string;
  completed: boolean;
}

interface Checklist {
  publicId: string;
  name: string;
  items: ChecklistItem[];
}

interface ChecklistsProps {
  checklists: Checklist[];
  cardPublicId: string;
  activeChecklistForm?: string | null;
  setActiveChecklistForm?: (id: string | null) => void;
  viewOnly?: boolean;
}

export default function Checklists({
  checklists,
  cardPublicId,
  activeChecklistForm,
  setActiveChecklistForm,
  viewOnly = false,
}: ChecklistsProps) {
  const { openModal } = useModal();
  const { showPopup } = usePopup();

  const utils = api.useUtils();

  const reorderItemMutation = api.checklist.updateItem.useMutation({
    onMutate: async (vars) => {
      await utils.card.byId.cancel({ cardPublicId });
      const previous = utils.card.byId.getData({ cardPublicId });

      utils.card.byId.setData({ cardPublicId }, (old) => {
        if (!old) return old;

        const updatedChecklists = old.checklists.map((cl) => {
          const itemIndex = cl.items.findIndex(
            (item) => item.publicId === vars.checklistItemPublicId,
          );

          if (itemIndex === -1 || vars.index === undefined) return cl;

          const newIndex = vars.index;
          const items = Array.from(cl.items);
          const [movedItem] = items.splice(itemIndex, 1);
          if (!movedItem) return cl;
          items.splice(newIndex, 0, movedItem);

          return { ...cl, items };
        });

        return { ...old, checklists: updatedChecklists } as typeof old;
      });

      return { previous };
    },
    onError: (_err, _vars, ctx) => {
      if (ctx?.previous)
        utils.card.byId.setData({ cardPublicId }, ctx.previous);
      showPopup({
        header: t`Unable to reorder checklist item`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await utils.card.byId.invalidate({ cardPublicId });
    },
  });

  const onDragEnd = (result: DropResult) => {
    if (!result.destination) return;

    const { source, destination, draggableId } = result;

    if (source.droppableId !== destination.droppableId) return;

    if (source.index === destination.index) return;

    reorderItemMutation.mutate({
      checklistItemPublicId: draggableId,
      index: destination.index,
    });
  };

  if (checklists.length === 0) return null;

  return (
    <DragDropContext onDragEnd={onDragEnd}>
      <div className="border-light-300 pb-4 dark:border-dark-300">
        <div>
          {checklists.map((checklist) => {
            const completedItems = checklist.items.filter(
              (item) => item.completed,
            );
            const progress =
              checklist.items.length > 0 && completedItems.length > 0
                ? (completedItems.length / checklist.items.length) * 100
                : 2;

            return (
              <div key={checklist.publicId} className="mb-4">
                <div className="mb-2 flex items-center font-medium text-light-1000 dark:text-dark-1000">
                  <div className="min-w-0 flex-1">
                    <ChecklistNameInput
                      checklistPublicId={checklist.publicId}
                      initialName={checklist.name}
                      cardPublicId={cardPublicId}
                      viewOnly={viewOnly}
                    />
                  </div>
                  {!viewOnly && (
                    <div className="ml-2 flex flex-shrink-0 items-center gap-2">
                      <div className="flex items-center gap-1 rounded-full border-[1px] border-light-300 px-2 py-1 dark:border-dark-300">
                        <CircularProgress
                          progress={progress}
                          size="sm"
                          className="flex-shrink-0"
                        />
                        <span className="text-[11px] text-light-900 dark:text-dark-700">
                          {completedItems.length}/{checklist.items.length}
                        </span>
                      </div>
                      <div>
                        <button
                          className="rounded-md p-1 text-light-900 hover:bg-light-100 dark:text-dark-700 dark:hover:bg-dark-100"
                          onClick={() =>
                            openModal("DELETE_CHECKLIST", checklist.publicId)
                          }
                        >
                          <HiXMark size={16} />
                        </button>
                        <button
                          onClick={() =>
                            setActiveChecklistForm?.(checklist.publicId)
                          }
                          className="rounded-md p-1 text-light-900 hover:bg-light-100 dark:text-dark-700 dark:hover:bg-dark-100"
                        >
                          <HiPlus size={16} />
                        </button>
                      </div>
                    </div>
                  )}
                  {viewOnly && (
                    <div className="ml-2 flex flex-shrink-0 items-center gap-2">
                      <div className="flex items-center gap-1 rounded-full border-[1px] border-light-300 px-2 py-1 dark:border-dark-300">
                        <CircularProgress
                          progress={progress}
                          size="sm"
                          className="flex-shrink-0"
                        />
                        <span className="text-[11px] text-light-900 dark:text-dark-700">
                          {completedItems.length}/{checklist.items.length}
                        </span>
                      </div>
                    </div>
                  )}
                </div>

                <Droppable
                  droppableId={checklist.publicId}
                  type="CHECKLIST_ITEM"
                  isDropDisabled={viewOnly}
                >
                  {(provided) => (
                    <div
                      ref={provided.innerRef}
                      {...provided.droppableProps}
                      className="ml-1"
                    >
                      {checklist.items.map((item, index) => (
                        <Draggable
                          key={item.publicId}
                          draggableId={item.publicId}
                          index={index}
                          isDragDisabled={viewOnly}
                        >
                          {(provided, snapshot) => (
                            <div
                              ref={provided.innerRef}
                              {...provided.draggableProps}
                              style={{
                                ...provided.draggableProps.style,
                                opacity: snapshot.isDragging ? 0.8 : 1,
                              }}
                            >
                              <ChecklistItemRow
                                item={{
                                  publicId: item.publicId,
                                  title: item.title,
                                  completed: item.completed,
                                }}
                                cardPublicId={cardPublicId}
                                onCreateNewItem={() =>
                                  setActiveChecklistForm?.(checklist.publicId)
                                }
                                viewOnly={viewOnly}
                                dragHandleProps={provided.dragHandleProps}
                                isDragging={snapshot.isDragging}
                              />
                            </div>
                          )}
                        </Draggable>
                      ))}
                      {provided.placeholder}
                    </div>
                  )}
                </Droppable>
                {activeChecklistForm === checklist.publicId && !viewOnly && (
                  <div className="ml-1">
                    <NewChecklistItemForm
                      checklistPublicId={checklist.publicId}
                      cardPublicId={cardPublicId}
                      onCancel={() => setActiveChecklistForm?.(null)}
                      readOnly={viewOnly}
                    />
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </div>
    </DragDropContext>
  );
}



================================================
FILE: apps/web/src/views/card/components/Comment.tsx
================================================
import { t } from "@lingui/core/macro";
import { formatDistanceToNow } from "date-fns";
import { useState } from "react";
import { useForm } from "react-hook-form";
import { HiEllipsisHorizontal, HiPencil, HiTrash } from "react-icons/hi2";

import Avatar from "~/components/Avatar";
import Button from "~/components/Button";
import Editor from "~/components/Editor";
import type { WorkspaceMember } from "~/components/Editor";
import Dropdown from "~/components/Dropdown";
import { usePermissions } from "~/hooks/usePermissions";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";
import { getAvatarUrl } from "~/utils/helpers";

interface FormValues {
  comment: string;
}

const Comment = ({
  publicId,
  cardPublicId,
  name,
  email,
  image,
  isLoading,
  createdAt,
  comment,
  isAuthor,
  isEdited = false,
  isViewOnly = false,
}: {
  publicId: string | undefined;
  cardPublicId: string;
  name: string;
  email: string;
  image: string | null;
  isLoading: boolean;
  createdAt: string;
  comment: string | undefined;
  isAuthor: boolean;
  isEdited: boolean;
  isViewOnly: boolean;
}) => {
  const [isEditing, setIsEditing] = useState(false);
  const utils = api.useUtils();
  const { showPopup } = usePopup();
  const { openModal } = useModal();
  const { canEditComment, canDeleteComment } = usePermissions();
  const { handleSubmit, setValue, watch } = useForm<FormValues>({
    defaultValues: {
      comment,
    },
  });

  const { data: cardData } = api.card.byId.useQuery(
    {
      cardPublicId,
    },
    {
      enabled: !!cardPublicId && cardPublicId.length >= 12,
    },
  );

  const workspaceMembers: WorkspaceMember[] =
    cardData?.list.board.workspace.members
      .filter((member) => member.email)
      .map((member) => ({
        publicId: member.publicId,
        email: member.email,
        user: member.user
          ? {
              id: member.user.id,
              name: member.user.name ?? null,
              image: member.user.image ?? null,
            }
          : null,
      })) ?? [];

  if (!publicId) return null;

  const updateCommentMutation = api.card.updateComment.useMutation({
    onSuccess: async () => {
      await invalidateCard(utils, cardPublicId);
      setIsEditing(false);
    },
    onError: () => {
      showPopup({
        header: t`Unable to update comment`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const onSubmit = (data: FormValues) => {
    updateCommentMutation.mutate({
      cardPublicId,
      comment: data.comment,
      commentPublicId: publicId,
    });
  };

  const dropdownItems = [
    ...(isAuthor && canEditComment
      ? [
          {
            label: t`Edit comment`,
            action: () => setIsEditing(true),
            icon: <HiPencil className="h-[16px] w-[16px] text-dark-900" />,
          },
        ]
      : []),
    ...((isAuthor || canDeleteComment)
      ? [
          {
            label: t`Delete comment`,
            action: () => openModal("DELETE_COMMENT", publicId),
            icon: <HiTrash className="h-[16px] w-[16px] text-dark-900" />,
          },
        ]
      : []),
  ];

  return (
    <div
      key={publicId}
      className="group relative flex w-full flex-col rounded-xl border border-light-600 bg-light-200 p-4 text-light-900 focus-visible:outline-none dark:border-dark-400 dark:bg-dark-100 dark:text-dark-1000 sm:text-sm sm:leading-6"
    >
      <div className="flex justify-between">
        <div className="flex items-center space-x-2">
          <Avatar
            size="sm"
            name={name ?? ""}
            email={email ?? ""}
            imageUrl={getAvatarUrl(image) || undefined}
            isLoading={isLoading}
          />

          <p className="text-sm">
            <span className="font-medium dark:text-dark-1000">{`${name} `}</span>
            <span className="mx-1 text-light-900 dark:text-dark-800">Â·</span>
            <span className="space-x-1 text-light-900 dark:text-dark-800">
              {formatDistanceToNow(new Date(createdAt), {
                addSuffix: true,
              })}
            </span>
            {isEdited && (
              <span className="text-light-900 dark:text-dark-800">
                {t` (edited)`}
              </span>
            )}
          </p>
        </div>

        {dropdownItems.length > 0 && !isViewOnly && (
          <div className="absolute right-4 top-4">
            <Dropdown items={dropdownItems}>
              <HiEllipsisHorizontal className="h-5 w-5 text-light-900 dark:text-dark-800" />
            </Dropdown>
          </div>
        )}
      </div>
      {!isEditing ? (
        <div className="mt-2">
          <Editor
            content={comment ?? null}
            readOnly={true}
            workspaceMembers={workspaceMembers}
            enableYouTubeEmbed={false}
            disableHeadings={true}
          />
        </div>
      ) : (
        <form onSubmit={handleSubmit(onSubmit)}>
          <div className="mt-2">
            <Editor
              content={watch("comment")}
              onChange={(value) => setValue("comment", value)}
              workspaceMembers={workspaceMembers}
              enableYouTubeEmbed={false}
              placeholder={t`Add comment... (type '/' to open commands or '@' to mention)`}
              disableHeadings={true}
            />
          </div>
          <div className="flex justify-end space-x-2 mt-2">
            <Button
              size="sm"
              variant="ghost"
              onClick={() => setIsEditing(false)}
            >
              {t`Cancel`}
            </Button>
            <Button
              isLoading={updateCommentMutation.isPending}
              type="submit"
              size="sm"
            >
              {t`Save`}
            </Button>
          </div>
        </form>
      )}
    </div>
  );
};

export default Comment;



================================================
FILE: apps/web/src/views/card/components/DeleteCardConfirmation.tsx
================================================
import { useRouter } from "next/navigation";
import { t } from "@lingui/core/macro";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

interface DeleteCardConfirmationProps {
  cardPublicId: string;
  boardPublicId: string;
}

export function DeleteCardConfirmation({
  cardPublicId,
  boardPublicId,
}: DeleteCardConfirmationProps) {
  const { closeModal } = useModal();
  const utils = api.useUtils();
  const router = useRouter();
  const { showPopup } = usePopup();

  const queryParams = {
    boardPublicId,
  };

  const deleteCardMutation = api.card.delete.useMutation({
    onMutate: async (args) => {
      await utils.board.byId.cancel();

      const currentState = utils.board.byId.getData(queryParams);

      utils.board.byId.setData(queryParams, (oldBoard) => {
        if (!oldBoard) return oldBoard;

        const updatedLists = oldBoard.lists.map((list) => {
          const updatedCards = list.cards.filter(
            (card) => card.publicId !== args.cardPublicId,
          );
          return { ...list, cards: updatedCards };
        });

        return { ...oldBoard, lists: updatedLists };
      });

      return { previousState: currentState };
    },
    onError: (_error, _newList, context) => {
      utils.board.byId.setData(queryParams, context?.previousState);
      showPopup({
        header: t`Unable to delete card`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSuccess: () => {
      router.push(`/boards/${boardPublicId}`);
    },
    onSettled: async () => {
      closeModal();
      await utils.board.byId.invalidate(queryParams);
    },
  });

  const handleDeleteCard = () => {
    deleteCardMutation.mutate({
      cardPublicId,
    });
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          {t`Are you sure you want to delete this card?`}
        </h2>
        <p className="text-sm font-medium text-light-900 dark:text-dark-900">
          {t`This action can't be undone.`}
        </p>
      </div>
      <div className="mt-5 flex justify-end sm:mt-6">
        <button
          className="mr-4 inline-flex justify-center rounded-md border-[1px] border-light-600 bg-light-50 px-3 py-2 text-sm font-semibold text-neutral-900 shadow-sm focus-visible:outline-none dark:border-dark-600 dark:bg-dark-300 dark:text-dark-1000"
          onClick={() => closeModal()}
        >
          {t`Cancel`}
        </button>
        <Button
          onClick={handleDeleteCard}
          isLoading={deleteCardMutation.isPending}
        >
          {t`Delete`}
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/card/components/DeleteChecklistConfirmation.tsx
================================================
import { t } from "@lingui/core/macro";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

export function DeleteChecklistConfirmation({
  cardPublicId,
  checklistPublicId,
}: {
  cardPublicId: string;
  checklistPublicId: string;
}) {
  const { closeModal } = useModal();
  const { showPopup } = usePopup();
  const utils = api.useUtils();

  const deleteChecklist = api.checklist.delete.useMutation({
    onMutate: async () => {
      await utils.card.byId.cancel({ cardPublicId });
      const previous = utils.card.byId.getData({ cardPublicId });
      utils.card.byId.setData({ cardPublicId }, (old) => {
        if (!old) return old as any;
        const updatedChecklists = old.checklists.filter(
          (cl) => cl.publicId !== checklistPublicId,
        );
        return { ...old, checklists: updatedChecklists } as typeof old;
      });
      return { previous };
    },
    onError: (_err, _vars, ctx) => {
      if (ctx?.previous)
        utils.card.byId.setData({ cardPublicId }, ctx.previous);
      showPopup({
        header: t`Unable to delete checklist`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      closeModal();
      await invalidateCard(utils, cardPublicId);
    },
  });

  const handleDelete = () => {
    deleteChecklist.mutate({ checklistPublicId });
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          {t`Are you sure you want to delete this checklist?`}
        </h2>
        <p className="text-sm font-medium text-light-900 dark:text-dark-900">
          {t`This action can't be undone.`}
        </p>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button variant="secondary" onClick={() => closeModal()}>
          {t`Cancel`}
        </Button>
        <Button onClick={handleDelete} isLoading={deleteChecklist.isPending}>
          {t`Delete`}
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/card/components/DeleteCommentConfirmation.tsx
================================================
import { t } from "@lingui/core/macro";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface DeleteCommentConfirmationProps {
  cardPublicId: string;
  commentPublicId: string;
}

export function DeleteCommentConfirmation({
  cardPublicId,
  commentPublicId,
}: DeleteCommentConfirmationProps) {
  const { closeModal } = useModal();
  const utils = api.useUtils();
  const { showPopup } = usePopup();

  const queryParams = {
    cardPublicId,
  };

  const deleteCommentMutation = api.card.deleteComment.useMutation({
    onMutate: async (args) => {
      closeModal();
      await utils.card.byId.cancel();
      const currentState = utils.card.byId.getData(queryParams);

      utils.card.byId.setData(queryParams, (oldCard) => {
        if (!oldCard) return oldCard;
        const updatedActivities = oldCard.activities.filter(
          (activity) => activity.comment?.publicId !== args.commentPublicId,
        );
        return { ...oldCard, activities: updatedActivities };
      });

      return { previousState: currentState };
    },
    onError: (_error, _newList, context) => {
      utils.card.byId.setData(queryParams, context?.previousState);
      showPopup({
        header: t`Unable to delete comment`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
    },
  });

  const handleDeleteComment = () => {
    deleteCommentMutation.mutate({
      cardPublicId,
      commentPublicId,
    });
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          {t`Are you sure you want to delete this comment?`}
        </h2>
        <p className="text-sm font-medium text-light-900 dark:text-dark-900">
          {t`This action can't be undone.`}
        </p>
      </div>
      <div className="mt-5 flex justify-end sm:mt-6">
        <button
          className="mr-4 inline-flex justify-center rounded-md border-[1px] border-light-600 bg-light-50 px-3 py-2 text-sm font-semibold text-neutral-900 shadow-sm focus-visible:outline-none dark:border-dark-600 dark:bg-dark-300 dark:text-dark-1000"
          onClick={() => closeModal()}
        >
          {t`Cancel`}
        </button>
        <Button
          onClick={handleDeleteComment}
          isLoading={deleteCommentMutation.isPending}
        >
          {t`Delete`}
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/card/components/Dropdown.tsx
================================================
import { t } from "@lingui/core/macro";
import {
  HiEllipsisHorizontal,
  HiLink,
  HiOutlineCheckCircle,
  HiOutlineTrash,
} from "react-icons/hi2";

import { authClient } from "@kan/auth/client";

import Dropdown from "~/components/Dropdown";
import { usePermissions } from "~/hooks/usePermissions";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";

export default function CardDropdown({
  cardPublicId,
  isTemplate,
  boardPublicId,
  cardCreatedBy,
}: {
  cardPublicId: string;
  isTemplate?: boolean;
  boardPublicId?: string;
  cardCreatedBy?: string | null;
}) {
  const { openModal } = useModal();
  const { showPopup } = usePopup();
  const { canEditCard, canDeleteCard } = usePermissions();
  const { data: session } = authClient.useSession();
  const isCreator = cardCreatedBy && session?.user.id === cardCreatedBy;

  const handleCopyCardLink = async () => {
    const path =
      isTemplate && boardPublicId
        ? `/templates/${boardPublicId}/cards/${cardPublicId}`
        : `/cards/${cardPublicId}`;
    const url = `${window.location.origin}${path}`;
    try {
      await navigator.clipboard.writeText(url);
      showPopup({
        header: t`Link copied`,
        icon: "success",
        message: t`Card URL copied to clipboard`,
      });
    } catch (error) {
      console.error(error);
      showPopup({
        header: t`Unable to copy link`,
        icon: "error",
        message: t`Please try again.`,
      });
    }
  };

  const items = [
    {
      label: t`Copy card link`,
      action: handleCopyCardLink,
      icon: <HiLink className="h-[16px] w-[16px] text-dark-900" />,
    },
    ...(canEditCard
      ? [
          {
            label: t`Add checklist`,
            action: () => openModal("ADD_CHECKLIST"),
            icon: (
              <HiOutlineCheckCircle className="h-[16px] w-[16px] text-dark-900" />
            ),
          },
        ]
      : []),
    ...(canDeleteCard || isCreator
      ? [
          {
            label: t`Delete card`,
            action: () => openModal("DELETE_CARD"),
            icon: (
              <HiOutlineTrash className="h-[16px] w-[16px] text-dark-900" />
            ),
          },
        ]
      : []),
  ];

  if (items.length === 0) {
    return null;
  }

  return (
    <Dropdown items={items}>
      <HiEllipsisHorizontal className="h-5 w-5 text-dark-900" />
    </Dropdown>
  );
}



================================================
FILE: apps/web/src/views/card/components/DueDateSelector.tsx
================================================
import { t } from "@lingui/core/macro";
import { format } from "date-fns";
import { useEffect, useState } from "react";
import { HiMiniPlus } from "react-icons/hi2";

import DateSelector from "~/components/DateSelector";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface DueDateSelectorProps {
  cardPublicId: string;
  dueDate: Date | null | undefined;
  isLoading?: boolean;
  disabled?: boolean;
}

export function DueDateSelector({
  cardPublicId,
  dueDate,
  isLoading = false,
  disabled = false,
}: DueDateSelectorProps) {
  const { showPopup } = usePopup();
  const utils = api.useUtils();
  const [isOpen, setIsOpen] = useState(false);
  const [pendingDate, setPendingDate] = useState<Date | null | undefined>(
    dueDate,
  );

  // Sync pendingDate with dueDate when it changes externally
  useEffect(() => {
    if (!isOpen) {
      setPendingDate(dueDate);
    }
  }, [dueDate, isOpen]);

  const updateDueDate = api.card.update.useMutation({
    onMutate: async (update) => {
      await utils.card.byId.cancel();

      const previousCard = utils.card.byId.getData({ cardPublicId });

      utils.card.byId.setData({ cardPublicId }, (oldCard) => {
        if (!oldCard) return oldCard;

        return {
          ...oldCard,
          dueDate:
            update.dueDate !== undefined
              ? (update.dueDate as Date | null)
              : oldCard.dueDate,
        };
      });

      return { previousCard };
    },
    onError: (_error, _update, context) => {
      utils.card.byId.setData({ cardPublicId }, context?.previousCard);
      showPopup({
        header: t`Unable to update due date`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
      await utils.board.byId.invalidate();
    },
  });

  const handleDateSelect = (date: Date | undefined) => {
    // Only update local state, don't fire mutation
    setPendingDate(date ?? null);
  };

  const handleBackdropClick = () => {
    // Only fire mutation if date actually changed
    const pendingIsNull = pendingDate === null || pendingDate === undefined;
    const dueIsNull = dueDate === null || dueDate === undefined;

    let dateChanged = false;
    if (pendingIsNull && !dueIsNull) {
      dateChanged = true;
    } else if (!pendingIsNull && dueIsNull) {
      dateChanged = true;
    } else if (!pendingIsNull && !dueIsNull) {
      // Both are non-null at this point
      if (pendingDate instanceof Date && dueDate instanceof Date) {
        dateChanged = pendingDate.getTime() !== dueDate.getTime();
      }
    }

    // Close popover immediately
    setIsOpen(false);

    // Fire mutation if date changed (optimistic update will handle UI)
    if (dateChanged) {
      updateDueDate.mutate({
        cardPublicId,
        dueDate: pendingDate ?? null,
      });
    }
  };

  return (
    <div className="relative flex w-full items-center text-left">
      <button
        type="button"
        onClick={() => !disabled && setIsOpen(!isOpen)}
        disabled={isLoading || disabled}
        className={`flex h-full w-full items-center rounded-[5px] border-[1px] border-light-50 py-1 pl-2 text-left text-xs text-neutral-900 dark:border-dark-50 dark:text-dark-1000 ${disabled ? "cursor-not-allowed opacity-60" : "hover:border-light-300 hover:bg-light-200 dark:hover:border-dark-200 dark:hover:bg-dark-100"}`}
      >
        {dueDate ? (
          <span>{format(dueDate, "MMM d, yyyy")}</span>
        ) : (
          <>
            <HiMiniPlus size={22} className="pr-2" />
            {t`Set due date`}
          </>
        )}
      </button>
      {isOpen && !disabled && (
        <>
          <div className="fixed inset-0 z-10" onClick={handleBackdropClick} />
          <div
            className="absolute -left-8 top-full z-20 mt-2 rounded-md border border-light-200 bg-light-50 shadow-lg dark:border-dark-200 dark:bg-dark-100"
            onClick={(e) => {
              e.stopPropagation();
            }}
            onMouseDown={(e) => {
              e.stopPropagation();
            }}
          >
            <DateSelector
              selectedDate={pendingDate ?? undefined}
              onDateSelect={handleDateSelect}
            />
          </div>
        </>
      )}
    </div>
  );
}



================================================
FILE: apps/web/src/views/card/components/LabelSelector.tsx
================================================
import { t } from "@lingui/core/macro";
import { HiMiniPlus } from "react-icons/hi2";

import Badge from "~/components/Badge";
import CheckboxDropdown from "~/components/CheckboxDropdown";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface LabelSelectorProps {
  cardPublicId: string;
  labels: {
    key: string;
    value: string;
    selected: boolean;
    leftIcon: React.ReactNode;
  }[];
  isLoading: boolean;
  disabled?: boolean;
}

export default function LabelSelector({
  cardPublicId,
  labels,
  isLoading,
  disabled = false,
}: LabelSelectorProps) {
  const utils = api.useUtils();
  const { openModal } = useModal();
  const { showPopup } = usePopup();

  const addOrRemoveLabel = api.card.addOrRemoveLabel.useMutation({
    onMutate: async (update) => {
      await utils.card.byId.cancel();

      const previousCard = utils.card.byId.getData({ cardPublicId });

      utils.card.byId.setData({ cardPublicId }, (oldCard) => {
        if (!oldCard) return oldCard;

        const hasLabel = oldCard.labels.some(
          (label) => label.publicId === update.labelPublicId,
        );

        const labelToAdd = oldCard.labels.find(
          (label) => label.publicId === update.labelPublicId,
        );

        const updatedLabels = hasLabel
          ? oldCard.labels.filter(
              (label) => label.publicId !== update.labelPublicId,
            )
          : [
              ...oldCard.labels,
              {
                publicId: update.labelPublicId,
                name: labelToAdd?.name ?? "",
                colourCode: labelToAdd?.colourCode ?? "",
              },
            ];

        return {
          ...oldCard,
          labels: updatedLabels,
        };
      });

      return { previousCard };
    },
    onError: (_error, _newList, context) => {
      utils.card.byId.setData({ cardPublicId }, context?.previousCard);
      showPopup({
        header: t`Unable to update labels`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
    },
  });

  const selectedLabels = labels.filter((label) => label.selected);

  return (
    <>
      {isLoading ? (
        <div className="flex w-full">
          <div className="h-full w-[175px] animate-pulse rounded-[5px] bg-light-300 dark:bg-dark-300" />
        </div>
      ) : (
        <CheckboxDropdown
          items={labels}
          handleSelect={(_, label) => {
            addOrRemoveLabel.mutate({ cardPublicId, labelPublicId: label.key });
          }}
          handleEdit={disabled ? undefined : (labelPublicId) => openModal("EDIT_LABEL", labelPublicId)}
          handleCreate={disabled ? undefined : () => openModal("NEW_LABEL")}
          createNewItemLabel={t`Create new label`}
          disabled={disabled}
          asChild
        >
          {selectedLabels.length ? (
            <div className="flex flex-wrap gap-x-0.5">
              {selectedLabels.map((label) => (
                <Badge
                  key={label.key}
                  value={label.value}
                  iconLeft={label.leftIcon}
                />
              ))}
              <Badge value={t`Add label`} iconLeft={<HiMiniPlus size={14} />} />
            </div>
          ) : (
            <div className={`flex h-full w-full items-center rounded-[5px] border-[1px] border-light-50 pl-2 text-left text-sm text-neutral-900 dark:border-dark-50 dark:text-dark-1000 ${disabled ? "cursor-not-allowed opacity-60" : "hover:border-light-300 hover:bg-light-200 dark:hover:border-dark-200 dark:hover:bg-dark-100"}`}>
              <HiMiniPlus size={22} className="pr-2" />
              {t`Add label`}
            </div>
          )}
        </CheckboxDropdown>
      )}
    </>
  );
}



================================================
FILE: apps/web/src/views/card/components/ListSelector.tsx
================================================
import { t } from "@lingui/core/macro";

import CheckboxDropdown from "~/components/CheckboxDropdown";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface ListSelectorProps {
  cardPublicId: string;
  lists: {
    key: string;
    value: string;
    selected: boolean;
  }[];
  isLoading: boolean;
  disabled?: boolean;
}

export default function ListSelector({
  cardPublicId,
  lists,
  isLoading,
  disabled = false,
}: ListSelectorProps) {
  const utils = api.useUtils();

  const { showPopup } = usePopup();

  const updateCardList = api.card.update.useMutation({
    onMutate: async (newList) => {
      await utils.card.byId.cancel();

      const previousCard = utils.card.byId.getData({ cardPublicId });

      utils.card.byId.setData({ cardPublicId }, (oldCard) => {
        if (!oldCard) return oldCard;

        return {
          ...oldCard,
          list: {
            ...oldCard.list,
            publicId: newList.listPublicId ?? "",
            name: oldCard.list.name ?? "",
            board: oldCard.list.board ?? null,
          },
        };
      });

      return { previousCard };
    },
    onError: (_error, _newList, context) => {
      utils.card.byId.setData({ cardPublicId }, context?.previousCard);
      showPopup({
        header: t`Unable to update list`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
    },
  });

  const selectedList = lists.find((list) => list.selected);

  return (
    <>
      {isLoading ? (
        <div className="flex w-full">
          <div className="h-full w-[150px] animate-pulse rounded-[5px] bg-light-300 dark:bg-dark-300" />
        </div>
      ) : (
        <CheckboxDropdown
          items={lists}
          handleSelect={(_, member) => {
            updateCardList.mutate({
              cardPublicId,
              listPublicId: member.key,
              index: 0,
            });
          }}
          disabled={disabled}
          asChild
        >
          <div className={`flex h-full w-full items-center rounded-[5px] border-[1px] border-light-50 py-1 pl-2 text-left text-xs text-neutral-900 dark:border-dark-50 dark:text-dark-1000 ${disabled ? "cursor-not-allowed opacity-60" : "hover:border-light-300 hover:bg-light-200 dark:hover:border-dark-200 dark:hover:bg-dark-100"}`}>
            {selectedList?.value}
          </div>
        </CheckboxDropdown>
      )}
    </>
  );
}



================================================
FILE: apps/web/src/views/card/components/MemberSelector.tsx
================================================
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { HiMiniPlus } from "react-icons/hi2";

import Avatar from "~/components/Avatar";
import CheckboxDropdown from "~/components/CheckboxDropdown";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface MemberSelectorProps {
  cardPublicId: string;
  members: {
    key: string;
    value: string;
    selected: boolean;
    leftIcon: React.ReactNode;
    imageUrl: string | undefined;
  }[];
  isLoading: boolean;
  disabled?: boolean;
}

export default function MemberSelector({
  cardPublicId,
  members,
  isLoading,
  disabled = false,
}: MemberSelectorProps) {
  const router = useRouter();
  const utils = api.useUtils();
  const { openModal } = useModal();
  const { showPopup } = usePopup();

  const addOrRemoveMember = api.card.addOrRemoveMember.useMutation({
    onMutate: async (update) => {
      await utils.card.byId.cancel();

      const previousCard = utils.card.byId.getData({ cardPublicId });

      utils.card.byId.setData({ cardPublicId }, (oldCard) => {
        if (!oldCard) return oldCard;

        const hasMember = oldCard.members.some(
          (member) => member.publicId === update.workspaceMemberPublicId,
        );

        const memberToAdd = oldCard.members.find(
          (member) => member.publicId === update.workspaceMemberPublicId,
        );

        const updatedMembers = hasMember
          ? oldCard.members.filter(
              (member) => member.publicId !== update.workspaceMemberPublicId,
            )
          : [
              ...oldCard.members,
              {
                publicId: update.workspaceMemberPublicId,
                email: memberToAdd?.email ?? "",
                deletedAt: null,
                user: {
                  id: memberToAdd?.user?.id ?? "",
                  name: memberToAdd?.user?.name ?? "",
                },
              },
            ];

        return {
          ...oldCard,
          members: updatedMembers,
        };
      });

      return { previousCard };
    },
    onError: (_error, _newList, context) => {
      utils.card.byId.setData({ cardPublicId }, context?.previousCard);
      showPopup({
        header: t`Unable to update members`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
    },
  });

  const selectedMembers = members.filter((member) => member.selected);

  const handleInviteMember = async () => {
    await router.push(`/members`);
    openModal("INVITE_MEMBER");
  };

  return (
    <>
      {isLoading ? (
        <div className="flex w-full">
          <div className="h-full w-[125px] animate-pulse rounded-[5px] bg-light-300 dark:bg-dark-300" />
        </div>
      ) : (
        <CheckboxDropdown
          items={members}
          handleSelect={(_, member) => {
            addOrRemoveMember.mutate({
              cardPublicId,
              workspaceMemberPublicId: member.key,
            });
          }}
          handleCreate={disabled ? undefined : handleInviteMember}
          createNewItemLabel={t`Invite member`}
          disabled={disabled}
          asChild
        >
          <div className={`flex h-full w-full items-center rounded-[5px] border-[1px] border-light-50 py-1 pl-2 text-left text-xs text-neutral-900 dark:border-dark-50 dark:text-dark-1000 ${disabled ? "cursor-not-allowed opacity-60" : "hover:border-light-300 hover:bg-light-200 dark:hover:border-dark-200 dark:hover:bg-dark-100"}`}>
            {selectedMembers.length ? (
              <div className="isolate flex justify-end -space-x-1 overflow-hidden">
                {selectedMembers.map(({ value, imageUrl }) => (
                  <Avatar
                    key={value}
                    size="sm"
                    name={value}
                    imageUrl={imageUrl}
                    email={value}
                  />
                ))}
              </div>
            ) : (
              <>
                <HiMiniPlus size={22} className="pr-2" />
                {t`Add member`}
              </>
            )}
          </div>
        </CheckboxDropdown>
      )}
    </>
  );
}



================================================
FILE: apps/web/src/views/card/components/NewChecklistForm.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect } from "react";
import { useForm } from "react-hook-form";
import { HiXMark } from "react-icons/hi2";

import { generateUID } from "@kan/shared/utils";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface NewChecklistFormInput {
  name: string;
  cardPublicId: string;
}

export function NewChecklistForm({ cardPublicId }: { cardPublicId: string }) {
  const { closeModal, setModalState } = useModal();
  const { showPopup } = usePopup();

  const utils = api.useUtils();

  const { register, handleSubmit, reset, watch } =
    useForm<NewChecklistFormInput>({
      defaultValues: {
        name: "Checklist",
        cardPublicId,
      },
    });

  const createChecklist = api.checklist.create.useMutation({
    onMutate: async (args) => {
      await utils.card.byId.cancel({ cardPublicId: args.cardPublicId });
      const previous = utils.card.byId.getData({
        cardPublicId: args.cardPublicId,
      });
      utils.card.byId.setData({ cardPublicId: args.cardPublicId }, (old) => {
        if (!old) return old as any;
        const placeholderChecklist = {
          publicId: `PLACEHOLDER_${generateUID()}`,
          name: args.name,
          index: old.checklists.length,
          items: [] as {
            publicId: string;
            title: string;
            completed: boolean;
            index: number;
          }[],
        };
        return {
          ...old,
          checklists: [...old.checklists, placeholderChecklist],
        } as typeof old;
      });
      return { previous };
    },
    onSuccess: (data) => {
      setModalState("ADD_CHECKLIST", { createdChecklistId: data.publicId });
    },
    onError: (_error, vars, ctx) => {
      if (ctx?.previous)
        utils.card.byId.setData(
          { cardPublicId: vars.cardPublicId },
          ctx.previous,
        );
      showPopup({
        header: t`Unable to create checklist`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async (_data, _error, vars) => {
      await invalidateCard(utils, vars.cardPublicId);
    },
  });

  useEffect(() => {
    const nameElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#checklist-name");
    if (nameElement) nameElement.focus();
  }, []);

  const onSubmit = (data: NewChecklistFormInput) => {
    closeModal();
    reset({
      name: "",
    });

    createChecklist.mutate({
      name: data.name,
      cardPublicId: data.cardPublicId,
    });
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-4">
          <h2 className="text-sm font-bold text-neutral-900 dark:text-dark-1000">
            {t`New checklist`}
          </h2>
          <button
            type="button"
            className="rounded p-1 hover:bg-light-200 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>

        <Input
          id="checklist-name"
          placeholder={t`Checklist name`}
          {...register("name")}
          onKeyDown={async (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
          }}
        />
      </div>
      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <div>
          <Button
            type="submit"
            disabled={createChecklist.isPending || !watch("name")}
          >
            {t`Create checklist`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/views/card/components/NewChecklistItemForm.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect, useRef } from "react";
import ContentEditable from "react-contenteditable";
import { useForm } from "react-hook-form";

import { generateUID } from "@kan/shared/utils";

import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface FormValues {
  title: string;
}

interface NewChecklistItemFormProps {
  checklistPublicId: string;
  cardPublicId: string;
  onCancel: () => void;
  readOnly?: boolean;
}

const NewChecklistItemForm = ({
  checklistPublicId,
  cardPublicId,
  onCancel,
  readOnly = false,
}: NewChecklistItemFormProps) => {
  const utils = api.useUtils();
  const { showPopup } = usePopup();

  const { setValue, watch, reset, getValues } = useForm<FormValues>({
    defaultValues: {
      title: "",
    },
  });

  const title = watch("title");

  const editableRef = useRef<HTMLElement | null>(null);
  const keepOpenRef = useRef(false);

  const refocusEditable = () => {
    const el = editableRef.current;
    if (!el) return;
    if (readOnly) return;
    el.focus();

    // hack to ensure the input is focused after creating new checklist item
    setTimeout(() => {
      el.focus();
    }, 100);
  };

  const addChecklistItemMutation = api.checklist.createItem.useMutation({
    onMutate: async (vars) => {
      await utils.card.byId.cancel({ cardPublicId });
      const previous = utils.card.byId.getData({ cardPublicId });

      utils.card.byId.setData({ cardPublicId }, (old) => {
        if (!old) return old as any;
        const placeholder = {
          publicId: `PLACEHOLDER_${generateUID()}`,
          title: vars.title,
          completed: false,
        };
        const updatedChecklists = old.checklists.map((cl) =>
          cl.publicId === checklistPublicId
            ? { ...cl, items: [...cl.items, placeholder] }
            : cl,
        );
        return { ...old, checklists: updatedChecklists } as typeof old;
      });

      if (keepOpenRef.current) {
        reset({ title: "" });
        if (editableRef.current) editableRef.current.innerHTML = "";
        refocusEditable();
      } else {
        onCancel();
      }

      return { previous };
    },
    onError: (_err, _vars, ctx) => {
      if (ctx?.previous)
        utils.card.byId.setData({ cardPublicId }, ctx.previous);
      showPopup({
        header: t`Unable to add checklist item`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await invalidateCard(utils, cardPublicId);
    },
  });

  const sanitizeHtmlToPlainText = (html: string): string => {
    return html
      .replace(/<br\s*\/?>(\n)?/gi, "\n")
      .replace(/<div><br\s*\/?><\/div>/gi, "")
      .replace(/<[^>]*>/g, "")
      .replace(/&nbsp;/g, " ")
      .trim();
  };

  const submitIfNotEmpty = (keepOpen: boolean) => {
    if (readOnly) return;
    keepOpenRef.current = keepOpen;
    const currentHtml = getValues("title") ?? "";
    const plain = sanitizeHtmlToPlainText(currentHtml);
    if (!plain) {
      onCancel();
      return;
    }
    addChecklistItemMutation.mutate({
      checklistPublicId,
      title: plain,
    });
  };

  useEffect(() => {
    refocusEditable();
  }, []);

  return (
    <form onSubmit={(e) => e.preventDefault()}>
      <div className="group relative flex h-9 items-center gap-3 rounded-md pl-4 hover:bg-light-100 dark:hover:bg-dark-100">
        <label className="relative inline-flex h-[16px] w-[16px] flex-shrink-0 cursor-default items-center justify-center">
          <input
            type="checkbox"
            disabled
            className="peer h-[16px] w-[16px] appearance-none rounded-md border border-light-500 bg-transparent outline-none ring-0 hover:border-light-500 hover:bg-transparent focus:outline-none focus:ring-0 focus-visible:outline-none dark:border-dark-500 dark:hover:border-dark-500"
          />
        </label>
        <div className="flex-1 pr-7">
          <ContentEditable
            id={`checklist-item-input-${checklistPublicId}`}
            tabIndex={readOnly ? -1 : 0}
            placeholder={t`Add an item...`}
            html={title}
            disabled={readOnly}
            onChange={(e) => setValue("title", e.target.value)}
            className="m-0 min-h-[20px] w-full p-0 text-sm leading-5 text-light-900 outline-none focus-visible:outline-none dark:text-dark-950"
            onBlur={() => submitIfNotEmpty(false)}
            onKeyDown={async (e) => {
              if (readOnly) return;
              if (e.key === "Enter") {
                e.preventDefault();
                submitIfNotEmpty(true);
              }
              if (e.key === "Escape") {
                e.preventDefault();
                onCancel();
              }
            }}
            innerRef={(el) => {
              editableRef.current = (el as unknown as HTMLElement) ?? null;
            }}
          />
        </div>
      </div>
    </form>
  );
};

export default NewChecklistItemForm;



================================================
FILE: apps/web/src/views/card/components/NewCommentForm.tsx
================================================
import { t } from "@lingui/core/macro";
import { useForm } from "react-hook-form";
import { HiOutlineArrowUp } from "react-icons/hi2";

import Editor from "~/components/Editor";
import type { WorkspaceMember } from "~/components/Editor";
import LoadingSpinner from "~/components/LoadingSpinner";
import { usePermissions } from "~/hooks/usePermissions";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { invalidateCard } from "~/utils/cardInvalidation";

interface FormValues {
  comment: string;
}

const NewCommentForm = ({
  cardPublicId,
  workspaceMembers,
}: {
  cardPublicId: string;
  workspaceMembers: WorkspaceMember[];
}) => {
  const utils = api.useUtils();
  const { showPopup } = usePopup();
  const { canCreateComment } = usePermissions();
  const { handleSubmit, setValue, watch, reset } = useForm<FormValues>({
    values: {
      comment: "",
    },
  });

  const addCommentMutation = api.card.addComment.useMutation({
    onError: (_error, _newList) => {
      showPopup({
        header: t`Unable to add comment`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      reset();
      await invalidateCard(utils, cardPublicId);
    },
  });

  const onSubmit = (data: FormValues) => {
    addCommentMutation.mutate({
      cardPublicId,
      comment: data.comment,
    });
  };

  if (!canCreateComment) {
    return null;
  }

  return (
    <form
      onSubmit={handleSubmit(onSubmit)}
      className="flex w-full max-w-[800px] flex-col rounded-xl border border-light-600 bg-light-100 p-4 text-light-900 focus-visible:outline-none dark:border-dark-400 dark:bg-dark-100 dark:text-dark-1000 sm:text-sm sm:leading-6"
    >
      <Editor
        content={watch("comment")}
        onChange={(value) => setValue("comment", value)}
        workspaceMembers={workspaceMembers}
        enableYouTubeEmbed={false}
        placeholder={t`Add comment... (type '/' to open commands or '@' to mention)`}
        disableHeadings={true}
      />
      <div className="flex justify-end">
        <button
          type="submit"
          disabled={addCommentMutation.isPending}
          className="flex h-8 w-8 items-center justify-center rounded-full border border-light-600 bg-light-300 hover:bg-light-400 disabled:opacity-50 dark:border-dark-400 dark:bg-dark-200 dark:hover:bg-dark-400"
        >
          {addCommentMutation.isPending ? (
            <LoadingSpinner size="sm" />
          ) : (
            <HiOutlineArrowUp />
          )}
        </button>
      </div>
    </form>
  );
};

export default NewCommentForm;



================================================
FILE: apps/web/src/views/home/index.tsx
================================================
import Image from "next/image";
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";
import { useTheme } from "next-themes";
import { IoLogoGithub } from "react-icons/io";

import Button from "~/components/Button";
import { PageHead } from "~/components/PageHead";
import Cta from "./components/Cta";
import FAQs from "./components/Faqs";
import Features from "./components/Features";
import Layout from "./components/Layout";
import Logos from "./components/Logos";
import Testimonials from "./components/Testimonials";

export default function HomeView() {
  const { resolvedTheme } = useTheme();

  return (
    <Layout>
      <PageHead title="Kan.bn | The open source alternative to Trello" />
      <div className="flex h-full w-full flex-col lg:pt-[5rem]">
        <div className="w-full pb-10 pt-32 lg:py-32">
          <div className="my-10 flex h-full w-full animate-fade-down flex-col items-center justify-center px-4">
            <div className="flex items-center gap-2">
              <div className="relative animate-fade-in overflow-hidden rounded-full bg-gradient-to-b from-light-300 to-light-400 p-[2px] dark:from-dark-300 dark:to-dark-400">
                <div className="gradient-border absolute inset-0 animate-border-spin" />

                <div className="relative z-10 rounded-full bg-light-50 dark:bg-dark-50">
                  <Link
                    href="https://github.com/kanbn/kan"
                    rel="noopener noreferrer"
                    target="_blank"
                    className="flex items-center gap-2 px-4 py-1 text-center text-xs text-light-1000 dark:text-dark-1000 lg:text-sm"
                  >
                    {t`Star on Github`}
                    <IoLogoGithub size={20} />
                  </Link>
                </div>
              </div>

              {/* <div className="relative overflow-hidden rounded-full bg-gradient-to-b from-light-300 to-light-400 p-[2px] dark:from-dark-300 dark:to-dark-400">
                <div className="relative z-10 rounded-full bg-light-50 dark:bg-dark-50">
                  <Link
                    href="https://news.ycombinator.com/item?id=44157177"
                    rel="noopener noreferrer"
                    target="_blank"
                    className="flex items-center gap-2 px-4 py-1 text-center text-xs text-light-1000 dark:text-dark-1000 lg:text-sm"
                  >
                    {t`#1 Hacker News`}
                    <div className="relative">
                      <div className="absolute inset-1 bg-white" />
                      <IoLogoHackernews
                        size={20}
                        className="relative text-orange-500"
                      />
                    </div>
                  </Link>
                </div>
              </div> */}
            </div>

            <p className="mt-2 text-center text-4xl font-bold text-light-1000 dark:text-dark-1000 lg:text-5xl">
              <Trans>
                The open source <br /> alternative to Trello
              </Trans>
            </p>

            <p className="text-md mt-3 max-w-[450px] text-center text-light-950 dark:text-dark-900 lg:max-w-[600px] lg:text-lg">
              {t`A powerful, flexible kanban app that helps you organise work, track progress, and deliver resultsâ€”all in one place.`}
            </p>

            <div className="mt-6 flex gap-2">
              <Button href="/signup">{t`Get started on Cloud`}</Button>
              <Button
                variant="secondary"
                href="https://github.com/kanbn/kan"
                openInNewTab
              >
                {t`Self host with Github`}
              </Button>
            </div>
            <p className="mt-4 text-center text-sm text-light-950 dark:text-dark-900">
              {t`No credit card required`}
            </p>
          </div>
        </div>
        <div className="px-4 pb-10">
          <div className="rounded-[16px] border border-light-300 bg-light-50 p-1 shadow-md dark:border-dark-300 dark:bg-dark-100 lg:rounded-[24px] lg:p-2">
            <div className="relative overflow-hidden rounded-[12px] border border-light-300 shadow-sm dark:border-dark-300 lg:rounded-[16px]">
              <Image
                src={`/hero-light.png`}
                alt="kanban"
                width={1100}
                height={1000}
                className="block dark:hidden"
              />
              <Image
                src={`/hero-dark.png`}
                alt="kanban"
                width={1100}
                height={1000}
                className="hidden dark:block"
              />
            </div>
          </div>
        </div>
        <Logos />
        <div className="relative pt-10">
          <div id="features" className="absolute -top-20" />
          <Features theme={resolvedTheme === "dark" ? "dark" : "light"} />
        </div>
        <div className="relative pt-10">
          <div id="testimonials" className="absolute -top-20" />
          <Testimonials />
        </div>
        <div className="relative pt-10">
          <div id="faq" className="absolute -top-20" />
          <FAQs />
        </div>
        <div className="relative">
          <Cta theme={resolvedTheme ?? "light"} />
        </div>
      </div>
    </Layout>
  );
}



================================================
FILE: apps/web/src/views/home/components/Cta.tsx
================================================
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";

import Button from "~/components/Button";

const Cta = ({ theme }: { theme: string }) => {
  const [currentWorkspaceSlug, setCurrentWorkspaceSlug] = useState("acme");
  const [isVisible, setIsVisible] = useState(true);

  useEffect(() => {
    const workspaceSlugs = [
      "acme",
      "henry",
      "cal",
      "documenso",
      "jack",
      "openstatus",
      "florrie",
      "supabase",
    ];

    const interval = setInterval(() => {
      setIsVisible(false);
      setTimeout(() => {
        setCurrentWorkspaceSlug((prev) => {
          const currentIndex = workspaceSlugs.indexOf(prev);
          const nextIndex = (currentIndex + 1) % workspaceSlugs.length;
          const nextSlug = workspaceSlugs[nextIndex];
          if (!nextSlug) return prev;
          return nextSlug;
        });
        setIsVisible(true);
      }, 500);
    }, 3000);

    return () => clearInterval(interval);
  }, []);

  return (
    <div className="relative isolate overflow-hidden">
      <div className="px-6 py-24 sm:px-6 sm:py-32 lg:px-8">
        <div className="mx-auto flex max-w-2xl flex-col items-center text-center">
          <div
            className={`mb-8 flex items-center gap-2 rounded-2xl border bg-light-50 px-4 py-2 text-center text-sm font-bold text-light-1000 transition-all duration-500 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-950 lg:text-[16px] ${
              isVisible
                ? "translate-y-0 opacity-100"
                : "-translate-y-4 opacity-0"
            }`}
          >
            <p>kan.bn/{currentWorkspaceSlug}</p>
          </div>
          <h2 className="text-balance text-4xl font-bold tracking-tight text-light-1000 dark:text-dark-1000 sm:text-4xl">
            {t`Get started for free today`}
          </h2>
          <p className="text-md/8 mx-auto mt-6 max-w-[375px] text-pretty text-light-950 dark:text-dark-900">
            {t`Unlimited boards, unlimited lists, unlimited cards. No credit card required.`}
          </p>
          <Link href="/signup">
            <div className="mt-10 flex items-center justify-center gap-x-6">
              <Button size="lg">{t`Get started`}</Button>
            </div>
          </Link>
        </div>
      </div>
      <svg
        viewBox="0 0 1024 1024"
        aria-hidden="true"
        className="absolute left-1/2 top-[65%] -z-10 size-[60rem] -translate-x-1/2 [mask-image:radial-gradient(closest-side,white,transparent)] lg:size-[64rem]"
      >
        <circle
          r={512}
          cx={512}
          cy={512}
          fill="url(#8d958450-c69f-4251-94bc-4e091a323369)"
          fillOpacity="0.7"
        />
        <defs>
          <radialGradient id="8d958450-c69f-4251-94bc-4e091a323369">
            <stop
              stopColor={theme === "light" ? "hsl(0deg 0% 52.2%)" : "#505050"}
            />
            <stop
              offset={1}
              stopColor={theme === "light" ? "hsl(0deg 0% 43.5%)" : "#707070"}
            />
          </radialGradient>
        </defs>
      </svg>
    </div>
  );
};

export default Cta;



================================================
FILE: apps/web/src/views/home/components/Faqs.tsx
================================================
import Link from "next/link";
import {
  Disclosure,
  DisclosureButton,
  DisclosurePanel,
} from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";
import { HiMiniMinusSmall, HiMiniPlusSmall } from "react-icons/hi2";

const Text = ({ children }: { children: React.ReactNode }) => {
  return (
    <p className="text-[14px] leading-[1.7rem] text-light-800 dark:text-dark-800">
      {children}
    </p>
  );
};

const Faqs = () => {
  const faqs = [
    {
      question: t`Why make an open source Trello?`,
      answer: (
        <Text>
          {t`When Trello launched in 2011, it blew everyone away with its carefully designed simplicity, but over the years it lost its magic and grew into something closer to "Jira Lite". This project is our attempt to recapture the original magic of Trello's simplicity, in open source.`}
        </Text>
      ),
    },
    {
      question: t`What's the difference between Kan and Trello?`,
      answer: (
        <Text>
          {t`The main difference between Kan and Trello is that Kan is open source, allowing anyone to view, modify, and contribute to our code. Our cloud offering also offers no restrictions on features for individual use, whereas Trello locks basic features such as the number of boards you can create behind a paywall.`}
        </Text>
      ),
    },
    {
      question: t`How is the project funded?`,
      answer: (
        <Text>
          {t`For long-term sustainability, we recognise all good open source projects need a source of revenue. Ours comes from the paid cloud offering for workspaces with multiple users and for custom workspace slugs. There's no obligation to use it, and you can self-host the software on your own infrastructure free of charge.`}
        </Text>
      ),
    },
    {
      question: t`How do I import my Trello boards?`,
      answer: (
        <Text>
          <Trans>
            Importing your Trello boards into Kan is easy. You can follow our
            step-by-step guide{" "}
            <Link
              href="https://docs.kan.bn/imports/trello"
              className="underline"
            >
              here
            </Link>
            .
          </Trans>
        </Text>
      ),
    },
    {
      question: t`How do I get a custom URL?`,
      answer: (
        <Text>
          <Trans>
            You can get a custom workspace URL, like{" "}
            <Link href="https://kan.bn/kan" className="underline">
              kan.bn/kan
            </Link>
            , by going into your{" "}
            <Link href="https://kan.bn/settings" className="underline">
              workspace settings
            </Link>{" "}
            and purchasing a pro workspace subscription. All subscriptions help
            fund the development of the project!
          </Trans>
        </Text>
      ),
    },
    {
      question: t`Do you offer a free plan?`,
      answer: (
        <Text>
          {t`Yes, we offer an forever free plan for individual use. No restrictions, no paywalls, no limits.`}
        </Text>
      ),
    },
    {
      question: t`What license are you using?`,
      answer: (
        <Text>
          <Trans>
            We are using the{" "}
            <Link
              href="https://github.com/kan-bn/kan/blob/main/LICENSE"
              className="underline"
            >
              AGPL-3.0 license
            </Link>
            .
          </Trans>
        </Text>
      ),
    },
    {
      question: t`How do I invite team members?`,
      answer: (
        <Text>
          <Trans>
            You can invite team members by clicking the "Invite" button in the
            top right corner of the{" "}
            <Link href="https://kan.bn/members" className="underline">
              members page
            </Link>{" "}
            and entering their email address. They will receive an email with a
            link to join the workspace.
          </Trans>
        </Text>
      ),
    },
    {
      question: t`How do I self-host?`,
      answer: (
        <Text>
          <Trans>
            You can self-host by following the instructions in our{" "}
            <Link href="https://github.com/kanbn/kan" className="underline">
              repo
            </Link>
            .
          </Trans>
        </Text>
      ),
    },
  ];

  return (
    <div className="mx-auto max-w-[900px] px-4">
      <div className="flex flex-col items-center justify-center pb-12">
        <div className="flex items-center gap-2 rounded-full border bg-light-50 px-4 py-1 text-center text-xs text-light-1000 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900 lg:text-sm">
          <p>{t`FAQs`}</p>
        </div>

        <p className="mt-2 text-center text-3xl font-bold text-light-1000 dark:text-dark-1000 lg:text-4xl">
          {t`Questions?`}
        </p>
        <p className="text lg:text-md mt-3 max-w-[500px] text-center text-light-950 dark:text-dark-900">
          <Trans>
            Find answers to common questions about Kan. Can't find what you're
            looking for? Feel free to{" "}
            <Link href="mailto:support@kan.bn" className="underline">
              contact us
            </Link>
            .
          </Trans>
        </p>
      </div>
      <div className="rounded-2xl bg-light-50 ring-1 ring-light-300 dark:bg-dark-50 dark:ring-dark-200">
        <div className="mx-auto max-w-7xl px-6 py-20 lg:px-16">
          <div className="mx-auto max-w-4xl">
            <dl className="divide-y divide-light-300 dark:divide-dark-200">
              {faqs.map((faq) => (
                <Disclosure
                  key={faq.question}
                  as="div"
                  className="py-5 first:pt-0 last:pb-0"
                >
                  <dt>
                    <DisclosureButton className="group flex w-full items-center justify-between text-left text-light-1000 dark:text-dark-1000">
                      <span className="text-[14px] font-semibold">
                        {faq.question}
                      </span>
                      <span className="ml-6 flex h-7 items-center text-light-800 dark:text-dark-800">
                        <HiMiniPlusSmall
                          aria-hidden="true"
                          className="size-6 group-data-[open]:hidden"
                        />
                        <HiMiniMinusSmall
                          aria-hidden="true"
                          className="size-6 group-[&:not([data-open])]:hidden"
                        />
                      </span>
                    </DisclosureButton>
                  </dt>
                  <DisclosurePanel as="dd" className="mt-2 pr-12">
                    {faq.answer}
                  </DisclosurePanel>
                </Disclosure>
              ))}
            </dl>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Faqs;



================================================
FILE: apps/web/src/views/home/components/Features.tsx
================================================
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { useState } from "react";

import activityLogsIconDark from "~/assets/activity-logs-dark.json";
import activityLogsIconLight from "~/assets/activity-logs-light.json";
import boardVisibilityIconDark from "~/assets/board-visibility-dark.json";
import boardVisibilityIconLight from "~/assets/board-visibility-light.json";
import commentsIconDark from "~/assets/comments-dark.json";
import commentsIconLight from "~/assets/comments-light.json";
import importsIconDark from "~/assets/imports-dark.json";
import importsIconLight from "~/assets/imports-light.json";
import integrationsIconDark from "~/assets/integrations-dark.json";
import integrationsIconLight from "~/assets/integrations-light.json";
import labelsIconDark from "~/assets/labels-dark.json";
import labelsIconLight from "~/assets/labels-light.json";
import membersIconDark from "~/assets/members-dark.json";
import membersIconLight from "~/assets/members-light.json";
import templatesIconDark from "~/assets/templates-dark.json";
import templatesIconLight from "~/assets/templates-light.json";
import LottieIcon from "~/components/LottieIcon";

const FeatureItem = ({
  feature,
}: {
  feature: {
    title: string;
    description: string;
    icon: Record<string, unknown>;
    comingSoon?: boolean;
    new?: boolean;
  };
}) => {
  const [isHovered, setIsHovered] = useState(false);
  const [index, setIndex] = useState(0);

  const handleMouseEnter = () => {
    setIsHovered(true);
    setIndex((index) => index + 1);
  };

  return (
    <div
      onMouseEnter={handleMouseEnter}
      className="group relative flex aspect-square w-full flex-col items-center justify-center overflow-hidden rounded-3xl border border-light-200 bg-light-50 p-2 dark:border-dark-200 dark:bg-dark-50"
    >
      <div className="absolute left-8 top-8 h-2 w-2 rounded-full bg-light-200 dark:bg-dark-200" />
      <div className="absolute right-8 top-8 h-2 w-2 rounded-full bg-light-200 dark:bg-dark-200" />
      <div className="absolute bottom-8 left-8 h-2 w-2 rounded-full bg-light-200 dark:bg-dark-200" />
      <div className="absolute bottom-8 right-8 h-2 w-2 rounded-full bg-light-200 dark:bg-dark-200" />

      <div className="flex h-10 w-10 items-center justify-center rounded-xl border border-light-300 bg-light-200 dark:border-dark-600 dark:bg-dark-200">
        <LottieIcon index={index} json={feature.icon} isPlaying={isHovered} />
      </div>

      <div className="relative mt-2 w-full px-4 text-center">
        <p className="text-sm font-bold text-light-1000 dark:text-dark-1000 sm:transition-opacity sm:duration-200 sm:group-hover:opacity-0">
          {feature.title}
        </p>
        <p className="max mt-2 text-sm text-light-950 dark:text-dark-900 sm:absolute sm:inset-0 sm:mt-0 sm:opacity-0 sm:transition-opacity sm:duration-200 sm:group-hover:opacity-100">
          {feature.description}
        </p>
      </div>

      {feature.comingSoon && (
        <div className="absolute right-4 top-4 rounded-full border border-light-300 px-2 py-1 text-[10px] text-light-1000 dark:border-dark-600 dark:bg-dark-50 dark:text-dark-900">
          {t`Coming soon`}
        </div>
      )}

      {feature.new && (
        <div className="absolute right-4 top-4 rounded-full border border-light-300 px-2 py-1 text-[10px] text-light-1000 dark:border-dark-600 dark:bg-dark-50 dark:text-dark-900">
          {t`New`}
        </div>
      )}
    </div>
  );
};

const Features = ({ theme }: { theme: "light" | "dark" }) => {
  const isDark = theme === "dark";

  const features = [
    {
      title: t`Board visibility`,
      description: t`Control who can view and edit your boards.`,
      icon: isDark ? boardVisibilityIconDark : boardVisibilityIconLight,
    },
    {
      title: t`Workspace members`,
      description: t`Collaborate seamlessly with your team.`,
      icon: isDark ? membersIconDark : membersIconLight,
    },
    {
      title: t`Trello imports`,
      description: t`Import your Trello boards and hit the ground running.`,
      icon: isDark ? importsIconDark : importsIconLight,
    },
    {
      title: t`Labels & Filters`,
      description: t`Organize and find cards quickly with powerful filtering tools.`,
      icon: isDark ? labelsIconDark : labelsIconLight,
    },
    {
      title: t`Comments`,
      description: t`Discuss and collaborate on cards.`,
      icon: isDark ? commentsIconDark : commentsIconLight,
    },
    {
      title: t`Activity logs`,
      description: t`Track all card changes with detailed activity history.`,
      icon: isDark ? activityLogsIconDark : activityLogsIconLight,
    },
    {
      title: t`Templates`,
      description: t`Save time with reusable board templates.`,
      icon: isDark ? templatesIconDark : templatesIconLight,
      new: true,
    },
    {
      title: t`Integrations`,
      description: t`Connect your favorite tools to streamline your workflow.`,
      icon: isDark ? integrationsIconDark : integrationsIconLight,
      comingSoon: true,
    },
  ];

  return (
    <>
      <div className="flex flex-col items-center justify-center px-4 pb-24">
        <div className="flex items-center gap-2 rounded-full border bg-light-50 px-4 py-1 text-center text-xs text-light-1000 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900 lg:text-sm">
          <p>{t`Features`}</p>
        </div>

        <p className="mt-2 text-center text-3xl font-bold text-light-1000 dark:text-dark-1000 lg:text-4xl">
          {t`Kanban reimagined`}
        </p>
        <p className="text-md lg:text-md mt-3 max-w-[500px] text-center text-light-950 dark:text-dark-900">
          {t`Simple, visual task management that just works. Drag and drop cards, collaborate with your team, and get more done.`}
        </p>
        <div className="mx-auto mt-16 w-full max-w-7xl">
          <div className="grid w-full grid-cols-1 gap-4 [mask-image:linear-gradient(to_bottom,black_92%,transparent_100%)] sm:grid-cols-2 md:grid-cols-3 md:[mask-image:linear-gradient(to_bottom,black_85%,transparent_100%)] lg:grid-cols-4 lg:[mask-image:linear-gradient(to_bottom,black_85%,transparent_100%)]">
            {features.map((feature, index) => (
              <FeatureItem key={`feature-${index}`} feature={feature} />
            ))}
          </div>
        </div>

        <div>
          <div className="mt-8 flex items-center gap-2 rounded-full border bg-light-50 px-4 py-1 text-center text-sm text-light-1000 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900">
            <p className="text-xs lg:text-sm">
              {t`We're just getting started. `}
              <Link href="/kan/roadmap" className="underline">
                {t`View our roadmap.`}
              </Link>
            </p>
          </div>
        </div>
      </div>
    </>
  );
};

export default Features;



================================================
FILE: apps/web/src/views/home/components/Footer.tsx
================================================
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { FaDiscord, FaGithub } from "react-icons/fa";

import { LanguageSelector } from "~/components/LanguageSelector";

const StatusMarker = () => (
  <Link
    href="https://kan.openstatus.dev"
    target="_blank"
    rel="noopener noreferrer"
    className="flex w-fit items-center gap-1.5 rounded-full border border-light-300 py-2 pl-3 pr-4 text-xs text-light-950 hover:bg-light-100 dark:border-dark-300 dark:text-dark-800 dark:hover:bg-dark-100"
  >
    <span className="relative mr-1 h-2 w-2">
      <span className="absolute -inset-[1px] animate-[ping_1s_infinite] rounded-full bg-green-500/30"></span>
      <span className="absolute inset-0 rounded-full bg-green-500"></span>
    </span>
    {t`All systems operational`}
  </Link>
);

const Footer = () => {
  const navigation = {
    documentation: [
      { name: t`Getting started`, href: "https://docs.kan.bn/introduction" },
      {
        name: t`Importing from Trello`,
        href: "https://docs.kan.bn/imports/trello",
      },
      {
        name: t`API Reference`,
        href: "https://docs.kan.bn/api-reference/introduction",
      },
    ],
    company: [
      { name: t`Roadmap`, href: "/kan/roadmap" },
      { name: t`GitHub`, href: "https://github.com/kanbn/kan" },
      { name: t`Contact`, href: "mailto:support@kan.bn" },
      { name: t`OSS Friends`, href: "/oss-friends" },
    ],
    legal: [
      { name: t`Terms of service`, href: "/terms" },
      { name: t`Privacy policy`, href: "/privacy" },
      {
        name: t`License`,
        href: "https://github.com/kanbn/kan?tab=AGPL-3.0-1-ov-file#readme",
      },
    ],
    resources: [
      { name: t`Features`, href: "/#features" },
      { name: t`Pricing`, href: "/#pricing" },
      { name: t`FAQs`, href: "/#faq" },
    ],
  };

  return (
    <footer className="z-10 w-full border-t border-light-300 bg-light-50 py-8 dark:border-dark-300 dark:bg-dark-50">
      <div className="mx-auto max-w-7xl px-6 py-16 sm:py-24 lg:px-8 lg:py-24">
        <div className="xl:grid xl:grid-cols-3 xl:gap-8">
          <div>
            <div className="mb-2 flex items-center gap-2">
              <Link href="https://github.com/kanbn/kan" target="_blank">
                <FaGithub className="h-8 w-8 rounded-lg border border-light-300 p-1.5 text-light-1000 hover:bg-light-100 dark:border-dark-300 dark:text-dark-1000 dark:hover:bg-dark-100" />
              </Link>
              <Link href="https://discord.gg/e6ejRb6CmT" target="_blank">
                <FaDiscord className="h-8 w-8 rounded-lg border border-light-300 p-1.5 text-light-1000 hover:bg-light-100 dark:border-dark-300 dark:text-dark-1000 dark:hover:bg-dark-100" />
              </Link>
            </div>

            <StatusMarker />
            <LanguageSelector />
          </div>

          <div className="mt-16 grid grid-cols-2 gap-8 xl:col-span-2 xl:mt-0">
            <div className="md:grid md:grid-cols-2 md:gap-8">
              <div>
                <h3 className="text-sm/6 font-semibold text-light-1000 dark:text-dark-1000">
                  {t`Documentation`}
                </h3>
                <ul role="list" className="mt-6 space-y-4">
                  {navigation.documentation.map((item) => (
                    <li key={item.name}>
                      <a
                        href={item.href}
                        className="text-sm/6 text-light-900 hover:text-light-1000 dark:text-dark-950 dark:hover:text-dark-1000"
                      >
                        {item.name}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
              <div>
                <h3 className="mt-10 text-sm/6 font-semibold text-light-1000 dark:text-dark-1000 md:mt-0">
                  {t`Company`}
                </h3>
                <ul role="list" className="mt-6 space-y-4">
                  {navigation.company.map((item) => (
                    <li key={item.name}>
                      <a
                        href={item.href}
                        className="text-sm/6 text-light-900 hover:text-light-1000 dark:text-dark-950 dark:hover:text-dark-1000"
                      >
                        {item.name}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            </div>
            <div className="md:grid md:grid-cols-2 md:gap-8">
              <div>
                <h3 className="text-sm/6 font-semibold text-light-1000 dark:text-dark-1000">
                  {t`Resources`}
                </h3>
                <ul role="list" className="mt-6 space-y-4">
                  {navigation.resources.map((item) => (
                    <li key={item.name}>
                      <a
                        href={item.href}
                        className="text-sm/6 text-light-900 hover:text-light-1000 dark:text-dark-950 dark:hover:text-dark-1000"
                      >
                        {item.name}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
              <div>
                <h3 className="mt-10 text-sm/6 font-semibold text-light-1000 dark:text-dark-1000 md:mt-0">
                  {t`Legal`}
                </h3>
                <ul role="list" className="mt-6 space-y-4">
                  {navigation.legal.map((item) => (
                    <li key={item.name}>
                      <a
                        href={item.href}
                        className="text-sm/6 text-light-900 hover:text-light-1000 dark:text-dark-950 dark:hover:text-dark-1000"
                      >
                        {item.name}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  );
};

export default Footer;



================================================
FILE: apps/web/src/views/home/components/Header.tsx
================================================
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";
import { twMerge } from "tailwind-merge";

import Button from "~/components/Button";

const Header = ({ isLoggedIn }: { isLoggedIn: boolean }) => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);

  const desktopMenuItems = [
    {
      label: t`Roadmap`,
      href: "/kan/roadmap",
      openInNewTab: true,
    },
    { label: t`Features`, href: "/#features" },
    { label: t`Pricing`, href: "/pricing" },
    {
      label: t`Docs`,
      href: "https://docs.kan.bn",
      openInNewTab: true,
    },
  ];

  const mobileMenuItems = [
    {
      label: t`Roadmap`,
      href: "/kan/roadmap",
      openInNewTab: true,
      group: "Product",
    },
    { label: t`Features`, href: "/#features", group: "Product" },
    { label: t`Pricing`, href: "/pricing", group: "Product" },
    {
      label: t`Documentation`,
      href: "https://docs.kan.bn",
      openInNewTab: true,
      group: "Resources",
    },
    { label: t`FAQ`, href: "/#faq", group: "Resources" },
    { label: t`Contact`, href: "mailto:support@kan.bn", group: "Resources" },
  ];

  // Group mobile menu items by their group property
  const groupedMenuItems = mobileMenuItems.reduce(
    (acc, item) => {
      (acc[item.group] ??= []).push(item);
      return acc;
    },
    {} as Record<string, typeof mobileMenuItems>,
  );

  const toggleMenu = () => {
    setIsMenuOpen(!isMenuOpen);
  };

  useEffect(() => {
    document.documentElement.classList.toggle("overflow-hidden", isMenuOpen);
    document.body.classList.toggle("overflow-hidden", isMenuOpen);
    return () => {
      document.documentElement.classList.remove("overflow-hidden");
      document.body.classList.remove("overflow-hidden");
    };
  }, [isMenuOpen]);

  return (
    <>
      <div
        className={twMerge(
          "fixed z-50 flex w-full transition-all duration-500",
        )}
      >
        <div className="flex h-[4rem] min-h-[4rem] w-full border-b border-light-300 bg-light-50/80 px-5 py-2 align-middle opacity-100 shadow-sm backdrop-blur-[10px] transition-all duration-500 dark:border-dark-300 dark:bg-dark-50/90">
          <div className="mx-auto flex w-full max-w-[1100px] items-center justify-between lg:px-4">
            <div className="my-auto flex items-center justify-between">
              <Link href="/">
                <h1 className="text-lg font-bold tracking-tight text-neutral-900 dark:text-dark-1000 lg:w-[200px]">
                  kan.bn
                </h1>
              </Link>
            </div>
            {/* Desktop Menu */}
            <div className="hidden justify-center gap-10 dark:text-dark-1000 lg:flex">
              {desktopMenuItems.map((item) => (
                <Link
                  key={item.label}
                  href={item.href}
                  target={item.openInNewTab ? "_blank" : undefined}
                  rel={item.openInNewTab ? "noopener noreferrer" : undefined}
                  className="text-sm font-bold"
                >
                  {item.label}
                </Link>
              ))}
            </div>
            <div className="flex items-center justify-end gap-4 lg:w-[200px]">
              <div className="justify-end gap-2">
                {isLoggedIn ? (
                  <Button href="/boards">{t`Go to app`}</Button>
                ) : (
                  <div className="flex items-center justify-end gap-2">
                    <Button href="/login" variant="ghost">
                      {t`Sign in`}
                    </Button>
                    <Button href="/signup">{t`Get started`}</Button>
                  </div>
                )}
              </div>
              {/* Hamburger Menu Button */}
              <button
                onClick={toggleMenu}
                className="relative z-50 p-2 lg:hidden"
                aria-label={t`Toggle menu`}
              >
                <div
                  className={twMerge(
                    "absolute left-1/2 top-1/2 h-[1px] w-4 -translate-x-1/2 -translate-y-[4px] bg-current bg-light-1000 transition-all duration-300 ease-in-out dark:bg-dark-1000",
                    isMenuOpen ? "translate-y-0 rotate-45" : "",
                  )}
                />
                <div
                  className={twMerge(
                    "absolute left-1/2 top-1/2 h-[1px] w-4 -translate-x-1/2 translate-y-[4px] bg-current bg-light-1000 transition-all duration-300 ease-in-out dark:bg-dark-1000",
                    isMenuOpen ? "translate-y-0 -rotate-45" : "",
                  )}
                />
              </button>
            </div>
          </div>
        </div>
      </div>
      {/* Mobile Menu Overlay */}
      <div
        className={`fixed inset-0 z-40 transform transition-all duration-500 lg:hidden ${
          isMenuOpen
            ? "translate-x-0 opacity-100"
            : "pointer-events-none translate-x-0 opacity-0"
        }`}
      >
        <div className="absolute inset-0 bg-light-50/80 bg-white backdrop-blur-[15px] dark:bg-dark-50 dark:bg-dark-50/90">
          <div className="mt-[6rem] flex h-full flex-col space-y-8 px-5">
            {Object.entries(groupedMenuItems).map(([group, items]) => (
              <div key={group} className="flex flex-col space-y-4">
                <div className="text-sm font-bold text-light-900 dark:text-dark-900">
                  {group}
                </div>
                {items.map((item) => (
                  <Link
                    key={item.label}
                    href={item.href}
                    target={item.openInNewTab ? "_blank" : undefined}
                    rel={item.openInNewTab ? "noopener noreferrer" : undefined}
                    className="transform text-lg font-bold text-light-1000 dark:text-dark-1000"
                    onClick={() => setIsMenuOpen(false)}
                  >
                    {item.label}
                  </Link>
                ))}
              </div>
            ))}
          </div>
        </div>
      </div>
    </>
  );
};

export default Header;



================================================
FILE: apps/web/src/views/home/components/Layout.tsx
================================================
import { useTheme } from "next-themes";

import { authClient } from "@kan/auth/client";

import PatternedBackground from "~/components/PatternedBackground";
import Footer from "./Footer";
import Header from "./Header";

export default function Layout({ children }: { children: React.ReactNode }) {
  const { resolvedTheme } = useTheme();

  const { data: session } = authClient.useSession();

  const isLoggedIn = !!session?.user;

  const isDarkMode = resolvedTheme === "dark";

  return (
    <>
      <style jsx global>{`
        html {
          scroll-behavior: smooth;
          overflow: auto;
          background-color: ${!isDarkMode ? "hsl(0deg 0% 97.3%)" : "#161616"};
        }
      `}</style>
      <div className="mx-auto flex h-full min-h-screen min-w-[375px] flex-col items-center bg-light-100 dark:bg-dark-50">
        <PatternedBackground />
        <Header isLoggedIn={isLoggedIn} />
        <div className="z-10 mx-auto h-full w-full max-w-[1100px]">
          {children}
        </div>
        <Footer />
      </div>
    </>
  );
}



================================================
FILE: apps/web/src/views/home/components/Logos.tsx
================================================
import type { FC, SVGProps } from "react";
import { Trans } from "@lingui/react/macro";

import AirbusLogo from "~/assets/logos/airbus.svg";
import CouchbaseLogo from "~/assets/logos/couchbase.svg";
import DeloitteLogo from "~/assets/logos/deloitte.svg";
import FastCompanyLogo from "~/assets/logos/fast_company.svg";
import LegoLogo from "~/assets/logos/lego.svg";
import LinkedinLogo from "~/assets/logos/linkedin.svg";
import SanaLogo from "~/assets/logos/sana.svg";
import WakamLogo from "~/assets/logos/wakam.svg";

type LogoComponent = FC<SVGProps<SVGSVGElement>>;

export default function Logos() {
  const logos: {
    id: number;
    component: LogoComponent;
    alt: string;
  }[] = [
    {
      id: 1,
      component: SanaLogo as LogoComponent,
      alt: "Sana Logo",
    },
    {
      id: 2,
      component: FastCompanyLogo as LogoComponent,
      alt: "Fast Company Logo",
    },
    {
      id: 3,
      component: CouchbaseLogo as LogoComponent,
      alt: "Couchbase Logo",
    },
    {
      id: 4,
      component: LegoLogo as LogoComponent,
      alt: "Lego Logo",
    },
    {
      id: 5,
      component: AirbusLogo as LogoComponent,
      alt: "Airbus Logo",
    },
    {
      id: 6,
      component: DeloitteLogo as LogoComponent,
      alt: "Deloitte Logo",
    },
    {
      id: 7,
      component: WakamLogo as LogoComponent,
      alt: "Wakam Logo",
    },
    {
      id: 8,
      component: LinkedinLogo as LogoComponent,
      alt: "Linked In Logo",
    },
  ];

  return (
    <div className="w-full px-4 py-16">
      <div className="mb-8 text-center">
        <p className="text-sm font-medium text-light-800 dark:text-dark-800">
          <Trans>
            Trusted by fast-moving teams
            <br />
            around the world
          </Trans>
        </p>
      </div>

      <div className="relative overflow-hidden">
        <div className="absolute left-0 top-0 z-10 h-full w-8 bg-gradient-to-r from-white/60 to-transparent dark:from-dark-50" />
        <div className="absolute right-0 top-0 z-10 h-full w-8 bg-gradient-to-l from-white/60 to-transparent dark:from-dark-50" />

        <div className="flex animate-scroll" style={{ width: "max-content" }}>
          <div className="flex flex-shrink-0 items-center space-x-12">
            {logos.map((logo) => {
              const LogoComponent: LogoComponent = logo.component;
              return (
                <div
                  key={`first-${logo.id}`}
                  className="flex h-12 w-32 items-center justify-center"
                >
                  <LogoComponent
                    className="text-light-950 transition-all duration-300 hover:text-light-1000 dark:text-dark-950 hover:dark:text-dark-1000"
                    aria-label={logo.alt}
                  />
                </div>
              );
            })}
          </div>

          <div className="ml-12 flex flex-shrink-0 items-center space-x-12">
            {logos.map((logo) => {
              const LogoComponent: LogoComponent = logo.component;
              return (
                <div
                  key={`second-${logo.id}`}
                  className="flex h-12 w-32 items-center justify-center"
                >
                  <LogoComponent
                    className="text-light-950 transition-all duration-300 hover:text-light-1000 dark:text-dark-950 hover:dark:text-dark-1000"
                    aria-label={logo.alt}
                  />
                </div>
              );
            })}
          </div>
        </div>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/home/components/Testimonials.tsx
================================================
import Image from "next/image";
import { t } from "@lingui/core/macro";
import { twMerge } from "tailwind-merge";

interface Testimonial {
  name: string;
  handle: string;
  image?: string;
  colour?: string;
  text: string | React.ReactNode;
  role?: string;
  link?: string;
  rowSpan?: number;
}

const TestimonialCard = ({
  testimonial,
  rowSpan,
}: {
  testimonial: Testimonial;
  rowSpan?: number;
}) => {
  // Generate initials for avatar
  const initials = testimonial.name
    .split(" ")
    .map((n) => n[0])
    .join("")
    .toUpperCase();

  return (
    <div
      className={twMerge(
        "group relative rounded-2xl border border-light-200 bg-light-50 p-6 transition-all duration-200 hover:shadow-sm dark:border-dark-200 dark:bg-dark-50",
        rowSpan === 2 ? "md:row-span-2" : "",
      )}
    >
      <div className="flex items-start gap-3">
        {testimonial.image ? (
          <div className="relative h-10 w-10 shrink-0 overflow-hidden rounded-full">
            <Image
              src={testimonial.image}
              alt={testimonial.name}
              fill
              className="object-cover"
            />
          </div>
        ) : (
          <div
            className="flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-sm font-semibold text-light-50 dark:text-dark-1000"
            style={
              testimonial.colour
                ? { backgroundColor: testimonial.colour }
                : undefined
            }
          >
            {initials}
          </div>
        )}

        <div className="flex-1">
          <div className="flex items-center gap-2">
            <p className="font-semibold text-light-1000 dark:text-dark-1000">
              {testimonial.name}
            </p>
          </div>
          {testimonial.link ? (
            <a
              href={testimonial.link}
              target="_blank"
              rel="noopener noreferrer"
              className="-mt-1 block text-sm text-light-800 transition-colors hover:text-light-900 dark:text-dark-800 dark:hover:text-dark-900"
            >
              {testimonial.handle}
            </a>
          ) : (
            <p className="-mt-0.5 block text-sm text-light-800 dark:text-dark-800">
              {testimonial.handle}
            </p>
          )}
          {testimonial.role && (
            <p className="text-xs text-light-600 dark:text-dark-600">
              {testimonial.role}
            </p>
          )}
        </div>
      </div>

      <div className="mt-4 text-sm leading-relaxed text-light-950 dark:text-dark-900">
        <p>{testimonial.text}</p>
      </div>
    </div>
  );
};

const Testimonials = () => {
  const testimonials: Testimonial[] = [
    {
      name: "Bobby CompÃ¼ters",
      handle: "@bobbycomputers",
      image: "/testimonials/avatars/bobby_computers.jpg",
      text: (
        <>
          Holy crap I love this app. It's brutally minimal but somehow has
          everything I need.
        </>
      ),
      link: "https://x.com/bobbycomputers",
    },
    {
      name: "JR Raphael",
      handle: "@JRRaphael",
      image: "/testimonials/avatars/jrraphael.png",
      link: "https://www.fastcompany.com/91376028/trello-alternative-kan",
      rowSpan: 2,
      text: (
        <>
          The interesting thing about signing into Kan for the first time is
          that it feels new and electrifyingâ€”and yet simultaneously quite
          familiar, especially if youâ€™ve spent any time in Trello over the
          years.
          <br />
          <br />
          As someone who connected more with Trelloâ€™s original vision and mostly
          just tolerated the more recent pivots and additions, itâ€™s a bit of a
          revelation to use.
          <br />
          <br />
          At its core, Kan gives you a super-minimalist and frills-free
          Trello-style Kanban board. And the extent to which it has been able to
          build upon the original Trello vision is staggering.
        </>
      ),
    },
    {
      name: "singiamtel",
      handle: "@singiamtel",
      colour: "#ff6600",
      text: <>The project seems nice, but how good is that domain name</>,
      link: "https://news.ycombinator.com/item?id=44157177",
    },

    {
      name: "Jan Stgmnn",
      handle: "@JanStgmnn",
      image: "/testimonials/avatars/jan_stgmnn.jpg",
      link: "https://x.com/JanStgmnn",
      text: (
        <>
          Just wanted to say, that I really love the project. It's so easy to
          use and has a really nice UI!
        </>
      ),
    },
    {
      name: "Fox",
      handle: "@dscfox",
      image: "/testimonials/avatars/fox.png",
      link: "https://discord.gg/e6ejRb6CmT",
      rowSpan: 2,
      text: (
        <>
          I've been looking at alternatives for months, but everything came up
          short.
          <br />
          <br />
          Some were direct clones, but lacked features I was dependent on.
          Others were rich in features, but strayed too far away from the
          simplicity of Trello.
          <br />
          <br />
          This seems like the best alternative to Trello for me.
        </>
      ),
    },
    {
      name: "Hanno Braun",
      handle: "@hannobraun",
      image: "/testimonials/avatars/hanno_braun.webp",
      link: "https://discord.gg/e6ejRb6CmT",
      text: (
        <>
          I've been very impressed with the app so far! It's great to have such
          a nice open source alternative to Trello.
        </>
      ),
    },
    {
      name: "headlessdev_",
      handle: "@headlessdev_",
      image: "/testimonials/avatars/headless_dev.png",
      link: "https://www.reddit.com/r/selfhosted/comments/1l1f2st/i_made_an_opensource_alternative_to_trello/",
      text: <>This is the best thing I've seen here in a long time</>,
    },
    {
      name: "EHB",
      handle: "@ehb3839",
      image: "/testimonials/avatars/ehb.webp",
      link: "https://www.reddit.com/r/selfhosted/comments/1l1f2st/i_made_an_opensource_alternative_to_trello/",
      text: (
        <>
          It's exactly what I've been looking for recently. The simplicity of
          the overall app is a pleasure to use.
        </>
      ),
    },
    {
      name: "Tasneema Waquar",
      handle: "@tasneema_waquar",
      image: "/testimonials/avatars/tasneema_waquar.jpeg",
      link: "https://www.producthunt.com/products/kan-bn/reviews",
      text: (
        <>
          The design of this project management tool is impressive. The
          interface is intuitive, free of unnecessary clutter, and comes with a
          solid selection of templates.
        </>
      ),
    },
    {
      name: "BRAVO68WEB",
      handle: "@bravo68web",
      image: "/testimonials/avatars/bravo68web.jpeg",
      link: "https://discord.gg/e6ejRb6CmT",
      text: <>I have fallen in love with the project.</>,
    },
  ];

  return (
    <>
      <div className="flex flex-col items-center justify-center px-4 pb-24">
        <div className="flex items-center gap-2 rounded-full border bg-light-50 px-4 py-1 text-center text-xs text-light-1000 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900 lg:text-sm">
          <p>{t`Testimonials`}</p>
        </div>

        <p className="mt-2 text-center text-3xl font-bold text-light-1000 dark:text-dark-1000 lg:text-4xl">
          {t`Loved by teams worldwide`}
        </p>
        <p className="text-md lg:text-md mt-3 max-w-[500px] text-center text-light-950 dark:text-dark-900">
          {t`See what our users are saying about Kan`}
        </p>

        <div className="mx-auto mt-16 w-full max-w-7xl">
          <div className="grid grid-cols-1 gap-4 [mask-image:linear-gradient(to_bottom,black_90%,transparent_98%)] md:auto-rows-fr md:grid-cols-3">
            {testimonials.map((testimonial, index) => (
              <TestimonialCard
                key={`testimonial-${index}`}
                testimonial={testimonial}
                rowSpan={testimonial.rowSpan}
              />
            ))}
          </div>
        </div>
      </div>
    </>
  );
};

export default Testimonials;



================================================
FILE: apps/web/src/views/invite/index.tsx
================================================
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useEffect, useState } from "react";

import { authClient } from "@kan/auth/client";

import Button from "~/components/Button";
import LoadingSpinner from "~/components/LoadingSpinner";
import { PageHead } from "~/components/PageHead";
import PatternedBackground from "~/components/PatternedBackground";
import { api } from "~/utils/api";

export default function InvitePage() {
  const router = useRouter();
  const { code } = router.query;
  const [isProcessing, setIsProcessing] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const { data: session, isPending: isSessionLoading } =
    authClient.useSession();

  const isCloudEnv = env("NEXT_PUBLIC_KAN_ENV") === "cloud";

  const inviteCode = Array.isArray(code) ? code[0] : code;

  const acceptInviteMutation = api.member.acceptInviteLink.useMutation({
    onSuccess: (result) => {
      if (result.success) {
        return router.push(
          `/boards?workspacePublicId=${result.workspacePublicId}`,
        );
      }
    },
    onError: (error) => {
      if (error.data?.code === "CONFLICT") {
        return router.push(`/boards`);
      }

      setError(
        error.message ||
          t`Failed to accept invitation. Please try again later, or contact customer support.`,
      );
      setIsProcessing(false);
    },
  });

  const {
    data: inviteInfo,
    isLoading: isInviteInfoLoading,
    isError: isInviteInfoError,
  } = api.member.getInviteByCode.useQuery(
    { inviteCode: inviteCode ?? "" },
    {
      enabled: !!inviteCode,
      retry: false,
    },
  );

  // Auto accept invite if user is logged in
  useEffect(() => {
    if (session?.user.id && inviteCode && inviteInfo && !error) {
      setIsProcessing(true);
      setError(null);

      acceptInviteMutation.mutate({
        inviteCode,
      });
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [session?.user.id, inviteCode, inviteInfo, error]);

  if (
    !isInviteInfoError &&
    !error &&
    (session?.user.id || isInviteInfoLoading || isSessionLoading)
  ) {
    return (
      <>
        <PageHead title={t`Join workspace`} />
        <PatternedBackground />
        <div className="flex min-h-screen items-center justify-center">
          <LoadingSpinner size="lg" />
        </div>
      </>
    );
  }

  const PageWrapper = ({ children }: { children: React.ReactNode }) => {
    return (
      <>
        <PageHead title={t`Join workspace | kan.bn`} />
        {children}
      </>
    );
  };

  if (isInviteInfoError || (!isInviteInfoLoading && !inviteInfo)) {
    return (
      <PageWrapper>
        <div className="relative flex min-h-screen items-center justify-center px-4 py-12 sm:px-6 lg:px-8">
          <PatternedBackground />
          <div className="z-10 w-full max-w-md space-y-8">
            <div>
              <h2 className="mt-6 text-center text-3xl font-bold tracking-tight text-light-1000 dark:text-dark-1000">
                {t`Invalid invitation`}
              </h2>
              <p className="mt-4 text-center text-sm text-light-900 dark:text-dark-800">
                {t`This invitation link is invalid or has expired.`}
              </p>
            </div>
            <div className="text-center">
              <Button href="/" variant="primary">
                {t`Go Home`}
              </Button>
            </div>
          </div>
        </div>
      </PageWrapper>
    );
  }

  return (
    <PageWrapper>
      <div className="relative flex min-h-screen items-center justify-center px-4 py-12 sm:px-6 lg:px-8">
        <PatternedBackground />
        <div className="z-10 w-full max-w-[400px] space-y-8">
          <div>
            <h2 className="mt-6 text-center text-3xl font-bold tracking-tight text-light-1000 dark:text-dark-1000">
              {t`Join workspace`}
            </h2>
            {!error ? (
              <p className="mt-4 text-center text-sm text-light-900 dark:text-dark-800">
                {isCloudEnv
                  ? t`You've been invited to join a workspace on kan.bn.`
                  : t`You've been invited to join a workspace.`}
              </p>
            ) : (
              <p className="mt-4 text-center text-sm text-red-500">{error}</p>
            )}
          </div>
          <div className="flex justify-center gap-2">
            {session?.user.id ? (
              <Button href={`/boards`} variant="primary" size="md">
                {t`Go to app`}
              </Button>
            ) : (
              <>
                <Button
                  href={`/login?next=/invite/${inviteCode}`}
                  disabled={isProcessing}
                  variant="primary"
                  size="md"
                >
                  {t`Sign In`}
                </Button>
                <Button
                  href={`/signup?next=/invite/${inviteCode}`}
                  disabled={isProcessing}
                  variant="primary"
                  size="md"
                >
                  {t`Sign Up`}
                </Button>
              </>
            )}
          </div>
        </div>
      </div>
    </PageWrapper>
  );
}



================================================
FILE: apps/web/src/views/members/index.tsx
================================================
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import {
  HiBolt,
  HiChevronDown,
  HiEllipsisHorizontal,
  HiOutlinePlusSmall,
} from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

import type { Subscription } from "@kan/shared/utils";
import { authClient } from "@kan/auth/client";
import { getSubscriptionByPlan, hasUnlimitedSeats } from "@kan/shared/utils";

import Avatar from "~/components/Avatar";
import Button from "~/components/Button";
import Dropdown from "~/components/Dropdown";
import FeedbackModal from "~/components/FeedbackModal";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import { usePermissions } from "~/hooks/usePermissions";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";
import { getAvatarUrl } from "~/utils/helpers";
import { DeleteMemberConfirmation } from "./components/DeleteMemberConfirmation";
import { InviteMemberForm } from "./components/InviteMemberForm";
import { EditMemberPermissionsModal } from "./components/EditMemberPermissionsModal";

export default function MembersPage() {
  const { modalContentType, openModal, isOpen } = useModal();
  const { workspace } = useWorkspace();
  const { showPopup } = usePopup();

  const { data, isLoading } = api.workspace.byId.useQuery(
    { workspacePublicId: workspace.publicId },
    { enabled: !!workspace.publicId && workspace.publicId.length >= 12 },
  );

  const { data: session } = authClient.useSession();

  const { canEditMember } = usePermissions();

  const utils = api.useUtils();

  const updateRoleMutation = api.member.updateRole.useMutation({
    onSuccess: async () => {
      if (workspace.publicId && workspace.publicId.length >= 12) {
        await utils.workspace.byId.invalidate({
          workspacePublicId: workspace.publicId,
        });
      }

      showPopup({
        header: t`Role updated`,
        message: t`The member's role has been updated.`,
        icon: "success",
      });
    },
    onError: () => {
      showPopup({
        header: t`Unable to update role`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const subscriptions = data?.subscriptions as Subscription[] | undefined;

  const teamSubscription = getSubscriptionByPlan(subscriptions, "team");
  const proSubscription = getSubscriptionByPlan(subscriptions, "pro");

  const unlimitedSeats = hasUnlimitedSeats(subscriptions);

  const TableRow = ({
    memberPublicId,
    memberId,
    memberName,
    memberEmail,
    memberImage,
    memberRole,
    memberStatus,
    isLastRow,
    showSkeleton,
    showPendingIcon,
  }: {
    memberPublicId?: string;
    memberId?: string | null | undefined;
    memberName?: string | null | undefined;
    memberEmail?: string | null | undefined;
    memberImage?: string | null | undefined;
    memberRole?: string;
    memberStatus?: string;
    isLastRow?: boolean;
    showSkeleton?: boolean;
    showPendingIcon?: boolean;
  }) => {
    const handleRoleChange = (newRole: "admin" | "member" | "guest") => {
      if (!memberPublicId) return;

      updateRoleMutation.mutate({
        workspacePublicId: workspace.publicId,
        memberPublicId,
        role: newRole,
      });
    };

    return (
      <tr className="rounded-b-lg">
        <td
          className={twMerge(
            "w-full sm:w-[65%]",
            isLastRow ? "rounded-bl-lg" : "",
          )}
        >
          <div className="flex items-center p-2 sm:p-4">
            <div className="flex-shrink-0">
              {showSkeleton ? (
                <div className="h-8 w-8 animate-pulse rounded-full bg-light-200 dark:bg-dark-200 sm:h-9 sm:w-9" />
              ) : (
                <Avatar
                  name={memberName ?? ""}
                  email={memberEmail ?? ""}
                  imageUrl={memberImage ? getAvatarUrl(memberImage) : undefined}
                />
              )}
            </div>
            <div className="ml-2 min-w-0 flex-1">
              <div>
                <div className="flex items-center">
                  <p
                    className={twMerge(
                      "mr-2 truncate text-xs font-medium text-neutral-900 dark:text-dark-1000 sm:text-sm",
                      showSkeleton &&
                        "md mb-2 h-3 w-[125px] animate-pulse rounded-sm bg-light-200 dark:bg-dark-200",
                      showPendingIcon &&
                        "italic text-neutral-500 dark:text-dark-900",
                    )}
                  >
                    {memberName}
                  </p>
                </div>
                {((workspace.role === "admin" ||
                  data?.showEmailsToMembers === true) ||
                  showSkeleton) && (
                  <p
                    className={twMerge(
                      "truncate text-xs text-dark-900 sm:text-sm",
                      showSkeleton &&
                        "h-3 w-[175px] animate-pulse rounded-sm bg-light-200 dark:bg-dark-200",
                    )}
                  >
                    {memberEmail}
                  </p>
                )}
              </div>
            </div>
          </div>
        </td>
        <td
          className={twMerge(
            "w-auto min-w-[120px] overflow-visible sm:w-[35%] sm:min-w-[150px]",
            isLastRow && "rounded-br-lg",
          )}
        >
          <div className="flex w-full items-center justify-between px-2 sm:px-3">
            <div className="flex items-center gap-2">
              {showSkeleton ? (
                <span
                  className={twMerge(
                    "inline-flex items-center rounded-md bg-emerald-500/10 px-1.5 py-0.5 text-[10px] font-medium text-emerald-400 ring-1 ring-inset ring-emerald-500/20 sm:text-[11px]",
                    "h-5 w-[50px] animate-pulse bg-light-200 ring-0 dark:bg-dark-200",
                  )}
                />
              ) : (
                <div className="relative inline-flex items-center">
                  <span className="inline-flex items-center gap-1 rounded-md bg-emerald-500/10 px-1.5 py-0.5 text-[10px] font-medium text-emerald-400 ring-1 ring-inset ring-emerald-500/20 sm:text-[11px]">
                    {memberRole &&
                      memberRole.charAt(0).toUpperCase() +
                        memberRole.slice(1)}
                    {canEditMember && session?.user.id !== memberId && (
                      <HiChevronDown className="h-3 w-3" />
                    )}
                  </span>

                  {canEditMember && session?.user.id !== memberId && (
                    <select
                      value={memberRole}
                      onChange={(e) =>
                        handleRoleChange(
                          e.target.value as "admin" | "member" | "guest",
                        )
                      }
                      disabled={updateRoleMutation.isPending}
                      className="absolute inset-0 h-full w-full cursor-pointer appearance-none border-none bg-transparent p-0 text-[10px] leading-none opacity-0 focus:outline-none focus-visible:outline-none sm:text-[11px]"
                    >
                      <option value="admin">{t`Admin`}</option>
                      <option value="member">{t`Member`}</option>
                      <option value="guest">{t`Guest`}</option>
                    </select>
                  )}
                </div>
              )}
              {(memberStatus === "invited" || memberStatus === "paused") && (
                <span className="inline-flex items-center rounded-md bg-gray-500/10 px-1.5 py-0.5 text-[10px] font-medium text-gray-400 ring-1 ring-inset ring-gray-500/20 sm:text-[11px]">
                  {memberStatus === "invited" ? t`Pending` : t`Paused`}
                </span>
              )}
            </div>
            <div
              className={twMerge(
                "relative",
                (workspace.role !== "admin" || showSkeleton) && "hidden",
              )}
            >
              {session?.user.id !== memberId && (
                <Dropdown
                  items={[
                    {
                      label: t`Edit permissions`,
                      action: () =>
                        openModal(
                          "EDIT_MEMBER_PERMISSIONS",
                          memberPublicId,
                          memberEmail ?? "",
                        ),
                    },
                    {
                      label: t`Remove member`,
                      action: () =>
                        openModal(
                          "REMOVE_MEMBER",
                          memberPublicId,
                          memberEmail ?? "",
                        ),
                    },
                  ]}
                >
                  <HiEllipsisHorizontal
                    size={20}
                    className="text-light-900 dark:text-dark-900 sm:size-[20px]"
                  />
                </Dropdown>
              )}
            </div>
          </div>
        </td>
      </tr>
    );
  };

  return (
    <>
      <PageHead title={t`Members | ${workspace.name ?? t`Workspace`}`} />
      <div className="m-auto h-full max-w-[1100px] p-6 px-5 md:px-28 md:py-12">
        <div className="mb-8 flex w-full justify-between">
          <div className="flex items-center gap-3">
            <h1 className="font-bold tracking-tight text-neutral-900 dark:text-dark-1000 sm:text-[1.2rem]">
              {t`Members`}
            </h1>
          </div>
          <div className="flex items-center gap-3">
            {env("NEXT_PUBLIC_KAN_ENV") === "cloud" && (
              <>
                {!proSubscription && !teamSubscription && (
                  <Link
                    href="/settings/workspace?upgrade=pro"
                    className="hidden items-center rounded-full border border-emerald-300 bg-emerald-50 px-3 py-1 text-center text-xs text-emerald-400 dark:border-emerald-700 dark:bg-emerald-950 dark:text-emerald-400 lg:flex"
                  >
                    <HiBolt />
                    <span className="ml-1 font-medium">
                      {t`Launch offer: Get unlimited members with Pro`}
                    </span>
                  </Link>
                )}
                <div
                  className={twMerge(
                    "flex items-center rounded-full border px-3 py-1 text-center text-xs",
                    teamSubscription || proSubscription
                      ? "border-emerald-300 bg-emerald-50 text-emerald-400 dark:border-emerald-700 dark:bg-emerald-950 dark:text-emerald-400"
                      : "border-light-300 bg-light-50 text-light-1000 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900",
                  )}
                >
                  <span className="font-medium">
                    {proSubscription
                      ? t`Pro Plan`
                      : teamSubscription
                        ? t`Team Plan`
                        : t`Free Plan`}
                    {proSubscription && unlimitedSeats && (
                      <span className="ml-1 text-xs">âˆ</span>
                    )}
                  </span>
                </div>
              </>
            )}
            <Button
              onClick={() => openModal("INVITE_MEMBER")}
              iconLeft={<HiOutlinePlusSmall className="h-4 w-4" />}
              disabled={workspace.role !== "admin"}
            >
              {t`Invite`}
            </Button>
          </div>
        </div>

        <div className="mt-8 flow-root">
          <div className="-mx-4 -my-2 sm:-mx-6 lg:-mx-8">
            <div className="inline-block min-w-full overflow-x-auto px-4 py-2 pb-16 align-middle sm:px-6 lg:px-8">
              <div className="h-full shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
                <table className="min-w-full divide-y divide-light-600 overflow-visible dark:divide-dark-600">
                  <thead className="rounded-t-lg bg-light-300 dark:bg-dark-200">
                    <tr>
                      <th
                        scope="col"
                        className="w-full rounded-tl-lg py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-light-900 dark:text-dark-900 sm:w-[65%] sm:pl-6"
                      >
                        {t`User`}
                      </th>
                      <th
                        scope="col"
                        className="w-auto whitespace-nowrap rounded-tr-lg px-3 py-3.5 text-left text-sm font-semibold text-light-900 dark:text-dark-900 sm:w-[35%]"
                      >
                        {t`Role`}
                      </th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-light-600 overflow-visible bg-light-50 dark:divide-dark-600 dark:bg-dark-100">
                    {!isLoading &&
                      data?.members.map((member, index) => {
                        const isPendingInvite = member.status === "invited";

                        return (
                          <TableRow
                            key={member.publicId}
                            memberPublicId={member.publicId}
                            memberId={member.user?.id}
                            memberName={member.user?.name}
                            memberEmail={member.user?.email ?? member.email}
                            memberImage={member.user?.image}
                            memberRole={member.role}
                            memberStatus={member.status}
                            isLastRow={index === data.members.length - 1}
                            showPendingIcon={isPendingInvite}
                          />
                        );
                      })}

                    {isLoading && (
                      <>
                        <TableRow showSkeleton />
                        <TableRow showSkeleton />
                        <TableRow showSkeleton isLastRow />
                      </>
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <>
          <Modal
            modalSize="md"
            isVisible={isOpen && modalContentType === "NEW_FEEDBACK"}
          >
            <FeedbackModal />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
          >
            <NewWorkspaceForm />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "INVITE_MEMBER"}
          >
            <InviteMemberForm
              userId={session?.user.id}
              numberOfMembers={data?.members.length ?? 1}
              subscriptions={subscriptions}
              unlimitedSeats={unlimitedSeats}
            />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "REMOVE_MEMBER"}
          >
            <DeleteMemberConfirmation />
          </Modal>

          <Modal
            modalSize="sm"
            isVisible={isOpen && modalContentType === "EDIT_MEMBER_PERMISSIONS"}
            centered
          >
            <EditMemberPermissionsModal />
          </Modal>
        </>
      </div>
    </>
  );
}



================================================
FILE: apps/web/src/views/members/components/DeleteMemberConfirmation.tsx
================================================
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

export function DeleteMemberConfirmation() {
  const utils = api.useUtils();
  const { closeModal, entityLabel, entityId } = useModal();
  const { workspace } = useWorkspace();
  const { showPopup } = usePopup();

  const deleteMember = api.member.delete.useMutation({
    onSuccess: async () => {
      closeModal();
      try {
        await utils.workspace.byId.refetch();
      } catch (e) {
        console.error(e);
      }
    },
    onError: () => {
      showPopup({
        header: t`Unable to remove member`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
      closeModal();
    },
  });

  const handleDeleteMember = () => {
    if (entityId)
      deleteMember.mutate({
        memberPublicId: entityId,
        workspacePublicId: workspace.publicId,
      });
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          <Trans>Are you sure want to remove {entityLabel}?</Trans>
        </h2>
        <p className="text-sm font-medium text-light-900 dark:text-dark-900">
          {t`They won't be able to access this workspace.`}
        </p>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button onClick={() => closeModal()} variant="secondary">
          {t`Cancel`}
        </Button>
        <Button onClick={handleDeleteMember} isLoading={deleteMember.isPending}>
          {t`Remove`}
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/members/components/EditMemberPermissionsModal.tsx
================================================
import { t } from "@lingui/core/macro";
import { HiXMark } from "react-icons/hi2";

import type { Permission } from "@kan/shared";
import { permissionCategories } from "@kan/shared";

import Button from "~/components/Button";
import Toggle from "~/components/Toggle";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

export function EditMemberPermissionsModal() {
  const { workspace } = useWorkspace();
  const { modalContentType, entityId, entityLabel, closeModal } = useModal();
  const { showPopup } = usePopup();
  const utils = api.useUtils();

  const { data, isLoading } = api.permission.getMemberPermissions.useQuery(
    {
      workspacePublicId: workspace.publicId,
      memberPublicId: entityId,
    },
    {
      enabled:
        modalContentType === "EDIT_MEMBER_PERMISSIONS" && !!entityId,
    },
  );

  const grantMutation = api.permission.grantPermission.useMutation({
    onSuccess: () => {
      showPopup({
        header: t`Permissions updated`,
        message: t`The member's permissions have been updated.`,
        icon: "success",
      });
    },
    onError: () => {
      showPopup({
        header: t`Unable to update permissions`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await utils.permission.getMemberPermissions.invalidate({
        workspacePublicId: workspace.publicId,
        memberPublicId: entityId,
      });
    },
  });

  const revokeMutation = api.permission.revokePermission.useMutation({
    onSuccess: () => {
      showPopup({
        header: t`Permissions updated`,
        message: t`The member's permissions have been updated.`,
        icon: "success",
      });
    },
    onError: () => {
      showPopup({
        header: t`Unable to update permissions`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
    onSettled: async () => {
      await utils.permission.getMemberPermissions.invalidate({
        workspacePublicId: workspace.publicId,
        memberPublicId: entityId,
      });
    },
  });

  const resetMutation = api.permission.resetMemberPermissions.useMutation({
    onSuccess: async () => {
      showPopup({
        header: t`Permissions reset`,
        message: t`This member's permissions have been reset to their role defaults.`,
        icon: "success",
      });

      await utils.permission.getMemberPermissions.invalidate({
        workspacePublicId: workspace.publicId,
        memberPublicId: entityId,
      });
    },
    onError: () => {
      showPopup({
        header: t`Unable to reset permissions`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const effectivePermissions = (data?.permissions ?? []) as Permission[];
  const hasOverrides = (data?.overrides?.length ?? 0) > 0;
  const isBusy =
    grantMutation.isPending ||
    revokeMutation.isPending ||
    resetMutation.isPending;

  const handleToggle = (permission: Permission, nextState: boolean) => {
    if (!workspace.publicId || !entityId) return;

    if (nextState) {
      grantMutation.mutate({
        workspacePublicId: workspace.publicId,
        memberPublicId: entityId,
        permission,
      });
    } else {
      revokeMutation.mutate({
        workspacePublicId: workspace.publicId,
        memberPublicId: entityId,
        permission,
      });
    }
  };

  const permissionLabels: Record<Permission, string> = {
    "workspace:view": t`Can view workspace`,
    "workspace:edit": t`Can edit workspace`,
    "workspace:delete": t`Can delete workspace`,
    "workspace:manage": t`Can manage workspace settings`,

    "board:view": t`Can view boards`,
    "board:create": t`Can create boards`,
    "board:edit": t`Can edit boards`,
    "board:delete": t`Can delete boards`,

    "list:view": t`Can view lists`,
    "list:create": t`Can create lists`,
    "list:edit": t`Can edit lists`,
    "list:delete": t`Can delete lists`,

    "card:view": t`Can view cards`,
    "card:create": t`Can create cards`,
    "card:edit": t`Can edit cards`,
    "card:delete": t`Can delete cards`,

    "comment:view": t`Can view comments`,
    "comment:create": t`Can add comments`,
    "comment:edit": t`Can edit comments`,
    "comment:delete": t`Can delete comments`,

    "member:view": t`Can view members`,
    "member:invite": t`Can invite members`,
    "member:edit": t`Can edit member roles and permissions`,
    "member:remove": t`Can remove members`,
  };

  return (
    <div className="w-full rounded-md bg-light-50 text-light-1000 dark:bg-dark-100 dark:text-dark-1000">
      <div className="px-5 pt-5">
        <div className="mb-3 flex items-start justify-between gap-3">
          <div>
            <h2 className="mb-1 text-sm font-semibold">
              {t`Edit permissions`}
            </h2>
            <p className="min-h-[16px] text-xs text-light-900 dark:text-dark-900">
              {entityLabel}
            </p>
          </div>
          <button
            type="button"
            onClick={closeModal}
            className="ml-2 inline-flex h-6 w-6 items-center justify-center rounded-md text-light-900 hover:bg-light-200 focus:outline-none dark:text-dark-900 dark:hover:bg-dark-200"
            aria-label={t`Close`}
          >
            <HiXMark className="h-3.5 w-3.5" />
          </button>
        </div>

        {isLoading ? (
          <p className="text-xs text-light-900 dark:text-dark-900">
            {t`Loading permissions...`}
          </p>
        ) : (
          <div className="max-h-80 pb-4 space-y-3 overflow-y-auto pr-1">
            {Object.values(permissionCategories).map((category, index) => (
              <div
                key={category.label}
                className={`py-2 ${
                  index > 0
                    ? "border-t border-light-300 dark:border-dark-300"
                    : ""
                }`}
              >
                <div className="my-2 text-[12px] font-semibold text-light-900 dark:text-dark-950">
                  {category.label}
                </div>
                <div className="space-y-1.5">
                  {category.permissions.map((permission) => {
                    const label =
                      permissionLabels[permission] ?? (permission as string);

                    return (
                      <div
                        key={permission}
                        className="flex items-center justify-between gap-3 py-0.5"
                      >
                        <span className="text-xs text-light-900 dark:text-dark-900">
                          {label}
                        </span>
                        <Toggle
                          label={label}
                          showLabel={false}
                          isChecked={effectivePermissions.includes(permission)}
                          disabled={isBusy}
                          onChange={() =>
                            handleToggle(
                              permission,
                              !effectivePermissions.includes(permission),
                            )
                          }
                        />
                      </div>
                    );
                  })}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
      <div className="flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <div>
          <Button
            variant="secondary"
            size="sm"
            onClick={() => {
              if (!workspace.publicId || !entityId || isBusy) return;
              resetMutation.mutate({
                workspacePublicId: workspace.publicId,
                memberPublicId: entityId,
              });
            }}
            disabled={isBusy || !hasOverrides}
            isLoading={resetMutation.isPending}
          >
            {t`Reset to role defaults`}
          </Button>
        </div>
      </div>
    </div>
  );
}





================================================
FILE: apps/web/src/views/members/components/InviteMemberForm.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useEffect, useState } from "react";
import { useForm } from "react-hook-form";
import {
  HiInformationCircle,
  HiMiniCheck,
  HiOutlineDocumentDuplicate,
  HiXMark,
} from "react-icons/hi2";
import { z } from "zod";

import type { InviteMemberInput } from "@kan/api/types";
import type { Subscription } from "@kan/shared/utils";
import { authClient } from "@kan/auth/client";
import { getSubscriptionByPlan } from "@kan/shared/utils";

import Button from "~/components/Button";
import Input from "~/components/Input";
import Toggle from "~/components/Toggle";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

export function InviteMemberForm({
  numberOfMembers,
  subscriptions,
  unlimitedSeats,
  userId,
}: {
  numberOfMembers: number;
  subscriptions: Subscription[] | undefined;
  unlimitedSeats: boolean;
  userId: string | undefined;
}) {
  const utils = api.useUtils();
  const [isShareInviteLinkEnabled, setIsShareInviteLinkEnabled] =
    useState(false);
  const [inviteLink, setInviteLink] = useState<string>("");
  const [_isLoadingInviteLink, setIsLoadingInviteLink] = useState(false);
  const [copied, setCopied] = useState(false);
  const { closeModal } = useModal();
  const { workspace } = useWorkspace();
  const { showPopup } = usePopup();

  const isEmailEnabled = env("NEXT_PUBLIC_DISABLE_EMAIL") !== "true";

  const InviteMemberSchema = z.object({
    email: z.string().email({ message: t`Invalid email address` }),
    workspacePublicId: z.string(),
  });

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<InviteMemberInput>({
    defaultValues: {
      email: "",
      workspacePublicId: workspace.publicId || "",
    },
    resolver: zodResolver(InviteMemberSchema),
  });

  const refetchBoards = () => utils.board.all.refetch();

  // Fetch active invite link on component mount
  const { data: activeInviteLink, refetch: _refetchInviteLink } =
    api.member.getActiveInviteLink.useQuery(
      { workspacePublicId: workspace.publicId || "" },
      { enabled: !!workspace.publicId },
    );

  // Set initial state based on active invite link
  useEffect(() => {
    if (activeInviteLink) {
      setIsShareInviteLinkEnabled(activeInviteLink.isActive);
      setInviteLink(activeInviteLink.inviteLink ?? "");
    }
  }, [activeInviteLink]);

  const inviteMember = api.member.invite.useMutation({
    onSuccess: async () => {
      closeModal();
      await utils.workspace.byId.refetch();
      await refetchBoards();
    },
    onError: (error) => {
      reset();
      if (!isShareInviteLinkEnabled) closeModal();

      if (error.data?.code === "CONFLICT") {
        showPopup({
          header: t`Error inviting member`,
          message: t`User is already a member of this workspace`,
          icon: "error",
        });
      } else {
        showPopup({
          header: t`Error inviting member`,
          message: t`Please try again later, or contact customer support.`,
          icon: "error",
        });
      }
    },
  });

  const createInviteLink = api.member.createInviteLink.useMutation({
    onSuccess: (data) => {
      setInviteLink(data.inviteLink);
      setIsLoadingInviteLink(false);
    },
    onError: (error) => {
      setIsLoadingInviteLink(false);
      setIsShareInviteLinkEnabled(false);

      if (error.data?.code === "FORBIDDEN") {
        showPopup({
          header: t`Subscription Required`,
          message: t`Invite links require a Team or Pro subscription. Please upgrade your workspace.`,
          icon: "error",
        });
      } else {
        showPopup({
          header: t`Error creating invite link`,
          message: t`Please try again later.`,
          icon: "error",
        });
      }
    },
  });

  const deactivateInviteLink = api.member.deactivateInviteLink.useMutation({
    onSuccess: () => {
      setInviteLink("");
      setIsLoadingInviteLink(false);
    },
    onError: () => {
      setIsLoadingInviteLink(false);
      showPopup({
        header: t`Error deactivating invite link`,
        message: t`Please try again later.`,
        icon: "error",
      });
    },
  });

  const teamSubscription = getSubscriptionByPlan(subscriptions, "team");
  const proSubscription = getSubscriptionByPlan(subscriptions, "pro");

  const hasTeamSubscription = !!teamSubscription;
  const hasProSubscription = !!proSubscription;

  let isYearly = false;
  let price = t`$10/month`;
  let billingType = t`monthly billing`;

  if (teamSubscription?.periodStart && teamSubscription.periodEnd) {
    const periodStartDate = new Date(teamSubscription.periodStart);
    const periodEndDate = new Date(teamSubscription.periodEnd);
    const diffInDays = Math.round(
      (periodEndDate.getTime() - periodStartDate.getTime()) /
        (1000 * 60 * 60 * 24),
    );

    isYearly = diffInDays > 31;
    price = isYearly ? t`$8/month` : t`$10/month`;
    billingType = isYearly ? t`billed annually` : t`billed monthly`;
  }

  const onSubmit = (member: InviteMemberInput) => {
    inviteMember.mutate(member);
  };

  const handleInviteLinkToggle = async () => {
    if (
      env("NEXT_PUBLIC_KAN_ENV") === "cloud" &&
      !hasTeamSubscription &&
      !hasProSubscription
    )
      return handleUpgrade();

    setIsLoadingInviteLink(true);

    if (isShareInviteLinkEnabled && workspace.publicId) {
      // Deactivate invite link
      await deactivateInviteLink.mutateAsync({
        workspacePublicId: workspace.publicId,
      });
      setIsShareInviteLinkEnabled(false);
    } else {
      // Create new invite link
      await createInviteLink.mutateAsync({
        workspacePublicId: workspace.publicId,
      });
      setIsShareInviteLinkEnabled(true);
    }
  };

  const copyToClipboard = async () => {
    try {
      await navigator.clipboard.writeText(inviteLink);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
      showPopup({
        header: t`Invite link copied`,
        message: t`Invite link copied to clipboard`,
        icon: "success",
      });
    } catch {
      showPopup({
        header: t`Error`,
        message: t`Failed to copy invite link`,
        icon: "error",
      });
    }
  };

  const handleUpgrade = async () => {
    const { data, error } = await authClient.subscription.upgrade({
      plan: "team",
      referenceId: workspace.publicId,
      metadata: { userId },
      seats: numberOfMembers,
      successUrl: "/members",
      cancelUrl: "/members",
      returnUrl: "/members",
      disableRedirect: true,
    });

    if (data?.url) {
      window.location.href = data.url;
    }

    if (error) {
      showPopup({
        header: t`Error upgrading subscription`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    }
  };

  useEffect(() => {
    const emailElement: HTMLElement | null =
      document.querySelector<HTMLElement>("#email");
    if (emailElement) emailElement.focus();
  }, []);

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="text-neutral-9000 flex w-full items-center justify-between pb-4 dark:text-dark-1000">
          <h2 className="text-sm font-bold">{t`Add member`}</h2>
          <button
            type="button"
            className="hover:bg-li ght-300 rounded p-1 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="dark:text-dark-9000 text-light-900" />
          </button>
        </div>
        {isEmailEnabled && (
          <Input
            id="email"
            placeholder={t`Email`}
            disabled={
              env("NEXT_PUBLIC_KAN_ENV") === "cloud" &&
              !hasTeamSubscription &&
              !hasProSubscription
            }
            {...register("email", { required: true })}
            onKeyDown={async (e) => {
              if (e.key === "Enter") {
                e.preventDefault();
                await handleSubmit(onSubmit)();
              }
            }}
            errorMessage={errors.email?.message}
          />
        )}
        {(!isEmailEnabled || (isShareInviteLinkEnabled && inviteLink)) && (
          <div className="my-4">
            <div className="relative">
              <Input
                value={inviteLink}
                className="pr-10 text-sm text-light-900 dark:text-dark-900"
                readOnly
              />
              <button
                type="button"
                className="absolute inset-y-0 right-0 flex items-center pr-3 text-light-900 hover:text-light-950 dark:text-dark-900 dark:hover:text-dark-950"
                onClick={copyToClipboard}
              >
                {copied ? (
                  <HiMiniCheck className="h-5 w-5 text-green-600" />
                ) : (
                  <HiOutlineDocumentDuplicate className="h-5 w-5" />
                )}
              </button>
            </div>
            <div className="mt-2 flex items-start gap-1">
              <HiInformationCircle className="mt-0.5 h-4 w-4 text-dark-900" />
              <p className="text-xs text-gray-500 dark:text-dark-900">
                {t`Anyone with this link can join your workspace`}
              </p>
            </div>
          </div>
        )}

        {env("NEXT_PUBLIC_KAN_ENV") === "cloud" && (
          <div className="mt-3 rounded-md bg-light-100 p-3 text-xs text-light-900 dark:bg-dark-200 dark:text-dark-900">
            {hasTeamSubscription || hasProSubscription ? (
              <div>
                <span className="font-medium text-emerald-500 dark:text-emerald-400">
                  {hasTeamSubscription ? t`Team Plan` : t`Pro Plan âˆ`}
                </span>
                <p className="mt-1">
                  {unlimitedSeats
                    ? t`You have unlimited seats with your Pro Plan. There is no additional charge for new members!`
                    : t`Adding a new member will cost an additional ${price} (${billingType}) per seat.`}
                </p>
              </div>
            ) : (
              <div>
                <span className="font-medium text-light-950 dark:text-dark-950">
                  {t`Free Plan`}
                </span>
                <p className="mt-1">
                  {t`Inviting members requires a Team Plan. You'll be redirected to upgrade your workspace.`}
                </p>
              </div>
            )}
          </div>
        )}
      </div>

      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <Toggle
          label={
            isShareInviteLinkEnabled
              ? t`Deactivate invite link`
              : t`Create invite link`
          }
          isChecked={isShareInviteLinkEnabled}
          onChange={handleInviteLinkToggle}
        />
        <div>
          {env("NEXT_PUBLIC_KAN_ENV") === "cloud" &&
          !hasTeamSubscription &&
          !hasProSubscription ? (
            <Button type="button" onClick={handleUpgrade}>
              {t`Start 14 day free trial`}
            </Button>
          ) : (
            <Button
              type="submit"
              disabled={inviteMember.isPending || !isEmailEnabled}
              isLoading={inviteMember.isPending}
            >
              {t`Invite member`}
            </Button>
          )}
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/views/members/components/MemberDropdown.tsx
================================================
import { Fragment } from "react";
import { Menu, Transition } from "@headlessui/react";
import { HiEllipsisVertical } from "react-icons/hi2";

export default function MemberDropdown() {
  return (
    <Menu as="div" className="relative inline-block text-left">
      <div>
        <Menu.Button
          type="button"
          className="inline-flex h-8 w-8 items-center justify-center rounded-full bg-transparent text-dark-900 focus:outline-none "
        >
          <span className="sr-only">Open options</span>
          <HiEllipsisVertical className="h-5 w-5" aria-hidden="true" />
        </Menu.Button>
      </div>

      <Transition
        as={Fragment}
        enter="transition ease-out duration-100"
        enterFrom="transform opacity-0 scale-95"
        enterTo="transform opacity-100 scale-100"
        leave="transition ease-in duration-75"
        leaveFrom="transform opacity-100 scale-100"
        leaveTo="transform opacity-0 scale-95"
      >
        <Menu.Items className="absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md border border-dark-400 bg-dark-200 shadow-sm ring-1 ring-black ring-opacity-5 focus:outline-none">
          <div className="flex flex-col">
            <Menu.Item>
              <button
                // onClick={}
                className="m-1 flex items-center rounded-[5px] px-3 py-2 text-left text-xs text-dark-1000 hover:bg-dark-400"
              >
                Remove
              </button>
            </Menu.Item>
          </div>
        </Menu.Items>
      </Transition>
    </Menu>
  );
}



================================================
FILE: apps/web/src/views/oss-friends/index.tsx
================================================
import Link from "next/link";
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";

import Button from "~/components/Button";
import { PageHead } from "~/components/PageHead";
import Layout from "../home/components/Layout";

interface OSSFriend {
  name: string;
  description: string;
  href: string;
}

interface OSSFriendsResponse {
  data: OSSFriend[];
}

export default function OSSFriendsView() {
  const [ossFriends, setOSSFriends] = useState<OSSFriend[]>([]);
  const [isLoading, setIsLoading] = useState<boolean>(true);
  const fetchOSSFriends = async (): Promise<OSSFriend[]> => {
    try {
      const response = await fetch("/api/oss-friends");

      if (!response.ok) {
        throw new Error("Failed to fetch OSS friends");
      }
      const { data } = (await response.json()) as OSSFriendsResponse;

      return data;
    } catch (error) {
      console.error("Error fetching OSS friends:", error);
      return [];
    }
  };

  useEffect(() => {
    async function fetchData() {
      try {
        const data = await fetchOSSFriends();
        setOSSFriends(data);
      } finally {
        setIsLoading(false);
      }
    }
    void fetchData();
  }, []);

  return (
    <Layout>
      <PageHead title={`${t`OSS Friends`} | kan.bn`} />

      <div className="flex h-full w-full flex-col lg:pt-[5rem]">
        <div className="w-full pb-10 pt-32">
          <div className="flex flex-col items-center justify-center px-4 pb-10">
            <p className="mt-4 text-center text-3xl font-bold text-light-1000 dark:text-dark-1000 lg:text-3xl">
              {t`Open Source Friends`}
            </p>
            <p className="text:md lg:text-md mt-4 max-w-[500px] text-center text-light-950 dark:text-dark-900">
              {t`Check out some of our favorite open source projects.`}
            </p>
          </div>
        </div>
        <div className="mx-auto w-full max-w-7xl px-4 pb-24">
          <div className="grid grid-cols-1 gap-4 md:grid-cols-3">
            {isLoading &&
              Array.from({ length: 12 }).map((_, idx) => (
                <div
                  key={`oss-friend-skeleton-${idx}`}
                  className="group relative h-[200px] rounded-2xl border border-light-200 bg-light-50 p-6 dark:border-dark-200 dark:bg-dark-50"
                >
                  <div className="mb-4 flex flex-col gap-3">
                    <div className="h-5 w-2/3 animate-pulse rounded-sm bg-light-200 dark:bg-dark-200" />
                    <div className="h-3 w-full animate-pulse rounded-sm bg-light-200 dark:bg-dark-200" />
                    <div className="h-3 w-5/6 animate-pulse rounded-sm bg-light-200 dark:bg-dark-200" />
                  </div>
                  <div className="h-8 w-28 animate-pulse rounded-md bg-light-200 dark:bg-dark-200" />
                </div>
              ))}

            {!isLoading &&
              ossFriends.map((friend, idx) => {
                return (
                  <div
                    key={`oss-friend-${idx}`}
                    className="group relative rounded-2xl border border-light-200 bg-light-50 p-6 transition-all duration-200 hover:shadow-sm dark:border-dark-200 dark:bg-dark-50"
                  >
                    <div className="mb-4 flex flex-col gap-2">
                      <Link
                        href={friend.href}
                        target="_blank"
                        rel="noopener noreferrer"
                      >
                        <h3 className="text-lg font-semibold text-light-1000 dark:text-dark-1000">
                          {friend.name}
                        </h3>
                      </Link>

                      <p className="text-sm leading-relaxed text-light-900 dark:text-dark-900">
                        {friend.description}
                      </p>
                    </div>
                    <Button
                      href={friend.href}
                      variant="secondary"
                      rel="noopener noreferrer"
                      size="sm"
                    >
                      {t`Learn more`}
                    </Button>
                  </div>
                );
              })}
          </div>
        </div>
      </div>
    </Layout>
  );
}



================================================
FILE: apps/web/src/views/pricing/index.tsx
================================================
import { t } from "@lingui/core/macro";
import { useTheme } from "next-themes";
import { useState } from "react";

import Button from "~/components/Button";
import { PageHead } from "~/components/PageHead";
import Cta from "../home/components/Cta";
import Layout from "../home/components/Layout";
import Logos from "../home/components/Logos";
import FeatureComparisonTable from "./components/FeatureComparisonTable";
import PricingTiers from "./components/PricingTiers";

type FrequencyValue = "monthly" | "annually";

export default function PricingView() {
  const { resolvedTheme } = useTheme();
  const frequencies = [
    {
      value: "monthly" as FrequencyValue,
      label: t`Monthly`,
      priceSuffix: t`per user/month`,
    },
    {
      value: "annually" as FrequencyValue,
      label: t`Yearly`,
      priceSuffix: t`per user/month`,
    },
  ];

  const [frequency, setFrequency] = useState(frequencies[1]);

  return (
    <Layout>
      <PageHead title={`${t`Pricing`} | kan.bn`} />

      <div className="flex h-full w-full flex-col lg:pt-[5rem]">
        <div className="w-full pb-10 pt-32">
          <div className="flex flex-col items-center justify-center px-4 pb-10">
            <div className="flex items-center gap-2 rounded-full border bg-light-50 px-4 py-1 text-center text-xs text-light-1000 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900 lg:text-sm">
              <p>{t`Pricing`}</p>
            </div>

            <p className="mt-4 text-center text-3xl font-bold text-light-1000 dark:text-dark-1000 lg:text-5xl">
              {t`Simple pricing`}
            </p>
            <p className="text:md lg:text-md mt-6 max-w-[300px] text-center text-light-950 dark:text-dark-900">
              {t`Start free. Upgrade as your team grows. No hidden fees, no contracts.`}
            </p>
          </div>
          <PricingTiers
            frequency={frequency}
            frequencies={frequencies}
            setFrequency={setFrequency}
          />
        </div>

        <div className="pb-20">
          <Logos />
        </div>

        <div className="pb-22 flex flex-col items-center justify-center px-4">
        

          <div className="mt-10 w-full">
            <FeatureComparisonTable
              frequencyValue={frequency?.value ?? "annually"}
            />
          </div>
        </div>
        <div className="relative">
          <Cta theme={resolvedTheme ?? "light"} />
        </div>
      </div>
    </Layout>
  );
}



================================================
FILE: apps/web/src/views/pricing/components/FeatureComparisonTable.tsx
================================================
import { t } from "@lingui/core/macro";
import React, { useEffect, useRef, useState } from "react";
import { HiCheckCircle, HiXCircle } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

type FrequencyValue = "monthly" | "annually";

interface PlanFeature {
  key: string;
  label: string;
  free: string | boolean | { text: string; highlight?: string };
  teams: string | boolean | { text: string; highlight?: string };
  pro: string | boolean | { text: string; highlight?: string };
  enterprise: string | boolean | { text: string; highlight?: string };
}

interface FeatureSection {
  name: string;
  features: PlanFeature[];
}

const FeatureComparisonTable = ({
  frequencyValue: _frequencyValue,
}: {
  frequencyValue: FrequencyValue;
}) => {
  // Keep pricing column headers visible as you scroll
  const containerRef = useRef<HTMLDivElement | null>(null);
  const [isHeaderFixed, setIsHeaderFixed] = useState(false);
  const [headerRect, setHeaderRect] = useState<{ left: number; width: number }>({
    left: 0,
    width: 0,
  });

  useEffect(() => {
    const HEADER_OFFSET = 64; // px; matches fixed top nav height

    const handleScroll = () => {
      if (!containerRef.current) return;

      // Hide fixed header on mobile (screens smaller than 620px)
      if (window.innerWidth < 620) {
        setIsHeaderFixed(false);
        return;
      }

      const rect = containerRef.current.getBoundingClientRect();
      const pastHeader = rect.top <= HEADER_OFFSET;
      const aboveBottom = rect.bottom > HEADER_OFFSET + 40;

      const shouldFix = pastHeader && aboveBottom;
      setIsHeaderFixed(shouldFix);

      if (shouldFix) {
        setHeaderRect({
          left: rect.left,
          width: rect.width,
        });
      }
    };

    handleScroll();
    window.addEventListener("scroll", handleScroll, { passive: true });
    window.addEventListener("resize", handleScroll);
    return () => {
      window.removeEventListener("scroll", handleScroll);
      window.removeEventListener("resize", handleScroll);
    };
  }, []);
  const planSpecificLimits: PlanFeature[] = [
    {
      key: "boards",
      label: t`Boards`,
      free: { text: t`Unlimited boards`, highlight: "Unlimited" },
      teams: { text: t`Unlimited boards`, highlight: "Unlimited" },
      pro: { text: t`Unlimited boards`, highlight: "Unlimited" },
      enterprise: { text: t`Unlimited boards`, highlight: "Unlimited" },
    },
    {
      key: "members",
      label: t`Members`,
      free: { text: t`1 user`, highlight: "1" },
      teams: { text: t`Per-seat pricing`, highlight: "Per-seat" },
      pro: { text: t`Unlimited members`, highlight: "Unlimited" },
      enterprise: { text: t`Unlimited members`, highlight: "Unlimited" },
    },
    {
      key: "file-uploads",
      label: t`File uploads`,
      free: { text: t`10mb file uploads`, highlight: "10mb" },
      teams: { text: t`Unlimited file uploads`, highlight: "Unlimited" },
      pro: { text: t`Unlimited file uploads`, highlight: "Unlimited" },
      enterprise: { text: t`Unlimited file uploads`, highlight: "Unlimited" },
    },
      {
        key: "workspace-username",
        label: t`Workspace username`,
        free: { text: t`Default username`, highlight: "Default" },
        teams: { text: t`Default username`, highlight: "Default" },
        pro: { text: t`Custom username`, highlight: "Custom" },
        enterprise: { text: t`Custom username`, highlight: "Custom" },
      },
  ];

  const coreFeatures: PlanFeature[] = [
    {
      key: "checklists",
      label: t`Checklists`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "custom-templates",
      label: t`Board templates`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "labels-filters",
      label: t`Labels & filters`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "board-visibility",
      label: t`Board visibility`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "search",
      label: t`Intelligent search`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "activity-log",
      label: t`Activity log`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "comments",
      label: t`Comments`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "roles-permissions",
      label: t`Roles & permissions`,
      free: false,
      teams: false,
      pro: true,
      enterprise: true,
    },
    {
      key: "custom-branding",
      label: t`Custom branding`,
      free: false,
      teams: false,
      pro: true,
      enterprise: true,
    },
  ];

  const collaborationFeatures: PlanFeature[] = [
    {
      key: "mentions",
      label: t`Mentions`,
      free: false,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "email-notifications",
      label: t`Email notifications`,
      free: false,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "assignees",
      label: t`Assignees`,
      free: false,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "invite-links",
      label: t`Invite links`,
      free: false,
      teams: true,
      pro: true,
      enterprise: true,
    },
  ];

  const importsFeatures: PlanFeature[] = [
    {
      key: "import-export",
      label: t`Trello`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
  ];

  const platformFeatures: PlanFeature[] = [
    {
      key: "open-source",
      label: t`Open source`,
      free: true,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "rest-api",
      label: t`API`,
      free: { text: t`Limited API access` },
      teams: { text: t`Full API access` },
      pro: { text: t`Full API access` },
      enterprise: { text: t`Full API access` },
    },
    {
      key: "self-hostable",
      label: t`On-premise`,
      free: false,
      teams: false,
      pro: false,
      enterprise: true,
    },
  ];

  const securityFeatures: PlanFeature[] = [
    {
      key: "sso",
      label: t`SSO`,
      free: { text: t`Google SSO` },
      teams: { text: t`Google SSO` },
      pro: { text: t`Google SSO` },
      enterprise: { text: t`Google SSO + SAML` },
    },
    {
      key: "admin-roles",
      label: t`Admin roles`,
      free: { text: t`Admin roles` },
      teams: { text: t`Admin roles` },
      pro: { text: t`Admin roles` },
      enterprise: { text: t`Advanced admin roles` },
    },
  ];

  const supportFeatures: PlanFeature[] = [
    {
      key: "priority-email-support",
      label: t`Priority email support`,
      free: false,
      teams: true,
      pro: true,
      enterprise: true,
    },
    {
      key: "account-manager",
      label: t`Account manager`,
      free: false,
      teams: false,
      pro: false,
      enterprise: true,
    },
    {
      key: "sla",
      label: t`SLA`,
      free: false,
      teams: false,
      pro: false,
      enterprise: true,
    },
  ];

  const sections: FeatureSection[] = [
    {
      name: "",
      features: planSpecificLimits,
    },
    {
      name: t`Core features`,
      features: coreFeatures,
    },
    {
      name: t`Collaboration`,
      features: collaborationFeatures,
    },
    {
      name: t`Imports`,
      features: importsFeatures,
    },
    {
      name: t`Platform`,
      features: platformFeatures,
    },
    {
      name: t`Security`,
      features: securityFeatures,
    },
    {
      name: t`Support`,
      features: supportFeatures,
    },
  ];

  const plans = [
    { id: "free", name: t`Free`, tierId: "tier-free" },
    { id: "teams", name: t`Teams`, tierId: "tier-teams" },
    { id: "pro", name: t`Pro`, tierId: "tier-pro" },
    { id: "enterprise", name: t`Enterprise`, tierId: "tier-enterprise" },
  ];

  const isHighlightValue = (
    value: string | boolean | { text: string; highlight?: string },
  ): value is { text: string; highlight?: string } => {
    return typeof value === "object" && value !== null && "text" in value;
  };

  const shouldHighlight = (text: string): boolean => {
    const lowerText = text.toLowerCase();
    return ["unlimited", "multiple", "per-seat", "custom", "mentions", "full", "sso", "admin"].some(
      (keyword) => lowerText.includes(keyword),
    );
  };

  const CellValue = ({
    value,
    label,
  }: {
    value: string | boolean | { text: string; highlight?: string };
    label: string;
  }) => {
    // Handle object with text and highlight
    if (isHighlightValue(value)) {
      const { text, highlight } = value;
      const isUnlimited = shouldHighlight(text);
      
      let displayText;
      if (highlight) {
        const parts = text.split(new RegExp(`(${highlight})`, "gi"));
        displayText = (
          <>
            {parts.map((part, index) =>
              part.toLowerCase() === highlight.toLowerCase() ? (
                <span key={index} className="text-light-1000 dark:text-dark-1000">
                  {part}
                </span>
              ) : (
                <span key={index} className="text-light-950 dark:text-dark-800">
                  {part}
                </span>
              ),
            )}
          </>
        );
      } else {
        displayText = text;
      }
      
      return (
        <div className="flex items-center gap-2.5">
          <HiCheckCircle
            className={twMerge(
              "mt-0.5 h-4 w-4 shrink-0",
              isUnlimited
                ? "text-light-1000 dark:text-dark-1000"
                : "text-light-400 dark:text-dark-600",
            )}
          />
          <span
            className={twMerge(
              "text-sm font-medium",
              isUnlimited
                ? "text-light-1000 dark:text-dark-950"
                : "text-light-950 dark:text-dark-800",
            )}
          >
            {displayText}
          </span>
        </div>
      );
    }
    
    if (typeof value === "string") {
      const isUnlimited = shouldHighlight(value);
      return (
        <div className="flex items-center gap-2.5">
          <HiCheckCircle
            className={twMerge(
              "mt-0.5 h-4 w-4 shrink-0",
              isUnlimited
                ? "text-light-1000 dark:text-dark-1000"
                : "text-light-400 dark:text-dark-600",
            )}
          />
          <span
            className={twMerge(
              "text-sm font-medium",
              isUnlimited
                ? "text-light-1000 dark:text-dark-950"
                : "text-light-950 dark:text-dark-800",
            )}
          >
            {value}
          </span>
        </div>
      );
    }
    if (value) {
      // Boolean true - show checkmark icon
      return (
        <div className="flex items-center gap-2.5">
          <HiCheckCircle className="mt-0.5 h-4 w-4 shrink-0 text-light-1000 dark:text-dark-1000" />
          <span className="text-sm font-medium text-light-1000 dark:text-dark-950">
            {label}
          </span>
        </div>
      );
    }
    // Boolean false - show cross icon
    return (
      <div className="flex items-center gap-2.5">
        <HiXCircle className="mt-0.5 h-4 w-4 shrink-0 text-light-400 dark:text-dark-600" />
        <span className="text-sm font-medium text-light-800 dark:text-dark-800">
          {label}
        </span>
      </div>
    );
  };

  const getFeatureValue = (
    feature: PlanFeature,
    planId: string,
  ): string | boolean | { text: string; highlight?: string } => {
    switch (planId) {
      case "free":
        return feature.free;
      case "teams":
        return feature.teams;
      case "pro":
        return feature.pro;
      case "enterprise":
        return feature.enterprise;
      default:
        return false;
    }
  };

  return (
    <section aria-labelledby="comparison-heading" className="w-full">
      <div className="mx-auto max-w-7xl">
        <div
          ref={containerRef}
          className="relative overflow-x-auto rounded-lg border border-light-300 bg-light-50 dark:border-dark-300 dark:bg-dark-50"
        >
          {isHeaderFixed && (
            <div
              className="hidden sm:block fixed z-40 border-b border-light-300 bg-light-50/95 dark:border-dark-400 dark:bg-dark-50/95"
              style={{
                top: 64,
                left: headerRect.left,
                width: headerRect.width,
              }}
            >
              <div className="grid grid-cols-4 border-x border-light-300 dark:border-dark-300">
                {plans.map((plan) => {
                  const isMostPopular = plan.id === "pro";
                  return (
                    <div
                      key={`fixed-${plan.id}`}
                      className={twMerge(
                        "flex items-center px-6 py-3 text-left text-base font-semibold",
                        isMostPopular
                          ? "bg-light-200 text-light-1000 dark:bg-dark-100 dark:text-dark-1000"
                          : "bg-light-50 text-dark-50 dark:bg-dark-50 dark:text-dark-1000",
                      )}
                    >
                      {plan.name}
                      {plan.id === "pro" && <span className="ml-1 text-xl">âˆ</span>}
                    </div>
                  );
                })}
              </div>
            </div>
          )}
          <table className="w-full border-separate border-spacing-0">
            <thead>
              <tr>
                {plans.map((plan) => {
                  const isMostPopular = plan.id === "pro";
                  return (
                    <th
                      key={plan.id}
                      scope="col"
                      className={twMerge(
                        "w-1/4 px-6 py-4 text-left text-base font-semibold",
                        isMostPopular
                          ? "bg-light-200 text-light-1000 dark:bg-dark-100 dark:text-dark-1000"
                          : "bg-light-50 text-dark-50 dark:bg-dark-50 dark:text-dark-1000",
                      )}
                    >
                      <span className="flex items-center">
                        {plan.name}
                        {plan.id === "pro" && <span className="ml-1 text-xl">âˆ</span>}
                      </span>
                    </th>
                  );
                })}
              </tr>
            </thead>
            <tbody>
              {sections.map((section, sectionIdx) => (
                <React.Fragment key={section.name || `section-${sectionIdx}`}>
                  {section.name && (
                    <tr>
                      {plans.map((plan) => {
                        const isPro = plan.id === "pro";
                        return (
                          <td
                            key={plan.id}
                            className={twMerge(
                              "border-t px-6 py-3 text-left text-sm font-semibold text-dark-900 dark:text-dark-900",
                              isPro
                                ? "border-light-400 bg-light-200 dark:border-dark-400 dark:bg-dark-100"
                                : "border-light-300 bg-light-50 dark:border-dark-400 dark:bg-dark-50",
                            )}
                          >
                            {plan.id === "free" ? section.name : ""}
                          </td>
                        );
                      })}
                    </tr>
                  )}
                  {section.features.map((feature) => (
                    <tr key={feature.key}>
                      {plans.map((plan) => {
                        const isPro = plan.id === "pro";
                        return (
                          <td
                            key={plan.id}
                            className={twMerge(
                              "w-1/4 border-t px-6 py-3 text-left",
                              isPro
                                ? "border-light-400 bg-light-200 dark:border-dark-400 dark:bg-dark-100"
                                : "border-light-300 dark:border-dark-400",
                            )}
                          >
                            <CellValue
                              value={getFeatureValue(feature, plan.id)}
                              label={feature.label}
                            />
                          </td>
                        );
                      })}
                    </tr>
                  ))}
                </React.Fragment>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </section>
  );
};

export default FeatureComparisonTable;



================================================
FILE: apps/web/src/views/pricing/components/Pricing.tsx
================================================
import Link from "next/link";
import { Radio, RadioGroup } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { useState } from "react";
import { HiBolt, HiCheckCircle } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

type Frequency = "monthly" | "annually";

const Pricing = () => {
  const frequencies = [
    {
      value: "monthly" as Frequency,
      label: t`Monthly`,
      priceSuffix: t`per user/month`,
    },
    {
      value: "annually" as Frequency,
      label: t`Yearly`,
      priceSuffix: t`per user/month`,
    },
  ];

  const [frequency, setFrequency] = useState(frequencies[1]);

  const tiers = [
    {
      name: t`Individuals`,
      id: "tier-individuals",
      href: "signup",
      buttonText: t`Get Started`,
      price: { monthly: t`Free`, annually: t`Free` },
      description: t`Everything you need, free forever. Unlimited boards, unlimited lists, unlimited cards. Upgrade any time.`,
      featureHeader: t`Free, forever`,
      features: [
        t`1 user`,
        t`Unlimited boards`,
        t`Unlimited lists`,
        t`Unlimited cards`,
        t`Unlimited comments`,
        t`Unlimited activity log`,
      ],
      showPrice: true,
    },
    {
      name: t`Teams`,
      id: "tier-teams",
      href: "signup",
      buttonText: t`Get Started`,
      price: { monthly: "$10.00", annually: "$8.00" },
      description: t`Kanban is better with a team. Perfect for small and growing teams looking to collaborate.`,
      featureHeader: t`Everything in the free plan, plus:`,
      features: [
        t`Workspace members`,
        t`Admin roles`,
        t`Priority email support`,
        t`Support the development of the project`,
      ],
      highlighted: true,
      showPrice: true,
      showPriceSuffix: true,
    },
    {
      name: t`Self Host`,
      id: "tier-self-host",
      href: "https://github.com/kanbn/kan",
      buttonText: t`View docs`,
      price: { monthly: "-", annually: "-" },
      description: t`Host Kan on your own infrastructure. Ideal for organisations that need complete control over their data.`,
      featureHeader: t`Complete control and ownership:`,
      features: [
        t`Run on your own infrastructure`,
        t`Own your data`,
        t`Custom domain`,
      ],
      mostPopular: false,
      showPrice: false,
    },
  ];

  return (
    <>
      <div className="flex flex-col items-center justify-center px-4 pb-10">
        <div className="flex items-center gap-2 rounded-full border bg-light-50 px-4 py-1 text-center text-xs text-light-1000 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900 lg:text-sm">
          <p>{t`Pricing`}</p>
        </div>

        <p className="mt-4 text-center text-3xl font-bold text-light-1000 dark:text-dark-1000 lg:text-5xl">
          {t`Simple pricing`}
        </p>
        <p className="text:md lg:text-md mt-6 max-w-[500px] text-center text-dark-900">
          {t`Get started for free, with no usage limits. For collaboration, upgrade to a plan that fits the size of your team.`}
        </p>

        <div className="mt-14 flex flex-col items-center justify-center">
          <div className="mb-8 flex items-center gap-2 rounded-full border bg-white px-4 py-1.5 text-center text-xs font-bold text-gray-800 dark:border-dark-300 dark:bg-dark-1000 dark:text-gray-800 lg:text-sm">
            <HiBolt />
            <p>{t`Launch offer: unlimited seats for just $29/month with Pro`}</p>
          </div>
          <fieldset aria-label={t`Payment frequency`}>
            <RadioGroup
              value={frequency}
              onChange={(value) => setFrequency(value)}
              className="grid grid-cols-2 gap-x-1 rounded-full p-1 text-center text-xs/5 font-semibold ring-1 ring-inset ring-light-600 dark:ring-dark-600"
            >
              {frequencies.map((option) => (
                <Radio
                  key={option.value}
                  value={option}
                  className={twMerge(
                    "cursor-pointer rounded-full px-2.5 py-1 text-xs transition-colors lg:text-sm",
                    frequency?.value === option.value
                      ? "bg-dark-50 text-white dark:bg-light-50 dark:text-dark-50"
                      : "text-light-900 hover:bg-light-100 dark:hover:bg-dark-100",
                  )}
                >
                  {option.label}
                </Radio>
              ))}
            </RadioGroup>
          </fieldset>
        </div>
      </div>

      <div className="isolate mx-auto mb-20 grid max-w-md grid-cols-1 gap-8 px-4 lg:mx-0 lg:max-w-none lg:grid-cols-3">
        {tiers.map((tier) => (
          <div
            key={tier.id}
            className={twMerge(
              tier.highlighted
                ? "bg-dark-50 ring-1 ring-dark-50 dark:ring-dark-800"
                : "bg-light-50 ring-1 ring-light-300 dark:bg-dark-50 dark:ring-dark-300",
              "rounded-3xl p-8 xl:p-10",
            )}
          >
            <div className="flex items-center justify-between gap-x-4">
              <h3
                id={tier.id}
                className={twMerge(
                  tier.highlighted
                    ? "text-dark-1000 dark:text-dark-1000"
                    : "text-dark-50 dark:text-dark-1000",
                  "text-lg/8 font-semibold",
                )}
              >
                {tier.name}
              </h3>
              {tier.highlighted && frequency?.value === "annually" ? (
                <p className="rounded-full bg-light-50 px-2.5 py-1 text-[12px] font-semibold text-dark-500 dark:bg-dark-1000 dark:text-dark-50">
                  -20%
                </p>
              ) : null}
            </div>
            <p
              className={twMerge(
                "mt-4 text-sm/6 text-dark-950 dark:text-dark-900",
                tier.highlighted ? "text-light-100" : "text-dark-50",
              )}
            >
              {tier.description}
            </p>
            <p className="mt-6 flex items-baseline gap-x-1">
              <span
                className={twMerge(
                  "text-3xl font-semibold tracking-tight text-light-100",
                  tier.highlighted
                    ? "text-light-50 dark:text-dark-1000"
                    : "text-gray-900 dark:text-dark-1000",
                  !tier.showPrice && "opacity-0",
                )}
              >
                {tier.price[frequency?.value ?? "monthly"]}
              </span>
              {tier.showPriceSuffix && (
                <span className="text-sm/6 font-semibold text-light-50 dark:text-dark-900">
                  {frequency?.priceSuffix}
                </span>
              )}
            </p>
            <Link
              href={tier.href}
              aria-describedby={tier.id}
              className={twMerge(
                tier.highlighted
                  ? "bg-light-50 text-dark-50 shadow-sm dark:bg-dark-1000 dark:text-dark-50"
                  : "bg-dark-50 text-light-50 dark:bg-dark-200 dark:text-dark-1000",
                "mt-6 block rounded-md px-3 py-2 text-center text-sm/6 font-semibold focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",
              )}
            >
              {tier.buttonText}
            </Link>
            <p
              className={twMerge(
                "mt-8 text-sm/6 font-bold",
                tier.highlighted
                  ? "text-light-100 dark:text-dark-1000"
                  : "text-dark-50 dark:text-dark-1000",
              )}
            >
              {tier.featureHeader}
            </p>
            <ul
              role="list"
              className={twMerge(
                "mt-2 space-y-3 text-sm/6 text-light-600",
                tier.highlighted
                  ? "text-light-100 dark:text-dark-1000"
                  : "text-dark-50 dark:text-dark-1000",
              )}
            >
              {tier.features.map((feature) => (
                <li key={feature} className="flex items-center gap-x-3">
                  <HiCheckCircle className="h-5 w-5" />
                  {feature}
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </>
  );
};

export default Pricing;



================================================
FILE: apps/web/src/views/pricing/components/PricingTiers.tsx
================================================
import Link from "next/link";
import { Radio, RadioGroup } from "@headlessui/react";
import { t } from "@lingui/core/macro";
import { HiBolt, HiCheckCircle } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

type FrequencyValue = "monthly" | "annually";

interface Frequency {
  value: FrequencyValue;
  label: string;
  priceSuffix: string;
}

const Pricing = ({
  frequency,
  frequencies,
  setFrequency,
}: {
  frequency: Frequency | undefined;
  frequencies: Frequency[];
  setFrequency: (frequency: Frequency) => void;
}) => {
  const tiers = [
    {
      name: t`Free`,
      id: "tier-free",
      href: "signup",
      buttonText: t`Get started`,
      price: { monthly: t`$0`, annually: t`$0` },
      description: t`Free for everyone`,
      bestFor: t`Best for individuals and solo creators getting started`,
      featureHeader: undefined,
      features: [
        { text: t`1 user` },
        { text: t`Unlimited boards` },
        { text: t`Unlimited cards` },
        { text: t`Custom board templates` },
        { text: t`Checklists` },
      ],
      showPrice: true,
      ctaSubtext: undefined,
      mostPopular: false,
      highlighted: false,
    },
    {
      name: t`Teams`,
      id: "tier-teams",
      href: "signup",
      buttonText: t`Get started`,
      price: { monthly: "$10", annually: "$8" },
      description: t`Perfect for small and growing teams looking to collaborate.`,
      bestFor: t`Best for small and growing teams that need collaboration`,
      featureHeader: undefined,
      features: [
        { text: t`All Free features +` },
        { text: t`Workspace members` },
        { text: t`Invite links` },
        { text: t`Unlimited file uploads` },
        { text: t`Email notifications for mentions` },
        { text: t`Priority email support` },
      ],
      highlighted: false,
      showPrice: true,
      showPriceSuffix: true,
      ctaSubtext: t`14 day free trial Â· Switch plans or cancel anytime`,
      mostPopular: false,
    },
    {
      name: t`Pro`,
      id: "tier-pro",
      href: "signup",
      buttonText: t`Get started`,
      price: { monthly: "$29", annually: "$24" },
      description: t`Unlimited seats and advanced features for growing teams.`,
      bestFor: t`Best for teams that want to scale without limits`,
      featureHeader: undefined,
      features: [
        { text: t`All Teams features +` },
        { text: t`Unlimited members` },
        { text: t`Custom workspace username` },
        { text: t`Configurable user roles and permissions` },
        { text: t`Custom branding` },
      ],
      highlighted: true,
      showPrice: true,
      showPriceSuffix: false,
      ctaSubtext: t`14 day free trial Â· Switch plans or cancel anytime`,
      mostPopular: true,
    },
    {
      name: t`Enterprise`,
      id: "tier-enterprise",
      href: "mailto:support@kan.bn?subject=Enterprise Inquiry",
      buttonText: t`Contact Sales`,
      price: { monthly: t`Contact us`, annually: t`Contact us` },
      description: t`Advanced security, compliance, and dedicated support for large organizations.`,
      bestFor: t`Best for large organizations with advanced needs`,
      featureHeader: undefined,
      features: [
        { text: t`All Pro features +` },
        { text: t`SAML SSO` },
        { text: t`Advanced admin controls` },
        { text: t`Dedicated account manager` },
        { text: t`Custom SLA` },
        { text: t`On-premise deployment option` },
      ],
      highlighted: false,
      showPrice: true,
      showPriceSuffix: false,
      ctaSubtext: undefined,
      mostPopular: false,
    },
  ];

  return (
    <>
      <div className="mx-auto max-w-7xl px-4">
        <div className="mb-8 flex items-center justify-center">
          <fieldset aria-label={t`Payment frequency`}>
            <RadioGroup
              value={frequency}
              onChange={(value) => setFrequency(value)}
              className="flex gap-1 rounded-lg border border-light-300 bg-light-50 p-1 dark:border-dark-300 dark:bg-dark-50"
            >
              {frequencies.map((option) => (
                <Radio
                  key={option.value}
                  value={option}
                  className={twMerge(
                    "cursor-pointer rounded-md px-4 py-1.5 text-sm font-medium transition-colors",
                    frequency?.value === option.value
                      ? "bg-white text-light-1000 shadow-sm dark:bg-dark-100 dark:text-dark-1000"
                      : "text-light-600 dark:text-dark-700",
                  )}
                >
                  {option.label}
                </Radio>
              ))}
            </RadioGroup>
          </fieldset>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
        {tiers.map((tier) => (
          <div
            key={tier.id}
            className={twMerge(
              "relative flex h-full flex-col rounded-lg border p-6",
              tier.mostPopular
                ? "border-light-400 bg-light-200 dark:border-dark-400 dark:bg-dark-100"
                : "border-light-300 bg-light-50 dark:border-dark-300 dark:bg-dark-50",
            )}
          >
            {tier.id === "tier-pro" && (
              <div className="absolute right-2 top-2 z-10">
                <span className="inline-flex items-center gap-1 rounded-full border border-light-400 bg-light-100 px-3 py-1 text-center text-xs text-dark-600 dark:border-dark-400 dark:bg-dark-100 dark:text-dark-900">
                  <HiBolt className="h-3 w-3 -ml-0.5" />
                  {t`Launch offer`}
                </span>
              </div>
            )}
            <h3
              id={tier.id}
              className={twMerge(
                "mb-4 flex items-center text-base font-semibold",
                tier.mostPopular
                  ? "text-light-1000 dark:text-dark-1000"
                  : "text-light-1000 dark:text-dark-1000",
              )}
            >
              {tier.name}
              {tier.id === "tier-pro" && <span className="ml-1 text-xl leading-none">âˆ</span>}
            </h3>
            <div className="mb-4">
              <p className="flex items-baseline gap-x-1">
                <span
                  className={twMerge(
                    "text-2xl font-semibold",
                    tier.mostPopular
                      ? "text-light-1000 dark:text-dark-1000"
                      : "text-light-1000 dark:text-dark-1000",
                    !tier.showPrice && "opacity-0",
                  )}
                >
                  {tier.price[frequency?.value ?? "monthly"]}
                </span>
                {tier.id === "tier-pro" && (
                  <span
                    className={twMerge(
                      "text-2xl font-semibold line-through",
                      tier.mostPopular
                        ? "text-light-600 dark:text-dark-600"
                        : "text-light-600 dark:text-dark-600",
                    )}
                  >
                    {frequency?.value === "annually" ? "$79" : "$100"}
                  </span>
                )}
                {tier.showPriceSuffix && (
                  <span className="text-sm font-normal text-dark-400 dark:text-dark-700">
                    {frequency?.priceSuffix}
                  </span>
                )}
                {tier.id === "tier-pro" && (
                  <span className="text-sm font-normal text-dark-400 dark:text-dark-700">
                    {t`/month`}
                  </span>
                )}
              </p>
            </div>
            {tier.bestFor && (
              <p className="mb-6 text-sm text-dark-400 dark:text-dark-700">
                {tier.bestFor}
              </p>
            )}
            <div className="mb-6">
              {tier.id === "tier-enterprise" ? (
                <a
                  href={tier.href}
                  aria-describedby={tier.id}
                  className="block w-full rounded-md border border-dark-200 bg-transparent px-4 py-2 text-center text-sm font-medium text-dark-50 transition-colors hover:bg-dark-50 hover:text-light-50 dark:border-dark-300 dark:text-dark-1000 dark:hover:bg-dark-200"
                >
                  {tier.buttonText}
                </a>
              ) : (
                <>
                  <Link
                    href={tier.href}
                    aria-describedby={tier.id}
                    className={twMerge(
                      "block w-full rounded-md px-4 py-2 text-center text-sm font-medium transition-colors",
                      tier.mostPopular
                        ? "bg-dark-50 text-light-50 shadow-sm hover:bg-dark-100 dark:bg-dark-1000 dark:text-dark-50 dark:hover:bg-dark-900"
                        : "border border-dark-200 bg-transparent text-dark-50 transition-colors hover:bg-dark-50 hover:text-light-50 dark:border-dark-300 dark:text-dark-1000 dark:hover:bg-dark-200",
                    )}
                  >
                    {tier.buttonText}
                  </Link>
                </>
              )}
            </div>
            <ul role="list" className="space-y-2.5">
              {tier.features.map((feature, index) => (
                <li
                  key={`${tier.id}-feature-${index}`}
                  className="flex items-start gap-x-2.5"
                >
                  <HiCheckCircle
                    className="mt-0.5 h-4 w-4 shrink-0 text-light-1000 dark:text-dark-1000"
                  />
                  <span className="text-sm text-dark-600 dark:text-dark-800">
                    {feature.text}
                  </span>
                </li>
              ))}
            </ul>
          </div>
        ))}
        </div>
        <div className="mx-auto mt-8 max-w-3xl px-4 text-center">
          <div className="inline-flex items-center gap-2 rounded-full border bg-light-50 px-4 py-1 text-center text-xs text-light-1000 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900">
            <p>{t`14 day free trial Â· Switch plans or cancel anytime`}</p>
          </div>
        </div>
      </div>
    </>
  );
};

export default Pricing;



================================================
FILE: apps/web/src/views/privacy/index.tsx
================================================
import Link from "next/link";

import { PageHead } from "~/components/PageHead";
import Layout from "../home/components/Layout";

export default function PrivacyView() {
  const SubHeading = ({ children }: { children: React.ReactNode }) => (
    <h3 className="mb-4 text-2xl font-bold text-light-1000 dark:text-dark-950">
      {children}
    </h3>
  );

  const Text = ({ children }: { children: React.ReactNode }) => (
    <p className="line-height text-md mb-4 text-light-1000 dark:text-dark-900">
      {children}
    </p>
  );

  const UnorderedList = ({ children }: { children: React.ReactNode }) => (
    <ul className="list-disc pl-6">{children}</ul>
  );

  const ListItem = ({ children }: { children: React.ReactNode }) => (
    <li className="line-height text-md mb-4 text-light-1000 dark:text-dark-900">
      {children}
    </li>
  );

  const NAME = "Open Engineering";

  return (
    <Layout>
      <PageHead title="Privacy Policy | kan.bn" />
      <div className="flex flex-col items-center">
        <div className="mb-20 flex h-full w-full max-w-[800px] flex-col lg:pt-[5rem]">
          <div className="flex items-center justify-center py-36 text-4xl font-bold tracking-tight text-light-1000 dark:text-dark-1000">
            <h2>Privacy Policy</h2>
          </div>
          <p className="mb-6 text-sm text-light-1000 dark:text-dark-900">
            Last updated: 23rd Feb 2025
          </p>
          <div className="mb-6">
            <SubHeading>Introduction</SubHeading>
            <Text>
              Your privacy is important to us. It is our policy to respect your
              privacy and comply with any applicable law and regulation
              regarding any personal information we may collect about you,
              including across our website, {NAME}, and other sites we own and
              operate.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Information We Collect</SubHeading>
            <Text>
              Information we collect includes both information you knowingly and
              actively provide us when using or participating in any of our
              services and promotions, and any information automatically sent by
              your devices in the course of accessing our products and services.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Log Data</SubHeading>
            <Text>
              When you visit our website, our servers may automatically log the
              standard data provided by your web browser. It may include your
              deviceâ€™s Internet Protocol (IP) address, your browser type and
              version, the pages you visit, the time and date of your visit, the
              time spent on each page, other details about your visit, and
              technical details that occur in conjunction with any errors you
              may encounter.
            </Text>
            <Text>
              Please be aware that while this information may not be personally
              identifying by itself, it may be possible to combine it with other
              data to personally identify individual persons.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Personal Information</SubHeading>
            <Text>
              We may ask for personal information which may include one or more
              of the following:
            </Text>
            <UnorderedList>
              <ListItem>Name</ListItem>
              <ListItem>Email</ListItem>
            </UnorderedList>
          </div>

          <div className="mb-6">
            <SubHeading>
              Legitimate Reasons for Processing Your Personal Information
            </SubHeading>
            <Text>
              We only collect and use your personal information when we have a
              legitimate reason for doing so. In which instance, we only collect
              personal information that is reasonably necessary to provide our
              services to you.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Collection and Use of Information</SubHeading>
            <Text>
              We may collect personal information from you when you do any of
              the following on our website:
            </Text>
            <UnorderedList>
              <ListItem>
                Sign up to receive updates from us via email or social media
                channels
              </ListItem>
              <ListItem>
                Use a mobile device or web browser to access our content
              </ListItem>
              <ListItem>
                Contact us via email, social media, or on any similar
                technologies
              </ListItem>
              <ListItem>When you mention us on social media</ListItem>
            </UnorderedList>
            <Text>
              We may collect, hold, use, and disclose information for the
              following purposes, and personal information will not be further
              processed in a manner that is incompatible with these purposes:
            </Text>
            <UnorderedList>
              <ListItem>to contact and communicate with you</ListItem>
              <ListItem>
                for analytics, market research, and business development,
                including to operate and improve our website, associated
                applications, and associated social media platforms
              </ListItem>
              <ListItem>
                to enable you to access and use our website, associated
                applications, and associated social media platforms
              </ListItem>
            </UnorderedList>
            <Text>
              Please be aware that we may combine information we collect about
              you with general information or research data we receive from
              other trusted sources.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Security of Your Personal Information</SubHeading>
            <Text>
              When we collect and process personal information, and while we
              retain this information, we will protect it within commercially
              acceptable means to prevent loss and theft, as well as
              unauthorized access, disclosure, copying, use, or modification.
            </Text>

            <Text>
              Although we will do our best to protect the personal information
              you provide to us, we advise that no method of electronic
              transmission or storage is 100% secure, and no one can guarantee
              absolute data security. We will comply with laws applicable to us
              in respect of any data breach.
            </Text>
            <Text>
              You are responsible for selecting any password and its overall
              security strength, ensuring the security of your own information
              within the bounds of our services.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>How Long We Keep Your Personal Information</SubHeading>
            <Text>
              We keep your personal information only for as long as we need to.
              This time period may depend on what we are using your information
              for, in accordance with this privacy policy. If your personal
              information is no longer required, we will delete it or make it
              anonymous by removing all details that identify you.
            </Text>

            <Text>
              However, if necessary, we may retain your personal information for
              our compliance with a legal, accounting, or reporting obligation
              or for archiving purposes in the public interest, scientific, or
              historical research purposes or statistical purposes.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Childrenâ€™s Privacy</SubHeading>
            <Text>
              We do not aim any of our products or services directly at children
              under the age of 13, and we do not knowingly collect personal
              information about children under 13.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>
              Disclosure of Personal Information to Third Parties
            </SubHeading>
            <Text>We may disclose personal information to</Text>
            <UnorderedList>
              <ListItem>
                a parent, subsidiary, or affiliate of our company
              </ListItem>
              <ListItem>
                third party service providers for the purpose of enabling them
                to provide their services, for example, IT service providers,
                data storage, hosting and server providers, advertisers, or
                analytics platforms
              </ListItem>
              <ListItem>
                our employees, contractors, and/or related entities
              </ListItem>
              <ListItem>
                our existing or potential agents or business partners
              </ListItem>
              <ListItem>
                sponsors or promoters of any competition, sweepstakes, or
                promotion we run
              </ListItem>
              <ListItem>
                courts, tribunals, regulatory authorities, and law enforcement
                officers, as required by law, in connection with any actual or
                prospective legal proceedings, or in order to establish,
                exercise, or defend our legal rights
              </ListItem>
              <ListItem>
                third parties, including agents or sub-contractors, who assist
                us in providing information, products, services, or direct
                marketing to you third parties to collect and process data
              </ListItem>
            </UnorderedList>
          </div>

          <div className="mb-6">
            <SubHeading>
              International Transfers of Personal Information
            </SubHeading>
            <Text>
              The personal information we collect is stored and/or processed
              where we or our partners, affiliates, and third-party providers
              maintain facilities. Please be aware that the locations to which
              we store, process, or transfer your personal information may not
              have the same data protection laws as the country in which you
              initially provided the information. If we transfer your personal
              information to third parties in other countries: (i) we will
              perform those transfers in accordance with the requirements of
              applicable law; and (ii) we will protect the transferred personal
              information in accordance with this privacy policy.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>
              Your Rights and Controlling Your Personal Information
            </SubHeading>
            <Text>
              You always retain the right to withhold personal information from
              us, with the understanding that your experience of our website may
              be affected. We will not discriminate against you for exercising
              any of your rights over your personal information. If you do
              provide us with personal information you understand that we will
              collect, hold, use and disclose it in accordance with this privacy
              policy. You retain the right to request details of any personal
              information we hold about you.
            </Text>
            <Text>
              If we receive personal information about you from a third party,
              we will protect it as set out in this privacy policy. If you are a
              third party providing personal information about somebody else,
              you represent and warrant that you have such personâ€™s consent to
              provide the personal information to us.
            </Text>
            <Text>
              If you have previously agreed to us using your personal
              information for direct marketing purposes, you may change your
              mind at any time. We will provide you with the ability to
              unsubscribe from our email-database or opt out of communications.
              Please be aware we may need to request specific information from
              you to help us confirm your identity.
            </Text>
            <Text>
              If you believe that any information we hold about you is
              inaccurate, out of date, incomplete, irrelevant, or misleading,
              please contact us using the details provided in this privacy
              policy. We will take reasonable steps to correct any information
              found to be inaccurate, incomplete, misleading, or out of date.
            </Text>
            <Text>
              If you believe that we have breached a relevant data protection
              law and wish to make a complaint, please contact us using the
              details below and provide us with full details of the alleged
              breach. We will promptly investigate your complaint and respond to
              you, in writing, setting out the outcome of our investigation and
              the steps we will take to deal with your complaint. You also have
              the right to contact a regulatory body or data protection
              authority in relation to your complaint.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Limits of Our Policy</SubHeading>
            <Text>
              Our website may link to external sites that are not operated by
              us. Please be aware that we have no control over the content and
              policies of those sites, and cannot accept responsibility or
              liability for their respective privacy practices.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Changes to This Policy</SubHeading>
            <Text>
              At our discretion, we may change our privacy policy to reflect
              updates to our business processes, current acceptable practices,
              or legislative or regulatory changes. If we decide to change this
              privacy policy, we will post the changes here at the same link by
              which you are accessing this privacy policy.
            </Text>
            <Text>
              If required by law, we will get your permission or give you the
              opportunity to opt in to or opt out of, as applicable, any new
              uses of your personal information.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Contact Us</SubHeading>
            <Text>
              For any questions or concerns regarding your privacy, you may
              contact us using the following details:
            </Text>
            <Link
              className="line-height text-md mb-4 text-light-1000 dark:text-dark-900"
              href="mailto:support@kan.bn"
            >
              support@kan.bn
            </Link>
          </div>
        </div>
      </div>
    </Layout>
  );
}



================================================
FILE: apps/web/src/views/public/board/CardModal.tsx
================================================
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { useEffect, useRef, useState } from "react";
import { HiLink, HiXMark } from "react-icons/hi2";

import Badge from "~/components/Badge";
import Editor from "~/components/Editor";
import LabelIcon from "~/components/LabelIcon";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import ActivityList from "~/views/card/components/ActivityList";
import { AttachmentThumbnails } from "~/views/card/components/AttachmentThumbnails";
import Checklists from "~/views/card/components/Checklists";

export function CardModal({
  cardPublicId,
  workspaceSlug,
  boardSlug,
}: {
  cardPublicId: string | null | undefined;
  workspaceSlug: string | null | undefined;
  boardSlug: string | null | undefined;
}) {
  const router = useRouter();
  const { closeModal, isOpen } = useModal();
  const { showPopup } = usePopup();
  const [showFade, setShowFade] = useState(false);
  const [showTopFade, setShowTopFade] = useState(false);
  const scrollRef = useRef<HTMLDivElement>(null);

  const handleCopyCardLink = async () => {
    try {
      await navigator.clipboard.writeText(window.location.href);
      showPopup({
        header: t`Link copied`,
        icon: "success",
        message: t`Card URL copied to clipboard`,
      });
    } catch (error) {
      console.error(error);
      showPopup({
        header: t`Unable to copy link`,
        icon: "error",
        message: t`Please try again.`,
      });
    }
  };

  const { data, isLoading } = api.card.byId.useQuery(
    {
      cardPublicId: cardPublicId ?? "",
    },
    {
      enabled: isOpen && !!cardPublicId && cardPublicId.length >= 12,
    },
  );

  const labels = data?.labels ?? [];

  const handleScroll = () => {
    if (!scrollRef.current) return;

    const { scrollTop, scrollHeight, clientHeight } = scrollRef.current;
    const isAtBottom = scrollTop + clientHeight >= scrollHeight - 5;
    const isAtTop = scrollTop <= 5;

    setShowFade(!isAtBottom);
    setShowTopFade(!isAtTop);
  };

  useEffect(() => {
    const scrollElement = scrollRef.current;
    if (!scrollElement) return;

    handleScroll();

    scrollElement.addEventListener("scroll", handleScroll);
    return () => scrollElement.removeEventListener("scroll", handleScroll);
  }, [data]);

  return (
    <div className="flex h-full flex-1 flex-row">
      <div className="flex h-full w-full flex-col overflow-hidden">
        <div className="h-full p-8">
          <div className="mb-6">
            <div className="flex w-full items-center justify-between">
              <div className="absolute right-[2rem] top-[2rem] flex items-center gap-1">
                <button
                  type="button"
                  onClick={handleCopyCardLink}
                  className="rounded p-1.5 transition-all hover:bg-light-200 focus:outline-none dark:hover:bg-dark-100"
                  aria-label="Copy card link"
                >
                  <HiLink className="h-4 w-4 text-light-900 dark:text-dark-900" />
                </button>
                <button
                  type="button"
                  className="rounded p-1.5 transition-all hover:bg-light-200 focus:outline-none dark:hover:bg-dark-100"
                  onClick={(e) => {
                    e.preventDefault();
                    closeModal();

                    setTimeout(() => {
                      void router.replace(
                        {
                          pathname: router.pathname,
                          query: {
                            ...router.query,
                            workspaceSlug: workspaceSlug ?? "",
                            boardSlug: [boardSlug ?? ""],
                          },
                        },
                        undefined,
                        { shallow: true },
                      );
                    }, 400);
                  }}
                >
                  <HiXMark
                    size={18}
                    className="text-light-900 dark:text-dark-900"
                  />
                </button>
              </div>
              {isLoading ? (
                <div className="flex space-x-2">
                  <div className="h-[2.3rem] w-[300px] animate-pulse rounded-[5px] bg-light-300 dark:bg-dark-300" />
                </div>
              ) : (
                <>
                  <h1 className="pr-8 font-bold leading-[2.3rem] tracking-tight text-neutral-900 dark:text-dark-1000 sm:text-[1.2rem]">
                    {data?.title}
                  </h1>
                </>
              )}
            </div>
            {labels.length > 0 && (
              <div className="mt-2">
                {labels.map((label) => (
                  <Badge
                    key={label.publicId}
                    value={label.name}
                    iconLeft={<LabelIcon colourCode={label.colourCode} />}
                  />
                ))}
              </div>
            )}
          </div>

          <div className="relative">
            <div
              ref={scrollRef}
              className="h-full max-h-[425px] overflow-y-auto"
            >
              {data?.description && (
                <div className="mb-10 flex w-full max-w-2xl justify-between">
                  <div className="mt-2">
                    <Editor
                      content={data.description}
                      readOnly
                      workspaceMembers={
                        data?.list.board.workspace.members ?? []
                      }
                    />
                  </div>
                </div>
              )}
              {data?.attachments &&
                data.attachments.length > 0 &&
                cardPublicId && (
                  <div className="mb-10 max-w-2xl">
                    <AttachmentThumbnails
                      attachments={data.attachments}
                      cardPublicId={cardPublicId}
                      isReadOnly
                    />
                  </div>
                )}
              {data?.checklists && data.checklists.length > 0 && (
                <Checklists
                  checklists={data.checklists}
                  cardPublicId={cardPublicId ?? ""}
                  viewOnly
                />
              )}
              <div className="border-t-[1px] border-light-600 pb-4 pt-12 dark:border-dark-400">
                <h2 className="text-md pb-4 font-medium text-light-900 dark:text-dark-1000">
                  {t`Activity`}
                </h2>
                <div>
                  {cardPublicId && (
                    <ActivityList
                      cardPublicId={cardPublicId}
                      isLoading={isLoading}
                      isViewOnly={true}
                    />
                  )}
                </div>
              </div>
            </div>
            {showTopFade && (
              <div className="pointer-events-none absolute left-0 right-0 top-0 h-6 bg-gradient-to-b from-white/80 to-transparent dark:from-dark-100/80" />
            )}
            {showFade && (
              <div className="pointer-events-none absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-white/80 to-transparent dark:from-dark-100/80" />
            )}
          </div>
        </div>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/public/board/index.tsx
================================================
import Link from "next/link";
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { keepPreviousData } from "@tanstack/react-query";
import { env } from "next-runtime-env";
import { useEffect, useState } from "react";
import { HiLink, HiOutlineLockClosed } from "react-icons/hi2";

import Button from "~/components/Button";
import Modal from "~/components/modal";
import { PageHead } from "~/components/PageHead";
import PatternedBackground from "~/components/PatternedBackground";
import Popup from "~/components/Popup";
import ThemeToggle from "~/components/ThemeToggle";
import { useDragToScroll } from "~/hooks/useDragToScroll";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { formatToArray } from "~/utils/helpers";
import Card from "~/views/board/components/Card";
import Filters from "~/views/board/components/Filters";
import { CardModal } from "./CardModal";

const IS_CLOUD = env("NEXT_PUBLIC_KAN_ENV") === "cloud";
const HIDE_POWERED_BY =
  env("NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY") === "true";

export default function PublicBoardView() {
  const router = useRouter();
  const { showPopup } = usePopup();
  const [isRouteLoaded, setIsRouteLoaded] = useState(false);
  const { openModal } = useModal();

  const { ref: scrollRef, onMouseDown } = useDragToScroll({
    enabled: true,
    direction: "horizontal",
  });

  const boardSlug = Array.isArray(router.query.boardSlug)
    ? router.query.boardSlug[0]
    : router.query.boardSlug;

  const workspaceSlug = Array.isArray(router.query.workspaceSlug)
    ? router.query.workspaceSlug[0]
    : router.query.workspaceSlug;

  const dueDateFilters = formatToArray(router.query.dueDate) as (
    | "overdue"
    | "today"
    | "tomorrow"
    | "next-week"
    | "next-month"
    | "no-due-date"
  )[];

  const { data, isLoading } = api.board.bySlug.useQuery(
    {
      boardSlug: boardSlug ?? "",
      workspaceSlug: workspaceSlug ?? "",
      members: formatToArray(router.query.members),
      labels: formatToArray(router.query.labels),
      lists: formatToArray(router.query.lists),
      ...(dueDateFilters.length > 0 && {
        dueDateFilters: dueDateFilters,
      }),
    },
    {
      enabled: router.isReady && !!boardSlug,
      placeholderData: keepPreviousData,
    },
  );

  const handleCopyBoardLink = async () => {
    try {
      await navigator.clipboard.writeText(window.location.href);
      showPopup({
        header: t`Link copied`,
        icon: "success",
        message: t`Board URL copied to clipboard`,
      });
    } catch (error) {
      console.error(error);
      showPopup({
        header: t`Unable to copy link`,
        icon: "error",
        message: t`Please try again.`,
      });
    }
  };

  const CopyBoardLink = () => (
    <button
      type="button"
      onClick={handleCopyBoardLink}
      className="rounded p-1.5 transition-all hover:bg-light-200 focus:outline-none dark:hover:bg-dark-100"
      aria-label="Copy board URL"
    >
      <HiLink className="h-4 w-4 text-light-900 dark:text-dark-900" />
    </button>
  );

  const pathWithoutQuery = router.asPath.split("?")[0];
  const splitPath = pathWithoutQuery?.split("/") ?? [];
  const cardPublicId = splitPath.length > 3 ? splitPath[3] : null;

  useEffect(() => {
    if (!isRouteLoaded && router.isReady) {
      setIsRouteLoaded(true);

      if (cardPublicId) {
        openModal("CARD");
      }
    }
  }, [
    router.isReady,
    isRouteLoaded,
    setIsRouteLoaded,
    cardPublicId,
    openModal,
  ]);

  return (
    <>
      <PageHead
        title={`${data?.name ?? t`Board`} | ${data?.workspace.name ?? t`Workspace`}`}
      />
      <style jsx global>{`
        html {
          height: 100vh;
          overflow: hidden;
        }
      `}</style>

      <div className="relative flex h-screen flex-col bg-light-100 px-4 pt-4 dark:bg-dark-50">
        <div className="relative h-full overflow-hidden rounded-md border pb-8 dark:border-dark-200">
          <PatternedBackground />
          <div className="z-10 flex w-full justify-between p-8">
            {isLoading || !router.isReady ? (
              <div className="flex space-x-2">
                <div className="h-[2.3rem] w-[150px] animate-pulse rounded-[5px] bg-light-200 dark:bg-dark-100" />
              </div>
            ) : (
              <h1 className="font-bold leading-[2.3rem] tracking-tight text-neutral-900 focus:ring-0 focus-visible:outline-none dark:text-dark-1000 sm:text-[1.2rem]">
                {data?.name}
              </h1>
            )}
            {data && (
              <div className="z-10 flex items-center space-x-2">
                <div className="inline-flex cursor-default items-center justify-center whitespace-nowrap rounded-md border-[1px] border-light-300 bg-light-50 px-3 py-2 text-sm font-semibold text-light-950 shadow-sm dark:border-dark-300 dark:bg-dark-50 dark:text-dark-950">
                  <span className="mr-2">
                    <HiOutlineLockClosed />
                  </span>
                  {t`View only`}
                </div>
                <Filters
                  labels={data.labels ?? []}
                  members={[]}
                  lists={data.allLists ?? []}
                  isLoading={isLoading}
                />
              </div>
            )}
          </div>

          <div
            ref={scrollRef}
            onMouseDown={onMouseDown}
            className="scrollbar-w-none scrollbar-track-rounded-[4px] scrollbar-thumb-rounded-[4px] scrollbar-h-[8px] relative h-full flex-1 overflow-y-hidden overflow-x-scroll overscroll-contain scrollbar scrollbar-track-light-200 scrollbar-thumb-light-400 dark:scrollbar-track-dark-100 dark:scrollbar-thumb-dark-300"
          >
            {isLoading || !router.isReady ? (
              <div className="ml-[2rem] flex">
                <div className="0 mr-5 h-[500px] w-[18rem] animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
                <div className="0 mr-5 h-[275px] w-[18rem] animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
                <div className="0 mr-5 h-[375px] w-[18rem] animate-pulse rounded-md bg-light-200 dark:bg-dark-100" />
              </div>
            ) : !data && !isLoading && router.isReady && !!boardSlug ? (
              <div className="z-10 flex h-full w-full flex-col items-center justify-center space-y-8 pb-[150px]">
                <div className="flex flex-col items-center">
                  <HiOutlineLockClosed className="h-10 w-10 text-light-800 dark:text-dark-800" />
                  <p className="mb-2 mt-4 text-[14px] font-bold text-light-1000 dark:text-dark-950">
                    {t`Board not found`}
                  </p>
                  <p className="text-[14px] text-light-900 dark:text-dark-900">
                    {t`This board is private or does not exist`}
                  </p>
                </div>
                <Button href={`/${workspaceSlug}`}>{t`View workspace`}</Button>
              </div>
            ) : (
              <div className="flex">
                <div className="min-w-[2rem]" />
                {data?.lists.map((list) => (
                  <div
                    key={list.publicId}
                    className="dark-text-dark-1000 mr-5 h-fit min-w-[18rem] max-w-[18rem] rounded-md border border-light-400 bg-light-300 py-2 pl-2 pr-1 text-neutral-900 dark:border-dark-300 dark:bg-dark-100"
                  >
                    <div className="flex justify-between">
                      <span className="mb-4 block px-4 pt-1 text-sm font-medium text-neutral-900 dark:text-dark-1000">
                        {list.name}
                      </span>
                    </div>
                    <div className="scrollbar-track-rounded-[4px] scrollbar-thumb-rounded-[4px] scrollbar-w-[8px] z-10 h-full max-h-[calc(100vh-265px)] min-h-[2rem] overflow-y-auto pr-1 scrollbar dark:scrollbar-track-dark-100 dark:scrollbar-thumb-dark-600">
                      {list.cards.map((card) => {
                        return (
                          <Link
                            key={card.publicId}
                            href={{
                              pathname: router.pathname,
                              query: {
                                ...router.query,
                                workspaceSlug: data.workspace.slug,
                                boardSlug: [data.slug, card.publicId],
                              },
                            }}
                            className={`mb-2 flex !cursor-pointer flex-col`}
                            shallow={true}
                            onClick={() => {
                              openModal("CARD");
                            }}
                          >
                            <Card
                              title={card.title}
                              labels={card.labels}
                              checklists={card.checklists ?? []}
                              members={[]}
                              description={card.description}
                              comments={card.comments ?? []}
                              attachments={card.attachments}
                              dueDate={card.dueDate ?? null}
                            />
                          </Link>
                        );
                      })}
                    </div>
                  </div>
                ))}
                <div className="min-w-[0.75rem]" />
              </div>
            )}
          </div>
        </div>
        <div className="flex h-[54px] items-center justify-center">
          <div className="absolute left-[1rem]">
            <ThemeToggle />
            <CopyBoardLink />
          </div>

          {IS_CLOUD && (
            <Link
              className="text-lg font-bold tracking-tight text-neutral-900 dark:text-dark-1000"
              href="/"
            >
              kan.bn
            </Link>
          )}

          {!IS_CLOUD && !HIDE_POWERED_BY && (
            <a
              href="https://kan.bn"
              target="_blank"
              rel="noreferrer noopener"
              className="absolute right-[1rem] inline-flex items-center gap-[0.175rem] rounded-full border border-light-300 bg-light-50 px-3 py-1 text-[11px] font-medium text-light-950 shadow-sm transition-colors hover:bg-light-100 dark:border-dark-300 dark:bg-dark-50 dark:text-dark-900 dark:hover:bg-dark-100"
            >
              <span>{`Powered by`}</span>
              <span className="font-semibold">kan.bn</span>
            </a>
          )}
        </div>
      </div>
      <Popup />
      <Modal modalSize={"md"} positionFromTop={"sm"}>
        <CardModal
          cardPublicId={cardPublicId}
          workspaceSlug={data?.workspace.slug}
          boardSlug={data?.slug}
        />
      </Modal>
    </>
  );
}



================================================
FILE: apps/web/src/views/public/boards/index.tsx
================================================
import Link from "next/link";
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { PageHead } from "~/components/PageHead";
import PatternedBackground from "~/components/PatternedBackground";
import { api } from "~/utils/api";

export default function PublicBoardsView() {
  const router = useRouter();

  const workspaceSlug = Array.isArray(router.query.workspaceSlug)
    ? router.query.workspaceSlug[0]
    : router.query.workspaceSlug;

  const { data, isLoading } = api.workspace.bySlug.useQuery(
    {
      workspaceSlug: workspaceSlug ?? "",
    },
    { enabled: !!workspaceSlug },
  );

  const BoardsList = ({
    isLoading,
    boards,
    workspaceSlug,
  }: {
    isLoading: boolean;
    boards: { publicId: string; name: string; slug: string }[];
    workspaceSlug: string;
  }) => {
    if (isLoading)
      return (
        <div className="grid h-full w-full grid-cols-2 grid-rows-2 gap-4">
          <div className="flex h-full w-full animate-pulse rounded-md bg-light-200 dark:bg-dark-200" />
          <div className="flex h-full w-full animate-pulse rounded-md bg-light-200 dark:bg-dark-200" />
          <div className="flex h-full w-full animate-pulse rounded-md bg-light-200 dark:bg-dark-200" />
          <div className="flex h-full w-full animate-pulse rounded-md bg-light-200 dark:bg-dark-200" />
        </div>
      );

    if (boards.length === 0) return <></>;

    return (
      <div className="grid h-full w-full grid-cols-2 grid-rows-2 gap-4">
        {boards.map((board) => (
          <Link
            key={board.publicId}
            href={`/${workspaceSlug}/${board.slug}`}
            className="h-full"
          >
            <div className="relative flex h-full w-full items-center justify-center rounded-md border border-dashed border-light-400 bg-light-50 shadow-sm hover:bg-light-200 dark:border-dark-600 dark:bg-dark-50 dark:hover:bg-dark-100">
              <PatternedBackground />
              <p className="text-md px-4 font-medium text-neutral-900 dark:text-dark-1000">
                {board.name}
              </p>
            </div>
          </Link>
        ))}
      </div>
    );
  };

  return (
    <>
      <PageHead title={`${data?.name ?? t`Workspace`} | kan.bn`} />
      <style jsx global>{`
        html {
          height: 100vh;
          overflow: hidden;
        }
      `}</style>
      <div className="flex h-screen flex-col items-center justify-center bg-light-100 dark:bg-dark-50">
        <h1 className="mb-2 text-2xl font-bold text-light-1000 dark:text-dark-1000">
          {data?.name}
        </h1>
        <p className="mb-6 text-light-1000 dark:text-dark-900">
          {data?.description}
        </p>
        <div className="mb-4 h-[400px] w-[600px] rounded-xl border border-light-400 bg-light-200 p-4 dark:border-dark-200 dark:bg-dark-100">
          {data?.boards && workspaceSlug && (
            <BoardsList
              isLoading={isLoading}
              boards={data.boards}
              workspaceSlug={workspaceSlug}
            />
          )}
        </div>
        <Link
          className="text-lg font-bold tracking-tight text-neutral-900 dark:text-dark-1000"
          href="/"
        >
          kan.bn
        </Link>
      </div>
    </>
  );
}



================================================
FILE: apps/web/src/views/settings/AccountSettings.tsx
================================================
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";

import Button from "~/components/Button";
import FeedbackModal from "~/components/FeedbackModal";
import { LanguageSelector } from "~/components/LanguageSelector";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import { useModal } from "~/providers/modal";
import { api } from "~/utils/api";
import Avatar from "./components/Avatar";
import { ChangePasswordFormConfirmation } from "./components/ChangePasswordConfirmation";
import { DeleteAccountConfirmation } from "./components/DeleteAccountConfirmation";
import UpdateDisplayNameForm from "./components/UpdateDisplayNameForm";

export default function AccountSettings() {
  const { modalContentType, openModal, isOpen } = useModal();
  const isCredentialsEnabled =
    env("NEXT_PUBLIC_ALLOW_CREDENTIALS")?.toLowerCase() === "true";
  const { data } = api.user.getUser.useQuery();

  return (
    <>
      <PageHead title={t`Settings | Account`} />

      <div className="mb-8 border-t border-light-300 dark:border-dark-300">
        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`Profile picture`}
        </h2>
        <Avatar userId={data?.id} userImage={data?.image} />

        <div className="mb-4">
          <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
            {t`Display name`}
          </h2>
          <UpdateDisplayNameForm displayName={data?.name ?? ""} />
        </div>

        <div className="mb-4">
          <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
            {t`Email`}
          </h2>
          <p className="text-sm text-neutral-700 dark:text-dark-900">{data?.email}</p>
        </div>

        <div className="mb-8 border-t border-light-300 dark:border-dark-300">
          <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
            {t`Language`}
          </h2>
          <p className="mb-8 text-sm text-neutral-500 dark:text-dark-900">
            {t`Change your language preferences.`}
          </p>
          <LanguageSelector />
        </div>

        <div className="mb-8 border-t border-light-300 dark:border-dark-300">
          <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
            {t`Delete account`}
          </h2>
          <p className="mb-8 text-sm text-neutral-500 dark:text-dark-900">
            {t`Once you delete your account, there is no going back. This action cannot be undone.`}
          </p>
          <div className="mt-4">
            <Button
              variant="secondary"
              onClick={() => openModal("DELETE_ACCOUNT")}
            >
              {t`Delete account`}
            </Button>
          </div>
        </div>

        {isCredentialsEnabled && (
          <div className="mb-8 border-t border-light-300 dark:border-dark-300">
            <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
              {t`Change Password`}
            </h2>
            <p className="mb-8 text-sm text-neutral-500 dark:text-dark-900">
              {t`You are about to change your password.`}
            </p>
            <div className="mt-4">
              <Button
                variant="secondary"
                onClick={() => openModal("CHANGE_PASSWORD")}
              >
                {t`Change Password`}
              </Button>
            </div>
          </div>
        )}
      </div>

      {/* Account-specific modals */}
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "DELETE_ACCOUNT"}
      >
        <DeleteAccountConfirmation />
      </Modal>
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "CHANGE_PASSWORD"}
      >
        <ChangePasswordFormConfirmation />
      </Modal>

      {/* Global modals */}
      <Modal
        modalSize="md"
        isVisible={isOpen && modalContentType === "NEW_FEEDBACK"}
      >
        <FeedbackModal />
      </Modal>
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
      >
        <NewWorkspaceForm />
      </Modal>
    </>
  );
}



================================================
FILE: apps/web/src/views/settings/ApiSettings.tsx
================================================
import { t } from "@lingui/core/macro";

import Button from "~/components/Button";
import FeedbackModal from "~/components/FeedbackModal";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import { useModal } from "~/providers/modal";
import ApiKeyList from "./components/ApiKeyList";
import NewApiKeyModal from "./components/NewApiKeyModal";
import { RevokeApiKeyConfirmation } from "./components/RevokeApiKeyConfirmation";

export default function ApiSettings() {
  const { modalContentType, openModal, isOpen } = useModal();

  return (
    <>
      <PageHead title={t`Settings | API`} />

      <div className="mb-8 border-t border-light-300 dark:border-dark-300">
        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`API keys`}
        </h2>
        <p className="mb-8 text-sm text-neutral-500 dark:text-dark-900">
          {t`View and manage your API keys.`}
        </p>

        <div className="mb-4 flex items-center justify-between">
          <Button variant="primary" onClick={() => openModal("NEW_API_KEY")}>
            {t`Create new key`}
          </Button>
        </div>

        <ApiKeyList />
      </div>

      {/* API-specific modals */}
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "NEW_API_KEY"}
      >
        <NewApiKeyModal />
      </Modal>
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "REVOKE_API_KEY"}
      >
        <RevokeApiKeyConfirmation />
      </Modal>

      {/* Global modals */}
      <Modal
        modalSize="md"
        isVisible={isOpen && modalContentType === "NEW_FEEDBACK"}
      >
        <FeedbackModal />
      </Modal>
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
      >
        <NewWorkspaceForm />
      </Modal>
    </>
  );
}



================================================
FILE: apps/web/src/views/settings/BillingSettings.tsx
================================================
import { t } from "@lingui/core/macro";
import { HiMiniArrowTopRightOnSquare } from "react-icons/hi2";

import Button from "~/components/Button";
import FeedbackModal from "~/components/FeedbackModal";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import { useModal } from "~/providers/modal";

export default function BillingSettings() {
  const { modalContentType, isOpen } = useModal();

  const handleOpenBillingPortal = async () => {
    try {
      const response = await fetch("/api/stripe/create_billing_session", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
      });

      const { url } = (await response.json()) as { url: string };

      if (url) {
        window.location.href = url;
      }
    } catch (error) {
      console.error("Error creating billing session:", error);
    }
  };

  return (
    <>
      <PageHead title={t`Settings | Billing`} />

      <div className="mb-8 border-t border-light-300 dark:border-dark-300">
        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`Billing`}
        </h2>
        <p className="mb-8 text-sm text-neutral-500 dark:text-dark-900">
          {t`View and manage your billing and subscription.`}
        </p>
        <Button
          variant="primary"
          iconRight={<HiMiniArrowTopRightOnSquare />}
          onClick={handleOpenBillingPortal}
        >
          {t`Billing portal`}
        </Button>
      </div>

      {/* Global modals */}
      <Modal
        modalSize="md"
        isVisible={isOpen && modalContentType === "NEW_FEEDBACK"}
      >
        <FeedbackModal />
      </Modal>
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
      >
        <NewWorkspaceForm />
      </Modal>
    </>
  );
}



================================================
FILE: apps/web/src/views/settings/IntegrationsSettings.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect } from "react";
import { HiMiniArrowTopRightOnSquare } from "react-icons/hi2";

import Button from "~/components/Button";
import FeedbackModal from "~/components/FeedbackModal";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

export default function IntegrationsSettings() {
  const { modalContentType, isOpen } = useModal();
  const { showPopup } = usePopup();

  const {
    data: integrations,
    refetch: refetchIntegrations,
    isLoading: integrationsLoading,
  } = api.integration.providers.useQuery();

  const { data: trelloUrl, refetch: refetchTrelloUrl } =
    api.integration.getAuthorizationUrl.useQuery(
      { provider: "trello" },
      {
        enabled:
          !integrationsLoading &&
          !integrations?.some(
            (integration) => integration.provider === "trello",
          ),
        refetchOnWindowFocus: true,
      },
    );

  useEffect(() => {
    const handleFocus = () => {
      refetchIntegrations();
    };
    window.addEventListener("focus", handleFocus);
    return () => {
      window.removeEventListener("focus", handleFocus);
    };
  }, [refetchIntegrations]);

  const { mutateAsync: disconnectTrello } =
    api.integration.disconnect.useMutation({
      onSuccess: () => {
        refetchIntegrations();
        refetchTrelloUrl();
        showPopup({
          header: t`Trello disconnected`,
          message: t`Your Trello account has been disconnected.`,
          icon: "success",
        });
      },
      onError: () => {
        showPopup({
          header: t`Error disconnecting Trello`,
          message: t`An error occurred while disconnecting your Trello account.`,
          icon: "error",
        });
      },
    });

  return (
    <>
      <PageHead title={t`Settings | Integrations`} />

      <div className="mb-8 border-t border-light-300 dark:border-dark-300">
        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`Trello`}
        </h2>
        {!integrations?.some(
          (integration) => integration.provider === "trello",
        ) && trelloUrl ? (
          <>
            <p className="mb-8 text-sm text-neutral-500 dark:text-dark-900">
              {t`Connect your Trello account to import boards.`}
            </p>
            <Button
              variant="primary"
              iconRight={<HiMiniArrowTopRightOnSquare />}
              onClick={() =>
                window.open(
                  trelloUrl.url,
                  "trello_auth",
                  "height=800,width=600",
                )
              }
            >
              {t`Connect Trello`}
            </Button>
          </>
        ) : (
          integrations?.some(
            (integration) => integration.provider === "trello",
          ) && (
            <>
              <p className="mb-8 text-sm text-neutral-500 dark:text-dark-900">
                {t`Your Trello account is connected.`}
              </p>
              <Button
                variant="secondary"
                onClick={() => disconnectTrello({ provider: "trello" })}
              >
                {t`Disconnect Trello`}
              </Button>
            </>
          )
        )}
      </div>

      {/* Global modals */}
      <Modal
        modalSize="md"
        isVisible={isOpen && modalContentType === "NEW_FEEDBACK"}
      >
        <FeedbackModal />
      </Modal>
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
      >
        <NewWorkspaceForm />
      </Modal>
    </>
  );
}



================================================
FILE: apps/web/src/views/settings/PermissionsSettings.tsx
================================================
import { t } from "@lingui/core/macro";

import { PageHead } from "~/components/PageHead";
import Button from "~/components/Button";
import Modal from "~/components/modal";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";
import { ClearCustomPermissionsConfirmation } from "./components/ClearCustomPermissionsConfirmation";
import { RolePermissions } from "./components/RolePermissions";

export default function PermissionsSettings() {
  const { workspace } = useWorkspace();
  const { openModal, isOpen, modalContentType } = useModal();
  const { showPopup } = usePopup();
  const utils = api.useUtils();

  const isAdmin = workspace.role === "admin";

  const resetAllOverrides = api.permission.resetWorkspaceMemberPermissions.useMutation(
    {
      onSuccess: async () => {
        showPopup({
          header: t`Overrides cleared`,
          message: t`All member permission overrides have been reset to their role defaults.`,
          icon: "success",
        });

        // Refresh any relevant workspace data
        if (workspace.publicId && workspace.publicId.length >= 12) {
          await utils.workspace.byId.invalidate({
            workspacePublicId: workspace.publicId,
          });
        }
      },
      onError: () => {
        showPopup({
          header: t`Unable to clear overrides`,
          message: t`Please try again later, or contact customer support.`,
          icon: "error",
        });
      },
    },
  );

  return (
    <>
      <PageHead title={t`Settings | Permissions`} />

      <div className="mb-8 border-t border-light-300 dark:border-dark-300">
        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`Workspace permissions`}
        </h2>
        <p className="mb-6 text-sm text-neutral-500 dark:text-dark-900">
          {t`Configure which actions are allowed for each workspace role. These permissions apply to all members with that role.`}
        </p>

        {isAdmin ? (
          <>
            <RolePermissions />
            <div className="mt-8">
              <h2 className="mb-4 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
                {t`Custom permissions`}
              </h2>
              <p className="mb-6 text-sm text-neutral-500 dark:text-dark-900">
                {t`Clear any custom member permissions so that all members only inherit permissions from their role defaults.`}
              </p>
              <Button
                variant="secondary"
                size="sm"
                onClick={() => {
                  if (!workspace.publicId || resetAllOverrides.isPending) {
                    return;
                  }
                  openModal("CLEAR_CUSTOM_PERMISSIONS");
                }}
                disabled={resetAllOverrides.isPending}
              >
                {t`Clear custom permissions`}
              </Button>
            </div>
          </>
        ) : (
          <p className="mt-4 text-sm text-neutral-500 dark:text-dark-900">
            {t`You need to be an admin to manage workspace permissions.`}
          </p>
        )}
      </div>

      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "CLEAR_CUSTOM_PERMISSIONS"}
      >
        <ClearCustomPermissionsConfirmation
          resetAllOverrides={resetAllOverrides}
        />
      </Modal>
    </>
  );
}





================================================
FILE: apps/web/src/views/settings/WorkspaceSettings.tsx
================================================
import { useRouter } from "next/router";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useEffect, useState } from "react";
import { HiBolt } from "react-icons/hi2";

import type { Subscription } from "@kan/shared/utils";
import { hasActiveSubscription } from "@kan/shared/utils";

import Button from "~/components/Button";
import FeedbackModal from "~/components/FeedbackModal";
import Modal from "~/components/modal";
import { NewWorkspaceForm } from "~/components/NewWorkspaceForm";
import { PageHead } from "~/components/PageHead";
import { usePermissions } from "~/hooks/usePermissions";
import { useModal } from "~/providers/modal";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";
import { DeleteWorkspaceConfirmation } from "./components/DeleteWorkspaceConfirmation";
import UpdateWorkspaceDescriptionForm from "./components/UpdateWorkspaceDescriptionForm";
import UpdateWorkspaceEmailVisibilityForm from "./components/UpdateWorkspaceEmailVisibilityForm";
import UpdateWorkspaceNameForm from "./components/UpdateWorkspaceNameForm";
import UpdateWorkspaceUrlForm from "./components/UpdateWorkspaceUrlForm";
import { UpgradeToProConfirmation } from "./components/UpgradeToProConfirmation";

export default function WorkspaceSettings() {
  const { modalContentType, openModal, isOpen } = useModal();
  const { workspace } = useWorkspace();
  const { canEditWorkspace } = usePermissions();
  const router = useRouter();
  const { data } = api.user.getUser.useQuery();
  const [hasOpenedUpgradeModal, setHasOpenedUpgradeModal] = useState(false);

  const { data: workspaceData } = api.workspace.byId.useQuery(
    { workspacePublicId: workspace.publicId },
    { enabled: !!workspace.publicId && workspace.publicId.length >= 12 },
  );

  const subscriptions = workspaceData?.subscriptions as
    | Subscription[]
    | undefined;

  // Open upgrade modal if upgrade=pro is in URL params
  useEffect(() => {
    if (
      router.query.upgrade === "pro" &&
      env("NEXT_PUBLIC_KAN_ENV") === "cloud" &&
      !hasActiveSubscription(subscriptions, "pro") &&
      !hasOpenedUpgradeModal
    ) {
      openModal("UPGRADE_TO_PRO");
      setHasOpenedUpgradeModal(true);
    }
  }, [router.query.upgrade, subscriptions, openModal, hasOpenedUpgradeModal]);

  return (
    <>
      <PageHead title={t`Settings | Workspace`} />

      <div className="mb-8 border-t border-light-300 dark:border-dark-300">
        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`Workspace name`}
        </h2>
        <UpdateWorkspaceNameForm
          workspacePublicId={workspace.publicId}
          workspaceName={workspace.name}
          disabled={!canEditWorkspace}
        />

        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`Workspace URL`}
        </h2>
        <UpdateWorkspaceUrlForm
          workspacePublicId={workspace.publicId}
          workspaceUrl={workspace.slug ?? ""}
          workspacePlan={workspace.plan ?? "free"}
          disabled={!canEditWorkspace}
        />

        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`Workspace description`}
        </h2>
        <UpdateWorkspaceDescriptionForm
          workspacePublicId={workspace.publicId}
          workspaceDescription={workspace.description ?? ""}
          disabled={!canEditWorkspace}
        />

        <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
          {t`Email visibility`}
        </h2>
        <UpdateWorkspaceEmailVisibilityForm
          workspacePublicId={workspace.publicId}
          showEmailsToMembers={Boolean(
            workspaceData?.showEmailsToMembers ?? false,
          )}
          disabled={!canEditWorkspace}
        />

        {env("NEXT_PUBLIC_KAN_ENV") === "cloud" &&
          !hasActiveSubscription(subscriptions, "pro") &&
          !hasActiveSubscription(subscriptions, "team") && (
            <div className="my-8">
              <Button
                onClick={() => openModal("UPGRADE_TO_PRO")}
                iconRight={<HiBolt />}
              >
                {t`Upgrade to Pro`}
              </Button>
            </div>
          )}

        <div className="border-t border-light-300 dark:border-dark-300">
          <h2 className="mb-4 mt-8 text-[14px] font-bold text-neutral-900 dark:text-dark-1000">
            {t`Delete workspace`}
          </h2>
          <p className="mb-8 text-sm text-neutral-500 dark:text-dark-900">
            {t`Once you delete your workspace, there is no going back. This action cannot be undone.`}
          </p>
          <div className="mt-4">
            <Button
              variant="secondary"
              onClick={() => openModal("DELETE_WORKSPACE")}
              disabled={workspace.role !== "admin"}
            >
              {t`Delete workspace`}
            </Button>
          </div>
        </div>
      </div>

      {/* Workspace-specific modals */}
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "DELETE_WORKSPACE"}
      >
        <DeleteWorkspaceConfirmation />
      </Modal>
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "UPGRADE_TO_PRO"}
      >
        <UpgradeToProConfirmation
          userId={data?.id ?? ""}
          workspacePublicId={workspace.publicId}
        />
      </Modal>

      {/* Global modals */}
      <Modal
        modalSize="md"
        isVisible={isOpen && modalContentType === "NEW_FEEDBACK"}
      >
        <FeedbackModal />
      </Modal>
      <Modal
        modalSize="sm"
        isVisible={isOpen && modalContentType === "NEW_WORKSPACE"}
      >
        <NewWorkspaceForm />
      </Modal>
    </>
  );
}



================================================
FILE: apps/web/src/views/settings/components/ApiKeyList.tsx
================================================
import { useQuery } from "@tanstack/react-query";
import { HiEllipsisHorizontal } from "react-icons/hi2";
import { twMerge } from "tailwind-merge";

import { authClient } from "@kan/auth/client";

import Dropdown from "~/components/Dropdown";
import { useModal } from "~/providers/modal";

export default function ApiKeyList() {
  const { openModal } = useModal();

  const { data, isLoading } = useQuery({
    queryKey: ["apiKeys"],
    queryFn: () => authClient.apiKey.list(),
  });

  const TableRow = ({
    keyId,
    keyName,
    keyStart,
    createdAt,
    lastRequest,
    isLastRow,
    showSkeleton,
  }: {
    keyId?: string;
    keyName?: string | null | undefined;
    keyStart?: string | null | undefined;
    createdAt?: Date | null;
    lastRequest?: Date | null;
    isLastRow?: boolean | undefined;
    showSkeleton?: boolean | undefined;
  }) => {
    const formatDate = (date?: Date | string | null) => {
      if (!date) return "Never";
      const dateObj = date instanceof Date ? date : new Date(date);
      return dateObj.toLocaleDateString("en-US", {
        year: "numeric",
        month: "short",
        day: "numeric",
      });
    };

    return (
      <tr className="rounded-b-lg">
        <td className={twMerge("w-[30%]", isLastRow ? "rounded-bl-lg" : "")}>
          <div className="flex items-center p-4">
            <div className="ml-2 min-w-0 flex-1">
              <div>
                <div className="flex items-center">
                  <p
                    className={twMerge(
                      "mr-2 text-sm font-medium text-light-900 dark:text-dark-900",
                      showSkeleton &&
                        "md mb-2 h-3 w-[125px] animate-pulse rounded-sm bg-light-200 dark:bg-dark-200",
                    )}
                  >
                    {keyName}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </td>
        <td className="w-[20%] px-3 py-4">
          <p
            className={twMerge(
              "text-sm text-light-900 dark:text-dark-900",
              showSkeleton &&
                "h-3 w-[80px] animate-pulse rounded-sm bg-light-200 dark:bg-dark-200",
            )}
          >
            {formatDate(createdAt)}
          </p>
        </td>
        <td className="w-[20%] px-3 py-4">
          <p
            className={twMerge(
              "text-sm text-light-900 dark:text-dark-900",
              showSkeleton &&
                "h-3 w-[80px] animate-pulse rounded-sm bg-light-200 dark:bg-dark-200",
            )}
          >
            {formatDate(lastRequest)}
          </p>
        </td>
        <td className="w-[25%] px-3 py-4">
          <div>
            <span
              className={twMerge(
                "inline-flex items-center rounded-md bg-emerald-500/10 px-1.5 py-0.5 text-[11px] font-medium text-emerald-400 ring-1 ring-inset ring-emerald-500/20",
                showSkeleton &&
                  "h-5 w-[50px] animate-pulse bg-light-200 ring-0 dark:bg-dark-200",
              )}
            >
              {keyStart}...
            </span>
          </div>
        </td>
        <td
          className={twMerge(
            "w-[5%] min-w-[50px]",
            isLastRow && "rounded-br-lg",
          )}
        >
          <div className="flex w-full items-center justify-center px-3">
            <div className="relative z-50">
              <Dropdown
                items={[
                  {
                    label: "Revoke",
                    action: () =>
                      openModal("REVOKE_API_KEY", keyId, keyName ?? ""),
                  },
                ]}
              >
                <HiEllipsisHorizontal
                  size={25}
                  className="text-light-900 dark:text-dark-900"
                />
              </Dropdown>
            </div>
          </div>
        </td>
      </tr>
    );
  };

  if (!isLoading && (!data?.data || data.data.length === 0)) {
    return null;
  }

  return (
    <div className="mt-8 flow-root">
      <div className="overflow-x-auto overflow-y-visible">
        <div className="inline-block min-w-full py-2 pb-12 align-middle">
          <div className="relative h-full shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
            <table className="min-w-[600px] divide-y divide-light-600 dark:divide-dark-600">
              <thead className="rounded-t-lg bg-light-300 dark:bg-dark-200">
                <tr>
                  <th
                    scope="col"
                    className="w-[30%] rounded-tl-lg py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-light-900 dark:text-dark-900 sm:pl-6"
                  >
                    Name
                  </th>
                  <th
                    scope="col"
                    className="w-[20%] px-3 py-3.5 text-left text-sm font-semibold text-light-900 dark:text-dark-900"
                  >
                    Created
                  </th>
                  <th
                    scope="col"
                    className="w-[20%] px-3 py-3.5 text-left text-sm font-semibold text-light-900 dark:text-dark-900"
                  >
                    Last Used
                  </th>
                  <th
                    scope="col"
                    className="w-[25%] px-3 py-3.5 text-left text-sm font-semibold text-light-900 dark:text-dark-900"
                  >
                    Key
                  </th>
                  <th
                    scope="col"
                    className="w-[5%] rounded-tr-lg px-3 py-3.5 text-center text-sm font-semibold text-light-900 dark:text-dark-900"
                  >
                    {/* Actions column */}
                  </th>
                </tr>
              </thead>
              <tbody className="divide-y divide-light-600 bg-light-50 dark:divide-dark-600 dark:bg-dark-100">
                {!isLoading &&
                  data?.data?.map((apiKey, index) => (
                    <TableRow
                      key={apiKey.id}
                      keyId={apiKey.id}
                      keyName={apiKey.name}
                      keyStart={apiKey.start}
                      createdAt={apiKey.createdAt}
                      lastRequest={apiKey.lastRequest}
                      isLastRow={index === data.data.length - 1}
                    />
                  ))}

                {isLoading && (
                  <>
                    <TableRow showSkeleton />
                    <TableRow showSkeleton />
                    <TableRow showSkeleton isLastRow />
                  </>
                )}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/settings/components/Avatar.tsx
================================================
import Image from "next/image";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useCallback, useRef, useState } from "react";
import ReactCrop from "react-image-crop";

import "react-image-crop/dist/ReactCrop.css";

import { generateUID } from "@kan/shared/utils";

import Button from "~/components/Button";
import Modal from "~/components/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";
import { getAvatarUrl } from "~/utils/helpers";

interface PercentCrop {
  unit: "%";
  x: number;
  y: number;
  width: number;
  height: number;
}

interface LocalPixelCrop {
  x: number;
  y: number;
  width: number;
  height: number;
}

interface ReactCropProps {
  crop: PercentCrop | undefined;
  onChange: (crop: LocalPixelCrop, percentCrop: PercentCrop) => void;
  aspect?: number;
  className?: string;
  circularCrop?: boolean;
  children: React.ReactNode;
}

const AnyReactCrop = ReactCrop as unknown as React.FC<ReactCropProps>;

export default function Avatar({
  userId,
  userImage,
}: {
  userId: string | undefined;
  userImage: string | null | undefined;
}) {
  const utils = api.useUtils();
  const { showPopup } = usePopup();
  const [uploading, setUploading] = useState(false);
  const [cropDialogOpen, setCropDialogOpen] = useState(false);
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [selectedPreviewUrl, setSelectedPreviewUrl] = useState<string | null>(
    null,
  );
  const [crop, setCrop] = useState<PercentCrop>();
  const imgRef = useRef<HTMLImageElement | null>(null);


  const avatarUrl = userImage ? getAvatarUrl(userImage) : undefined;

  const onFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    event.preventDefault();
    const file = event.target.files?.[0] ?? null;
    if (!file || !userId) {
      return showPopup({
        header: t`Error uploading profile image`,
        message: t`Please select a file to upload.`,
        icon: "error",
      });
    }
    // Open crop dialog with preview
    setSelectedFile(file);
    const objUrl = URL.createObjectURL(file);
    setSelectedPreviewUrl(objUrl);
    setCropDialogOpen(true);
  };

  const onImageLoad = useCallback(
    (e: React.SyntheticEvent<HTMLImageElement>) => {
      const { naturalWidth, naturalHeight } = e.currentTarget;
      // Create a centered square crop at ~90% of the smaller dimension
      // Compute width% so that the square fits within the image
      let widthPercent: number;
      let heightPercent: number;
      if (naturalWidth >= naturalHeight) {
        // landscape: height is limiting
        heightPercent = 90;
        widthPercent = (naturalHeight / naturalWidth) * heightPercent;
      } else {
        // portrait: width is limiting
        widthPercent = 90;
        heightPercent = (naturalWidth / naturalHeight) * widthPercent;
      }
      const x = (100 - widthPercent) / 2;
      const y = (100 - heightPercent) / 2;
      setCrop({ unit: "%", x, y, width: widthPercent, height: heightPercent });
    },
    [],
  );

  const getCroppedBlob = useCallback(async (): Promise<Blob> => {
    if (!imgRef.current || !crop) throw new Error("No crop to save");
    const image = imgRef.current;

    const canvas = document.createElement("canvas");
    const cropXpx = (crop.x / 100) * image.naturalWidth;
    const cropYpx = (crop.y / 100) * image.naturalHeight;
    const cropWpx = (crop.width / 100) * image.naturalWidth;
    const cropHpx = (crop.height / 100) * image.naturalHeight;
    canvas.width = Math.max(1, Math.floor(cropWpx));
    canvas.height = Math.max(1, Math.floor(cropHpx));
    const ctx = canvas.getContext("2d");
    if (!ctx) throw new Error("Canvas not supported");

    // For better quality on HiDPI screens
    const pixelRatio = window.devicePixelRatio || 1;
    canvas.width = canvas.width * pixelRatio;
    canvas.height = canvas.height * pixelRatio;
    ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);
    ctx.imageSmoothingQuality = "high";

    ctx.drawImage(
      image,
      cropXpx,
      cropYpx,
      cropWpx,
      cropHpx,
      0,
      0,
      canvas.width / pixelRatio,
      canvas.height / pixelRatio,
    );

    const mime = selectedFile?.type ?? "image/jpeg";
    const blob: Blob = await new Promise((resolve, reject) => {
      canvas.toBlob(
        (b) => (b ? resolve(b) : reject(new Error("toBlob failed"))),
        mime,
      );
    });
    return blob;
  }, [crop, selectedFile]);

  const resetCropState = useCallback(() => {
    setCrop(undefined);
    setSelectedFile(null);
    if (selectedPreviewUrl) URL.revokeObjectURL(selectedPreviewUrl);
    setSelectedPreviewUrl(null);
  }, [selectedPreviewUrl]);

  const handleCancelCrop = useCallback(() => {
    setCropDialogOpen(false);
    resetCropState();
  }, [resetCropState]);

  const handleSaveCrop = useCallback(async () => {
    try {
      if (!userId || !selectedFile) return;
      setUploading(true);
      const blob = await getCroppedBlob();

      const originalExt = selectedFile.name.split(".").pop() ?? "jpg";
      const fileName = `${userId}/avatar-${generateUID()}.${originalExt}`;

      const baseUrl = env("NEXT_PUBLIC_BASE_URL") ?? "";
      const response = await fetch(
        `${baseUrl}/api/upload/avatar`,
        {
          method: "POST",
          headers: {
            "Content-Type": blob.type,
            "x-original-filename": fileName,
          },
          body: blob,
        },
      );

      if (!response.ok) {
        throw new Error("Failed to upload profile image");
      }

      // User image is updated in the backend, refresh user data
      await utils.user.getUser.refetch();
      
      showPopup({
        header: t`Profile image updated`,
        message: t`Your profile image has been updated.`,
        icon: "success",
      });
      
      setCropDialogOpen(false);
      resetCropState();
    } catch (error) {
      console.error(error);
      showPopup({
        header: t`Error uploading profile image`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    } finally {
      setUploading(false);
    }
  }, [
    getCroppedBlob,
    resetCropState,
    selectedFile,
    showPopup,
    utils.user.getUser,
    userId,
  ]);

  return (
    <div>
      <div className="relative">
        <input
          className="absolute z-10 h-16 w-16 cursor-pointer rounded-full opacity-0"
          type="file"
          id="single"
          accept="image/*"
          onChange={onFileChange}
          disabled={uploading}
        />
        {avatarUrl ? (
          <Image
            src={avatarUrl}
            alt="Avatar"
            width={64}
            height={64}
            className="rounded-full"
          />
        ) : (
          <span className="inline-block h-16 w-16 overflow-hidden rounded-full bg-light-400 dark:bg-dark-400">
            <svg
              className="h-full w-full text-dark-700"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
          </span>
        )}
      </div>

      {/* Crop Dialog */}
      {cropDialogOpen && (
        <Modal modalSize="md" positionFromTop="sm" isVisible>
          <div className="p-4 sm:p-6">
            <div className="mb-4">
              <h3 className="text-base font-semibold text-light-1000 dark:text-dark-1000">
                {t`Crop your avatar`}
              </h3>
              <p className="mt-1 text-sm text-light-800 dark:text-dark-800">
                {t`Adjust the square crop to fit your avatar.`}
              </p>
            </div>
            <div className="max-h-[80vh]">
              <div className="rounded-md border border-light-600 p-2 dark:border-dark-600">
                <AnyReactCrop
                  crop={crop}
                  onChange={(_crop: LocalPixelCrop, percentCrop: PercentCrop) =>
                    setCrop(percentCrop)
                  }
                  aspect={1}
                  circularCrop
                  className="w-full"
                >
                  {/* eslint-disable-next-line @next/next/no-img-element */}
                  <img
                    ref={imgRef}
                    src={selectedPreviewUrl ?? undefined}
                    alt="Avatar to crop"
                    onLoad={onImageLoad}
                    className="h-auto max-h-[50vh] w-full object-contain"
                  />
                </AnyReactCrop>
              </div>
            </div>
            <div className="mt-6 flex items-center justify-end gap-2">
              <Button
                variant="ghost"
                onClick={handleCancelCrop}
                disabled={uploading}
              >
                {t`Cancel`}
              </Button>
              <Button onClick={handleSaveCrop} isLoading={uploading}>
                {t`Save`}
              </Button>
            </div>
          </div>
        </Modal>
      )}
    </div>
  );
}



================================================
FILE: apps/web/src/views/settings/components/ChangePasswordConfirmation.tsx
================================================
import { useRouter } from "next/navigation";
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { useMutation } from "@tanstack/react-query";
import { env } from "next-runtime-env";
import { useForm } from "react-hook-form";
import { z } from "zod";

import { authClient } from "@kan/auth/client";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

const FormSchema = z
  .object({
    currentPassword: z.string().min(1, t`Current password is required`),
    newPassword: z
      .string()
      .min(8, t`Password must be at least 8 characters`)
      .min(1, t`New password is required`),
    confirmPassword: z.string().min(1, t`Please confirm your new password`),
  })
  .refine((data) => data.newPassword === data.confirmPassword, {
    message: t`Passwords do not match`,
    path: ["confirmPassword"],
  })
  .refine((data) => data.currentPassword !== data.newPassword, {
    message: t`New password must be different from current password`,
    path: ["newPassword"],
  });

type FormValues = z.infer<typeof FormSchema>;

export function ChangePasswordFormConfirmation() {
  const { closeModal } = useModal();
  const { showPopup } = usePopup();
  const router = useRouter();
  const utils = api.useUtils();

  const {
    register,
    handleSubmit,
    formState: { errors, isValid },
    reset,
    setError,
  } = useForm<FormValues>({
    resolver: zodResolver(FormSchema),
    mode: "onChange",
  });

  const changePasswordMutation = useMutation({
    mutationFn: async (data: FormValues) => {
      const response = await authClient.changePassword({
        newPassword: data.newPassword,
        currentPassword: data.currentPassword,
        revokeOtherSessions: true,
      });

      if (response?.error) {
        throw new Error(response?.error.message || "Invalid Password");
      }
    },
    onSuccess: async () => {
      closeModal();
      showPopup({
        header: t`Password Changed`,
        message: t`Your password has been changed.`,
        icon: "success",
      });

      utils.invalidate();
      reset();
      router.push("/");
    },
    onError: async (error: any) => {
      const errorMessage = error.message.toLowerCase();

      if (errorMessage.includes("invalid password")) {
        setError("currentPassword", {
          type: "manual",
          message: t`The current password you entered is incorrect.`,
        });
      } else {
        closeModal();
        showPopup({
          header: t`Error Changing Password`,
          message: t`An unexpected error occurred. Please try again later.`,
          icon: "error",
        });
      }
    },
  });

  const onSubmit = (data: FormValues) => {
    changePasswordMutation.mutate(data);
  };

  const handleCancel = () => {
    reset();
    closeModal();
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium dark:text-white">{t`Change Password`}</h2>
        <p className="mb-4 text-sm text-light-900">
          {t`Enter your current password and choose a new secure password.`}
        </p>
      </div>

      <form onSubmit={handleSubmit(onSubmit)}>
        <div className="space-y-2">
          <div>
            <Input
              id="currentPassword"
              type="password"
              {...register("currentPassword")}
              placeholder={t`Enter your current password`}
            />
            {errors.currentPassword && (
              <p className="mt-2 text-xs text-red-400">
                {errors.currentPassword.message}
              </p>
            )}
          </div>

          <div>
            <Input
              id="newPassword"
              type="password"
              {...register("newPassword")}
              placeholder={t`Enter your new password`}
            />
            {errors.newPassword && (
              <p className="mt-2 text-xs text-red-400">
                {errors.newPassword.message}
              </p>
            )}
          </div>

          <div>
            <Input
              id="confirmPassword"
              type="password"
              {...register("confirmPassword")}
              placeholder={t`Confirm your new password`}
            />
            {errors.confirmPassword && (
              <p className="mt-2 text-xs text-red-400">
                {errors.confirmPassword.message}
              </p>
            )}
          </div>
        </div>

        <div className="mt-[1.5rem] flex items-center gap-4">
          <Button
            variant="secondary"
            onClick={handleCancel}
            type="button"
            fullWidth
            size="lg"
          >
            {t`Cancel`}
          </Button>
          <Button
            variant="primary"
            type="submit"
            disabled={!isValid || changePasswordMutation.isPending}
            isLoading={changePasswordMutation.isPending}
            fullWidth
            size="lg"
          >
            {t`Change Password`}
          </Button>
        </div>
      </form>
    </div>
  );
}



================================================
FILE: apps/web/src/views/settings/components/ClearCustomPermissionsConfirmation.tsx
================================================
import { t } from "@lingui/core/macro";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { useWorkspace } from "~/providers/workspace";
import type { api } from "~/utils/api";

type ResetMutation = ReturnType<
  typeof api.permission.resetWorkspaceMemberPermissions.useMutation
>;

export function ClearCustomPermissionsConfirmation({
  resetAllOverrides,
}: {
  resetAllOverrides: ResetMutation;
}) {
  const { closeModal } = useModal();
  const { workspace } = useWorkspace();

  const handleConfirm = () => {
    if (!workspace.publicId || resetAllOverrides.isPending) return;
    resetAllOverrides.mutate({
      workspacePublicId: workspace.publicId,
    });
    closeModal();
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          {t`Clear all custom permissions?`}
        </h2>
        <p className="mb-4 text-sm text-light-900 dark:text-dark-900">
          {t`This will remove all custom member permissions in this workspace. Members will inherit permissions only from their roles.`}
        </p>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button size="sm" variant="secondary" onClick={() => closeModal()}>
          {t`Cancel`}
        </Button>
        <Button
          size="sm"
          variant="primary"
          onClick={handleConfirm}
          isLoading={resetAllOverrides.isPending}
        >
          {t`Clear custom permissions`}
        </Button>
      </div>
    </div>
  );
}





================================================
FILE: apps/web/src/views/settings/components/DeleteAccountConfirmation.tsx
================================================
import { useRouter } from "next/navigation";
import { t } from "@lingui/core/macro";
import { useMutation } from "@tanstack/react-query";
import { useState } from "react";

import { authClient } from "@kan/auth/client";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

export function DeleteAccountConfirmation() {
  const { closeModal } = useModal();
  const { showPopup } = usePopup();
  const router = useRouter();

  const utils = api.useUtils();

  const [isAcknowledgmentChecked, setIsAcknowledgmentChecked] = useState(false);

  const deleteAccountMutation = useMutation({
    mutationFn: () => authClient.deleteUser(),
    onSuccess: async () => {
      closeModal();
      showPopup({
        header: t`Account deleted`,
        message: t`Your account has been deleted.`,
        icon: "success",
      });

      utils.invalidate();

      router.push("/");
    },
    onError: () => {
      closeModal();
      showPopup({
        header: t`Error deleting account`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const handleDeleteAccount = () => {
    deleteAccountMutation.mutate();
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          {t`Are you sure you want to delete your account?`}
        </h2>
        <p className="mb-4 text-sm text-light-900 dark:text-dark-900">
          {t`Keep in mind that this action is irreversible.`}
        </p>
        <p className="text-sm text-light-900 dark:text-dark-900">
          {t`This will result in the permanent deletion of all data associated with your account.`}
        </p>
      </div>
      <div className="relative flex items-start">
        <div className="flex h-6 items-center">
          <input
            id="acknowledgment"
            name="acknowledgment"
            type="checkbox"
            aria-describedby="acknowledgment-description"
            className="mt-2 h-[14px] w-[14px] rounded border-gray-300 bg-transparent text-indigo-600 focus:shadow-none focus:ring-0 focus:ring-offset-0"
            checked={isAcknowledgmentChecked}
            onChange={() =>
              setIsAcknowledgmentChecked(!isAcknowledgmentChecked)
            }
          />
        </div>
        <div className="ml-3 text-sm leading-6">
          <p
            id="comments-description"
            className="text-light-900 dark:text-dark-1000"
          >
            {t`I acknowledge that all of my account data will be permanently deleted and want to proceed.`}
          </p>
        </div>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button variant="secondary" onClick={() => closeModal()}>
          {t`Cancel`}
        </Button>
        <Button
          variant="danger"
          onClick={handleDeleteAccount}
          disabled={!isAcknowledgmentChecked}
          isLoading={deleteAccountMutation.isPending}
        >
          {t`Delete account`}
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/settings/components/DeleteWorkspaceConfirmation.tsx
================================================
import { useRouter } from "next/navigation";
import { t } from "@lingui/core/macro";
import { Trans } from "@lingui/react/macro";
import { useState } from "react";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

export function DeleteWorkspaceConfirmation() {
  const { closeModal } = useModal();
  const { workspace, switchWorkspace, availableWorkspaces } = useWorkspace();
  const { showPopup } = usePopup();
  const router = useRouter();

  const [isAcknowledgmentChecked, setIsAcknowledgmentChecked] = useState(false);

  const utils = api.useUtils();

  const deleteWorkspaceMutation = api.workspace.delete.useMutation({
    onSuccess: async () => {
      closeModal();
      showPopup({
        header: t`Workspace deleted`,
        message: t`Your workspace has been deleted.`,
        icon: "success",
      });

      await utils.workspace.all.refetch();

      const filteredWorkspaces = availableWorkspaces.filter(
        (ws) => ws.publicId !== workspace.publicId,
      );
      if (filteredWorkspaces.length > 0 && filteredWorkspaces[0]) {
        switchWorkspace(filteredWorkspaces[0]);
      } else {
        router.push("/");
      }
    },
    onError: () => {
      closeModal();
      showPopup({
        header: t`Error deleting workspace`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const handleDeleteWorkspace = () => {
    deleteWorkspaceMutation.mutate({
      workspacePublicId: workspace.publicId,
    });
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          <Trans>
            Are you sure you want to delete the workspace {workspace.name}?
          </Trans>
        </h2>
        <p className="mb-4 text-sm text-light-900 dark:text-dark-900">
          {t`Keep in mind that this action is irreversible.`}
        </p>
        <p className="text-sm text-light-900 dark:text-dark-900">
          {t`This will result in the permanent deletion of all data associated with this workspace.`}
        </p>
      </div>
      <div className="relative flex items-start">
        <div className="flex h-6 items-center">
          <input
            id="acknowledgment"
            name="acknowledgment"
            type="checkbox"
            aria-describedby="acknowledgment-description"
            className="mt-2 h-[14px] w-[14px] rounded border-gray-300 bg-transparent text-indigo-600 focus:shadow-none focus:ring-0 focus:ring-offset-0"
            checked={isAcknowledgmentChecked}
            onChange={() =>
              setIsAcknowledgmentChecked(!isAcknowledgmentChecked)
            }
          />
        </div>
        <div className="ml-3 text-sm leading-6">
          <p
            id="comments-description"
            className="text-light-900 dark:text-dark-1000"
          >
            {t`I acknowledge that all of the workspace data will be permanently deleted and want to proceed.`}
          </p>
        </div>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button variant="secondary" onClick={() => closeModal()}>
          {t`Cancel`}
        </Button>
        <Button
          variant="danger"
          onClick={handleDeleteWorkspace}
          disabled={!isAcknowledgmentChecked}
          isLoading={deleteWorkspaceMutation.isPending}
        >
          {t`Delete workspace`}
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/settings/components/NewApiKeyForm.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { useForm } from "react-hook-form";
import { z } from "zod";

import { authClient } from "@kan/auth/client";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useModal } from "~/providers/modal";

const newApiKeySchema = z.object({
  name: z.string().min(1),
});

export default function NewApiKeyForm() {
  const { openModal } = useModal();
  const form = useForm({
    resolver: zodResolver(newApiKeySchema),
    defaultValues: {
      name: "",
    },
  });

  const qc = useQueryClient();

  const createApiKeyMutation = useMutation({
    mutationFn: ({ name }: { name: string }) =>
      authClient.apiKey.create({ name, prefix: "kan_" }),
    onSuccess: ({ data: apiKey }) => {
      qc.invalidateQueries({
        queryKey: ["apiKeys"],
      });
      openModal("API_KEY_CREATED", apiKey?.key, apiKey?.name ?? "");
    },
    onError: () => {
      form.setError("name", {
        type: "manual",
        message: "Failed to create API key",
      });
    },
  });

  const handleSubmit = (data: z.infer<typeof newApiKeySchema>) => {
    createApiKeyMutation.mutate({ name: data.name });
  };

  return (
    <div className="px-2 py-2">
      <form
        onSubmit={form.handleSubmit(handleSubmit)}
        className="flex flex-col gap-2"
      >
        <h2 className="text-sm font-bold text-neutral-900 dark:text-dark-1000">
          New API key
        </h2>
        <Input
          {...form.register("name")}
          placeholder="Name"
          className="w-full"
          errorMessage={form.formState.errors.name?.message}
        />
        <Button type="submit" isLoading={createApiKeyMutation.isPending}>
          Create
        </Button>
      </form>
    </div>
  );
}



================================================
FILE: apps/web/src/views/settings/components/NewApiKeyModal.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { useEffect, useState } from "react";
import { useForm } from "react-hook-form";
import {
  HiInformationCircle,
  HiMiniCheck,
  HiOutlineDocumentDuplicate,
  HiXMark,
} from "react-icons/hi2";
import { z } from "zod";

import { authClient } from "@kan/auth/client";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useClipboard } from "~/hooks/useClipboard";
import { useModal } from "~/providers/modal";

const newApiKeySchema = z.object({
  name: z
    .string()
    .min(1, { message: t`API key name is required` })
    .max(30, { message: t`API key name cannot exceed 30 characters` }),
});

export default function NewApiKeyModal() {
  const { closeModal } = useModal();
  const { copied, copy } = useClipboard({ timeout: 2000 });
  const [createdApiKey, setCreatedApiKey] = useState<{
    key: string;
    name: string;
  } | null>(null);

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<z.infer<typeof newApiKeySchema>>({
    resolver: zodResolver(newApiKeySchema),
    defaultValues: {
      name: "",
    },
  });

  const qc = useQueryClient();

  const createApiKeyMutation = useMutation({
    mutationFn: ({ name }: { name: string }) =>
      authClient.apiKey.create({ name, prefix: "kan_" }),
    onSuccess: ({ data: apiKey }) => {
      void qc.invalidateQueries({
        queryKey: ["apiKeys"],
      });
      if (apiKey && apiKey.key && apiKey.name) {
        setCreatedApiKey({
          key: apiKey.key,
          name: apiKey.name,
        });
      }
    },
    onError: () => {
      // Handle error if needed
    },
  });

  const onSubmit = (data: z.infer<typeof newApiKeySchema>) => {
    createApiKeyMutation.mutate({ name: data.name });
  };

  useEffect(() => {
    // Reset state and form when modal opens
    setCreatedApiKey(null);
    reset();
  }, [reset]);

  useEffect(() => {
    if (!createdApiKey) {
      const nameElement = document.querySelector<HTMLElement>("#name");
      if (nameElement) nameElement.focus();
    }
  }, [createdApiKey]);

  if (createdApiKey) {
    return (
      <div>
        <div className="px-5 pt-5">
          <div className="flex w-full items-center justify-between pb-4 text-neutral-900 dark:text-dark-1000">
            <h2 className="text-sm font-bold">{t`API key created`}</h2>
            <button
              type="button"
              className="rounded p-1 hover:bg-light-300 focus:outline-none dark:hover:bg-dark-300"
              onClick={(e) => {
                e.preventDefault();
                closeModal();
              }}
            >
              <HiXMark
                size={18}
                className="text-light-900 dark:text-dark-900"
              />
            </button>
          </div>

          <div className="mb-4">
            <div className="relative">
              <Input
                value={createdApiKey.key}
                className="pr-10 text-sm text-light-900 dark:text-dark-900"
                readOnly
              />
              <button
                type="button"
                className="absolute inset-y-0 right-0 flex items-center pr-3 text-light-900 hover:text-light-950 dark:text-dark-900 dark:hover:text-dark-950"
                onClick={() => copy(createdApiKey.key)}
              >
                {copied ? (
                  <HiMiniCheck className="h-5 w-5 text-green-600" />
                ) : (
                  <HiOutlineDocumentDuplicate className="h-5 w-5" />
                )}
              </button>
            </div>
            <div className="mt-2 flex items-start gap-1">
              <HiInformationCircle className="mt-0.5 h-4 w-4 text-dark-900" />
              <p className="text-xs text-gray-500 dark:text-dark-900">
                {t`This API key will only be shown once. Please save it in a secure location.`}
              </p>
            </div>
          </div>
        </div>
        <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
          <div>
            <Button onClick={() => closeModal()}>{t`Close`}</Button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div className="px-5 pt-5">
        <div className="flex w-full items-center justify-between pb-4 text-neutral-900 dark:text-dark-1000">
          <h2 className="text-sm font-bold">{t`New API key`}</h2>
          <button
            type="button"
            className="rounded p-1 hover:bg-light-300 focus:outline-none dark:hover:bg-dark-300"
            onClick={(e) => {
              e.preventDefault();
              closeModal();
            }}
          >
            <HiXMark size={18} className="text-light-900 dark:text-dark-900" />
          </button>
        </div>
        <Input
          id="name"
          placeholder={t`API key name`}
          {...register("name", { required: true })}
          errorMessage={errors.name?.message}
          onKeyDown={async (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              await handleSubmit(onSubmit)();
            }
          }}
        />
      </div>
      <div className="mt-12 flex items-center justify-end border-t border-light-600 px-5 pb-5 pt-5 dark:border-dark-600">
        <div>
          <Button type="submit" isLoading={createApiKeyMutation.isPending}>
            {t`Create API key`}
          </Button>
        </div>
      </div>
    </form>
  );
}



================================================
FILE: apps/web/src/views/settings/components/RevokeApiKeyConfirmation.tsx
================================================
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { useState } from "react";

import { authClient } from "@kan/auth/client";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";

export function RevokeApiKeyConfirmation() {
  const { closeModal, entityId, entityLabel } = useModal();
  const { showPopup } = usePopup();
  const qc = useQueryClient();

  const [isAcknowledgmentChecked, setIsAcknowledgmentChecked] = useState(false);

  const deleteApiKeyMutation = useMutation({
    mutationFn: () => authClient.apiKey.delete({ keyId: entityId }),
    onSuccess: async () => {
      closeModal();
      showPopup({
        header: "API key revoked",
        message: `Your API key: ${entityLabel} has been revoked.`,
        icon: "success",
      });
      qc.invalidateQueries({
        queryKey: ["apiKeys"],
      });
    },
    onError: () => {
      closeModal();
      showPopup({
        header: "Error revoking API key",
        message: "Please try again later, or contact customer support.",
        icon: "error",
      });
    },
  });

  const handleRevokeApiKey = () => {
    deleteApiKeyMutation.mutate();
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <h2 className="text-md pb-4 font-medium text-neutral-900 dark:text-dark-1000">
          {`Are you sure you want to revoke this API key: ${entityLabel}?`}
        </h2>
        <p className="mb-4 text-sm text-light-900 dark:text-dark-900">
          Keep in mind that this action is irreversible.
        </p>
        <p className="text-sm text-light-900 dark:text-dark-900">
          This will result in the permanent revocation of this API key.
        </p>
      </div>
      <div className="relative flex items-start">
        <div className="flex h-6 items-center">
          <input
            id="acknowledgment"
            name="acknowledgment"
            type="checkbox"
            aria-describedby="acknowledgment-description"
            className="mt-2 h-[14px] w-[14px] rounded border-gray-300 bg-transparent text-indigo-600 focus:shadow-none focus:ring-0 focus:ring-offset-0"
            checked={isAcknowledgmentChecked}
            onChange={() =>
              setIsAcknowledgmentChecked(!isAcknowledgmentChecked)
            }
          />
        </div>
        <div className="ml-3 text-sm leading-6">
          <p
            id="comments-description"
            className="text-light-900 dark:text-dark-1000"
          >
            I acknowledge that this API key will be permanently revoked and want
            to proceed.
          </p>
        </div>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button variant="secondary" onClick={() => closeModal()}>
          Cancel
        </Button>
        <Button
          variant="danger"
          onClick={handleRevokeApiKey}
          disabled={!isAcknowledgmentChecked}
          isLoading={deleteApiKeyMutation.isPending}
        >
          Revoke API key
        </Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/settings/components/RolePermissions.tsx
================================================
import { t } from "@lingui/core/macro";

import { permissionCategories, roles } from "@kan/shared";
import type { Permission, Role } from "@kan/shared";

import { useWorkspace } from "~/providers/workspace";
import { api } from "~/utils/api";

function formatRoleLabel(role: Role) {
  return role.charAt(0).toUpperCase() + role.slice(1);
}

const permissionLabels: Record<Permission, string> = {
  "workspace:view": t`Can view workspace`,
  "workspace:edit": t`Can edit workspace`,
  "workspace:delete": t`Can delete workspace`,
  "workspace:manage": t`Can manage workspace settings`,

  "board:view": t`Can view boards`,
  "board:create": t`Can create boards`,
  "board:edit": t`Can edit boards`,
  "board:delete": t`Can delete boards`,

  "list:view": t`Can view lists`,
  "list:create": t`Can create lists`,
  "list:edit": t`Can edit lists`,
  "list:delete": t`Can delete lists`,

  "card:view": t`Can view cards`,
  "card:create": t`Can create cards`,
  "card:edit": t`Can edit cards`,
  "card:delete": t`Can delete cards`,

  "comment:view": t`Can view comments`,
  "comment:create": t`Can add comments`,
  "comment:edit": t`Can edit comments`,
  "comment:delete": t`Can delete comments`,

  "member:view": t`Can view members`,
  "member:invite": t`Can invite members`,
  "member:edit": t`Can edit member roles and permissions`,
  "member:remove": t`Can remove members`,
};

export function RolePermissions() {
  const { workspace } = useWorkspace();

  const utils = api.useUtils();

  const { data, isLoading } =
    api.permission.getWorkspaceRolePermissions.useQuery(
      { workspacePublicId: workspace.publicId },
      { enabled: !!workspace.publicId },
    );

  const systemRoles = (data?.roles ?? []).filter((role) =>
    (roles).includes(role.name as Role),
  );

  const orderedRoleNames: Role[] = ["admin", "member", "guest"].filter(
    (role) => systemRoles.some((r) => r.name === role),
  ) as Role[];

  const grantMutation = api.permission.grantRolePermission.useMutation({
    onSettled: async () => {
      if (!workspace.publicId) return;
      await utils.permission.getWorkspaceRolePermissions.invalidate({
        workspacePublicId: workspace.publicId,
      });
    },
  });

  const revokeMutation = api.permission.revokeRolePermission.useMutation({
    onSettled: async () => {
      if (!workspace.publicId) return;
      await utils.permission.getWorkspaceRolePermissions.invalidate({
        workspacePublicId: workspace.publicId,
      });
    },
  });

  const isBusy = grantMutation.isPending || revokeMutation.isPending;

  const handleToggle = (
    rolePublicId: string,
    permission: Permission,
    checked: boolean,
  ) => {
    if (!workspace.publicId || !rolePublicId) return;

    if (checked) {
      grantMutation.mutate({
        workspacePublicId: workspace.publicId,
        rolePublicId,
        permission,
      });
    } else {
      revokeMutation.mutate({
        workspacePublicId: workspace.publicId,
        rolePublicId,
        permission,
      });
    }
  };

  return (
    <div className="mt-2">
      {orderedRoleNames.length === 0 && !isLoading ? (
        <p className="mb-4 text-sm text-neutral-500 dark:text-dark-800">
          {t`No roles found for this workspace yet.`}
        </p>
      ) : null}

      <div className="overflow-x-auto rounded-md border border-light-300 bg-light-50 dark:border-dark-300 dark:bg-dark-100">
        <table className="min-w-full table-fixed divide-y divide-light-600 overflow-visible text-left text-sm dark:divide-dark-600">
          <thead className="rounded-t-lg bg-light-300 dark:bg-dark-300">
            <tr>
              <th className="w-1/2 rounded-tl-lg px-4 py-3 text-left text-xs font-semibold tracking-wide text-light-900 dark:text-dark-900">
                {t`Permission`}
              </th>
              {orderedRoleNames.map((role) => (
                <th
                  key={role}
                  className="w-1/6 px-4 py-3 text-center text-xs font-semibold tracking-wide text-light-900 dark:text-dark-900"
                >
                  {formatRoleLabel(role)}
                </th>
              ))}
            </tr>
          </thead>
          {Object.values(permissionCategories).map((category) => (
            <tbody
              key={category.label}
              className="divide-y divide-light-600 overflow-visible bg-light-50 dark:divide-dark-600 dark:bg-dark-100"
            >
              <tr className="bg-light-100 dark:bg-dark-200">
                <td
                  colSpan={1 + orderedRoleNames.length}
                  className="px-4 py-2 text-xs font-semibold tracking-wide text-light-900 dark:text-dark-900"
                >
                  {category.label}
                </td>
              </tr>
              {category.permissions.map((permission) => (
                <tr key={permission}>
                  <td className="w-1/2 px-4 py-2 text-sm text-light-900 dark:text-dark-900">
                    {permissionLabels[permission] ?? permission}
                  </td>
                  {orderedRoleNames.map((roleName) => {
                    const role = systemRoles.find((r) => r.name === roleName);
                    const checked = role?.permissions.includes(permission);
                    const isAdminRole = roleName === "admin";
                    const isBillingOrDeletePermission =
                      permission === "workspace:manage" ||
                      permission === "workspace:delete";

                    return (
                      <td
                        key={roleName}
                        className="w-1/6 px-4 py-2 text-center align-middle"
                      >
                        <input
                          type="checkbox"
                          className="h-[16px] w-[16px] appearance-none rounded-md border border-light-500 bg-transparent outline-none ring-0 checked:bg-blue-600 focus:shadow-none focus:ring-0 focus:ring-offset-0 focus-visible:outline-none dark:border-dark-500 dark:hover:border-dark-500 disabled:opacity-60"
                          disabled={
                            isAdminRole ||
                            isBillingOrDeletePermission ||
                            !role ||
                            isLoading ||
                            isBusy
                          }
                          checked={!!checked}
                          onChange={(e) =>
                            !isAdminRole &&
                            !isBillingOrDeletePermission &&
                            role &&
                            handleToggle(
                              role.publicId,
                              permission,
                              e.target.checked,
                            )
                          }
                        />
                      </td>
                    );
                  })}
                </tr>
              ))}
            </tbody>
          ))}
        </table>
      </div>
    </div>
  );
}




================================================
FILE: apps/web/src/views/settings/components/UpdateDisplayNameForm.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { useForm } from "react-hook-form";
import { z } from "zod";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

const UpdateDisplayNameForm = ({ displayName }: { displayName: string }) => {
  const utils = api.useUtils();
  const { showPopup } = usePopup();

  const schema = z.object({
    name: z
      .string()
      .min(3, {
        message: t`Display name must be at least 3 characters long`,
      })
      .max(280, {
        message: t`Display name cannot exceed 280 characters`,
      }),
  });

  type FormValues = z.infer<typeof schema>;
  const {
    register,
    handleSubmit,
    formState: { isDirty, errors },
  } = useForm<FormValues>({
    resolver: zodResolver(schema),
    values: {
      name: displayName,
    },
  });

  const updateDisplayName = api.user.update.useMutation({
    onSuccess: async () => {
      showPopup({
        header: t`Display name updated`,
        message: t`Your display name has been updated.`,
        icon: "success",
      });
      try {
        await utils.user.getUser.refetch();
      } catch (e) {
        console.error(e);
        throw e;
      }
    },
    onError: () => {
      showPopup({
        header: t`Error updating display name`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const onSubmit = (data: FormValues) => {
    updateDisplayName.mutate({
      name: data.name,
    });
  };

  return (
    <div className="flex gap-2">
      <div className="mb-4 flex w-full max-w-[325px] items-center gap-2">
        <Input {...register("name")} errorMessage={errors.name?.message} />
      </div>
      {isDirty && (
        <div>
          <Button
            onClick={handleSubmit(onSubmit)}
            variant="primary"
            disabled={updateDisplayName.isPending}
            isLoading={updateDisplayName.isPending}
          >
            {t`Update`}
          </Button>
        </div>
      )}
    </div>
  );
};

export default UpdateDisplayNameForm;



================================================
FILE: apps/web/src/views/settings/components/UpdateWorkspaceDescriptionForm.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { useForm } from "react-hook-form";
import { z } from "zod";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

const UpdateWorkspaceDescriptionForm = ({
  workspacePublicId,
  workspaceDescription,
  disabled = false,
}: {
  workspacePublicId: string;
  workspaceDescription: string;
  disabled?: boolean;
}) => {
  const utils = api.useUtils();
  const { showPopup } = usePopup();

  const schema = z.object({
    description: z
      .string()
      .min(3, {
        message: t`Workspace description must be at least 3 characters long`,
      })
      .max(280, {
        message: t`Workspace description cannot exceed 280 characters`,
      }),
  });

  type FormValues = z.infer<typeof schema>;

  const {
    register,
    handleSubmit,
    formState: { isDirty, errors },
  } = useForm<FormValues>({
    resolver: zodResolver(schema),
    values: {
      description: workspaceDescription,
    },
  });

  const updateWorkspaceDescription = api.workspace.update.useMutation({
    onSuccess: async () => {
      showPopup({
        header: t`Workspace description updated`,
        message: t`Your workspace description has been updated.`,
        icon: "success",
      });
      try {
        await utils.workspace.all.refetch();
      } catch (e) {
        console.error(e);
        throw e;
      }
    },
    onError: () => {
      showPopup({
        header: t`Error updating workspace description`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const onSubmit = (data: FormValues) => {
    updateWorkspaceDescription.mutate({
      workspacePublicId,
      description: data.description,
    });
  };

  return (
    <div className="flex gap-2">
      <div className="mb-4 flex w-full max-w-[325px] items-center gap-2">
        <Input
          {...register("description")}
          errorMessage={errors.description?.message}
          disabled={disabled}
        />
      </div>
      {isDirty && !disabled && (
        <div>
          <Button
            onClick={handleSubmit(onSubmit)}
            variant="primary"
            disabled={updateWorkspaceDescription.isPending}
            isLoading={updateWorkspaceDescription.isPending}
          >
            {t`Update`}
          </Button>
        </div>
      )}
    </div>
  );
};

export default UpdateWorkspaceDescriptionForm;



================================================
FILE: apps/web/src/views/settings/components/UpdateWorkspaceEmailVisibilityForm.tsx
================================================
import { t } from "@lingui/core/macro";
import { useEffect, useState } from "react";

import Toggle from "~/components/Toggle";
import { api } from "~/utils/api";

export default function UpdateWorkspaceEmailVisibilityForm({
  workspacePublicId,
  showEmailsToMembers,
  disabled = false,
}: {
  workspacePublicId: string;
  showEmailsToMembers: boolean;
  disabled?: boolean;
}) {
  const utils = api.useUtils();
  const [isChecked, setIsChecked] = useState(showEmailsToMembers);

  useEffect(() => {
    setIsChecked(showEmailsToMembers);
  }, [showEmailsToMembers]);

  const updateWorkspace = api.workspace.update.useMutation({
    onSuccess: () => {
      if (workspacePublicId && workspacePublicId.length >= 12) {
        void utils.workspace.byId.invalidate({
          workspacePublicId,
        });
      }
    },
  });

  const handleToggle = () => {
    if (disabled) return;
    const newValue = !isChecked;
    setIsChecked(newValue);
    updateWorkspace.mutate({
      workspacePublicId,
      showEmailsToMembers: newValue,
    });
  };

  return (
    <div className="mb-8 flex items-center justify-between">
      <div className="flex-1">
        <p className="text-sm text-neutral-500 dark:text-dark-900">
          {t`Allow workspace members to see each other's email addresses`}
        </p>
      </div>
      <Toggle
        isChecked={isChecked}
        onChange={handleToggle}
        label=""
        disabled={disabled || updateWorkspace.isPending}
      />
    </div>
  );
}



================================================
FILE: apps/web/src/views/settings/components/UpdateWorkspaceNameForm.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { useForm } from "react-hook-form";
import { z } from "zod";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

const schema = z.object({
  name: z
    .string()
    .min(3, { message: t`Workspace name must be at least 3 characters long` })
    .max(64, { message: t`Workspace name cannot exceed 64 characters` }),
});

type FormValues = z.infer<typeof schema>;

const UpdateWorkspaceNameForm = ({
  workspacePublicId,
  workspaceName,
  disabled = false,
}: {
  workspacePublicId: string;
  workspaceName: string;
  disabled?: boolean;
}) => {
  const utils = api.useUtils();
  const { showPopup } = usePopup();
  const {
    register,
    handleSubmit,
    formState: { isDirty, errors },
  } = useForm<FormValues>({
    resolver: zodResolver(schema),
    values: {
      name: workspaceName,
    },
  });

  const updateWorkspaceName = api.workspace.update.useMutation({
    onSuccess: async () => {
      showPopup({
        header: t`Workspace name updated`,
        message: t`Your workspace name has been updated.`,
        icon: "success",
      });
      try {
        await utils.workspace.all.refetch();
      } catch (e) {
        console.error(e);
        throw e;
      }
    },
    onError: () => {
      showPopup({
        header: t`Error updating workspace name`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const onSubmit = (data: FormValues) => {
    updateWorkspaceName.mutate({
      workspacePublicId,
      name: data.name,
    });
  };

  return (
    <div className="flex gap-2">
      <div className="mb-4 flex w-full max-w-[325px] items-center gap-2">
        <Input
          {...register("name")}
          errorMessage={errors.name?.message}
          disabled={disabled}
        />
      </div>
      {isDirty && !disabled && (
        <div>
          <Button
            onClick={handleSubmit(onSubmit)}
            variant="primary"
            disabled={updateWorkspaceName.isPending}
            isLoading={updateWorkspaceName.isPending}
          >
            {t`Update`}
          </Button>
        </div>
      )}
    </div>
  );
};

export default UpdateWorkspaceNameForm;



================================================
FILE: apps/web/src/views/settings/components/UpdateWorkspaceUrlForm.tsx
================================================
import { zodResolver } from "@hookform/resolvers/zod";
import { t } from "@lingui/core/macro";
import { env } from "next-runtime-env";
import { useForm } from "react-hook-form";
import { HiCheck, HiMiniStar } from "react-icons/hi2";
import { z } from "zod";

import Button from "~/components/Button";
import Input from "~/components/Input";
import { useDebounce } from "~/hooks/useDebounce";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";
import { api } from "~/utils/api";

const UpdateWorkspaceUrlForm = ({
  workspacePublicId,
  workspaceUrl,
  workspacePlan,
  disabled = false,
}: {
  workspacePublicId: string;
  workspaceUrl: string;
  workspacePlan: "free" | "pro" | "enterprise";
  disabled?: boolean;
}) => {
  const utils = api.useUtils();
  const { showPopup } = usePopup();
  const { openModal } = useModal();

  const schema = z.object({
    slug: z
      .string()
      .min(3, {
        message: t`URL must be at least 3 characters long`,
      })
      .max(64, { message: t`URL cannot exceed 64 characters` })
      .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/, {
        message: t`URL can only contain letters, numbers, and hyphens`,
      }),
  });

  type FormValues = z.infer<typeof schema>;

  const {
    register,
    handleSubmit,
    formState: { isDirty, errors },
    watch,
  } = useForm<FormValues>({
    resolver: zodResolver(schema),
    values: {
      slug: workspaceUrl,
    },
    mode: "onChange",
  });

  const slug = watch("slug");

  const updateWorkspaceSlug = api.workspace.update.useMutation({
    onSuccess: async () => {
      showPopup({
        header: t`Workspace slug updated`,
        message: t`Your workspace slug has been updated.`,
        icon: "success",
      });
      try {
        await utils.workspace.all.refetch();
      } catch (e) {
        console.error(e);
        throw e;
      }
    },
    onError: () => {
      showPopup({
        header: t`Error updating workspace URL`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    },
  });

  const [debouncedSlug] = useDebounce(slug, 500);

  const isTyping = slug !== debouncedSlug;

  const checkWorkspaceSlugAvailability =
    api.workspace.checkSlugAvailability.useQuery(
      {
        workspaceSlug: debouncedSlug,
      },
      {
        enabled:
          !!debouncedSlug && debouncedSlug !== workspaceUrl && !errors.slug,
      },
    );

  const isWorkspaceSlugAvailable = checkWorkspaceSlugAvailability.data;

  const onSubmit = (data: FormValues) => {
    if (!isWorkspaceSlugAvailable?.isAvailable) return;

    if (workspacePlan !== "pro" && env("NEXT_PUBLIC_KAN_ENV") === "cloud")
      return openModal("UPGRADE_TO_PRO", data.slug);

    updateWorkspaceSlug.mutate({
      workspacePublicId,
      slug: data.slug,
    });
  };

  return (
    <div className="flex gap-2">
      <div className="mb-4 flex w-full max-w-[325px] items-center gap-2">
        <Input
          {...register("slug")}
          className={`${
            isWorkspaceSlugAvailable?.isAvailable ||
            (workspacePlan === "pro" && slug === workspaceUrl)
              ? "focus:ring-yellow-500 dark:focus:ring-yellow-500"
              : ""
          }`}
          errorMessage={
            errors.slug?.message ||
            (isWorkspaceSlugAvailable?.isAvailable === false
              ? t`This workspace username has already been taken`
              : undefined)
          }
          prefix={
            env("NEXT_PUBLIC_KAN_ENV") === "cloud"
              ? "kan.bn/"
              : `${env("NEXT_PUBLIC_BASE_URL")}/`
          }
          iconRight={
            isWorkspaceSlugAvailable?.isAvailable ||
            (workspacePlan === "pro" && slug === workspaceUrl) ? (
              <HiMiniStar className="h-4 w-4 text-yellow-500" />
            ) : isWorkspaceSlugAvailable?.isAvailable ? (
              <HiCheck className="h-4 w-4 dark:text-dark-1000" />
            ) : null
          }
          disabled={disabled}
        />
      </div>
      {isDirty && !disabled && (
        <div>
          <Button
            onClick={handleSubmit(onSubmit)}
            variant="primary"
            disabled={
              updateWorkspaceSlug.isPending ||
              checkWorkspaceSlugAvailability.isPending ||
              isWorkspaceSlugAvailable?.isAvailable === false ||
              isTyping
            }
            isLoading={updateWorkspaceSlug.isPending}
          >
            {t`Update`}
          </Button>
        </div>
      )}
    </div>
  );
};

export default UpdateWorkspaceUrlForm;



================================================
FILE: apps/web/src/views/settings/components/UpgradeToProConfirmation.tsx
================================================
import { t } from "@lingui/core/macro";
import { HiBolt, HiCheckBadge } from "react-icons/hi2";

import Button from "~/components/Button";
import { useModal } from "~/providers/modal";
import { usePopup } from "~/providers/popup";

export function UpgradeToProConfirmation({
  workspacePublicId,
}: {
  userId: string;
  workspacePublicId: string;
}) {
  const { closeModal, entityId } = useModal();
  const { showPopup } = usePopup();

  const handleUpgrade = async () => {
    try {
      const response = await fetch("/api/stripe/create_checkout_session", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          ...(entityId && { slug: entityId }),
          workspacePublicId: workspacePublicId,
          cancelUrl: "/settings",
          successUrl: "/settings",
        }),
      });

      const { url } = (await response.json()) as { url: string };

      if (url) {
        window.location.href = url;
      }
    } catch (error) {
      console.error("Error creating checkout session:", error);

      showPopup({
        header: t`Error upgrading subscription`,
        message: t`Please try again later, or contact customer support.`,
        icon: "error",
      });
    }
  };

  return (
    <div className="p-5">
      <div className="flex w-full flex-col justify-between pb-4">
        <div className="pb-4">
          <h2 className="text-md font-bold text-neutral-900 dark:text-dark-1000">
            {t`Upgrade to Pro`}
          </h2>
        </div>
        <p className="mb-4 text-sm font-medium text-light-900 dark:text-dark-900">
          {t`Supercharge your workspace for just $29/month. Here's what you'll get:`}
        </p>

        <div className="rounded-md bg-light-100 p-3 text-xs text-light-900 dark:bg-dark-200 dark:text-dark-900">
          <div className="space-y-3">
            <div className="flex items-center space-x-3">
              <HiCheckBadge className="h-5 w-5 flex-shrink-0 text-light-1000 dark:text-dark-950" />
              <div className="flex items-center space-x-2">
                <span className="text-sm text-neutral-900 dark:text-dark-1000">
                  {t`Unlimited members`}
                </span>
                <span className="inline-flex items-center rounded-full bg-emerald-500/10 px-2 py-0.5 text-[10px] font-medium text-emerald-600 ring-1 ring-inset ring-emerald-500/20 dark:text-emerald-400 sm:text-[10px]">
                  {t`Launch offer`}
                </span>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              <HiCheckBadge className="h-5 w-5 flex-shrink-0 text-light-1000 dark:text-dark-950" />
              <span className="text-sm text-neutral-900 dark:text-dark-1000">
                {t`Custom workspace URL`}
              </span>
            </div>
            <div className="flex items-center space-x-3">
              <HiCheckBadge className="h-5 w-5 flex-shrink-0 text-light-1000 dark:text-dark-950" />
              <div className="flex items-center space-x-2">
                <span className="text-xs text-neutral-900 dark:text-dark-1000">
                  {t`Board analytics`}
                </span>
                <span className="inline-flex items-center rounded-full bg-gray-500/10 px-2 py-0.5 text-[10px] font-medium text-gray-600 ring-1 ring-inset ring-gray-500/20 dark:text-gray-400 sm:text-[10px]">
                  {t`Coming soon`}
                </span>
              </div>
            </div>
            <div className="flex items-center space-x-3">
              <HiCheckBadge className="h-5 w-5 flex-shrink-0 text-light-1000 dark:text-dark-950" />
              <span className="text-sm text-neutral-900 dark:text-dark-1000">
                {t`Priority email support`}
              </span>
            </div>
          </div>
        </div>
      </div>
      <div className="mt-5 flex justify-end space-x-2 sm:mt-6">
        <Button
          onClick={() => {
            closeModal();
          }}
          variant="secondary"
        >
          {t`Cancel`}
        </Button>
        <Button
          onClick={handleUpgrade}
          iconRight={<HiBolt />}
        >{t`Start 14 day free trial`}</Button>
      </div>
    </div>
  );
}



================================================
FILE: apps/web/src/views/terms/index.tsx
================================================
import Link from "next/link";

import { PageHead } from "~/components/PageHead";
import Layout from "../home/components/Layout";

export default function TermsView() {
  const SubHeading = ({ children }: { children: React.ReactNode }) => (
    <h3 className="mb-4 text-2xl font-bold text-light-1000 dark:text-dark-950">
      {children}
    </h3>
  );

  const Text = ({ children }: { children: React.ReactNode }) => (
    <p className="line-height text-md mb-4 text-light-1000 dark:text-dark-900">
      {children}
    </p>
  );

  const UnorderedList = ({ children }: { children: React.ReactNode }) => (
    <ul className="list-disc pl-6">{children}</ul>
  );

  const ListItem = ({ children }: { children: React.ReactNode }) => (
    <li className="line-height text-md mb-4 text-light-1000 dark:text-dark-900">
      {children}
    </li>
  );

  const NAME = "Open Engineering";
  const DOMAIN = "https://kan.bn";
  const PRIVACY_URL = `${DOMAIN}/privacy`;
  const CONTACT_EMAIL = "support@kan.bn";

  return (
    <Layout>
      <PageHead title="Terms of Service | kan.bn" />
      <div className="flex flex-col items-center">
        <div className="mb-20 flex h-full w-full max-w-[800px] flex-col lg:pt-[5rem]">
          <div className="flex items-center justify-center py-36 text-4xl font-bold tracking-tight text-light-1000 dark:text-dark-1000">
            <h2>Terms of Service</h2>
          </div>
          <p className="mb-6 text-sm text-light-1000 dark:text-dark-900">
            Last updated: 26rd Feb 2025
          </p>
          <div className="mb-6">
            <SubHeading>Introduction</SubHeading>
            <Text>
              These Terms of Service (â€œTermsâ€, â€œTerms of Serviceâ€) govern your
              use of our web pages located at {DOMAIN} operated by {NAME}.
            </Text>
            <Text>
              Our Privacy Policy also governs your use of our Service and
              explains how we collect, safeguard and disclose information that
              results from your use of our web pages. Please read it here{" "}
              <Link href={PRIVACY_URL}>{PRIVACY_URL}</Link>.
            </Text>
            <Text>
              Your agreement with us includes these Terms and our Privacy Policy
              (â€œAgreementsâ€). You acknowledge that you have read and understood
              Agreements, and agree to be bound of them.
            </Text>
            <Text>
              If you do not agree with (or cannot comply with) Agreements, then
              you may not use the Service, but please let us know by emailing at{" "}
              {CONTACT_EMAIL} so we can try to find a solution. These Terms
              apply to all visitors, users and others who wish to access or use
              Service. Thank you for being responsible.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Communications</SubHeading>
            <Text>
              By creating an Account on our Service, you agree to subscribe to
              newsletters, marketing or promotional materials and other
              information we may send. However, you may opt out of receiving
              any, or all, of these communications from us by following the
              unsubscribe link or by emailing at {CONTACT_EMAIL}.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Purchases</SubHeading>
            <Text>
              If you wish to purchase any product or service made available
              through Service (â€œPurchaseâ€), you may be asked to supply certain
              information relevant to your Purchase including, without
              limitation, your credit card number, the expiration date of your
              credit card, your billing address, and your shipping information.
            </Text>
            <Text>
              You represent and warrant that: (i) you have the legal right to
              use any credit card(s) or other payment method(s) in connection
              with any Purchase; and that (ii) the information you supply to us
              is true, correct and complete.
            </Text>
            <Text>
              You represent and warrant that: (i) you have the legal right to
              use any credit card(s) or other payment method(s) in connection
              with any Purchase; and that (ii) the information you supply to us
              is true, correct and complete.
            </Text>
            <Text>
              We may employ the use of third party services for the purpose of
              facilitating payment and the completion of Purchases. By
              submitting your information, you grant us the right to provide the
              information to these third parties subject to our Privacy Policy.
            </Text>
            <Text>
              We reserve the right to refuse or cancel your order at any time
              for reasons including but not limited to: product or service
              availability, errors in the description or price of the product or
              service, error in your order or other reasons.
            </Text>
            <Text>
              We reserve the right to refuse or cancel your order if fraud or an
              unauthorized or illegal transaction is suspected.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Contests, Sweepstakes and Promotions</SubHeading>
            <Text>
              Any contests, sweepstakes or other promotions (collectively,
              â€œPromotionsâ€) made available through Service may be governed by
              rules that are separate from these Terms of Service. If you
              participate in any Promotions, please review the applicable rules
              as well as our Privacy Policy. If the rules for a Promotion
              conflict with these Terms of Service, Promotion rules will apply.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Subscriptions</SubHeading>
            <Text>
              Some parts of Service are billed on a subscription basis
              (â€œSubscription(s)â€). You will be billed in advance on a recurring
              and periodic basis (â€œBilling Cycleâ€). Billing cycles are set
              either on a monthly or annual basis, depending on the type of
              subscription plan you select when purchasing a Subscription.
            </Text>
            <Text>
              At the end of each Billing Cycle, your Subscription will
              automatically renew under the exact same conditions unless you
              cancel it or {NAME} cancels it. You may cancel your Subscription
              renewal either through your online account management page or by
              contacting {NAME} customer support team.
            </Text>
            <Text>
              A valid payment method, including credit card or PayPal, is
              required to process the payment for your subscription. You shall
              provide {NAME} with accurate and complete billing information
              including full name, address, state, zip code, telephone number,
              and a valid payment method information. By submitting such payment
              information, you automatically authorize {NAME} to charge all
              Subscription fees incurred through your account to any such
              payment instruments.
            </Text>
            <Text>
              Should automatic billing fail to occur for any reason, {NAME} will
              issue an electronic invoice indicating that you must proceed
              manually, within a certain deadline date, with the full payment
              corresponding to the billing period as indicated on the invoice.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Fee Changes</SubHeading>
            <Text>
              {NAME}, in its sole discretion and at any time, may modify
              Subscription fees for the Subscriptions. Any Subscription fee
              change will become effective at the end of the then-current
              Billing Cycle.
            </Text>
            <Text>
              {NAME}, will provide you with a reasonable prior notice of any
              change in Subscription fees to give you an opportunity to
              terminate your Subscription before such change becomes effective.
            </Text>
            <Text>
              Your continued use of Service after Subscription fee change comes
              into effect constitutes your agreement to pay the modified
              Subscription fee amount.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Refunds</SubHeading>
            <Text>
              Except when required by law, paid Subscription fees are
              non-refundable.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Content</SubHeading>
            <Text>
              Our Service allows you to post, link, store, share and otherwise
              make available certain information, text, graphics, videos, or
              other material (â€œContentâ€). You are responsible for Content that
              you post on or through Service, including its legality,
              reliability, and appropriateness.
            </Text>
            <Text>
              By posting Content on or through Service, You represent and
              warrant that: (i) Content is yours (you own it) and/or you have
              the right to use it and the right to grant us the rights and
              license as provided in these Terms, and (ii) that the posting of
              your Content on or through Service does not violate the privacy
              rights, publicity rights, copyrights, contract rights or any other
              rights of any person or entity. We reserve the right to terminate
              the account of anyone found to be infringing on a copyright.
            </Text>
            <Text>
              You retain any and all of your rights to any Content you submit,
              post or display on or through Service and you are responsible for
              protecting those rights. We take no responsibility and assume no
              liability for Content you or any third party posts on or through
              Service. However, by posting Content using Service you grant us
              the right and license to use, modify, publicly perform, publicly
              display, reproduce, and distribute such Content on and through
              Service. You agree that this license includes the right for us to
              make your Content available to other users of Service, who may
              also use your Content subject to these Terms.
            </Text>
            <Text>
              {NAME} has the right but not the obligation to monitor and edit
              all Content provided by users. In addition, Content found on or
              through this Service are the property of {NAME} or used with
              permission. You may not distribute, modify, transmit, reuse,
              download, repost, copy, or use said Content, whether in whole or
              in part, for commercial purposes or for personal gain, without
              express advance written permission from us.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Prohibited Uses</SubHeading>
            <Text>
              You may use Service only for lawful purposes and in accordance
              with Terms. You agree not to use Service:
            </Text>
            <UnorderedList>
              <ListItem>
                In any way that violates any applicable national or
                international law or regulation.
              </ListItem>
              <ListItem>
                For the purpose of exploiting, harming, or attempting to exploit
                or harm minors in any way by exposing them to inappropriate
                content or otherwise.
              </ListItem>
              <ListItem>
                To transmit, or procure the sending of, any advertising or
                promotional material, including any â€œjunk mailâ€, â€œchain letter,â€
                â€œspam,â€ or any other similar solicitation.
              </ListItem>
              <ListItem>
                To impersonate or attempt to impersonate Company, a Company
                employee, another user, or any other person or entity.
              </ListItem>
              <ListItem>
                In any way that infringes upon the rights of others, or in any
                way is illegal, threatening, fraudulent, or harmful, or in
                connection with any unlawful, illegal, fraudulent, or harmful
                purpose or activity.
              </ListItem>
              <ListItem>
                To engage in any other conduct that restricts or inhibits
                anyoneâ€™s use or enjoyment of Service, or which, as determined by
                us, may harm or offend Company or users of Service or expose
                them to liability.
              </ListItem>
            </UnorderedList>
            <Text>Additionally, you agree not to:</Text>
            <UnorderedList>
              <ListItem>
                Use Service in any manner that could disable, overburden,
                damage, or impair Service or interfere with any other partyâ€™s
                use of Service, including their ability to engage in real time
                activities through Service.
              </ListItem>
              <ListItem>
                Use any robot, spider, or other automatic device, process, or
                means to access Service for any purpose, including monitoring or
                copying any of the material on Service.
              </ListItem>
              <ListItem>
                Use any manual process to monitor or copy any of the material on
                Service or for any other unauthorized purpose without our prior
                written consent.
              </ListItem>
              <ListItem>
                Use any device, software, or routine that interferes with the
                proper working of Service.
              </ListItem>
              <ListItem>
                Introduce any viruses, trojan horses, worms, logic bombs, or
                other material which is malicious or technologically harmful.
              </ListItem>
              <ListItem>
                Attempt to gain unauthorized access to, interfere with, damage,
                or disrupt any parts of Service, the server on which Service is
                stored, or any server, computer, or database connected to
                Service.
              </ListItem>
              <ListItem>
                Attack Service via a denial-of-service attack or a distributed
                denial-of-service attack.
              </ListItem>
              <ListItem>
                Take any action that may damage or falsify Company rating.
              </ListItem>
              <ListItem>
                Otherwise attempt to interfere with the proper working of
                Service.
              </ListItem>
            </UnorderedList>
          </div>

          <div className="mb-6">
            <SubHeading>Analytics</SubHeading>
            <Text>
              We may use third-party Service Providers to monitor and analyze
              the use of our Service.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Age Restrictions</SubHeading>
            <Text>
              Service is intended only for access and use by individuals at
              least thirteen (13) years old. By accessing or using any of
              Company, you warrant and represent that you are at least thirteen
              (13) years of age and with the full authority, right, and capacity
              to enter into this agreement and abide by all of the terms and
              conditions of Terms. If you are not at least thirteen (13) years
              old, you are prohibited from both the access and usage of Service.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Accounts</SubHeading>
            <Text>
              When you create an account with us, you guarantee that you are
              above the age of 13, and that the information you provide us is
              accurate, complete, and current at all times. Inaccurate,
              incomplete, or obsolete information may result in the immediate
              termination of your account on Service.
            </Text>
            <Text>
              You are responsible for maintaining the confidentiality of your
              account and password, including but not limited to the restriction
              of access to your computer and/or account. You agree to accept
              responsibility for any and all activities or actions that occur
              under your account and/or password, whether your password is with
              our Service or a third-party service. You must notify us
              immediately upon becoming aware of any breach of security or
              unauthorized use of your account.
            </Text>
            <Text>
              In certain circumstances, you have the following data protection
              rights:
            </Text>
            <UnorderedList>
              <ListItem>
                You may not use as a username the name of another person or
                entity or that is not lawfully available for use, a name or
                trademark that is subject to any rights of another person or
                entity other than you, without appropriate authorization. You
                may not use as a username any name that is offensive, vulgar or
                obscene.
              </ListItem>
              <ListItem>
                We reserve the right to refuse service, terminate accounts,
                remove or edit content, or cancel orders in our sole discretion.
              </ListItem>
            </UnorderedList>
          </div>

          <div className="mb-6">
            <SubHeading>Intellectual Property</SubHeading>
            <Text>
              Service and its original content (excluding Content provided by
              users), features and functionality are and will remain the
              exclusive property of {NAME}. and its licensors. Service is
              protected by copyright, trademark, and other laws of foreign
              countries. Our trademarks and trade dress may not be used in
              connection with any product or service without the prior written
              consent of {NAME}.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Error Reporting & Feedback</SubHeading>
            <Text>
              You may provide us either directly at {CONTACT_EMAIL} or via third
              party sites and tools with information and feedback concerning
              errors, suggestions for improvements, ideas, problems, complaints,
              and other matters related to our Service (â€œFeedbackâ€). You
              acknowledge and agree that: (i) you shall not retain, acquire or
              assert any intellectual property right or other right, title or
              interest in or to the Feedback; (ii) Company may have development
              ideas similar to the Feedback; (iii) Feedback does not contain
              confidential information or proprietary information from you or
              any third party; and (iv) Company is not under any obligation of
              confidentiality with respect to the Feedback. In the event the
              transfer of the ownership to the Feedback is not possible due to
              applicable mandatory laws, you grant Company and its affiliates an
              exclusive, transferable, irrevocable, free-of-charge,
              sub-licensable, unlimited and perpetual right to use (including
              copy, modify, create derivative works, publish, distribute and
              commercialize) Feedback in any manner and for any purpose.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Links To Other Web Sites</SubHeading>
            <Text>
              Our Service may contain links to third party web sites or services
              that are not owned or controlled by {NAME}.
            </Text>
            <Text>
              {NAME} has no control over, and assumes no responsibility for the
              content, privacy policies, or practices of any third party web
              sites or services. We do not warrant the offerings of any of these
              entities/individuals or their websites.
            </Text>
            <Text>
              YOU ACKNOWLEDGE AND AGREE THAT {NAME.toUpperCase()} SHALL NOT BE
              RESPONSIBLE OR LIABLE, DIRECTLY OR INDIRECTLY, FOR ANY DAMAGE OR
              LOSS CAUSED OR ALLEGED TO BE CAUSED BY OR IN CONNECTION WITH USE
              OF OR RELIANCE ON ANY SUCH CONTENT, GOODS OR SERVICES AVAILABLE ON
              OR THROUGH ANY SUCH THIRD PARTY WEB SITES OR SERVICES.
            </Text>
            <Text>
              WE STRONGLY ADVISE YOU TO READ THE TERMS OF SERVICE AND PRIVACY
              POLICIES OF ANY THIRD PARTY WEB SITES OR SERVICES THAT YOU VISIT.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Disclaimer of Warranty</SubHeading>
            <Text>
              THESE SERVICES ARE PROVIDED BY COMPANY ON AN â€œAS ISâ€ AND â€œAS
              AVAILABLEâ€ BASIS. COMPANY MAKES NO REPRESENTATIONS OR WARRANTIES
              OF ANY KIND, EXPRESS OR IMPLIED, AS TO THE OPERATION OF THEIR
              SERVICES, OR THE INFORMATION, CONTENT OR MATERIALS INCLUDED
              THEREIN. YOU EXPRESSLY AGREE THAT YOUR USE OF THESE SERVICES,
              THEIR CONTENT, AND ANY SERVICES OR ITEMS OBTAINED FROM US IS AT
              YOUR SOLE RISK.
            </Text>
            <Text>
              NEITHER COMPANY NOR ANY PERSON ASSOCIATED WITH COMPANY MAKES ANY
              WARRANTY OR REPRESENTATION WITH RESPECT TO THE COMPLETENESS,
              SECURITY, RELIABILITY, QUALITY, ACCURACY, OR AVAILABILITY OF THE
              SERVICES. WITHOUT LIMITING THE FOREGOING, NEITHER COMPANY NOR
              ANYONE ASSOCIATED WITH COMPANY REPRESENTS OR WARRANTS THAT THE
              SERVICES, THEIR CONTENT, OR ANY SERVICES OR ITEMS OBTAINED THROUGH
              THE SERVICES WILL BE ACCURATE, RELIABLE, ERROR-FREE, OR
              UNINTERRUPTED, THAT DEFECTS WILL BE CORRECTED, THAT THE SERVICES
              OR THE SERVER THAT MAKES IT AVAILABLE ARE FREE OF VIRUSES OR OTHER
              HARMFUL COMPONENTS OR THAT THE SERVICES OR ANY SERVICES OR ITEMS
              OBTAINED THROUGH THE SERVICES WILL OTHERWISE MEET YOUR NEEDS OR
              EXPECTATIONS.
            </Text>
            <Text>
              COMPANY HEREBY DISCLAIMS ALL WARRANTIES OF ANY KIND, WHETHER
              EXPRESS OR IMPLIED, STATUTORY, OR OTHERWISE, INCLUDING BUT NOT
              LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, NON-INFRINGEMENT,
              AND FITNESS FOR PARTICULAR PURPOSE.
            </Text>
            <Text>
              THE FOREGOING DOES NOT AFFECT ANY WARRANTIES WHICH CANNOT BE
              EXCLUDED OR LIMITED UNDER APPLICABLE LAW.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Limitation of Liability</SubHeading>
            <Text>
              EXCEPT AS PROHIBITED BY LAW, YOU WILL HOLD US AND OUR OFFICERS,
              DIRECTORS, EMPLOYEES, AND AGENTS HARMLESS FOR ANY INDIRECT,
              PUNITIVE, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGE, HOWEVER IT
              ARISES (INCLUDING ATTORNEYS' FEES AND ALL RELATED COSTS AND
              EXPENSES OF LITIGATION AND ARBITRATION, OR AT TRIAL OR ON APPEAL,
              IF ANY, WHETHER OR NOT LITIGATION OR ARBITRATION IS INSTITUTED),
              WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE, OR OTHER TORTIOUS
              ACTION, OR ARISING OUT OF OR IN CONNECTION WITH THIS AGREEMENT,
              INCLUDING WITHOUT LIMITATION ANY CLAIM FOR PERSONAL INJURY OR
              PROPERTY DAMAGE, ARISING FROM THIS AGREEMENT AND ANY VIOLATION BY
              YOU OF ANY FEDERAL, STATE, OR LOCAL LAWS, STATUTES, RULES, OR
              REGULATIONS, EVEN IF COMPANY HAS BEEN PREVIOUSLY ADVISED OF THE
              POSSIBILITY OF SUCH DAMAGE. EXCEPT AS PROHIBITED BY LAW, IF THERE
              IS LIABILITY FOUND ON THE PART OF COMPANY, IT WILL BE LIMITED TO
              THE AMOUNT PAID FOR THE PRODUCTS AND/OR SERVICES, AND UNDER NO
              CIRCUMSTANCES WILL THERE BE CONSEQUENTIAL OR PUNITIVE DAMAGES.
              SOME STATES DO NOT ALLOW THE EXCLUSION OR LIMITATION OF PUNITIVE,
              INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THE PRIOR LIMITATION OR
              EXCLUSION MAY NOT APPLY TO YOU.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Termination</SubHeading>
            <Text>
              We may terminate or suspend your account and bar access to Service
              immediately, without prior notice or liability, under our sole
              discretion, for any reason whatsoever and without limitation,
              including but not limited to a breach of Terms.
            </Text>
            <Text>
              If you wish to terminate your account, you may simply discontinue
              using Service.
            </Text>
            <Text>
              All provisions of Terms which by their nature should survive
              termination shall survive termination, including, without
              limitation, ownership provisions, warranty disclaimers, indemnity
              and limitations of liability.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Governing Law</SubHeading>
            <Text>
              These Terms shall be governed and construed in accordance with the
              laws of the United Kingdom without regard to its conflict of law
              provisions.
            </Text>
            <Text>
              Our failure to enforce any right or provision of these Terms will
              not be considered a waiver of those rights. If any provision of
              these Terms is held to be invalid or unenforceable by a court, the
              remaining provisions of these Terms will remain in effect. These
              Terms constitute the entire agreement between us regarding our
              Service and supersede and replace any prior agreements we might
              have had between us regarding Service.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Changes To Service</SubHeading>
            <Text>
              We reserve the right to withdraw or amend our Service, and any
              service or material we provide via Service, in our sole discretion
              without notice. We will not be liable if for any reason all or any
              part of Service is unavailable at any time or for any period. From
              time to time, we may restrict access to some parts of Service, or
              the entire Service, to users, including registered users.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Amendments To Terms</SubHeading>
            <Text>
              We may amend Terms at any time by posting the amended terms on
              this site. It is your responsibility to review these Terms
              periodically.
            </Text>
            <Text>
              Your continued use of the Platform following the posting of
              revised Terms means that you accept and agree to the changes. You
              are expected to check this page frequently so you are aware of any
              changes, as they are binding on you.
            </Text>
            <Text>
              By continuing to access or use our Service after any revisions
              become effective, you agree to be bound by the revised terms. If
              you do not agree to the new terms, you are no longer authorized to
              use Service.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Waiver And Severability</SubHeading>
            <Text>
              No waiver by Company of any term or condition set forth in Terms
              shall be deemed a further or continuing waiver of such term or
              condition or a waiver of any other term or condition, and any
              failure of Company to assert a right or provision under Terms
              shall not constitute a waiver of such right or provision.
            </Text>
            <Text>
              If any provision of Terms is held by a court or other tribunal of
              competent jurisdiction to be invalid, illegal or unenforceable for
              any reason, such provision shall be eliminated or limited to the
              minimum extent such that the remaining provisions of Terms will
              continue in full force and effect.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Acknowledgement</SubHeading>
            <Text>
              BY USING SERVICE OR OTHER SERVICES PROVIDED BY US, YOU ACKNOWLEDGE
              THAT YOU HAVE READ THESE TERMS OF SERVICE AND AGREE TO BE BOUND BY
              THEM.
            </Text>
          </div>

          <div className="mb-6">
            <SubHeading>Contact Us</SubHeading>
            <Text>
              If you have any questions about these terms of service, please
              contact us at{" "}
              <Link
                className="line-height text-md mb-4 text-light-1000 dark:text-dark-900"
                href="mailto:support@kan.bn"
              >
                support@kan.bn
              </Link>
            </Text>
          </div>
        </div>
      </div>
    </Layout>
  );
}



================================================
FILE: cloud/docker-compose.yml
================================================
services:
  web:
    image: ghcr.io/kanbn/kan:latest
    container_name: ${CONTAINER_NAME:-kan-web}
    ports:
      - "${WEB_PORT:-3000}:3000"
    networks:
      - dokploy-network
    build:
      context: ..
      dockerfile: apps/web/Dockerfile
      args:
        APP_VERSION: ${APP_VERSION:-}
    env_file:
      - .env
    restart: unless-stopped
    environment:
      - KAN_ADMIN_API_KEY=${KAN_ADMIN_API_KEY}
      - NEXT_PUBLIC_KAN_ENV=${NEXT_PUBLIC_KAN_ENV}
      - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL}
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET}
      - POSTGRES_URL=${POSTGRES_URL}
      - NEXT_PUBLIC_USE_STANDALONE_OUTPUT=${NEXT_PUBLIC_USE_STANDALONE_OUTPUT}
      - REDIS_URL=${REDIS_URL}

      # Stripe
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET}
      - STRIPE_WEBHOOK_SECRET_LEGACY=${STRIPE_WEBHOOK_SECRET_LEGACY}
      - STRIPE_TEAM_PLAN_MONTHLY_PRICE_ID=${STRIPE_TEAM_PLAN_MONTHLY_PRICE_ID}
      - STRIPE_TEAM_PLAN_YEARLY_PRICE_ID=${STRIPE_TEAM_PLAN_YEARLY_PRICE_ID}
      - STRIPE_PRO_PLAN_MONTHLY_PRICE_ID=${STRIPE_PRO_PLAN_MONTHLY_PRICE_ID}
      - STRIPE_PRO_PLAN_YEARLY_PRICE_ID=${STRIPE_PRO_PLAN_YEARLY_PRICE_ID}

      # Email
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - SMTP_SECURE=${SMTP_SECURE}
      - EMAIL_FROM=${EMAIL_FROM}
      - SMTP_REJECT_UNAUTHORIZED=${SMTP_REJECT_UNAUTHORIZED}

      # Notifications
      - NOVU_API_KEY=${NOVU_API_KEY}
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - EMAIL_UNSUBSCRIBE_SECRET=${EMAIL_UNSUBSCRIBE_SECRET}

      # S3 storage
      - S3_ACCESS_KEY_ID=${S3_ACCESS_KEY_ID}
      - S3_SECRET_ACCESS_KEY=${S3_SECRET_ACCESS_KEY}
      - S3_REGION=${S3_REGION}
      - S3_ENDPOINT=${S3_ENDPOINT}
      - S3_FORCE_PATH_STYLE=${S3_FORCE_PATH_STYLE}
      - NEXT_PUBLIC_STORAGE_URL=${NEXT_PUBLIC_STORAGE_URL}
      - NEXT_PUBLIC_AVATAR_BUCKET_NAME=${NEXT_PUBLIC_AVATAR_BUCKET_NAME}
      - NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME=${NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME}
      - NEXT_PUBLIC_STORAGE_DOMAIN=${NEXT_PUBLIC_STORAGE_DOMAIN}
      - NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS=${NEXT_PUBLIC_USE_VIRTUAL_HOSTED_URLS}

      # Auth config (optional)
      - NEXT_PUBLIC_ALLOW_CREDENTIALS=${NEXT_PUBLIC_ALLOW_CREDENTIALS}
      - NEXT_PUBLIC_DISABLE_SIGN_UP=${NEXT_PUBLIC_DISABLE_SIGN_UP}

      # API configuration (optional)
      - NEXT_API_BODY_SIZE_LIMIT=${NEXT_API_BODY_SIZE_LIMIT}

      # Integration providers
      - TRELLO_APP_API_KEY=${TRELLO_APP_API_KEY}
      - TRELLO_APP_SECRET=${TRELLO_APP_SECRET}

      # OAuth providers (optional)
      - BETTER_AUTH_TRUSTED_ORIGINS=${BETTER_AUTH_TRUSTED_ORIGINS}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - BETTER_AUTH_ALLOWED_DOMAINS=${BETTER_AUTH_ALLOWED_DOMAINS}

      # Analytics
      - NEXT_PUBLIC_UMAMI_ID=${NEXT_PUBLIC_UMAMI_ID}
      - NEXT_PUBLIC_POSTHOG_KEY=${NEXT_PUBLIC_POSTHOG_KEY}
      - NEXT_PUBLIC_POSTHOG_HOST=${NEXT_PUBLIC_POSTHOG_HOST}

networks:
  dokploy-network:
    external: true
#bump



================================================
FILE: packages/api/eslint.config.js
================================================
import baseConfig from "@kan/eslint-config/base";

/** @type {import('typescript-eslint').Config} */
export default [
  {
    ignores: ["dist/**"],
  },
  ...baseConfig,
];


================================================
FILE: packages/api/package.json
================================================
{
  "name": "@kan/api",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./src/index.ts"
    },
    "./root": {
      "types": "./dist/root.d.ts",
      "default": "./src/root.ts"
    },
    "./trpc": {
      "types": "./dist/trpc.d.ts",
      "default": "./src/trpc.ts"
    },
    "./types": {
      "types": "./dist/types.d.ts",
      "default": "./src/types/router.types.ts"
    },
    "./openapi": {
      "types": "./dist/openapi.d.ts",
      "default": "./src/openapi.ts"
    },
    "./utils/rateLimit": {
      "types": "./dist/utils/rateLimit.d.ts",
      "default": "./src/utils/rateLimit.ts"
    },
    "./utils/permissions": {
      "types": "./dist/utils/permissions.d.ts",
      "default": "./src/utils/permissions.ts"
    }
  },
  "license": "GPL-3.0",
  "scripts": {
    "build": "tsc",
    "clean": "git clean -xdf .cache .turbo dist node_modules",
    "dev": "tsc",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "typecheck": "tsc --noEmit --emitDeclarationOnly false"
  },
  "dependencies": {
    "@kan/auth": "workspace:*",
    "@kan/db": "workspace:*",
    "@kan/email": "workspace:^",
    "@kan/shared": "workspace:^",
    "@kan/stripe": "workspace:^",
    "@trpc/server": "catalog:",
    "rate-limiter-flexible": "^9.0.1",
    "superjson": "2.2.1",
    "trpc-to-openapi": "^2.3.2",
    "zod": "catalog:"
  },
  "devDependencies": {
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config"
}



================================================
FILE: packages/api/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/internal-package.json",
  "include": ["packages/**/*", "src"],
  "exclude": ["node_modules"],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "~/*": ["./src/*"]
    }
  }
}



================================================
FILE: packages/api/src/index.ts
================================================
import type { inferRouterInputs, inferRouterOutputs } from "@trpc/server";

import type { AppRouter } from "./root";
import { appRouter } from "./root";
import {
  createCallerFactory,
  createNextApiContext,
  createTRPCContext,
} from "./trpc";

const createCaller = createCallerFactory(appRouter);

type RouterInputs = inferRouterInputs<AppRouter>;
type RouterOutputs = inferRouterOutputs<AppRouter>;

export { createTRPCContext, appRouter, createCaller, createNextApiContext };
export type { AppRouter, RouterInputs, RouterOutputs };



================================================
FILE: packages/api/src/openapi.ts
================================================
import { env } from "next-runtime-env";
import { generateOpenApiDocument } from "trpc-to-openapi";

import { appRouter } from "./root";

export const openApiDocument = generateOpenApiDocument(appRouter, {
  title: "Kan API",
  description: "OpenAPI compliant REST API",
  version: "1.0.0",
  baseUrl: `${env("NEXT_PUBLIC_BASE_URL")}/api/v1`,
  docsUrl: "docs.kan.bn",
  tags: [
    "Auth",
    "Users",
    "Boards",
    "Lists",
    "Cards",
    "Labels",
    "Imports",
    "Integrations",
    "Health",
  ],
});



================================================
FILE: packages/api/src/root.ts
================================================
import { attachmentRouter } from "./routers/attachment";
import { boardRouter } from "./routers/board";
import { cardRouter } from "./routers/card";
import { checklistRouter } from "./routers/checklist";
import { feedbackRouter } from "./routers/feedback";
import { healthRouter } from "./routers/health";
import { importRouter } from "./routers/import";
import { integrationRouter } from "./routers/integration";
import { labelRouter } from "./routers/label";
import { listRouter } from "./routers/list";
import { memberRouter } from "./routers/member";
import { permissionRouter } from "./routers/permission";
import { userRouter } from "./routers/user";
import { workspaceRouter } from "./routers/workspace";
import { createTRPCRouter } from "./trpc";

export const appRouter = createTRPCRouter({
  attachment: attachmentRouter,
  board: boardRouter,
  card: cardRouter,
  checklist: checklistRouter,
  feedback: feedbackRouter,
  health: healthRouter,
  label: labelRouter,
  list: listRouter,
  member: memberRouter,
  import: importRouter,
  permission: permissionRouter,
  user: userRouter,
  workspace: workspaceRouter,
  integration: integrationRouter,
});

export type AppRouter = typeof appRouter;



================================================
FILE: packages/api/src/trpc.ts
================================================
import type { CreateNextContextOptions } from "@trpc/server/adapters/next";
import type { NextApiRequest } from "next";
import type { OpenApiMeta } from "trpc-to-openapi";
import { initTRPC, TRPCError } from "@trpc/server";
import { env } from "next-runtime-env";
import superjson from "superjson";
import { ZodError } from "zod";

import type { dbClient } from "@kan/db/client";
import { initAuth } from "@kan/auth/server";
import { createDrizzleClient } from "@kan/db/client";

export interface User {
  id: string;
  name: string;
  email: string;
  emailVerified: boolean;
  createdAt: Date;
  updatedAt: Date;
  image?: string | null | undefined;
  stripeCustomerId?: string | null | undefined;
}

const createAuthWithHeaders = (
  auth: ReturnType<typeof initAuth>,
  headers: Headers,
) => {
  return {
    api: {
      getSession: () => auth.api.getSession({ headers }),
      signInMagicLink: (input: { email: string; callbackURL: string }) =>
        auth.api.signInMagicLink({
          headers,
          body: { email: input.email, callbackURL: input.callbackURL },
        }),
      listActiveSubscriptions: (input: { workspacePublicId: string }) =>
        auth.api.listActiveSubscriptions({
          headers,
          query: { referenceId: input.workspacePublicId },
        }),
    },
  };
};

interface CreateContextOptions {
  user: User | null | undefined;
  db: dbClient;
  auth: ReturnType<typeof createAuthWithHeaders>;
  headers: Headers;
}

export const createInnerTRPCContext = (opts: CreateContextOptions) => {
  return {
    user: opts.user,
    db: opts.db,
    auth: opts.auth,
    headers: opts.headers,
  };
};

export const createTRPCContext = async ({ req }: CreateNextContextOptions) => {
  const db = createDrizzleClient();
  const baseAuth = initAuth(db);
  const headers = new Headers(req.headers as Record<string, string>);
  const auth = createAuthWithHeaders(baseAuth, headers);

  const session = await auth.api.getSession();

  return createInnerTRPCContext({ db, user: session?.user, auth, headers });
};

export const createNextApiContext = async (req: NextApiRequest) => {
  const db = createDrizzleClient();
  const baseAuth = initAuth(db);
  const headers = new Headers(req.headers as Record<string, string>);
  const auth = createAuthWithHeaders(baseAuth, headers);

  const session = await auth.api.getSession();

  return createInnerTRPCContext({ db, user: session?.user, auth, headers });
};

export const createRESTContext = async ({ req }: CreateNextContextOptions) => {
  const db = createDrizzleClient();
  const baseAuth = initAuth(db);
  const headers = new Headers(req.headers as Record<string, string>);
  const auth = createAuthWithHeaders(baseAuth, headers);

  let session;
  try {
    session = await auth.api.getSession();
  } catch (error) {
    console.error("Error getting session, ", error);
    throw error;
  }

  return createInnerTRPCContext({ db, user: session?.user, auth, headers });
};

const t = initTRPC
  .context<typeof createTRPCContext>()
  .meta<OpenApiMeta>()
  .create({
    transformer: superjson,
    errorFormatter({ shape, error }) {
      return {
        ...shape,
        data: {
          ...shape.data,
          zodError:
            error.cause instanceof ZodError ? error.cause.flatten() : null,
        },
      };
    },
  });

export const createTRPCRouter = t.router;

export const createCallerFactory = t.createCallerFactory;

export const publicProcedure = t.procedure.meta({
  openapi: { method: "GET", path: "/public" },
});

const enforceUserIsAuthed = t.middleware(async ({ ctx, next }) => {
  if (!ctx.user) {
    throw new TRPCError({ code: "UNAUTHORIZED" });
  }

  return next({
    ctx,
  });
});

const enforceUserIsAdmin = t.middleware(async ({ ctx, next }) => {
  if (ctx.headers.get("x-admin-api-key") !== env("KAN_ADMIN_API_KEY")) {
    throw new TRPCError({ code: "UNAUTHORIZED" });
  }

  return next({
    ctx,
  });
});

export const protectedProcedure = t.procedure.use(enforceUserIsAuthed).meta({
  openapi: {
    method: "GET",
    path: "/protected",
  },
});

export const adminProtectedProcedure = t.procedure
  .use(enforceUserIsAdmin)
  .meta({
    openapi: {
      method: "GET",
      path: "/admin/protected",
    },
  });



================================================
FILE: packages/api/src/routers/attachment.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as cardRepo from "@kan/db/repository/card.repo";
import * as cardActivityRepo from "@kan/db/repository/cardActivity.repo";
import * as cardAttachmentRepo from "@kan/db/repository/cardAttachment.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import { generateUID } from "@kan/shared/utils";

import { createTRPCRouter, protectedProcedure } from "../trpc";
import { assertPermission } from "../utils/permissions";
import { deleteObject, generateUploadUrl } from "@kan/shared/utils";

export const attachmentRouter = createTRPCRouter({
  generateUploadUrl: protectedProcedure
    .meta({
      openapi: {
        summary: "Generate presigned URL for attachment upload",
        method: "POST",
        path: "/cards/{cardPublicId}/attachments/upload-url",
        description:
          "Generates a presigned URL for uploading an attachment to S3",
        tags: ["Attachments"],
        protect: true,
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        filename: z.string().min(1).max(255),
        contentType: z.string(),
        size: z
          .number()
          .positive()
          .max(50 * 1024 * 1024), // 50MB max
      }),
    )
    .output(z.object({ url: z.string(), key: z.string() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, card.workspaceId, "card:edit");

      // Get workspace publicId
      const workspace = await workspaceRepo.getById(ctx.db, card.workspaceId);
      if (!workspace)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });

      const bucket = process.env.NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME;
      if (!bucket)
        throw new TRPCError({
          message: `Attachments bucket not configured`,
          code: "INTERNAL_SERVER_ERROR",
        });

      // Sanitize filename
      const sanitizedFilename = input.filename
        .replace(/[^a-zA-Z0-9._-]/g, "_")
        .substring(0, 200);

      const s3Key = `${workspace.publicId}/${input.cardPublicId}/${generateUID()}-${sanitizedFilename}`;

      const url = await generateUploadUrl(
        bucket,
        s3Key,
        input.contentType,
        3600, // 1 hour
      );

      return { url, key: s3Key };
    }),
  confirm: protectedProcedure
    .meta({
      openapi: {
        summary: "Confirm attachment upload and save to database",
        method: "POST",
        path: "/cards/{cardPublicId}/attachments/confirm",
        description:
          "Confirms an attachment upload and saves the record to the database",
        tags: ["Attachments"],
        protect: true,
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        s3Key: z.string(),
        filename: z.string(),
        originalFilename: z.string(),
        contentType: z.string(),
        size: z.number().positive(),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof cardAttachmentRepo.create>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, card.workspaceId, "card:edit");

      const attachment = await cardAttachmentRepo.create(ctx.db, {
        cardId: card.id,
        filename: input.filename,
        originalFilename: input.originalFilename,
        contentType: input.contentType,
        size: input.size,
        s3Key: input.s3Key,
        createdBy: userId,
      });

      if (!attachment) {
        throw new TRPCError({
          message: "Failed to create attachment",
          code: "INTERNAL_SERVER_ERROR",
        });
      }

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.attachment.added",
        cardId: card.id,
        attachmentId: attachment.id,
        toTitle: input.originalFilename,
        createdBy: userId,
      });

      return attachment;
    }),
  delete: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete an attachment",
        method: "DELETE",
        path: "/attachments/{attachmentPublicId}",
        description: "Soft deletes an attachment",
        tags: ["Attachments"],
        protect: true,
      },
    })
    .input(z.object({ attachmentPublicId: z.string().min(12) }))
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const attachment = await cardAttachmentRepo.getByPublicId(
        ctx.db,
        input.attachmentPublicId,
      );

      if (!attachment || attachment.deletedAt)
        throw new TRPCError({
          message: `Attachment with public ID ${input.attachmentPublicId} not found`,
          code: "NOT_FOUND",
        });

      const workspaceId = attachment.card.list.board.workspaceId;
      await assertPermission(ctx.db, userId, workspaceId, "card:edit");

      const bucket = process.env.NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME;
      if (bucket) {
        try {
          await deleteObject(bucket, attachment.s3Key);
        } catch (error) {
          console.error(
            `Failed to delete attachment from S3: ${attachment.s3Key}`,
            error,
          );
        }
      }

      await cardAttachmentRepo.softDelete(ctx.db, {
        attachmentId: attachment.id,
        deletedAt: new Date(),
      });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.attachment.removed",
        cardId: attachment.cardId,
        attachmentId: attachment.id,
        fromTitle: attachment.originalFilename,
        createdBy: userId,
      });

      return { success: true };
    }),
});



================================================
FILE: packages/api/src/routers/board.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as boardRepo from "@kan/db/repository/board.repo";
import * as cardRepo from "@kan/db/repository/card.repo";
import * as activityRepo from "@kan/db/repository/cardActivity.repo";
import * as labelRepo from "@kan/db/repository/label.repo";
import * as listRepo from "@kan/db/repository/list.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import { colours } from "@kan/shared/constants";
import {
  convertDueDateFiltersToRanges,
  generateAvatarUrl,
  generateSlug,
  generateUID,
} from "@kan/shared/utils";

import { createTRPCRouter, protectedProcedure, publicProcedure } from "../trpc";
import { assertCanDelete, assertCanEdit, assertPermission } from "../utils/permissions";

export const boardRouter = createTRPCRouter({
  all: protectedProcedure
    .meta({
      openapi: {
        method: "GET",
        path: "/workspaces/{workspacePublicId}/boards",
        summary: "Get all boards",
        description: "Retrieves all boards for a given workspace",
        tags: ["Boards"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        type: z.enum(["regular", "template"]).optional(),
      }),
    )
    .output(
      z.custom<Awaited<ReturnType<typeof boardRepo.getAllByWorkspaceId>>>(),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace with public ID ${input.workspacePublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, workspace.id, "board:view");

      const result = boardRepo.getAllByWorkspaceId(
        ctx.db,
        workspace.id,
        userId,
        { type: input.type }
      );

      return result;
    }),
  byId: protectedProcedure
    .meta({
      openapi: {
        method: "GET",
        path: "/boards/{boardPublicId}",
        summary: "Get board by public ID",
        description: "Retrieves a board by its public ID",
        tags: ["Boards"],
        protect: true,
      },
    })
    .input(
      z.object({
        boardPublicId: z.string().min(12),
        members: z.array(z.string().min(12)).optional(),
        labels: z.array(z.string().min(12)).optional(),
        lists: z.array(z.string().min(12)).optional(),
        dueDateFilters: z
          .array(
            z.enum([
              "overdue",
              "today",
              "tomorrow",
              "next-week",
              "next-month",
              "no-due-date",
            ]),
          )
          .optional(),
        type: z.enum(["regular", "template"]).optional(),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof boardRepo.getByPublicId>>>())
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const board = await boardRepo.getWorkspaceAndBoardIdByBoardPublicId(
        ctx.db,
        input.boardPublicId,
      );

      if (!board)
        throw new TRPCError({
          message: `Board with public ID ${input.boardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, board.workspaceId, "board:view");

      // Convert semantic string filters to date ranges expected by the repo
      const dueDateFilters = input.dueDateFilters
        ? convertDueDateFiltersToRanges(input.dueDateFilters)
        : [];

      const result = await boardRepo.getByPublicId(
        ctx.db,
        input.boardPublicId,
        userId,
        {
          members: input.members ?? [],
          labels: input.labels ?? [],
          lists: input.lists ?? [],
          dueDate: dueDateFilters,
          type: input.type,
        },
      );

      if (!result) {
        throw new TRPCError({
          message: `Board with public ID ${input.boardPublicId} not found`,
          code: "NOT_FOUND",
        });
      }

      // Generate presigned URLs for workspace member avatars
      const workspaceWithAvatarUrls = result.workspace
        ? {
            ...result.workspace,
            members: await Promise.all(
              result.workspace.members.map(async (member) => {
                if (!member.user?.image) {
                  return member;
                }

                const avatarUrl = await generateAvatarUrl(member.user.image);
                return {
                  ...member,
                  user: {
                    ...member.user,
                    image: avatarUrl,
                  },
                };
              }),
            ),
          }
        : result.workspace;

      // Generate presigned URLs for card member avatars
      const listsWithAvatarUrls = await Promise.all(
        result.lists.map(async (list) => ({
          ...list,
          cards: await Promise.all(
            list.cards.map(async (card) => ({
              ...card,
              members: await Promise.all(
                card.members.map(async (member) => {
                  if (!member.user?.image) return member;
                  const avatarUrl = await generateAvatarUrl(member.user.image);
                  return {
                    ...member,
                    user: { ...member.user, image: avatarUrl },
                  };
                }),
              ),
            })),
          ),
        })),
      );

      return {
        ...result,
        lists: listsWithAvatarUrls,
        workspace: workspaceWithAvatarUrls,
      };
    }),
  bySlug: publicProcedure
    .meta({
      openapi: {
        method: "GET",
        path: "/workspaces/{workspaceSlug}/boards/{boardSlug}",
        summary: "Get board by slug",
        description:
          "Retrieves a board by its slug within a specific workspace",
        tags: ["Boards"],
        protect: false,
      },
    })
    .input(
      z.object({
        workspaceSlug: z
          .string()
          .min(3)
          .max(64)
          .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/),
        boardSlug: z
          .string()
          .min(3)
          .max(24)
          .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/),
        members: z.array(z.string().min(12)).optional(),
        labels: z.array(z.string().min(12)).optional(),
        lists: z.array(z.string().min(12)).optional(),
        dueDateFilters: z
          .array(
            z.enum([
              "overdue",
              "today",
              "tomorrow",
              "next-week",
              "next-month",
              "no-due-date",
            ]),
          )
          .optional(),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof boardRepo.getBySlug>>>())
    .query(async ({ ctx, input }) => {
      const workspace = await workspaceRepo.getBySlugWithBoards(
        ctx.db,
        input.workspaceSlug,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace with slug ${input.workspaceSlug} not found`,
          code: "NOT_FOUND",
        });

      // Convert semantic string filters to date ranges expected by the repo
      const dueDateFilters = input.dueDateFilters
        ? convertDueDateFiltersToRanges(input.dueDateFilters)
        : [];

      const result = await boardRepo.getBySlug(
        ctx.db,
        input.boardSlug,
        workspace.id,
        {
          members: input.members ?? [],
          labels: input.labels ?? [],
          lists: input.lists ?? [],
          dueDate: dueDateFilters,
        },
      );

      return result;
    }),
  create: protectedProcedure
    .meta({
      openapi: {
        method: "POST",
        path: "/workspaces/{workspacePublicId}/boards",
        summary: "Create board",
        description: "Creates a new board for a given workspace",
        tags: ["Boards"],
        protect: true,
      },
    })
    .input(
      z.object({
        name: z.string().min(1).max(100),
        workspacePublicId: z.string().min(12),
        lists: z.array(z.string().min(1)),
        labels: z.array(z.string().min(1)),
        type: z.enum(["regular", "template"]).optional(),
        sourceBoardPublicId: z.string().min(12).optional(),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof boardRepo.create>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace with public ID ${input.workspacePublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, workspace.id, "board:create");

      // If sourceBoardPublicId is provided, clone the source board
      if (input.sourceBoardPublicId) {
        // First get the source board info (ID and type)
        const sourceBoardInfo = await boardRepo.getIdByPublicId(
          ctx.db,
          input.sourceBoardPublicId,
        );

        if (!sourceBoardInfo)
          throw new TRPCError({
            message: `Source board with public ID ${input.sourceBoardPublicId} not found`,
            code: "NOT_FOUND",
          });

        // Get the full board data with the correct type
        const sourceBoard = await boardRepo.getByPublicId(
          ctx.db,
          input.sourceBoardPublicId,
          userId,
          {
            members: [],
            labels: [],
            lists: [],
            dueDate: [],
            type: sourceBoardInfo.type,
          },
        );

        if (!sourceBoard)
          throw new TRPCError({
            message: `Source board with public ID ${input.sourceBoardPublicId} not found`,
            code: "NOT_FOUND",
          });

        // Verify the source board belongs to the same workspace
        const sourceWorkspace = await workspaceRepo.getByPublicId(
          ctx.db,
          sourceBoard.workspace.publicId,
        );

        if (!sourceWorkspace || sourceWorkspace.id !== workspace.id)
          throw new TRPCError({
            message: `Source board does not belong to this workspace`,
            code: "FORBIDDEN",
          });

        let slug = generateSlug(input.name);

        const isSlugUnique = await boardRepo.isSlugUnique(ctx.db, {
          slug,
          workspaceId: workspace.id,
        });

        if (!isSlugUnique || input.type === "template")
          slug = `${slug}-${generateUID()}`;

        const result = await boardRepo.createFromSnapshot(ctx.db, {
          source: sourceBoard,
          workspaceId: workspace.id,
          createdBy: userId,
          slug,
          name: input.name,
          type: input.type ?? "regular",
          sourceBoardId: sourceBoardInfo.id,
        });

        return result;
      }

      // Otherwise, create a new board with provided lists and labels
      let slug = generateSlug(input.name);

      const isSlugUnique = await boardRepo.isSlugUnique(ctx.db, {
        slug,
        workspaceId: workspace.id,
      });

      if (!isSlugUnique || input.type === "template")
        slug = `${slug}-${generateUID()}`;

      const result = await boardRepo.create(ctx.db, {
        publicId: generateUID(),
        slug,
        name: input.name,
        createdBy: userId,
        workspaceId: workspace.id,
        type: input.type,
      });

      if (!result)
        throw new TRPCError({
          message: `Failed to create board`,
          code: "INTERNAL_SERVER_ERROR",
        });

      if (input.lists.length) {
        const listInputs = input.lists.map((list, index) => ({
          publicId: generateUID(),
          name: list,
          boardId: result.id,
          createdBy: userId,
          index,
        }));

        await listRepo.bulkCreate(ctx.db, listInputs);
      }

      if (input.labels.length) {
        const labelInputs = input.labels.map((label, index) => ({
          publicId: generateUID(),
          name: label,
          boardId: result.id,
          createdBy: userId,
          colourCode: colours[index % colours.length]?.code ?? "#0d9488",
        }));

        await labelRepo.bulkCreate(ctx.db, labelInputs);
      }

      return result;
    }),
  update: protectedProcedure
    .meta({
      openapi: {
        method: "PUT",
        path: "/boards/{boardPublicId}",
        summary: "Update board",
        description: "Updates a board by its public ID",
        tags: ["Boards"],
        protect: true,
      },
    })
    .input(
      z.object({
        boardPublicId: z.string().min(12),
        name: z.string().min(1).optional(),
        slug: z
          .string()
          .min(3)
          .max(60)
          .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/)
          .optional(),
        visibility: z.enum(["public", "private"]).optional(),
        favorite: z.boolean().optional()
      }),
    )
    .output(z.object({ success: z.boolean() }).or(z.custom<Awaited<ReturnType<typeof boardRepo.update>>>()))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const board = await boardRepo.getWorkspaceAndBoardIdByBoardPublicId(
        ctx.db,
        input.boardPublicId,
      );

      if (!board)
        throw new TRPCError({
          message: `Board with public ID ${input.boardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertCanEdit(
        ctx.db,
        userId,
        board.workspaceId,
        "board:edit",
        board.createdBy ?? null,
      );

      // Handle favorite toggle separately
      if (input.favorite !== undefined) {
        if (input.favorite) {
          await boardRepo.addUserFavorite(ctx.db, userId, board.id);
        } else {
          await boardRepo.removeUserFavorite(ctx.db, userId, board.id);
        }
      }

      // Handle other updates (name, slug, visibility)
      const hasOtherUpdates = input.name || input.slug || input.visibility !== undefined;

      if (!hasOtherUpdates) {
        // Only favorite was updated, return success
        return { success: true };
      }

      if (input.slug) {
        const isBoardSlugAvailable = await boardRepo.isBoardSlugAvailable(
          ctx.db,
          input.slug,
          board.workspaceId,
        );

        if (!isBoardSlugAvailable) {
          throw new TRPCError({
            message: `Board slug ${input.slug} is not available`,
            code: "BAD_REQUEST",
          });
        }
      }

      const result = await boardRepo.update(ctx.db, {
        name: input.name,
        slug: input.slug,
        boardPublicId: input.boardPublicId,
        visibility: input.visibility,
      });

      if (!result)
        throw new TRPCError({
          message: `Failed to update board`,
          code: "INTERNAL_SERVER_ERROR",
        });

      return result;
    }),
  delete: protectedProcedure
    .meta({
      openapi: {
        method: "DELETE",
        path: "/boards/{boardPublicId}",
        summary: "Delete board",
        description: "Deletes a board by its public ID",
        tags: ["Boards"],
        protect: true,
      },
    })
    .input(
      z.object({
        boardPublicId: z.string().min(12),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const board = await boardRepo.getWithListIdsByPublicId(
        ctx.db,
        input.boardPublicId,
      );

      if (!board)
        throw new TRPCError({
          message: `Board with public ID ${input.boardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertCanDelete(
        ctx.db,
        userId,
        board.workspaceId,
        "board:delete",
        board.createdBy ?? null,
      );

      const listIds = board.lists.map((list) => list.id);

      const deletedAt = new Date();

      await boardRepo.softDelete(ctx.db, {
        boardId: board.id,
        deletedAt,
        deletedBy: userId,
      });

      if (listIds.length) {
        const deletedLists = await listRepo.softDeleteAllByBoardId(ctx.db, {
          boardId: board.id,
          deletedAt,
          deletedBy: userId,
        });

        if (!Array.isArray(deletedLists)) {
          throw new TRPCError({
            message: `Failed to delete lists`,
            code: "INTERNAL_SERVER_ERROR",
          });
        }

        const deletedCards = await cardRepo.softDeleteAllByListIds(ctx.db, {
          listIds,
          deletedAt,
          deletedBy: userId,
        });

        if (!Array.isArray(deletedCards)) {
          throw new TRPCError({
            message: `Failed to delete cards`,
            code: "INTERNAL_SERVER_ERROR",
          });
        }

        if (deletedCards.length) {
          const activities = deletedCards.map((card) => ({
            type: "card.archived" as const,
            createdBy: userId,
            cardId: card.id,
          }));

          await activityRepo.bulkCreate(ctx.db, activities);
        }
      }

      return { success: true };
    }),
  checkSlugAvailability: publicProcedure
    .meta({
      openapi: {
        summary: "Check if a board slug is available",
        method: "GET",
        path: "/boards/{boardPublicId}/check-slug-availability",
        description: "Checks if a board slug is available",
        tags: ["Boards"],
        protect: true,
      },
    })
    .input(
      z.object({
        boardSlug: z
          .string()
          .min(3)
          .max(24)
          .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/),
        boardPublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        isReserved: z.boolean(),
      }),
    )
    .query(async ({ ctx, input }) => {
      const board = await boardRepo.getWorkspaceAndBoardIdByBoardPublicId(
        ctx.db,
        input.boardPublicId,
      );

      if (!board)
        throw new TRPCError({
          message: `Board with public ID ${input.boardPublicId} not found`,
          code: "NOT_FOUND",
        });

      const isBoardSlugAvailable = await boardRepo.isBoardSlugAvailable(
        ctx.db,
        input.boardSlug,
        board.workspaceId,
      );

      return {
        isReserved: !isBoardSlugAvailable,
      };
    }),
});



================================================
FILE: packages/api/src/routers/card.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as cardRepo from "@kan/db/repository/card.repo";
import * as cardActivityRepo from "@kan/db/repository/cardActivity.repo";
import * as cardCommentRepo from "@kan/db/repository/cardComment.repo";
import * as labelRepo from "@kan/db/repository/label.repo";
import * as listRepo from "@kan/db/repository/list.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";

import { createTRPCRouter, protectedProcedure, publicProcedure } from "../trpc";
import { mergeActivities } from "../utils/activities";
import { sendMentionEmails } from "../utils/notifications";
import { assertCanDelete, assertCanEdit, assertPermission } from "../utils/permissions";
import { generateAttachmentUrl, generateAvatarUrl } from "@kan/shared/utils";

export const cardRouter = createTRPCRouter({
  create: protectedProcedure
    .meta({
      openapi: {
        summary: "Create a card",
        method: "POST",
        path: "/cards",
        description: "Creates a new card for a given list",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        title: z.string().min(1).max(2000),
        description: z.string().max(10000),
        listPublicId: z.string().min(12),
        labelPublicIds: z.array(z.string().min(12)),
        memberPublicIds: z.array(z.string().min(12)),
        position: z.enum(["start", "end"]),
        dueDate: z.date().nullable().optional(),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof cardRepo.create>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const list = await listRepo.getWorkspaceAndListIdByListPublicId(
        ctx.db,
        input.listPublicId,
      );

      if (!list)
        throw new TRPCError({
          message: `List with public ID ${input.listPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, list.workspaceId, "card:create");

      const newCard = await cardRepo.create(ctx.db, {
        title: input.title,
        description: input.description,
        createdBy: userId,
        listId: list.id,
        position: input.position,
        dueDate: input.dueDate ?? null,
      });

      const newCardId = newCard.id;

      if (!newCardId)
        throw new TRPCError({
          message: `Failed to create card`,
          code: "INTERNAL_SERVER_ERROR",
        });

      if (newCardId && input.labelPublicIds.length) {
        const labels = await labelRepo.getAllByPublicIds(
          ctx.db,
          input.labelPublicIds,
        );

        if (!labels.length)
          throw new TRPCError({
            message: `Labels with public IDs (${input.labelPublicIds.join(", ")}) not found`,
            code: "NOT_FOUND",
          });

        const labelsInsert = labels.map((label) => ({
          cardId: newCardId,
          labelId: label.id,
        }));

        const cardLabels = await cardRepo.bulkCreateCardLabelRelationships(
          ctx.db,
          labelsInsert,
        );

        if (!cardLabels.length)
          throw new TRPCError({
            message: `Failed to create card label relationships`,
            code: "INTERNAL_SERVER_ERROR",
          });

        const cardActivitesInsert = cardLabels.map((cardLabel) => ({
          type: "card.updated.label.added" as const,
          cardId: cardLabel.cardId,
          labelId: cardLabel.labelId,
          createdBy: userId,
        }));

        await cardActivityRepo.bulkCreate(ctx.db, cardActivitesInsert);
      }

      if (newCardId && input.memberPublicIds.length) {
        const members = await workspaceRepo.getAllMembersByPublicIds(
          ctx.db,
          input.memberPublicIds,
        );

        if (!members.length)
          throw new TRPCError({
            message: `Members with public IDs (${input.memberPublicIds.join(", ")}) not found`,
            code: "NOT_FOUND",
          });

        const membersInsert = members.map((member) => ({
          cardId: newCardId,
          workspaceMemberId: member.id,
        }));

        const cardMembers =
          await cardRepo.bulkCreateCardWorkspaceMemberRelationships(
            ctx.db,
            membersInsert,
          );

        if (!cardMembers.length)
          throw new TRPCError({
            message: `Failed to create card member relationships`,
            code: "INTERNAL_SERVER_ERROR",
          });

        const cardActivitesInsert = cardMembers.map((cardMember) => ({
          type: "card.updated.member.added" as const,
          cardId: cardMember.cardId,
          workspaceMemberId: cardMember.workspaceMemberId,
          createdBy: userId,
        }));

        await cardActivityRepo.bulkCreate(ctx.db, cardActivitesInsert);
      }

      if (input.description) {
        sendMentionEmails({
          db: ctx.db,
          cardPublicId: newCard.publicId,
          commentHtml: input.description,
          commenterUserId: userId,
        }).catch((error) => {
          console.error("Failed to send mention emails:", error);
        });
      }

      return newCard;
    }),
  addComment: protectedProcedure
    .meta({
      openapi: {
        summary: "Add a comment to a card",
        method: "POST",
        path: "/cards/{cardPublicId}/comments",
        description: "Adds a comment to a card",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        comment: z.string().min(1),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof cardCommentRepo.create>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, card.workspaceId, "comment:create");

      const newComment = await cardCommentRepo.create(ctx.db, {
        comment: input.comment,
        createdBy: userId,
        cardId: card.id,
      });

      if (!newComment?.id)
        throw new TRPCError({
          message: `Failed to create comment`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.comment.added" as const,
        cardId: card.id,
        commentId: newComment.id,
        toComment: newComment.comment,
        createdBy: userId,
      });

      sendMentionEmails({
        db: ctx.db,
        cardPublicId: input.cardPublicId,
        commentHtml: input.comment,
        commenterUserId: userId,
        commentId: newComment.id,
      }).catch((error) => {
        console.error("Failed to send mention emails:", error);
      });

      return newComment;
    }),
  updateComment: protectedProcedure
    .meta({
      openapi: {
        summary: "Update a comment",
        method: "PUT",
        path: "/cards/{cardPublicId}/comments/{commentPublicId}",
        description: "Updates a comment",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        commentPublicId: z.string().min(12),
        comment: z.string().min(1),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof cardCommentRepo.update>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      const existingComment = await cardCommentRepo.getByPublicId(
        ctx.db,
        input.commentPublicId,
      );

      if (!existingComment)
        throw new TRPCError({
          message: `Comment with public ID ${input.commentPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertCanEdit(
        ctx.db,
        userId,
        card.workspaceId,
        "comment:edit",
        existingComment.createdBy,
      );

      const updatedComment = await cardCommentRepo.update(ctx.db, {
        id: existingComment.id,
        comment: input.comment,
      });

      if (!updatedComment?.id)
        throw new TRPCError({
          message: `Failed to update comment`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.comment.updated" as const,
        cardId: card.id,
        commentId: updatedComment.id,
        fromComment: existingComment.comment,
        toComment: updatedComment.comment,
        createdBy: userId,
      });

      sendMentionEmails({
        db: ctx.db,
        cardPublicId: input.cardPublicId,
        commentHtml: input.comment,
        commenterUserId: userId,
        commentId: updatedComment.id,
      }).catch((error) => {
        console.error("Failed to send mention emails:", error);
      });

      return updatedComment;
    }),
  deleteComment: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete a comment",
        method: "DELETE",
        path: "/cards/{cardPublicId}/comments/{commentPublicId}",
        description: "Deletes a comment",
        tags: ["Cards"],
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        commentPublicId: z.string().min(12),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof cardCommentRepo.softDelete>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      const existingComment = await cardCommentRepo.getByPublicId(
        ctx.db,
        input.commentPublicId,
      );

      if (!existingComment)
        throw new TRPCError({
          message: `Comment with public ID ${input.commentPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertCanDelete(
        ctx.db,
        userId,
        card.workspaceId,
        "comment:delete",
        existingComment.createdBy,
      );

      const deletedComment = await cardCommentRepo.softDelete(ctx.db, {
        commentId: existingComment.id,
        deletedAt: new Date(),
        deletedBy: userId,
      });

      if (!deletedComment)
        throw new TRPCError({
          message: `Failed to delete comment`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.comment.deleted" as const,
        cardId: card.id,
        commentId: existingComment.id,
        createdBy: userId,
      });

      return deletedComment;
    }),
  addOrRemoveLabel: protectedProcedure
    .meta({
      openapi: {
        summary: "Add or remove a label from a card",
        method: "PUT",
        path: "/cards/{cardPublicId}/labels/{labelPublicId}",
        description: "Adds or removes a label from a card",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        labelPublicId: z.string().min(12),
      }),
    )
    .output(z.object({ newLabel: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, card.workspaceId, "card:edit");

      const label = await labelRepo.getByPublicId(ctx.db, input.labelPublicId);

      if (!label)
        throw new TRPCError({
          message: `Label with public ID ${input.labelPublicId} not found`,
          code: "NOT_FOUND",
        });

      const cardLabelIds = { cardId: card.id, labelId: label.id };

      const existingLabel = await cardRepo.getCardLabelRelationship(
        ctx.db,
        cardLabelIds,
      );

      if (existingLabel) {
        const deletedCardLabelRelationship =
          await cardRepo.hardDeleteCardLabelRelationship(ctx.db, cardLabelIds);

        if (!deletedCardLabelRelationship)
          throw new TRPCError({
            message: `Failed to remove label from card`,
            code: "INTERNAL_SERVER_ERROR",
          });

        await cardActivityRepo.create(ctx.db, {
          type: "card.updated.label.removed" as const,
          cardId: card.id,
          labelId: label.id,
          createdBy: userId,
        });

        return { newLabel: false };
      }

      const newCardLabelRelationship =
        await cardRepo.createCardLabelRelationship(ctx.db, cardLabelIds);

      if (!newCardLabelRelationship)
        throw new TRPCError({
          message: `Failed to add label to card`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.label.added" as const,
        cardId: card.id,
        labelId: label.id,
        createdBy: userId,
      });

      return { newLabel: true };
    }),
  addOrRemoveMember: protectedProcedure
    .meta({
      openapi: {
        summary: "Add or remove a member from a card",
        method: "PUT",
        path: "/cards/{cardPublicId}/members/{workspaceMemberPublicId}",
        description: "Adds or removes a member from a card",
        tags: ["Cards"],
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        workspaceMemberPublicId: z.string().min(12),
      }),
    )
    .output(z.object({ newMember: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, card.workspaceId, "card:edit");

      const member = await workspaceRepo.getMemberByPublicId(
        ctx.db,
        input.workspaceMemberPublicId,
      );

      if (!member)
        throw new TRPCError({
          message: `Member with public ID ${input.workspaceMemberPublicId} not found`,
          code: "NOT_FOUND",
        });

      const cardMemberIds = { cardId: card.id, memberId: member.id };

      const existingMember = await cardRepo.getCardMemberRelationship(
        ctx.db,
        cardMemberIds,
      );

      if (existingMember) {
        const deletedCardMemberRelationship =
          await cardRepo.hardDeleteCardMemberRelationship(
            ctx.db,
            cardMemberIds,
          );

        if (!deletedCardMemberRelationship.success)
          throw new TRPCError({
            message: `Failed to remove member from card`,
            code: "INTERNAL_SERVER_ERROR",
          });

        await cardActivityRepo.create(ctx.db, {
          type: "card.updated.member.removed" as const,
          cardId: card.id,
          workspaceMemberId: member.id,
          createdBy: userId,
        });

        return { newMember: false };
      }

      const newCardMemberRelationship =
        await cardRepo.createCardMemberRelationship(ctx.db, cardMemberIds);

      if (!newCardMemberRelationship.success)
        throw new TRPCError({
          message: `Failed to add member to card`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.member.added" as const,
        cardId: card.id,
        workspaceMemberId: member.id,
        createdBy: userId,
      });

      return { newMember: true };
    }),
  byId: publicProcedure
    .meta({
      openapi: {
        summary: "Get a card by public ID",
        method: "GET",
        path: "/cards/{cardPublicId}",
        description: "Retrieves a card by its public ID",
        tags: ["Cards"],
      },
    })
    .input(z.object({ cardPublicId: z.string().min(12) }))
    .output(
      z.custom<
        Omit<
          NonNullable<
            Awaited<ReturnType<typeof cardRepo.getWithListAndMembersByPublicId>>
          >,
          "attachments"
        > & {
          attachments: {
            publicId: string;
            contentType: string;
            s3Key: string;
            originalFilename: string | null;
            size?: number | null;
            url: string | null;
          }[];
        }
      >(),
    )
    .query(async ({ ctx, input }) => {
      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      if (card.workspaceVisibility === "private") {
        const userId = ctx.user?.id;

        if (!userId)
          throw new TRPCError({
            message: `User not authenticated`,
            code: "UNAUTHORIZED",
          });

        await assertPermission(ctx.db, userId, card.workspaceId, "card:view");
      }

      const result = await cardRepo.getWithListAndMembersByPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!result)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      // Generate URLs for all attachments
      const attachmentsWithUrls = await Promise.all(
        result.attachments.map(async (attachment) => {
          const url = await generateAttachmentUrl(attachment.s3Key);
          return {
            publicId: attachment.publicId,
            contentType: attachment.contentType,
            s3Key: attachment.s3Key,
            originalFilename: attachment.originalFilename,
            size: attachment.size,
            url,
          };
        }),
      );

      // Generate presigned URLs for workspace member avatars
      const workspaceWithAvatarUrls = result.list.board.workspace
        ? {
            ...result.list.board.workspace,
            members: await Promise.all(
              result.list.board.workspace.members.map(async (member) => {
                if (!member.user?.image) {
                  return member;
                }

                const avatarUrl = await generateAvatarUrl(member.user.image);
                return {
                  ...member,
                  user: {
                    ...member.user,
                    image: avatarUrl,
                  },
                };
              }),
            ),
          }
        : result.list.board.workspace;

      return {
        ...result,
        attachments: attachmentsWithUrls,
        list: {
          ...result.list,
          board: {
            ...result.list.board,
            workspace: workspaceWithAvatarUrls,
          },
        },
      };
    }),
  getActivities: publicProcedure
    .meta({
      openapi: {
        summary: "Get paginated card activities",
        method: "GET",
        path: "/cards/{cardPublicId}/activities",
        description:
          "Retrieves paginated activities for a card with merged frequent changes",
        tags: ["Cards"],
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        limit: z.number().min(1).max(100).optional().default(10),
        cursor: z.string().datetime().optional(), // ISO datetime string
      }),
    )
    .output(
      z.object({
        activities: z.array(
          z.custom<
            NonNullable<
              Awaited<
                ReturnType<typeof cardActivityRepo.getPaginatedActivities>
              >
            >["activities"][number]
          >(),
        ),
        hasMore: z.boolean(),
        nextCursor: z.string().datetime().nullable(),
      }),
    )
    .query(async ({ ctx, input }) => {
      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      if (card.workspaceVisibility === "private") {
        const userId = ctx.user?.id;

        if (!userId)
          throw new TRPCError({
            message: `User not authenticated`,
            code: "UNAUTHORIZED",
          });

        await assertPermission(ctx.db, userId, card.workspaceId, "card:view");
      }

      const cursor = input.cursor ? new Date(input.cursor) : undefined;
      const result = await cardActivityRepo.getPaginatedActivities(
        ctx.db,
        card.id,
        {
          limit: input.limit,
          cursor,
        },
      );

      // Generate presigned URLs for user avatars in activities
      const activitiesWithAvatarUrls = await Promise.all(
        result.activities.map(async (activity) => {
          const updatedActivity = { ...activity };

          // Generate presigned URL for activity user avatar
          if (activity.user?.image) {
            const userAvatarUrl = await generateAvatarUrl(activity.user.image);
            updatedActivity.user = {
              ...activity.user,
              image: userAvatarUrl,
            };
          }

          // Generate presigned URL for member user avatar (if exists)
          if (activity.member?.user?.image) {
            const memberAvatarUrl = await generateAvatarUrl(
              activity.member.user.image,
            );
            updatedActivity.member = {
              ...activity.member,
              user: {
                ...activity.member.user,
                image: memberAvatarUrl,
              },
            };
          }

          return updatedActivity;
        }),
      );

      const mergedActivities = mergeActivities(activitiesWithAvatarUrls);

      return {
        activities: mergedActivities,
        hasMore: result.hasMore,
        nextCursor: result.nextCursor?.toISOString() ?? null,
      };
    }),
  update: protectedProcedure
    .meta({
      openapi: {
        summary: "Update a card",
        method: "PUT",
        path: "/cards/{cardPublicId}",
        description: "Updates a card by its public ID",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
        title: z.string().min(1).max(2000).optional(),
        description: z.string().optional(),
        index: z.number().optional(),
        listPublicId: z.string().min(12).optional(),
        dueDate: z.date().nullable().optional(),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof cardRepo.update>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertCanEdit(
        ctx.db,
        userId,
        card.workspaceId,
        "card:edit",
        card.createdBy,
      );

      const existingCard = await cardRepo.getByPublicId(
        ctx.db,
        input.cardPublicId,
      );

      let newListId: number | undefined;

      if (input.listPublicId) {
        const newList = await listRepo.getByPublicId(
          ctx.db,
          input.listPublicId,
        );

        if (!newList)
          throw new TRPCError({
            message: `List with public ID ${input.listPublicId} not found`,
            code: "NOT_FOUND",
          });

        newListId = newList.id;
      }

      if (!existingCard) {
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });
      }

      let result:
        | {
            id: number;
            title: string;
            description: string | null;
            publicId: string;
            dueDate: Date | null;
          }
        | undefined;

      const previousDueDate = existingCard.dueDate;

      if (input.title || input.description || input.dueDate !== undefined) {
        result = await cardRepo.update(
          ctx.db,
          {
            ...(input.title && { title: input.title }),
            ...(input.description && { description: input.description }),
            ...(input.dueDate !== undefined && { dueDate: input.dueDate }),
          },
          { cardPublicId: input.cardPublicId },
        );
      }

      if (input.index !== undefined) {
        result = await cardRepo.reorder(ctx.db, {
          cardId: existingCard.id,
          newIndex: input.index,
          newListId: newListId,
        });
      }

      if (!result)
        throw new TRPCError({
          message: `Failed to update card`,
          code: "INTERNAL_SERVER_ERROR",
        });

      const activities = [];

      if (input.title && existingCard.title !== input.title) {
        activities.push({
          type: "card.updated.title" as const,
          cardId: result.id,
          createdBy: userId,
          fromTitle: existingCard.title,
          toTitle: input.title,
        });
      }

      if (input.description && existingCard.description !== input.description) {
        activities.push({
          type: "card.updated.description" as const,
          cardId: result.id,
          createdBy: userId,
          fromDescription: existingCard.description ?? undefined,
          toDescription: input.description,
        });

        sendMentionEmails({
          db: ctx.db,
          cardPublicId: input.cardPublicId,
          commentHtml: input.description,
          commenterUserId: userId,
        }).catch((error) => {
          console.error("Failed to send mention emails:", error);
        });
      }

      if (
        input.dueDate !== undefined &&
        previousDueDate?.getTime() !== input.dueDate?.getTime()
      ) {
        let activityType:
          | "card.updated.dueDate.added"
          | "card.updated.dueDate.updated"
          | "card.updated.dueDate.removed";

        if (!previousDueDate) {
          activityType = "card.updated.dueDate.added";
        } else if (!input.dueDate) {
          activityType = "card.updated.dueDate.removed";
        } else {
          activityType = "card.updated.dueDate.updated";
        }

        activities.push({
          type: activityType,
          cardId: result.id,
          createdBy: userId,
          fromDueDate: previousDueDate ?? undefined,
          toDueDate: input.dueDate ?? undefined,
        });
      }

      if (newListId && existingCard.listId !== newListId) {
        activities.push({
          type: "card.updated.list" as const,
          cardId: result.id,
          createdBy: userId,
          fromListId: existingCard.listId,
          toListId: newListId,
        });
      }

      if (activities.length > 0) {
        await cardActivityRepo.bulkCreate(ctx.db, activities);
      }

      return result;
    }),
  delete: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete a card",
        method: "DELETE",
        path: "/cards/{cardPublicId}",
        description: "Deletes a card by its public ID",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().min(12),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertCanDelete(
        ctx.db,
        userId,
        card.workspaceId,
        "card:delete",
        card.createdBy,
      );

      const deletedAt = new Date();

      await cardRepo.softDelete(ctx.db, {
        cardId: card.id,
        deletedAt,
        deletedBy: userId,
      });

      await cardActivityRepo.create(ctx.db, {
        type: "card.archived",
        cardId: card.id,
        createdBy: userId,
      });

      return { success: true };
    }),
});



================================================
FILE: packages/api/src/routers/checklist.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as cardRepo from "@kan/db/repository/card.repo";
import * as cardActivityRepo from "@kan/db/repository/cardActivity.repo";
import * as checklistRepo from "@kan/db/repository/checklist.repo";

import { createTRPCRouter, protectedProcedure } from "../trpc";
import { assertPermission } from "../utils/permissions";

const checklistSchema = z.object({
  publicId: z.string().length(12),
  name: z.string().min(1).max(255),
});

const checklistItemSchema = z.object({
  publicId: z.string().length(12),
  title: z.string().min(1).max(500),
  completed: z.boolean(),
});

export const checklistRouter = createTRPCRouter({
  create: protectedProcedure
    .meta({
      openapi: {
        summary: "Add a checklist to a card",
        method: "POST",
        path: "/cards/{cardPublicId}/checklists",
        description: "Adds a checklist to a card",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        cardPublicId: z.string().length(12),
        name: z.string().min(1).max(255),
      }),
    )
    .output(checklistSchema)
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const card = await cardRepo.getWorkspaceAndCardIdByCardPublicId(
        ctx.db,
        input.cardPublicId,
      );

      if (!card)
        throw new TRPCError({
          message: `Card with public ID ${input.cardPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, card.workspaceId, "card:edit");

      const newChecklist = await checklistRepo.create(ctx.db, {
        name: input.name,
        createdBy: userId,
        cardId: card.id,
      });

      if (!newChecklist?.id)
        throw new TRPCError({
          message: `Failed to create checklist`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.checklist.added",
        cardId: card.id,
        toTitle: newChecklist.name,
        createdBy: userId,
      });

      return newChecklist;
    }),
  update: protectedProcedure
    .input(
      z.object({
        checklistPublicId: z.string().length(12),
        name: z.string().min(1).max(255),
      }),
    )
    .output(z.object({ publicId: z.string().length(12), name: z.string() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;
      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const checklist = await checklistRepo.getChecklistByPublicId(
        ctx.db,
        input.checklistPublicId,
      );
      if (!checklist)
        throw new TRPCError({
          message: `Checklist with public ID ${input.checklistPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(
        ctx.db,
        userId,
        checklist.card.list.board.workspace.id,
        "card:edit",
      );

      const previousName = checklist.name;

      const updated = await checklistRepo.updateChecklistById(ctx.db, {
        id: checklist.id,
        name: input.name,
      });

      if (!updated)
        throw new TRPCError({
          message: `Failed to update checklist`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.checklist.renamed",
        cardId: checklist.cardId,
        fromTitle: previousName,
        toTitle: updated.name,
        createdBy: userId,
      });

      return updated;
    }),
  delete: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete a checklist",
        method: "DELETE",
        path: "/checklists/{checklistPublicId}",
        description: "Deletes a checklist by its public ID",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(z.object({ checklistPublicId: z.string().length(12) }))
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;
      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const checklist = await checklistRepo.getChecklistByPublicId(
        ctx.db,
        input.checklistPublicId,
      );
      if (!checklist)
        throw new TRPCError({
          message: `Checklist with public ID ${input.checklistPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(
        ctx.db,
        userId,
        checklist.card.list.board.workspace.id,
        "card:edit",
      );

      await checklistRepo.softDeleteAllItemsByChecklistId(ctx.db, {
        checklistId: checklist.id,
        deletedAt: new Date(),
        deletedBy: userId,
      });

      const deleted = await checklistRepo.softDeleteById(ctx.db, {
        id: checklist.id,
        deletedAt: new Date(),
        deletedBy: userId,
      });

      if (!deleted)
        throw new TRPCError({
          message: `Failed to delete checklist`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.checklist.deleted",
        cardId: checklist.cardId,
        fromTitle: checklist.name,
        createdBy: userId,
      });

      return { success: true };
    }),
  createItem: protectedProcedure
    .meta({
      openapi: {
        summary: "Add an item to a checklist",
        method: "POST",
        path: "/checklists/{checklistPublicId}/items",
        description: "Adds an item to a checklist",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        checklistPublicId: z.string().length(12),
        title: z.string().min(1).max(500),
      }),
    )
    .output(checklistItemSchema)
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const checklist = await checklistRepo.getChecklistByPublicId(
        ctx.db,
        input.checklistPublicId,
      );

      if (!checklist)
        throw new TRPCError({
          message: `Checklist with public ID ${input.checklistPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(
        ctx.db,
        userId,
        checklist.card.list.board.workspace.id,
        "card:edit",
      );

      const newChecklistItem = await checklistRepo.createItem(ctx.db, {
        title: input.title,
        createdBy: userId,
        checklistId: checklist.id,
      });

      if (!newChecklistItem?.id)
        throw new TRPCError({
          message: `Failed to create checklist item`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.checklist.item.added",
        cardId: checklist.cardId,
        toTitle: newChecklistItem.title,
        createdBy: userId,
      });

      return newChecklistItem;
    }),
  updateItem: protectedProcedure
    .meta({
      openapi: {
        summary: "Update a checklist item",
        method: "PATCH",
        path: "/checklists/items/{checklistItemPublicId}",
        description: "Updates a checklist item (title/completed)",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(
      z.object({
        checklistItemPublicId: z.string().length(12),
        title: z.string().min(1).max(500).optional(),
        completed: z.boolean().optional(),
        index: z.number().int().min(0).optional(),
      }),
    )
    .output(checklistItemSchema)
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const item = await checklistRepo.getChecklistItemByPublicIdWithChecklist(
        ctx.db,
        input.checklistItemPublicId,
      );

      if (!item)
        throw new TRPCError({
          message: `Checklist item with public ID ${input.checklistItemPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(
        ctx.db,
        userId,
        item.checklist.card.list.board.workspace.id,
        "card:edit",
      );

      const previousTitle = item.title;

        let updatedItem;

        if (input.title !== undefined || input.completed !== undefined) {
          updatedItem = await checklistRepo.updateItemById(ctx.db, {
            id: item.id,
            title: input.title,
            completed: input.completed,
          });
        }

        if (input.index !== undefined) {
          updatedItem = await checklistRepo.reorderItem(ctx.db, {
            itemId: item.id,
            newIndex: input.index,
          });
        }

        if (!updatedItem) {
          throw new TRPCError({
            message: `Failed to update checklist item`,
            code: "INTERNAL_SERVER_ERROR",
          });
        }


      // Log completion toggle
      if (input.completed !== undefined) {
        await cardActivityRepo.create(ctx.db, {
          type: input.completed
            ? "card.updated.checklist.item.completed"
            : "card.updated.checklist.item.uncompleted",
          cardId: item.checklist.cardId,
          toTitle: updatedItem.title,
          createdBy: userId,
        });
      }

      // Log title change
      if (input.title !== undefined && input.title !== previousTitle) {
        await cardActivityRepo.create(ctx.db, {
          type: "card.updated.checklist.item.updated",
          cardId: item.checklist.cardId,
          fromTitle: previousTitle,
          toTitle: updatedItem.title,
          createdBy: userId,
        });
      }

      return updatedItem;

    }),
  deleteItem: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete a checklist item",
        method: "DELETE",
        path: "/checklists/items/{checklistItemPublicId}",
        description: "Deletes a checklist item",
        tags: ["Cards"],
        protect: true,
      },
    })
    .input(z.object({ checklistItemPublicId: z.string().length(12) }))
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;
      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const item = await checklistRepo.getChecklistItemByPublicIdWithChecklist(
        ctx.db,
        input.checklistItemPublicId,
      );
      if (!item)
        throw new TRPCError({
          message: `Checklist item with public ID ${input.checklistItemPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(
        ctx.db,
        userId,
        item.checklist.card.list.board.workspace.id,
        "card:edit",
      );

      const deleted = await checklistRepo.softDeleteItemById(ctx.db, {
        id: item.id,
        deletedAt: new Date(),
        deletedBy: userId,
      });

      if (!deleted)
        throw new TRPCError({
          message: `Failed to delete item`,
          code: "INTERNAL_SERVER_ERROR",
        });

      await cardActivityRepo.create(ctx.db, {
        type: "card.updated.checklist.item.deleted",
        cardId: item.checklist.cardId,
        fromTitle: item.title,
        createdBy: userId,
      });

      return { success: true };
    }),
});



================================================
FILE: packages/api/src/routers/feedback.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as feedbackRepo from "@kan/db/repository/feedback.repo";

import { createTRPCRouter, protectedProcedure } from "../trpc";

export const feedbackRouter = createTRPCRouter({
  create: protectedProcedure
    .meta({
      enabled: false,
      openapi: { enabled: false, method: "POST", path: "/feedback" },
    })
    .input(
      z.object({
        feedback: z.string().min(1),
        url: z.string().min(1),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const result = await feedbackRepo.create(ctx.db, {
        feedback: input.feedback,
        createdBy: userId,
        url: input.url,
      });

      if (!result?.id)
        throw new TRPCError({
          message: `Unable to create workspace`,
          code: "INTERNAL_SERVER_ERROR",
        });

      return { success: true };
    }),
});



================================================
FILE: packages/api/src/routers/health.ts
================================================
import { HeadBucketCommand } from "@aws-sdk/client-s3";
import { TRPCError } from "@trpc/server";
import { sql } from "drizzle-orm";
import { env } from "next-runtime-env";
import { z } from "zod";

import type { dbClient } from "@kan/db/client";
import * as boardRepo from "@kan/db/repository/board.repo";
import * as cardRepo from "@kan/db/repository/card.repo";
import * as cardActivityRepo from "@kan/db/repository/cardActivity.repo";
import * as cardAttachmentRepo from "@kan/db/repository/cardAttachment.repo";
import * as cardCommentRepo from "@kan/db/repository/cardComment.repo";
import * as checklistRepo from "@kan/db/repository/checklist.repo";
import * as importRepo from "@kan/db/repository/import.repo";
import * as inviteLinkRepo from "@kan/db/repository/inviteLink.repo";
import * as labelRepo from "@kan/db/repository/label.repo";
import * as listRepo from "@kan/db/repository/list.repo";
import * as memberRepo from "@kan/db/repository/member.repo";
import * as userRepo from "@kan/db/repository/user.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";

import {
  adminProtectedProcedure,
  createTRPCRouter,
  publicProcedure,
} from "../trpc";
import { createS3Client } from "@kan/shared/utils";

const checkDatabaseConnection = async (db: dbClient) => {
  try {
    await db.execute(sql`SELECT 1`);
    return true;
  } catch {
    return false;
  }
};

const checkS3Connection = async () => {
  try {
    // Check if S3 is configured
    if (
      !process.env.S3_ENDPOINT ||
      !process.env.S3_ACCESS_KEY_ID ||
      !process.env.S3_SECRET_ACCESS_KEY
    ) {
      // S3 is optional, so return true if not configured
      return true;
    }

    const client = createS3Client();
    const avatarBucketName = env("NEXT_PUBLIC_AVATAR_BUCKET_NAME");
    const attachmentsBucketName = env("NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME");

    await client.send(new HeadBucketCommand({ Bucket: avatarBucketName }));
    await client.send(new HeadBucketCommand({ Bucket: attachmentsBucketName }));

    return true;
  } catch (error) {
    console.error(error);
    return false;
  }
};

export const healthRouter = createTRPCRouter({
  health: publicProcedure
    .meta({
      openapi: {
        method: "GET",
        path: "/health",
        summary: "Health check",
        description:
          "Returns the health status of the application and its dependencies",
        tags: ["Health"],
        protect: false,
      },
    })
    .input(z.void())
    .output(
      z.object({
        status: z.enum(["ok", "error"]),
        database: z.enum(["ok", "error"]).optional(),
        storage: z.enum(["ok", "error", "not_configured"]).optional(),
      }),
    )
    .query(async ({ ctx }) => {
      const dbHealthy = await checkDatabaseConnection(ctx.db);
      const s3Healthy = await checkS3Connection();
      const s3Configured = !!(
        process.env.S3_ENDPOINT &&
        process.env.S3_ACCESS_KEY_ID &&
        process.env.S3_SECRET_ACCESS_KEY
      );

      const database = dbHealthy ? "ok" : "error";
      const storage = !s3Configured
        ? "not_configured"
        : s3Healthy
          ? "ok"
          : "error";

      // Overall status is "ok" only if database is healthy and (storage is not configured or storage is healthy)
      const status = dbHealthy && (!s3Configured || s3Healthy) ? "ok" : "error";

      return {
        status,
        database,
        storage,
      };
    }),
  stats: adminProtectedProcedure
    .meta({
      openapi: {
        method: "GET",
        path: "/stats",
        summary: "Get statistics",
        description:
          "Returns statistics about the application (workspaces, users, cards, etc.)",
        tags: ["Health"],
        protect: true,
      },
    })
    .input(z.void())
    .output(
      z.object({
        users: z.number(),
        workspaces: z.number(),
        boards: z.number(),
        lists: z.number(),
        cards: z.number(),
        cardComments: z.number(),
        cardAttachments: z.number(),
        cardActivityLogs: z.number(),
        labels: z.number(),
        checklists: z.number(),
        checklistItems: z.number(),
        activeMembers: z.number(),
        activeInviteLinks: z.number(),
        imports: z.number(),
      }),
    )
    .query(async ({ ctx }) => {
      try {
        // Execute all count queries in parallel
        const [
          usersCount,
          workspacesCount,
          boardsCount,
          listsCount,
          cardsCount,
          cardCommentsCount,
          checklistItemsCount,
          checklistsCount,
          labelsCount,
          cardAttachmentsCount,
          cardActivitiesCount,
          activeMembersCount,
          activeInviteLinksCount,
          importsCount,
          cardActivityLogsCount,
        ] = await Promise.all([
          userRepo.getCount(ctx.db),
          workspaceRepo.getCount(ctx.db),
          boardRepo.getCount(ctx.db),
          listRepo.getCount(ctx.db),
          cardRepo.getCount(ctx.db),
          cardCommentRepo.getCount(ctx.db),
          checklistRepo.getCountItems(ctx.db),
          checklistRepo.getCount(ctx.db),
          labelRepo.getCount(ctx.db),
          cardAttachmentRepo.getCount(ctx.db),
          cardActivityRepo.getCount(ctx.db),
          memberRepo.getActiveCount(ctx.db),
          inviteLinkRepo.getActiveCount(ctx.db),
          importRepo.getCount(ctx.db),
          memberRepo.getActiveCount(ctx.db),
          cardActivityRepo.getCount(ctx.db),
        ]);

        return {
          users: usersCount,
          workspaces: workspacesCount,
          boards: boardsCount,
          lists: listsCount,
          cards: cardsCount,
          cardComments: cardCommentsCount,
          checklistItems: checklistItemsCount,
          checklists: checklistsCount,
          labels: labelsCount,
          cardAttachments: cardAttachmentsCount,
          cardActivities: cardActivitiesCount,
          activeMembers: activeMembersCount,
          activeInviteLinks: activeInviteLinksCount,
          imports: importsCount,
          cardActivityLogs: cardActivityLogsCount,
        };
      } catch (error) {
        throw new TRPCError({
          message: `Failed to retrieve statistics: ${error instanceof Error ? error.message : "Unknown error"}`,
          code: "INTERNAL_SERVER_ERROR",
        });
      }
    }),
});



================================================
FILE: packages/api/src/routers/import.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as boardRepo from "@kan/db/repository/board.repo";
import * as cardRepo from "@kan/db/repository/card.repo";
import * as cardActivityRepo from "@kan/db/repository/cardActivity.repo";
import * as checklistRepo from "@kan/db/repository/checklist.repo";
import * as importRepo from "@kan/db/repository/import.repo";
import * as integrationsRepo from "@kan/db/repository/integration.repo";
import * as labelRepo from "@kan/db/repository/label.repo";
import * as listRepo from "@kan/db/repository/list.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import { colours } from "@kan/shared/constants";
import { generateUID } from "@kan/shared/utils";

import { createTRPCRouter, protectedProcedure } from "../trpc";
import { assertPermission } from "../utils/permissions";
import { apiKeys, urls } from "./integration";

export interface TrelloBoard {
  id: string;
  name: string;
  labels: TrelloLabel[];
  lists: TrelloList[];
  cards: TrelloCard[];
  checklists: TrelloChecklist[];
}

interface TrelloLabel {
  id: string;
  name: string;
}

interface TrelloList {
  id: string;
  name: string;
}

interface TrelloChecklist {
  id: string;
  idCard: string;
  name: string;
  checkItems: TrelloCheckItem[];
}

interface TrelloCheckItem {
  id: string;
  name: string;
  state: "complete" | "incomplete";
  pos: number;
}

interface TrelloCard {
  id: string;
  name: string | null;
  desc: string;
  idList: string;
  labels: TrelloLabel[];
  idChecklists: string[];
  checkItemStates: TrelloCheckItemState[];
}

interface TrelloCheckItemState {
  idChecklist: string;
  idCheckItem: string;
  state: "complete" | "incomplete";
}

export const importRouter = createTRPCRouter({
  trello: createTRPCRouter({
    getBoards: protectedProcedure
      .meta({
        openapi: {
          summary: "Get boards from Trello",
          method: "GET",
          path: "/integrations/trello/boards",
          description: "Retrieves all boards from Trello",
          tags: ["Integrations"],
          protect: true,
        },
      })
      .input(z.void())
      .output(z.array(z.object({ id: z.string(), name: z.string() })))
      .query(async ({ ctx }) => {
        const apiKey = apiKeys.trello;

        if (!apiKey)
          throw new TRPCError({
            message: "Trello API key not found",
            code: "INTERNAL_SERVER_ERROR",
          });

        const user = ctx.user;

        if (!user)
          throw new TRPCError({
            message: "User not authenticated",
            code: "UNAUTHORIZED",
          });

        const integration = await integrationsRepo.getProviderForUser(
          ctx.db,
          user.id,
          "trello",
        );

        const token = integration?.accessToken;

        if (!token)
          throw new TRPCError({
            message: "Trello token not found",
            code: "UNAUTHORIZED",
          });

        const response = await fetch(
          `${urls.trello}/members/me/boards?key=${apiKey}&token=${token}`,
        );

        const data = (await response.json()) as TrelloBoard[];

        return data.map((board) => ({
          id: board.id,
          name: board.name,
        }));
      }),
    importBoards: protectedProcedure
      .meta({
        openapi: {
          summary: "Import boards from Trello",
          method: "POST",
          path: "/imports/trello/boards",
          description: "Imports boards from Trello",
          tags: ["Imports"],
          protect: true,
        },
      })
      .input(
        z.object({
          boardIds: z.array(z.string()),
          workspacePublicId: z.string().min(12),
        }),
      )
      .output(z.object({ boardsCreated: z.number() }))
      .mutation(async ({ ctx, input }) => {
        const userId = ctx.user?.id;

        const apiKey = apiKeys.trello;

        if (!apiKey)
          throw new TRPCError({
            message: "Trello API key not found",
            code: "INTERNAL_SERVER_ERROR",
          });

        if (!userId)
          throw new TRPCError({
            message: `User not authenticated`,
            code: "UNAUTHORIZED",
          });

        const integration = await integrationsRepo.getProviderForUser(
          ctx.db,
          userId,
          "trello",
        );

        if (!integration)
          throw new TRPCError({
            message: "Trello token not found",
            code: "UNAUTHORIZED",
          });

        const workspace = await workspaceRepo.getByPublicId(
          ctx.db,
          input.workspacePublicId,
        );

        if (!workspace)
          throw new TRPCError({
            message: `Workspace with public ID ${input.workspacePublicId} not found`,
            code: "NOT_FOUND",
          });
        await assertPermission(ctx.db, userId, workspace.id, "board:create");

        const newImport = await importRepo.create(ctx.db, {
          source: "trello",
          createdBy: userId,
        });

        const newImportId = newImport?.id;

        let boardsCreated = 0;

        for (const boardId of input.boardIds) {
          const response = await fetch(
            `${urls.trello}/boards/${boardId}?key=${apiKey}&token=${integration.accessToken}&lists=open&cards=open&labels=all&checklists=all&checkItemStates=all`,
          );
          const data = (await response.json()) as TrelloBoard;

          const formattedData = {
            name: data.name,
            labels: data.labels
              .map((label) => ({
                sourceId: label.id,
                name: label.name,
              }))
              .filter((_label) => !!_label.name),
            lists: data.lists.map((list) => ({
              name: list.name,
              cards: data.cards
                .filter((card) => card.idList === list.id)
                .map((_card) => ({
                  sourceId: _card.id,
                  name: _card.name,
                  description: _card.desc,
                  labels: _card.labels.map((label) => ({
                    sourceId: label.id,
                    name: label.name,
                  })),
                  checklists: data.checklists
                    .filter((checklist) => checklist.idCard === _card.id)
                    .map((_checklist) => ({
                      sourceId: _checklist.id,
                      name: _checklist.name,
                      items: _checklist.checkItems.map((_item) => ({
                        sourceId: _item.id,
                        title: _item.name,
                        completed: _item.state === "complete",
                        index: _item.pos,
                      })),
                    })),
                })),
            })),
          };

          const boardPublicId = generateUID();

          const newBoard = await boardRepo.create(ctx.db, {
            publicId: boardPublicId,
            name: formattedData.name,
            slug: boardPublicId,
            createdBy: userId,
            importId: newImportId,
            workspaceId: workspace.id,
          });

          const newBoardId = newBoard?.id;

          if (!newBoardId)
            throw new TRPCError({
              message: "Failed to create new board",
              code: "INTERNAL_SERVER_ERROR",
            });

          let createdLabels: { id: number; sourceId: string }[] = [];
          let createdCards: { id: number; sourceId: string }[] = [];

          if (formattedData.labels.length) {
            const labelsInsert = formattedData.labels.map((label, index) => ({
              publicId: generateUID(),
              name: label.name,
              colourCode: colours[index % colours.length]?.code ?? "#0d9488",
              createdBy: userId,
              boardId: newBoardId,
              importId: newImportId,
            }));

            const newLabels = await labelRepo.bulkCreate(ctx.db, labelsInsert);

            if (newLabels.length)
              createdLabels = newLabels
                .map((label, index) => ({
                  id: label.id,
                  sourceId: formattedData.labels[index]?.sourceId ?? "",
                }))
                .filter((label) => !!label.sourceId);
          }

          for (const list of formattedData.lists) {
            const newList = await listRepo.create(ctx.db, {
              name: list.name,
              createdBy: userId,
              boardId: newBoardId,
              importId: newImportId,
            });

            const newListId = newList.id;

            if (list.cards.length && newListId) {
              const cardsInsert = list.cards.map((card, index) => ({
                publicId: generateUID(),
                title: (card.name?.trim() ?? "Untitled Card").slice(0, 2000),
                description: card.description,
                createdBy: userId,
                listId: newListId,
                index,
                importId: newImportId,
              }));

              const newCards = await cardRepo.bulkCreate(ctx.db, cardsInsert);

              if (!newCards.length)
                throw new TRPCError({
                  message: "Failed to create new cards",
                  code: "INTERNAL_SERVER_ERROR",
                });

              createdCards = createdCards.concat(
                newCards
                  .map((card, index) => ({
                    id: card.id,
                    sourceId: list.cards[index]?.sourceId ?? "",
                  }))
                  .filter((card) => !!card.sourceId),
              );

              const activities = newCards.map((card) => ({
                type: "card.created" as const,
                cardId: card.id,
                createdBy: userId,
              }));

              if (newCards.length > 0) {
                await cardActivityRepo.bulkCreate(ctx.db, activities);
              }

              const checklistsToCreate: {
                cardId: number;
                name: string;
                createdBy: string;
                index: number;
                sourceId: string;
                items: {
                  sourceId: string;
                  title: string;
                  completed: boolean;
                  index: number;
                }[];
              }[] = [];

              for (const card of list.cards) {
                const _card = createdCards.find(
                  (c) => c.sourceId === card.sourceId,
                );

                if (!_card || !card.checklists.length) continue;

                for (
                  let checklistIndex = 0;
                  checklistIndex < card.checklists.length;
                  checklistIndex++
                ) {
                  const checklist = card.checklists[checklistIndex];
                  if (!checklist) continue;

                  checklistsToCreate.push({
                    cardId: _card.id,
                    name: checklist.name,
                    createdBy: userId,
                    index: checklistIndex,
                    sourceId: checklist.sourceId,
                    items: checklist.items.map((item) => ({
                      sourceId: item.sourceId,
                      title: item.title,
                      completed: item.completed,
                      index: item.index,
                    })),
                  });
                }
              }

              if (checklistsToCreate.length > 0) {
                const newChecklists = await checklistRepo.bulkCreate(
                  ctx.db,
                  checklistsToCreate.map((checklist) => ({
                    cardId: checklist.cardId,
                    name: checklist.name,
                    createdBy: checklist.createdBy,
                    index: checklist.index,
                  })),
                );

                const itemsToCreate: {
                  checklistId: number;
                  title: string;
                  createdBy: string;
                  index: number;
                  completed: boolean;
                }[] = [];

                for (let i = 0; i < checklistsToCreate.length; i++) {
                  const checklistData = checklistsToCreate[i];
                  const newChecklist = newChecklists[i];

                  if (!newChecklist || !checklistData?.items.length) continue;

                  // NOTE: Sorting here to prevent checklist items being out of order
                  const sortedItems = [...checklistData.items].sort(
                    (a, b) => a.index - b.index,
                  );

                  for (const item of sortedItems) {
                    itemsToCreate.push({
                      checklistId: newChecklist.id,
                      title: item.title,
                      createdBy: userId,
                      index: item.index,
                      completed: item.completed,
                    });
                  }
                }

                if (itemsToCreate.length > 0) {
                  await checklistRepo.bulkCreateItems(ctx.db, itemsToCreate);
                }
              }

              if (createdLabels.length && createdCards.length) {
                const cardLabelRelations: {
                  cardId: number;
                  labelId: number;
                }[] = [];

                for (const card of list.cards) {
                  const _card = createdCards.find(
                    (c) => c.sourceId === card.sourceId,
                  );

                  for (const label of card.labels) {
                    const _label = createdLabels.find(
                      (l) => l.sourceId === label.sourceId,
                    );

                    if (_card && _label) {
                      cardLabelRelations.push({
                        cardId: _card.id,
                        labelId: _label.id,
                      });
                    }
                  }
                }

                if (cardLabelRelations.length) {
                  await cardRepo.bulkCreateCardLabelRelationship(
                    ctx.db,
                    cardLabelRelations,
                  );
                }
              }
            }
          }

          boardsCreated++;
        }

        if (boardsCreated > 0 && newImportId) {
          await importRepo.update(
            ctx.db,
            { status: "success" },
            { importId: newImport.id },
          );
        }

        return { boardsCreated };
      }),
  }),
});



================================================
FILE: packages/api/src/routers/integration.ts
================================================
import { TRPCError } from "@trpc/server";
import { env } from "next-runtime-env";
import { z } from "zod";

import * as integrationsRepo from "@kan/db/repository/integration.repo";

import { createTRPCRouter, protectedProcedure } from "../trpc";

export const urls = {
  trello: "https://api.trello.com/1",
};

export const apiKeys = {
  trello: process.env.TRELLO_APP_API_KEY,
};

export const integrationRouter = createTRPCRouter({
  providers: protectedProcedure
    .meta({
      openapi: {
        summary: "Get integration providers",
        method: "GET",
        path: "/integration/providers",
        description: "Retrieves all integration providers for the user",
        tags: ["Integration"],
        protect: true,
      },
    })
    .input(z.void())
    .output(
      z.array(
        z.object({
          expiresAt: z.date(),
          createdAt: z.date(),
          updatedAt: z.date().nullable(),
          userId: z.string(),
          accessToken: z.string(),
          refreshToken: z.string().nullable(),
          provider: z.string(),
        }),
      ),
    )
    .query(async ({ ctx }) => {
      const user = ctx.user;

      if (!user)
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });

      const integrations = await integrationsRepo.getProvidersForUser(
        ctx.db,
        user.id,
      );

      return integrations;
    }),
  disconnect: protectedProcedure
    .meta({
      openapi: {
        summary: "Disconnect integration",
        method: "POST",
        path: "/integration/disconnect",
        description: "Disconnects an integration",
        tags: ["Integration"],
        protect: true,
      },
    })
    .input(z.object({ provider: z.enum(["trello"]) }))
    .output(z.object({}))
    .mutation(async ({ ctx, input }) => {
      const user = ctx.user;

      if (!user)
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });

      const integration = await integrationsRepo.getProviderForUser(
        ctx.db,
        user.id,
        input.provider,
      );

      if (!integration)
        throw new TRPCError({
          message: "Integration not found",
          code: "NOT_FOUND",
        });

      await integrationsRepo.deleteProviderForUser(
        ctx.db,
        user.id,
        input.provider,
      );

      return {};
    }),
  getAuthorizationUrl: protectedProcedure
    .meta({
      openapi: {
        summary: "Get authorization URL for an integration",
        method: "GET",
        path: "/integration/authorize",
        description: "Retrieves the authorization URL for an integration",
        tags: ["Integration"],
        protect: true,
      },
    })
    .input(z.object({ provider: z.enum(["trello"]) }))
    .output(z.object({ url: z.string() }))
    .query(async ({ ctx, input }) => {
      const apiKey = apiKeys[input.provider];

      if (!apiKey)
        throw new TRPCError({
          message: `${input.provider.at(0)?.toUpperCase() + input.provider.slice(1)} API key not set in environment variables`,
          code: "INTERNAL_SERVER_ERROR",
        });

      const user = ctx.user;

      if (!user)
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });

      const integration = await integrationsRepo.getProviderForUser(
        ctx.db,
        user.id,
        input.provider,
      );

      if (integration)
        throw new TRPCError({
          message: `${input.provider.at(0)?.toUpperCase() + input.provider.slice(1)} integration already exists`,
          code: "BAD_REQUEST",
        });

      if (input.provider === "trello") {
        const url = `${urls[input.provider]}/authorize?key=${apiKey}&expiration=never&response_type=token&scope=read&return_url=${env("NEXT_PUBLIC_BASE_URL")}/settings/trello/authorize&callback_method=fragment`;
        return { url };
      }

      throw new TRPCError({
        message: "Invalid provider",
        code: "BAD_REQUEST",
      });
    }),
});



================================================
FILE: packages/api/src/routers/label.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as boardRepo from "@kan/db/repository/board.repo";
import * as cardRepo from "@kan/db/repository/card.repo";
import * as labelRepo from "@kan/db/repository/label.repo";

import { createTRPCRouter, protectedProcedure } from "../trpc";
import { assertPermission } from "../utils/permissions";

const labelSchema = z.object({
  publicId: z.string(),
  name: z.string(),
  colourCode: z.string().nullable(),
});

export const labelRouter = createTRPCRouter({
  byPublicId: protectedProcedure
    .meta({
      openapi: {
        summary: "Get a label by public ID",
        method: "GET",
        path: "/labels/{labelPublicId}",
        description: "Retrieves a label by its public ID",
        tags: ["Labels"],
        protect: true,
      },
    })
    .input(z.object({ labelPublicId: z.string().min(12) }))
    .output(labelSchema)
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const label = await labelRepo.getWorkspaceAndLabelIdByLabelPublicId(
        ctx.db,
        input.labelPublicId,
      );

      if (!label)
        throw new TRPCError({
          message: `Label with public ID ${input.labelPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, label.workspaceId, "board:view");

      const result = await labelRepo.getByPublicId(ctx.db, input.labelPublicId);

      if (!result)
        throw new TRPCError({
          message: `Label with public ID ${input.labelPublicId} not found`,
          code: "NOT_FOUND",
        });

      return {
        publicId: result.publicId,
        name: result.name,
        colourCode: result.colourCode,
      };
    }),
  create: protectedProcedure
    .meta({
      openapi: {
        summary: "Create a label",
        method: "POST",
        path: "/labels",
        description: "Creates a new label",
        tags: ["Labels"],
        protect: true,
      },
    })
    .input(
      z.object({
        name: z.string().min(1).max(36),
        boardPublicId: z.string().min(12),
        colourCode: z.string().length(7),
      }),
    )
    .output(labelSchema)
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const board = await boardRepo.getWorkspaceAndBoardIdByBoardPublicId(
        ctx.db,
        input.boardPublicId,
      );

      if (!board)
        throw new TRPCError({
          message: `Board with public ID ${input.boardPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, board.workspaceId, "board:edit");

      const result = await labelRepo.create(ctx.db, {
        name: input.name,
        colourCode: input.colourCode,
        createdBy: userId,
        boardId: board.id,
      });

      if (!result)
        throw new TRPCError({
          message: `Failed to create label`,
          code: "INTERNAL_SERVER_ERROR",
        });

      return {
        publicId: result.publicId,
        name: result.name,
        colourCode: result.colourCode,
      };
    }),
  update: protectedProcedure
    .meta({
      openapi: {
        summary: "Update a label",
        method: "PUT",
        path: "/labels/{labelPublicId}",
        description: "Updates a label by its public ID",
        tags: ["Labels"],
        protect: true,
      },
    })
    .input(
      z.object({
        labelPublicId: z.string().min(12),
        name: z.string().min(1).max(36),
        colourCode: z.string().length(7),
      }),
    )
    .output(labelSchema)
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const label = await labelRepo.getWorkspaceAndLabelIdByLabelPublicId(
        ctx.db,
        input.labelPublicId,
      );

      if (!label)
        throw new TRPCError({
          message: `Label with public ID ${input.labelPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, label.workspaceId, "board:edit");

      const result = await labelRepo.update(ctx.db, input);

      if (!result)
        throw new TRPCError({
          message: `Failed to update label`,
          code: "INTERNAL_SERVER_ERROR",
        });

      return {
        publicId: result.publicId,
        name: result.name,
        colourCode: result.colourCode,
      };
    }),
  delete: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete a label",
        method: "DELETE",
        path: "/labels/{labelPublicId}",
        description: "Deletes a label by its public ID",
        tags: ["Labels"],
        protect: true,
      },
    })
    .input(z.object({ labelPublicId: z.string().min(12) }))
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const label = await labelRepo.getWorkspaceAndLabelIdByLabelPublicId(
        ctx.db,
        input.labelPublicId,
      );

      if (!label)
        throw new TRPCError({
          message: `Label with public ID ${input.labelPublicId} not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, label.workspaceId, "board:edit");

      await cardRepo.hardDeleteAllCardLabelRelationships(ctx.db, label.id);

      await labelRepo.softDelete(ctx.db, {
        labelId: label.id,
        deletedAt: new Date(),
        deletedBy: userId,
      });

      return { success: true };
    }),
});



================================================
FILE: packages/api/src/routers/list.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as boardRepo from "@kan/db/repository/board.repo";
import * as cardRepo from "@kan/db/repository/card.repo";
import * as activityRepo from "@kan/db/repository/cardActivity.repo";
import * as listRepo from "@kan/db/repository/list.repo";

import { createTRPCRouter, protectedProcedure } from "../trpc";
import { assertCanDelete, assertCanEdit, assertPermission } from "../utils/permissions";

export const listRouter = createTRPCRouter({
  create: protectedProcedure
    .meta({
      openapi: {
        summary: "Create a list",
        method: "POST",
        path: "/lists",
        description: "Creates a new list for a given board",
        tags: ["Lists"],
        protect: true,
      },
    })
    .input(
      z.object({
        name: z.string().min(1),
        boardPublicId: z.string().min(12),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof listRepo.create>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const board = await boardRepo.getWorkspaceAndBoardIdByBoardPublicId(
        ctx.db,
        input.boardPublicId,
      );

      if (!board)
        throw new TRPCError({
          message: `Board with public ID ${input.boardPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, board.workspaceId, "list:create");

      const result = await listRepo.create(ctx.db, {
        name: input.name,
        createdBy: userId,
        boardId: board.id,
      });

      if (!result)
        throw new TRPCError({
          message: `Failed to create list`,
          code: "INTERNAL_SERVER_ERROR",
        });

      return result;
    }),
  delete: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete a list",
        method: "DELETE",
        path: "/lists/{listPublicId}",
        description: "Deletes a list by its public ID",
        tags: ["Lists"],
        protect: true,
      },
    })
    .input(
      z.object({
        listPublicId: z.string().min(12),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const list = await listRepo.getWorkspaceAndListIdByListPublicId(
        ctx.db,
        input.listPublicId,
      );

      if (!list)
        throw new TRPCError({
          message: `List with public ID ${input.listPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertCanDelete(
        ctx.db,
        userId,
        list.workspaceId,
        "list:delete",
        list.createdBy,
      );

      const deletedAt = new Date();

      const deletedList = await listRepo.softDeleteById(ctx.db, {
        listId: list.id,
        deletedAt,
        deletedBy: userId,
      });

      if (!deletedList)
        throw new TRPCError({
          message: `Failed to delete list`,
          code: "INTERNAL_SERVER_ERROR",
        });

      const deletedCards = await cardRepo.softDeleteAllByListIds(ctx.db, {
        listIds: [list.id],
        deletedAt,
        deletedBy: userId,
      });

      if (!Array.isArray(deletedCards))
        throw new TRPCError({
          message: `Failed to delete cards`,
          code: "INTERNAL_SERVER_ERROR",
        });

      const activities = deletedCards.map((card) => ({
        type: "card.archived" as const,
        createdBy: userId,
        cardId: card.id,
      }));

      if (activities.length) await activityRepo.bulkCreate(ctx.db, activities);

      return { success: true };
    }),
  update: protectedProcedure
    .meta({
      openapi: {
        summary: "Update a list",
        method: "PUT",
        path: "/lists/{listPublicId}",
        description: "Updates a list by its public ID",
        tags: ["Lists"],
        protect: true,
      },
    })
    .input(
      z.object({
        listPublicId: z.string().min(12),
        name: z.string().min(1).optional(),
        index: z.number().optional(),
      }),
    )
    .output(
      z.custom<
        | Awaited<ReturnType<typeof listRepo.update>>
        | Awaited<ReturnType<typeof listRepo.reorder>>
      >(),
    )
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const list = await listRepo.getWorkspaceAndListIdByListPublicId(
        ctx.db,
        input.listPublicId,
      );

      if (!list)
        throw new TRPCError({
          message: `List with public ID ${input.listPublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertCanEdit(
        ctx.db,
        userId,
        list.workspaceId,
        "list:edit",
        list.createdBy,
      );

      let result: { name: string; publicId: string } | undefined;

      if (input.name) {
        result = await listRepo.update(
          ctx.db,
          { name: input.name },
          { listPublicId: input.listPublicId },
        );
      }

      if (input.index !== undefined) {
        result = await listRepo.reorder(ctx.db, {
          listPublicId: input.listPublicId,
          newIndex: input.index,
        });
      }

      if (!result)
        throw new TRPCError({
          message: `Failed to update list`,
          code: "INTERNAL_SERVER_ERROR",
        });

      return result;
    }),
});



================================================
FILE: packages/api/src/routers/member.ts
================================================
import { TRPCError } from "@trpc/server";
import { env } from "next-runtime-env";
import { z } from "zod";

import * as inviteLinkRepo from "@kan/db/repository/inviteLink.repo";
import * as memberRepo from "@kan/db/repository/member.repo";
import * as permissionRepo from "@kan/db/repository/permission.repo";
import * as subscriptionRepo from "@kan/db/repository/subscription.repo";
import * as userRepo from "@kan/db/repository/user.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import {
  generateUID,
  getSubscriptionByPlan,
  hasUnlimitedSeats,
} from "@kan/shared";
import { updateSubscriptionSeats } from "@kan/stripe";

import { createTRPCRouter, protectedProcedure, publicProcedure } from "../trpc";
import {
  assertCanManageMember,
  assertCanManageRole,
  assertPermission,
} from "../utils/permissions";

export const memberRouter = createTRPCRouter({
  invite: protectedProcedure
    .meta({
      openapi: {
        summary: "Invite a member to a workspace",
        method: "POST",
        path: "/workspaces/{workspacePublicId}/members/invite",
        description: "Invites a member to a workspace",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(
      z.object({
        email: z.string().email(),
        workspacePublicId: z.string().min(12),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof memberRepo.create>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicIdWithMembers(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace with public ID ${input.workspacePublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, workspace.id, "member:invite");

      const isInvitedEmailAlreadyMember = workspace.members.some(
        (member) => member.email === input.email,
      );

      if (isInvitedEmailAlreadyMember) {
        throw new TRPCError({
          message: `User with email ${input.email} is already a member of this workspace`,
          code: "CONFLICT",
        });
      }

      if (process.env.NEXT_PUBLIC_KAN_ENV === "cloud") {
        const subscriptions = await subscriptionRepo.getByReferenceId(
          ctx.db,
          workspace.publicId,
        );

        // get the active subscriptions
        const activeTeamSubscription = getSubscriptionByPlan(
          subscriptions,
          "team",
        );
        const activeProSubscription = getSubscriptionByPlan(
          subscriptions,
          "pro",
        );
        const unlimitedSeats = hasUnlimitedSeats(subscriptions);

        if (!activeTeamSubscription && !activeProSubscription) {
          throw new TRPCError({
            message: `Workspace with public ID ${workspace.publicId} does not have an active subscription`,
            code: "NOT_FOUND",
          });
        }

        // Update the Stripe subscription
        if (activeTeamSubscription?.stripeSubscriptionId && !unlimitedSeats) {
          try {
            await updateSubscriptionSeats(
              activeTeamSubscription.stripeSubscriptionId,
              1,
            );
          } catch (error) {
            console.error("Failed to update Stripe subscription seats:", error);
            throw new TRPCError({
              message: `Failed to update subscription for the new member.`,
              code: "INTERNAL_SERVER_ERROR",
            });
          }
        }
      }

      const existingUser = await userRepo.getByEmail(ctx.db, input.email);

      // Get the workspace role to set roleId
      const memberRole = await permissionRepo.getRoleByWorkspaceIdAndName(
        ctx.db,
        workspace.id,
        "member",
      );

      const invite = await memberRepo.create(ctx.db, {
        workspaceId: workspace.id,
        email: input.email,
        userId: existingUser?.id ?? null,
        createdBy: userId,
        role: "member",
        roleId: memberRole?.id ?? null,
        status: "invited",
      });

      if (!invite)
        throw new TRPCError({
          message: `Unable to invite user with email ${input.email}`,
          code: "INTERNAL_SERVER_ERROR",
        });

      const { status } = await ctx.auth.api.signInMagicLink({
        email: input.email,
        callbackURL: `/boards?type=invite&memberPublicId=${invite.publicId}`,
      });

      if (!status) {
        console.error("Failed to send magic link invitation:", {
          email: input.email,
          callbackURL: `/boards?type=invite&memberPublicId=${invite.publicId}`,
        });

        await memberRepo.softDelete(ctx.db, {
          memberId: invite.id,
          deletedAt: new Date(),
          deletedBy: userId,
        });

        throw new TRPCError({
          message: `Failed to send magic link invitation to user with email ${input.email}.`,
          code: "INTERNAL_SERVER_ERROR",
        });
      }

      return invite;
    }),
  delete: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete a member from a workspace",
        method: "DELETE",
        path: "/workspaces/{workspacePublicId}/members/{memberPublicId}",
        description: "Deletes a member from a workspace",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        memberPublicId: z.string().min(12),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace with public ID ${input.workspacePublicId} not found`,
          code: "NOT_FOUND",
        });

      await assertPermission(ctx.db, userId, workspace.id, "member:remove");

      const member = await memberRepo.getByPublicId(
        ctx.db,
        input.memberPublicId,
      );

      if (!member)
        throw new TRPCError({
          message: `Member with public ID ${input.memberPublicId} not found`,
          code: "NOT_FOUND",
        });

      const deletedMember = await memberRepo.softDelete(ctx.db, {
        memberId: member.id,
        deletedAt: new Date(),
        deletedBy: userId,
      });

      if (!deletedMember)
        throw new TRPCError({
          message: `Failed to delete member with public ID ${input.memberPublicId}`,
          code: "INTERNAL_SERVER_ERROR",
        });

      // Handle subscription seat decrement for cloud environment
      if (process.env.NEXT_PUBLIC_KAN_ENV === "cloud") {
        const subscriptions = await subscriptionRepo.getByReferenceId(
          ctx.db,
          workspace.publicId,
        );

        // get the active subscriptions
        const activeTeamSubscription = getSubscriptionByPlan(
          subscriptions,
          "team",
        );
        const unlimitedSeats = hasUnlimitedSeats(subscriptions);

        // Only decrease seats if there's an active subscription and stripeSubscriptionId
        if (activeTeamSubscription?.stripeSubscriptionId && !unlimitedSeats) {
          try {
            await updateSubscriptionSeats(
              activeTeamSubscription.stripeSubscriptionId,
              -1,
            );
          } catch (error) {
            console.error(
              "Failed to decrease Stripe subscription seats:",
              error,
            );
          }
        }
      }

      return { success: true };
    }),
  getActiveInviteLink: protectedProcedure
    .meta({
      openapi: {
        summary: "Get active invite link for workspace",
        method: "GET",
        path: "/workspaces/{workspacePublicId}/invite",
        description: "Gets the active invite link for a workspace",
        tags: ["Invites"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        id: z.number().optional(),
        inviteCode: z.string().optional(),
        inviteLink: z.string().optional(),
        isActive: z.boolean(),
        expiresAt: z.date().optional(),
      }),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });

      // Check if user can view members
      await assertPermission(ctx.db, userId, workspace.id, "member:view");

      // Get active invite link for this workspace
      const activeInviteLink = await inviteLinkRepo.getActiveForWorkspace(
        ctx.db,
        workspace.id,
      );

      if (
        activeInviteLink &&
        (!activeInviteLink.expiresAt || new Date() < activeInviteLink.expiresAt)
      ) {
        return {
          id: activeInviteLink.id,
          inviteCode: activeInviteLink.code,
          inviteLink: `${env("NEXT_PUBLIC_BASE_URL")}/invite/${activeInviteLink.code}`,
          isActive: true,
          expiresAt: activeInviteLink.expiresAt ?? undefined,
        };
      }

      return { isActive: false };
    }),
  createInviteLink: protectedProcedure
    .meta({
      openapi: {
        summary: "Create invite link for workspace",
        method: "POST",
        path: "/workspaces/{workspacePublicId}/invites",
        description: "Create invite link for a workspace",
        tags: ["Invites"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        publicId: z.string().min(12),
        inviteCode: z.string(),
        inviteLink: z.string(),
        expiresAt: z.date().nullable(),
      }),
    )
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });

      // Check if user can edit members (admin-equivalent)
      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      // Check subscription for cloud environment
      if (process.env.NEXT_PUBLIC_KAN_ENV === "cloud") {
        const subscriptions = await subscriptionRepo.getByReferenceId(
          ctx.db,
          workspace.publicId,
        );

        const activeTeamSubscription = getSubscriptionByPlan(
          subscriptions,
          "team",
        );
        const activeProSubscription = getSubscriptionByPlan(
          subscriptions,
          "pro",
        );

        if (!activeTeamSubscription && !activeProSubscription) {
          throw new TRPCError({
            message: `Invite links require a Team or Pro subscription`,
            code: "FORBIDDEN",
          });
        }
      }

      // Deactivate any existing active invite links
      await inviteLinkRepo.deactivateAllActiveForWorkspace(ctx.db, {
        workspaceId: workspace.id,
        updatedBy: userId,
      });

      // Generate new invite code
      const inviteCode = generateUID();
      const expiresAt = new Date();
      expiresAt.setDate(expiresAt.getDate() + 7);

      // Create new invite link
      const inviteLink = await inviteLinkRepo.createInviteLink(ctx.db, {
        workspaceId: workspace.id,
        code: inviteCode,
        expiresAt,
        createdBy: userId,
      });

      if (!inviteLink) {
        throw new TRPCError({
          message: `Failed to create invite link`,
          code: "INTERNAL_SERVER_ERROR",
        });
      }

      return {
        publicId: inviteLink.publicId,
        inviteCode: inviteLink.code,
        inviteLink: `${env("NEXT_PUBLIC_BASE_URL")}/invite/${inviteLink.code}`,
        expiresAt: inviteLink.expiresAt,
      };
    }),
  deactivateInviteLink: protectedProcedure
    .meta({
      openapi: {
        summary: "Deactivate invite link for workspace",
        method: "DELETE",
        path: "/workspaces/{workspacePublicId}/invites",
        description: "Deactivates the invite link for a workspace",
        tags: ["Invites"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        success: z.boolean(),
      }),
    )
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });

      // Check if user can edit members (admin-equivalent)
      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      // Deactivate all active invite links
      await inviteLinkRepo.deactivateAllActiveForWorkspace(ctx.db, {
        workspaceId: workspace.id,
        updatedBy: userId,
      });

      return { success: true };
    }),
  getInviteByCode: publicProcedure
    .meta({
      openapi: {
        summary: "Get invite information by code",
        method: "GET",
        path: "/invites/{inviteCode}",
        description: "Get invite information by invite code",
        tags: ["Invites"],
        protect: false,
      },
    })
    .input(
      z.object({
        inviteCode: z.string().min(12),
      }),
    )
    .output(
      z
        .object({
          publicId: z.string().min(12),
          status: z.string(),
          expiresAt: z.date().nullable(),
        })
        .optional(),
    )
    .query(async ({ ctx, input }) => {
      const invite = await inviteLinkRepo.getByCode(ctx.db, input.inviteCode);

      if (
        !invite ||
        invite.status !== "active" ||
        (invite.expiresAt && new Date() > invite.expiresAt)
      ) {
        throw new TRPCError({
          message: `Invalid or expired invite link`,
          code: "BAD_REQUEST",
        });
      }

      return {
        publicId: invite.publicId,
        status: invite.status,
        expiresAt: invite.expiresAt ?? null,
      };
    }),
  acceptInviteLink: publicProcedure
    .meta({
      openapi: {
        summary: "Accept an invite link",
        method: "POST",
        path: "/invites/accept",
        description: "Accepts an invitation via invite link",
        tags: ["Invites"],
        protect: false,
      },
    })
    .input(
      z.object({
        inviteCode: z.string().min(12),
      }),
    )
    .output(
      z.object({
        success: z.boolean(),
        workspacePublicId: z.string().optional(),
        workspaceSlug: z.string().optional(),
      }),
    )
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const invite = await inviteLinkRepo.getByCode(ctx.db, input.inviteCode);

      if (
        !invite ||
        invite.status !== "active" ||
        (invite.expiresAt && new Date() > invite.expiresAt)
      )
        throw new TRPCError({
          message: `Invalid or expired invite link`,
          code: "BAD_REQUEST",
        });

      const workspace = await workspaceRepo.getById(ctx.db, invite.workspaceId);

      if (!workspace)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });

      const isMember = await workspaceRepo.isUserInWorkspace(
        ctx.db,
        userId,
        invite.workspaceId,
      );

      if (isMember) {
        throw new TRPCError({
          message: `User is already a member of this workspace`,
          code: "CONFLICT",
        });
      }

      const user = await userRepo.getById(ctx.db, userId);

      if (!user)
        throw new TRPCError({
          message: `User not found`,
          code: "NOT_FOUND",
        });

      if (process.env.NEXT_PUBLIC_KAN_ENV === "cloud") {
        const subscriptions = await subscriptionRepo.getByReferenceId(
          ctx.db,
          workspace.publicId,
        );

        // get the active subscriptions
        const activeTeamSubscription = getSubscriptionByPlan(
          subscriptions,
          "team",
        );
        const activeProSubscription = getSubscriptionByPlan(
          subscriptions,
          "pro",
        );
        const unlimitedSeats = hasUnlimitedSeats(subscriptions);

        if (!activeTeamSubscription && !activeProSubscription) {
          throw new TRPCError({
            message: `Workspace with public ID ${workspace.publicId} does not have an active subscription`,
            code: "NOT_FOUND",
          });
        }

        // Update the Stripe subscription
        if (activeTeamSubscription?.stripeSubscriptionId && !unlimitedSeats) {
          try {
            await updateSubscriptionSeats(
              activeTeamSubscription.stripeSubscriptionId,
              1,
            );
          } catch (error) {
            console.error("Failed to update Stripe subscription seats:", error);
            throw new TRPCError({
              message: `Failed to update subscription for the new member.`,
              code: "INTERNAL_SERVER_ERROR",
            });
          }
        }
      }

      // Get the workspace role to set roleId
      const memberRole = await permissionRepo.getRoleByWorkspaceIdAndName(
        ctx.db,
        invite.workspaceId,
        "member",
      );

      await memberRepo.create(ctx.db, {
        workspaceId: invite.workspaceId,
        email: user.email,
        userId: user.id,
        createdBy: user.id,
        role: "member",
        roleId: memberRole?.id ?? null,
        status: "active",
      });

      return {
        success: true,
        workspacePublicId: workspace.publicId,
        workspaceSlug: workspace.slug,
      };
    }),
  updateRole: protectedProcedure
    .meta({
      openapi: {
        summary: "Update member role",
        method: "PUT",
        path: "/workspaces/{workspacePublicId}/members/{memberPublicId}/role",
        description: "Updates a member's role in a workspace",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        memberPublicId: z.string().min(12),
        role: z.enum(["admin", "member", "guest"]),
      }),
    )
    .output(
      z.object({
        success: z.boolean(),
        role: z.string(),
      }),
    )
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      const member = await memberRepo.getByPublicId(
        ctx.db,
        input.memberPublicId,
      );

      if (!member) {
        throw new TRPCError({
          message: "Member not found",
          code: "NOT_FOUND",
        });
      }

      await assertCanManageMember(ctx.db, userId, workspace.id, member.id);
      await assertCanManageRole(ctx.db, userId, workspace.id, input.role);

      // Get the workspace role to set roleId
      const workspaceRole = await permissionRepo.getRoleByWorkspaceIdAndName(
        ctx.db,
        workspace.id,
        input.role,
      );

      await memberRepo.updateRole(ctx.db, {
        memberId: member.id,
        role: input.role,
        roleId: workspaceRole?.id ?? null,
      });

      return {
        success: true,
        role: input.role,
      };
    }),
});



================================================
FILE: packages/api/src/routers/permission.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as memberRepo from "@kan/db/repository/member.repo";
import * as permissionRepo from "@kan/db/repository/permission.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import type { Permission } from "@kan/shared";
import { allPermissions } from "@kan/shared";

import { createTRPCRouter, protectedProcedure } from "../trpc";
import {
  assertCanManageMember,
  assertPermission,
  getMemberEffectivePermissions,
  getUserPermissions,
} from "../utils/permissions";

const permissionsList = [...allPermissions] as [string, ...string[]];

export const permissionRouter = createTRPCRouter({
  getMyPermissions: protectedProcedure
    .meta({
      openapi: {
        summary: "Get my permissions",
        method: "GET",
        path: "/workspaces/{workspacePublicId}/permissions/me",
        description: "Get the current user's permissions in a workspace",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        permissions: z.array(z.string()),
        role: z.string(),
      }),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      const result = await getUserPermissions(ctx.db, userId, workspace.id);

      if (!result) {
        throw new TRPCError({
          message: "You are not a member of this workspace",
          code: "FORBIDDEN",
        });
      }

      return result;
    }),
  getMemberPermissions: protectedProcedure
    .meta({
      openapi: {
        summary: "Get member permissions",
        method: "GET",
        path: "/workspaces/{workspacePublicId}/members/{memberPublicId}/permissions",
        description: "Get a specific member's permissions in a workspace",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        memberPublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        memberPublicId: z.string(),
        role: z.string(),
        permissions: z.array(z.string()),
        overrides: z.array(
          z.object({
            permission: z.string(),
            granted: z.boolean(),
          }),
        ),
      }),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      // Check user has permission to view member permissions
      await assertPermission(ctx.db, userId, workspace.id, "member:view");

      const member = await memberRepo.getByPublicId(
        ctx.db,
        input.memberPublicId,
      );

      if (!member) {
        throw new TRPCError({
          message: "Member not found",
          code: "NOT_FOUND",
        });
      }

      const effectivePermissions = await getMemberEffectivePermissions(
        ctx.db,
        member.id,
        member.roleId ?? null,
        member.role,
      );
      const overrides = await permissionRepo.getMemberPermissionOverrides(
        ctx.db,
        member.id,
      );

      return {
        memberPublicId: member.publicId,
        role: member.role,
        permissions: effectivePermissions,
        overrides: overrides.map((o) => ({
          permission: o.permission,
          granted: o.granted,
        })),
      };
    }),
  grantPermission: protectedProcedure
    .meta({
      openapi: {
        summary: "Grant permission to member",
        method: "POST",
        path: "/workspaces/{workspacePublicId}/members/{memberPublicId}/permissions/grant",
        description: "Grant a specific permission to a member",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        memberPublicId: z.string().min(12),
        permission: z.enum(permissionsList),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      const member = await memberRepo.getByPublicId(
        ctx.db,
        input.memberPublicId,
      );

      if (!member) {
        throw new TRPCError({
          message: "Member not found",
          code: "NOT_FOUND",
        });
      }

      await assertCanManageMember(ctx.db, userId, workspace.id, member.id);

      await permissionRepo.grantPermission(
        ctx.db,
        member.id,
        input.permission as Permission,
      );

      return { success: true };
    }),
  revokePermission: protectedProcedure
    .meta({
      openapi: {
        summary: "Revoke permission from member",
        method: "POST",
        path: "/workspaces/{workspacePublicId}/members/{memberPublicId}/permissions/revoke",
        description: "Revoke a specific permission from a member",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        memberPublicId: z.string().min(12),
        permission: z.enum(permissionsList),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      const member = await memberRepo.getByPublicId(
        ctx.db,
        input.memberPublicId,
      );

      if (!member) {
        throw new TRPCError({
          message: "Member not found",
          code: "NOT_FOUND",
        });
      }

      await assertCanManageMember(ctx.db, userId, workspace.id, member.id);

      await permissionRepo.revokePermission(
        ctx.db,
        member.id,
        input.permission as Permission,
      );

      return { success: true };
    }),
  resetMemberPermissions: protectedProcedure
    .meta({
      openapi: {
        summary: "Reset member permissions to role defaults",
        method: "POST",
        path: "/workspaces/{workspacePublicId}/members/{memberPublicId}/permissions/reset",
        description:
          "Clears all custom permission overrides for a member so their effective permissions come only from their role",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        memberPublicId: z.string().min(12),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      const member = await memberRepo.getByPublicId(
        ctx.db,
        input.memberPublicId,
      );

      if (!member) {
        throw new TRPCError({
          message: "Member not found",
          code: "NOT_FOUND",
        });
      }

      await assertCanManageMember(ctx.db, userId, workspace.id, member.id);

      await permissionRepo.clearMemberPermissionOverrides(ctx.db, member.id);

      return { success: true };
    }),
  resetWorkspaceMemberPermissions: protectedProcedure
    .meta({
      openapi: {
        summary: "Reset all member permission overrides in a workspace",
        method: "POST",
        path: "/workspaces/{workspacePublicId}/members/permissions/reset",
        description:
          "Clears all custom permission overrides for all members in a workspace so their effective permissions come only from their roles",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      await permissionRepo.clearAllMemberPermissionOverridesForWorkspace(
        ctx.db,
        workspace.id,
      );

      return { success: true };
    }),
  getWorkspaceRoles: protectedProcedure
    .meta({
      openapi: {
        summary: "Get workspace roles",
        method: "GET",
        path: "/workspaces/{workspacePublicId}/roles",
        description: "Get all roles for a workspace",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        roles: z.array(
          z.object({
            publicId: z.string().min(12),
            name: z.string(),
            description: z.string().nullable(),
            hierarchyLevel: z.number(),
            isSystem: z.boolean(),
          }),
        ),
      }),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:view");

      const roles = await permissionRepo.getRolesByWorkspaceId(
        ctx.db,
        workspace.id,
      );

      return {
        roles: roles.map((role) => ({
          publicId: role.publicId,
          name: role.name,
          description: role.description ?? null,
          hierarchyLevel: role.hierarchyLevel,
          isSystem: role.isSystem,
        })),
      };
    }),
  getWorkspaceRolePermissions: protectedProcedure
    .meta({
      openapi: {
        summary: "Get workspace role permissions",
        method: "GET",
        path: "/workspaces/{workspacePublicId}/roles/permissions",
        description:
          "Get all roles for a workspace with their granted permissions",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        roles: z.array(
          z.object({
            publicId: z.string().min(12),
            name: z.string(),
            permissions: z.array(z.string()),
          }),
        ),
      }),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:view");

      const roles = await permissionRepo.getRolesByWorkspaceId(
        ctx.db,
        workspace.id,
      );

      const rolesWithPermissions = await Promise.all(
        roles.map(async (role) => {
          const permissionsForRole = await permissionRepo.getPermissionsByRoleId(
            ctx.db,
            role.id,
          );

          return {
            publicId: role.publicId,
            name: role.name,
            permissions: permissionsForRole,
          };
        }),
      );

      return {
        roles: rolesWithPermissions,
      };
    }),
  getRolePermissions: protectedProcedure
    .meta({
      openapi: {
        summary: "Get role permissions",
        method: "GET",
        path: "/workspaces/{workspacePublicId}/roles/{rolePublicId}/permissions",
        description: "Get permissions granted to a specific role in a workspace",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        rolePublicId: z.string().min(12),
      }),
    )
    .output(
      z.object({
        rolePublicId: z.string(),
        name: z.string(),
        permissions: z.array(z.string()),
      }),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:view");

      const role = await permissionRepo.getRoleByWorkspaceIdAndPublicId(
        ctx.db,
        workspace.id,
        input.rolePublicId,
      );

      if (!role) {
        throw new TRPCError({
          message: "Role not found",
          code: "NOT_FOUND",
        });
      }

      const permissionsForRole = await permissionRepo.getPermissionsByRoleId(
        ctx.db,
        role.id,
      );

      return {
        rolePublicId: role.publicId,
        name: role.name,
        permissions: permissionsForRole,
      };
    }),
  grantRolePermission: protectedProcedure
    .meta({
      openapi: {
        summary: "Grant permission to role",
        method: "POST",
        path: "/workspaces/{workspacePublicId}/roles/{rolePublicId}/permissions/grant",
        description: "Grant a specific permission to a role",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        rolePublicId: z.string().min(12),
        permission: z.enum(permissionsList),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      // Require ability to edit members/roles
      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      const role = await permissionRepo.getRoleByWorkspaceIdAndPublicId(
        ctx.db,
        workspace.id,
        input.rolePublicId,
      );

      if (!role) {
        throw new TRPCError({
          message: "Role not found",
          code: "NOT_FOUND",
        });
      }

      if (role.name === "admin" && role.isSystem) {
        throw new TRPCError({
          message: "Admin role permissions cannot be modified",
          code: "FORBIDDEN",
        });
      }

      // Never allow non-admin roles to manage billing or delete workspace
      if (
        (input.permission === "workspace:manage" ||
          input.permission === "workspace:delete") &&
        role.name !== "admin"
      ) {
        throw new TRPCError({
          message:
            "Only the admin role can manage billing or delete the workspace",
          code: "FORBIDDEN",
        });
      }

      await permissionRepo.grantRolePermission(
        ctx.db,
        role.id,
        input.permission as Permission,
      );

      return { success: true };
    }),
  revokeRolePermission: protectedProcedure
    .meta({
      openapi: {
        summary: "Revoke permission from role",
        method: "POST",
        path: "/workspaces/{workspacePublicId}/roles/{rolePublicId}/permissions/revoke",
        description: "Revoke a specific permission from a role",
        tags: ["Permissions"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        rolePublicId: z.string().min(12),
        permission: z.enum(permissionsList),
      }),
    )
    .output(z.object({ success: z.boolean() }))
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId) {
        throw new TRPCError({
          message: "User not authenticated",
          code: "UNAUTHORIZED",
        });
      }

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace) {
        throw new TRPCError({
          message: "Workspace not found",
          code: "NOT_FOUND",
        });
      }

      await assertPermission(ctx.db, userId, workspace.id, "member:edit");

      const role = await permissionRepo.getRoleByWorkspaceIdAndPublicId(
        ctx.db,
        workspace.id,
        input.rolePublicId,
      );

      if (!role) {
        throw new TRPCError({
          message: "Role not found",
          code: "NOT_FOUND",
        });
      }

      if (role.name === "admin" && role.isSystem) {
        throw new TRPCError({
          message: "Admin role permissions cannot be modified",
          code: "FORBIDDEN",
        });
      }

      await permissionRepo.revokeRolePermission(
        ctx.db,
        role.id,
        input.permission as Permission,
      );

      return { success: true };
    }),
});



================================================
FILE: packages/api/src/routers/user.ts
================================================
import { TRPCError } from "@trpc/server";
import { z } from "zod";

import * as userRepo from "@kan/db/repository/user.repo";

import { createTRPCRouter, protectedProcedure } from "../trpc";
import { generateAvatarUrl } from "@kan/shared/utils";

export const userRouter = createTRPCRouter({
  getUser: protectedProcedure
    .meta({
      openapi: {
        method: "GET",
        path: "/users/me",
        summary: "Get user",
        description:
          "Retrieves the currently authenticated user's profile information",
        tags: ["Users"],
        protect: true,
      },
    })
    .input(z.void())
    .output(
      z.object({
        id: z.string(),
        email: z.string(),
        name: z.string().nullable(),
        image: z.string().nullable(),
        stripeCustomerId: z.string().nullable(),
        apiKey: z
          .object({
            id: z.number(),
            prefix: z.string().nullable(),
            key: z.string(),
          })
          .nullable(),
      }),
    )
    .query(async ({ ctx }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const result = await userRepo.getById(ctx.db, userId);

      if (!result) {
        throw new TRPCError({
          message: `User not found`,
          code: "NOT_FOUND",
        });
      }

      const apiKey = result.apiKeys[0];

      // Generate presigned URL for avatar
      const imageUrl = await generateAvatarUrl(result.image);

      return {
        ...result,
        image: imageUrl,
        apiKey: apiKey ?? null,
      };
    }),
  update: protectedProcedure
    .meta({
      openapi: {
        method: "PUT",
        path: "/users",
        summary: "Update user",
        description:
          "Updates the currently authenticated user's profile information",
        tags: ["Users"],
        protect: true,
      },
    })
    .input(
      z.object({
        name: z.string().optional(),
        image: z.string().optional(),
      }),
    )
    .output(
      z.object({
        name: z.string().nullable(),
        image: z.string().nullable(),
      }),
    )
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const result = await userRepo.update(ctx.db, userId, input);

      if (!result) {
        throw new TRPCError({
          message: `User not found`,
          code: "NOT_FOUND",
        });
      }

      // Generate presigned URL for avatar
      const imageUrl = await generateAvatarUrl(result.image);

      return {
        ...result,
        image: imageUrl,
      };
    }),
});



================================================
FILE: packages/api/src/routers/workspace.ts
================================================
import { TRPCError } from "@trpc/server";
import { env } from "next-runtime-env";
import { z } from "zod";

import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import * as workspaceSlugRepo from "@kan/db/repository/workspaceSlug.repo";
import { generateUID } from "@kan/shared/utils";

import { createTRPCRouter, protectedProcedure, publicProcedure } from "../trpc";
import { assertPermission } from "../utils/permissions";
import { generateAvatarUrl } from "@kan/shared/utils";

export const workspaceRouter = createTRPCRouter({
  all: protectedProcedure
    .meta({
      openapi: {
        summary: "Get all workspaces",
        method: "GET",
        path: "/workspaces",
        description: "Retrieves all workspaces for the authenticated user",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(z.void())
    .output(
      z.custom<Awaited<ReturnType<typeof workspaceRepo.getAllByUserId>>>(),
    )
    .query(async ({ ctx }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const result = await workspaceRepo.getAllByUserId(ctx.db, userId);

      return result;
    }),
  byId: protectedProcedure
    .meta({
      openapi: {
        summary: "Get a workspace by public ID",
        method: "GET",
        path: "/workspaces/{workspacePublicId}",
        description: "Retrieves a workspace by its public ID",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(z.object({ workspacePublicId: z.string().min(12) }))
    .output(
      z.custom<
        Awaited<ReturnType<typeof workspaceRepo.getByPublicIdWithMembers>>
      >(),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const result = await workspaceRepo.getByPublicIdWithMembers(
        ctx.db,
        input.workspacePublicId,
      );

      if (!result)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, result.id, "workspace:view");

      // Check if user is an admin
      const userMember = result.members.find(
        (member) => member.user?.id === userId,
      );
      const isAdmin = userMember?.role === "admin";

      // Show emails if user is admin OR workspace setting allows it
      const shouldShowEmails =
        isAdmin || result.showEmailsToMembers === true;

      // Generate presigned URLs for member avatars
      const membersWithAvatarUrls = await Promise.all(
        result.members.map(async (member) => {
          if (!member.user?.image) {
            return member;
          }

          const avatarUrl = await generateAvatarUrl(member.user.image);
          return {
            ...member,
            user: {
              ...member.user,
              image: avatarUrl,
            },
          };
        }),
      );

      // If emails should be hidden, filter them out
      if (!shouldShowEmails) {
        const sanitizedMembers = membersWithAvatarUrls.map((member) => {
          // If user doesn't have a display name, use anonymous identifier
          const displayName =
            member.user?.name?.trim() ?? `anonymous_${member.publicId}`;

          const { email: _memberEmail, ...memberWithoutEmail } = member;
          const sanitizedUser = member.user
            ? (() => {
                const { email: _userEmail, ...userWithoutEmail } = member.user;
                return {
                  ...userWithoutEmail,
                  name: displayName,
                };
              })()
            : {
                id: null,
                name: displayName,
                image: null,
              };

          return {
            ...memberWithoutEmail,
            user: sanitizedUser,
          };
        });

        return {
          ...result,
          members: sanitizedMembers,
        } as Awaited<ReturnType<typeof workspaceRepo.getByPublicIdWithMembers>>;
      }

      return {
        ...result,
        members: membersWithAvatarUrls,
      };
    }),
  bySlug: publicProcedure
    .meta({
      openapi: {
        summary: "Get a workspace by slug",
        method: "GET",
        path: "/workspaces/{workspaceSlug}",
        description: "Retrieves a workspace by its slug",
        tags: ["Workspaces"],
        protect: false,
      },
    })
    .input(
      z.object({
        workspaceSlug: z
          .string()
          .min(3)
          .max(64)
          .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/),
      }),
    )
    .output(
      z.custom<Awaited<ReturnType<typeof workspaceRepo.getBySlugWithBoards>>>(),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const result = await workspaceRepo.getBySlugWithBoards(
        ctx.db,
        input.workspaceSlug,
      );

      if (!result)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, result.id, "workspace:view");

      return result;
    }),
  create: protectedProcedure
    .meta({
      openapi: {
        summary: "Create a workspace",
        method: "POST",
        path: "/workspaces",
        description: "Creates a new workspace",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(
      z.object({
        name: z.string().min(1).max(64),
        slug: z
          .string()
          .min(3)
          .max(64)
          .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/)
          .optional(),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof workspaceRepo.create>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;
      const userEmail = ctx.user?.email;

      if (!userId || !userEmail)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      // Check if slug is provided in cloud environment
      if (input.slug && env("NEXT_PUBLIC_KAN_ENV") === "cloud") {
        throw new TRPCError({
          message: "Custom URLs are only available for Pro workspaces",
          code: "BAD_REQUEST",
        });
      }

      const workspacePublicId = generateUID();
      const workspaceSlug = input.slug ?? workspacePublicId;

      if (input.slug) {
        const reservedOrPremiumWorkspaceSlug =
          await workspaceSlugRepo.getWorkspaceSlug(ctx.db, input.slug);

        const isWorkspaceSlugAvailable =
          await workspaceRepo.isWorkspaceSlugAvailable(ctx.db, input.slug);

        if (reservedOrPremiumWorkspaceSlug) {
          throw new TRPCError({
            message: `Workspace slug '${input.slug}' is reserved or premium`,
            code: "BAD_REQUEST",
          });
        }

        if (!isWorkspaceSlugAvailable) {
          throw new TRPCError({
            message: `Workspace slug '${input.slug}' is already taken`,
            code: "BAD_REQUEST",
          });
        }
      }

      const result = await workspaceRepo.create(ctx.db, {
        publicId: workspacePublicId,
        name: input.name,
        slug: workspaceSlug,
        createdBy: userId,
        createdByEmail: userEmail,
      });

      if (!result.publicId)
        throw new TRPCError({
          message: `Unable to create workspace`,
          code: "INTERNAL_SERVER_ERROR",
        });

      return result;
    }),
  update: protectedProcedure
    .meta({
      openapi: {
        summary: "Update a workspace",
        method: "PUT",
        path: "/workspaces/{workspacePublicId}",
        description: "Updates a workspace by its public ID",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        name: z.string().min(3).max(64).optional(),
        slug: z
          .string()
          .min(3)
          .max(64)
          .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/)
          .optional(),
        description: z.string().min(3).max(280).optional(),
        showEmailsToMembers: z.boolean().optional(),
      }),
    )
    .output(z.custom<Awaited<ReturnType<typeof workspaceRepo.update>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, workspace.id, "workspace:edit");

      if (input.slug) {
        const reservedOrPremiumWorkspaceSlug =
          await workspaceSlugRepo.getWorkspaceSlug(ctx.db, input.slug);

        const isWorkspaceSlugAvailable =
          await workspaceRepo.isWorkspaceSlugAvailable(ctx.db, input.slug);

        if (
          env("NEXT_PUBLIC_KAN_ENV") === "cloud" &&
          workspace.plan !== "pro" &&
          input.slug !== workspace.publicId
        ) {
          throw new TRPCError({
            message: `Workspace slug cannot be changed in cloud without upgrading to a paid plan`,
            code: "FORBIDDEN",
          });
        }

        if (
          reservedOrPremiumWorkspaceSlug?.type === "reserved" ||
          !isWorkspaceSlugAvailable
        ) {
          throw new TRPCError({
            message: `Workspace slug already taken`,
            code: "CONFLICT",
          });
        }
      }

      const result = await workspaceRepo.update(
        ctx.db,
        input.workspacePublicId,
        {
          name: input.name,
          slug: input.slug,
          description: input.description,
          showEmailsToMembers: input.showEmailsToMembers,
        },
      );

      if (!result)
        throw new TRPCError({
          message: `Unable to delete workspace`,
          code: "INTERNAL_SERVER_ERROR",
        });

      return result;
    }),
  delete: protectedProcedure
    .meta({
      openapi: {
        summary: "Delete a workspace",
        method: "DELETE",
        path: "/workspaces/{workspacePublicId}",
        description: "Deletes a workspace by its public ID",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(z.object({ workspacePublicId: z.string().min(12) }))
    .output(z.custom<Awaited<ReturnType<typeof workspaceRepo.hardDelete>>>())
    .mutation(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, workspace.id, "workspace:delete");

      const result = await workspaceRepo.hardDelete(
        ctx.db,
        input.workspacePublicId,
      );

      return result;
    }),
  checkSlugAvailability: publicProcedure
    .meta({
      openapi: {
        summary: "Check if a workspace slug is available",
        method: "GET",
        path: "/workspaces/check-slug-availability",
        description: "Checks if a workspace slug is available",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspaceSlug: z
          .string()
          .min(3)
          .max(64)
          .regex(/^(?![-]+$)[a-zA-Z0-9-]+$/),
      }),
    )
    .output(
      z.object({
        isAvailable: z.boolean(),
        isReserved: z.boolean(),
      }),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const slug = input.workspaceSlug.toLowerCase();
      // check slug is not reserved
      const workspaceSlug = await workspaceSlugRepo.getWorkspaceSlug(
        ctx.db,
        slug,
      );

      // check slug is not taken already
      const isWorkspaceSlugAvailable =
        await workspaceRepo.isWorkspaceSlugAvailable(ctx.db, slug);

      const isAvailable =
        isWorkspaceSlugAvailable && workspaceSlug?.type !== "reserved";
      const isReserved = workspaceSlug?.type === "reserved";

      if (env("NEXT_PUBLIC_KAN_ENV") === "cloud") {
        await workspaceSlugRepo.createWorkspaceSlugCheck(ctx.db, {
          slug,
          userId,
          available: isAvailable,
          reserved: isReserved,
        });
      }

      return {
        isAvailable:
          isWorkspaceSlugAvailable && workspaceSlug?.type !== "reserved",
        isReserved: workspaceSlug?.type === "reserved",
      };
    }),
  search: protectedProcedure
    .meta({
      openapi: {
        summary: "Search boards and cards in a workspace",
        method: "GET",
        path: "/workspaces/{workspacePublicId}/search",
        description:
          "Searches for boards and cards by title within a workspace",
        tags: ["Workspaces"],
        protect: true,
      },
    })
    .input(
      z.object({
        workspacePublicId: z.string().min(12),
        query: z.string().min(1).max(100),
        limit: z.number().min(1).max(50).optional().default(20),
      }),
    )
    .output(
      z.array(
        z.discriminatedUnion("type", [
          z.object({
            publicId: z.string(),
            title: z.string(),
            description: z.string().nullable(),
            slug: z.string(),
            updatedAt: z.date().nullable(),
            createdAt: z.date(),
            type: z.literal("board"),
          }),
          z.object({
            publicId: z.string(),
            title: z.string(),
            description: z.string().nullable(),
            boardPublicId: z.string(),
            boardName: z.string(),
            listName: z.string(),
            updatedAt: z.date().nullable(),
            createdAt: z.date(),
            type: z.literal("card"),
          }),
        ]),
      ),
    )
    .query(async ({ ctx, input }) => {
      const userId = ctx.user?.id;

      if (!userId)
        throw new TRPCError({
          message: `User not authenticated`,
          code: "UNAUTHORIZED",
        });

      const workspace = await workspaceRepo.getByPublicId(
        ctx.db,
        input.workspacePublicId,
      );

      if (!workspace)
        throw new TRPCError({
          message: `Workspace not found`,
          code: "NOT_FOUND",
        });
      await assertPermission(ctx.db, userId, workspace.id, "workspace:view");

      const result = await workspaceRepo.searchBoardsAndCards(
        ctx.db,
        workspace.id,
        input.query,
        input.limit,
      );

      return result;
    }),
});



================================================
FILE: packages/api/src/types/router.types.ts
================================================
import type { RouterInputs, RouterOutputs } from "../index";

export type GetBoardByIdOutput = RouterOutputs["board"]["byId"];
export type GetCardByIdOutput = RouterOutputs["card"]["byId"];
export type GetCardActivitiesOutput = RouterOutputs["card"]["getActivities"];
export type UpdateBoardInput = RouterInputs["board"]["update"];
export type NewLabelInput = RouterInputs["label"]["create"];
export type NewListInput = RouterInputs["list"]["create"];
export type NewCardInput = RouterInputs["card"]["create"];
export type NewBoardInput = RouterInputs["board"]["create"];
export type InviteMemberInput = RouterInputs["member"]["invite"];



================================================
FILE: packages/api/src/utils/activities.ts
================================================
import type { PaginatedActivitiesResult } from "@kan/db/repository/cardActivity.repo";
import type { ActivityType } from "@kan/db/schema";

type ActivityBase = PaginatedActivitiesResult["activities"][number];

interface Activity extends ActivityBase {
  mergeCount?: number; // number of activities merged into this one
  mergedLabels?: string[]; // list of label names when merging label activities
}

// types that can be merged with simple count
const MERGEABLE_COUNT_TYPES: readonly ActivityType[] = [
  "card.updated.description",
];

// types that merge with a list of items
const MERGEABLE_LIST_TYPES: readonly ActivityType[] = [
  "card.updated.label.added",
  "card.updated.label.removed",
];

const MERGE_TIME_WINDOW_MS = 5 * 60 * 1000; // 5 minutes window for merging activities

export function mergeActivities(activities: Activity[]): Activity[] {
  if (activities.length === 0) return [];

  const merged: Activity[] = [];
  let i = 0;

  while (i < activities.length) {
    const current = activities[i];
    if (!current) {
      i++;
      continue;
    }

    const currentType = current.type;

    const isCountMergeable = MERGEABLE_COUNT_TYPES.includes(currentType);
    const isListMergeable = MERGEABLE_LIST_TYPES.includes(currentType);
    const canMerge = (isCountMergeable || isListMergeable) && current.user?.id;

    if (!canMerge) {
      merged.push(current);
      i++;
      continue;
    }

    const group: Activity[] = [current];
    let j = i + 1;

    while (j < activities.length) {
      const next = activities[j];
      if (!next) break;

      const timeDiff =
        new Date(next.createdAt).getTime() -
        new Date(current.createdAt).getTime();

      if (
        next.type === current.type &&
        next.user?.id === current.user?.id &&
        timeDiff >= 0 && // next is newer or same time
        timeDiff <= MERGE_TIME_WINDOW_MS
      ) {
        group.push(next);
        j++;
      } else {
        break;
      }
    }

    if (group.length > 1) {
      const oldest = group[0];
      const latest = group[group.length - 1];

      if (oldest && latest) {
        if (isListMergeable) {
          const labelNames = group
            .map((a) => a.label?.name)
            .filter((name): name is string => !!name);

          merged.push({
            ...oldest,
            createdAt: oldest.createdAt,
            mergeCount: group.length,
            mergedLabels: labelNames,
          });
        } else {
          merged.push({
            ...oldest,
            createdAt: oldest.createdAt,
            toDescription: latest.toDescription,
            fromDescription: oldest.fromDescription,
            mergeCount: group.length,
          });
        }
      } else {
        merged.push(current);
      }
    } else {
      merged.push(current);
    }

    i = j;
  }

  return merged;
}



================================================
FILE: packages/api/src/utils/auth.ts
================================================
import { TRPCError } from "@trpc/server";

import type { dbClient } from "@kan/db/client";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";

export async function assertUserInWorkspace(
  db: dbClient,
  userId: string,
  workspaceId: number,
  role?: "admin" | "member",
) {
  const isMember = await workspaceRepo.isUserInWorkspace(
    db,
    userId,
    workspaceId,
    role,
  );

  if (!isMember)
    throw new TRPCError({
      message: `You do not have access to this workspace`,
      code: "FORBIDDEN",
    });
}



================================================
FILE: packages/api/src/utils/notifications.ts
================================================
import { env } from "next-runtime-env";

import type { dbClient } from "@kan/db/client";
import * as cardRepo from "@kan/db/repository/card.repo";
import * as memberRepo from "@kan/db/repository/member.repo";
import * as notificationRepo from "@kan/db/repository/notification.repo";
import * as userRepo from "@kan/db/repository/user.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import { sendEmail } from "@kan/email";
import { parseMentionsFromHTML } from "@kan/shared/utils";

/**
 * Sends mention notification emails to mentioned members
 * Only sends emails for new mentions (checks notification table to avoid duplicates)
 */
export async function sendMentionEmails({
  db,
  cardPublicId,
  commentHtml,
  commenterUserId,
  commentId,
}: {
  db: dbClient;
  cardPublicId: string;
  commentHtml: string;
  commenterUserId: string;
  commentId?: number;
}) {
  try {
    // Parse mentions from HTML
    const mentionPublicIds = parseMentionsFromHTML(commentHtml);
    if (mentionPublicIds.length === 0) return;

    // Get card with board information
    const card = await cardRepo.getWithListAndMembersByPublicId(db, cardPublicId);
    if (!card?.list.board) return;

    const board = card.list.board;
    const boardName = board.name;
    const cardTitle = card.title;
    const cardId = card.id;

    // Get workspace ID from workspace publicId
    const workspace = await workspaceRepo.getByPublicId(
      db,
      board.workspace.publicId,
    );
    if (!workspace?.id) return;

    const workspaceId = workspace.id;

    // Get commenter information
    const commenter = await userRepo.getById(db, commenterUserId);
    if (!commenter) return;

    const commenterName = commenter.name?.trim() || commenter.email;

    // Get mentioned members with full details (filtered by workspace)
    const membersWithDetails = await memberRepo.getByPublicIdsWithUsers(
      db,
      mentionPublicIds,
      workspaceId,
    );

    // Filter out the commenter
    const membersToNotify = membersWithDetails.filter(
      (member) => member.user?.id !== commenterUserId,
    );

    if (membersToNotify.length === 0) return;

    const baseUrl = env("NEXT_PUBLIC_BASE_URL");
    const cardUrl = `${baseUrl}/cards/${cardPublicId}`;

    // Send emails to all mentioned members (only if notification doesn't exist)
    await Promise.all(
      membersToNotify.map(async (member) => {
        const userId = member.user?.id;
        const email = member.user?.email ?? member.email;

        // Skip pending members (no userId) - they can be mentioned but won't receive emails
        if (!userId || !email) return;

        try {
          // Check if notification already exists for this mention
          const notificationExists = await notificationRepo.exists(db, {
            userId,
            cardId,
            type: "mention",
          });

          // If notification already exists, skip sending email
          if (notificationExists) {
            return;
          }

          // Create notification record
          await notificationRepo.create(db, {
            type: "mention",
            userId,
            cardId,
            commentId,
          });

          // Send email
          await sendEmail(
            email,
            `${commenterName} mentioned you in a comment on ${cardTitle}`,
            "MENTION",
            {
              commenterName,
              boardName,
              cardTitle,
              cardUrl,
            },
          );
        } catch (error) {
          console.error("Failed to send mention email:", {
            email,
            cardPublicId,
            error: error instanceof Error ? error.message : String(error),
          });
        }
      }),
    );
  } catch (error) {
    console.error("Error sending mention emails:", {
      cardPublicId,
      error: error instanceof Error ? error.message : String(error),
    });
  }
}




================================================
FILE: packages/api/src/utils/permissions.ts
================================================
import { TRPCError } from "@trpc/server";

import type { dbClient } from "@kan/db/client";
import * as memberRepo from "@kan/db/repository/member.repo";
import * as permissionRepo from "@kan/db/repository/permission.repo";
import type { Permission, Role } from "@kan/shared";
import { canManageRole, getDefaultPermissions } from "@kan/shared";

/**
 * Get effective permissions for a member by combining role permissions with overrides
 */
export async function getMemberEffectivePermissions(
  db: dbClient,
  workspaceMemberId: number,
  roleId: number | null,
  roleName: string,
): Promise<Permission[]> {
  let roleDefaults: Set<Permission>;

  // Get role permissions from database or fallback to code defaults
  if (roleId) {
    const dbPermissions = await permissionRepo.getPermissionsByRoleId(
      db,
      roleId,
    );
    roleDefaults = new Set<Permission>(dbPermissions);
  } else {
    const codeDefaults = getDefaultPermissions(roleName as Role);
    roleDefaults = new Set<Permission>([...codeDefaults]);
  }

  // Get and apply custom overrides
  const overrides = await permissionRepo.getMemberPermissionOverrides(
    db,
    workspaceMemberId,
  );

  for (const override of overrides) {
    if (override.granted) {
      roleDefaults.add(override.permission as Permission);
    } else {
      roleDefaults.delete(override.permission as Permission);
    }
  }

  return Array.from(roleDefaults);
}

/**
 * Check if a member has a specific permission
 */
export async function memberHasPermission(
  db: dbClient,
  workspaceMemberId: number,
  roleId: number | null,
  roleName: string,
  permission: Permission,
): Promise<boolean> {
  let hasRoleDefault: boolean;

  // Check role permission from database or fallback to code defaults
  if (roleId) {
    const dbPermissions = await permissionRepo.getPermissionsByRoleId(
      db,
      roleId,
    );
    hasRoleDefault = dbPermissions.includes(permission);
  } else {
    const codeDefaults = getDefaultPermissions(roleName as Role);
    hasRoleDefault = codeDefaults.includes(permission);
  }

  // Check for override
  const override = await permissionRepo.getMemberPermissionOverride(
    db,
    workspaceMemberId,
    permission,
  );

  // Override takes precedence
  if (override) {
    return override.granted;
  }

  return hasRoleDefault;
}

/**
 * Check if user has a specific permission in a workspace
 */
export async function hasPermission(
  db: dbClient,
  userId: string,
  workspaceId: number,
  permission: Permission,
): Promise<boolean> {
  const member = await permissionRepo.getMemberWithRole(db, userId, workspaceId);

  if (!member) {
    return false;
  }

  return memberHasPermission(
    db,
    member.id,
    member.roleId,
    member.role,
    permission,
  );
}

/**
 * Get all permissions for a user in a workspace
 */
export async function getUserPermissions(
  db: dbClient,
  userId: string,
  workspaceId: number,
): Promise<{
  permissions: Permission[];
  role: string;
  roleId: number | null;
} | null> {
  const member = await permissionRepo.getMemberWithRole(db, userId, workspaceId);

  if (!member) {
    return null;
  }

  const permissions = await getMemberEffectivePermissions(
    db,
    member.id,
    member.roleId,
    member.role,
  );

  return {
    permissions,
    role: member.role,
    roleId: member.roleId,
  };
}

/**
 * Assert user has permission - throws FORBIDDEN if not
 */
export async function assertPermission(
  db: dbClient,
  userId: string,
  workspaceId: number,
  permission: Permission,
): Promise<void> {
  const hasIt = await hasPermission(db, userId, workspaceId, permission);

  if (!hasIt) {
    throw new TRPCError({
      message: `You do not have permission to perform this action (${permission})`,
      code: "FORBIDDEN",
    });
  }
}

/**
 * Assert user can assign a specific role (based on hierarchy)
 */
export async function assertCanManageRole(
  db: dbClient,
  managerUserId: string,
  workspaceId: number,
  targetRoleName: string,
): Promise<void> {
  const managerMember = await permissionRepo.getMemberWithRole(
    db,
    managerUserId,
    workspaceId,
  );

  if (!managerMember) {
    throw new TRPCError({
      message: "You are not a member of this workspace",
      code: "FORBIDDEN",
    });
  }

  const managerRole = managerMember.role;

  if (!canManageRole(managerRole, targetRoleName as Role)) {
    throw new TRPCError({
      message: `You cannot assign the "${targetRoleName}" role`,
      code: "FORBIDDEN",
    });
  }
}

/**
 * Assert user can manage another member based on role hierarchy
 */
export async function assertCanManageMember(
  db: dbClient,
  managerUserId: string,
  workspaceId: number,
  targetMemberId: number,
): Promise<void> {
  const managerMember = await permissionRepo.getMemberWithRole(
    db,
    managerUserId,
    workspaceId,
  );

  if (!managerMember) {
    throw new TRPCError({
      message: "You are not a member of this workspace",
      code: "FORBIDDEN",
    });
  }

  const targetMember = await memberRepo.getById(db, targetMemberId);

  if (!targetMember) {
    throw new TRPCError({
      message: "Target member not found",
      code: "NOT_FOUND",
    });
  }

  const managerRole = managerMember.role;
  const targetRole = targetMember.role;

  if (!canManageRole(managerRole, targetRole)) {
    throw new TRPCError({
      message: "You cannot manage this member due to role hierarchy",
      code: "FORBIDDEN",
    });
  }
}

/**
 * Assert user can delete an entity - either has the delete permission OR is the creator
 */
export async function assertCanDelete(
  db: dbClient,
  userId: string,
  workspaceId: number,
  permission: Permission,
  createdBy: string | null,
): Promise<void> {
  // Check if user has the general delete permission
  const hasDeletePermission = await hasPermission(db, userId, workspaceId, permission);

  // If user has permission, allow deletion
  if (hasDeletePermission) {
    return;
  }

  // If user doesn't have permission, check if they are the creator
  if (createdBy && createdBy === userId) {
    return;
  }

  // Neither condition met - deny deletion
  throw new TRPCError({
    message: `You do not have permission to delete this entity (${permission})`,
    code: "FORBIDDEN",
  });
}

/**
 * Assert user can edit an entity - either has the edit permission OR is the creator
 */
export async function assertCanEdit(
  db: dbClient,
  userId: string,
  workspaceId: number,
  permission: Permission,
  createdBy: string | null,
): Promise<void> {
  // Check if user has the general edit permission
  const hasEditPermission = await hasPermission(db, userId, workspaceId, permission);

  // If user has permission, allow editing
  if (hasEditPermission) {
    return;
  }

  // If user doesn't have permission, check if they are the creator
  if (createdBy && createdBy === userId) {
    return;
  }

  // Neither condition met - deny editing
  throw new TRPCError({
    message: `You do not have permission to edit this entity (${permission})`,
    code: "FORBIDDEN",
  });
}



================================================
FILE: packages/api/src/utils/rateLimit.ts
================================================
import type { NextApiRequest, NextApiResponse } from "next";
import {
  RateLimiterRedis,
  RateLimiterMemory,
} from "rate-limiter-flexible";

import { getRedisClient } from "@kan/db/redis";

export interface RateLimitOptions {
  points?: number;
  duration?: number;
  identifier?: (req: NextApiRequest) => string | Promise<string>;
  errorMessage?: string;
}

const defaultIdentifier = (req: NextApiRequest): string => {
  // Try to identify the IP address of the request
  const forwardedFor = req.headers["x-forwarded-for"];
  const realIp = req.headers["x-real-ip"];
  const cfConnectingIp = req.headers["cf-connecting-ip"];

  const ip =
    (typeof forwardedFor === "string"
      ? forwardedFor.split(",")[0]?.trim()
      : null) ??
    (typeof realIp === "string" ? realIp : null) ??
    (typeof cfConnectingIp === "string" ? cfConnectingIp : null) ??
    req.socket.remoteAddress ??
    "unknown";

  return ip;
};

const DEFAULT_OPTIONS = {
  points: 100,
  duration: 60,
  errorMessage: "Too many requests, please try again later.",
  identifier: defaultIdentifier,
} as const;

function createRateLimiter(options: RateLimitOptions = {}) {
  const redis = getRedisClient();
  const points = options.points ?? DEFAULT_OPTIONS.points;
  const duration = options.duration ?? DEFAULT_OPTIONS.duration;

  // Use Redis if available, otherwise fall back to in-memory storage
  if (redis) {
    console.log("Using Redis for rate limiting");
    return new RateLimiterRedis({
      storeClient: redis,
      points,
      duration,
    });
  }

  console.log("Using in-memory for rate limiting");
  return new RateLimiterMemory({
    points,
    duration,
  });
}

export function withRateLimit(
  options: RateLimitOptions,
  handler: (
    req: NextApiRequest,
    res: NextApiResponse,
  ) => Promise<unknown> | unknown,
) {
  const rateLimiter = createRateLimiter(options);
  const identifier = options.identifier ?? DEFAULT_OPTIONS.identifier;
  const errorMessage = options.errorMessage ?? DEFAULT_OPTIONS.errorMessage;

  return async (req: NextApiRequest, res: NextApiResponse) => {
    try {
      const id = await identifier(req);
      const key = `ratelimit_${id}`;

      await rateLimiter.consume(key);

      return await handler(req, res);
    } catch (error) {
      // rate-limiter-flexible throws an error with msBeforeNext or remainingPoints
      // when limit is exceeded. Check for these properties directly.
      if (
        error &&
        typeof error === "object" &&
        ("msBeforeNext" in error || "remainingPoints" in error)
      ) {
        return res.status(429).json({
          message: errorMessage,
        });
      }

      return await handler(req, res);
    }
  };
}




================================================
FILE: packages/auth/eslint.config.js
================================================
import baseConfig from "@kan/eslint-config/base";

/** @type {import('typescript-eslint').Config} */
export default [
  {
    ignores: [],
  },
  ...baseConfig,
];



================================================
FILE: packages/auth/package.json
================================================
{
  "name": "@kan/auth",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "exports": {
    ".": "./src/index.ts",
    "./client": {
      "types": "./src/client.ts",
      "default": "./src/client.ts"
    },
    "./server": {
      "types": "./src/server.ts",
      "default": "./src/server.ts"
    }
  },
  "license": "GPL-3.0",
  "scripts": {
    "build": "tsc",
    "clean": "git clean -xdf .cache .turbo dist node_modules",
    "dev": "tsc",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "typecheck": "tsc --noEmit --emitDeclarationOnly false"
  },
  "devDependencies": {
    "@kan/db": "workspace:*",
    "@kan/email": "workspace:*",
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/shared": "workspace:*",
    "@kan/stripe": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config",
  "dependencies": {
    "@better-auth/stripe": "^1.4.6",
    "better-auth": "^1.4.6"
  }
}



================================================
FILE: packages/auth/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/internal-package.json",
  "compilerOptions": {
    "jsx": "react-jsx"
  },
  "include": ["*.ts", "src"],
  "exclude": ["node_modules"]
}



================================================
FILE: packages/auth/src/auth.ts
================================================
import { betterAuth } from "better-auth";
import { drizzleAdapter } from "better-auth/adapters/drizzle";
import { env } from "next-runtime-env";

import type { dbClient } from "@kan/db/client";
import * as schema from "@kan/db/schema";
import { sendEmail } from "@kan/email";

import { createDatabaseHooks, createMiddlewareHooks } from "./hooks";
import { createPlugins } from "./plugins";
import { configuredProviders } from "./providers";

export const initAuth = (db: dbClient) => {
  const baseURL = env("NEXT_PUBLIC_BASE_URL") || env("BETTER_AUTH_URL");
  const trustedOrigins =
    env("BETTER_AUTH_TRUSTED_ORIGINS")?.split(",").filter(Boolean) ?? [];

  return betterAuth({
    secret: env("BETTER_AUTH_SECRET"),
    baseURL,
    trustedOrigins: [...(baseURL ? [baseURL] : []), ...trustedOrigins],
    database: drizzleAdapter(db, {
      provider: "pg",
      schema: {
        ...schema,
        user: schema.users,
      },
    }),
    session: {
      expiresIn: 60 * 60 * 24 * 30, // 30 days
      updateAge: 60 * 60 * 24 * 2, // Update session expiry every 48 hours if user is active
      freshAge: 0,
    },
    emailAndPassword: {
      enabled: env("NEXT_PUBLIC_ALLOW_CREDENTIALS")?.toLowerCase() === "true",
      disableSignUp:
        env("NEXT_PUBLIC_DISABLE_SIGN_UP")?.toLowerCase() === "true",
      sendResetPassword: async (data) => {
        await sendEmail(data.user.email, "Reset Password", "RESET_PASSWORD", {
          resetPasswordUrl: data.url,
          resetPasswordToken: data.token,
        });
      },
    },
    socialProviders: configuredProviders,
    user: {
      deleteUser: {
        enabled: true,
      },
      additionalFields: {
        stripeCustomerId: {
          type: "string",
          required: false,
          defaultValue: null,
          input: false,
        },
      },
    },
    plugins: createPlugins(db),
    databaseHooks: createDatabaseHooks(db),
    hooks: createMiddlewareHooks(db),
    advanced: {
      cookiePrefix: "kan",
      database: {
        generateId: false,
      },
    },
  });
};



================================================
FILE: packages/auth/src/client.ts
================================================
import type { BetterAuthClientPlugin } from "better-auth";
import type { BetterFetchOption } from "better-auth/react";
import { stripeClient } from "@better-auth/stripe/client";
import {
  apiKeyClient,
  genericOAuthClient,
  magicLinkClient,
} from "better-auth/client/plugins";
import { createAuthClient } from "better-auth/react";

import type { socialProvidersPlugin } from "./providers";

const socialProvidersPluginClient = {
  id: "social-providers-plugin",
  $InferServerPlugin: {} as ReturnType<typeof socialProvidersPlugin>,
  getActions: ($fetch) => {
    return {
      getSocialProviders: async (fetchOptions?: BetterFetchOption) => {
        const res = $fetch("/social-providers", {
          method: "GET",
          ...fetchOptions,
        });
        return res.then((res) => res.data as string[]);
      },
    };
  },
} satisfies BetterAuthClientPlugin;

export const authClient = createAuthClient({
  plugins: [
    stripeClient({
      subscription: true,
    }),
    magicLinkClient(),
    apiKeyClient(),
    genericOAuthClient(),
    socialProvidersPluginClient,
  ],
});



================================================
FILE: packages/auth/src/hooks.ts
================================================
import { PutObjectCommand } from "@aws-sdk/client-s3";
import { ChatOrPushProviderEnum } from "@novu/api/models/components";
import { createAuthMiddleware } from "better-auth/api";
import { env } from "next-runtime-env";

import type { dbClient } from "@kan/db/client";
import * as memberRepo from "@kan/db/repository/member.repo";
import * as userRepo from "@kan/db/repository/user.repo";
import { notificationClient } from "@kan/email";
import { createEmailUnsubscribeLink, createS3Client } from "@kan/shared";

import { downloadImage } from "./utils";

type BetterAuthUser = {
  id: string;
  createdAt: Date;
  updatedAt: Date;
  email: string;
  emailVerified: boolean;
  name: string;
  image?: string | null | undefined;
  stripeCustomerId?: string | null | undefined;
} & Record<string, unknown>;

export function createDatabaseHooks(db: dbClient) {
  return {
    user: {
      create: {
        async before(user: BetterAuthUser, _context: unknown) {
          if (env("NEXT_PUBLIC_DISABLE_SIGN_UP")?.toLowerCase() === "true") {
            const pendingInvitation = await memberRepo.getByEmailAndStatus(
              db,
              user.email,
              "invited",
            );

            if (!pendingInvitation) {
              return Promise.resolve(false);
            }

            // Fall through to any additional checks below
          }
          // Enforce allowed domains (OIDC/social) if configured
          const allowed = process.env.BETTER_AUTH_ALLOWED_DOMAINS?.split(",")
            .map((d) => d.trim().toLowerCase())
            .filter(Boolean);
          if (allowed && allowed.length > 0) {
            const domain = user.email.split("@")[1]?.toLowerCase();
            if (!domain || !allowed.includes(domain)) {
              return Promise.resolve(false);
            }
          }
          return Promise.resolve(true);
        },
        async after(user: BetterAuthUser, _context: unknown) {
          let avatarKey = user.image;
          const storageDomain = process.env.NEXT_PUBLIC_STORAGE_DOMAIN;
          if (
            user.image &&
            storageDomain &&
            !user.image.includes(storageDomain)
          ) {
            try {
              const client = createS3Client();

              const allowedFileExtensions = ["jpg", "jpeg", "png", "webp"];

              const fileExtension =
                user.image.split(".").pop()?.split("?")[0] ?? "jpg";
              const key = `${user.id}/avatar.${!allowedFileExtensions.includes(fileExtension) ? "jpg" : fileExtension}`;

              const imageBuffer = await downloadImage(user.image);

              await client.send(
                new PutObjectCommand({
                  Bucket: env("NEXT_PUBLIC_AVATAR_BUCKET_NAME") ?? "",
                  Key: key,
                  Body: imageBuffer,
                  ContentType: `image/${!allowedFileExtensions.includes(fileExtension) ? "jpeg" : fileExtension}`,
                  ACL: "public-read",
                }),
              );

              avatarKey = key;

              await userRepo.update(db, user.id, {
                image: key,
              });
            } catch (error) {
              console.error(error);
            }
          }

          if (notificationClient) {
            try {
              const [firstName, ...rest] = (user.name || "")
                .split(" ")
                .filter(Boolean);
              const lastName = rest.length ? rest.join(" ") : undefined;
              const avatarUrl = avatarKey
                ? `${env("NEXT_PUBLIC_STORAGE_URL")}/${env("NEXT_PUBLIC_AVATAR_BUCKET_NAME")}/${avatarKey}`
                : undefined;

              const unsubscribeUrl = await createEmailUnsubscribeLink(user.id);

              await notificationClient.trigger({
                to: {
                  subscriberId: user.id,
                  firstName: firstName,
                  lastName: lastName,
                  email: user.email,
                  avatar: avatarUrl,
                  data: {
                    emailVerified: user.emailVerified,
                    stripeCustomerId: user.stripeCustomerId,
                    createdAt: user.createdAt,
                    updatedAt: user.updatedAt,
                  },
                },
                payload: {
                  emailUnsubscribeUrl: unsubscribeUrl,
                },
                workflowId: "user-signup",
              });

              await notificationClient.subscribers.credentials.update(
                {
                  providerId: ChatOrPushProviderEnum.Discord,
                  credentials: {
                    webhookUrl: env("DISCORD_WEBHOOK_URL"),
                  },
                  integrationIdentifier: "discord",
                },
                user.id,
              );
            } catch (error) {
              console.error("Error adding user to notification client", error);
            }
          }
        },
      },
    },
  };
}

export function createMiddlewareHooks(db: dbClient) {
  return {
    after: createAuthMiddleware(async (ctx) => {
      if (
        ctx.path === "/magic-link/verify" &&
        (ctx.query?.callbackURL as string | undefined)?.includes("type=invite")
      ) {
        const userId = ctx.context.newSession?.session.userId;
        const callbackURL = ctx.query?.callbackURL as string | undefined;
        const memberPublicId = callbackURL?.split("memberPublicId=")[1];

        if (userId && memberPublicId) {
          const member = await memberRepo.getByPublicId(db, memberPublicId);

          if (member?.id) {
            await memberRepo.acceptInvite(db, {
              memberId: member.id,
              userId,
            });
          }
        }
      }
    }),
  };
}



================================================
FILE: packages/auth/src/index.ts
================================================
export const name = "auth";



================================================
FILE: packages/auth/src/plugins.ts
================================================
import { stripe } from "@better-auth/stripe";
import { apiKey, genericOAuth } from "better-auth/plugins";
import { magicLink } from "better-auth/plugins/magic-link";

import type { dbClient } from "@kan/db/client";
import * as memberRepo from "@kan/db/repository/member.repo";
import * as subscriptionRepo from "@kan/db/repository/subscription.repo";
import * as userRepo from "@kan/db/repository/user.repo";
import * as workspaceRepo from "@kan/db/repository/workspace.repo";
import { generateUID } from "@kan/shared/utils";
import { sendEmail } from "@kan/email";
import { createStripeClient } from "@kan/stripe";

import { socialProvidersPlugin } from "./providers";
import { triggerWorkflow } from "./utils";

export function createPlugins(db: dbClient) {
  return [
    socialProvidersPlugin(),
    ...(process.env.NEXT_PUBLIC_KAN_ENV === "cloud"
      ? [
          stripe({
            stripeClient: createStripeClient(),
            stripeWebhookSecret: process.env.STRIPE_WEBHOOK_SECRET!,
            createCustomerOnSignUp: true,
            subscription: {
              enabled: true,
              plans: [
                {
                  name: "team",
                  priceId: process.env.STRIPE_TEAM_PLAN_MONTHLY_PRICE_ID!,
                  annualDiscountPriceId:
                    process.env.STRIPE_TEAM_PLAN_YEARLY_PRICE_ID!,
                  freeTrial: {
                    days: 14,
                    onTrialStart: async (subscription) => {
                      await triggerWorkflow(db, "trial-start", subscription);
                    },
                    onTrialEnd: async ({ subscription }) => {
                      await triggerWorkflow(db, "trial-end", subscription);
                    },
                    onTrialExpired: async (subscription) => {
                      await triggerWorkflow(db, "trial-expired", subscription);
                    },
                  },
                },
                {
                  name: "pro",
                  priceId: process.env.STRIPE_PRO_PLAN_MONTHLY_PRICE_ID!,
                  annualDiscountPriceId:
                    process.env.STRIPE_PRO_PLAN_YEARLY_PRICE_ID!,
                  freeTrial: {
                    days: 14,
                    onTrialStart: async (subscription) => {
                      await triggerWorkflow(db, "trial-start", subscription);
                    },
                    onTrialEnd: async ({ subscription }) => {
                      await triggerWorkflow(db, "trial-end", subscription);
                    },
                    onTrialExpired: async (subscription) => {
                      await triggerWorkflow(db, "trial-expired", subscription);
                    },
                  },
                },
              ],
              authorizeReference: async (data) => {
                const workspace = await workspaceRepo.getByPublicId(
                  db,
                  data.referenceId,
                );

                if (!workspace) {
                  return Promise.resolve(false);
                }

                const isUserInWorkspace = await workspaceRepo.isUserInWorkspace(
                  db,
                  data.user.id,
                  workspace.id,
                );

                return isUserInWorkspace;
              },
              getCheckoutSessionParams: () => {
                return {
                  params: {
                    allow_promotion_codes: true,
                  },
                };
              },
              onSubscriptionComplete: async ({
                subscription,
                stripeSubscription,
              }) => {
                // Set unlimited seats to true for pro plans
                if (subscription.plan === "pro") {
                  await subscriptionRepo.updateByStripeSubscriptionId(
                    db,
                    stripeSubscription.id,
                    {
                      unlimitedSeats: true,
                    },
                  );
                  console.log(
                    `Pro subscription ${stripeSubscription.id} activated with unlimited seats`,
                  );

                  const workspace = await workspaceRepo.getByPublicId(
                    db,
                    subscription.referenceId,
                  );

                  if (workspace?.id) {
                    await memberRepo.unpauseAllMembers(db, workspace.id);
                  }
                }
              },
              onSubscriptionCancel: async ({
                subscription,
                cancellationDetails,
              }) => {
                await triggerWorkflow(
                  db,
                  "subscription-canceled",
                  subscription,
                  cancellationDetails,
                );

                // for cancelled subscriptions, we need to pause all members and set their workspace plan to free
                const workspace = await workspaceRepo.getByPublicId(
                  db,
                  subscription.referenceId,
                );

                if (workspace?.id) {
                  await memberRepo.pauseAllMembers(db, workspace.id);

                  // Reset slug to publicId, or generate a UID if publicId is taken
                  let newSlug = workspace.publicId;

                  if (workspace.slug !== workspace.publicId) {
                    const isPublicIdAvailable = await workspaceRepo.isWorkspaceSlugAvailable(
                      db,
                      workspace.publicId,
                    );
                    if (!isPublicIdAvailable) {
                      newSlug = generateUID();
                    }
                  }

                  await workspaceRepo.update(db, subscription.referenceId, {
                    plan: "free",
                    slug: newSlug,
                  });
                }
              },
              onSubscriptionUpdate: async ({ subscription }) => {
                await triggerWorkflow(db, "subscription-updated", subscription);
              },
            },
          }),
        ]
      : []),
    apiKey({
      enableSessionForAPIKeys: true,
      rateLimit: {
        enabled: true,
        timeWindow: 1000 * 60, // 1 minute
        maxRequests: 100, // 100 requests per minute
      },
    }),
    magicLink({
      expiresIn: 60 * 60 * 24 * 7, // 7 days
      sendMagicLink: async ({ email, url }) => {
        const decodedUrl = decodeURIComponent(url);
        console.log("Sending magic link to:", email, "URL:", url);
        console.log(
          "Magic link contains invite:",
          decodedUrl.includes("type=invite"),
        );
        if (decodedUrl.includes("type=invite")) {
          let inviterName = "";
          let workspaceName = "";

          try {
            const urlObj = new URL(url);
            const callbackUrl = urlObj.searchParams.get("callbackURL");
            if (callbackUrl) {
              const callbackParams = new URL(
                callbackUrl,
                process.env.NEXT_PUBLIC_BASE_URL,
              ).searchParams;
              const memberPublicId = callbackParams.get("memberPublicId");

              if (memberPublicId) {
                const member = await memberRepo.getByPublicId(
                  db,
                  memberPublicId,
                );
                if (member) {
                  const [workspace, inviter] = await Promise.all([
                    workspaceRepo.getById(db, member.workspaceId),
                    userRepo.getById(db, member.createdBy),
                  ]);

                  if (workspace) workspaceName = workspace.name;
                  if (inviter) inviterName = inviter.name ?? "";
                }
              }
            }
          } catch (error) {
            console.error("Failed to fetch invite details:", error);
          }

          await sendEmail(
            email,
            workspaceName
              ? `Invitation to join the workspace ${workspaceName}`
              : "Invitation to join workspace",
            "JOIN_WORKSPACE",
            {
              magicLoginUrl: url,
              inviterName,
              workspaceName,
            },
          );
        } else {
          await sendEmail(
            email,
            process.env.NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY === "true"
              ? "Sign in to your account"
              : "Sign in to Kan",
            "MAGIC_LINK",
            {
              magicLoginUrl: url,
            },
          );
        }
      },
    }),
    // Generic OIDC provider
    ...(process.env.OIDC_CLIENT_ID &&
    process.env.OIDC_CLIENT_SECRET &&
    process.env.OIDC_DISCOVERY_URL
      ? [
          genericOAuth({
            config: [
              {
                providerId: "oidc",
                clientId: process.env.OIDC_CLIENT_ID,
                clientSecret: process.env.OIDC_CLIENT_SECRET,
                discoveryUrl: process.env.OIDC_DISCOVERY_URL,
                scopes: ["openid", "email", "profile"],
                pkce: true,
                mapProfileToUser: (profile: {
                  name?: string;
                  display_name?: string;
                  preferred_username?: string;
                  given_name?: string;
                  family_name?: string;
                  email?: string;
                  email_verified?: boolean;
                  sub?: string;
                  picture?: string;
                  avatar?: string;
                }) => {
                  console.log("OIDC profile:", profile);

                  const name =
                    profile.name ??
                    profile.display_name ??
                    profile.preferred_username ??
                    (profile.given_name && profile.family_name
                      ? `${profile.given_name} ${profile.family_name}`.trim()
                      : (profile.given_name ?? profile.family_name)) ??
                    profile.sub ??
                    "";

                  return {
                    email: profile.email,
                    name: name,
                    emailVerified: profile.email_verified ?? false,
                    image: profile.picture ?? profile.avatar ?? null,
                  };
                },
              },
            ],
          }),
        ]
      : []),
  ];
}



================================================
FILE: packages/auth/src/providers.ts
================================================
import { createAuthEndpoint } from "better-auth/api";
import { socialProviderList } from "better-auth/social-providers";

export const configuredProviders = socialProviderList.reduce<
  Record<
    string,
    {
      clientId: string;
      clientSecret: string;
      appBundleIdentifier?: string;
      tenantId?: string;
      requireSelectAccount?: boolean;
      clientKey?: string;
      issuer?: string;
      // Google-specific optional hints
      hostedDomain?: string;
      hd?: string;
    }
  >
>((acc, provider) => {
  const id = process.env[`${provider.toUpperCase()}_CLIENT_ID`];
  const secret = process.env[`${provider.toUpperCase()}_CLIENT_SECRET`];
  if (id && id.length > 0 && secret && secret.length > 0) {
    acc[provider] = { clientId: id, clientSecret: secret };
  }
  if (
    provider === "apple" &&
    Object.keys(acc).includes("apple") &&
    acc[provider]
  ) {
    const bundleId =
      process.env[`${provider.toUpperCase()}_APP_BUNDLE_IDENTIFIER`];
    if (bundleId && bundleId.length > 0) {
      acc[provider].appBundleIdentifier = bundleId;
    }
  }
  if (
    provider === "gitlab" &&
    Object.keys(acc).includes("gitlab") &&
    acc[provider]
  ) {
    const issuer = process.env[`${provider.toUpperCase()}_ISSUER`];
    if (issuer && issuer.length > 0) {
      acc[provider].issuer = issuer;
    }
  }
  if (
    provider === "microsoft" &&
    Object.keys(acc).includes("microsoft") &&
    acc[provider]
  ) {
    acc[provider].tenantId = "common";
    acc[provider].requireSelectAccount = true;
  }
  // Add Google domain hint if allowed domains is configured
  if (
    provider === "google" &&
    Object.keys(acc).includes("google") &&
    acc[provider]
  ) {
    const allowed = process.env.BETTER_AUTH_ALLOWED_DOMAINS?.split(",")
      .map((d) => d.trim().toLowerCase())
      .filter(Boolean);
    if (allowed && allowed.length > 0) {
      // Use the first domain as an authorization hint
      acc[provider].hostedDomain = allowed[0];
      acc[provider].hd = allowed[0];
    }
  }
  if (
    provider === "tiktok" &&
    Object.keys(acc).includes("tiktok") &&
    acc[provider]
  ) {
    const key = process.env[`${provider.toUpperCase()}_CLIENT_KEY`];
    if (key && key.length > 0) {
      acc[provider].clientKey = key;
    }
  }
  return acc;
}, {});

export const socialProvidersPlugin = () => ({
  id: "social-providers-plugin",
  endpoints: {
    getSocialProviders: createAuthEndpoint(
      "/social-providers",
      {
        method: "GET",
      },
      async (ctx) => {
        const providers = ctx.context.socialProviders.map((p) =>
          p.id.toLowerCase(),
        );
        // Add OIDC provider if configured
        if (
          process.env.OIDC_CLIENT_ID &&
          process.env.OIDC_CLIENT_SECRET &&
          process.env.OIDC_DISCOVERY_URL
        ) {
          providers.push("oidc");
        }
        return ctx.json(providers);
      },
    ),
  },
});



================================================
FILE: packages/auth/src/server.ts
================================================
export { initAuth } from "./auth";



================================================
FILE: packages/auth/src/utils.ts
================================================
import type { Subscription } from "@better-auth/stripe";
import type Stripe from "stripe";

import type { dbClient } from "@kan/db/client";
import * as userRepo from "@kan/db/repository/user.repo";
import { notificationClient } from "@kan/email";
import { createEmailUnsubscribeLink } from "@kan/shared";

export async function downloadImage(url: string): Promise<Buffer> {
  const response = await fetch(url);
  if (!response.ok) {
    throw new Error(`Failed to download image: ${response.statusText}`);
  }
  return Buffer.from(await response.arrayBuffer());
}

export async function triggerWorkflow(
  db: dbClient,
  workflowId: string,
  subscription: Subscription,
  cancellationDetails?: Stripe.Subscription.CancellationDetails | null,
) {
  try {
    if (!subscription.stripeCustomerId || !notificationClient) return;

    const user = await userRepo.getByStripeCustomerId(
      db,
      subscription.stripeCustomerId,
    );

    if (!user || !notificationClient) return;

    const unsubscribeUrl = await createEmailUnsubscribeLink(user.id);

    await notificationClient.trigger({
      to: {
        subscriberId: user.id,
      },
      payload: {
        ...subscription,
        cancellationDetails,
        emailUnsubscribeUrl: unsubscribeUrl,
      },
      workflowId,
    });
  } catch (error) {
    console.error("Error triggering workflow", error);
  }
}



================================================
FILE: packages/db/drizzle.config.ts
================================================
import { type Config } from "drizzle-kit";

export default {
  schema: "./src/schema",
  out: "./migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.POSTGRES_URL ?? "",
    ssl: process.env.NODE_ENV === "production" ? true : false,
  },
  migrations: {
    prefix: "timestamp",
  },
} satisfies Config;



================================================
FILE: packages/db/eslint.config.js
================================================
import baseConfig from "@kan/eslint-config/base";

/** @type {import('typescript-eslint').Config} */
export default [
  {
    ignores: ["dist/**"],
  },
  ...baseConfig,
];


================================================
FILE: packages/db/package.json
================================================
{
  "name": "@kan/db",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./src/index.ts"
    },
    "./client": {
      "types": "./dist/client.d.ts",
      "default": "./src/client.ts"
    },
    "./schema": {
      "types": "./dist/schema.d.ts",
      "default": "./src/schema/index.ts"
    },
    "./types/*": {
      "types": "./dist/types/*.d.ts",
      "default": "./src/types/*"
    },
    "./repository/*": {
      "types": "./dist/repository/*.d.ts",
      "default": "./src/repository/*.ts"
    },
    "./redis": {
      "types": "./dist/redis.d.ts",
      "default": "./src/redis.ts"
    }
  },
  "license": "GPL-3.0",
  "scripts": {
    "build": "tsc",
    "clean": "git clean -xdf .cache .turbo dist node_modules",
    "dev": "tsc",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "migrate": "pnpm with-env drizzle-kit migrate",
    "push": "pnpm with-env drizzle-kit push",
    "studio": "pnpm with-env drizzle-kit studio",
    "typecheck": "tsc --noEmit --emitDeclarationOnly false",
    "with-env": "dotenv -e ../../.env --"
  },
  "dependencies": {
    "@electric-sql/pglite": "^0.3.7",
    "@kan/shared": "workspace:^",
    "drizzle-orm": "^0.42.0",
    "drizzle-zod": "^0.5.1",
    "ioredis": "^5.9.2",
    "pg": "^8.11.3",
    "uuid": "^11.1.0",
    "zod": "catalog:"
  },
  "devDependencies": {
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "@types/pg": "^8.10.9",
    "dotenv-cli": "^7.4.4",
    "drizzle-kit": "^0.28.1",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config"
}



================================================
FILE: packages/db/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/internal-package.json",
  "include": ["src"],
  "exclude": ["node_modules"],
  "compilerOptions": {
    "rootDir": "./src"
  }
}



================================================
FILE: packages/db/migrations/20250508083758_SetupTables.sql
================================================
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";--> statement-breakpoint

CREATE TYPE "public"."board_visibility" AS ENUM('private', 'public');--> statement-breakpoint
CREATE TYPE "public"."card_activity_type" AS ENUM('card.created', 'card.updated.title', 'card.updated.description', 'card.updated.index', 'card.updated.list', 'card.updated.label.added', 'card.updated.label.removed', 'card.updated.member.added', 'card.updated.member.removed', 'card.updated.comment.added', 'card.updated.comment.updated', 'card.updated.comment.deleted', 'card.archived');--> statement-breakpoint
CREATE TYPE "public"."source" AS ENUM('trello');--> statement-breakpoint
CREATE TYPE "public"."status" AS ENUM('started', 'success', 'failed');--> statement-breakpoint
CREATE TYPE "public"."role" AS ENUM('admin', 'member', 'guest');--> statement-breakpoint
CREATE TYPE "public"."member_status" AS ENUM('invited', 'active', 'removed');--> statement-breakpoint
CREATE TYPE "public"."slug_type" AS ENUM('reserved', 'premium');--> statement-breakpoint
CREATE TYPE "public"."workspace_plan" AS ENUM('free', 'pro', 'enterprise');--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "account" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"accountId" text NOT NULL,
	"providerId" text NOT NULL,
	"userId" uuid NOT NULL,
	"accessToken" text,
	"refreshToken" text,
	"idToken" text,
	"accessTokenExpiresAt" timestamp,
	"refreshTokenExpiresAt" timestamp,
	"scope" text,
	"password" text,
	"createdAt" timestamp NOT NULL,
	"updatedAt" timestamp NOT NULL
);
--> statement-breakpoint
ALTER TABLE "account" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "apiKey" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"name" text,
	"start" text,
	"prefix" text,
	"key" text NOT NULL,
	"userId" uuid NOT NULL,
	"refillInterval" integer,
	"refillAmount" integer,
	"lastRefillAt" timestamp,
	"enabled" boolean,
	"rateLimitEnabled" boolean,
	"rateLimitTimeWindow" integer,
	"rateLimitMax" integer,
	"requestCount" integer,
	"remaining" integer,
	"lastRequest" timestamp,
	"expiresAt" timestamp,
	"createdAt" timestamp NOT NULL,
	"updatedAt" timestamp NOT NULL,
	"permissions" text,
	"metadata" text
);
--> statement-breakpoint
ALTER TABLE "apiKey" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "session" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"expiresAt" timestamp NOT NULL,
	"token" text NOT NULL,
	"createdAt" timestamp NOT NULL,
	"updatedAt" timestamp NOT NULL,
	"ipAddress" text,
	"userAgent" text,
	"userId" uuid NOT NULL,
	CONSTRAINT "session_token_unique" UNIQUE("token")
);
--> statement-breakpoint
ALTER TABLE "session" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "verification" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"identifier" text NOT NULL,
	"value" text NOT NULL,
	"expiresAt" timestamp NOT NULL,
	"createdAt" timestamp,
	"updatedAt" timestamp
);
--> statement-breakpoint
ALTER TABLE "verification" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "board" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"name" varchar(255) NOT NULL,
	"description" text,
	"slug" varchar(255) NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"deletedAt" timestamp,
	"deletedBy" uuid,
	"importId" bigint,
	"workspaceId" bigint NOT NULL,
	"visibility" "board_visibility" DEFAULT 'private' NOT NULL,
	CONSTRAINT "board_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "board" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "card_activity" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"type" "card_activity_type" NOT NULL,
	"cardId" bigint NOT NULL,
	"fromIndex" integer,
	"toIndex" integer,
	"fromListId" bigint,
	"toListId" bigint,
	"labelId" bigint,
	"workspaceMemberId" bigint,
	"fromTitle" varchar(255),
	"toTitle" varchar(255),
	"fromDescription" text,
	"toDescription" text,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"commentId" bigint,
	"fromComment" text,
	"toComment" text,
	CONSTRAINT "card_activity_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "card_activity" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "_card_workspace_members" (
	"cardId" bigint NOT NULL,
	"workspaceMemberId" bigint NOT NULL,
	CONSTRAINT "_card_workspace_members_cardId_workspaceMemberId_pk" PRIMARY KEY("cardId","workspaceMemberId")
);
--> statement-breakpoint
ALTER TABLE "_card_workspace_members" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "card" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"title" varchar(255) NOT NULL,
	"description" text,
	"index" integer NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"deletedAt" timestamp,
	"deletedBy" uuid,
	"listId" bigint NOT NULL,
	"importId" bigint,
	CONSTRAINT "card_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "card" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "_card_labels" (
	"cardId" bigint NOT NULL,
	"labelId" bigint NOT NULL,
	CONSTRAINT "_card_labels_cardId_labelId_pk" PRIMARY KEY("cardId","labelId")
);
--> statement-breakpoint
ALTER TABLE "_card_labels" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "card_comments" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"comment" text NOT NULL,
	"cardId" bigint NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"deletedAt" timestamp,
	"deletedBy" uuid,
	CONSTRAINT "card_comments_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "card_comments" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "feedback" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"feedback" text NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"url" text NOT NULL,
	"reviewed" boolean DEFAULT false NOT NULL
);
--> statement-breakpoint
ALTER TABLE "feedback" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "import" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"source" "source" NOT NULL,
	"status" "status" NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	CONSTRAINT "import_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "import" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "label" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"name" varchar(255) NOT NULL,
	"colourCode" varchar(12),
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"boardId" bigint NOT NULL,
	"importId" bigint,
	CONSTRAINT "label_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "label" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "list" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"name" varchar(255) NOT NULL,
	"index" integer NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"deletedAt" timestamp,
	"deletedBy" uuid,
	"boardId" bigint NOT NULL,
	"importId" bigint,
	CONSTRAINT "list_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "list" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "user" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"name" varchar(255),
	"email" varchar(255) NOT NULL,
	"emailVerified" boolean NOT NULL,
	"image" varchar(255),
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp DEFAULT now() NOT NULL,
	"stripeCustomerId" varchar(255),
	CONSTRAINT "user_email_unique" UNIQUE("email")
);
--> statement-breakpoint
ALTER TABLE "user" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "workspace_slugs" (
	"slug" varchar(255) NOT NULL,
	"type" "slug_type" NOT NULL,
	CONSTRAINT "workspace_slugs_slug_unique" UNIQUE("slug")
);
--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "workspace_members" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"userId" uuid NOT NULL,
	"workspaceId" bigint NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"deletedAt" timestamp,
	"deletedBy" uuid,
	"role" "role" NOT NULL,
	"status" "member_status" DEFAULT 'invited' NOT NULL,
	CONSTRAINT "workspace_members_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "workspace_members" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "workspace" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"name" varchar(255) NOT NULL,
	"description" text,
	"slug" varchar(255) NOT NULL,
	"plan" "workspace_plan" DEFAULT 'free' NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"deletedAt" timestamp,
	"deletedBy" uuid,
	CONSTRAINT "workspace_publicId_unique" UNIQUE("publicId"),
	CONSTRAINT "workspace_slug_unique" UNIQUE("slug")
);
--> statement-breakpoint
ALTER TABLE "workspace" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "account" ADD CONSTRAINT "account_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "apiKey" ADD CONSTRAINT "apiKey_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "session" ADD CONSTRAINT "session_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "board" ADD CONSTRAINT "board_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "board" ADD CONSTRAINT "board_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "board" ADD CONSTRAINT "board_importId_import_id_fk" FOREIGN KEY ("importId") REFERENCES "public"."import"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "board" ADD CONSTRAINT "board_workspaceId_workspace_id_fk" FOREIGN KEY ("workspaceId") REFERENCES "public"."workspace"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_fromListId_list_id_fk" FOREIGN KEY ("fromListId") REFERENCES "public"."list"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_toListId_list_id_fk" FOREIGN KEY ("toListId") REFERENCES "public"."list"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_labelId_label_id_fk" FOREIGN KEY ("labelId") REFERENCES "public"."label"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_workspaceMemberId_workspace_members_id_fk" FOREIGN KEY ("workspaceMemberId") REFERENCES "public"."workspace_members"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_commentId_card_comments_id_fk" FOREIGN KEY ("commentId") REFERENCES "public"."card_comments"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "_card_workspace_members" ADD CONSTRAINT "_card_workspace_members_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "_card_workspace_members" ADD CONSTRAINT "_card_workspace_members_workspaceMemberId_workspace_members_id_fk" FOREIGN KEY ("workspaceMemberId") REFERENCES "public"."workspace_members"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card" ADD CONSTRAINT "card_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card" ADD CONSTRAINT "card_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card" ADD CONSTRAINT "card_listId_list_id_fk" FOREIGN KEY ("listId") REFERENCES "public"."list"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card" ADD CONSTRAINT "card_importId_import_id_fk" FOREIGN KEY ("importId") REFERENCES "public"."import"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "_card_labels" ADD CONSTRAINT "_card_labels_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "_card_labels" ADD CONSTRAINT "_card_labels_labelId_label_id_fk" FOREIGN KEY ("labelId") REFERENCES "public"."label"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_comments" ADD CONSTRAINT "card_comments_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_comments" ADD CONSTRAINT "card_comments_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_comments" ADD CONSTRAINT "card_comments_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "feedback" ADD CONSTRAINT "feedback_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "import" ADD CONSTRAINT "import_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "label" ADD CONSTRAINT "label_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "label" ADD CONSTRAINT "label_boardId_board_id_fk" FOREIGN KEY ("boardId") REFERENCES "public"."board"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "label" ADD CONSTRAINT "label_importId_import_id_fk" FOREIGN KEY ("importId") REFERENCES "public"."import"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "list" ADD CONSTRAINT "list_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "list" ADD CONSTRAINT "list_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "list" ADD CONSTRAINT "list_boardId_board_id_fk" FOREIGN KEY ("boardId") REFERENCES "public"."board"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "list" ADD CONSTRAINT "list_importId_import_id_fk" FOREIGN KEY ("importId") REFERENCES "public"."import"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_members" ADD CONSTRAINT "workspace_members_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_members" ADD CONSTRAINT "workspace_members_workspaceId_workspace_id_fk" FOREIGN KEY ("workspaceId") REFERENCES "public"."workspace"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_members" ADD CONSTRAINT "workspace_members_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace" ADD CONSTRAINT "workspace_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace" ADD CONSTRAINT "workspace_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "board_visibility_idx" ON "board" USING btree ("visibility");--> statement-breakpoint
CREATE UNIQUE INDEX IF NOT EXISTS "unique_slug_per_workspace" ON "board" USING btree ("workspaceId","slug") WHERE "board"."deletedAt" IS NULL;


================================================
FILE: packages/db/migrations/20250522083748_AddEmailToWorkspaceMembers.sql
================================================
ALTER TABLE "workspace_members" ALTER COLUMN "userId" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "workspace_members" ADD COLUMN "email" varchar(255);--> statement-breakpoint
UPDATE "workspace_members" wm SET "email" = u."email" FROM "user" u WHERE wm."userId" = u."id";--> statement-breakpoint
ALTER TABLE "workspace_members" ALTER COLUMN "email" SET NOT NULL;


================================================
FILE: packages/db/migrations/20250527203813_AddDeletedAtToLabel.sql
================================================
ALTER TABLE "label" ADD COLUMN "deletedAt" timestamp;--> statement-breakpoint
ALTER TABLE "label" ADD COLUMN "deletedBy" uuid;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "label" ADD CONSTRAINT "label_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20250605101155_AddCascadeDeleteToCardRelations.sql
================================================
ALTER TABLE "card_activity" DROP CONSTRAINT "card_activity_fromListId_list_id_fk";
--> statement-breakpoint
ALTER TABLE "card_activity" DROP CONSTRAINT "card_activity_toListId_list_id_fk";
--> statement-breakpoint
ALTER TABLE "card_activity" DROP CONSTRAINT "card_activity_labelId_label_id_fk";
--> statement-breakpoint
ALTER TABLE "card_activity" DROP CONSTRAINT "card_activity_workspaceMemberId_workspace_members_id_fk";
--> statement-breakpoint
ALTER TABLE "card_activity" DROP CONSTRAINT "card_activity_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "card_activity" DROP CONSTRAINT "card_activity_commentId_card_comments_id_fk";
--> statement-breakpoint
ALTER TABLE "_card_workspace_members" DROP CONSTRAINT "_card_workspace_members_cardId_card_id_fk";
--> statement-breakpoint
ALTER TABLE "_card_labels" DROP CONSTRAINT "_card_labels_cardId_card_id_fk";
--> statement-breakpoint
ALTER TABLE "card_comments" DROP CONSTRAINT "card_comments_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "card_comments" DROP CONSTRAINT "card_comments_deletedBy_user_id_fk";
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_fromListId_list_id_fk" FOREIGN KEY ("fromListId") REFERENCES "public"."list"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_toListId_list_id_fk" FOREIGN KEY ("toListId") REFERENCES "public"."list"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_labelId_label_id_fk" FOREIGN KEY ("labelId") REFERENCES "public"."label"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_workspaceMemberId_workspace_members_id_fk" FOREIGN KEY ("workspaceMemberId") REFERENCES "public"."workspace_members"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_commentId_card_comments_id_fk" FOREIGN KEY ("commentId") REFERENCES "public"."card_comments"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "_card_workspace_members" ADD CONSTRAINT "_card_workspace_members_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "_card_labels" ADD CONSTRAINT "_card_labels_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_comments" ADD CONSTRAINT "card_comments_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_comments" ADD CONSTRAINT "card_comments_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;


================================================
FILE: packages/db/migrations/20250608100932_AddIntegrationsTable.sql
================================================
CREATE TABLE IF NOT EXISTS "integration" (
	"provider" varchar(255) NOT NULL,
	"userId" uuid NOT NULL,
	"accessToken" varchar(255) NOT NULL,
	"refreshToken" varchar(255),
	"expiresAt" timestamp NOT NULL,
	"createdAt" timestamp NOT NULL,
	"updatedAt" timestamp,
	CONSTRAINT "integration_pkey" PRIMARY KEY("userId","provider")
);
--> statement-breakpoint
ALTER TABLE "integration" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "integration" ADD CONSTRAINT "integration_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20250608175448_AddOnDeleteActionToUserDeletion.sql
================================================
ALTER TABLE "board" DROP CONSTRAINT "board_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "board" DROP CONSTRAINT "board_deletedBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "card_activity" DROP CONSTRAINT "card_activity_workspaceMemberId_workspace_members_id_fk";
--> statement-breakpoint
ALTER TABLE "card_activity" DROP CONSTRAINT "card_activity_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "card" DROP CONSTRAINT "card_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "card" DROP CONSTRAINT "card_deletedBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "card_comments" DROP CONSTRAINT "card_comments_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "card_comments" DROP CONSTRAINT "card_comments_deletedBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "feedback" DROP CONSTRAINT "feedback_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "import" DROP CONSTRAINT "import_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "label" DROP CONSTRAINT "label_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "label" DROP CONSTRAINT "label_deletedBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "list" DROP CONSTRAINT "list_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "list" DROP CONSTRAINT "list_deletedBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "workspace_members" DROP CONSTRAINT "workspace_members_userId_user_id_fk";
--> statement-breakpoint
ALTER TABLE "workspace_members" DROP CONSTRAINT "workspace_members_deletedBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "workspace" DROP CONSTRAINT "workspace_createdBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "workspace" DROP CONSTRAINT "workspace_deletedBy_user_id_fk";
--> statement-breakpoint
ALTER TABLE "board" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "card_activity" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "card" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "card_comments" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "feedback" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "import" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "label" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "list" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
ALTER TABLE "workspace" ALTER COLUMN "createdBy" DROP NOT NULL;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "board" ADD CONSTRAINT "board_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "board" ADD CONSTRAINT "board_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_workspaceMemberId_workspace_members_id_fk" FOREIGN KEY ("workspaceMemberId") REFERENCES "public"."workspace_members"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card" ADD CONSTRAINT "card_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card" ADD CONSTRAINT "card_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_comments" ADD CONSTRAINT "card_comments_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_comments" ADD CONSTRAINT "card_comments_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "feedback" ADD CONSTRAINT "feedback_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "import" ADD CONSTRAINT "import_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "label" ADD CONSTRAINT "label_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "label" ADD CONSTRAINT "label_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "list" ADD CONSTRAINT "list_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "list" ADD CONSTRAINT "list_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_members" ADD CONSTRAINT "workspace_members_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_members" ADD CONSTRAINT "workspace_members_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace" ADD CONSTRAINT "workspace_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace" ADD CONSTRAINT "workspace_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20250610200449_ReaddIntegrationTable.sql
================================================
CREATE TABLE IF NOT EXISTS "integration" (
	"provider" varchar(255) NOT NULL,
	"userId" uuid NOT NULL,
	"accessToken" varchar(255) NOT NULL,
	"refreshToken" varchar(255),
	"expiresAt" timestamp NOT NULL,
	"createdAt" timestamp NOT NULL,
	"updatedAt" timestamp,
	CONSTRAINT "integration_pkey" PRIMARY KEY("userId","provider")
);
--> statement-breakpoint
ALTER TABLE "integration" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "integration" ADD CONSTRAINT "integration_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;


================================================
FILE: packages/db/migrations/20250806202106_glossy_luminals.sql
================================================
CREATE TABLE IF NOT EXISTS "card_checklist_item" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"title" varchar(500) NOT NULL,
	"completed" boolean DEFAULT false NOT NULL,
	"index" integer NOT NULL,
	"checklistId" bigint NOT NULL,
	"createdBy" uuid,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"deletedAt" timestamp,
	"deletedBy" uuid,
	CONSTRAINT "card_checklist_item_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "card_checklist_item" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "card_checklist" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"name" varchar(255) NOT NULL,
	"index" integer NOT NULL,
	"cardId" bigint NOT NULL,
	"createdBy" uuid,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	"deletedAt" timestamp,
	"deletedBy" uuid,
	CONSTRAINT "card_checklist_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "card_checklist" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "integration" (
	"provider" varchar(255) NOT NULL,
	"userId" uuid NOT NULL,
	"accessToken" varchar(255) NOT NULL,
	"refreshToken" varchar(255),
	"expiresAt" timestamp NOT NULL,
	"createdAt" timestamp NOT NULL,
	"updatedAt" timestamp,
	CONSTRAINT "integration_pkey" PRIMARY KEY("userId","provider")
);
--> statement-breakpoint
ALTER TABLE "integration" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_checklist_item" ADD CONSTRAINT "card_checklist_item_checklistId_card_checklist_id_fk" FOREIGN KEY ("checklistId") REFERENCES "public"."card_checklist"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_checklist_item" ADD CONSTRAINT "card_checklist_item_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_checklist_item" ADD CONSTRAINT "card_checklist_item_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_checklist" ADD CONSTRAINT "card_checklist_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_checklist" ADD CONSTRAINT "card_checklist_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_checklist" ADD CONSTRAINT "card_checklist_deletedBy_user_id_fk" FOREIGN KEY ("deletedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "integration" ADD CONSTRAINT "integration_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20250813141748_AddChecklistActivityTypes.sql
================================================
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.checklist.added' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.checklist.renamed' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.checklist.deleted' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.checklist.item.added' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.checklist.item.updated' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.checklist.item.completed' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.checklist.item.uncompleted' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.checklist.item.deleted' BEFORE 'card.archived';


================================================
FILE: packages/db/migrations/20250902085406_AddSubscriptions.sql
================================================
CREATE TABLE IF NOT EXISTS "subscription" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"plan" varchar(255) NOT NULL,
	"referenceId" varchar(12) NOT NULL,
	"stripeCustomerId" varchar(255),
	"stripeSubscriptionId" varchar(255),
	"status" varchar(255) NOT NULL,
	"periodStart" timestamp,
	"periodEnd" timestamp,
	"cancelAtPeriodEnd" boolean,
	"seats" integer,
	"trialStart" timestamp,
	"trialEnd" timestamp,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "subscription" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "subscription" ADD CONSTRAINT "subscription_referenceId_workspace_publicId_fk" FOREIGN KEY ("referenceId") REFERENCES "public"."workspace"("publicId") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20250907185512_AddUnlimitedSeatsToSubscription.sql
================================================
ALTER TABLE "subscription" ADD COLUMN "unlimitedSeats" boolean DEFAULT false NOT NULL;


================================================
FILE: packages/db/migrations/20250910195058_RemoveNotNullConstraintFromReferenceIdOnSubsriptions.sql
================================================
ALTER TABLE "subscription" ALTER COLUMN "referenceId" DROP NOT NULL;


================================================
FILE: packages/db/migrations/20250910200416_AddWorkspaceSlugChecks.sql
================================================
CREATE TABLE IF NOT EXISTS "workspace_slug_checks" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"slug" varchar(255) NOT NULL,
	"available" boolean NOT NULL,
	"reserved" boolean NOT NULL,
	"workspaceId" bigint,
	"createdBy" uuid,
	"createdAt" timestamp DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "workspace_slug_checks" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_slug_checks" ADD CONSTRAINT "workspace_slug_checks_workspaceId_workspace_id_fk" FOREIGN KEY ("workspaceId") REFERENCES "public"."workspace"("id") ON DELETE no action ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_slug_checks" ADD CONSTRAINT "workspace_slug_checks_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20250910202358_AddCascadeSetNullToReferenceIdOnSubsriptions.sql
================================================
ALTER TABLE "subscription" DROP CONSTRAINT "subscription_referenceId_workspace_publicId_fk";
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "subscription" ADD CONSTRAINT "subscription_referenceId_workspace_publicId_fk" FOREIGN KEY ("referenceId") REFERENCES "public"."workspace"("publicId") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20250918201751_AddPausedMemberStatus.sql
================================================
ALTER TYPE "public"."member_status" ADD VALUE 'paused';


================================================
FILE: packages/db/migrations/20250923211958_AddWorkspaceInviteLinks.sql
================================================
CREATE TYPE "public"."invite_link_status" AS ENUM('active', 'inactive');--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "workspace_invite_links" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"workspaceId" bigint NOT NULL,
	"code" varchar(12) NOT NULL,
	"status" "invite_link_status" DEFAULT 'active' NOT NULL,
	"expiresAt" timestamp,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"createdBy" uuid,
	"updatedAt" timestamp,
	"updatedBy" uuid,
	CONSTRAINT "workspace_invite_links_publicId_unique" UNIQUE("publicId"),
	CONSTRAINT "workspace_invite_links_code_unique" UNIQUE("code")
);
--> statement-breakpoint
ALTER TABLE "workspace_invite_links" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_invite_links" ADD CONSTRAINT "workspace_invite_links_workspaceId_workspace_id_fk" FOREIGN KEY ("workspaceId") REFERENCES "public"."workspace"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_invite_links" ADD CONSTRAINT "workspace_invite_links_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_invite_links" ADD CONSTRAINT "workspace_invite_links_updatedBy_user_id_fk" FOREIGN KEY ("updatedBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20251001220136_AddFuzzySearchSupport.sql
================================================
CREATE EXTENSION IF NOT EXISTS pg_trgm; --> statement-breakpoint
CREATE INDEX IF NOT EXISTS boards_name_trgm_idx ON board USING gin (name gin_trgm_ops);
--> statement-breakpoint
CREATE INDEX IF NOT EXISTS cards_title_trgm_idx ON card USING gin (title gin_trgm_ops);



================================================
FILE: packages/db/migrations/20251007204129_AddBoardTypeAndSourceIdColumns.sql
================================================
CREATE TYPE "public"."board_type" AS ENUM('regular', 'template');--> statement-breakpoint
ALTER TABLE "board" ADD COLUMN "type" "board_type" DEFAULT 'regular' NOT NULL;--> statement-breakpoint
ALTER TABLE "board" ADD COLUMN "sourceBoardId" bigint;--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "board_type_idx" ON "board" USING btree ("type");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "board_source_idx" ON "board" USING btree ("sourceBoardId");


================================================
FILE: packages/db/migrations/20251009211316_AddBoardSourceIdToCardActivity.sql
================================================
ALTER TABLE "card_activity" ADD COLUMN "sourceBoardId" bigint;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_sourceBoardId_board_id_fk" FOREIGN KEY ("sourceBoardId") REFERENCES "public"."board"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20251110204423_AddCardAttachments.sql
================================================
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.attachment.added' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.attachment.removed' BEFORE 'card.archived';--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "card_attachment" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"cardId" bigint NOT NULL,
	"filename" varchar(255) NOT NULL,
	"originalFilename" varchar(255) NOT NULL,
	"contentType" varchar(100) NOT NULL,
	"size" bigint NOT NULL,
	"s3Key" varchar(500) NOT NULL,
	"createdBy" uuid,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"deletedAt" timestamp,
	CONSTRAINT "card_attachment_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "card_attachment" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_attachment" ADD CONSTRAINT "card_attachment_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_attachment" ADD CONSTRAINT "card_attachment_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE set null ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20251201204335_AddCardDueDates.sql
================================================
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.dueDate.added' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.dueDate.updated' BEFORE 'card.archived';--> statement-breakpoint
ALTER TYPE "public"."card_activity_type" ADD VALUE 'card.updated.dueDate.removed' BEFORE 'card.archived';--> statement-breakpoint
ALTER TABLE "card_activity" ADD COLUMN "fromDueDate" timestamp;--> statement-breakpoint
ALTER TABLE "card_activity" ADD COLUMN "toDueDate" timestamp;--> statement-breakpoint
ALTER TABLE "card" ADD COLUMN "dueDate" timestamp;


================================================
FILE: packages/db/migrations/20251229220153_UpdateCardTitleFromVarcharToText.sql
================================================
ALTER TABLE "card_activity" ALTER COLUMN "fromTitle" SET DATA TYPE text;--> statement-breakpoint
ALTER TABLE "card_activity" ALTER COLUMN "toTitle" SET DATA TYPE text;--> statement-breakpoint
ALTER TABLE "card" ALTER COLUMN "title" SET DATA TYPE text;


================================================
FILE: packages/db/migrations/20260119164257_AddShowEmailsToMembersToWorkspace.sql
================================================
ALTER TABLE "workspace" ADD COLUMN IF NOT EXISTS "showEmailsToMembers" boolean NOT NULL DEFAULT true;



================================================
FILE: packages/db/migrations/20260126135909_AddWorkspaceRoles.sql
================================================
CREATE TABLE IF NOT EXISTS "workspace_member_permissions" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"workspaceMemberId" bigint NOT NULL,
	"permission" varchar(64) NOT NULL,
	"granted" boolean DEFAULT true NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp
);
--> statement-breakpoint
ALTER TABLE "workspace_member_permissions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "workspace_role_permissions" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"workspaceRoleId" bigint NOT NULL,
	"permission" varchar(64) NOT NULL,
	"granted" boolean DEFAULT true NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "workspace_role_permissions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "workspace_roles" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"workspaceId" bigint NOT NULL,
	"name" varchar(64) NOT NULL,
	"description" varchar(255),
	"hierarchyLevel" integer NOT NULL,
	"isSystem" boolean DEFAULT false NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	CONSTRAINT "workspace_roles_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "workspace_roles" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
ALTER TABLE "workspace_members" ADD COLUMN "roleId" bigint;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_role_permissions" ADD CONSTRAINT "workspace_role_permissions_workspaceRoleId_workspace_roles_id_fk" FOREIGN KEY ("workspaceRoleId") REFERENCES "public"."workspace_roles"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_roles" ADD CONSTRAINT "workspace_roles_workspaceId_workspace_id_fk" FOREIGN KEY ("workspaceId") REFERENCES "public"."workspace"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
CREATE UNIQUE INDEX IF NOT EXISTS "unique_member_permission" ON "workspace_member_permissions" USING btree ("workspaceMemberId","permission");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "permission_member_idx" ON "workspace_member_permissions" USING btree ("workspaceMemberId");--> statement-breakpoint
CREATE UNIQUE INDEX IF NOT EXISTS "unique_role_permission" ON "workspace_role_permissions" USING btree ("workspaceRoleId","permission");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "role_permissions_role_idx" ON "workspace_role_permissions" USING btree ("workspaceRoleId");--> statement-breakpoint
CREATE UNIQUE INDEX IF NOT EXISTS "unique_role_per_workspace" ON "workspace_roles" USING btree ("workspaceId","name");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "workspace_roles_workspace_idx" ON "workspace_roles" USING btree ("workspaceId");--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_members" ADD CONSTRAINT "workspace_members_roleId_workspace_roles_id_fk" FOREIGN KEY ("roleId") REFERENCES "public"."workspace_roles"("id") ON DELETE restrict ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint

-- Helper function to generate 12-character public IDs
CREATE OR REPLACE FUNCTION generate_public_id() RETURNS varchar(12) AS $$
DECLARE
  chars text := 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  result varchar(12) := '';
  i integer;
BEGIN
  FOR i IN 1..12 LOOP
    result := result || substr(chars, floor(random() * length(chars) + 1)::integer, 1);
  END LOOP;
  RETURN result;
END;
$$ LANGUAGE plpgsql;
--> statement-breakpoint

-- Seed system roles for each existing workspace
INSERT INTO "workspace_roles" ("publicId", "workspaceId", "name", "description", "hierarchyLevel", "isSystem", "createdAt")
SELECT generate_public_id(), w.id, 'admin', 'Full access to all workspace features', 100, true, NOW()
FROM "workspace" w
WHERE NOT EXISTS (
  SELECT 1 FROM "workspace_roles" wr 
  WHERE wr."workspaceId" = w.id AND wr."name" = 'admin'
);
--> statement-breakpoint
INSERT INTO "workspace_roles" ("publicId", "workspaceId", "name", "description", "hierarchyLevel", "isSystem", "createdAt")
SELECT generate_public_id(), w.id, 'member', 'Standard member with create and edit permissions', 50, true, NOW()
FROM "workspace" w
WHERE NOT EXISTS (
  SELECT 1 FROM "workspace_roles" wr 
  WHERE wr."workspaceId" = w.id AND wr."name" = 'member'
);
--> statement-breakpoint
INSERT INTO "workspace_roles" ("publicId", "workspaceId", "name", "description", "hierarchyLevel", "isSystem", "createdAt")
SELECT generate_public_id(), w.id, 'guest', 'View-only access', 10, true, NOW()
FROM "workspace" w
WHERE NOT EXISTS (
  SELECT 1 FROM "workspace_roles" wr 
  WHERE wr."workspaceId" = w.id AND wr."name" = 'guest'
);
--> statement-breakpoint

-- Seed admin role permissions (all permissions)
INSERT INTO "workspace_role_permissions" ("workspaceRoleId", "permission", "granted", "createdAt")
SELECT wr.id, p.permission, true, NOW()
FROM "workspace_roles" wr
CROSS JOIN (
  VALUES 
    ('workspace:view'), ('workspace:edit'), ('workspace:delete'), ('workspace:manage'),
    ('board:view'), ('board:create'), ('board:edit'), ('board:delete'),
    ('list:view'), ('list:create'), ('list:edit'), ('list:delete'),
    ('card:view'), ('card:create'), ('card:edit'), ('card:delete'),
    ('comment:view'), ('comment:create'), ('comment:edit'), ('comment:delete'),
    ('member:view'), ('member:invite'), ('member:edit'), ('member:remove')
) AS p(permission)
WHERE wr."name" = 'admin' AND wr."isSystem" = true
AND NOT EXISTS (
  SELECT 1 FROM "workspace_role_permissions" wrp 
  WHERE wrp."workspaceRoleId" = wr.id AND wrp."permission" = p.permission
);
--> statement-breakpoint

-- Seed member role permissions
INSERT INTO "workspace_role_permissions" ("workspaceRoleId", "permission", "granted", "createdAt")
SELECT wr.id, p.permission, true, NOW()
FROM "workspace_roles" wr
CROSS JOIN (
  VALUES 
    ('workspace:view'),
    ('board:view'), ('board:create'),
    ('list:view'), ('list:create'), ('list:edit'), ('list:delete'),
    ('card:view'), ('card:create'), ('card:edit'), ('card:delete'),
    ('comment:view'), ('comment:create'), ('comment:edit'), ('comment:delete'),
    ('member:view')
) AS p(permission)
WHERE wr."name" = 'member' AND wr."isSystem" = true
AND NOT EXISTS (
  SELECT 1 FROM "workspace_role_permissions" wrp 
  WHERE wrp."workspaceRoleId" = wr.id AND wrp."permission" = p.permission
);
--> statement-breakpoint

-- Seed guest role permissions (view only)
INSERT INTO "workspace_role_permissions" ("workspaceRoleId", "permission", "granted", "createdAt")
SELECT wr.id, p.permission, true, NOW()
FROM "workspace_roles" wr
CROSS JOIN (
  VALUES 
    ('workspace:view'),
    ('board:view'),
    ('list:view'),
    ('card:view'),
    ('comment:view'),
    ('member:view')
) AS p(permission)
WHERE wr."name" = 'guest' AND wr."isSystem" = true
AND NOT EXISTS (
  SELECT 1 FROM "workspace_role_permissions" wrp 
  WHERE wrp."workspaceRoleId" = wr.id AND wrp."permission" = p.permission
);
--> statement-breakpoint

-- Migrate existing workspace_members to use roleId
UPDATE "workspace_members" wm
SET "roleId" = wr.id
FROM "workspace_roles" wr
WHERE wm."workspaceId" = wr."workspaceId"
  AND wm."role"::text = wr."name"
  AND wm."roleId" IS NULL;
--> statement-breakpoint

-- Clean up helper function
DROP FUNCTION IF EXISTS generate_public_id();



================================================
FILE: packages/db/migrations/20260129210000_AddWorkspaceWebhooks.sql
================================================
CREATE TABLE IF NOT EXISTS "workspace_webhooks" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"workspaceId" bigint NOT NULL,
	"name" varchar(255) NOT NULL,
	"url" varchar(2048) NOT NULL,
	"secret" text,
	"events" text NOT NULL,
	"active" boolean DEFAULT true NOT NULL,
	"createdBy" uuid NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"updatedAt" timestamp,
	CONSTRAINT "workspace_webhooks_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "workspace_webhooks" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "workspace_webhooks_workspace_idx" ON "workspace_webhooks" USING btree ("workspaceId");--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_webhooks" ADD CONSTRAINT "workspace_webhooks_workspaceId_workspace_id_fk" FOREIGN KEY ("workspaceId") REFERENCES "public"."workspace"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "workspace_webhooks" ADD CONSTRAINT "workspace_webhooks_createdBy_user_id_fk" FOREIGN KEY ("createdBy") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/20260201215958_AddUserBoardFavouritesTable.sql
================================================
CREATE TABLE IF NOT EXISTS "user_board_favorites" (
	"userId" uuid NOT NULL,
	"boardId" bigint NOT NULL,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	CONSTRAINT "user_board_favorites_userId_boardId_pk" PRIMARY KEY("userId","boardId")
);
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "user_board_favorites" ADD CONSTRAINT "user_board_favorites_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "user_board_favorites" ADD CONSTRAINT "user_board_favorites_boardId_board_id_fk" FOREIGN KEY ("boardId") REFERENCES "public"."board"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "user_board_favorite_user_idx" ON "user_board_favorites" USING btree ("userId");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "user_board_favorite_board_idx" ON "user_board_favorites" USING btree ("boardId");


================================================
FILE: packages/db/migrations/20260207214056_AddNotificationsTable.sql
================================================
CREATE TYPE "public"."notification_type" AS ENUM('mention', 'workspace.member.added', 'workspace.member.removed', 'workspace.role.changed');--> statement-breakpoint
CREATE TABLE IF NOT EXISTS "notification" (
	"id" bigserial PRIMARY KEY NOT NULL,
	"publicId" varchar(12) NOT NULL,
	"type" "notification_type" NOT NULL,
	"userId" uuid NOT NULL,
	"cardId" bigint,
	"commentId" bigint,
	"workspaceId" bigint,
	"metadata" text,
	"readAt" timestamp,
	"createdAt" timestamp DEFAULT now() NOT NULL,
	"deletedAt" timestamp,
	CONSTRAINT "notification_publicId_unique" UNIQUE("publicId")
);
--> statement-breakpoint
ALTER TABLE "notification" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "notification" ADD CONSTRAINT "notification_userId_user_id_fk" FOREIGN KEY ("userId") REFERENCES "public"."user"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "notification" ADD CONSTRAINT "notification_cardId_card_id_fk" FOREIGN KEY ("cardId") REFERENCES "public"."card"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "notification" ADD CONSTRAINT "notification_commentId_card_comments_id_fk" FOREIGN KEY ("commentId") REFERENCES "public"."card_comments"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "notification" ADD CONSTRAINT "notification_workspaceId_workspace_id_fk" FOREIGN KEY ("workspaceId") REFERENCES "public"."workspace"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;
--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "notification_user_deleted_idx" ON "notification" USING btree ("userId","deletedAt");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "notification_user_read_deleted_idx" ON "notification" USING btree ("userId","readAt","deletedAt");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "notification_user_type_card_idx" ON "notification" USING btree ("userId","type","cardId");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "notification_user_type_workspace_idx" ON "notification" USING btree ("userId","type","workspaceId");--> statement-breakpoint
CREATE INDEX IF NOT EXISTS "notification_user_created_idx" ON "notification" USING btree ("userId","createdAt");


================================================
FILE: packages/db/migrations/20260208033314_AddAttachmentToActivity.sql
================================================
ALTER TABLE "card_activity" ADD COLUMN "attachmentId" bigint;--> statement-breakpoint
DO $$ BEGIN
 ALTER TABLE "card_activity" ADD CONSTRAINT "card_activity_attachmentId_card_attachment_id_fk" FOREIGN KEY ("attachmentId") REFERENCES "public"."card_attachment"("id") ON DELETE cascade ON UPDATE no action;
EXCEPTION
 WHEN duplicate_object THEN null;
END $$;



================================================
FILE: packages/db/migrations/meta/20250608175448_snapshot.json
================================================
{
  "id": "058e8521-2814-46f0-a33f-1bbd86f450ce",
  "prevId": "1a07a776-0481-49f9-9098-02d530b37cf5",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "accountId": {
          "name": "accountId",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "providerId": {
          "name": "providerId",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "userId": {
          "name": "userId",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "accessToken": {
          "name": "accessToken",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refreshToken": {
          "name": "refreshToken",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "idToken": {
          "name": "idToken",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "accessTokenExpiresAt": {
          "name": "accessTokenExpiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refreshTokenExpiresAt": {
          "name": "refreshTokenExpiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_userId_user_id_fk": {
          "name": "account_userId_user_id_fk",
          "tableFrom": "account",
          "tableTo": "user",
          "columnsFrom": ["userId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.apiKey": {
      "name": "apiKey",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "start": {
          "name": "start",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "prefix": {
          "name": "prefix",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "key": {
          "name": "key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "userId": {
          "name": "userId",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "refillInterval": {
          "name": "refillInterval",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "refillAmount": {
          "name": "refillAmount",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "lastRefillAt": {
          "name": "lastRefillAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "enabled": {
          "name": "enabled",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        },
        "rateLimitEnabled": {
          "name": "rateLimitEnabled",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        },
        "rateLimitTimeWindow": {
          "name": "rateLimitTimeWindow",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "rateLimitMax": {
          "name": "rateLimitMax",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "requestCount": {
          "name": "requestCount",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "remaining": {
          "name": "remaining",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "lastRequest": {
          "name": "lastRequest",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "expiresAt": {
          "name": "expiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "permissions": {
          "name": "permissions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "apiKey_userId_user_id_fk": {
          "name": "apiKey_userId_user_id_fk",
          "tableFrom": "apiKey",
          "tableTo": "user",
          "columnsFrom": ["userId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "expiresAt": {
          "name": "expiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ipAddress": {
          "name": "ipAddress",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "userAgent": {
          "name": "userAgent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "userId": {
          "name": "userId",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_userId_user_id_fk": {
          "name": "session_userId_user_id_fk",
          "tableFrom": "session",
          "tableTo": "user",
          "columnsFrom": ["userId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "nullsNotDistinct": false,
          "columns": ["token"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expiresAt": {
          "name": "expiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.board": {
      "name": "board",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "importId": {
          "name": "importId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "workspaceId": {
          "name": "workspaceId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "visibility": {
          "name": "visibility",
          "type": "board_visibility",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'private'"
        }
      },
      "indexes": {
        "board_visibility_idx": {
          "name": "board_visibility_idx",
          "columns": [
            {
              "expression": "visibility",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "unique_slug_per_workspace": {
          "name": "unique_slug_per_workspace",
          "columns": [
            {
              "expression": "workspaceId",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "where": "\"board\".\"deletedAt\" IS NULL",
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "board_createdBy_user_id_fk": {
          "name": "board_createdBy_user_id_fk",
          "tableFrom": "board",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "board_deletedBy_user_id_fk": {
          "name": "board_deletedBy_user_id_fk",
          "tableFrom": "board",
          "tableTo": "user",
          "columnsFrom": ["deletedBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "board_importId_import_id_fk": {
          "name": "board_importId_import_id_fk",
          "tableFrom": "board",
          "tableTo": "import",
          "columnsFrom": ["importId"],
          "columnsTo": ["id"],
          "onDelete": "no action",
          "onUpdate": "no action"
        },
        "board_workspaceId_workspace_id_fk": {
          "name": "board_workspaceId_workspace_id_fk",
          "tableFrom": "board",
          "tableTo": "workspace",
          "columnsFrom": ["workspaceId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "board_publicId_unique": {
          "name": "board_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.card_activity": {
      "name": "card_activity",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "card_activity_type",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "cardId": {
          "name": "cardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "fromIndex": {
          "name": "fromIndex",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "toIndex": {
          "name": "toIndex",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "fromListId": {
          "name": "fromListId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "toListId": {
          "name": "toListId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "labelId": {
          "name": "labelId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "workspaceMemberId": {
          "name": "workspaceMemberId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "fromTitle": {
          "name": "fromTitle",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "toTitle": {
          "name": "toTitle",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "fromDescription": {
          "name": "fromDescription",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "toDescription": {
          "name": "toDescription",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "commentId": {
          "name": "commentId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "fromComment": {
          "name": "fromComment",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "toComment": {
          "name": "toComment",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "card_activity_cardId_card_id_fk": {
          "name": "card_activity_cardId_card_id_fk",
          "tableFrom": "card_activity",
          "tableTo": "card",
          "columnsFrom": ["cardId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "card_activity_fromListId_list_id_fk": {
          "name": "card_activity_fromListId_list_id_fk",
          "tableFrom": "card_activity",
          "tableTo": "list",
          "columnsFrom": ["fromListId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "card_activity_toListId_list_id_fk": {
          "name": "card_activity_toListId_list_id_fk",
          "tableFrom": "card_activity",
          "tableTo": "list",
          "columnsFrom": ["toListId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "card_activity_labelId_label_id_fk": {
          "name": "card_activity_labelId_label_id_fk",
          "tableFrom": "card_activity",
          "tableTo": "label",
          "columnsFrom": ["labelId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "card_activity_workspaceMemberId_workspace_members_id_fk": {
          "name": "card_activity_workspaceMemberId_workspace_members_id_fk",
          "tableFrom": "card_activity",
          "tableTo": "workspace_members",
          "columnsFrom": ["workspaceMemberId"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "card_activity_createdBy_user_id_fk": {
          "name": "card_activity_createdBy_user_id_fk",
          "tableFrom": "card_activity",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "card_activity_commentId_card_comments_id_fk": {
          "name": "card_activity_commentId_card_comments_id_fk",
          "tableFrom": "card_activity",
          "tableTo": "card_comments",
          "columnsFrom": ["commentId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "card_activity_publicId_unique": {
          "name": "card_activity_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public._card_workspace_members": {
      "name": "_card_workspace_members",
      "schema": "",
      "columns": {
        "cardId": {
          "name": "cardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "workspaceMemberId": {
          "name": "workspaceMemberId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "_card_workspace_members_cardId_card_id_fk": {
          "name": "_card_workspace_members_cardId_card_id_fk",
          "tableFrom": "_card_workspace_members",
          "tableTo": "card",
          "columnsFrom": ["cardId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "_card_workspace_members_workspaceMemberId_workspace_members_id_fk": {
          "name": "_card_workspace_members_workspaceMemberId_workspace_members_id_fk",
          "tableFrom": "_card_workspace_members",
          "tableTo": "workspace_members",
          "columnsFrom": ["workspaceMemberId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "_card_workspace_members_cardId_workspaceMemberId_pk": {
          "name": "_card_workspace_members_cardId_workspaceMemberId_pk",
          "columns": ["cardId", "workspaceMemberId"]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.card": {
      "name": "card",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "index": {
          "name": "index",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "listId": {
          "name": "listId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "importId": {
          "name": "importId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "card_createdBy_user_id_fk": {
          "name": "card_createdBy_user_id_fk",
          "tableFrom": "card",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "card_deletedBy_user_id_fk": {
          "name": "card_deletedBy_user_id_fk",
          "tableFrom": "card",
          "tableTo": "user",
          "columnsFrom": ["deletedBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "card_listId_list_id_fk": {
          "name": "card_listId_list_id_fk",
          "tableFrom": "card",
          "tableTo": "list",
          "columnsFrom": ["listId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "card_importId_import_id_fk": {
          "name": "card_importId_import_id_fk",
          "tableFrom": "card",
          "tableTo": "import",
          "columnsFrom": ["importId"],
          "columnsTo": ["id"],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "card_publicId_unique": {
          "name": "card_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public._card_labels": {
      "name": "_card_labels",
      "schema": "",
      "columns": {
        "cardId": {
          "name": "cardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "labelId": {
          "name": "labelId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "_card_labels_cardId_card_id_fk": {
          "name": "_card_labels_cardId_card_id_fk",
          "tableFrom": "_card_labels",
          "tableTo": "card",
          "columnsFrom": ["cardId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "_card_labels_labelId_label_id_fk": {
          "name": "_card_labels_labelId_label_id_fk",
          "tableFrom": "_card_labels",
          "tableTo": "label",
          "columnsFrom": ["labelId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "_card_labels_cardId_labelId_pk": {
          "name": "_card_labels_cardId_labelId_pk",
          "columns": ["cardId", "labelId"]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.card_comments": {
      "name": "card_comments",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "comment": {
          "name": "comment",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "cardId": {
          "name": "cardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "card_comments_cardId_card_id_fk": {
          "name": "card_comments_cardId_card_id_fk",
          "tableFrom": "card_comments",
          "tableTo": "card",
          "columnsFrom": ["cardId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "card_comments_createdBy_user_id_fk": {
          "name": "card_comments_createdBy_user_id_fk",
          "tableFrom": "card_comments",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "card_comments_deletedBy_user_id_fk": {
          "name": "card_comments_deletedBy_user_id_fk",
          "tableFrom": "card_comments",
          "tableTo": "user",
          "columnsFrom": ["deletedBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "card_comments_publicId_unique": {
          "name": "card_comments_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.feedback": {
      "name": "feedback",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "feedback": {
          "name": "feedback",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "reviewed": {
          "name": "reviewed",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "feedback_createdBy_user_id_fk": {
          "name": "feedback_createdBy_user_id_fk",
          "tableFrom": "feedback",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.import": {
      "name": "import",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "source": {
          "name": "source",
          "type": "source",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "import_createdBy_user_id_fk": {
          "name": "import_createdBy_user_id_fk",
          "tableFrom": "import",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "import_publicId_unique": {
          "name": "import_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.label": {
      "name": "label",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "colourCode": {
          "name": "colourCode",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": false
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "boardId": {
          "name": "boardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "importId": {
          "name": "importId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "label_createdBy_user_id_fk": {
          "name": "label_createdBy_user_id_fk",
          "tableFrom": "label",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "label_boardId_board_id_fk": {
          "name": "label_boardId_board_id_fk",
          "tableFrom": "label",
          "tableTo": "board",
          "columnsFrom": ["boardId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "label_importId_import_id_fk": {
          "name": "label_importId_import_id_fk",
          "tableFrom": "label",
          "tableTo": "import",
          "columnsFrom": ["importId"],
          "columnsTo": ["id"],
          "onDelete": "no action",
          "onUpdate": "no action"
        },
        "label_deletedBy_user_id_fk": {
          "name": "label_deletedBy_user_id_fk",
          "tableFrom": "label",
          "tableTo": "user",
          "columnsFrom": ["deletedBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "label_publicId_unique": {
          "name": "label_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.list": {
      "name": "list",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "index": {
          "name": "index",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "boardId": {
          "name": "boardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "importId": {
          "name": "importId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "list_createdBy_user_id_fk": {
          "name": "list_createdBy_user_id_fk",
          "tableFrom": "list",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "list_deletedBy_user_id_fk": {
          "name": "list_deletedBy_user_id_fk",
          "tableFrom": "list",
          "tableTo": "user",
          "columnsFrom": ["deletedBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "list_boardId_board_id_fk": {
          "name": "list_boardId_board_id_fk",
          "tableFrom": "list",
          "tableTo": "board",
          "columnsFrom": ["boardId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "list_importId_import_id_fk": {
          "name": "list_importId_import_id_fk",
          "tableFrom": "list",
          "tableTo": "import",
          "columnsFrom": ["importId"],
          "columnsTo": ["id"],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "list_publicId_unique": {
          "name": "list_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true,
          "default": "uuid_generate_v4()"
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "emailVerified": {
          "name": "emailVerified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "stripeCustomerId": {
          "name": "stripeCustomerId",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "nullsNotDistinct": false,
          "columns": ["email"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.workspace_slugs": {
      "name": "workspace_slugs",
      "schema": "",
      "columns": {
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "slug_type",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "workspace_slugs_slug_unique": {
          "name": "workspace_slugs_slug_unique",
          "nullsNotDistinct": false,
          "columns": ["slug"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.workspace_members": {
      "name": "workspace_members",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "userId": {
          "name": "userId",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "workspaceId": {
          "name": "workspaceId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "role": {
          "name": "role",
          "type": "role",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "member_status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'invited'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "workspace_members_userId_user_id_fk": {
          "name": "workspace_members_userId_user_id_fk",
          "tableFrom": "workspace_members",
          "tableTo": "user",
          "columnsFrom": ["userId"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "workspace_members_workspaceId_workspace_id_fk": {
          "name": "workspace_members_workspaceId_workspace_id_fk",
          "tableFrom": "workspace_members",
          "tableTo": "workspace",
          "columnsFrom": ["workspaceId"],
          "columnsTo": ["id"],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "workspace_members_deletedBy_user_id_fk": {
          "name": "workspace_members_deletedBy_user_id_fk",
          "tableFrom": "workspace_members",
          "tableTo": "user",
          "columnsFrom": ["deletedBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "workspace_members_publicId_unique": {
          "name": "workspace_members_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.workspace": {
      "name": "workspace",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "plan": {
          "name": "plan",
          "type": "workspace_plan",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'free'"
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "workspace_createdBy_user_id_fk": {
          "name": "workspace_createdBy_user_id_fk",
          "tableFrom": "workspace",
          "tableTo": "user",
          "columnsFrom": ["createdBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        },
        "workspace_deletedBy_user_id_fk": {
          "name": "workspace_deletedBy_user_id_fk",
          "tableFrom": "workspace",
          "tableTo": "user",
          "columnsFrom": ["deletedBy"],
          "columnsTo": ["id"],
          "onDelete": "set null",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "workspace_publicId_unique": {
          "name": "workspace_publicId_unique",
          "nullsNotDistinct": false,
          "columns": ["publicId"]
        },
        "workspace_slug_unique": {
          "name": "workspace_slug_unique",
          "nullsNotDistinct": false,
          "columns": ["slug"]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    }
  },
  "enums": {
    "public.board_visibility": {
      "name": "board_visibility",
      "schema": "public",
      "values": ["private", "public"]
    },
    "public.card_activity_type": {
      "name": "card_activity_type",
      "schema": "public",
      "values": [
        "card.created",
        "card.updated.title",
        "card.updated.description",
        "card.updated.index",
        "card.updated.list",
        "card.updated.label.added",
        "card.updated.label.removed",
        "card.updated.member.added",
        "card.updated.member.removed",
        "card.updated.comment.added",
        "card.updated.comment.updated",
        "card.updated.comment.deleted",
        "card.archived"
      ]
    },
    "public.source": {
      "name": "source",
      "schema": "public",
      "values": ["trello"]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": ["started", "success", "failed"]
    },
    "public.role": {
      "name": "role",
      "schema": "public",
      "values": ["admin", "member", "guest"]
    },
    "public.member_status": {
      "name": "member_status",
      "schema": "public",
      "values": ["invited", "active", "removed"]
    },
    "public.slug_type": {
      "name": "slug_type",
      "schema": "public",
      "values": ["reserved", "premium"]
    },
    "public.workspace_plan": {
      "name": "workspace_plan",
      "schema": "public",
      "values": ["free", "pro", "enterprise"]
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}



================================================
FILE: packages/db/migrations/meta/20250610200449_snapshot.json
================================================
{
  "id": "91f9a2fa-31e2-4f3a-bdb9-852292fd7501",
  "prevId": "d170c8e0-bf75-4c71-abd9-0ecbeeb14003",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.account": {
      "name": "account",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "accountId": {
          "name": "accountId",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "providerId": {
          "name": "providerId",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "userId": {
          "name": "userId",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "accessToken": {
          "name": "accessToken",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "refreshToken": {
          "name": "refreshToken",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "idToken": {
          "name": "idToken",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "accessTokenExpiresAt": {
          "name": "accessTokenExpiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "refreshTokenExpiresAt": {
          "name": "refreshTokenExpiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "scope": {
          "name": "scope",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "password": {
          "name": "password",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "account_userId_user_id_fk": {
          "name": "account_userId_user_id_fk",
          "tableFrom": "account",
          "columnsFrom": ["userId"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.apiKey": {
      "name": "apiKey",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "start": {
          "name": "start",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "prefix": {
          "name": "prefix",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "key": {
          "name": "key",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "userId": {
          "name": "userId",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "refillInterval": {
          "name": "refillInterval",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "refillAmount": {
          "name": "refillAmount",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "lastRefillAt": {
          "name": "lastRefillAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "enabled": {
          "name": "enabled",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        },
        "rateLimitEnabled": {
          "name": "rateLimitEnabled",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        },
        "rateLimitTimeWindow": {
          "name": "rateLimitTimeWindow",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "rateLimitMax": {
          "name": "rateLimitMax",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "requestCount": {
          "name": "requestCount",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "remaining": {
          "name": "remaining",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "lastRequest": {
          "name": "lastRequest",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "expiresAt": {
          "name": "expiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "permissions": {
          "name": "permissions",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "apiKey_userId_user_id_fk": {
          "name": "apiKey_userId_user_id_fk",
          "tableFrom": "apiKey",
          "columnsFrom": ["userId"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.session": {
      "name": "session",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "expiresAt": {
          "name": "expiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "token": {
          "name": "token",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "ipAddress": {
          "name": "ipAddress",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "userAgent": {
          "name": "userAgent",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "userId": {
          "name": "userId",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "session_userId_user_id_fk": {
          "name": "session_userId_user_id_fk",
          "tableFrom": "session",
          "columnsFrom": ["userId"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "session_token_unique": {
          "name": "session_token_unique",
          "columns": ["token"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.verification": {
      "name": "verification",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "identifier": {
          "name": "identifier",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "value": {
          "name": "value",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "expiresAt": {
          "name": "expiresAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.board": {
      "name": "board",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "importId": {
          "name": "importId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "workspaceId": {
          "name": "workspaceId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "visibility": {
          "name": "visibility",
          "type": "board_visibility",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'private'"
        }
      },
      "indexes": {
        "board_visibility_idx": {
          "name": "board_visibility_idx",
          "columns": [
            {
              "expression": "visibility",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "with": {},
          "method": "btree",
          "concurrently": false
        },
        "unique_slug_per_workspace": {
          "name": "unique_slug_per_workspace",
          "columns": [
            {
              "expression": "workspaceId",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "slug",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": true,
          "with": {},
          "method": "btree",
          "where": "\"board\".\"deletedAt\" IS NULL",
          "concurrently": false
        }
      },
      "foreignKeys": {
        "board_createdBy_user_id_fk": {
          "name": "board_createdBy_user_id_fk",
          "tableFrom": "board",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "board_deletedBy_user_id_fk": {
          "name": "board_deletedBy_user_id_fk",
          "tableFrom": "board",
          "columnsFrom": ["deletedBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "board_importId_import_id_fk": {
          "name": "board_importId_import_id_fk",
          "tableFrom": "board",
          "columnsFrom": ["importId"],
          "tableTo": "import",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "no action"
        },
        "board_workspaceId_workspace_id_fk": {
          "name": "board_workspaceId_workspace_id_fk",
          "tableFrom": "board",
          "columnsFrom": ["workspaceId"],
          "tableTo": "workspace",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "board_publicId_unique": {
          "name": "board_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.card_activity": {
      "name": "card_activity",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "card_activity_type",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "cardId": {
          "name": "cardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "fromIndex": {
          "name": "fromIndex",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "toIndex": {
          "name": "toIndex",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "fromListId": {
          "name": "fromListId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "toListId": {
          "name": "toListId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "labelId": {
          "name": "labelId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "workspaceMemberId": {
          "name": "workspaceMemberId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "fromTitle": {
          "name": "fromTitle",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "toTitle": {
          "name": "toTitle",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "fromDescription": {
          "name": "fromDescription",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "toDescription": {
          "name": "toDescription",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "commentId": {
          "name": "commentId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "fromComment": {
          "name": "fromComment",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "toComment": {
          "name": "toComment",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "card_activity_cardId_card_id_fk": {
          "name": "card_activity_cardId_card_id_fk",
          "tableFrom": "card_activity",
          "columnsFrom": ["cardId"],
          "tableTo": "card",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "card_activity_fromListId_list_id_fk": {
          "name": "card_activity_fromListId_list_id_fk",
          "tableFrom": "card_activity",
          "columnsFrom": ["fromListId"],
          "tableTo": "list",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "card_activity_toListId_list_id_fk": {
          "name": "card_activity_toListId_list_id_fk",
          "tableFrom": "card_activity",
          "columnsFrom": ["toListId"],
          "tableTo": "list",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "card_activity_labelId_label_id_fk": {
          "name": "card_activity_labelId_label_id_fk",
          "tableFrom": "card_activity",
          "columnsFrom": ["labelId"],
          "tableTo": "label",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "card_activity_workspaceMemberId_workspace_members_id_fk": {
          "name": "card_activity_workspaceMemberId_workspace_members_id_fk",
          "tableFrom": "card_activity",
          "columnsFrom": ["workspaceMemberId"],
          "tableTo": "workspace_members",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "card_activity_createdBy_user_id_fk": {
          "name": "card_activity_createdBy_user_id_fk",
          "tableFrom": "card_activity",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "card_activity_commentId_card_comments_id_fk": {
          "name": "card_activity_commentId_card_comments_id_fk",
          "tableFrom": "card_activity",
          "columnsFrom": ["commentId"],
          "tableTo": "card_comments",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "card_activity_publicId_unique": {
          "name": "card_activity_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public._card_workspace_members": {
      "name": "_card_workspace_members",
      "schema": "",
      "columns": {
        "cardId": {
          "name": "cardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "workspaceMemberId": {
          "name": "workspaceMemberId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "_card_workspace_members_cardId_card_id_fk": {
          "name": "_card_workspace_members_cardId_card_id_fk",
          "tableFrom": "_card_workspace_members",
          "columnsFrom": ["cardId"],
          "tableTo": "card",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "_card_workspace_members_workspaceMemberId_workspace_members_id_fk": {
          "name": "_card_workspace_members_workspaceMemberId_workspace_members_id_fk",
          "tableFrom": "_card_workspace_members",
          "columnsFrom": ["workspaceMemberId"],
          "tableTo": "workspace_members",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {
        "_card_workspace_members_cardId_workspaceMemberId_pk": {
          "name": "_card_workspace_members_cardId_workspaceMemberId_pk",
          "columns": ["cardId", "workspaceMemberId"]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.card": {
      "name": "card",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "title": {
          "name": "title",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "index": {
          "name": "index",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "listId": {
          "name": "listId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "importId": {
          "name": "importId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "card_createdBy_user_id_fk": {
          "name": "card_createdBy_user_id_fk",
          "tableFrom": "card",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "card_deletedBy_user_id_fk": {
          "name": "card_deletedBy_user_id_fk",
          "tableFrom": "card",
          "columnsFrom": ["deletedBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "card_listId_list_id_fk": {
          "name": "card_listId_list_id_fk",
          "tableFrom": "card",
          "columnsFrom": ["listId"],
          "tableTo": "list",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "card_importId_import_id_fk": {
          "name": "card_importId_import_id_fk",
          "tableFrom": "card",
          "columnsFrom": ["importId"],
          "tableTo": "import",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "card_publicId_unique": {
          "name": "card_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public._card_labels": {
      "name": "_card_labels",
      "schema": "",
      "columns": {
        "cardId": {
          "name": "cardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "labelId": {
          "name": "labelId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {
        "_card_labels_cardId_card_id_fk": {
          "name": "_card_labels_cardId_card_id_fk",
          "tableFrom": "_card_labels",
          "columnsFrom": ["cardId"],
          "tableTo": "card",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "_card_labels_labelId_label_id_fk": {
          "name": "_card_labels_labelId_label_id_fk",
          "tableFrom": "_card_labels",
          "columnsFrom": ["labelId"],
          "tableTo": "label",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        }
      },
      "compositePrimaryKeys": {
        "_card_labels_cardId_labelId_pk": {
          "name": "_card_labels_cardId_labelId_pk",
          "columns": ["cardId", "labelId"]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.card_comments": {
      "name": "card_comments",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "comment": {
          "name": "comment",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "cardId": {
          "name": "cardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "card_comments_cardId_card_id_fk": {
          "name": "card_comments_cardId_card_id_fk",
          "tableFrom": "card_comments",
          "columnsFrom": ["cardId"],
          "tableTo": "card",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "card_comments_createdBy_user_id_fk": {
          "name": "card_comments_createdBy_user_id_fk",
          "tableFrom": "card_comments",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "card_comments_deletedBy_user_id_fk": {
          "name": "card_comments_deletedBy_user_id_fk",
          "tableFrom": "card_comments",
          "columnsFrom": ["deletedBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "card_comments_publicId_unique": {
          "name": "card_comments_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.feedback": {
      "name": "feedback",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "feedback": {
          "name": "feedback",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "reviewed": {
          "name": "reviewed",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "feedback_createdBy_user_id_fk": {
          "name": "feedback_createdBy_user_id_fk",
          "tableFrom": "feedback",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.import": {
      "name": "import",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "source": {
          "name": "source",
          "type": "source",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "import_createdBy_user_id_fk": {
          "name": "import_createdBy_user_id_fk",
          "tableFrom": "import",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "import_publicId_unique": {
          "name": "import_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.label": {
      "name": "label",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "colourCode": {
          "name": "colourCode",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": false
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "boardId": {
          "name": "boardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "importId": {
          "name": "importId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "label_createdBy_user_id_fk": {
          "name": "label_createdBy_user_id_fk",
          "tableFrom": "label",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "label_boardId_board_id_fk": {
          "name": "label_boardId_board_id_fk",
          "tableFrom": "label",
          "columnsFrom": ["boardId"],
          "tableTo": "board",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "label_importId_import_id_fk": {
          "name": "label_importId_import_id_fk",
          "tableFrom": "label",
          "columnsFrom": ["importId"],
          "tableTo": "import",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "no action"
        },
        "label_deletedBy_user_id_fk": {
          "name": "label_deletedBy_user_id_fk",
          "tableFrom": "label",
          "columnsFrom": ["deletedBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "label_publicId_unique": {
          "name": "label_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.list": {
      "name": "list",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "index": {
          "name": "index",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "boardId": {
          "name": "boardId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "importId": {
          "name": "importId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "list_createdBy_user_id_fk": {
          "name": "list_createdBy_user_id_fk",
          "tableFrom": "list",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "list_deletedBy_user_id_fk": {
          "name": "list_deletedBy_user_id_fk",
          "tableFrom": "list",
          "columnsFrom": ["deletedBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "list_boardId_board_id_fk": {
          "name": "list_boardId_board_id_fk",
          "tableFrom": "list",
          "columnsFrom": ["boardId"],
          "tableTo": "board",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "list_importId_import_id_fk": {
          "name": "list_importId_import_id_fk",
          "tableFrom": "list",
          "columnsFrom": ["importId"],
          "tableTo": "import",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "list_publicId_unique": {
          "name": "list_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.user": {
      "name": "user",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true,
          "default": "uuid_generate_v4()"
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "emailVerified": {
          "name": "emailVerified",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true
        },
        "image": {
          "name": "image",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "stripeCustomerId": {
          "name": "stripeCustomerId",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_email_unique": {
          "name": "user_email_unique",
          "columns": ["email"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.workspace_slugs": {
      "name": "workspace_slugs",
      "schema": "",
      "columns": {
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "slug_type",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "workspace_slugs_slug_unique": {
          "name": "workspace_slugs_slug_unique",
          "columns": ["slug"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.workspace_members": {
      "name": "workspace_members",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "userId": {
          "name": "userId",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "workspaceId": {
          "name": "workspaceId",
          "type": "bigint",
          "primaryKey": false,
          "notNull": true
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "role": {
          "name": "role",
          "type": "role",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "member_status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'invited'"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "workspace_members_userId_user_id_fk": {
          "name": "workspace_members_userId_user_id_fk",
          "tableFrom": "workspace_members",
          "columnsFrom": ["userId"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "workspace_members_workspaceId_workspace_id_fk": {
          "name": "workspace_members_workspaceId_workspace_id_fk",
          "tableFrom": "workspace_members",
          "columnsFrom": ["workspaceId"],
          "tableTo": "workspace",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "cascade"
        },
        "workspace_members_deletedBy_user_id_fk": {
          "name": "workspace_members_deletedBy_user_id_fk",
          "tableFrom": "workspace_members",
          "columnsFrom": ["deletedBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "workspace_members_publicId_unique": {
          "name": "workspace_members_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    },
    "public.workspace": {
      "name": "workspace",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "bigserial",
          "primaryKey": true,
          "notNull": true
        },
        "publicId": {
          "name": "publicId",
          "type": "varchar(12)",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "slug": {
          "name": "slug",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "plan": {
          "name": "plan",
          "type": "workspace_plan",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'free'"
        },
        "createdBy": {
          "name": "createdBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedAt": {
          "name": "deletedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "deletedBy": {
          "name": "deletedBy",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "workspace_createdBy_user_id_fk": {
          "name": "workspace_createdBy_user_id_fk",
          "tableFrom": "workspace",
          "columnsFrom": ["createdBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        },
        "workspace_deletedBy_user_id_fk": {
          "name": "workspace_deletedBy_user_id_fk",
          "tableFrom": "workspace",
          "columnsFrom": ["deletedBy"],
          "tableTo": "user",
          "columnsTo": ["id"],
          "onUpdate": "no action",
          "onDelete": "set null"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "workspace_publicId_unique": {
          "name": "workspace_publicId_unique",
          "columns": ["publicId"],
          "nullsNotDistinct": false
        },
        "workspace_slug_unique": {
          "name": "workspace_slug_unique",
          "columns": ["slug"],
          "nullsNotDistinct": false
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": true
    }
  },
  "enums": {
    "public.board_visibility": {
      "name": "board_visibility",
      "schema": "public",
      "values": ["private", "public"]
    },
    "public.card_activity_type": {
      "name": "card_activity_type",
      "schema": "public",
      "values": [
        "card.created",
        "card.updated.title",
        "card.updated.description",
        "card.updated.index",
        "card.updated.list",
        "card.updated.label.added",
        "card.updated.label.removed",
        "card.updated.member.added",
        "card.updated.member.removed",
        "card.updated.comment.added",
        "card.updated.comment.updated",
        "card.updated.comment.deleted",
        "card.archived"
      ]
    },
    "public.source": {
      "name": "source",
      "schema": "public",
      "values": ["trello"]
    },
    "public.status": {
      "name": "status",
      "schema": "public",
      "values": ["started", "success", "failed"]
    },
    "public.role": {
      "name": "role",
      "schema": "public",
      "values": ["admin", "member", "guest"]
    },
    "public.member_status": {
      "name": "member_status",
      "schema": "public",
      "values": ["invited", "active", "removed"]
    },
    "public.slug_type": {
      "name": "slug_type",
      "schema": "public",
      "values": ["reserved", "premium"]
    },
    "public.workspace_plan": {
      "name": "workspace_plan",
      "schema": "public",
      "values": ["free", "pro", "enterprise"]
    }
  },
  "schemas": {},
  "views": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}



================================================
FILE: packages/db/migrations/meta/_journal.json
================================================
{
  "version": "7",
  "dialect": "postgresql",
  "entries": [
    {
      "idx": 0,
      "version": "7",
      "when": 1746693478656,
      "tag": "20250508083758_SetupTables",
      "breakpoints": true
    },
    {
      "idx": 1,
      "version": "7",
      "when": 1747903068807,
      "tag": "20250522083748_AddEmailToWorkspaceMembers",
      "breakpoints": true
    },
    {
      "idx": 2,
      "version": "7",
      "when": 1748378293342,
      "tag": "20250527203813_AddDeletedAtToLabel",
      "breakpoints": true
    },
    {
      "idx": 3,
      "version": "7",
      "when": 1749118315675,
      "tag": "20250605101155_AddCascadeDeleteToCardRelations",
      "breakpoints": true
    },
    {
      "idx": 4,
      "version": "7",
      "when": 1749405288761,
      "tag": "20250608175448_AddOnDeleteActionToUserDeletion",
      "breakpoints": true
    },
    {
      "idx": 5,
      "version": "7",
      "when": 1749377372062,
      "tag": "20250608100932_AddIntegrationsTable",
      "breakpoints": true
    },
    {
      "idx": 6,
      "version": "7",
      "when": 1749585889984,
      "tag": "20250610200449_ReaddIntegrationTable",
      "breakpoints": true
    },
    {
      "idx": 7,
      "version": "7",
      "when": 1754511666265,
      "tag": "20250806202106_glossy_luminals",
      "breakpoints": true
    },
    {
      "idx": 8,
      "version": "7",
      "when": 1755094668761,
      "tag": "20250813141748_AddChecklistActivityTypes",
      "breakpoints": true
    },
    {
      "idx": 9,
      "version": "7",
      "when": 1756803246096,
      "tag": "20250902085406_AddSubscriptions",
      "breakpoints": true
    },
    {
      "idx": 10,
      "version": "7",
      "when": 1757271312974,
      "tag": "20250907185512_AddUnlimitedSeatsToSubscription",
      "breakpoints": true
    },
    {
      "idx": 11,
      "version": "7",
      "when": 1757533858687,
      "tag": "20250910195058_RemoveNotNullConstraintFromReferenceIdOnSubsriptions",
      "breakpoints": true
    },
    {
      "idx": 12,
      "version": "7",
      "when": 1757534656098,
      "tag": "20250910200416_AddWorkspaceSlugChecks",
      "breakpoints": true
    },
    {
      "idx": 13,
      "version": "7",
      "when": 1757535838766,
      "tag": "20250910202358_AddCascadeSetNullToReferenceIdOnSubsriptions",
      "breakpoints": true
    },
    {
      "idx": 14,
      "version": "7",
      "when": 1758226671081,
      "tag": "20250918201751_AddPausedMemberStatus",
      "breakpoints": true
    },
    {
      "idx": 15,
      "version": "7",
      "when": 1758662398166,
      "tag": "20250923211958_AddWorkspaceInviteLinks",
      "breakpoints": true
    },
    {
      "idx": 16,
      "version": "7",
      "when": 1759356096392,
      "tag": "20251001220136_AddFuzzySearchSupport",
      "breakpoints": true
    },
    {
      "idx": 17,
      "version": "7",
      "when": 1759869689304,
      "tag": "20251007204129_AddBoardTypeAndSourceIdColumns",
      "breakpoints": true
    },
    {
      "idx": 18,
      "version": "7",
      "when": 1760044396109,
      "tag": "20251009211316_AddBoardSourceIdToCardActivity",
      "breakpoints": true
    },
    {
      "idx": 19,
      "version": "7",
      "when": 1762807463569,
      "tag": "20251110204423_AddCardAttachments",
      "breakpoints": true
    },
    {
      "idx": 20,
      "version": "7",
      "when": 1764621815672,
      "tag": "20251201204335_AddCardDueDates",
      "breakpoints": true
    },
    {
      "idx": 21,
      "version": "7",
      "when": 1767045713686,
      "tag": "20251229220153_UpdateCardTitleFromVarcharToText",
      "breakpoints": true
    },
    {
      "idx": 22,
      "version": "7",
      "when": 1768858977000,
      "tag": "20260119164257_AddShowEmailsToMembersToWorkspace",
      "breakpoints": true
    },
    {
      "idx": 23,
      "version": "7",
      "when": 1769435949476,
      "tag": "20260126135909_AddWorkspaceRoles",
      "breakpoints": true
    },
    {
      "idx": 24,
      "version": "7",
      "when": 1769983198190,
      "tag": "20260201215958_AddUserBoardFavouritesTable",
      "breakpoints": true
    },
    {
      "idx": 25,
      "version": "7",
      "when": 1770500457005,
      "tag": "20260207214056_AddNotificationsTable",
      "breakpoints": true
    },
    {
      "idx": 26,
      "version": "7",
      "when": 1770521594167,
      "tag": "20260208033314_AddAttachmentToActivity",
      "breakpoints": true
    },
    {
      "idx": 27,
      "version": "7",
      "when": 1771192000000,
      "tag": "20260129210000_AddWorkspaceWebhooks",
      "breakpoints": true
    }
  ]
}


================================================
FILE: packages/db/src/client.ts
================================================
import type { NodePgDatabase } from "drizzle-orm/node-postgres";
import { PGlite } from "@electric-sql/pglite";
import { uuid_ossp } from "@electric-sql/pglite/contrib/uuid_ossp";
import { drizzle as drizzlePg } from "drizzle-orm/node-postgres";
import { drizzle as drizzlePgLite } from "drizzle-orm/pglite";
import { migrate } from "drizzle-orm/pglite/migrator";
import { Pool } from "pg";

import * as schema from "./schema";

export type dbClient = NodePgDatabase<typeof schema> & {
  $client: Pool;
};

export const createDrizzleClient = (): dbClient => {
  const connectionString = process.env.POSTGRES_URL;

  if (!connectionString) {
    console.log("POSTGRES_URL environment variable is not set, using PGLite");

    const client = new PGlite({
      dataDir: "./pgdata",
      extensions: { uuid_ossp },
    });
    const db = drizzlePgLite(client, { schema });

    migrate(db, { migrationsFolder: "../../packages/db/migrations" });

    return db as unknown as dbClient;
  }

  const pool = new Pool({
    connectionString,
  });

  return drizzlePg(pool, { schema }) as dbClient;
};



================================================
FILE: packages/db/src/redis.ts
================================================
import Redis from "ioredis";

let redisClient: Redis | null = null;

export function getRedisClient(): Redis | null {
  if (redisClient) {
    return redisClient;
  }

  const redisUrl = process.env.REDIS_URL;

  if (!redisUrl) {
    return null;
  }

  redisClient = new Redis(redisUrl, {
    maxRetriesPerRequest: 3,
    enableReadyCheck: true,
    lazyConnect: true,
  });

  return redisClient;
}

export async function closeRedisClient(): Promise<void> {
  if (redisClient) {
    await redisClient.quit();
    redisClient = null;
  }
}




================================================
FILE: packages/db/src/repository/board.repo.ts
================================================
import {
  and,
  asc,
  count,
  desc,
  eq,
  gte,
  inArray,
  isNotNull,
  isNull,
  lt,
  or,
} from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import type { BoardVisibilityStatus } from "@kan/db/schema";
import {
  boards,
  cardActivities,
  cardAttachments,
  cards,
  cardsToLabels,
  cardToWorkspaceMembers,
  checklistItems,
  checklists,
  comments,
  labels,
  lists,
  userBoardFavorites,
  workspaceMembers,
} from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(boards)
    .where(isNull(boards.deletedAt));

  return result[0]?.count ?? 0;
};

export const getAllByWorkspaceId = async (
  db: dbClient,
  workspaceId: number,
  userId: string,
  opts?: { type?: "regular" | "template" },
) => {
  const boardsData = await db.query.boards.findMany({
    columns: {
      publicId: true,
      name: true,
    },
    with: {
      userFavorites: {
        where: eq(userBoardFavorites.userId, userId),
        columns: {
          userId: true,
        },
      },
      lists: {
        columns: {
          publicId: true,
          name: true,
          index: true,
        },
        orderBy: [asc(lists.index)],
      },
      labels: {
        columns: {
          publicId: true,
          name: true,
          colourCode: true,
        },
      },
    },
    where: and(
      eq(boards.workspaceId, workspaceId),
      isNull(boards.deletedAt),
      opts?.type ? eq(boards.type, opts.type) : undefined,
    ),
  });

  // Transform and sort: favorites first, then alphabetically
  return boardsData
    .map((board) => ({
      ...board,
      favorite: board.userFavorites.length > 0,
      userFavorites: undefined,
    }))
    .sort((a, b) => {
      // Sort favorites first
      if (a.favorite && !b.favorite) return -1;
      if (!a.favorite && b.favorite) return 1;
      // Then alphabetically by name
      return a.name.localeCompare(b.name);
    });
};

export const getIdByPublicId = async (db: dbClient, boardPublicId: string) => {
  const board = await db.query.boards.findFirst({
    columns: {
      id: true,
      type: true,
    },
    where: eq(boards.publicId, boardPublicId),
  });

  return board;
};

interface DueDateFilter {
  startDate?: Date;
  endDate?: Date;
  hasNoDueDate?: boolean;
}

const buildDueDateWhere = (filters: DueDateFilter[]) => {
  if (!filters.length) return undefined;

  const clauses = filters
    .map((filter) => {
      const conditions: ReturnType<typeof and>[] = [];

      if (filter.hasNoDueDate) {
        conditions.push(isNull(cards.dueDate));
      } else {
        conditions.push(isNotNull(cards.dueDate));

        if (filter.startDate)
          conditions.push(gte(cards.dueDate, filter.startDate));

        if (filter.endDate) conditions.push(lt(cards.dueDate, filter.endDate));
      }

      return conditions.length > 0 ? and(...conditions) : undefined;
    })
    .filter((clause): clause is NonNullable<typeof clause> => !!clause);

  if (!clauses.length) return undefined;

  return or(...clauses);
};

export const getByPublicId = async (
  db: dbClient,
  boardPublicId: string,
  userId: string,
  filters: {
    members: string[];
    labels: string[];
    lists: string[];
    dueDate: DueDateFilter[];
    type: "regular" | "template" | undefined;
  },
) => {
  let cardIds: string[] = [];

  if (filters.labels.length > 0 || filters.members.length > 0) {
    const filteredCards = await db
      .select({
        publicId: cards.publicId,
      })
      .from(cards)
      .leftJoin(cardsToLabels, eq(cards.id, cardsToLabels.cardId))
      .leftJoin(labels, eq(cardsToLabels.labelId, labels.id))
      .leftJoin(
        cardToWorkspaceMembers,
        eq(cards.id, cardToWorkspaceMembers.cardId),
      )
      .leftJoin(
        workspaceMembers,
        eq(cardToWorkspaceMembers.workspaceMemberId, workspaceMembers.id),
      )
      .where(
        and(
          isNull(cards.deletedAt),
          or(
            filters.labels.length > 0
              ? inArray(labels.publicId, filters.labels)
              : undefined,
            filters.members.length > 0
              ? inArray(workspaceMembers.publicId, filters.members)
              : undefined,
          ),
        ),
      );

    cardIds = filteredCards.map((card) => card.publicId);
  }

  const board = await db.query.boards.findFirst({
    columns: {
      publicId: true,
      name: true,
      slug: true,
      visibility: true,
    },
    with: {
      userFavorites: {
        where: eq(userBoardFavorites.userId, userId),
        columns: {
          userId: true,
        },
      },
      workspace: {
        columns: {
          publicId: true,
        },
        with: {
          members: {
            columns: {
              publicId: true,
              email: true,
              status: true,
            },
            with: {
              user: {
                columns: {
                  name: true,
                  email: true,
                  image: true,
                },
              },
            },
            where: isNull(workspaceMembers.deletedAt),
          },
        },
      },
      labels: {
        columns: {
          publicId: true,
          name: true,
          colourCode: true,
        },
        where: isNull(labels.deletedAt),
      },
      lists: {
        columns: {
          publicId: true,
          name: true,
          boardId: true,
          index: true,
        },
        with: {
          cards: {
            columns: {
              publicId: true,
              title: true,
              description: true,
              listId: true,
              index: true,
              dueDate: true,
            },
            with: {
              labels: {
                with: {
                  label: {
                    columns: {
                      publicId: true,
                      name: true,
                      colourCode: true,
                    },
                  },
                },
              },
              members: {
                with: {
                  member: {
                    columns: {
                      publicId: true,
                      email: true,
                      deletedAt: true,
                    },
                    with: {
                      user: {
                        columns: {
                          name: true,
                          email: true,
                          image: true,
                        },
                      },
                    },
                  },
                },
              },
              attachments: {
                columns: {
                  publicId: true,
                },
                where: isNull(cardAttachments.deletedAt),
                orderBy: asc(cardAttachments.createdAt),
              },
              checklists: {
                columns: {
                  publicId: true,
                  name: true,
                  index: true,
                },
                where: isNull(checklists.deletedAt),
                orderBy: asc(checklists.index),
                with: {
                  items: {
                    columns: {
                      publicId: true,
                      title: true,
                      completed: true,
                      index: true,
                    },
                    where: isNull(checklistItems.deletedAt),
                    orderBy: asc(checklistItems.index),
                  },
                },
              },
              comments: {
                columns: {
                  publicId: true,
                },
                where: isNull(comments.deletedAt),
                limit: 1,
              },
            },
            where: and(
              cardIds.length > 0 ? inArray(cards.publicId, cardIds) : undefined,
              isNull(cards.deletedAt),
              buildDueDateWhere(filters.dueDate),
            ),
            orderBy: [asc(cards.index)],
          },
        },
        where: and(
          isNull(lists.deletedAt),
          filters.lists.length > 0
            ? inArray(lists.publicId, filters.lists)
            : undefined,
        ),
        orderBy: [asc(lists.index)],
      },
      allLists: {
        columns: {
          publicId: true,
          name: true,
        },
        where: isNull(lists.deletedAt),
        orderBy: [asc(lists.index)],
      },
    },
    where: and(
      eq(boards.publicId, boardPublicId),
      isNull(boards.deletedAt),
      eq(boards.type, filters.type ?? "regular"),
    ),
  });

  if (!board) return null;

  const formattedResult = {
    ...board,
    favorite: board.userFavorites.length > 0,
    userFavorites: undefined,
    lists: board.lists.map((list) => ({
      ...list,
      cards: list.cards.map((card) => ({
        ...card,
        labels: card.labels.map((label) => label.label),
        members: card.members
          .map((member) => member.member)
          .filter((member) => member.deletedAt === null),
      })),
    })),
  };

  return formattedResult;
};

export const getBySlug = async (
  db: dbClient,
  boardSlug: string,
  workspaceId: number,
  filters: {
    members: string[];
    labels: string[];
    lists: string[];
    dueDate: DueDateFilter[];
  },
) => {
  let cardIds: string[] = [];

  if (filters.labels.length) {
    const filteredCards = await db
      .select({
        publicId: cards.publicId,
      })
      .from(cards)
      .leftJoin(cardsToLabels, eq(cards.id, cardsToLabels.cardId))
      .leftJoin(labels, eq(cardsToLabels.labelId, labels.id))
      .where(
        and(
          isNull(cards.deletedAt),
          filters.labels.length > 0
            ? inArray(labels.publicId, filters.labels)
            : undefined,
        ),
      );

    cardIds = filteredCards.map((card) => card.publicId);
  }

  const board = await db.query.boards.findFirst({
    columns: {
      publicId: true,
      name: true,
      slug: true,
      visibility: true,
    },
    with: {
      workspace: {
        columns: {
          publicId: true,
          name: true,
          slug: true,
        },
      },
      labels: {
        columns: {
          publicId: true,
          name: true,
          colourCode: true,
        },
        where: isNull(labels.deletedAt),
      },
      lists: {
        columns: {
          publicId: true,
          name: true,
          boardId: true,
          index: true,
        },
        with: {
          cards: {
            columns: {
              publicId: true,
              title: true,
              description: true,
              listId: true,
              index: true,
              dueDate: true,
            },
            with: {
              labels: {
                with: {
                  label: {
                    columns: {
                      publicId: true,
                      name: true,
                      colourCode: true,
                    },
                  },
                },
              },
              attachments: {
                columns: {
                  publicId: true,
                },
                where: isNull(cardAttachments.deletedAt),
                orderBy: asc(cardAttachments.createdAt),
              },
              comments: {
                columns: {
                  publicId: true,
                },
                where: isNull(comments.deletedAt),
                limit: 1,
              },
              checklists: {
                columns: {
                  publicId: true,
                  name: true,
                  index: true,
                },
                where: isNull(checklists.deletedAt),
                orderBy: asc(checklists.index),
                with: {
                  items: {
                    columns: {
                      publicId: true,
                      title: true,
                      completed: true,
                      index: true,
                    },
                    where: isNull(checklistItems.deletedAt),
                    orderBy: asc(checklistItems.index),
                  },
                },
              },
            },
            where: and(
              cardIds.length > 0 ? inArray(cards.publicId, cardIds) : undefined,
              isNull(cards.deletedAt),
              buildDueDateWhere(filters.dueDate),
            ),
            orderBy: [asc(cards.index)],
          },
        },
        where: and(
          isNull(lists.deletedAt),
          filters.lists.length > 0
            ? inArray(lists.publicId, filters.lists)
            : undefined,
        ),
        orderBy: [asc(lists.index)],
      },
      allLists: {
        columns: {
          publicId: true,
          name: true,
        },
        where: isNull(lists.deletedAt),
        orderBy: [asc(lists.index)],
      },
    },
    where: and(
      eq(boards.slug, boardSlug),
      eq(boards.workspaceId, workspaceId),
      isNull(boards.deletedAt),
      eq(boards.visibility, "public"),
    ),
  });

  if (!board) return null;

  const formattedResult = {
    ...board,
    lists: board.lists.map((list) => ({
      ...list,
      cards: list.cards.map((card) => ({
        ...card,
        labels: card.labels.map((label) => label.label),
      })),
    })),
  };

  return formattedResult;
};

export const getWithListIdsByPublicId = (
  db: dbClient,
  boardPublicId: string,
) => {
  return db.query.boards.findFirst({
    columns: {
      id: true,
      workspaceId: true,
      createdBy: true,
    },
    with: {
      lists: {
        columns: {
          id: true,
        },
      },
    },
    where: eq(boards.publicId, boardPublicId),
  });
};

export const getWithLatestListIndexByPublicId = (
  db: dbClient,
  boardPublicId: string,
) => {
  return db.query.boards.findFirst({
    columns: {
      id: true,
      workspaceId: true,
    },
    with: {
      lists: {
        columns: {
          index: true,
        },
        where: isNull(lists.deletedAt),
        orderBy: [desc(lists.index)],
        limit: 1,
      },
    },
    where: eq(boards.publicId, boardPublicId),
  });
};

export const create = async (
  db: dbClient,
  boardInput: {
    publicId?: string;
    name: string;
    createdBy: string;
    workspaceId: number;
    importId?: number;
    slug: string;
    type?: "regular" | "template";
    sourceBoardId?: number;
  },
) => {
  const [result] = await db
    .insert(boards)
    .values({
      publicId: boardInput.publicId ?? generateUID(),
      name: boardInput.name,
      createdBy: boardInput.createdBy,
      workspaceId: boardInput.workspaceId,
      importId: boardInput.importId,
      slug: boardInput.slug,
      type: boardInput.type ?? "regular",
      sourceBoardId: boardInput.sourceBoardId,
    })
    .returning({
      id: boards.id,
      publicId: boards.publicId,
      name: boards.name,
    });

  return result;
};

export const update = async (
  db: dbClient,
  boardInput: {
    name: string | undefined;
    slug: string | undefined;
    visibility: BoardVisibilityStatus | undefined;
    boardPublicId: string;
  },
) => {
  const [result] = await db
    .update(boards)
    .set({
      name: boardInput.name,
      slug: boardInput.slug,
      visibility: boardInput.visibility,
      updatedAt: new Date(),
    })
    .where(eq(boards.publicId, boardInput.boardPublicId))
    .returning({
      publicId: boards.publicId,
      name: boards.name,
    });

  return result;
};

export const softDelete = async (
  db: dbClient,
  args: {
    boardId: number;
    deletedAt: Date;
    deletedBy: string;
  },
) => {
  const [result] = await db
    .update(boards)
    .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
    .where(and(eq(boards.id, args.boardId), isNull(boards.deletedAt)))
    .returning({
      publicId: boards.publicId,
      name: boards.name,
    });

  return result;
};

export const hardDelete = async (db: dbClient, workspaceId: number) => {
  const [result] = await db
    .delete(boards)
    .where(eq(boards.workspaceId, workspaceId))
    .returning({
      publicId: boards.publicId,
      name: boards.name,
    });

  return result;
};

export const isSlugUnique = async (
  db: dbClient,
  args: { slug: string; workspaceId: number },
) => {
  const result = await db.query.boards.findFirst({
    columns: {
      slug: true,
    },
    where: and(
      eq(boards.slug, args.slug),
      eq(boards.workspaceId, args.workspaceId),
      isNull(boards.deletedAt),
    ),
  });

  return result === undefined;
};

export const getWorkspaceAndBoardIdByBoardPublicId = async (
  db: dbClient,
  boardPublicId: string,
) => {
  const result = await db.query.boards.findFirst({
    columns: {
      id: true,
      workspaceId: true,
      createdBy: true,
    },
    where: eq(boards.publicId, boardPublicId),
  });

  return result;
};

export const isBoardSlugAvailable = async (
  db: dbClient,
  boardSlug: string,
  workspaceId: number,
) => {
  const result = await db.query.boards.findFirst({
    columns: {
      id: true,
    },
    where: and(
      eq(boards.slug, boardSlug),
      eq(boards.workspaceId, workspaceId),
      isNull(boards.deletedAt),
    ),
  });

  return result === undefined;
};

// Create a new board (regular/template) from a full board snapshot
export const createFromSnapshot = async (
  db: dbClient,
  args: {
    source: {
      name: string;
      labels: { publicId: string; name: string; colourCode: string | null }[];
      lists: {
        name: string;
        index: number;
        cards: {
          title: string;
          description: string | null;
          index: number;
          labels: {
            publicId: string;
            name: string;
            colourCode: string | null;
          }[];
          checklists?: {
            publicId: string;
            name: string;
            index: number;
            items: {
              publicId: string;
              title: string;
              completed: boolean;
              index: number;
            }[];
          }[];
        }[];
      }[];
    };
    workspaceId: number;
    createdBy: string;
    slug: string;
    name?: string;
    type: "regular" | "template";
    sourceBoardId?: number;
  },
) => {
  return db.transaction(async (tx) => {
    const [newBoard] = await tx
      .insert(boards)
      .values({
        publicId: generateUID(),
        name: args.name ?? args.source.name,
        slug: args.slug,
        createdBy: args.createdBy,
        workspaceId: args.workspaceId,
        type: args.type,
        sourceBoardId: args.sourceBoardId,
      })
      .returning({
        id: boards.id,
        publicId: boards.publicId,
        name: boards.name,
      });

    if (!newBoard) throw new Error("Failed to create board");

    // Labels
    const srcLabels = args.source.labels;
    const labelMap = new Map<string, number>();

    if (srcLabels.length) {
      const inserted = await tx
        .insert(labels)
        .values(
          srcLabels.map((l) => ({
            publicId: generateUID(),
            name: l.name,
            colourCode: l.colourCode ?? null,
            createdBy: args.createdBy,
            boardId: newBoard.id,
          })),
        )
        .returning({ id: labels.id });

      for (let i = 0; i < srcLabels.length; i++) {
        const src = srcLabels[i];

        if (!src) throw new Error("Source label not found");

        const created = inserted[i];
        if (created) labelMap.set(src.publicId, created.id);
      }
    }

    // Lists
    const listIndexToId = new Map<number, number>();
    const srcLists = [...args.source.lists].sort((a, b) => a.index - b.index);
    if (srcLists.length) {
      const insertedLists = await tx
        .insert(lists)
        .values(
          srcLists.map((list) => ({
            publicId: generateUID(),
            name: list.name,
            createdBy: args.createdBy,
            boardId: newBoard.id,
            index: list.index,
          })),
        )
        .returning({ id: lists.id, index: lists.index });

      for (const list of insertedLists) listIndexToId.set(list.index, list.id);
    }

    // Cards, card-labels, checklists
    for (const list of srcLists) {
      const newListId = listIndexToId.get(list.index);
      if (!newListId) continue;
      const sortedCards = [...list.cards].sort((a, b) => a.index - b.index);

      for (const card of sortedCards) {
        const [createdCard] = await tx
          .insert(cards)
          .values({
            publicId: generateUID(),
            title: card.title,
            description: card.description ?? "",
            createdBy: args.createdBy,
            listId: newListId,
            index: card.index,
          })
          .returning({ id: cards.id });

        if (!createdCard) throw new Error("Failed to create card");

        // Create card.created activity
        await tx.insert(cardActivities).values({
          publicId: generateUID(),
          type: "card.created",
          cardId: createdCard.id,
          createdBy: args.createdBy,
          sourceBoardId: args.sourceBoardId,
        });

        if (card.labels.length) {
          const cardLabels: { cardId: number; labelId: number }[] = [];
          for (const label of card.labels) {
            const newLabelId = labelMap.get(label.publicId);
            if (newLabelId)
              cardLabels.push({ cardId: createdCard.id, labelId: newLabelId });
          }
          if (cardLabels.length) {
            await tx.insert(cardsToLabels).values(cardLabels);

            // Create card.updated.label.added activities for each label
            const labelActivities = cardLabels.map((cardLabel) => ({
              publicId: generateUID(),
              type: "card.updated.label.added" as const,
              cardId: cardLabel.cardId,
              labelId: cardLabel.labelId,
              createdBy: args.createdBy,
              sourceBoardId: args.sourceBoardId,
            }));
            await tx.insert(cardActivities).values(labelActivities);
          }
        }

        if (card.checklists?.length) {
          const sortedChecklists = [...card.checklists].sort(
            (a, b) => a.index - b.index,
          );
          for (const checklist of sortedChecklists) {
            const [createdChecklist] = await tx
              .insert(checklists)
              .values({
                publicId: generateUID(),
                name: checklist.name,
                createdBy: args.createdBy,
                cardId: createdCard.id,
                index: checklist.index,
              })
              .returning({ id: checklists.id });

            if (!createdChecklist) continue;

            // Create card.updated.checklist.added activity
            await tx.insert(cardActivities).values({
              publicId: generateUID(),
              type: "card.updated.checklist.added",
              cardId: createdCard.id,
              toTitle: checklist.name,
              createdBy: args.createdBy,
              sourceBoardId: args.sourceBoardId,
            });

            if (checklist.items.length) {
              const itemValues = [...checklist.items]
                .sort((a, b) => a.index - b.index)
                .map((checklistItem) => ({
                  publicId: generateUID(),
                  title: checklistItem.title,
                  createdBy: args.createdBy,
                  checklistId: createdChecklist.id,
                  index: checklistItem.index,
                  completed: !!checklistItem.completed,
                }));

              if (itemValues.length) {
                await tx.insert(checklistItems).values(itemValues);

                // Create card.updated.checklist.item.added activities for each item
                const itemActivities = itemValues.map((item) => ({
                  publicId: generateUID(),
                  type: "card.updated.checklist.item.added" as const,
                  cardId: createdCard.id,
                  toTitle: item.title,
                  createdBy: args.createdBy,
                  sourceBoardId: args.sourceBoardId,
                }));
                await tx.insert(cardActivities).values(itemActivities);
              }
            }
          }
        }
      }
    }

    return newBoard;
  });
};

export const addUserFavorite = async (
  db: dbClient,
  userId: string,
  boardId: number,
) => {
  return db
    .insert(userBoardFavorites)
    .values({
      userId,
      boardId,
    })
    .onConflictDoNothing()
    .returning();
};

export const removeUserFavorite = async (
  db: dbClient,
  userId: string,
  boardId: number,
) => {
  return db
    .delete(userBoardFavorites)
    .where(
      and(
        eq(userBoardFavorites.userId, userId),
        eq(userBoardFavorites.boardId, boardId)
      )
    )
    .returning();
};


================================================
FILE: packages/db/src/repository/card.repo.ts
================================================
import {
  and,
  asc,
  count,
  desc,
  eq,
  gt,
  inArray,
  isNull,
  sql,
} from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import {
  cardActivities,
  cardAttachments,
  cards,
  cardsToLabels,
  cardToWorkspaceMembers,
  checklistItems,
  checklists,
  labels,
  lists,
  workspaceMembers,
} from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(cards)
    .where(isNull(cards.deletedAt));

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  cardInput: {
    title: string;
    description: string;
    createdBy: string;
    listId: number;
    position: "start" | "end";
    dueDate?: Date | null;
  },
) => {
  return db.transaction(async (tx) => {
    let index = 0;

    if (cardInput.position === "end") {
      const lastCard = await tx.query.cards.findFirst({
        columns: {
          index: true,
        },
        where: and(eq(cards.listId, cardInput.listId), isNull(cards.deletedAt)),
        orderBy: desc(cards.index),
      });

      if (lastCard) index = lastCard.index + 1;
    }

    const getExistingCardAtIndex = async () =>
      tx.query.cards.findFirst({
        columns: {
          id: true,
        },
        where: and(
          eq(cards.listId, cardInput.listId),
          eq(cards.index, index),
          isNull(cards.deletedAt),
        ),
      });

    const existingCardAtIndex = await getExistingCardAtIndex();

    if (existingCardAtIndex?.id) {
      await tx.execute(sql`
        UPDATE card
        SET index = index + 1
        WHERE "listId" = ${cardInput.listId} AND index >= ${index} AND "deletedAt" IS NULL;
      `);
    }

    const result = await tx
      .insert(cards)
      .values({
        publicId: generateUID(),
        title: cardInput.title,
        description: cardInput.description,
        createdBy: cardInput.createdBy,
        listId: cardInput.listId,
        index: index,
        dueDate: cardInput.dueDate ?? null,
      })
      .returning({ id: cards.id, listId: cards.listId, publicId: cards.publicId });

    if (!result[0]) throw new Error("Unable to create card");

    await tx.insert(cardActivities).values({
      publicId: generateUID(),
      cardId: result[0].id,
      type: "card.created",
      createdBy: cardInput.createdBy,
    });

    const countExpr = sql<number>`COUNT(*)`.mapWith(Number);

    const duplicateIndices = await tx
      .select({
        index: cards.index,
        count: countExpr,
      })
      .from(cards)
      .where(and(eq(cards.listId, result[0].listId), isNull(cards.deletedAt)))
      .groupBy(cards.listId, cards.index)
      .having(gt(countExpr, 1));

    if (duplicateIndices.length > 0) {
      // Compact indices for this list to sequential values (0..n-1) preserving order
      await tx.execute(sql`
        WITH ordered AS (
          SELECT id, ROW_NUMBER() OVER (ORDER BY "index", id) - 1 AS new_index
          FROM "card"
          WHERE "listId" = ${result[0].listId} AND "deletedAt" IS NULL
        )
        UPDATE "card" c
        SET "index" = o.new_index
        FROM ordered o
        WHERE c.id = o.id;
      `);

      // Last resort: verify fix; rollback if duplicates persist
      const postFixDupes = await tx
        .select({ index: cards.index, count: countExpr })
        .from(cards)
        .where(and(eq(cards.listId, result[0].listId), isNull(cards.deletedAt)))
        .groupBy(cards.listId, cards.index)
        .having(gt(countExpr, 1));

      if (postFixDupes.length > 0) {
        throw new Error(
          `Invariant violation: duplicate card indices remain after compaction in list ${result[0].listId}`,
        );
      }
    }

    return result[0];
  });
};

export const bulkCreateCardLabelRelationships = async (
  db: dbClient,
  cardLabelRelationshipInput: {
    cardId: number;
    labelId: number;
  }[],
) => {
  const result = await db
    .insert(cardsToLabels)
    .values(cardLabelRelationshipInput)
    .returning();

  return result;
};

export const bulkCreateCardWorkspaceMemberRelationships = async (
  db: dbClient,
  cardWorkspaceMemberRelationshipInput: {
    cardId: number;
    workspaceMemberId: number;
  }[],
) => {
  const result = await db
    .insert(cardToWorkspaceMembers)
    .values(cardWorkspaceMemberRelationshipInput)
    .returning();

  return result;
};

export const update = async (
  db: dbClient,
  cardInput: {
    title?: string;
    description?: string;
    dueDate?: Date | null;
  },
  args: {
    cardPublicId: string;
  },
) => {
  const [result] = await db
    .update(cards)
    .set({
      title: cardInput.title,
      description: cardInput.description,
      dueDate: cardInput.dueDate !== undefined ? cardInput.dueDate : undefined,
      updatedAt: new Date(),
    })
    .where(and(eq(cards.publicId, args.cardPublicId), isNull(cards.deletedAt)))
    .returning({
      id: cards.id,
      publicId: cards.publicId,
      title: cards.title,
      description: cards.description,
      dueDate: cards.dueDate,
    });

  return result;
};

export const getCardWithListByPublicId = (
  db: dbClient,
  cardPublicId: string,
) => {
  return db.query.cards.findFirst({
    columns: {
      id: true,
      index: true,
    },
    with: {
      list: {
        columns: {
          id: true,
          boardId: true,
        },
      },
    },
    where: and(eq(cards.publicId, cardPublicId), isNull(cards.deletedAt)),
  });
};

export const getByPublicId = (db: dbClient, cardPublicId: string) => {
  return db.query.cards.findFirst({
    columns: {
      id: true,
      publicId: true,
      title: true,
      description: true,
      listId: true,
      dueDate: true,
    },
    where: eq(cards.publicId, cardPublicId),
  });
};

export const getCardLabelRelationship = async (
  db: dbClient,
  args: { cardId: number; labelId: number },
) => {
  return db.query.cardsToLabels.findFirst({
    where: and(
      eq(cardsToLabels.cardId, args.cardId),
      eq(cardsToLabels.labelId, args.labelId),
    ),
  });
};

export const bulkCreate = async (
  db: dbClient,
  cardInput: {
    publicId: string;
    title: string;
    description: string;
    createdBy: string;
    listId: number;
    index: number;
    importId?: number;
  }[],
) => {
  if (cardInput.length === 0) return [];

  return db.transaction(async (tx) => {
    // Group incoming cards by list to compute safe, sequential indices per list
    const byList = new Map<number, typeof cardInput>();
    for (const item of cardInput) {
      const arr = byList.get(item.listId) ?? [];
      arr.push(item);
      byList.set(item.listId, arr);
    }

    const allValuesToInsert: {
      publicId: string;
      title: string;
      description: string;
      createdBy: string;
      listId: number;
      index: number;
      importId?: number;
    }[] = [];

    // For each list, append incoming cards after current max index, preserving incoming order
    for (const [listId, items] of byList.entries()) {
      const last = await tx.query.cards.findFirst({
        columns: { index: true },
        where: and(eq(cards.listId, listId), isNull(cards.deletedAt)),
        orderBy: [desc(cards.index)],
      });

      let nextIndex = last ? last.index + 1 : 0;
      const sorted = [...items].sort((a, b) => a.index - b.index);
      for (const it of sorted) {
        allValuesToInsert.push({
          publicId: it.publicId,
          title: it.title,
          description: it.description,
          createdBy: it.createdBy,
          listId: it.listId,
          index: nextIndex++,
          importId: it.importId,
        });
      }
    }

    const inserted = await tx
      .insert(cards)
      .values(allValuesToInsert)
      .returning({ id: cards.id });

    // Post-insert: compact per list if duplicates exist; then verify
    const countExpr = sql<number>`COUNT(*)`.mapWith(Number);
    for (const listId of byList.keys()) {
      const duplicateIndices = await tx
        .select({ index: cards.index, count: countExpr })
        .from(cards)
        .where(and(eq(cards.listId, listId), isNull(cards.deletedAt)))
        .groupBy(cards.listId, cards.index)
        .having(gt(countExpr, 1));

      if (duplicateIndices.length > 0) {
        await tx.execute(sql`
          WITH ordered AS (
            SELECT id, ROW_NUMBER() OVER (ORDER BY "index", id) - 1 AS new_index
            FROM "card"
            WHERE "listId" = ${listId} AND "deletedAt" IS NULL
          )
          UPDATE "card" c
          SET "index" = o.new_index
          FROM ordered o
          WHERE c.id = o.id;
        `);

        const postFixDupes = await tx
          .select({ index: cards.index, count: countExpr })
          .from(cards)
          .where(and(eq(cards.listId, listId), isNull(cards.deletedAt)))
          .groupBy(cards.listId, cards.index)
          .having(gt(countExpr, 1));

        if (postFixDupes.length > 0) {
          throw new Error(
            `Invariant violation: duplicate card indices remain after compaction in list ${listId}`,
          );
        }
      }
    }

    return inserted;
  });
};

export const createCardLabelRelationship = async (
  db: dbClient,
  cardLabelRelationshipInput: { cardId: number; labelId: number },
) => {
  const [result] = await db
    .insert(cardsToLabels)
    .values({
      cardId: cardLabelRelationshipInput.cardId,
      labelId: cardLabelRelationshipInput.labelId,
    })
    .returning();

  return result;
};

export const bulkCreateCardLabelRelationship = async (
  db: dbClient,
  cardLabelRelationshipInput: { cardId: number; labelId: number }[],
) => {
  const [result] = await db
    .insert(cardsToLabels)
    .values(cardLabelRelationshipInput)
    .returning();

  return result;
};

export const getCardMemberRelationship = (
  db: dbClient,
  args: { cardId: number; memberId: number },
) => {
  return db.query.cardToWorkspaceMembers.findFirst({
    where: and(
      eq(cardToWorkspaceMembers.cardId, args.cardId),
      eq(cardToWorkspaceMembers.workspaceMemberId, args.memberId),
    ),
  });
};

export const createCardMemberRelationship = async (
  db: dbClient,
  cardMemberRelationshipInput: { cardId: number; memberId: number },
) => {
  const [result] = await db
    .insert(cardToWorkspaceMembers)
    .values({
      cardId: cardMemberRelationshipInput.cardId,
      workspaceMemberId: cardMemberRelationshipInput.memberId,
    })
    .returning();

  return { success: !!result };
};

export const getWithListAndMembersByPublicId = async (
  db: dbClient,
  cardPublicId: string,
) => {
  const card = await db.query.cards.findFirst({
    columns: {
      id: true,
      publicId: true,
      title: true,
      description: true,
      dueDate: true,
      createdBy: true,
    },
    with: {
      labels: {
        with: {
          label: {
            columns: {
              publicId: true,
              name: true,
              colourCode: true,
            },
          },
        },
      },
      attachments: {
        columns: {
          publicId: true,
          contentType: true,
          s3Key: true,
          originalFilename: true,
          size: true,
        },
        where: isNull(cardAttachments.deletedAt),
        orderBy: asc(cardAttachments.createdAt),
      },
      checklists: {
        columns: {
          publicId: true,
          name: true,
          index: true,
        },
        where: isNull(checklists.deletedAt),
        orderBy: asc(checklists.index),
        with: {
          items: {
            columns: {
              publicId: true,
              title: true,
              completed: true,
              index: true,
            },
            where: isNull(checklistItems.deletedAt),
            orderBy: asc(checklistItems.index),
          },
        },
      },
      list: {
        columns: {
          publicId: true,
          name: true,
        },
        with: {
          board: {
            columns: {
              publicId: true,
              name: true,
            },
            with: {
              labels: {
                columns: {
                  publicId: true,
                  colourCode: true,
                  name: true,
                },
                where: isNull(labels.deletedAt),
              },
              lists: {
                columns: {
                  publicId: true,
                  name: true,
                },
                where: isNull(lists.deletedAt),
                orderBy: asc(lists.index),
              },
              workspace: {
                columns: {
                  publicId: true,
                },
                with: {
                  members: {
                    columns: {
                      publicId: true,
                      email: true,
                      status: true,
                    },
                    with: {
                      user: {
                        columns: {
                          id: true,
                          name: true,
                          email: true,
                          image: true,
                        },
                      },
                    },
                    where: isNull(workspaceMembers.deletedAt),
                  },
                },
              },
            },
          },
        },
        // https://github.com/drizzle-team/drizzle-orm/issues/2903
        // where: isNull(lists.deletedAt),
      },
      members: {
        with: {
          member: {
            columns: {
              publicId: true,
              email: true,
            },
            with: {
              user: {
                columns: {
                  id: true,
                  name: true,
                },
              },
            },
            // https://github.com/drizzle-team/drizzle-orm/issues/2903
            // where: isNull(workspaceMembers.deletedAt),
          },
        },
      },
      activities: {
        columns: {
          publicId: true,
          type: true,
          createdAt: true,
          fromIndex: true,
          toIndex: true,
          fromTitle: true,
          toTitle: true,
          fromDescription: true,
          toDescription: true,
          fromDueDate: true,
          toDueDate: true,
        },
        with: {
          fromList: {
            columns: {
              publicId: true,
              name: true,
              index: true,
            },
          },
          toList: {
            columns: {
              publicId: true,
              name: true,
              index: true,
            },
          },
          label: {
            columns: {
              publicId: true,
              name: true,
            },
          },
          member: {
            columns: {
              publicId: true,
            },
            with: {
              user: {
                columns: {
                  id: true,
                  name: true,
                  email: true,
                },
              },
            },
          },
          user: {
            columns: {
              id: true,
              name: true,
              email: true,
            },
          },
          comment: {
            columns: {
              publicId: true,
              comment: true,
              createdBy: true,
              updatedAt: true,
              deletedAt: true,
            },
            // https://github.com/drizzle-team/drizzle-orm/issues/2903
            // where: isNull(comments.deletedAt),
          },
        },
      },
    },
    where: and(eq(cards.publicId, cardPublicId), isNull(cards.deletedAt)),
  });

  if (!card) return null;

  const formattedResult = {
    ...card,
    labels: card.labels.map((label) => label.label),
    members: card.members.map((member) => member.member),
    activities: card.activities.filter(
      (activity) => !activity.comment?.deletedAt,
    ),
  };

  return formattedResult;
};

export const reorder = async (
  db: dbClient,
  args: {
    newListId: number | undefined;
    newIndex: number | undefined;
    cardId: number;
  },
) => {
  return db.transaction(async (tx) => {
    const card = await tx.query.cards.findFirst({
      columns: {
        id: true,
        index: true,
      },
      where: and(eq(cards.id, args.cardId), isNull(cards.deletedAt)),
      with: {
        list: {
          columns: {
            id: true,
            index: true,
          },
        },
      },
    });

    if (!card?.list)
      throw new Error(`Card not found for public ID ${args.cardId}`);

    const currentList = card.list;
    const currentIndex = card.index;
    let newList:
      | { id: number; index: number; cards: { id: number; index: number }[] }
      | undefined;

    if (args.newListId) {
      newList = await tx.query.lists.findFirst({
        columns: {
          id: true,
          index: true,
        },
        with: {
          cards: {
            columns: {
              id: true,
              index: true,
            },
            orderBy: desc(cards.index),
            limit: 1,
          },
        },
        where: and(eq(lists.id, args.newListId), isNull(lists.deletedAt)),
      });

      if (!newList)
        throw new Error(`List not found for public ID ${args.newListId}`);
    }

    let newIndex = args.newIndex;

    if (newIndex === undefined) {
      const lastCardIndex = newList?.cards.length
        ? newList.cards[0]?.index
        : undefined;

      newIndex = lastCardIndex !== undefined ? lastCardIndex + 1 : 0;
    }

    if (currentList.id === newList?.id) {
      await tx.execute(sql`
        UPDATE card
        SET index =
          CASE
            WHEN index = ${currentIndex} THEN ${newIndex}
            WHEN ${currentIndex} < ${newIndex} AND index > ${currentIndex} AND index <= ${newIndex} THEN index - 1
            WHEN ${currentIndex} > ${newIndex} AND index >= ${newIndex} AND index < ${currentIndex} THEN index + 1
            ELSE index
          END
        WHERE "listId" = ${currentList.id} AND "deletedAt" IS NULL;
      `);
    } else {
      await tx.execute(sql`
        UPDATE card
        SET index = index + 1
        WHERE "listId" = ${newList?.id} AND index >= ${newIndex} AND "deletedAt" IS NULL;
      `);

      await tx.execute(sql`
        UPDATE card
        SET index = index - 1
        WHERE "listId" = ${currentList.id} AND index >= ${currentIndex} AND "deletedAt" IS NULL;
      `);

      await tx.execute(sql`
        UPDATE card
        SET "listId" = ${newList?.id}, index = ${newIndex}
        WHERE id = ${card.id} AND "deletedAt" IS NULL;
      `);
    }

    const countExpr = sql<number>`COUNT(*)`.mapWith(Number);

    const duplicateIndices = await tx
      .select({
        index: cards.index,
        count: countExpr,
      })
      .from(cards)
      .where(
        and(
          inArray(
            cards.listId,
            [currentList.id, newList?.id].filter((id) => id !== undefined),
          ),
          isNull(cards.deletedAt),
        ),
      )
      .groupBy(cards.listId, cards.index)
      .having(gt(countExpr, 1));

    if (duplicateIndices.length > 0) {
      // Auto-heal by compacting indices for the affected list(s)
      const affectedListIds = [currentList.id, newList?.id].filter(
        (id): id is number => id !== undefined,
      );

      if (affectedListIds.length === 1) {
        await tx.execute(sql`
          WITH ordered AS (
            SELECT id, ROW_NUMBER() OVER (ORDER BY "index", id) - 1 AS new_index
            FROM "card"
            WHERE "listId" = ${affectedListIds[0]} AND "deletedAt" IS NULL
          )
          UPDATE "card" c
          SET "index" = o.new_index
          FROM ordered o
          WHERE c.id = o.id;
        `);
      } else if (affectedListIds.length === 2) {
        await tx.execute(sql`
          WITH ordered AS (
            SELECT id,
                   ROW_NUMBER() OVER (PARTITION BY "listId" ORDER BY "index", id) - 1 AS new_index
            FROM "card"
            WHERE "listId" IN (${sql.join(affectedListIds, sql`,`)}) AND "deletedAt" IS NULL
          )
          UPDATE "card" c
          SET "index" = o.new_index
          FROM ordered o
          WHERE c.id = o.id;
        `);
      }

      // Verify fix and rollback if necessary
      const postFixDupes = await tx
        .select({ index: cards.index, count: countExpr })
        .from(cards)
        .where(
          and(inArray(cards.listId, affectedListIds), isNull(cards.deletedAt)),
        )
        .groupBy(cards.listId, cards.index)
        .having(gt(countExpr, 1));

      if (postFixDupes.length > 0) {
        throw new Error(
          `Invariant violation: duplicate card indices remain after compaction for card ${card.id}`,
        );
      }
    }

    const updatedCard = await tx.query.cards.findFirst({
      columns: {
        id: true,
        publicId: true,
        title: true,
        description: true,
        dueDate: true,
      },
      where: eq(cards.id, card.id),
    });

    return updatedCard;
  });
};

export const softDelete = async (
  db: dbClient,
  args: {
    cardId: number;
    deletedAt: Date;
    deletedBy: string;
  },
) => {
  return db.transaction(async (tx) => {
    const [result] = await tx
      .update(cards)
      .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
      .where(eq(cards.id, args.cardId))
      .returning({
        id: cards.id,
        listId: cards.listId,
        index: cards.index,
      });

    if (!result)
      throw new Error(`Unable to soft delete card ID ${args.cardId}`);

    await tx.execute(sql`
      UPDATE card
      SET index = index - 1
      WHERE "listId" = ${result.listId} AND index > ${result.index} AND "deletedAt" IS NULL;
    `);

    const countExpr = sql<number>`COUNT(*)`.mapWith(Number);

    const duplicateIndices = await tx
      .select({
        index: cards.index,
        count: countExpr,
      })
      .from(cards)
      .where(and(eq(cards.listId, result.listId), isNull(cards.deletedAt)))
      .groupBy(cards.listId, cards.index)
      .having(gt(countExpr, 1));

    if (duplicateIndices.length > 0) {
      throw new Error(
        `Duplicate indices found after soft deleting ${result.id}`,
      );
    }

    return result;
  });
};

export const softDeleteAllByListIds = async (
  db: dbClient,
  args: {
    listIds: number[];
    deletedAt: Date;
    deletedBy: string;
  },
) => {
  const updatedCards = await db
    .update(cards)
    .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
    .where(and(inArray(cards.listId, args.listIds), isNull(cards.deletedAt)))
    .returning({
      id: cards.id,
    });

  return updatedCards;
};

export const hardDeleteCardMemberRelationship = async (
  db: dbClient,
  args: { cardId: number; memberId: number },
) => {
  const [result] = await db
    .delete(cardToWorkspaceMembers)
    .where(
      and(
        eq(cardToWorkspaceMembers.cardId, args.cardId),
        eq(cardToWorkspaceMembers.workspaceMemberId, args.memberId),
      ),
    )
    .returning();

  return { success: !!result };
};

export const hardDeleteCardLabelRelationship = async (
  db: dbClient,
  args: { cardId: number; labelId: number },
) => {
  const [result] = await db
    .delete(cardsToLabels)
    .where(
      and(
        eq(cardsToLabels.cardId, args.cardId),
        eq(cardsToLabels.labelId, args.labelId),
      ),
    )
    .returning();

  return result;
};

export const hardDeleteAllCardLabelRelationships = async (
  db: dbClient,
  labelId: number,
) => {
  const [result] = await db
    .delete(cardsToLabels)
    .where(eq(cardsToLabels.labelId, labelId))
    .returning();

  return result;
};

export const getWorkspaceAndCardIdByCardPublicId = async (
  db: dbClient,
  cardPublicId: string,
) => {
  const result = await db.query.cards.findFirst({
    columns: { id: true, createdBy: true },
    where: and(eq(cards.publicId, cardPublicId), isNull(cards.deletedAt)),
    with: {
      list: {
        columns: { name: true },
        with: {
          board: {
            columns: {
              publicId: true,
              workspaceId: true,
              visibility: true,
              name: true,
            },
          },
        },
      },
    },
  });

  return result
    ? {
        id: result.id,
        createdBy: result.createdBy,
        workspaceId: result.list.board.workspaceId,
        workspaceVisibility: result.list.board.visibility,
        listName: result.list.name,
        boardPublicId: result.list.board.publicId,
        boardName: result.list.board.name,
      }
    : null;
};



================================================
FILE: packages/db/src/repository/cardActivity.repo.ts
================================================
import { and, asc, count, eq, gt, inArray, isNull, or } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import type { ActivityType } from "@kan/db/schema";
import { cardActivities, comments } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db.select({ count: count() }).from(cardActivities);

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  activityInput: {
    type: ActivityType;
    cardId: number;
    fromIndex?: number;
    toIndex?: number;
    fromListId?: number;
    toListId?: number;
    labelId?: number;
    workspaceMemberId?: number;
    fromTitle?: string;
    toTitle?: string;
    fromDescription?: string;
    toDescription?: string;
    createdBy: string;
    commentId?: number;
    fromComment?: string;
    toComment?: string;
    fromDueDate?: Date;
    toDueDate?: Date;
    sourceBoardId?: number;
    attachmentId?: number;
  },
) => {
  const [result] = await db
    .insert(cardActivities)
    .values({
      publicId: generateUID(),
      type: activityInput.type,
      cardId: activityInput.cardId,
      fromListId: activityInput.fromListId,
      toListId: activityInput.toListId,
      fromIndex: activityInput.fromIndex,
      toIndex: activityInput.toIndex,
      labelId: activityInput.labelId,
      workspaceMemberId: activityInput.workspaceMemberId,
      fromTitle: activityInput.fromTitle,
      toTitle: activityInput.toTitle,
      fromDescription: activityInput.fromDescription,
      toDescription: activityInput.toDescription,
      createdBy: activityInput.createdBy,
      commentId: activityInput.commentId,
      fromComment: activityInput.fromComment,
      toComment: activityInput.toComment,
      fromDueDate: activityInput.fromDueDate,
      toDueDate: activityInput.toDueDate,
      sourceBoardId: activityInput.sourceBoardId,
      attachmentId: activityInput.attachmentId,
    })
    .returning({ id: cardActivities.id });

  return result;
};

export const bulkCreate = async (
  db: dbClient,
  activityInputs: {
    type: ActivityType;
    cardId: number;
    fromIndex?: number;
    toIndex?: number;
    fromListId?: number;
    toListId?: number;
    labelId?: number;
    workspaceMemberId?: number;
    fromTitle?: string;
    toTitle?: string;
    fromDescription?: string;
    toDescription?: string;
    createdBy: string;
    fromDueDate?: Date;
    toDueDate?: Date;
    sourceBoardId?: number;
    attachmentId?: number;
  }[],
) => {
  const activitiesWithPublicIds = activityInputs.map((activity) => ({
    ...activity,
    publicId: generateUID(),
  }));

  const results = await db
    .insert(cardActivities)
    .values(activitiesWithPublicIds)
    .returning({ id: cardActivities.id });

  return results;
};

export const getPaginatedActivities = async (
  db: dbClient,
  cardId: number,
  options?: {
    limit?: number;
    cursor?: Date; // createdAt cursor for pagination
  },
) => {
  const limit = options?.limit ?? 20;
  const cursor = options?.cursor;

  const validComments = await db
    .select({ id: comments.id })
    .from(comments)
    .where(and(eq(comments.cardId, cardId), isNull(comments.deletedAt)));

  const validCommentIds = validComments.map((comment) => comment.id);

  const activities = await db.query.cardActivities.findMany({
    columns: {
      publicId: true,
      type: true,
      createdAt: true,
      fromIndex: true,
      toIndex: true,
      fromTitle: true,
      toTitle: true,
      fromDescription: true,
      toDescription: true,
      fromDueDate: true,
      toDueDate: true,
    },
    where: and(
      eq(cardActivities.cardId, cardId),
      cursor ? gt(cardActivities.createdAt, cursor) : undefined,
      or(
        isNull(cardActivities.commentId),
        inArray(cardActivities.commentId, validCommentIds),
      ),
    ),
    with: {
      fromList: {
        columns: {
          publicId: true,
          name: true,
          index: true,
        },
      },
      toList: {
        columns: {
          publicId: true,
          name: true,
          index: true,
        },
      },
      label: {
        columns: {
          publicId: true,
          name: true,
        },
      },
      member: {
        columns: {
          publicId: true,
        },
        with: {
          user: {
            columns: {
              id: true,
              name: true,
              email: true,
              image: true,
            },
          },
        },
      },
      user: {
        columns: {
          id: true,
          name: true,
          email: true,
          image: true,
        },
      },
      comment: {
        columns: {
          publicId: true,
          comment: true,
          createdBy: true,
          updatedAt: true,
          deletedAt: true,
        },
      },
      attachment: {
        columns: {
          publicId: true,
          filename: true,
          originalFilename: true,
        },
      },
    },
    orderBy: asc(cardActivities.createdAt), // required for merging and pagination
    limit: limit + 1, // fetch one extra to check if there are more
  });

  const hasMore = activities.length > limit;
  const items = activities.slice(0, limit);
  const nextCursor = hasMore ? items[items.length - 1]?.createdAt : undefined;

  return {
    activities: items,
    hasMore,
    nextCursor,
  };
};

export type PaginatedActivitiesResult = Awaited<
  ReturnType<typeof getPaginatedActivities>
>;



================================================
FILE: packages/db/src/repository/cardAttachment.repo.ts
================================================
import { and, count, eq, isNull } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { cardAttachments } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(cardAttachments)
    .where(isNull(cardAttachments.deletedAt));

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  attachmentInput: {
    cardId: number;
    filename: string;
    originalFilename: string;
    contentType: string;
    size: number;
    s3Key: string;
    createdBy: string;
  },
) => {
  const [result] = await db
    .insert(cardAttachments)
    .values({
      publicId: generateUID(),
      cardId: attachmentInput.cardId,
      filename: attachmentInput.filename,
      originalFilename: attachmentInput.originalFilename,
      contentType: attachmentInput.contentType,
      size: attachmentInput.size,
      s3Key: attachmentInput.s3Key,
      createdBy: attachmentInput.createdBy,
    })
    .returning({
      id: cardAttachments.id,
      publicId: cardAttachments.publicId,
      filename: cardAttachments.filename,
      originalFilename: cardAttachments.originalFilename,
      contentType: cardAttachments.contentType,
      size: cardAttachments.size,
      s3Key: cardAttachments.s3Key,
      createdBy: cardAttachments.createdBy,
      createdAt: cardAttachments.createdAt,
    });

  return result;
};

export const getByPublicId = (db: dbClient, publicId: string) => {
  return db.query.cardAttachments.findFirst({
    where: eq(cardAttachments.publicId, publicId),
    with: {
      card: {
        columns: {
          id: true,
          publicId: true,
        },
        with: {
          list: {
            columns: {
              id: true,
            },
            with: {
              board: {
                columns: {
                  id: true,
                  workspaceId: true,
                },
              },
            },
          },
        },
      },
    },
  });
};

export const getAllByCardId = (db: dbClient, cardId: number) => {
  return db.query.cardAttachments.findMany({
    where: and(
      eq(cardAttachments.cardId, cardId),
      isNull(cardAttachments.deletedAt),
    ),
    orderBy: (attachments, { desc }) => [desc(attachments.createdAt)],
  });
};

export const softDelete = async (
  db: dbClient,
  args: {
    attachmentId: number;
    deletedAt: Date;
  },
) => {
  const [result] = await db
    .update(cardAttachments)
    .set({ deletedAt: args.deletedAt })
    .where(eq(cardAttachments.id, args.attachmentId))
    .returning({ id: cardAttachments.id });

  return result;
};



================================================
FILE: packages/db/src/repository/cardComment.repo.ts
================================================
import { count, eq, isNull } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { comments } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(comments)
    .where(isNull(comments.deletedAt));

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  commentInput: {
    cardId: number;
    comment: string;
    createdBy: string;
  },
) => {
  const [result] = await db
    .insert(comments)
    .values({
      publicId: generateUID(),
      comment: commentInput.comment,
      createdBy: commentInput.createdBy,
      cardId: commentInput.cardId,
    })
    .returning({
      id: comments.id,
      publicId: comments.publicId,
      comment: comments.comment,
    });

  return result;
};

export const getByPublicId = (db: dbClient, publicId: string) => {
  return db.query.comments.findFirst({
    columns: {
      id: true,
      publicId: true,
      comment: true,
      createdBy: true,
    },
    where: eq(comments.publicId, publicId),
  });
};

export const update = async (
  db: dbClient,
  commentInput: {
    id: number;
    comment: string;
  },
) => {
  const [result] = await db
    .update(comments)
    .set({
      comment: commentInput.comment,
      updatedAt: new Date(),
    })
    .where(eq(comments.id, commentInput.id))
    .returning({
      id: comments.id,
      publicId: comments.publicId,
      comment: comments.comment,
    });

  return result;
};

export const softDelete = async (
  db: dbClient,
  args: {
    commentId: number;
    deletedAt: Date;
    deletedBy: string;
  },
) => {
  const [result] = await db
    .update(comments)
    .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
    .where(eq(comments.id, args.commentId))
    .returning({ id: comments.id });

  return result;
};



================================================
FILE: packages/db/src/repository/checklist.repo.ts
================================================
import { and, count, desc, eq, isNull, sql } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { checklistItems, checklists } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(checklists)
    .where(isNull(checklists.deletedAt));
  return result[0]?.count ?? 0;
};

export const getCountItems = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(checklistItems)
    .where(isNull(checklistItems.deletedAt));
  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  checklistInput: {
    cardId: number;
    name: string;
    createdBy: string;
  },
) => {
  return db.transaction(async (tx) => {
    const card = await tx.query.checklists.findFirst({
      where: and(
        eq(checklists.cardId, checklistInput.cardId),
        isNull(checklists.deletedAt),
      ),
      orderBy: desc(checklists.index),
    });

    const [result] = await tx
      .insert(checklists)
      .values({
        publicId: generateUID(),
        name: checklistInput.name,
        createdBy: checklistInput.createdBy,
        cardId: checklistInput.cardId,
        index: card ? card.index + 1 : 0,
      })
      .returning({
        id: checklists.id,
        publicId: checklists.publicId,
        name: checklists.name,
      });

    return result;
  });
};

export const createItem = async (
  db: dbClient,
  checklistItemInput: {
    checklistId: number;
    title: string;
    createdBy: string;
    completed?: boolean;
  },
) => {
  return db.transaction(async (tx) => {
    const lastItem = await tx.query.checklistItems.findFirst({
      where: and(
        eq(checklistItems.checklistId, checklistItemInput.checklistId),
        isNull(checklistItems.deletedAt),
      ),
      orderBy: desc(checklistItems.index),
    });

    const [result] = await tx
      .insert(checklistItems)
      .values({
        publicId: generateUID(),
        title: checklistItemInput.title,
        createdBy: checklistItemInput.createdBy,
        checklistId: checklistItemInput.checklistId,
        index: lastItem ? lastItem.index + 1 : 0,
        completed: checklistItemInput.completed ?? false,
      })
      .returning({
        id: checklistItems.id,
        publicId: checklistItems.publicId,
        title: checklistItems.title,
        completed: checklistItems.completed,
      });

    return result;
  });
};

export const getChecklistByPublicId = async (
  db: dbClient,
  checklistPublicId: string,
) => {
  const checklist = await db.query.checklists.findFirst({
    where: and(
      eq(checklists.publicId, checklistPublicId),
      isNull(checklists.deletedAt),
    ),
    with: {
      card: {
        with: {
          list: {
            with: {
              board: {
                with: {
                  workspace: true,
                },
              },
            },
          },
        },
      },
    },
  });

  return checklist;
};

export const getChecklistItemByPublicIdWithChecklist = async (
  db: dbClient,
  checklistItemPublicId: string,
) => {
  const item = await db.query.checklistItems.findFirst({
    where: and(
      eq(checklistItems.publicId, checklistItemPublicId),
      isNull(checklistItems.deletedAt),
    ),
    with: {
      checklist: {
        with: {
          card: {
            with: {
              list: {
                with: {
                  board: {
                    with: { workspace: true },
                  },
                },
              },
            },
          },
        },
      },
    },
  });

  return item;
};

export const updateItemById = async (
  db: dbClient,
  args: { id: number; title?: string; completed?: boolean },
) => {
  const [result] = await db
    .update(checklistItems)
    .set({
      ...(args.title !== undefined ? { title: args.title } : {}),
      ...(args.completed !== undefined ? { completed: args.completed } : {}),
      updatedAt: new Date(),
    })
    .where(eq(checklistItems.id, args.id))
    .returning({
      publicId: checklistItems.publicId,
      title: checklistItems.title,
      completed: checklistItems.completed,
    });

  return result;
};

export const softDeleteItemById = async (
  db: dbClient,
  args: { id: number; deletedAt: Date; deletedBy: string },
) => {
  const [result] = await db
    .update(checklistItems)
    .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
    .where(eq(checklistItems.id, args.id))
    .returning({ id: checklistItems.id });

  return result;
};

export const softDeleteAllItemsByChecklistId = async (
  db: dbClient,
  args: { checklistId: number; deletedAt: Date; deletedBy: string },
) => {
  const result = await db
    .update(checklistItems)
    .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
    .where(
      and(
        eq(checklistItems.checklistId, args.checklistId),
        isNull(checklistItems.deletedAt),
      ),
    )
    .returning({ id: checklistItems.id });

  return result;
};

export const softDeleteById = async (
  db: dbClient,
  args: { id: number; deletedAt: Date; deletedBy: string },
) => {
  const [result] = await db
    .update(checklists)
    .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
    .where(eq(checklists.id, args.id))
    .returning({ id: checklists.id });

  return result;
};

export const updateChecklistById = async (
  db: dbClient,
  args: { id: number; name: string },
) => {
  const [result] = await db
    .update(checklists)
    .set({ name: args.name, updatedAt: new Date() })
    .where(eq(checklists.id, args.id))
    .returning({ publicId: checklists.publicId, name: checklists.name });
  return result;
};

export const bulkCreate = async (
  db: dbClient,
  checklistInput: {
    cardId: number;
    name: string;
    createdBy: string;
    index: number;
  }[],
) => {
  if (checklistInput.length === 0) return [];

  return db.transaction(async (tx) => {
    const byCard = groupByKey(checklistInput, "cardId");

    const allValuesToInsert: {
      publicId: string;
      cardId: number;
      name: string;
      createdBy: string;
      index: number;
    }[] = [];

    for (const [cardId, items] of byCard.entries()) {
      const last = await tx.query.checklists.findFirst({
        columns: { index: true },
        where: and(eq(checklists.cardId, cardId), isNull(checklists.deletedAt)),
        orderBy: [desc(checklists.index)],
      });

      let nextIndex = last ? last.index + 1 : 0;

      const sorted = [...items].sort((a, b) => a.index - b.index);

      for (const item of sorted) {
        allValuesToInsert.push({
          publicId: generateUID(),
          ...item,
          index: nextIndex++,
        });
      }
    }

    const inserted = await tx
      .insert(checklists)
      .values(allValuesToInsert)
      .returning({ id: checklists.id, publicId: checklists.publicId });

    return inserted;
  });
};

export const bulkCreateItems = async (
  db: dbClient,
  checklistItemInput: {
    checklistId: number;
    title: string;
    createdBy: string;
    index: number;
    completed: boolean;
  }[],
) => {
  if (checklistItemInput.length === 0) return [];

  return db.transaction(async (tx) => {
    const byChecklist = groupByKey(checklistItemInput, "checklistId");

    const allValuesToInsert: {
      publicId: string;
      checklistId: number;
      title: string;
      createdBy: string;
      index: number;
      completed: boolean;
    }[] = [];

    for (const [checklistId, items] of byChecklist.entries()) {
      const last = await tx.query.checklistItems.findFirst({
        columns: { index: true },
        where: and(
          eq(checklistItems.checklistId, checklistId),
          isNull(checklistItems.deletedAt),
        ),
        orderBy: [desc(checklistItems.index)],
      });

      let nextIndex = last ? last.index + 1 : 0;

      const sorted = [...items].sort((a, b) => a.index - b.index);

      for (const item of sorted) {
        allValuesToInsert.push({
          publicId: generateUID(),
          ...item,
          index: nextIndex++,
        });
      }
    }

    const inserted = await tx
      .insert(checklistItems)
      .values(allValuesToInsert)
      .returning({
        id: checklistItems.id,
        publicId: checklistItems.publicId,
        title: checklistItems.title,
        completed: checklistItems.completed,
      });

    return inserted;
  });
};

const groupByKey = <T extends Record<string, unknown>>(
  items: T[],
  keyField: keyof T,
): Map<number, T[]> => {
  const grouped = new Map<number, T[]>();
  for (const item of items) {
    const key = item[keyField] as number;
    const arr = grouped.get(key) ?? [];
    arr.push(item);
    grouped.set(key, arr);
  }
  return grouped;
};

export const reorderItem = async (
  db: dbClient,
  args: {
    itemId: number;
    newIndex: number;
  },
) => {
  return db.transaction(async (tx) => {
    const item = await tx.query.checklistItems.findFirst({
      columns: {
        id: true,
        index: true,
        checklistId: true,
      },
      where: and(
        eq(checklistItems.id, args.itemId),
        isNull(checklistItems.deletedAt),
      ),
    });

    if (!item) {
      throw new Error(`Checklist item not found for ID ${args.itemId}`);
    }

    const currentIndex = item.index;
    const newIndex = args.newIndex;

    if (currentIndex === newIndex) {
      const unchanged = await tx.query.checklistItems.findFirst({
        columns: {
          publicId: true,
          title: true,
          completed: true,
        },
        where: and(
          eq(checklistItems.id, args.itemId),
          isNull(checklistItems.deletedAt),
        ),
      });

      if (!unchanged) {
        throw new Error(`Checklist item not found for ID ${args.itemId}`);
      }

      return unchanged;
    }

    if (currentIndex < newIndex) {
      await tx.execute(sql`
        UPDATE card_checklist_item
        SET index = index - 1
        WHERE "checklistId" = ${item.checklistId}
        AND index > ${currentIndex}
        AND index <= ${newIndex}
        AND "deletedAt" IS NULL
        `);
    } else {
      await tx.execute(sql`
        UPDATE card_checklist_item
        SET index = index + 1
        WHERE "checklistId" = ${item.checklistId}
        AND index >= ${newIndex}
        AND index < ${currentIndex}
        AND "deletedAt" IS NULL
        `);
    }

    const [updated] = await tx
      .update(checklistItems)
      .set({ index: newIndex })
      .where(eq(checklistItems.id, args.itemId))
      .returning({
        publicId: checklistItems.publicId,
        title: checklistItems.title,
        completed: checklistItems.completed,
      });

    if (!updated) {
      throw new Error(`Failed to update checklist item with ID ${args.itemId}`);
    }

    return updated;
  });
};



================================================
FILE: packages/db/src/repository/feedback.repo.ts
================================================
import type { dbClient } from "@kan/db/client";
import { feedback } from "@kan/db/schema";

export const create = async (
  db: dbClient,
  feedbackInput: {
    feedback: string;
    createdBy: string;
    url: string;
  },
) => {
  const [result] = await db
    .insert(feedback)
    .values({
      feedback: feedbackInput.feedback,
      createdBy: feedbackInput.createdBy,
      url: feedbackInput.url,
    })
    .returning({ id: feedback.id });

  return result;
};



================================================
FILE: packages/db/src/repository/import.repo.ts
================================================
import { count, eq } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { imports } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db.select({ count: count() }).from(imports);

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  importInput: { source: string; createdBy: string },
) => {
  const [result] = await db
    .insert(imports)
    .values({
      publicId: generateUID(),
      source: "trello",
      createdBy: importInput.createdBy,
      status: "started",
    })
    .returning({ id: imports.id });

  return result;
};

export const update = async (
  db: dbClient,
  importInput: { status: "started" | "success" | "failed" },
  args: { importId: number },
) => {
  const [result] = await db
    .update(imports)
    .set({ status: importInput.status })
    .where(eq(imports.id, args.importId))
    .returning({ id: imports.id, status: imports.status });

  return result;
};



================================================
FILE: packages/db/src/repository/integration.repo.ts
================================================
import { and, eq, gte } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { integrations } from "@kan/db/schema";

export const isProviderAvailableForUser = async (
  db: dbClient,
  userId: string,
  provider: string,
) => {
  const integration = await db.query.integrations.findFirst({
    where: and(
      eq(integrations.userId, userId),
      eq(integrations.provider, provider),
      gte(integrations.expiresAt, new Date()),
    ),
  });

  return !!integration;
};

export const getProviderForUser = async (
  db: dbClient,
  userId: string,
  provider: string,
) => {
  const integration = await db.query.integrations.findFirst({
    where: and(
      eq(integrations.userId, userId),
      eq(integrations.provider, provider),
      gte(integrations.expiresAt, new Date()),
    ),
  });

  return integration;
};

export const getProvidersForUser = async (db: dbClient, userId: string) => {
  const integration = await db.query.integrations.findMany({
    where: and(
      eq(integrations.userId, userId),
      gte(integrations.expiresAt, new Date()),
    ),
  });

  return integration;
};

export const deleteProviderForUser = async (
  db: dbClient,
  userId: string,
  provider: string,
) => {
  await db
    .delete(integrations)
    .where(
      and(eq(integrations.userId, userId), eq(integrations.provider, provider)),
    );
};



================================================
FILE: packages/db/src/repository/inviteLink.repo.ts
================================================
import { and, count, eq } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { workspaceInviteLinks } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getActiveCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(workspaceInviteLinks)
    .where(eq(workspaceInviteLinks.status, "active"));

  return result[0]?.count ?? 0;
};

export const createInviteLink = async (
  db: dbClient,
  args: {
    workspaceId: number;
    code: string;
    expiresAt: Date | null;
    createdBy: string;
  },
) => {
  const [result] = await db
    .insert(workspaceInviteLinks)
    .values({
      publicId: generateUID(),
      workspaceId: args.workspaceId,
      code: args.code,
      expiresAt: args.expiresAt ?? null,
      status: "active",
      createdBy: args.createdBy,
    })
    .returning({
      publicId: workspaceInviteLinks.publicId,
      code: workspaceInviteLinks.code,
      status: workspaceInviteLinks.status,
      expiresAt: workspaceInviteLinks.expiresAt,
    });
  return result;
};

export const deactivateAllActiveForWorkspace = async (
  db: dbClient,
  args: { workspaceId: number; updatedBy: string },
) => {
  await db
    .update(workspaceInviteLinks)
    .set({
      status: "inactive",
      updatedBy: args.updatedBy,
      updatedAt: new Date(),
    })
    .where(
      and(
        eq(workspaceInviteLinks.workspaceId, args.workspaceId),
        eq(workspaceInviteLinks.status, "active"),
      ),
    );
};

export const getActiveForWorkspace = async (
  db: dbClient,
  workspaceId: number,
) => {
  return db.query.workspaceInviteLinks.findFirst({
    where: and(
      eq(workspaceInviteLinks.workspaceId, workspaceId),
      eq(workspaceInviteLinks.status, "active"),
    ),
    orderBy: (links, { desc }) => [desc(links.createdAt)],
  });
};

export const getByCode = async (db: dbClient, code: string) => {
  return db.query.workspaceInviteLinks.findFirst({
    where: eq(workspaceInviteLinks.code, code),
  });
};



================================================
FILE: packages/db/src/repository/label.repo.ts
================================================
import { and, count, eq, inArray, isNull } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { cardsToLabels, labels } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(labels)
    .where(isNull(labels.deletedAt));

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  labelInput: {
    name: string;
    colourCode: string;
    createdBy: string;
    boardId: number;
    cardId?: number;
  },
) => {
  const [result] = await db
    .insert(labels)
    .values({
      publicId: generateUID(),
      name: labelInput.name,
      colourCode: labelInput.colourCode,
      createdBy: labelInput.createdBy,
      boardId: labelInput.boardId,
    })
    .returning({
      id: labels.id,
      publicId: labels.publicId,
      name: labels.name,
      colourCode: labels.colourCode,
    });

  if (labelInput.cardId && result) {
    await db.insert(cardsToLabels).values({
      cardId: labelInput.cardId,
      labelId: result.id,
    });
  }

  return result;
};

export const bulkCreate = async (
  db: dbClient,
  labelsInput: {
    publicId: string;
    name: string;
    colourCode: string;
    boardId: number;
    createdBy: string;
  }[],
) => {
  const results = await db
    .insert(labels)
    .values(labelsInput)
    .returning({ id: labels.id });

  return results;
};

export const getAllByPublicIds = (db: dbClient, labelPublicIds: string[]) => {
  return db.query.labels.findMany({
    columns: {
      id: true,
    },
    where: inArray(labels.publicId, labelPublicIds),
  });
};

export const getByPublicId = async (db: dbClient, labelPublicId: string) => {
  return db.query.labels.findFirst({
    columns: {
      id: true,
      publicId: true,
      name: true,
      colourCode: true,
    },
    where: eq(labels.publicId, labelPublicId),
  });
};

export const update = async (
  db: dbClient,
  labelInput: {
    labelPublicId: string;
    name: string;
    colourCode: string;
  },
) => {
  const [result] = await db
    .update(labels)
    .set({
      name: labelInput.name,
      colourCode: labelInput.colourCode,
    })
    .where(eq(labels.publicId, labelInput.labelPublicId))
    .returning({
      id: labels.id,
      publicId: labels.publicId,
      name: labels.name,
      colourCode: labels.colourCode,
    });

  return result;
};

export const softDelete = async (
  db: dbClient,
  args: {
    labelId: number;
    deletedAt: Date;
    deletedBy: string;
  },
) => {
  const [result] = await db
    .update(labels)
    .set({
      deletedAt: args.deletedAt,
      deletedBy: args.deletedBy,
    })
    .where(and(eq(labels.id, args.labelId), isNull(labels.deletedAt)))
    .returning({ id: labels.id });

  return result;
};

export const getWorkspaceAndLabelIdByLabelPublicId = async (
  db: dbClient,
  labelPublicId: string,
) => {
  const result = await db.query.labels.findFirst({
    columns: { id: true },
    where: eq(labels.publicId, labelPublicId),
    with: {
      board: {
        columns: { workspaceId: true },
      },
    },
  });

  return result
    ? {
        id: result.id,
        workspaceId: result.board.workspaceId,
      }
    : null;
};



================================================
FILE: packages/db/src/repository/list.repo.ts
================================================
import { and, count, desc, eq, gt, isNull, sql } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { lists } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(lists)
    .where(isNull(lists.deletedAt));

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  listInput: {
    name: string;
    createdBy: string;
    boardId: number;
    importId?: number;
  },
) => {
  return db.transaction(async (tx) => {
    const list = await tx.query.lists.findFirst({
      columns: {
        id: true,
        boardId: true,
        index: true,
      },
      where: and(eq(lists.boardId, listInput.boardId), isNull(lists.deletedAt)),
      orderBy: [desc(lists.index)],
    });

    const index = list ? list.index + 1 : 0;

    const [result] = await tx
      .insert(lists)
      .values({
        publicId: generateUID(),
        name: listInput.name,
        createdBy: listInput.createdBy,
        boardId: listInput.boardId,
        index,
        importId: listInput.importId,
      })
      .returning({
        id: lists.id,
        publicId: lists.publicId,
        boardId: lists.boardId,
        name: lists.name,
      });

    if (!result)
      throw new Error(`Failed to create list for board ${listInput.boardId}`);

    const countExpr = sql<number>`COUNT(*)`.mapWith(Number);

    const duplicateIndices = await tx
      .select({
        index: lists.index,
        count: countExpr,
      })
      .from(lists)
      .where(and(eq(lists.boardId, result.boardId), isNull(lists.deletedAt)))
      .groupBy(lists.index)
      .having(gt(countExpr, 1));

    if (duplicateIndices.length > 0) {
      // Compact indices to sequential values (0..n-1) to resolve duplicates while preserving order
      await tx.execute(sql`
        WITH ordered AS (
          SELECT id, ROW_NUMBER() OVER (ORDER BY "index", id) - 1 AS new_index
          FROM "list"
          WHERE "boardId" = ${result.boardId} AND "deletedAt" IS NULL
        )
        UPDATE "list" l
        SET "index" = o.new_index
        FROM ordered o
        WHERE l.id = o.id;
      `);

      // Last resort: verify fix; if duplicates persist (e.g., due to race conditions), rollback
      const postFixDupes = await tx
        .select({ index: lists.index, count: countExpr })
        .from(lists)
        .where(and(eq(lists.boardId, result.boardId), isNull(lists.deletedAt)))
        .groupBy(lists.index)
        .having(gt(countExpr, 1));

      if (postFixDupes.length > 0) {
        throw new Error(
          `Invariant violation: duplicate indices remain after compaction in board ${result.boardId}`,
        );
      }
    }

    return result;
  });
};

export const bulkCreate = async (
  db: dbClient,
  listInput: {
    publicId: string;
    name: string;
    createdBy: string;
    boardId: number;
    index: number;
    importId?: number;
  }[],
) => {
  if (listInput.length === 0) return [];

  return db.transaction(async (tx) => {
    // Group incoming rows by board to compute safe, sequential indices per board
    const byBoard = new Map<number, typeof listInput>();
    for (const item of listInput) {
      const arr = byBoard.get(item.boardId) ?? [];
      arr.push(item);
      byBoard.set(item.boardId, arr);
    }

    const allValuesToInsert: {
      publicId: string;
      name: string;
      createdBy: string;
      boardId: number;
      index: number;
      importId?: number;
    }[] = [];

    // For each board, append incoming lists after the current max index, preserving their relative order
    for (const [boardId, items] of byBoard.entries()) {
      // Find current max index for non-deleted lists in this board
      const last = await tx.query.lists.findFirst({
        columns: { index: true },
        where: and(eq(lists.boardId, boardId), isNull(lists.deletedAt)),
        orderBy: [desc(lists.index)],
      });

      let nextIndex = last ? last.index + 1 : 0;

      // Sort incoming by their provided index to preserve Trello order, then reassign sequential indices
      const sorted = [...items].sort((a, b) => a.index - b.index);
      for (const it of sorted) {
        allValuesToInsert.push({
          publicId: it.publicId,
          name: it.name,
          createdBy: it.createdBy,
          boardId: it.boardId,
          index: nextIndex++,
          importId: it.importId,
        });
      }
    }

    // Insert all rows in one go
    const inserted = await tx
      .insert(lists)
      .values(allValuesToInsert)
      .returning();

    // Post-insert check: if duplicates exist, compact indices per board instead of failing
    const countExpr = sql<number>`COUNT(*)`.mapWith(Number);
    for (const boardId of byBoard.keys()) {
      const duplicateIndices = await tx
        .select({ index: lists.index, count: countExpr })
        .from(lists)
        .where(and(eq(lists.boardId, boardId), isNull(lists.deletedAt)))
        .groupBy(lists.index)
        .having(gt(countExpr, 1));

      if (duplicateIndices.length > 0) {
        await tx.execute(sql`
          WITH ordered AS (
            SELECT id, ROW_NUMBER() OVER (ORDER BY "index", id) - 1 AS new_index
            FROM "list"
            WHERE "boardId" = ${boardId} AND "deletedAt" IS NULL
          )
          UPDATE "list" l
          SET "index" = o.new_index
          FROM ordered o
          WHERE l.id = o.id;
        `);

        // Last resort: verify fix; if duplicates persist (e.g., due to race conditions), rollback
        const postFixDupes = await tx
          .select({ index: lists.index, count: countExpr })
          .from(lists)
          .where(and(eq(lists.boardId, boardId), isNull(lists.deletedAt)))
          .groupBy(lists.index)
          .having(gt(countExpr, 1));

        if (postFixDupes.length > 0) {
          throw new Error(
            `Invariant violation: duplicate indices remain after compaction in board ${boardId}`,
          );
        }
      }
    }

    return inserted;
  });
};

export const getByPublicId = async (db: dbClient, listPublicId: string) => {
  return db.query.lists.findFirst({
    columns: {
      id: true,
      boardId: true,
      index: true,
    },
    where: eq(lists.publicId, listPublicId),
  });
};

export const getWithCardsByPublicId = async (
  db: dbClient,
  listPublicId: string,
) => {
  return db.query.lists.findFirst({
    columns: {
      id: true,
    },
    with: {
      cards: {
        columns: {
          index: true,
        },
        where: isNull(lists.deletedAt),
        orderBy: [desc(lists.index)],
      },
    },
    where: and(eq(lists.publicId, listPublicId), isNull(lists.deletedAt)),
  });
};

export const update = async (
  db: dbClient,
  listInput: {
    name: string;
  },
  args: {
    listPublicId: string;
  },
) => {
  const [result] = await db
    .update(lists)
    .set({ name: listInput.name })
    .where(and(eq(lists.publicId, args.listPublicId), isNull(lists.deletedAt)))
    .returning({
      publicId: lists.publicId,
      name: lists.name,
    });

  return result;
};

export const reorder = async (
  db: dbClient,
  args: {
    listPublicId: string;
    newIndex: number;
  },
) => {
  return db.transaction(async (tx) => {
    const list = await tx.query.lists.findFirst({
      columns: {
        id: true,
        boardId: true,
        index: true,
      },
      where: eq(lists.publicId, args.listPublicId),
    });

    if (!list)
      throw new Error(`List not found for public ID ${args.listPublicId}`);

    await tx.execute(sql`
      UPDATE list
      SET index =
        CASE
          WHEN index = ${list.index} AND id = ${list.id} THEN ${args.newIndex}
          WHEN ${list.index} < ${args.newIndex} AND index > ${list.index} AND index <= ${args.newIndex} THEN index - 1
          WHEN ${list.index} > ${args.newIndex} AND index >= ${args.newIndex} AND index < ${list.index} THEN index + 1
          ELSE index
        END
      WHERE "boardId" = ${list.boardId};
    `);

    const countExpr = sql<number>`COUNT(*)`.mapWith(Number);

    const duplicateIndices = await tx
      .select({
        index: lists.index,
        count: countExpr,
      })
      .from(lists)
      .where(and(eq(lists.boardId, list.boardId), isNull(lists.deletedAt)))
      .groupBy(lists.index)
      .having(gt(countExpr, 1));

    if (duplicateIndices.length > 0) {
      // Attempt to auto-heal by compacting indices to sequential values (0..n-1) while preserving order
      await tx.execute(sql`
        WITH ordered AS (
          SELECT id, ROW_NUMBER() OVER (ORDER BY "index", id) - 1 AS new_index
          FROM "list"
          WHERE "boardId" = ${list.boardId} AND "deletedAt" IS NULL
        )
        UPDATE "list" l
        SET "index" = o.new_index
        FROM ordered o
        WHERE l.id = o.id;
      `);

      // Last resort verification: if duplicates persist, rollback
      const postFixDupes = await tx
        .select({ index: lists.index, count: countExpr })
        .from(lists)
        .where(and(eq(lists.boardId, list.boardId), isNull(lists.deletedAt)))
        .groupBy(lists.index)
        .having(gt(countExpr, 1));

      if (postFixDupes.length > 0) {
        throw new Error(
          `Invariant violation: duplicate indices remain after compaction in board ${list.boardId}`,
        );
      }
    }

    const updatedList = await tx.query.lists.findFirst({
      columns: {
        publicId: true,
        name: true,
      },
      where: eq(lists.publicId, args.listPublicId),
    });

    return updatedList;
  });
};

export const softDeleteAllByBoardId = async (
  db: dbClient,
  args: {
    boardId: number;
    deletedAt: Date;
    deletedBy: string;
  },
) => {
  const result = await db
    .update(lists)
    .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
    .where(and(eq(lists.boardId, args.boardId), isNull(lists.deletedAt)))
    .returning({
      id: lists.id,
    });

  return result;
};

export const softDeleteById = async (
  db: dbClient,
  args: {
    listId: number;
    deletedAt: Date;
    deletedBy: string;
  },
) => {
  return db.transaction(async (tx) => {
    const [result] = await tx
      .update(lists)
      .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
      .where(and(eq(lists.id, args.listId), isNull(lists.deletedAt)))
      .returning({
        id: lists.id,
        index: lists.index,
        boardId: lists.boardId,
      });

    if (!result)
      throw new Error(`Unable to soft delete list ID ${args.listId}`);

    await tx.execute(sql`
      UPDATE list
      SET index = index - 1
      WHERE "boardId" = ${result.boardId} AND index > ${result.index} AND "deletedAt" IS NULL;
    `);

    const countExpr = sql<number>`COUNT(*)`.mapWith(Number);

    const duplicateIndices = await tx
      .select({
        index: lists.index,
        count: countExpr,
      })
      .from(lists)
      .where(and(eq(lists.boardId, result.boardId), isNull(lists.deletedAt)))
      .groupBy(lists.index)
      .having(gt(countExpr, 1));

    console.log(duplicateIndices);

    if (duplicateIndices.length > 0) {
      throw new Error(
        `Duplicate indices found after reordering in board ${result.boardId}`,
      );
    }

    return result;
  });
};

export const getWorkspaceAndListIdByListPublicId = async (
  db: dbClient,
  listPublicId: string,
) => {
  const result = await db.query.lists.findFirst({
    columns: { id: true, name: true, createdBy: true },
    where: and(eq(lists.publicId, listPublicId), isNull(lists.deletedAt)),
    with: {
      board: {
        columns: {
          publicId: true,
          workspaceId: true,
          name: true,
        },
      },
    },
  });

  return result
    ? {
        id: result.id,
        name: result.name,
        createdBy: result.createdBy,
        workspaceId: result.board.workspaceId,
        boardPublicId: result.board.publicId,
        boardName: result.board.name,
      }
    : null;
};



================================================
FILE: packages/db/src/repository/member.repo.ts
================================================
import { and, count, eq, isNull } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import type { MemberRole, MemberStatus } from "@kan/db/schema";
import { workspaceMembers } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const getActiveCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(workspaceMembers)
    .where(
      and(
        isNull(workspaceMembers.deletedAt),
        eq(workspaceMembers.status, "active"),
      ),
    );

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  memberInput: {
    userId: string | null;
    email: string;
    workspaceId: number;
    createdBy: string;
    role: MemberRole;
    roleId?: number | null;
    status: MemberStatus;
  },
) => {
  const [result] = await db
    .insert(workspaceMembers)
    .values({
      publicId: generateUID(),
      email: memberInput.email,
      userId: memberInput.userId,
      workspaceId: memberInput.workspaceId,
      createdBy: memberInput.createdBy,
      role: memberInput.role,
      roleId: memberInput.roleId ?? null,
      status: memberInput.status,
    })
    .returning({
      id: workspaceMembers.id,
      publicId: workspaceMembers.publicId,
    });

  return result;
};

export const getByPublicId = async (db: dbClient, publicId: string) => {
  return db.query.workspaceMembers.findFirst({
    where: eq(workspaceMembers.publicId, publicId),
  });
};

export const getById = async (db: dbClient, memberId: number) => {
  return db.query.workspaceMembers.findFirst({
    where: eq(workspaceMembers.id, memberId),
  });
};

export const getByPublicIdsWithUsers = async (
  db: dbClient,
  memberPublicIds: string[],
  workspaceId?: number,
) => {
  return db.query.workspaceMembers.findMany({
    where: (members, { inArray: inArrayFn, eq, and, isNull: isNullFn }) => {
      const conditions = [inArrayFn(members.publicId, memberPublicIds)];
      
      if (workspaceId) {
        conditions.push(eq(members.workspaceId, workspaceId));
      }
      
      conditions.push(eq(members.status, "active"));
      conditions.push(isNullFn(members.deletedAt));
      
      return and(...conditions);
    },
    with: {
      user: {
        columns: {
          id: true,
          name: true,
          email: true,
        },
      },
    },
  });
};

export const getByEmailAndStatus = async (
  db: dbClient,
  email: string,
  status: MemberStatus,
) => {
  return db.query.workspaceMembers.findFirst({
    where: and(
      eq(workspaceMembers.email, email),
      eq(workspaceMembers.status, status),
      isNull(workspaceMembers.deletedAt),
    ),
  });
};

export const acceptInvite = async (
  db: dbClient,
  args: { memberId: number; userId: string },
) => {
  const [result] = await db
    .update(workspaceMembers)
    .set({ status: "active", userId: args.userId })
    .where(eq(workspaceMembers.id, args.memberId))
    .returning({
      id: workspaceMembers.id,
      publicId: workspaceMembers.publicId,
    });

  return result;
};

export const softDelete = async (
  db: dbClient,
  args: {
    memberId: number;
    deletedAt: Date;
    deletedBy: string;
  },
) => {
  const [result] = await db
    .update(workspaceMembers)
    .set({ deletedAt: args.deletedAt, deletedBy: args.deletedBy })
    .where(
      and(
        eq(workspaceMembers.id, args.memberId),
        isNull(workspaceMembers.deletedAt),
      ),
    )
    .returning({
      id: workspaceMembers.id,
      publicId: workspaceMembers.publicId,
    });

  return result;
};

export const unpauseAllMembers = async (db: dbClient, workspaceId: number) => {
  await db
    .update(workspaceMembers)
    .set({ status: "active" })
    .where(
      and(
        eq(workspaceMembers.workspaceId, workspaceId),
        eq(workspaceMembers.status, "paused"),
      ),
    );
};

export const pauseAllMembers = async (db: dbClient, workspaceId: number) => {
  await db
    .update(workspaceMembers)
    .set({ status: "paused" })
    .where(
      and(
        eq(workspaceMembers.workspaceId, workspaceId),
        eq(workspaceMembers.status, "active"),
      ),
    );
};

export const updateRole = async (
  db: dbClient,
  args: {
    memberId: number;
    role: MemberRole;
    roleId: number | null;
  },
) => {
  const [result] = await db
    .update(workspaceMembers)
    .set({
      role: args.role,
      roleId: args.roleId,
      updatedAt: new Date(),
    })
    .where(eq(workspaceMembers.id, args.memberId))
    .returning({
      id: workspaceMembers.id,
      publicId: workspaceMembers.publicId,
      role: workspaceMembers.role,
    });

  return result;
};



================================================
FILE: packages/db/src/repository/notification.repo.ts
================================================
import { and, count, eq, isNull } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import type { NotificationType } from "@kan/db/schema";
import { notifications } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

export const create = async (
  db: dbClient,
  notificationInput: {
    type: NotificationType;
    userId: string;
    cardId?: number;
    commentId?: number;
    workspaceId?: number;
    metadata?: string;
  },
) => {
  const [result] = await db
    .insert(notifications)
    .values({
      publicId: generateUID(),
      type: notificationInput.type,
      userId: notificationInput.userId,
      cardId: notificationInput.cardId,
      commentId: notificationInput.commentId,
      workspaceId: notificationInput.workspaceId,
      metadata: notificationInput.metadata,
    })
    .returning();

  return result;
};

export const exists = async (
  db: dbClient,
  args: {
    userId: string;
    type: NotificationType;
    cardId?: number;
    workspaceId?: number;
    commentId?: number;
  },
) => {
  const result = await db.query.notifications.findFirst({
    where: (notifications, { eq, and, isNull: isNullFn }) => {
      const conditions = [
        eq(notifications.userId, args.userId),
        eq(notifications.type, args.type),
        isNullFn(notifications.deletedAt),
      ];

      if (args.cardId) {
        conditions.push(eq(notifications.cardId, args.cardId));
      }

      if (args.workspaceId) {
        conditions.push(eq(notifications.workspaceId, args.workspaceId));
      }

      return and(...conditions);
    },
  });

  return !!result;
};

export const markAsRead = async (
  db: dbClient,
  notificationId: number,
) => {
  const [result] = await db
    .update(notifications)
    .set({ readAt: new Date() })
    .where(eq(notifications.id, notificationId))
    .returning();

  return result;
};

export const getUnreadCount = async (
  db: dbClient,
  userId: string,
) => {
  const result = await db
    .select({ count: count() })
    .from(notifications)
    .where(
      and(
        eq(notifications.userId, userId),
        isNull(notifications.readAt),
        isNull(notifications.deletedAt),
      ),
    );

  return result[0]?.count ?? 0;
};




================================================
FILE: packages/db/src/repository/permission.repo.ts
================================================
import { and, eq, isNull, inArray } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import {
  workspaceMemberPermissions,
  workspaceMembers,
  workspaceRolePermissions,
  workspaceRoles,
} from "@kan/db/schema";
import type { Permission, Role } from "@kan/shared";
import { generateUID, getDefaultPermissions } from "@kan/shared";

/**
 * Get permissions by role ID
 */
export const getPermissionsByRoleId = async (
  db: dbClient,
  roleId: number,
): Promise<Permission[]> => {
  const permissions = await db
    .select({ permission: workspaceRolePermissions.permission })
    .from(workspaceRolePermissions)
    .where(
      and(
        eq(workspaceRolePermissions.workspaceRoleId, roleId),
        eq(workspaceRolePermissions.granted, true),
      ),
    );

  return permissions.map((p) => p.permission as Permission);
};

/**
 * Get role by workspace ID and name
 */
export const getRoleByWorkspaceIdAndName = async (
  db: dbClient,
  workspaceId: number,
  name: string,
) => {
  const [role] = await db
    .select()
    .from(workspaceRoles)
    .where(
      and(
        eq(workspaceRoles.workspaceId, workspaceId),
        eq(workspaceRoles.name, name),
      ),
    )
    .limit(1);

  return role;
};

/**
 * Get role by workspace ID and publicId
 */
export const getRoleByWorkspaceIdAndPublicId = async (
  db: dbClient,
  workspaceId: number,
  rolePublicId: string,
) => {
  const [role] = await db
    .select()
    .from(workspaceRoles)
    .where(
      and(
        eq(workspaceRoles.workspaceId, workspaceId),
        eq(workspaceRoles.publicId, rolePublicId),
      ),
    )
    .limit(1);

  return role;
};

/**
 * Get all custom permission overrides for a workspace member
 */
export const getMemberPermissionOverrides = async (
  db: dbClient,
  workspaceMemberId: number,
) => {
  return db
    .select()
    .from(workspaceMemberPermissions)
    .where(eq(workspaceMemberPermissions.workspaceMemberId, workspaceMemberId));
};

/**
 * Get a single permission override for a member
 */
export const getMemberPermissionOverride = async (
  db: dbClient,
  workspaceMemberId: number,
  permission: string,
) => {
  const [override] = await db
    .select()
    .from(workspaceMemberPermissions)
    .where(
      and(
        eq(workspaceMemberPermissions.workspaceMemberId, workspaceMemberId),
        eq(workspaceMemberPermissions.permission, permission),
      ),
    )
    .limit(1);

  return override;
};

/**
 * Get effective permissions for a workspace member
 * Combines role template (from DB) with custom overrides
 */
export const getMemberEffectivePermissions = async (
  db: dbClient,
  workspaceMemberId: number,
  roleId: number | null,
  roleName: string,
): Promise<Permission[]> => {
  let roleDefaults: Set<Permission>;

  // Try to get role permissions from database first
  if (roleId) {
    const dbPermissions = await getPermissionsByRoleId(db, roleId);
    roleDefaults = new Set<Permission>(dbPermissions);
  } else {
    // Fallback to code-based defaults if roleId not set
    const codeDefaults = getDefaultPermissions(roleName as Role);
    roleDefaults = new Set<Permission>([...codeDefaults]);
  }

  // Get custom overrides
  const overrides = await getMemberPermissionOverrides(db, workspaceMemberId);

  // Apply overrides
  for (const override of overrides) {
    if (override.granted) {
      roleDefaults.add(override.permission as Permission);
    } else {
      roleDefaults.delete(override.permission as Permission);
    }
  }

  return Array.from(roleDefaults);
};

/**
 * Check if a member has a specific permission
 */
export const memberHasPermission = async (
  db: dbClient,
  workspaceMemberId: number,
  roleId: number | null,
  roleName: string,
  permission: Permission,
): Promise<boolean> => {
  let hasRoleDefault: boolean;

  // Check role permission from database first
  if (roleId) {
    const dbPermissions = await getPermissionsByRoleId(db, roleId);
    hasRoleDefault = dbPermissions.includes(permission);
  } else {
    // Fallback to code-based defaults
    const codeDefaults = getDefaultPermissions(roleName as Role);
    hasRoleDefault = codeDefaults.includes(permission);
  }

  // Check for override
  const [override] = await db
    .select()
    .from(workspaceMemberPermissions)
    .where(
      and(
        eq(workspaceMemberPermissions.workspaceMemberId, workspaceMemberId),
        eq(workspaceMemberPermissions.permission, permission),
      ),
    )
    .limit(1);

  // Override takes precedence
  if (override) {
    return override.granted;
  }

  return hasRoleDefault;
};

/**
 * Grant a permission to a member
 */
export const grantPermission = async (
  db: dbClient,
  workspaceMemberId: number,
  permission: Permission,
) => {
  const [result] = await db
    .insert(workspaceMemberPermissions)
    .values({
      workspaceMemberId,
      permission,
      granted: true,
    })
    .onConflictDoUpdate({
      target: [
        workspaceMemberPermissions.workspaceMemberId,
        workspaceMemberPermissions.permission,
      ],
      set: {
        granted: true,
        updatedAt: new Date(),
      },
    })
    .returning();

  return result;
};

/**
 * Revoke a permission from a member
 */
export const revokePermission = async (
  db: dbClient,
  workspaceMemberId: number,
  permission: Permission,
) => {
  const [result] = await db
    .insert(workspaceMemberPermissions)
    .values({
      workspaceMemberId,
      permission,
      granted: false,
    })
    .onConflictDoUpdate({
      target: [
        workspaceMemberPermissions.workspaceMemberId,
        workspaceMemberPermissions.permission,
      ],
      set: {
        granted: false,
        updatedAt: new Date(),
      },
    })
    .returning();

  return result;
};

/**
 * Clear all permission overrides for a workspace member
 */
export const clearMemberPermissionOverrides = async (
  db: dbClient,
  workspaceMemberId: number,
) => {
  await db
    .delete(workspaceMemberPermissions)
    .where(eq(workspaceMemberPermissions.workspaceMemberId, workspaceMemberId));
};

/**
 * Clear all permission overrides for all members in a workspace
 */
export const clearAllMemberPermissionOverridesForWorkspace = async (
  db: dbClient,
  workspaceId: number,
) => {
  const memberIds = await db
    .select({ id: workspaceMembers.id })
    .from(workspaceMembers)
    .where(
      and(
        eq(workspaceMembers.workspaceId, workspaceId),
        isNull(workspaceMembers.deletedAt),
      ),
    );

  if (memberIds.length === 0) return;

  const ids = memberIds.map((m) => m.id);

  await db
    .delete(workspaceMemberPermissions)
    .where(inArray(workspaceMemberPermissions.workspaceMemberId, ids));
};

/**
 * Get member with their role by userId and workspaceId
 */
export const getMemberWithRole = async (
  db: dbClient,
  userId: string,
  workspaceId: number,
) => {
  const [member] = await db
    .select({
      id: workspaceMembers.id,
      publicId: workspaceMembers.publicId,
      role: workspaceMembers.role,
      roleId: workspaceMembers.roleId,
    })
    .from(workspaceMembers)
    .where(
      and(
        eq(workspaceMembers.userId, userId),
        eq(workspaceMembers.workspaceId, workspaceId),
        isNull(workspaceMembers.deletedAt),
      ),
    )
    .limit(1);

  return member;
};

/**
 * Check if user has permission in workspace
 */
export const userHasPermissionInWorkspace = async (
  db: dbClient,
  userId: string,
  workspaceId: number,
  permission: Permission,
): Promise<boolean> => {
  const member = await getMemberWithRole(db, userId, workspaceId);

  if (!member) {
    return false;
  }

  return memberHasPermission(
    db,
    member.id,
    member.roleId,
    member.role,
    permission,
  );
};

/**
 * Get all permissions for a user in a workspace
 */
export const getUserPermissionsInWorkspace = async (
  db: dbClient,
  userId: string,
  workspaceId: number,
): Promise<{
  permissions: Permission[];
  role: string;
  roleId: number | null;
} | null> => {
  const member = await getMemberWithRole(db, userId, workspaceId);

  if (!member) {
    return null;
  }

  const permissions = await getMemberEffectivePermissions(
    db,
    member.id,
    member.roleId,
    member.role,
  );

  return {
    permissions,
    role: member.role,
    roleId: member.roleId,
  };
};

/**
 * Create a role for a workspace
 */
export const createRole = async (
  db: dbClient,
  args: {
    workspaceId: number;
    name: string;
    description: string;
    hierarchyLevel: number;
    isSystem: boolean;
    permissions: Permission[];
  },
) => {
  const [role] = await db
    .insert(workspaceRoles)
    .values({
      publicId: generateUID(),
      workspaceId: args.workspaceId,
      name: args.name,
      description: args.description,
      hierarchyLevel: args.hierarchyLevel,
      isSystem: args.isSystem,
    })
    .returning({
      id: workspaceRoles.id,
      name: workspaceRoles.name,
      publicId: workspaceRoles.publicId,
    });

  if (role && args.permissions.length > 0) {
    await db.insert(workspaceRolePermissions).values(
      args.permissions.map((perm) => ({
        workspaceRoleId: role.id,
        permission: perm,
        granted: true,
      })),
    );
  }

  return role;
};

/**
 * Grant a permission to a role
 */
export const grantRolePermission = async (
  db: dbClient,
  roleId: number,
  permission: Permission,
) => {
  const [result] = await db
    .insert(workspaceRolePermissions)
    .values({
      workspaceRoleId: roleId,
      permission,
      granted: true,
    })
    .onConflictDoUpdate({
      target: [
        workspaceRolePermissions.workspaceRoleId,
        workspaceRolePermissions.permission,
      ],
      set: {
        granted: true,
      },
    })
    .returning();

  return result;
};

/**
 * Revoke a permission from a role
 */
export const revokeRolePermission = async (
  db: dbClient,
  roleId: number,
  permission: Permission,
) => {
  const [result] = await db
    .insert(workspaceRolePermissions)
    .values({
      workspaceRoleId: roleId,
      permission,
      granted: false,
    })
    .onConflictDoUpdate({
      target: [
        workspaceRolePermissions.workspaceRoleId,
        workspaceRolePermissions.permission,
      ],
      set: {
        granted: false,
      },
    })
    .returning();

  return result;
};

/**
 * Get all roles for a workspace
 */
export const getRolesByWorkspaceId = async (
  db: dbClient,
  workspaceId: number,
) => {
  return db
    .select({
      id: workspaceRoles.id,
      publicId: workspaceRoles.publicId,
      name: workspaceRoles.name,
      description: workspaceRoles.description,
      hierarchyLevel: workspaceRoles.hierarchyLevel,
      isSystem: workspaceRoles.isSystem,
    })
    .from(workspaceRoles)
    .where(eq(workspaceRoles.workspaceId, workspaceId));
};





================================================
FILE: packages/db/src/repository/subscription.repo.ts
================================================
import { eq } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { subscription } from "@kan/db/schema";

export const updateById = async (
  db: dbClient,
  subscriptionId: number,
  updates: {
    unlimitedSeats?: boolean;
    status?: string;
    seats?: number | null;
    periodStart?: Date | null;
    periodEnd?: Date | null;
    cancelAtPeriodEnd?: boolean | null;
  },
) => {
  const [result] = await db
    .update(subscription)
    .set({
      ...updates,
      updatedAt: new Date(),
    })
    .where(eq(subscription.id, subscriptionId))
    .returning({
      id: subscription.id,
      plan: subscription.plan,
      status: subscription.status,
      unlimitedSeats: subscription.unlimitedSeats,
    });

  return result;
};

export const updateByStripeSubscriptionId = async (
  db: dbClient,
  stripeSubscriptionId: string,
  updates: {
    unlimitedSeats?: boolean;
    status?: string;
    seats?: number | null;
    periodStart?: Date | null;
    periodEnd?: Date | null;
    cancelAtPeriodEnd?: boolean | null;
  },
) => {
  const [result] = await db
    .update(subscription)
    .set({
      ...updates,
      updatedAt: new Date(),
    })
    .where(eq(subscription.stripeSubscriptionId, stripeSubscriptionId))
    .returning({
      id: subscription.id,
      plan: subscription.plan,
      status: subscription.status,
      unlimitedSeats: subscription.unlimitedSeats,
    });

  return result;
};

export const getByStripeSubscriptionId = async (
  db: dbClient,
  stripeSubscriptionId: string,
) => {
  return await db.query.subscription.findFirst({
    where: eq(subscription.stripeSubscriptionId, stripeSubscriptionId),
  });
};

export const getByReferenceId = async (db: dbClient, referenceId: string) => {
  return await db.query.subscription.findMany({
    where: eq(subscription.referenceId, referenceId),
  });
};

export const create = async (
  db: dbClient,
  data: {
    plan: string;
    referenceId: string;
    userId: string;
    stripeCustomerId: string;
    status: string;
  },
) => {
  const [result] = await db.insert(subscription).values(data).returning();
  return result;
};



================================================
FILE: packages/db/src/repository/user.repo.ts
================================================
import { count, desc, eq } from "drizzle-orm";
import { v4 as uuidv4 } from "uuid";

import type { dbClient } from "@kan/db/client";
import { apikey, users } from "@kan/db/schema";

export const getCount = async (db: dbClient) => {
  const result = await db.select({ count: count() }).from(users);

  return result[0]?.count ?? 0;
};

export const getById = async (db: dbClient, userId: string) => {
  return await db.query.users.findFirst({
    columns: {
      id: true,
      name: true,
      email: true,
      image: true,
      stripeCustomerId: true,
    },
    with: {
      apiKeys: {
        columns: {
          id: true,
          prefix: true,
          key: true,
        },
        orderBy: desc(apikey.createdAt),
        limit: 1,
      },
    },
    where: eq(users.id, userId),
  });
};

export const getByStripeCustomerId = async (
  db: dbClient,
  stripeCustomerId: string,
) => {
  return await db.query.users.findFirst({
    where: eq(users.stripeCustomerId, stripeCustomerId),
  });
};

export const getByEmail = (db: dbClient, email: string) => {
  return db.query.users.findFirst({
    columns: {
      id: true,
      name: true,
      email: true,
    },
    where: eq(users.email, email),
  });
};

export const create = async (
  db: dbClient,
  user: { id?: string; email: string; stripeCustomerId?: string },
) => {
  const [result] = await db
    .insert(users)
    .values({
      id: user.id ?? uuidv4(),
      email: user.email,
      stripeCustomerId: user.stripeCustomerId,
      emailVerified: false,
    })
    .returning();

  return result;
};

export const update = async (
  db: dbClient,
  userId: string,
  updates: { image?: string; name?: string; stripeCustomerId?: string },
) => {
  const [result] = await db
    .update(users)
    .set({
      name: updates.name,
      image: updates.image,
      stripeCustomerId: updates.stripeCustomerId,
    })
    .where(eq(users.id, userId))
    .returning({
      name: users.name,
      image: users.image,
      stripeCustomerId: users.stripeCustomerId,
    });

  return result;
};



================================================
FILE: packages/db/src/repository/webhook.repo.ts
================================================
import { and, eq } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { workspaceWebhooks } from "@kan/db/schema";
import { generateUID } from "@kan/shared/utils";

import type { WebhookEvent } from "../schema/webhooks";

/** Parse JSON-encoded events column into typed array */
function parseEvents(raw: string): WebhookEvent[] {
  return JSON.parse(raw) as WebhookEvent[];
}

export const create = async (
  db: dbClient,
  webhookInput: {
    workspaceId: number;
    name: string;
    url: string;
    secret?: string;
    events: WebhookEvent[];
    createdBy: string;
  },
) => {
  const [webhook] = await db
    .insert(workspaceWebhooks)
    .values({
      publicId: generateUID(),
      workspaceId: webhookInput.workspaceId,
      name: webhookInput.name,
      url: webhookInput.url,
      secret: webhookInput.secret,
      events: JSON.stringify(webhookInput.events),
      createdBy: webhookInput.createdBy,
    })
    .returning({
      publicId: workspaceWebhooks.publicId,
      name: workspaceWebhooks.name,
      url: workspaceWebhooks.url,
      events: workspaceWebhooks.events,
      active: workspaceWebhooks.active,
      createdAt: workspaceWebhooks.createdAt,
    });

  return webhook
    ? {
        ...webhook,
        events: parseEvents(webhook.events),
      }
    : null;
};

export const update = async (
  db: dbClient,
  webhookPublicId: string,
  webhookInput: {
    name?: string;
    url?: string;
    secret?: string;
    events?: WebhookEvent[];
    active?: boolean;
  },
) => {
  const [result] = await db
    .update(workspaceWebhooks)
    .set({
      name: webhookInput.name,
      url: webhookInput.url,
      secret: webhookInput.secret,
      events: webhookInput.events
        ? JSON.stringify(webhookInput.events)
        : undefined,
      active: webhookInput.active,
      updatedAt: new Date(),
    })
    .where(eq(workspaceWebhooks.publicId, webhookPublicId))
    .returning({
      publicId: workspaceWebhooks.publicId,
      name: workspaceWebhooks.name,
      url: workspaceWebhooks.url,
      events: workspaceWebhooks.events,
      active: workspaceWebhooks.active,
      createdAt: workspaceWebhooks.createdAt,
      updatedAt: workspaceWebhooks.updatedAt,
    });

  return result
    ? {
        ...result,
        events: parseEvents(result.events),
      }
    : null;
};

export const getByPublicId = async (db: dbClient, webhookPublicId: string) => {
  const result = await db.query.workspaceWebhooks.findFirst({
    columns: {
      id: true,
      publicId: true,
      workspaceId: true,
      name: true,
      url: true,
      secret: true,
      events: true,
      active: true,
      createdAt: true,
      updatedAt: true,
    },
    where: eq(workspaceWebhooks.publicId, webhookPublicId),
  });

  return result
    ? {
        ...result,
        events: parseEvents(result.events),
      }
    : null;
};

export const getAllByWorkspaceId = async (
  db: dbClient,
  workspaceId: number,
) => {
  const results = await db.query.workspaceWebhooks.findMany({
    columns: {
      publicId: true,
      name: true,
      url: true,
      events: true,
      active: true,
      createdAt: true,
      updatedAt: true,
    },
    where: eq(workspaceWebhooks.workspaceId, workspaceId),
  });

  return results.map((webhook) => ({
    ...webhook,
    events: parseEvents(webhook.events),
  }));
};

/**
 * Returns active webhooks with secrets for server-side delivery (HMAC signing).
 * DO NOT expose this via tRPC or any client-facing endpoint.
 * Use getAllByWorkspaceId (which omits secrets) for the admin list endpoint.
 */
export const getActiveByWorkspaceId = async (
  db: dbClient,
  workspaceId: number,
) => {
  const results = await db.query.workspaceWebhooks.findMany({
    columns: {
      publicId: true,
      url: true,
      secret: true,
      events: true,
    },
    where: and(
      eq(workspaceWebhooks.workspaceId, workspaceId),
      eq(workspaceWebhooks.active, true),
    ),
  });

  return results.map((webhook) => ({
    ...webhook,
    events: parseEvents(webhook.events),
  }));
};

export const hardDelete = (db: dbClient, webhookPublicId: string) => {
  return db
    .delete(workspaceWebhooks)
    .where(eq(workspaceWebhooks.publicId, webhookPublicId));
};



================================================
FILE: packages/db/src/repository/workspace.repo.ts
================================================
import {
  and,
  count,
  desc,
  eq,
  ilike,
  inArray,
  isNull,
  asc,
  or,
  sql,
} from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import {
  boards,
  cards,
  lists,
  workspaceMembers,
  workspaces,
} from "@kan/db/schema";
import type { Permission, Role } from "@kan/shared";
import { generateUID, getDefaultPermissions } from "@kan/shared";

import * as permissionRepo from "./permission.repo";

// System role definitions
const SYSTEM_ROLES: {
  name: Role;
  description: string;
  hierarchyLevel: number;
}[] = [
  {
    name: "admin",
    description: "Full access to all workspace features",
    hierarchyLevel: 100,
  },
  {
    name: "member",
    description: "Standard member with create and edit permissions",
    hierarchyLevel: 50,
  },
  {
    name: "guest",
    description: "View-only access",
    hierarchyLevel: 10,
  },
];

export const getCount = async (db: dbClient) => {
  const result = await db
    .select({ count: count() })
    .from(workspaces)
    .where(isNull(workspaces.deletedAt));

  return result[0]?.count ?? 0;
};

export const create = async (
  db: dbClient,
  workspaceInput: {
    publicId?: string;
    name: string;
    slug: string;
    createdBy: string;
    createdByEmail: string;
  },
) => {
  const [workspace] = await db
    .insert(workspaces)
    .values({
      publicId: workspaceInput.publicId ?? generateUID(),
      name: workspaceInput.name,
      slug: workspaceInput.slug,
      createdBy: workspaceInput.createdBy,
    })
    .returning({
      id: workspaces.id,
      publicId: workspaces.publicId,
      name: workspaces.name,
      slug: workspaces.slug,
      description: workspaces.description,
      plan: workspaces.plan,
    });

  if (workspace) {
    // Create system roles for the workspace
    let adminRoleId: number | null = null;
    for (const roleData of SYSTEM_ROLES) {
      const role = await permissionRepo.createRole(db, {
        workspaceId: workspace.id,
        name: roleData.name,
        description: roleData.description,
        hierarchyLevel: roleData.hierarchyLevel,
        isSystem: true,
        permissions: [...getDefaultPermissions(roleData.name)] as Permission[],
      });
      if (roleData.name === "admin" && role) {
        adminRoleId = role.id;
      }
    }

    await db.insert(workspaceMembers).values({
      publicId: generateUID(),
      userId: workspaceInput.createdBy,
      email: workspaceInput.createdByEmail,
      workspaceId: workspace.id,
      createdBy: workspaceInput.createdBy,
      role: "admin",
      roleId: adminRoleId,
      status: "active",
    });
  }

  const newWorkspace = { ...workspace };
  delete newWorkspace.id;

  return newWorkspace;
};

export const update = async (
  db: dbClient,
  workspacePublicId: string,
  workspaceInput: {
    name?: string;
    slug?: string;
    plan?: "free" | "pro" | "enterprise";
    description?: string;
    showEmailsToMembers?: boolean;
  },
) => {
  const [result] = await db
    .update(workspaces)
    .set({
      name: workspaceInput.name,
      slug: workspaceInput.slug,
      plan: workspaceInput.plan,
      description: workspaceInput.description,
      showEmailsToMembers: workspaceInput.showEmailsToMembers,
    })
    .where(eq(workspaces.publicId, workspacePublicId))
    .returning({
      id: workspaces.id,
      publicId: workspaces.publicId,
      name: workspaces.name,
      slug: workspaces.slug,
      description: workspaces.description,
      plan: workspaces.plan,
      showEmailsToMembers: workspaces.showEmailsToMembers,
    });

  return result;
};

export const getByPublicId = (db: dbClient, workspacePublicId: string) => {
  return db.query.workspaces.findFirst({
    columns: {
      id: true,
      publicId: true,
      name: true,
      plan: true,
      slug: true,
    },
    where: eq(workspaces.publicId, workspacePublicId),
  });
};

export const getById = (db: dbClient, workspaceId: number) => {
  return db.query.workspaces.findFirst({
    columns: {
      id: true,
      publicId: true,
      name: true,
      plan: true,
      slug: true,
    },
    where: eq(workspaces.id, workspaceId),
  });
};

export const getByPublicIdWithMembers = (
  db: dbClient,
  workspacePublicId: string,
) => {
  return db.query.workspaces.findFirst({
    columns: {
      id: true,
      publicId: true,
      name: true,
      slug: true,
      showEmailsToMembers: true,
    },
    with: {
      members: {
        columns: {
          publicId: true,
          email: true,
          role: true,
          status: true,
          createdAt: true,
        },
        where: isNull(workspaceMembers.deletedAt),
        orderBy: (member, { desc }) => [
          desc(sql`CASE WHEN ${member.role} = 'admin' THEN 1 ELSE 0 END`),
          desc(member.createdAt),
        ],
        with: {
          user: {
            columns: {
              id: true,
              name: true,
              email: true,
              image: true,
            },
          },
        },
      },
      subscriptions: {
        columns: {
          id: true,
          plan: true,
          status: true,
          seats: true,
          unlimitedSeats: true,
          periodStart: true,
          periodEnd: true,
        },
      },
    },
    where: and(
      eq(workspaces.publicId, workspacePublicId),
      isNull(workspaces.deletedAt),
    ),
  });
};

export const getBySlugWithBoards = (db: dbClient, workspaceSlug: string) => {
  return db.query.workspaces.findFirst({
    columns: {
      id: true,
      publicId: true,
      name: true,
      description: true,
      slug: true,
    },
    with: {
      boards: {
        columns: {
          publicId: true,
          slug: true,
          name: true,
        },
        where: and(isNull(boards.deletedAt), eq(boards.visibility, "public")),
        orderBy: [asc(boards.name)]
      },
    },
    where: and(
      eq(workspaces.slug, workspaceSlug),
      isNull(workspaces.deletedAt),
    ),
  });
};

export const getAllByUserId = async (db: dbClient, userId: string) => {
  const result = await db.query.workspaceMembers.findMany({
    columns: {
      role: true,
    },
    with: {
      workspace: {
        columns: {
          publicId: true,
          name: true,
          description: true,
          slug: true,
          plan: true,
          deletedAt: true,
        },
        // https://github.com/drizzle-team/drizzle-orm/issues/2903
        // where: isNull(workspaces.deletedAt),
      },
    },
    where: and(
      eq(workspaceMembers.userId, userId),
      eq(workspaceMembers.status, "active"),
      isNull(workspaceMembers.deletedAt),
    ),
  });

  return result.filter((member) => !member.workspace.deletedAt);
};

export const getMemberByPublicId = (db: dbClient, memberPublicId: string) => {
  return db.query.workspaceMembers.findFirst({
    columns: {
      id: true,
    },
    where: eq(workspaceMembers.publicId, memberPublicId),
  });
};

export const getAllMembersByPublicIds = (
  db: dbClient,
  memberPublicIds: string[],
) => {
  return db.query.workspaceMembers.findMany({
    columns: {
      id: true,
    },
    where: inArray(workspaceMembers.publicId, memberPublicIds),
  });
};

export const hardDelete = (db: dbClient, workspacePublicId: string) => {
  return db
    .delete(workspaces)
    .where(eq(workspaces.publicId, workspacePublicId));
};

export const isWorkspaceSlugAvailable = async (
  db: dbClient,
  workspaceSlug: string,
) => {
  const result = await db.query.workspaces.findFirst({
    columns: {
      id: true,
    },
    where: and(
      eq(workspaces.slug, workspaceSlug),
      isNull(workspaces.deletedAt),
    ),
  });

  return result === undefined;
};

export const isUserInWorkspace = async (
  db: dbClient,
  userId: string,
  workspaceId: number,
  role?: "admin" | "member",
) => {
  const result = await db.query.workspaceMembers.findFirst({
    columns: {
      id: true,
    },
    where: and(
      eq(workspaceMembers.userId, userId),
      eq(workspaceMembers.workspaceId, workspaceId),
      eq(workspaceMembers.status, "active"),
      isNull(workspaceMembers.deletedAt),
      role ? eq(workspaceMembers.role, role) : undefined,
    ),
  });

  return result?.id !== undefined;
};

export const searchBoardsAndCards = async (
  db: dbClient,
  workspaceId: number,
  query: string,
  limit = 20,
) => {
  const searchQuery = `%${query}%`;

  // Search for boards
  const boardResults = await db
    .select({
      publicId: boards.publicId,
      title: boards.name,
      description: boards.description,
      slug: boards.slug,
      updatedAt: boards.updatedAt,
      createdAt: boards.createdAt,
    })
    .from(boards)
    .where(
      and(
        eq(boards.workspaceId, workspaceId),
        // Combine exact and fuzzy matching
        or(
          ilike(boards.name, `%${query}%`), // Exact substring match
          sql`similarity(${boards.name}, ${query}) > 0.2`, // Fuzzy match
        ),
        isNull(boards.deletedAt),
      ),
    )
    .orderBy(
      sql`CASE WHEN ${boards.name} ILIKE ${`%${query}%`} THEN 1 ELSE 0 END DESC`,
      sql`similarity(${boards.name}, ${query}) DESC`,
      desc(boards.updatedAt),
    )
    .limit(Math.ceil(limit * 0.4));

  // Search for cards
  const cardResults = await db
    .select({
      publicId: cards.publicId,
      title: cards.title,
      description: cards.description,
      boardPublicId: boards.publicId,
      boardName: boards.name,
      listName: lists.name,
      updatedAt: cards.updatedAt,
      createdAt: cards.createdAt,
    })
    .from(cards)
    .innerJoin(lists, eq(cards.listId, lists.id))
    .innerJoin(boards, eq(lists.boardId, boards.id))
    .where(
      and(
        eq(boards.workspaceId, workspaceId),
        or(
          ilike(cards.title, searchQuery),
          sql`similarity(${cards.title}, ${query}) > 0.2`,
        ),
        isNull(cards.deletedAt),
        isNull(lists.deletedAt),
        isNull(boards.deletedAt),
      ),
    )
    .orderBy(
      sql`CASE WHEN ${cards.title} ILIKE ${searchQuery} THEN 1 ELSE 0 END DESC`,
      sql`similarity(${cards.title}, ${query}) DESC`,
      desc(cards.updatedAt),
    )
    .limit(Math.floor(limit * 0.6));

  // Combine results
  const allResults = [
    ...boardResults.map((board) => ({ ...board, type: "board" as const })),
    ...cardResults.map((card) => ({ ...card, type: "card" as const })),
  ];

  // Ensure we don't exceed the total limit
  return allResults.slice(0, limit);
};



================================================
FILE: packages/db/src/repository/workspaceSlug.repo.ts
================================================
import { eq } from "drizzle-orm";

import type { dbClient } from "@kan/db/client";
import { slugChecks, slugs } from "@kan/db/schema";

export const getWorkspaceSlug = (db: dbClient, slug: string) => {
  return db.query.slugs.findFirst({
    columns: {
      slug: true,
      type: true,
    },
    where: eq(slugs.slug, slug),
  });
};

export const createWorkspaceSlugCheck = (
  db: dbClient,
  input: {
    slug: string;
    userId: string;
    available: boolean;
    reserved: boolean;
  },
) => {
  return db.insert(slugChecks).values({
    slug: input.slug,
    available: input.available,
    reserved: input.reserved,
    createdBy: input.userId,
  });
};



================================================
FILE: packages/db/src/schema/auth.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigserial,
  boolean,
  integer,
  pgTable,
  text,
  timestamp,
  uuid,
} from "drizzle-orm/pg-core";

import { users } from "./users";

export const session = pgTable("session", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  expiresAt: timestamp("expiresAt").notNull(),
  token: text("token").notNull().unique(),
  createdAt: timestamp("createdAt").notNull(),
  updatedAt: timestamp("updatedAt").notNull(),
  ipAddress: text("ipAddress"),
  userAgent: text("userAgent"),
  userId: uuid("userId")
    .notNull()
    .references(() => users.id, { onDelete: "cascade" }),
}).enableRLS();

export const account = pgTable("account", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  accountId: text("accountId").notNull(),
  providerId: text("providerId").notNull(),
  userId: uuid("userId")
    .notNull()
    .references(() => users.id, { onDelete: "cascade" }),
  accessToken: text("accessToken"),
  refreshToken: text("refreshToken"),
  idToken: text("idToken"),
  accessTokenExpiresAt: timestamp("accessTokenExpiresAt"),
  refreshTokenExpiresAt: timestamp("refreshTokenExpiresAt"),
  scope: text("scope"),
  password: text("password"),
  createdAt: timestamp("createdAt").notNull(),
  updatedAt: timestamp("updatedAt").notNull(),
}).enableRLS();

export const verification = pgTable("verification", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  identifier: text("identifier").notNull(),
  value: text("value").notNull(),
  expiresAt: timestamp("expiresAt").notNull(),
  createdAt: timestamp("createdAt"),
  updatedAt: timestamp("updatedAt"),
}).enableRLS();

export const apikey = pgTable("apiKey", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  name: text("name"),
  start: text("start"),
  prefix: text("prefix"),
  key: text("key").notNull(),
  userId: uuid("userId")
    .notNull()
    .references(() => users.id, { onDelete: "cascade" }),
  refillInterval: integer("refillInterval"),
  refillAmount: integer("refillAmount"),
  lastRefillAt: timestamp("lastRefillAt"),
  enabled: boolean("enabled"),
  rateLimitEnabled: boolean("rateLimitEnabled"),
  rateLimitTimeWindow: integer("rateLimitTimeWindow"),
  rateLimitMax: integer("rateLimitMax"),
  requestCount: integer("requestCount"),
  remaining: integer("remaining"),
  lastRequest: timestamp("lastRequest"),
  expiresAt: timestamp("expiresAt"),
  createdAt: timestamp("createdAt").notNull(),
  updatedAt: timestamp("updatedAt").notNull(),
  permissions: text("permissions"),
  metadata: text("metadata"),
}).enableRLS();

export const apiKeyRelations = relations(apikey, ({ one }) => ({
  user: one(users, {
    fields: [apikey.userId],
    references: [users.id],
    relationName: "apiKeyUser",
  }),
}));



================================================
FILE: packages/db/src/schema/boards.ts
================================================
import { relations, sql } from "drizzle-orm";
import {
  bigint,
  bigserial,
  boolean,
  index,
  pgEnum,
  pgTable,
  primaryKey,
  text,
  timestamp,
  uniqueIndex,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { imports } from "./imports";
import { labels } from "./labels";
import { lists } from "./lists";
import { users } from "./users";
import { workspaces } from "./workspaces";

export const boardVisibilityStatuses = ["private", "public"] as const;
export type BoardVisibilityStatus = (typeof boardVisibilityStatuses)[number];
export const boardVisibilityEnum = pgEnum(
  "board_visibility",
  boardVisibilityStatuses,
);

export const boardTypes = ["regular", "template"] as const;
export type BoardType = (typeof boardTypes)[number];
export const boardTypeEnum = pgEnum("board_type", boardTypes);

export const boards = pgTable(
  "board",
  {
    id: bigserial("id", { mode: "number" }).primaryKey(),
    publicId: varchar("publicId", { length: 12 }).notNull().unique(),
    name: varchar("name", { length: 255 }).notNull(),
    description: text("description"),
    slug: varchar("slug", { length: 255 }).notNull(),
    createdBy: uuid("createdBy").references(() => users.id, {
      onDelete: "set null",
    }),
    createdAt: timestamp("createdAt").defaultNow().notNull(),
    updatedAt: timestamp("updatedAt"),
    deletedAt: timestamp("deletedAt"),
    deletedBy: uuid("deletedBy").references(() => users.id, {
      onDelete: "set null",
    }),
    importId: bigint("importId", { mode: "number" }).references(
      () => imports.id,
    ),
    workspaceId: bigint("workspaceId", { mode: "number" })
      .notNull()
      .references(() => workspaces.id, { onDelete: "cascade" }),
    visibility: boardVisibilityEnum("visibility").notNull().default("private"),
    type: boardTypeEnum("type").notNull().default("regular"),
    sourceBoardId: bigint("sourceBoardId", { mode: "number" }),
  },
  (table) => [
    index("board_visibility_idx").on(table.visibility),
    index("board_type_idx").on(table.type),
    index("board_source_idx").on(table.sourceBoardId),
    uniqueIndex("unique_slug_per_workspace")
      .on(table.workspaceId, table.slug)
      .where(sql`${table.deletedAt} IS NULL`),
  ],
).enableRLS();

export const boardsRelations = relations(boards, ({ one, many }) => ({
  userFavorites: many(userBoardFavorites),
  createdBy: one(users, {
    fields: [boards.createdBy],
    references: [users.id],
    relationName: "boardCreatedByUser",
  }),
  lists: many(lists),
  allLists: many(lists),
  labels: many(labels),
  deletedBy: one(users, {
    fields: [boards.deletedBy],
    references: [users.id],
    relationName: "boardDeletedByUser",
  }),
  import: one(imports, {
    fields: [boards.importId],
    references: [imports.id],
    relationName: "boardImport",
  }),
  workspace: one(workspaces, {
    fields: [boards.workspaceId],
    references: [workspaces.id],
    relationName: "boardWorkspace",
  }),
}));

export const userBoardFavorites = pgTable(
  "user_board_favorites",
  {
    userId: uuid("userId")
      .notNull()
      .references(() => users.id, { onDelete: "cascade" }),
    boardId: bigint("boardId", { mode: "number" })
      .notNull()
      .references(() => boards.id, { onDelete: "cascade" }),
    createdAt: timestamp("createdAt").defaultNow().notNull(),
  },
  (table) => ({
    pk: primaryKey({ columns: [table.userId, table.boardId] }),
    userIdx: index("user_board_favorite_user_idx").on(table.userId),
    boardIdx: index("user_board_favorite_board_idx").on(table.boardId),
  }),
);


================================================
FILE: packages/db/src/schema/cards.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigint,
  bigserial,
  integer,
  pgEnum,
  pgTable,
  primaryKey,
  text,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { boards } from "./boards";
import { checklists } from "./checklists";
import { imports } from "./imports";
import { labels } from "./labels";
import { lists } from "./lists";
import { users } from "./users";
import { workspaceMembers } from "./workspaces";

export const activityTypes = [
  "card.created",
  "card.updated.title",
  "card.updated.description",
  "card.updated.index",
  "card.updated.list",
  "card.updated.label.added",
  "card.updated.label.removed",
  "card.updated.member.added",
  "card.updated.member.removed",
  "card.updated.comment.added",
  "card.updated.comment.updated",
  "card.updated.comment.deleted",
  // Checklist activities
  "card.updated.checklist.added",
  "card.updated.checklist.renamed",
  "card.updated.checklist.deleted",
  "card.updated.checklist.item.added",
  "card.updated.checklist.item.updated",
  "card.updated.checklist.item.completed",
  "card.updated.checklist.item.uncompleted",
  "card.updated.checklist.item.deleted",
  "card.updated.attachment.added",
  "card.updated.attachment.removed",
  "card.updated.dueDate.added",
  "card.updated.dueDate.updated",
  "card.updated.dueDate.removed",
  "card.archived",
] as const;

export type ActivityType = (typeof activityTypes)[number];

export const activityTypeEnum = pgEnum("card_activity_type", activityTypes);

export const cards = pgTable("card", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  title: text("title").notNull(),
  description: text("description"),
  index: integer("index").notNull(),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  deletedAt: timestamp("deletedAt"),
  deletedBy: uuid("deletedBy").references(() => users.id, {
    onDelete: "set null",
  }),
  listId: bigint("listId", { mode: "number" })
    .notNull()
    .references(() => lists.id, { onDelete: "cascade" }),
  importId: bigint("importId", { mode: "number" }).references(() => imports.id),
  dueDate: timestamp("dueDate"),
}).enableRLS();

export const cardsRelations = relations(cards, ({ one, many }) => ({
  createdBy: one(users, {
    fields: [cards.createdBy],
    references: [users.id],
    relationName: "cardsCreatedByUser",
  }),
  list: one(lists, {
    fields: [cards.listId],
    references: [lists.id],
    relationName: "cardsList",
  }),
  deletedBy: one(users, {
    fields: [cards.deletedBy],
    references: [users.id],
    relationName: "cardsDeletedByUser",
  }),
  labels: many(cardsToLabels),
  members: many(cardToWorkspaceMembers),
  import: one(imports, {
    fields: [cards.importId],
    references: [imports.id],
    relationName: "cardsImport",
  }),
  comments: many(comments),
  activities: many(cardActivities),
  checklists: many(checklists),
  attachments: many(cardAttachments),
}));

export const cardActivities = pgTable("card_activity", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  type: activityTypeEnum("type").notNull(),
  cardId: bigint("cardId", { mode: "number" })
    .notNull()
    .references(() => cards.id, { onDelete: "cascade" }),
  fromIndex: integer("fromIndex"),
  toIndex: integer("toIndex"),
  fromListId: bigint("fromListId", { mode: "number" }).references(
    () => lists.id,
    { onDelete: "cascade" },
  ),
  toListId: bigint("toListId", { mode: "number" }).references(() => lists.id, {
    onDelete: "cascade",
  }),
  labelId: bigint("labelId", { mode: "number" }).references(() => labels.id, {
    onDelete: "cascade",
  }),
  workspaceMemberId: bigint("workspaceMemberId", {
    mode: "number",
  }).references(() => workspaceMembers.id, { onDelete: "set null" }),
  fromTitle: text("fromTitle"),
  toTitle: text("toTitle"),
  fromDescription: text("fromDescription"),
  toDescription: text("toDescription"),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  commentId: bigint("commentId", { mode: "number" }).references(
    () => comments.id,
    { onDelete: "cascade" },
  ),
  fromComment: text("fromComment"),
  toComment: text("toComment"),
  fromDueDate: timestamp("fromDueDate"),
  toDueDate: timestamp("toDueDate"),
  sourceBoardId: bigint("sourceBoardId", { mode: "number" }).references(
    () => boards.id,
    { onDelete: "set null" },
  ),
  attachmentId: bigint("attachmentId", { mode: "number" }).references(
    () => cardAttachments.id,
    { onDelete: "cascade" },
  ),
}).enableRLS();

export const cardActivitiesRelations = relations(cardActivities, ({ one }) => ({
  card: one(cards, {
    fields: [cardActivities.cardId],
    references: [cards.id],
    relationName: "cardActivitiesCard",
  }),
  fromList: one(lists, {
    fields: [cardActivities.fromListId],
    references: [lists.id],
    relationName: "cardActivitiesFromList",
  }),
  toList: one(lists, {
    fields: [cardActivities.toListId],
    references: [lists.id],
    relationName: "cardActivitiesToList",
  }),
  label: one(labels, {
    fields: [cardActivities.labelId],
    references: [labels.id],
    relationName: "cardActivitiesLabel",
  }),
  workspaceMember: one(workspaceMembers, {
    fields: [cardActivities.workspaceMemberId],
    references: [workspaceMembers.id],
    relationName: "cardActivitiesWorkspaceMember",
  }),
  user: one(users, {
    fields: [cardActivities.createdBy],
    references: [users.id],
    relationName: "cardActivitiesUser",
  }),
  member: one(workspaceMembers, {
    fields: [cardActivities.workspaceMemberId],
    references: [workspaceMembers.id],
    relationName: "cardActivitiesMember",
  }),
  comment: one(comments, {
    fields: [cardActivities.commentId],
    references: [comments.id],
    relationName: "cardActivitiesComment",
  }),
  attachment: one(cardAttachments, {
    fields: [cardActivities.attachmentId],
    references: [cardAttachments.id],
    relationName: "cardActivitiesAttachment",
  }),
}));

export const cardsToLabels = pgTable(
  "_card_labels",
  {
    cardId: bigint("cardId", { mode: "number" })
      .notNull()
      .references(() => cards.id, { onDelete: "cascade" }),
    labelId: bigint("labelId", { mode: "number" })
      .notNull()
      .references(() => labels.id, { onDelete: "cascade" }),
  },
  (t) => [primaryKey({ columns: [t.cardId, t.labelId] })],
).enableRLS();

export const cardToLabelsRelations = relations(cardsToLabels, ({ one }) => ({
  card: one(cards, {
    fields: [cardsToLabels.cardId],
    references: [cards.id],
    relationName: "cardToLabelsCard",
  }),
  label: one(labels, {
    fields: [cardsToLabels.labelId],
    references: [labels.id],
    relationName: "cardToLabelsLabel",
  }),
}));

export const cardToWorkspaceMembers = pgTable(
  "_card_workspace_members",
  {
    cardId: bigint("cardId", { mode: "number" })
      .notNull()
      .references(() => cards.id, { onDelete: "cascade" }),
    workspaceMemberId: bigint("workspaceMemberId", { mode: "number" })
      .notNull()
      .references(() => workspaceMembers.id, { onDelete: "cascade" }),
  },
  (t) => [primaryKey({ columns: [t.cardId, t.workspaceMemberId] })],
).enableRLS();

export const cardToWorkspaceMembersRelations = relations(
  cardToWorkspaceMembers,
  ({ one }) => ({
    card: one(cards, {
      fields: [cardToWorkspaceMembers.cardId],
      references: [cards.id],
      relationName: "cardToWorkspaceMembersCard",
    }),
    member: one(workspaceMembers, {
      fields: [cardToWorkspaceMembers.workspaceMemberId],
      references: [workspaceMembers.id],
      relationName: "cardToWorkspaceMembersMember",
    }),
  }),
);

export const comments = pgTable("card_comments", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  comment: text("comment").notNull(),
  cardId: bigint("cardId", { mode: "number" })
    .notNull()
    .references(() => cards.id, { onDelete: "cascade" }),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  deletedAt: timestamp("deletedAt"),
  deletedBy: uuid("deletedBy").references(() => users.id, {
    onDelete: "set null",
  }),
}).enableRLS();

export const commentsRelations = relations(comments, ({ one }) => ({
  card: one(cards, {
    fields: [comments.cardId],
    references: [cards.id],
    relationName: "commentsCard",
  }),
  createdBy: one(users, {
    fields: [comments.createdBy],
    references: [users.id],
    relationName: "commentsCreatedByUser",
  }),
  deletedBy: one(users, {
    fields: [comments.deletedBy],
    references: [users.id],
    relationName: "commentsDeletedByUser",
  }),
}));

export const cardAttachments = pgTable("card_attachment", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  cardId: bigint("cardId", { mode: "number" })
    .notNull()
    .references(() => cards.id, { onDelete: "cascade" }),
  filename: varchar("filename", { length: 255 }).notNull(),
  originalFilename: varchar("originalFilename", { length: 255 }).notNull(),
  contentType: varchar("contentType", { length: 100 }).notNull(),
  size: bigint("size", { mode: "number" }).notNull(),
  s3Key: varchar("s3Key", { length: 500 }).notNull(),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  deletedAt: timestamp("deletedAt"),
}).enableRLS();

export const cardAttachmentsRelations = relations(
  cardAttachments,
  ({ one }) => ({
    card: one(cards, {
      fields: [cardAttachments.cardId],
      references: [cards.id],
      relationName: "cardAttachmentsCard",
    }),
    createdBy: one(users, {
      fields: [cardAttachments.createdBy],
      references: [users.id],
      relationName: "cardAttachmentsCreatedByUser",
    }),
  }),
);



================================================
FILE: packages/db/src/schema/checklists.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigint,
  bigserial,
  boolean,
  integer,
  pgTable,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { cards } from "./cards";
import { users } from "./users";

export const checklists = pgTable("card_checklist", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  name: varchar("name", { length: 255 }).notNull(),
  index: integer("index").notNull(),
  cardId: bigint("cardId", { mode: "number" })
    .notNull()
    .references(() => cards.id, { onDelete: "cascade" }),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  deletedAt: timestamp("deletedAt"),
  deletedBy: uuid("deletedBy").references(() => users.id, {
    onDelete: "set null",
  }),
}).enableRLS();

export const checklistsRelations = relations(checklists, ({ one, many }) => ({
  card: one(cards, {
    fields: [checklists.cardId],
    references: [cards.id],
    relationName: "checklistsCard",
  }),
  createdBy: one(users, {
    fields: [checklists.createdBy],
    references: [users.id],
    relationName: "checklistsCreatedByUser",
  }),
  deletedBy: one(users, {
    fields: [checklists.deletedBy],
    references: [users.id],
    relationName: "checklistsDeletedByUser",
  }),
  items: many(checklistItems),
}));

export const checklistItems = pgTable("card_checklist_item", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  title: varchar("title", { length: 500 }).notNull(),
  completed: boolean("completed").notNull().default(false),
  index: integer("index").notNull(),
  checklistId: bigint("checklistId", { mode: "number" })
    .notNull()
    .references(() => checklists.id, { onDelete: "cascade" }),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  deletedAt: timestamp("deletedAt"),
  deletedBy: uuid("deletedBy").references(() => users.id, {
    onDelete: "set null",
  }),
}).enableRLS();

export const checklistItemsRelations = relations(checklistItems, ({ one }) => ({
  checklist: one(checklists, {
    fields: [checklistItems.checklistId],
    references: [checklists.id],
    relationName: "checklistItemsChecklist",
  }),
  createdBy: one(users, {
    fields: [checklistItems.createdBy],
    references: [users.id],
    relationName: "checklistItemsCreatedByUser",
  }),
  deletedBy: one(users, {
    fields: [checklistItems.deletedBy],
    references: [users.id],
    relationName: "checklistItemsDeletedByUser",
  }),
}));



================================================
FILE: packages/db/src/schema/feedback.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigserial,
  boolean,
  pgTable,
  text,
  timestamp,
  uuid,
} from "drizzle-orm/pg-core";

import { users } from "./users";

export const feedback = pgTable("feedback", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  feedback: text("feedback").notNull(),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  url: text("url").notNull(),
  reviewed: boolean("reviewed").default(false).notNull(),
}).enableRLS();

export const feedbackRelations = relations(feedback, ({ one }) => ({
  createdBy: one(users, {
    fields: [feedback.createdBy],
    references: [users.id],
    relationName: "feedbackCreatedByUser",
  }),
}));



================================================
FILE: packages/db/src/schema/imports.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigserial,
  pgEnum,
  pgTable,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { boards } from "./boards";
import { cards } from "./cards";
import { labels } from "./labels";
import { lists } from "./lists";
import { users } from "./users";

export const importSourceEnum = pgEnum("source", ["trello"]);
export const importStatusEnum = pgEnum("status", [
  "started",
  "success",
  "failed",
]);

export const imports = pgTable("import", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  source: importSourceEnum("source").notNull(),
  status: importStatusEnum("status").notNull(),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
}).enableRLS();

export const importsRelations = relations(imports, ({ one, many }) => ({
  createdBy: one(users, {
    fields: [imports.createdBy],
    references: [users.id],
    relationName: "importsCreatedByUser",
  }),
  boards: many(boards),
  cards: many(cards),
  lists: many(lists),
  labels: many(labels),
}));



================================================
FILE: packages/db/src/schema/index.ts
================================================
export * from "./auth";
export * from "./boards";
export * from "./auth";
export * from "./cards";
export * from "./checklists";
export * from "./feedback";
export * from "./imports";
export * from "./labels";
export * from "./lists";
export * from "./users";
export * from "./integrations";
export * from "./workspaces";
export * from "./subscriptions";
export * from "./workspaceInviteLinks";
export * from "./permissions";
export * from "./notifications";
export * from "./webhooks";



================================================
FILE: packages/db/src/schema/integrations.ts
================================================
import { relations } from "drizzle-orm";
import {
  pgTable,
  primaryKey,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { users } from "./users";

export const integrations = pgTable(
  "integration",
  {
    provider: varchar("provider", { length: 255 }).notNull(),
    userId: uuid("userId")
      .notNull()
      .references(() => users.id, { onDelete: "cascade" }),
    accessToken: varchar("accessToken", { length: 255 }).notNull(),
    refreshToken: varchar("refreshToken", { length: 255 }),
    expiresAt: timestamp("expiresAt").notNull(),
    createdAt: timestamp("createdAt")
      .$defaultFn(() => new Date())
      .notNull(),
    updatedAt: timestamp("updatedAt").$onUpdateFn(() => new Date()),
  },
  (table) => [
    primaryKey({
      name: "integration_pkey",
      columns: [table.userId, table.provider],
    }),
  ],
).enableRLS();

export const integrationsRelations = relations(integrations, ({ one }) => ({
  user: one(users, {
    fields: [integrations.userId],
    references: [users.id],
  }),
}));



================================================
FILE: packages/db/src/schema/labels.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigint,
  bigserial,
  pgTable,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { boards } from "./boards";
import { cardsToLabels } from "./cards";
import { imports } from "./imports";
import { users } from "./users";

export const labels = pgTable("label", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  name: varchar("name", { length: 255 }).notNull(),
  colourCode: varchar("colourCode", { length: 12 }),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  boardId: bigint("boardId", { mode: "number" })
    .notNull()
    .references(() => boards.id, { onDelete: "cascade" }),
  importId: bigint("importId", { mode: "number" }).references(() => imports.id),
  deletedAt: timestamp("deletedAt"),
  deletedBy: uuid("deletedBy").references(() => users.id, {
    onDelete: "set null",
  }),
}).enableRLS();

export const labelsRelations = relations(labels, ({ one, many }) => ({
  createdBy: one(users, {
    fields: [labels.createdBy],
    references: [users.id],
    relationName: "labelsCreatedByUser",
  }),
  deletedBy: one(users, {
    fields: [labels.deletedBy],
    references: [users.id],
    relationName: "labelsDeletedByUser",
  }),
  board: one(boards, {
    fields: [labels.boardId],
    references: [boards.id],
  }),
  cards: many(cardsToLabels),
  import: one(imports, {
    fields: [labels.importId],
    references: [imports.id],
    relationName: "labelsImport",
  }),
}));



================================================
FILE: packages/db/src/schema/lists.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigint,
  bigserial,
  integer,
  pgTable,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { boards } from "./boards";
import { cards } from "./cards";
import { imports } from "./imports";
import { users } from "./users";

export const lists = pgTable("list", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  name: varchar("name", { length: 255 }).notNull(),
  index: integer("index").notNull(),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  deletedAt: timestamp("deletedAt"),
  deletedBy: uuid("deletedBy").references(() => users.id, {
    onDelete: "set null",
  }),
  boardId: bigint("boardId", { mode: "number" })
    .notNull()
    .references(() => boards.id, { onDelete: "cascade" }),
  importId: bigint("importId", { mode: "number" }).references(() => imports.id),
}).enableRLS();

export const listsRelations = relations(lists, ({ one, many }) => ({
  createdBy: one(users, {
    fields: [lists.createdBy],
    references: [users.id],
    relationName: "listsCreatedByUser",
  }),
  board: one(boards, {
    fields: [lists.boardId],
    references: [boards.id],
    relationName: "listsBoard",
  }),
  cards: many(cards),
  deletedBy: one(users, {
    fields: [lists.deletedBy],
    references: [users.id],
    relationName: "listsDeletedByUser",
  }),
  import: one(imports, {
    fields: [lists.importId],
    references: [imports.id],
    relationName: "listsImport",
  }),
}));



================================================
FILE: packages/db/src/schema/notifications.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigint,
  bigserial,
  index,
  pgEnum,
  pgTable,
  text,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { cards } from "./cards";
import { comments } from "./cards";
import { users } from "./users";
import { workspaces } from "./workspaces";

export const notificationTypes = [
  "mention",
  "workspace.member.added",
  "workspace.member.removed",
  "workspace.role.changed",
] as const;

export type NotificationType = (typeof notificationTypes)[number];

export const notificationTypeEnum = pgEnum("notification_type", notificationTypes);

export const notifications = pgTable(
  "notification",
  {
    id: bigserial("id", { mode: "number" }).primaryKey(),
    publicId: varchar("publicId", { length: 12 }).notNull().unique(),
    type: notificationTypeEnum("type").notNull(),
    userId: uuid("userId")
      .notNull()
      .references(() => users.id, { onDelete: "cascade" }),
    cardId: bigint("cardId", { mode: "number" }).references(() => cards.id, {
      onDelete: "cascade",
    }),
    commentId: bigint("commentId", { mode: "number" }).references(
      () => comments.id,
      { onDelete: "cascade" },
    ),
    workspaceId: bigint("workspaceId", { mode: "number" }).references(
      () => workspaces.id,
      { onDelete: "cascade" },
    ),
    metadata: text("metadata"),
    readAt: timestamp("readAt"),
    createdAt: timestamp("createdAt").defaultNow().notNull(),
    deletedAt: timestamp("deletedAt"),
  },
  (table) => [
    index("notification_user_deleted_idx").on(table.userId, table.deletedAt),
    index("notification_user_read_deleted_idx").on(
      table.userId,
      table.readAt,
      table.deletedAt,
    ),
    index("notification_user_type_card_idx").on(
      table.userId,
      table.type,
      table.cardId,
    ),
    index("notification_user_type_workspace_idx").on(
      table.userId,
      table.type,
      table.workspaceId,
    ),
    index("notification_user_created_idx").on(table.userId, table.createdAt),
  ],
).enableRLS();

export const notificationsRelations = relations(notifications, ({ one }) => ({
  user: one(users, {
    fields: [notifications.userId],
    references: [users.id],
    relationName: "notificationsUser",
  }),
  card: one(cards, {
    fields: [notifications.cardId],
    references: [cards.id],
    relationName: "notificationsCard",
  }),
  comment: one(comments, {
    fields: [notifications.commentId],
    references: [comments.id],
    relationName: "notificationsComment",
  }),
  workspace: one(workspaces, {
    fields: [notifications.workspaceId],
    references: [workspaces.id],
    relationName: "notificationsWorkspace",
  }),
}));




================================================
FILE: packages/db/src/schema/permissions.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigint,
  bigserial,
  boolean,
  index,
  integer,
  pgTable,
  timestamp,
  uniqueIndex,
  varchar,
} from "drizzle-orm/pg-core";

import { workspaces } from "./workspaces";

export const workspaceRoles = pgTable(
  "workspace_roles",
  {
    id: bigserial("id", { mode: "number" }).primaryKey(),
    publicId: varchar("publicId", { length: 12 }).notNull().unique(),
    workspaceId: bigint("workspaceId", { mode: "number" })
      .notNull()
      .references(() => workspaces.id, { onDelete: "cascade" }),
    name: varchar("name", { length: 64 }).notNull(),
    description: varchar("description", { length: 255 }),
    hierarchyLevel: integer("hierarchyLevel").notNull(),
    isSystem: boolean("isSystem").notNull().default(false),
    createdAt: timestamp("createdAt").defaultNow().notNull(),
    updatedAt: timestamp("updatedAt"),
  },
  (table) => [
    uniqueIndex("unique_role_per_workspace").on(table.workspaceId, table.name),
    index("workspace_roles_workspace_idx").on(table.workspaceId),
  ],
).enableRLS();

export const workspaceRolesRelations = relations(
  workspaceRoles,
  ({ one, many }) => ({
    workspace: one(workspaces, {
      fields: [workspaceRoles.workspaceId],
      references: [workspaces.id],
      relationName: "workspaceRoles",
    }),
    permissions: many(workspaceRolePermissions),
  }),
);


export const workspaceRolePermissions = pgTable(
  "workspace_role_permissions",
  {
    id: bigserial("id", { mode: "number" }).primaryKey(),
    workspaceRoleId: bigint("workspaceRoleId", { mode: "number" })
      .notNull()
      .references(() => workspaceRoles.id, { onDelete: "cascade" }),
    permission: varchar("permission", { length: 64 }).notNull(),
    granted: boolean("granted").notNull().default(true),
    createdAt: timestamp("createdAt").defaultNow().notNull(),
  },
  (table) => [
    uniqueIndex("unique_role_permission").on(
      table.workspaceRoleId,
      table.permission,
    ),
    index("role_permissions_role_idx").on(table.workspaceRoleId),
  ],
).enableRLS();

export const workspaceRolePermissionsRelations = relations(
  workspaceRolePermissions,
  ({ one }) => ({
    role: one(workspaceRoles, {
      fields: [workspaceRolePermissions.workspaceRoleId],
      references: [workspaceRoles.id],
      relationName: "rolePermissions",
    }),
  }),
);

export const workspaceMemberPermissions = pgTable(
  "workspace_member_permissions",
  {
    id: bigserial("id", { mode: "number" }).primaryKey(),
    workspaceMemberId: bigint("workspaceMemberId", { mode: "number" }).notNull(),
    permission: varchar("permission", { length: 64 }).notNull(),
    granted: boolean("granted").notNull().default(true),
    createdAt: timestamp("createdAt").defaultNow().notNull(),
    updatedAt: timestamp("updatedAt"),
  },
  (table) => [
    uniqueIndex("unique_member_permission").on(
      table.workspaceMemberId,
      table.permission,
    ),
    index("permission_member_idx").on(table.workspaceMemberId),
  ],
).enableRLS();



================================================
FILE: packages/db/src/schema/subscriptions.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigserial,
  boolean,
  integer,
  pgTable,
  timestamp,
  varchar,
} from "drizzle-orm/pg-core";

import { workspaces } from "./workspaces";

export const subscription = pgTable("subscription", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  plan: varchar("plan", { length: 255 }).notNull(),
  referenceId: varchar("referenceId", { length: 12 }).references(
    () => workspaces.publicId,
    { onDelete: "set null" },
  ),
  stripeCustomerId: varchar("stripeCustomerId", { length: 255 }),
  stripeSubscriptionId: varchar("stripeSubscriptionId", { length: 255 }),
  status: varchar("status", { length: 255 }).notNull(),
  periodStart: timestamp("periodStart"),
  periodEnd: timestamp("periodEnd"),
  cancelAtPeriodEnd: boolean("cancelAtPeriodEnd"),
  seats: integer("seats"),
  unlimitedSeats: boolean("unlimitedSeats").default(false).notNull(),
  trialStart: timestamp("trialStart"),
  trialEnd: timestamp("trialEnd"),
  createdAt: timestamp("createdAt").notNull().defaultNow(),
  updatedAt: timestamp("updatedAt").notNull().defaultNow(),
}).enableRLS();

export const subscriptionsRelations = relations(subscription, ({ one }) => ({
  workspace: one(workspaces, {
    fields: [subscription.referenceId],
    references: [workspaces.publicId],
  }),
}));



================================================
FILE: packages/db/src/schema/users.ts
================================================
import { relations, sql } from "drizzle-orm";
import {
  boolean,
  pgTable,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { apikey } from "./auth";
import { boards, userBoardFavorites } from "./boards";
import { cards } from "./cards";
import { imports } from "./imports";
import { lists } from "./lists";
import { workspaceMembers, workspaces } from "./workspaces";
import { integrations } from "./integrations";

export const users = pgTable("user", {
  id: uuid("id")
    .notNull()
    .primaryKey()
    .default(sql`uuid_generate_v4()`),
  name: varchar("name", { length: 255 }),
  email: varchar("email", { length: 255 }).notNull().unique(),
  emailVerified: boolean("emailVerified").notNull(),
  image: varchar("image", { length: 255 }),
  createdAt: timestamp("createdAt").notNull().defaultNow(),
  updatedAt: timestamp("updatedAt").notNull().defaultNow(),
  stripeCustomerId: varchar("stripeCustomerId", { length: 255 }),
}).enableRLS();

export const usersRelations = relations(users, ({ many }) => ({
  deletedBoards: many(boards, {
    relationName: "boardDeletedByUser",
  }),
  boards: many(boards, {
    relationName: "boardCreatedByUser",
  }),
  deletedCards: many(cards, {
    relationName: "cardsDeletedByUser",
  }),
  cards: many(cards, {
    relationName: "cardsCreatedByUser",
  }),
  imports: many(imports),
  deletedLists: many(lists, {
    relationName: "listsDeletedByUser",
  }),
  lists: many(lists, {
    relationName: "listsCreatedByUser",
  }),
  deletedWorkspaces: many(workspaces, {
    relationName: "workspaceDeletedByUser",
  }),
  workspaces: many(workspaces, {
    relationName: "workspaceCreatedByUser",
  }),
  apiKeys: many(apikey),
  integrations: many(integrations),
}));

export const usersToWorkspacesRelations = relations(
  workspaceMembers,
  ({ one }) => ({
    addedBy: one(users, {
      fields: [workspaceMembers.createdBy],
      references: [users.id],
      relationName: "usersToWorkspacesAddedByUser",
    }),
    deletedBy: one(users, {
      fields: [workspaceMembers.deletedBy],
      references: [users.id],
      relationName: "usersToWorkspacesDeletedByUser",
    }),
    user: one(users, {
      fields: [workspaceMembers.userId],
      references: [users.id],
      relationName: "usersToWorkspacesUser",
    }),
    workspace: one(workspaces, {
      fields: [workspaceMembers.workspaceId],
      references: [workspaces.id],
      relationName: "usersToWorkspacesWorkspace",
    }),
  }),
);

export const userBoardFavoritesRelations = relations(userBoardFavorites, ({ one }) => ({
  user: one(users, {
    fields: [userBoardFavorites.userId],
    references: [users.id],
  }),
  board: one(boards, {
    fields: [userBoardFavorites.boardId],
    references: [boards.id],
  }),
}));


================================================
FILE: packages/db/src/schema/webhooks.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigint,
  bigserial,
  boolean,
  index,
  pgTable,
  text,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { users } from "./users";
import { workspaces } from "./workspaces";

export const webhookEvents = [
  "card.created",
  "card.updated",
  "card.moved",
  "card.deleted",
] as const;
export type WebhookEvent = (typeof webhookEvents)[number];

export const workspaceWebhooks = pgTable("workspace_webhooks", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  workspaceId: bigint("workspaceId", { mode: "number" })
    .notNull()
    .references(() => workspaces.id, { onDelete: "cascade" }),
  name: varchar("name", { length: 255 }).notNull(),
  url: varchar("url", { length: 2048 }).notNull(),
  secret: text("secret"),
  events: text("events").notNull(), // JSON array of webhook events
  active: boolean("active").notNull().default(true),
  createdBy: uuid("createdBy")
    .notNull()
    .references(() => users.id, { onDelete: "cascade" }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
}, (table) => [
  index("workspace_webhooks_workspace_idx").on(table.workspaceId),
]).enableRLS();

export const workspaceWebhooksRelations = relations(
  workspaceWebhooks,
  ({ one }) => ({
    workspace: one(workspaces, {
      fields: [workspaceWebhooks.workspaceId],
      references: [workspaces.id],
      relationName: "workspaceWebhooksWorkspace",
    }),
    createdByUser: one(users, {
      fields: [workspaceWebhooks.createdBy],
      references: [users.id],
      relationName: "workspaceWebhooksCreatedByUser",
    }),
  }),
);



================================================
FILE: packages/db/src/schema/workspaceInviteLinks.ts
================================================
import {
  bigint,
  bigserial,
  pgEnum,
  pgTable,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { users } from "./users";
import { workspaces } from "./workspaces";

export const inviteLinkStatuses = ["active", "inactive"] as const;
export type InviteLinkStatus = (typeof inviteLinkStatuses)[number];
export const inviteLinkStatusEnum = pgEnum(
  "invite_link_status",
  inviteLinkStatuses,
);

export const workspaceInviteLinks = pgTable("workspace_invite_links", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  workspaceId: bigint("workspaceId", { mode: "number" })
    .notNull()
    .references(() => workspaces.id, { onDelete: "cascade" }),
  code: varchar("code", { length: 12 }).notNull().unique(),
  status: inviteLinkStatusEnum("status").notNull().default("active"),
  expiresAt: timestamp("expiresAt"),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  updatedAt: timestamp("updatedAt"),
  updatedBy: uuid("updatedBy").references(() => users.id, {
    onDelete: "set null",
  }),
}).enableRLS();



================================================
FILE: packages/db/src/schema/workspaces.ts
================================================
import { relations } from "drizzle-orm";
import {
  bigint,
  bigserial,
  boolean,
  pgEnum,
  pgTable,
  text,
  timestamp,
  uuid,
  varchar,
} from "drizzle-orm/pg-core";

import { boards } from "./boards";
import { workspaceMemberPermissions, workspaceRoles } from "./permissions";
import { subscription } from "./subscriptions";
import { users } from "./users";

export const memberRoles = ["admin", "member", "guest"] as const;
export type MemberRole = (typeof memberRoles)[number];
export const memberRoleEnum = pgEnum("role", memberRoles);

export const memberStatuses = [
  "invited",
  "active",
  "removed",
  "paused",
] as const;
export type MemberStatus = (typeof memberStatuses)[number];
export const memberStatusEnum = pgEnum("member_status", memberStatuses);

export const slugTypes = ["reserved", "premium"] as const;
export type SlugType = (typeof slugTypes)[number];
export const slugTypeEnum = pgEnum("slug_type", slugTypes);

export const workspacePlans = ["free", "pro", "enterprise"] as const;
export type WorkspacePlan = (typeof workspacePlans)[number];
export const workspacePlanEnum = pgEnum("workspace_plan", workspacePlans);

export const workspaces = pgTable("workspace", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  name: varchar("name", { length: 255 }).notNull(),
  description: text("description"),
  slug: varchar("slug", { length: 255 }).notNull().unique(),
  plan: workspacePlanEnum("plan").notNull().default("free"),
  showEmailsToMembers: boolean("showEmailsToMembers").notNull().default(true),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  deletedAt: timestamp("deletedAt"),
  deletedBy: uuid("deletedBy").references(() => users.id, {
    onDelete: "set null",
  }),
}).enableRLS();

export const workspaceRelations = relations(workspaces, ({ one, many }) => ({
  user: one(users, {
    fields: [workspaces.createdBy],
    references: [users.id],
    relationName: "workspaceCreatedByUser",
  }),
  deletedBy: one(users, {
    fields: [workspaces.deletedBy],
    references: [users.id],
    relationName: "workspaceDeletedByUser",
  }),
  members: many(workspaceMembers),
  boards: many(boards),
  subscriptions: many(subscription),
  roles: many(workspaceRoles),
}));

export const workspaceMembers = pgTable("workspace_members", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  publicId: varchar("publicId", { length: 12 }).notNull().unique(),
  email: varchar("email", { length: 255 }).notNull(),
  userId: uuid("userId").references(() => users.id, { onDelete: "set null" }),
  workspaceId: bigint("workspaceId", { mode: "number" })
    .notNull()
    .references(() => workspaces.id, { onDelete: "cascade" }),
  createdBy: uuid("createdBy").notNull(),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
  updatedAt: timestamp("updatedAt"),
  deletedAt: timestamp("deletedAt"),
  deletedBy: uuid("deletedBy").references(() => users.id, {
    onDelete: "set null",
  }),
  // Legacy role enum
  role: memberRoleEnum("role").notNull(),
  roleId: bigint("roleId", { mode: "number" }).references(
    () => workspaceRoles.id,
    { onDelete: "restrict" },
  ),
  status: memberStatusEnum("status").default("invited").notNull(),
}).enableRLS();

export const workspaceMembersRelations = relations(
  workspaceMembers,
  ({ one, many }) => ({
    user: one(users, {
      fields: [workspaceMembers.userId],
      references: [users.id],
      relationName: "workspaceMembersUser",
    }),
    workspace: one(workspaces, {
      fields: [workspaceMembers.workspaceId],
      references: [workspaces.id],
      relationName: "workspaceMembersWorkspace",
    }),
    workspaceRole: one(workspaceRoles, {
      fields: [workspaceMembers.roleId],
      references: [workspaceRoles.id],
      relationName: "workspaceMemberRole",
    }),
    permissions: many(workspaceMemberPermissions),
  }),
);

export const workspaceMemberPermissionsRelations = relations(
  workspaceMemberPermissions,
  ({ one }) => ({
    member: one(workspaceMembers, {
      fields: [workspaceMemberPermissions.workspaceMemberId],
      references: [workspaceMembers.id],
      relationName: "memberPermissions",
    }),
  }),
);

export const slugs = pgTable("workspace_slugs", {
  slug: varchar("slug", { length: 255 }).notNull().unique(),
  type: slugTypeEnum("type").notNull(),
});

export const slugChecks = pgTable("workspace_slug_checks", {
  id: bigserial("id", { mode: "number" }).primaryKey(),
  slug: varchar("slug", { length: 255 }).notNull(),
  available: boolean("available").notNull(),
  reserved: boolean("reserved").notNull(),
  workspaceId: bigint("workspaceId", { mode: "number" }).references(
    () => workspaces.id,
  ),
  createdBy: uuid("createdBy").references(() => users.id, {
    onDelete: "set null",
  }),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
}).enableRLS();



================================================
FILE: packages/email/readme.md
================================================
# React Email Starter

A live preview right in your browser so you don't need to keep sending real emails during development.

## Getting Started

First, install the dependencies:

```sh
npm install
# or
yarn
```

Then, run the development server:

```sh
npm run dev
# or
yarn dev
```

Open [localhost:3000](http://localhost:3000) with your browser to see the result.

## License

MIT License



================================================
FILE: packages/email/eslint.config.js
================================================
import baseConfig from "@kan/eslint-config/base";

/** @type {import('typescript-eslint').Config} */
export default [
  {
    ignores: ["dist/**"],
  },
  ...baseConfig,
];



================================================
FILE: packages/email/package.json
================================================
{
  "name": "@kan/email",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./src/index.tsx"
    }
  },
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "license": "GPL-3.0",
  "scripts": {
    "dev": "tsc",
    "run:dev": "email dev",
    "export": "email export",
    "build": "tsc",
    "clean": "git clean -xdf .cache .turbo dist node_modules",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "typecheck": "tsc --noEmit --emitDeclarationOnly false"
  },
  "dependencies": {
    "@novu/api": "^3.11.0",
    "@react-email/components": "^1.0.1",
    "nodemailer": "^7.0.3",
    "react-email": "^5.0.6"
  },
  "devDependencies": {
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "@types/nodemailer": "^6.4.17",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config"
}



================================================
FILE: packages/email/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/internal-package.json",
  "include": ["src"],
  "exclude": ["node_modules"],
  "compilerOptions": {
    "jsx": "react-jsx",
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "module": "ESNext"
  }
}



================================================
FILE: packages/email/src/index.tsx
================================================
export const name = "email";

export { sendEmail } from "./sendEmail";
export { notificationClient } from "./notificationClient";



================================================
FILE: packages/email/src/notificationClient.tsx
================================================
import { Novu } from "@novu/api";

export const notificationClient =
  process.env.NEXT_PUBLIC_KAN_ENV === "cloud" && process.env.NOVU_API_KEY
    ? new Novu({ secretKey: process.env.NOVU_API_KEY })
    : null;



================================================
FILE: packages/email/src/sendEmail.tsx
================================================
import { render } from "@react-email/render";
import nodemailer from "nodemailer";

import JoinWorkspaceTemplate from "./templates/join-workspace";
import MagicLinkTemplate from "./templates/magic-link";
import MentionTemplate from "./templates/mention";
import ResetPasswordTemplate from "./templates/reset-password";

type Templates = "MAGIC_LINK" | "JOIN_WORKSPACE" | "RESET_PASSWORD" | "MENTION";

const emailTemplates: Record<Templates, React.ComponentType<any>> = {
  MAGIC_LINK: MagicLinkTemplate,
  JOIN_WORKSPACE: JoinWorkspaceTemplate,
  RESET_PASSWORD: ResetPasswordTemplate,
  MENTION: MentionTemplate,
};

const transporter = nodemailer.createTransport({
  host: process.env.SMTP_HOST,
  port: Number(process.env.SMTP_PORT),
  secure:
    process.env.SMTP_SECURE === undefined
      ? true
      : process.env.SMTP_SECURE?.toLowerCase() === "true",
  tls: {
    // do not fail on invalid certs
    rejectUnauthorized:
      process.env.SMTP_REJECT_UNAUTHORIZED === undefined
        ? true
        : process.env.SMTP_REJECT_UNAUTHORIZED?.toLowerCase() === "true",
  },
  ...(process.env.SMTP_USER &&
    process.env.SMTP_PASSWORD && {
      auth: {
        user: process.env.SMTP_USER,
        pass: process.env.SMTP_PASSWORD,
      },
    }),
});

export const sendEmail = async (
  to: string,
  subject: string,
  template: Templates,
  data: Record<string, string>,
) => {
  try {
    const EmailTemplate = emailTemplates[template];

    const html = await render(<EmailTemplate {...data} />, { pretty: true });

    const options = {
      from: process.env.EMAIL_FROM,
      to,
      subject,
      html,
    };

    const response = await transporter.sendMail(options);

    if (!response.accepted.length) {
      throw new Error(`Failed to send email: ${response.response}`);
    }

    return response;
  } catch (error) {
    console.error("Email sending failed:", {
      to,
      from: process.env.EMAIL_FROM,
      subject,
      template,
      error: error instanceof Error ? error.message : String(error),
      stack: error instanceof Error ? error.stack : undefined,
    });
    throw error;
  }
};



================================================
FILE: packages/email/src/templates/join-workspace.tsx
================================================
import { Body } from "@react-email/body";
import { Button } from "@react-email/button";
import { Container } from "@react-email/container";
import { Head } from "@react-email/head";
import { Heading } from "@react-email/heading";
import { Hr } from "@react-email/hr";
import { Html } from "@react-email/html";
import { Link } from "@react-email/link";
import { Preview } from "@react-email/preview";
import { Text } from "@react-email/text";
import { env } from "next-runtime-env";
import * as React from "react";

export const JoinWorkspaceTemplate = ({
  magicLoginUrl,
  inviterName,
  workspaceName,
}: {
  magicLoginUrl?: string;
  inviterName?: string;
  workspaceName?: string;
}) => (
  <Html>
    <Head />
    <Preview>Join {workspaceName ?? "workspace"} on kan.bn</Preview>
    <Body style={{ backgroundColor: "white" }}>
      <Container
        style={{
          fontFamily:
            '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif',
          margin: "auto",
          paddingLeft: "0.75rem",
          paddingRight: "0.75rem",
        }}
      >
        <Heading
          style={{
            marginTop: "2.5rem",
            marginBottom: "2.5rem",
            fontSize: "24px",
            fontWeight: "bold",
            color: "#232323",
          }}
        >
          {env("NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY") !== "true" && "Kan"}
        </Heading>
        <Heading
          style={{ fontSize: "24px", fontWeight: "bold", color: "#232323" }}
        >
          {inviterName
            ? `${inviterName} invited you to join ${
                workspaceName ?? "a workspace"
              }`
            : `You've been invited to join ${workspaceName ?? "a workspace"}`}
        </Heading>
        <Text
          style={{
            fontSize: "0.875rem",
            marginBottom: "2rem",
            color: "#232323",
          }}
        >
          Click the button below to add this workspace to your account.
        </Text>
        <Button
          target="_blank"
          href={magicLoginUrl}
          style={{
            marginBottom: "2rem",
            borderRadius: "0.375rem",
            backgroundColor: "#282828",
            paddingLeft: "1.5rem",
            paddingRight: "1.5rem",
            paddingTop: "1rem",
            paddingBottom: "1rem",
            fontSize: "0.875rem",
            fontWeight: "500",
            lineHeight: "1",
            color: "white",
          }}
        >
          Join {workspaceName ?? "workspace"}
        </Button>
        <Text
          style={{
            marginBottom: "1rem",
            fontSize: "0.875rem",
            color: "#7e7e7e",
          }}
        >
          If you don&apos;t want to join this workspace, you can safely ignore this email.
        </Text>
        {env("NEXT_PUBLIC_WHITE_LABEL_HIDE_POWERED_BY") !== "true" && (
          <>
            <Hr
              style={{
                marginTop: "2.5rem",
                marginBottom: "2rem",
                borderWidth: "1px",
              }}
            />
            <Text style={{ color: "#7e7e7e" }}>
              <Link
                href={env("NEXT_PUBLIC_BASE_URL")}
                target="_blank"
                style={{ color: "#7e7e7e", textDecoration: "underline" }}
              >
                Kan
              </Link>
              , the open source Trello alternative.
            </Text>
          </>
        )}
      </Container>
    </Body>
  </Html>
);

export default JoinWorkspaceTemplate;



================================================
FILE: packages/email/src/templates/magic-link.tsx
================================================
import { Body } from "@react-email/body";
import { Button } from "@react-email/button";
import { Container } from "@react-email/container";
import { Head } from "@react-email/head";
import { Heading } from "@react-email/heading";
import { Hr } from "@react-email/hr";
import { Html } from "@react-email/html";
import { Link } from "@react-email/link";
import { Preview } from "@react-email/preview";
import { Text } from "@react-email/text";
import { env } from "next-runtime-env";
import * as React from "react";

export const MagicLinkTemplate = ({
  magicLoginUrl,
}: {
  magicLoginUrl?: string;
}) => (
  <Html>
    <Head />
    <Preview>Log in with this magic link</Preview>
    <Body style={{ backgroundColor: "white" }}>
      <Container
        style={{
          fontFamily:
            '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif',
          margin: "auto",
          paddingLeft: "0.75rem",
          paddingRight: "0.75rem",
        }}
      >
        <Heading
          style={{
            marginTop: "2.5rem",
            marginBottom: "2.5rem",
            fontSize: "24px",
            fontWeight: "bold",
            color: "#232323",
          }}
        >
          kan.bn
        </Heading>
        <Heading
          style={{ fontSize: "24px", fontWeight: "bold", color: "#232323" }}
        >
          Login to your Kan account
        </Heading>
        <Text
          style={{
            fontSize: "0.875rem",
            marginBottom: "2rem",
            color: "#232323",
          }}
        >
          Click the button below to instantly login to your account.
        </Text>
        <Button
          target="_blank"
          href={magicLoginUrl}
          style={{
            marginBottom: "2rem",
            borderRadius: "0.375rem",
            backgroundColor: "#282828",
            paddingLeft: "1.5rem",
            paddingRight: "1.5rem",
            paddingTop: "1rem",
            paddingBottom: "1rem",
            fontSize: "0.875rem",
            fontWeight: "500",
            lineHeight: "1",
            color: "white",
          }}
        >
          Login to your account
        </Button>
        <Text
          style={{
            marginBottom: "1rem",
            fontSize: "0.875rem",
            color: "#7e7e7e",
          }}
        >
          If you didn&apos;t try to login, you can safely ignore this email.
        </Text>
        <Hr
          style={{
            marginTop: "2.5rem",
            marginBottom: "2rem",
            borderWidth: "1px",
          }}
        />
        <Text style={{ color: "#7e7e7e" }}>
          <Link
            href={env("NEXT_PUBLIC_BASE_URL")}
            target="_blank"
            style={{ color: "#7e7e7e", textDecoration: "underline" }}
          >
            Kan
          </Link>
          , the open source Trello alternative.
        </Text>
      </Container>
    </Body>
  </Html>
);

export default MagicLinkTemplate;



================================================
FILE: packages/email/src/templates/mention.tsx
================================================
import { Body } from "@react-email/body";
import { Button } from "@react-email/button";
import { Container } from "@react-email/container";
import { Head } from "@react-email/head";
import { Heading } from "@react-email/heading";
import { Hr } from "@react-email/hr";
import { Html } from "@react-email/html";
import { Link } from "@react-email/link";
import { Preview } from "@react-email/preview";
import { Text } from "@react-email/text";
import { env } from "next-runtime-env";
import * as React from "react";

export const MentionTemplate = ({
  commenterName,
  boardName,
  cardTitle,
  cardUrl,
}: {
  commenterName: string;
  boardName: string;
  cardTitle: string;
  cardUrl: string;
}) => (
  <Html>
    <Head />
    <Preview>
      {commenterName} mentioned you in a comment on {cardTitle}
    </Preview>
    <Body style={{ backgroundColor: "white" }}>
      <Container
        style={{
          fontFamily:
            '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif',
          margin: "auto",
          paddingLeft: "0.75rem",
          paddingRight: "0.75rem",
        }}
      >
        <Heading
          style={{
            marginTop: "2.5rem",
            marginBottom: "2.5rem",
            fontSize: "24px",
            fontWeight: "bold",
            color: "#232323",
          }}
        >
          kan.bn
        </Heading>
        <Heading
          style={{ fontSize: "24px", fontWeight: "bold", color: "#232323" }}
        >
          You were mentioned in a comment
        </Heading>
        <Text
          style={{
            fontSize: "0.875rem",
            marginBottom: "1rem",
            color: "#232323",
          }}
        >
          <strong>{commenterName}</strong> mentioned you in a comment on the
          card <strong>{cardTitle}</strong> in the board <strong>{boardName}</strong>.
        </Text>
        <Button
          target="_blank"
          href={cardUrl}
          style={{
            marginBottom: "2rem",
            borderRadius: "0.375rem",
            backgroundColor: "#282828",
            paddingLeft: "1.5rem",
            paddingRight: "1.5rem",
            paddingTop: "1rem",
            paddingBottom: "1rem",
            fontSize: "0.875rem",
            fontWeight: "500",
            lineHeight: "1",
            color: "white",
          }}
        >
          View Card
        </Button>
        <Hr
          style={{
            marginTop: "2.5rem",
            marginBottom: "2rem",
            borderWidth: "1px",
          }}
        />
        <Text style={{ color: "#7e7e7e" }}>
          <Link
            href={env("NEXT_PUBLIC_BASE_URL")}
            target="_blank"
            style={{ color: "#7e7e7e", textDecoration: "underline" }}
          >
            Kan
          </Link>
          , the open source Trello alternative.
        </Text>
      </Container>
    </Body>
  </Html>
);

export default MentionTemplate;




================================================
FILE: packages/email/src/templates/reset-password.tsx
================================================
import { Body } from "@react-email/body";
import { Button } from "@react-email/button";
import { Container } from "@react-email/container";
import { Head } from "@react-email/head";
import { Heading } from "@react-email/heading";
import { Hr } from "@react-email/hr";
import { Html } from "@react-email/html";
import { Link } from "@react-email/link";
import { Preview } from "@react-email/preview";
import { Text } from "@react-email/text";
import { env } from "next-runtime-env";

export const ResetPasswordTemplate = ({
  resetPasswordUrl,
  resetPasswordToken,
}: {
  resetPasswordUrl?: string;
  resetPasswordToken?: string;
}) => (
  <Html>
    <Head />
    <Preview>Reset your Kan password</Preview>
    <Body style={{ backgroundColor: "white" }}>
      <Container
        style={{
          fontFamily:
            '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif',
          margin: "auto",
          paddingLeft: "0.75rem",
          paddingRight: "0.75rem",
        }}
      >
        <Heading
          style={{
            marginTop: "2.5rem",
            marginBottom: "2.5rem",
            fontSize: "24px",
            fontWeight: "bold",
            color: "#232323",
          }}
        >
          kan.bn
        </Heading>
        <Heading
          style={{ fontSize: "24px", fontWeight: "bold", color: "#232323" }}
        >
          Reset your Kan password
        </Heading>
        <Text
          style={{
            fontSize: "0.875rem",
            marginBottom: "2rem",
            color: "#232323",
          }}
        >
          Click the button below to reset your password.
        </Text>
        <Button
          target="_blank"
          href={resetPasswordUrl}
          style={{
            marginBottom: "2rem",
            borderRadius: "0.375rem",
            backgroundColor: "#282828",
            paddingLeft: "1.5rem",
            paddingRight: "1.5rem",
            paddingTop: "1rem",
            paddingBottom: "1rem",
            fontSize: "0.875rem",
            fontWeight: "500",
            lineHeight: "1",
            color: "white",
          }}
        >
          Reset your password
        </Button>
        <Text
          style={{
            marginBottom: "1rem",
            fontSize: "0.875rem",
            color: "#7e7e7e",
          }}
        >
          If you didn&apos;t try to reset your password, you can safely ignore this email.
        </Text>
        <Hr
          style={{
            marginTop: "2.5rem",
            marginBottom: "2rem",
            borderWidth: "1px",
          }}
        />
        <Text style={{ color: "#7e7e7e" }}>
          <Link
            href={env("NEXT_PUBLIC_BASE_URL")}
            target="_blank"
            style={{ color: "#7e7e7e", textDecoration: "underline" }}
          >
            Kan
          </Link>
          , the open source Trello alternative.
        </Text>
      </Container>
    </Body>
  </Html>
);

export default ResetPasswordTemplate;



================================================
FILE: packages/email/.react-email/next.config.js
================================================
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  experimental: {
    appDir: true,
    externalDir: true // compile files that are located next to the .react-email directory
  },
};

module.exports = nextConfig;


================================================
FILE: packages/email/.react-email/package.json
================================================
{"name":"react-email-client","version":"0.0.14","description":"The React Email preview application","license":"MIT","scripts":{"dev":"next dev","build":"next build","start":"next start","lint":"next lint","format:check":"prettier --check \"**/*.{ts,tsx,md}\"","format":"prettier --write \"**/*.{ts,tsx,md}\""},"engines":{"node":">=16.0.0"},"dependencies":{"@radix-ui/colors":"0.1.8","@radix-ui/react-collapsible":"1.0.1","@radix-ui/react-popover":"1.0.2","@radix-ui/react-slot":"1.0.1","@radix-ui/react-toggle-group":"1.0.1","@radix-ui/react-tooltip":"1.0.2","@react-email/render":"0.0.7","classnames":"2.3.2","framer-motion":"8.4.6","next":"13.2.4","prism-react-renderer":"1.3.5","react":"18.2.0","react-dom":"18.2.0","@react-email/components":"0.0.12","react-email":"^1.10.0"},"devDependencies":{"@types/classnames":"2.3.1","@types/node":"18.11.9","@types/react":"18.0.25","@types/react-dom":"18.0.9","autoprefixer":"10.4.13","eslint":"8.36.0","eslint-config-next":"13.2.4","eslint-config-prettier":"8.7.0","eslint-plugin-simple-import-sort":"10.0.0","eslint-plugin-unused-imports":"2.0.0","postcss":"8.4.19","prettier":"2.8.4","tailwindcss":"3.2.4","typescript":"4.9.3"},"readme":"ERROR: No README data found!","_id":"react-email-client@0.0.14"}


================================================
FILE: packages/email/.react-email/postcss.config.js
================================================
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};



================================================
FILE: packages/email/.react-email/tailwind.config.js
================================================
const colors = require('@radix-ui/colors');
const { fontFamily } = require('tailwindcss/defaultTheme');
const plugin = require('tailwindcss/plugin');

const iOsHeight = plugin(function ({ addUtilities }) {
  const supportsTouchRule = '@supports (-webkit-touch-callout: none)';
  const webkitFillAvailable = '-webkit-fill-available';

  const utilities = {
    '.min-h-screen-ios': {
      [supportsTouchRule]: {
        minHeight: webkitFillAvailable,
      },
    },
    '.h-screen-ios': {
      [supportsTouchRule]: {
        height: webkitFillAvailable,
      },
    },
  };

  addUtilities(utilities, ['responsive']);
});

/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    // app content
    `src/**/*.{js,ts,jsx,tsx}`,
    // include packages if not transpiling
    '../../packages/**/*.{js,ts,jsx,tsx}',
    '../../apps/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {
      backgroundImage: {
        gradient:
          'linear-gradient(145.37deg, rgba(255, 255, 255, 0.09) -8.75%, rgba(255, 255, 255, 0.027) 83.95%)',
        gradientHover:
          'linear-gradient(145.37deg, rgba(255, 255, 255, 0.1) -8.75%, rgba(255, 255, 255, 0.057) 83.95%)',
        shine:
          'linear-gradient(45deg, rgba(255,255,255,0) 45%,rgba(255,255,255,1) 50%,rgba(255,255,255,0) 55%,rgba(255,255,255,0) 100%)',
      },
      colors: {
        cyan: {
          1: colors.cyanDarkA.cyanA1,
          2: colors.cyanDarkA.cyanA2,
          3: colors.cyanDarkA.cyanA3,
          4: colors.cyanDarkA.cyanA4,
          5: colors.cyanDarkA.cyanA5,
          6: colors.cyanDarkA.cyanA6,
          7: colors.cyanDarkA.cyanA7,
          8: colors.cyanDarkA.cyanA8,
          9: colors.cyanDarkA.cyanA9,
          10: colors.cyanDarkA.cyanA10,
          11: colors.cyanDarkA.cyanA11,
          12: colors.cyanDarkA.cyanA12,
        },
        slate: {
          1: colors.slateDarkA.slateA1,
          2: colors.slateDarkA.slateA2,
          3: colors.slateDarkA.slateA3,
          4: colors.slateDarkA.slateA4,
          5: colors.slateDarkA.slateA5,
          6: colors.slateDarkA.slateA6,
          7: colors.slateDarkA.slateA7,
          8: colors.slateDarkA.slateA8,
          9: colors.slateDarkA.slateA9,
          10: colors.slateDarkA.slateA10,
          11: colors.slateDarkA.slateA11,
          12: colors.slateDarkA.slateA12,
        },
      },
      fontFamily: {
        sans: ['var(--font-inter)', ...fontFamily.sans],
      },
      keyframes: {
        shine: {
          '0%': { backgroundPosition: '-100%' },
          '100%': { backgroundPosition: '100%' },
        },
        dash: {
          '0%': { strokeDashoffset: 1000 },
          '100%': { strokeDashoffset: 0 },
        },
      },
    },
  },
  plugins: [iOsHeight],
};



================================================
FILE: packages/email/.react-email/tsconfig.json
================================================
{
  "compilerOptions": {
    "target": "es5",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": false,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "incremental": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "plugins": [
      {
        "name": "next"
      }
    ],
    "strictNullChecks": true
  },
  "include": [
    "preview/next-env.d.ts",
    "preview/.next/types/**/*.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}



================================================
FILE: packages/email/.react-email/.eslintrc.json
================================================
{
  "extends": ["next", "prettier"],
  "plugins": ["simple-import-sort", "unused-imports"],
  "rules": {
    "react/no-unescaped-entities": 0,
    "react-hooks/rules-of-hooks": 0,
    "no-unused-vars": "off",
    "simple-import-sort/imports": [
      "error",
      {
        // The default grouping, but with no blank lines.
        "groups": [["^\\u0000", "^@?\\w", "^", "^\\."]]
      }
    ],
    "simple-import-sort/exports": "error"
  }
}


================================================
FILE: packages/email/.react-email/.prettierignore
================================================
dist
.next
node_modules


================================================
FILE: packages/email/.react-email/.prettierrc.js
================================================
module.exports = {
  quoteProps: 'consistent',
  singleQuote: true,
  trailingComma: 'all',
  printWidth: 80,
  useTabs: false,
  bracketSpacing: true,
};



================================================
FILE: packages/email/.react-email/emails/magic-link.tsx
================================================
import Mail from '../../emails/magic-link.tsx';
export default Mail;



================================================
FILE: packages/email/.react-email/src/app/home.tsx
================================================
'use client';

import Link from 'next/link';
import { Button, Heading, Text } from '../components';
import { Shell } from '../components/shell';

export default function Home({ navItems }) {
  return (
    <Shell navItems={navItems}>
      <div className="max-w-md border border-slate-6 mx-auto mt-56 rounded-md p-8">
        <Heading as="h2" weight="medium">
          Welcome to the React Email preview!
        </Heading>
        <Text as="p" className="mt-2 mb-4">
          To start developing your next email template, you can create a{' '}
          <code>.jsx</code> or <code>.tsx</code> file under the "emails" folder.
        </Text>

        <Button asChild>
          <Link href="https://react.email/docs">Check the docs</Link>
        </Button>
      </div>
    </Shell>
  );
}



================================================
FILE: packages/email/.react-email/src/app/layout.tsx
================================================
import '../styles/globals.css';
import classnames from 'classnames';
import { Inter } from 'next/font/google';

export const inter = Inter({
  subsets: ['latin'],
  variable: '--font-inter',
});

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className="bg-black text-slate-12 font-sans">
        <div className={classnames(inter.variable, 'font-sans')}>
          {children}
        </div>
      </body>
    </html>
  );
}



================================================
FILE: packages/email/.react-email/src/app/page.tsx
================================================
import { getEmails } from '../utils/get-emails';
import Home from './home';

export default async function Index() {
  const { emails } = await getEmails();
  return <Home navItems={emails} />;
}

export const metadata = {
  title: 'React Email',
};



================================================
FILE: packages/email/.react-email/src/app/preview/[slug]/page.tsx
================================================
import { render } from '@react-email/render';
import { promises as fs } from 'fs';
import { dirname, join as pathJoin } from 'path';
import { CONTENT_DIR, getEmails } from '../../../utils/get-emails';
import Preview from './preview';

export const dynamicParams = true;

export async function generateStaticParams() {
  const { emails } = await getEmails();

  const paths = emails.map((email) => {
    return { slug: email };
  });

  return paths;
}

export default async function Page({ params }) {
  const { emails, filenames } = await getEmails();
  const template = filenames.filter((email) => {
    const [fileName] = email.split('.');
    return params.slug === fileName;
  });

  const Email = (await import(`../../../../emails/${params.slug}`)).default;
  const markup = render(<Email />, { pretty: true });
  const plainText = render(<Email />, { plainText: true });
  const basePath = pathJoin(process.cwd(), CONTENT_DIR);
  const path = pathJoin(basePath, template[0]);

  // the file is actually just re-exporting the default export of the original file. We need to resolve this first
  const exportTemplateFile: string = await fs.readFile(path, {
    encoding: 'utf-8',
  });
  const importPath = exportTemplateFile.match(/import Mail from '(.+)';/)![1];
  const originalFilePath = pathJoin(dirname(path), importPath);

  const reactMarkup: string = await fs.readFile(originalFilePath, {
    encoding: 'utf-8',
  });

  return (
    <Preview
      navItems={emails}
      slug={params.slug}
      markup={markup}
      reactMarkup={reactMarkup}
      plainText={plainText}
    />
  );
}

export async function generateMetadata({ params }) {
  return { title: `${params.slug} â€” React Email` };
}



================================================
FILE: packages/email/.react-email/src/app/preview/[slug]/preview.tsx
================================================
'use client';

import { usePathname, useRouter, useSearchParams } from 'next/navigation';
import React from 'react';
import { CodeContainer } from '../../../components/code-container';
import { Shell } from '../../../components/shell';
import { Tooltip } from '../../../components/tooltip';

export default function Preview({
  navItems,
  slug,
  markup,
  reactMarkup,
  plainText,
}) {
  const router = useRouter();
  const pathname = usePathname();
  const searchParams = useSearchParams();
  const [activeView, setActiveView] = React.useState('desktop');
  const [activeLang, setActiveLang] = React.useState('jsx');

  React.useEffect(() => {
    const view = searchParams.get('view');
    const lang = searchParams.get('lang');

    if (view === 'source' || view === 'desktop') {
      setActiveView(view);
    }

    if (lang === 'jsx' || lang === 'markup' || lang === 'markdown') {
      setActiveLang(lang);
    }
  }, [searchParams]);

  const handleViewChange = (view: string) => {
    setActiveView(view);
    router.push(`${pathname}?view=${view}`);
  };

  const handleLangChange = (lang: string) => {
    setActiveLang(lang);
    router.push(`${pathname}?view=source&lang=${lang}`);
  };

  return (
    <Shell
      navItems={navItems}
      title={slug}
      markup={markup}
      activeView={activeView}
      setActiveView={handleViewChange}
    >
      {activeView === 'desktop' ? (
        <iframe srcDoc={markup} className="w-full h-[calc(100vh_-_70px)]" />
      ) : (
        <div className="flex gap-6 mx-auto p-6 max-w-3xl">
          <Tooltip.Provider>
            <CodeContainer
              markups={[
                { language: 'jsx', content: reactMarkup },
                { language: 'markup', content: markup },
                { language: 'markdown', content: plainText },
              ]}
              activeLang={activeLang}
              setActiveLang={handleLangChange}
            />
          </Tooltip.Provider>
        </div>
      )}
    </Shell>
  );
}



================================================
FILE: packages/email/.react-email/src/components/button.tsx
================================================
import * as SlotPrimitive from '@radix-ui/react-slot';
import classnames from 'classnames';
import * as React from 'react';
import { unreachable } from '../utils';

type ButtonElement = React.ElementRef<'button'>;
type RootProps = React.ComponentPropsWithoutRef<'button'>;

type Appearance = 'white' | 'gradient';
type Size = '1' | '2' | '3' | '4';

interface ButtonProps extends RootProps {
  asChild?: boolean;
  appearance?: Appearance;
  size?: Size;
}

export const Button = React.forwardRef<ButtonElement, Readonly<ButtonProps>>(
  (
    {
      asChild,
      appearance = 'white',
      className,
      children,
      size = '2',
      ...props
    },
    forwardedRef,
  ) => {
    const classNames = classnames(
      getSize(size),
      getAppearance(appearance),
      'inline-flex items-center justify-center border font-medium',
      className,
    );

    return asChild ? (
      <SlotPrimitive.Slot ref={forwardedRef} {...props} className={classNames}>
        <SlotPrimitive.Slottable>{children}</SlotPrimitive.Slottable>
      </SlotPrimitive.Slot>
    ) : (
      <button ref={forwardedRef} className={classNames} {...props}>
        {children}
      </button>
    );
  },
);

Button.displayName = 'Button';

const getAppearance = (appearance: Appearance | undefined) => {
  switch (appearance) {
    case undefined:
    case 'white':
      return [
        'bg-white text-black',
        'hover:bg-white/90',
        'focus:ring-2 focus:ring-white/20 focus:outline-none focus:bg-white/90',
      ];
    case 'gradient':
      return [
        'bg-gradient backdrop-blur-[20px] border-[#34343A]',
        'hover:bg-gradientHover',
        'focus:ring-2 focus:ring-white/20 focus:outline-none focus:bg-gradientHover',
      ];
    default:
      unreachable(appearance);
  }
};

const getSize = (size: Size | undefined) => {
  switch (size) {
    case '1':
      return '';
    case undefined:
    case '2':
      return 'text-[14px] h-8 px-3 rounded-md gap-2';
    case '3':
      return 'text-[14px] h-10 px-4 rounded-md gap-2';
    case '4':
      return 'text-base h-11 px-4 rounded-md gap-2';
    default:
      unreachable(size);
  }
};



================================================
FILE: packages/email/.react-email/src/components/code-container.tsx
================================================
import { LayoutGroup, motion } from 'framer-motion';
import { Language } from 'prism-react-renderer';
import * as React from 'react';
import { copyTextToClipboard } from '../utils';
import languageMap from '../utils/language-map';
import { Code } from './code';
import { IconButton } from './icon-button';
import { IconCheck } from './icon-check';
import { IconClipboard } from './icon-clipboard';
import { IconDownload } from './icon-download';
import { Tooltip } from './tooltip';

interface CodeContainerProps {
  markups: MarkupProps[];
  activeLang: string;
  setActiveLang: (lang: string) => void;
}

interface MarkupProps {
  language: Language;
  content: string;
}

export const CodeContainer: React.FC<Readonly<CodeContainerProps>> = ({
  markups,
  activeLang,
  setActiveLang,
}) => {
  const [isCopied, setIsCopied] = React.useState(false);

  const renderDownloadIcon = () => {
    let value = markups.filter((markup) => markup.language === activeLang);
    const file = new File([value[0].content], `email.${value[0].language}`);
    const url = URL.createObjectURL(file);

    return (
      <a
        href={url}
        download={file.name}
        className="text-slate-11 transition ease-in-out duration-200 hover:text-slate-12"
      >
        <IconDownload />
      </a>
    );
  };

  const renderClipboardIcon = () => {
    const handleClipboard = async () => {
      const activeContent = markups.filter(({ language }) => {
        return activeLang === language;
      });
      setIsCopied(true);
      await copyTextToClipboard(activeContent[0].content);
      setTimeout(() => setIsCopied(false), 3000);
    };

    return (
      <IconButton onClick={handleClipboard}>
        {isCopied ? <IconCheck /> : <IconClipboard />}
      </IconButton>
    );
  };

  React.useEffect(() => {
    setIsCopied(false);
  }, [activeLang]);

  return (
    <pre
      className={
        'border-slate-6 relative w-full items-center whitespace-pre rounded-md border text-sm backdrop-blur-md'
      }
      style={{
        lineHeight: '130%',
        background:
          'linear-gradient(145.37deg, rgba(255, 255, 255, 0.09) -8.75%, rgba(255, 255, 255, 0.027) 83.95%)',
        boxShadow: 'rgb(0 0 0 / 10%) 0px 5px 30px -5px',
      }}
    >
      <div className="h-9 border-b border-slate-6">
        <div className="flex">
          <LayoutGroup id="code">
            {markups.map(({ language }) => {
              const isCurrentLang = activeLang === language;
              return (
                <motion.button
                  className={`relative py-[8px] px-4 text-sm font-medium font-sans transition ease-in-out duration-200 hover:text-slate-12 ${
                    activeLang !== language ? 'text-slate-11' : 'text-slate-12'
                  }`}
                  onClick={() => setActiveLang(language)}
                  key={language}
                >
                  {isCurrentLang && (
                    <motion.span
                      layoutId="code"
                      className="absolute left-0 right-0 top-0 bottom-0 bg-slate-4"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      exit={{ opacity: 0 }}
                    />
                  )}
                  {languageMap[language]}
                </motion.button>
              );
            })}
          </LayoutGroup>
        </div>
        <Tooltip>
          <Tooltip.Trigger className="absolute top-2 right-2 hidden md:block">
            {renderClipboardIcon()}
          </Tooltip.Trigger>
          <Tooltip.Content>Copy to Clipboard</Tooltip.Content>
        </Tooltip>
        <Tooltip>
          <Tooltip.Trigger className="text-gray-11 absolute top-2 right-8 hidden md:block">
            {renderDownloadIcon()}
          </Tooltip.Trigger>
          <Tooltip.Content>Download</Tooltip.Content>
        </Tooltip>
      </div>
      {markups.map(({ language, content }) => {
        return (
          <div
            className={`${activeLang !== language && 'hidden'}`}
            key={language}
          >
            <Code language={language}>{content}</Code>
          </div>
        );
      })}
    </pre>
  );
};



================================================
FILE: packages/email/.react-email/src/components/code.tsx
================================================
import classnames from 'classnames';
import Highlight, { defaultProps, Language } from 'prism-react-renderer';
import * as React from 'react';

interface CodeProps {
  children: any;
  className?: string;
  language?: Language;
}

const theme = {
  plain: {
    color: '#EDEDEF',
    fontSize: 13,
    fontFamily: 'MonoLisa, Menlo, monospace',
  },
  styles: [
    {
      types: ['comment'],
      style: {
        color: '#706F78',
      },
    },
    {
      types: ['atrule', 'keyword', 'attr-name', 'selector'],
      style: {
        color: '#7E7D86',
      },
    },
    {
      types: ['punctuation', 'operator'],
      style: {
        color: '#706F78',
      },
    },
    {
      types: ['class-name', 'function', 'tag', 'key-white'],
      style: {
        color: '#EDEDEF',
      },
    },
  ],
};

export const Code: React.FC<Readonly<CodeProps>> = ({
  children,
  language = 'html',
}) => {
  const [isCopied, setIsCopied] = React.useState(false);
  const value = children.trim();

  const file = new File([value], `email.${language}`);
  const url = URL.createObjectURL(file);

  return (
    <Highlight
      {...defaultProps}
      theme={theme}
      code={value}
      language={language as Language}
    >
      {({ tokens, getLineProps, getTokenProps }) => (
        <>
          <div
            className="absolute right-0 top-0 h-px w-[200px]"
            style={{
              background:
                'linear-gradient(90deg, rgba(56, 189, 248, 0) 0%, rgba(56, 189, 248, 0) 0%, rgba(232, 232, 232, 0.2) 33.02%, rgba(143, 143, 143, 0.6719) 64.41%, rgba(236, 72, 153, 0) 98.93%)',
            }}
          />
          <div className="p-4 h-[650px] overflow-auto">
            {tokens.map((line, i) => {
              return (
                <div
                  key={i}
                  {...getLineProps({ line, key: i })}
                  className={classnames('whitespace-pre', {
                    "before:text-slate-11 before:mr-2 before:content-['$']":
                      language === 'bash' && tokens && tokens.length === 1,
                  })}
                >
                  {line.map((token, key) => {
                    const isException =
                      token.content === 'from' &&
                      line[key + 1]?.content === ':';
                    const newTypes = isException
                      ? [...token.types, 'key-white']
                      : token.types;
                    token.types = newTypes;

                    return (
                      <React.Fragment key={key}>
                        <span {...getTokenProps({ token, key })} />
                      </React.Fragment>
                    );
                  })}
                </div>
              );
            })}
          </div>
          <div
            className="absolute left-0 bottom-0 h-px w-[200px]"
            style={{
              background:
                'linear-gradient(90deg, rgba(56, 189, 248, 0) 0%, rgba(56, 189, 248, 0) 0%, rgba(232, 232, 232, 0.2) 33.02%, rgba(143, 143, 143, 0.6719) 64.41%, rgba(236, 72, 153, 0) 98.93%)',
            }}
          />
        </>
      )}
    </Highlight>
  );
};



================================================
FILE: packages/email/.react-email/src/components/heading.tsx
================================================
import * as SlotPrimitive from '@radix-ui/react-slot';
import classnames from 'classnames';
import * as React from 'react';
import { As, unreachable } from '../utils';

export type HeadingSize =
  | '1'
  | '2'
  | '3'
  | '4'
  | '5'
  | '6'
  | '7'
  | '8'
  | '9'
  | '10';
export type HeadingColor = 'white' | 'gray';
export type HeadingWeight = 'medium' | 'bold';

interface HeadingOwnProps {
  size?: HeadingSize;
  color?: HeadingColor;
  weight?: HeadingWeight;
}

type HeadingProps = As<'h1', 'h2', 'h3', 'h4', 'h5', 'h6'> & HeadingOwnProps;

export const Heading = React.forwardRef<
  HTMLHeadingElement,
  Readonly<HeadingProps>
>(
  (
    {
      as: Tag = 'h1',
      size = '3',
      className,
      color = 'white',
      children,
      weight = 'bold',
      ...props
    },
    forwardedRef,
  ) => (
    <SlotPrimitive.Slot
      ref={forwardedRef}
      className={classnames(
        className,
        getSizesClassNames(size),
        getColorClassNames(color),
        getWeightClassNames(weight),
      )}
      {...props}
    >
      <Tag>{children}</Tag>
    </SlotPrimitive.Slot>
  ),
);

const getSizesClassNames = (size: HeadingSize | undefined) => {
  switch (size) {
    case '1':
      return 'text-xs';
    case '2':
      return 'text-sm';
    case undefined:
    case '3':
      return 'text-base';
    case '4':
      return 'text-lg';
    case '5':
      return 'text-xl tracking-[-0.16px]';
    case '6':
      return 'text-2xl tracking-[-0.288px]';
    case '7':
      return 'text-[28px] leading-[34px] tracking-[-0.416px]';
    case '8':
      return 'text-[35px] leading-[42px] tracking-[-0.64px]';
    case '9':
      return 'text-6xl leading-[73px] tracking-[-0.896px]';
    case '10':
      return [
        'text-[38px] leading-[46px]',
        'md:text-[70px] md:leading-[85px] tracking-[-1.024px;]',
      ];
    default:
      return unreachable(size);
  }
};

const getColorClassNames = (color: HeadingColor | undefined) => {
  switch (color) {
    case 'gray':
      return 'text-slate-11';
    case 'white':
    case undefined:
      return 'text-slate-12';
    default:
      return unreachable(color);
  }
};

const getWeightClassNames = (weight: HeadingWeight | undefined) => {
  switch (weight) {
    case 'medium':
      return 'font-medium';
    case 'bold':
    case undefined:
      return 'font-bold';
    default:
      return unreachable(weight);
  }
};

Heading.displayName = 'Heading';



================================================
FILE: packages/email/.react-email/src/components/icon-base.tsx
================================================
import * as React from 'react';

export interface IconProps {
  size?: number;
}

export type IconElement = React.ElementRef<'svg'>;
export type RootProps = React.ComponentPropsWithoutRef<'svg'>;

export interface IconProps extends RootProps {}

export const IconBase = React.forwardRef<IconElement, Readonly<IconProps>>(
  ({ size = 20, ...props }, forwardedRef) => (
    <svg
      ref={forwardedRef}
      width={size}
      height={size}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      {...props}
    />
  ),
);

IconBase.displayName = 'IconBase';



================================================
FILE: packages/email/.react-email/src/components/icon-button.tsx
================================================
import classnames from 'classnames';
import * as React from 'react';

export interface IconButtonProps
  extends React.ComponentPropsWithoutRef<'button'> {}

export const IconButton = React.forwardRef<
  HTMLButtonElement,
  Readonly<IconButtonProps>
>(({ children, className, ...props }, forwardedRef) => (
  <button
    {...props}
    ref={forwardedRef}
    className={classnames(
      'rounded text-slate-11 focus:text-slate-12 ease-in-out transition duration-200 focus:outline-none focus:ring-2 focus:ring-gray-8 hover:text-slate-12',
      className,
    )}
  >
    {children}
  </button>
));

IconButton.displayName = 'IconButton';



================================================
FILE: packages/email/.react-email/src/components/icon-check.tsx
================================================
import * as React from 'react';
import { IconBase, IconElement, IconProps } from './icon-base';

export const IconCheck = React.forwardRef<IconElement, Readonly<IconProps>>(
  ({ ...props }, forwardedRef) => (
    <IconBase ref={forwardedRef} {...props}>
      <path
        d="M16.25 8.75L10.406 15.25L7.75 12.75"
        stroke="currentColor"
        strokeWidth="1.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </IconBase>
  ),
);

IconCheck.displayName = 'IconCheck';



================================================
FILE: packages/email/.react-email/src/components/icon-clipboard.tsx
================================================
import * as React from 'react';
import { IconBase, IconElement, IconProps } from './icon-base';

export const IconClipboard = React.forwardRef<IconElement, Readonly<IconProps>>(
  ({ ...props }, forwardedRef) => (
    <IconBase ref={forwardedRef} {...props}>
      <path
        d="M9 6.75H7.75C6.64543 6.75 5.75 7.64543 5.75 8.75V17.25C5.75 18.3546 6.64543 19.25 7.75 19.25H16.25C17.3546 19.25 18.25 18.3546 18.25 17.25V8.75C18.25 7.64543 17.3546 6.75 16.25 6.75H15"
        stroke="currentColor"
        strokeWidth="1.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M14 8.25H10C9.44772 8.25 9 7.80228 9 7.25V5.75C9 5.19772 9.44772 4.75 10 4.75H14C14.5523 4.75 15 5.19772 15 5.75V7.25C15 7.80228 14.5523 8.25 14 8.25Z"
        stroke="currentColor"
        strokeWidth="1.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M9.75 12.25H14.25"
        stroke="currentColor"
        strokeWidth="1.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M9.75 15.25H14.25"
        stroke="currentColor"
        strokeWidth="1.5"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </IconBase>
  ),
);

IconClipboard.displayName = 'IconClipboard';



================================================
FILE: packages/email/.react-email/src/components/icon-download.tsx
================================================
import * as React from 'react';
import { IconBase, IconElement, IconProps } from './icon-base';

export const IconDownload = React.forwardRef<IconElement, Readonly<IconProps>>(
  ({ ...props }, forwardedRef) => (
    <IconBase ref={forwardedRef} {...props}>
      <path
        d="M4.75 14.75v1.5a3 3 0 0 0 3 3h8.5a3 3 0 0 0 3-3v-1.5M12 14.25v-9.5M8.75 10.75l3.25 3.5 3.25-3.5"
        stroke="currentColor"
        strokeWidth={1.5}
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </IconBase>
  ),
);

IconDownload.displayName = 'IconDownload';



================================================
FILE: packages/email/.react-email/src/components/index.ts
================================================
export * from './button';
export * from './code';
export * from './heading';
export * from './logo';
export * from './sidebar';
export * from './text';
export * from './topbar';



================================================
FILE: packages/email/.react-email/src/components/logo.tsx
================================================
import * as React from 'react';

type LogoElement = React.ElementRef<'svg'>;
type RootProps = React.ComponentPropsWithoutRef<'svg'>;

export const Logo = React.forwardRef<LogoElement, Readonly<RootProps>>(
  ({ ...props }, forwardedRef) => (
    <svg
      width="119"
      height="32"
      viewBox="0 0 119 32"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g clipPath="url(#clip0_27_291)">
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M24.4558 24.4853C25.2339 23.7073 25.3805 22.6549 25.2947 21.746C25.2078 20.8254 24.8697 19.8258 24.3896 18.8287C23.957 17.9302 23.3802 16.9745 22.6821 16C23.3802 15.0255 23.957 14.0698 24.3896 13.1713C24.8697 12.1742 25.2078 11.1746 25.2947 10.254C25.3805 9.34508 25.2339 8.29273 24.4558 7.51472C23.6778 6.73671 22.6255 6.59004 21.7165 6.67584C20.796 6.76273 19.7964 7.10086 18.7993 7.58094C17.9007 8.01357 16.945 8.59036 15.9706 9.28842C14.9961 8.59036 14.0404 8.01357 13.1418 7.58094C12.1447 7.10086 11.1451 6.76273 10.2246 6.67584C9.31564 6.59004 8.26329 6.73671 7.48528 7.51472C6.70727 8.29273 6.5606 9.34508 6.6464 10.254C6.7333 11.1746 7.07142 12.1742 7.5515 13.1713C7.98414 14.0698 8.56092 15.0255 9.25898 16C8.56092 16.9745 7.98414 17.9302 7.5515 18.8287C7.07142 19.8258 6.7333 20.8254 6.6464 21.746C6.5606 22.6549 6.70727 23.7073 7.48528 24.4853C8.26329 25.2633 9.31564 25.41 10.2246 25.3242C11.1451 25.2373 12.1447 24.8991 13.1418 24.4191C14.0404 23.9864 14.9961 23.4096 15.9706 22.7116C16.945 23.4096 17.9007 23.9864 18.7993 24.4191C19.7964 24.8991 20.796 25.2373 21.7165 25.3242C22.6255 25.41 23.6778 25.2633 24.4558 24.4853ZM15.9706 20.948C16.8399 20.2684 17.724 19.4874 18.591 18.6205C19.458 17.7535 20.239 16.8693 20.9186 16C20.239 15.1307 19.458 14.2465 18.591 13.3795C17.724 12.5126 16.8399 11.7316 15.9706 11.052C15.1012 11.7316 14.2171 12.5126 13.3501 13.3795C12.4831 14.2465 11.7021 15.1307 11.0225 16C11.7021 16.8693 12.4831 17.7535 13.3501 18.6205C14.2171 19.4874 15.1012 20.2684 15.9706 20.948ZM17.1498 21.8145C17.968 21.1558 18.7885 20.4195 19.5893 19.6187C20.39 18.818 21.1264 17.9974 21.7851 17.1792C23.7187 19.9919 24.4627 22.4819 23.4576 23.487C22.4524 24.4922 19.9625 23.7482 17.1498 21.8145ZM10.156 17.1792C10.8148 17.9974 11.5511 18.818 12.3518 19.6187C13.1526 20.4195 13.9731 21.1558 14.7914 21.8145C11.9786 23.7482 9.48871 24.4922 8.48355 23.487C7.47839 22.4819 8.22238 19.9919 10.156 17.1792ZM10.156 14.8208C10.8148 14.0026 11.5511 13.182 12.3518 12.3813C13.1526 11.5805 13.9731 10.8442 14.7914 10.1855C11.9786 8.25182 9.48871 7.50783 8.48355 8.51299C7.47839 9.51815 8.22238 12.0081 10.156 14.8208ZM17.1498 10.1855C17.968 10.8442 18.7885 11.5805 19.5893 12.3813C20.39 13.182 21.1264 14.0026 21.7851 14.8208C23.7187 12.0081 24.4627 9.51815 23.4576 8.51299C22.4524 7.50783 19.9625 8.25182 17.1498 10.1855Z"
          fill="white"
          stroke="white"
          strokeWidth="0.5"
        />
      </g>
      <path
        d="M36 22.176V13.744H37.936L37.968 16.432L37.696 15.824C37.8133 15.3973 38.016 15.0133 38.304 14.672C38.592 14.3307 38.9227 14.064 39.296 13.872C39.68 13.6693 40.08 13.568 40.496 13.568C40.6773 13.568 40.848 13.584 41.008 13.616C41.1787 13.648 41.3173 13.6853 41.424 13.728L40.896 15.888C40.7787 15.824 40.6347 15.7707 40.464 15.728C40.2933 15.6853 40.1227 15.664 39.952 15.664C39.6853 15.664 39.4293 15.7173 39.184 15.824C38.9493 15.92 38.7413 16.0587 38.56 16.24C38.3787 16.4213 38.2347 16.6347 38.128 16.88C38.032 17.1147 37.984 17.3813 37.984 17.68V22.176H36Z"
        fill="white"
      />
      <path
        d="M45.907 22.336C45.0217 22.336 44.2377 22.1493 43.555 21.776C42.883 21.4027 42.355 20.896 41.971 20.256C41.5977 19.6053 41.411 18.864 41.411 18.032C41.411 17.3707 41.5177 16.768 41.731 16.224C41.9443 15.68 42.2377 15.2107 42.611 14.816C42.995 14.4107 43.4483 14.1013 43.971 13.888C44.5043 13.664 45.0857 13.552 45.715 13.552C46.2697 13.552 46.787 13.6587 47.267 13.872C47.747 14.0853 48.163 14.3787 48.515 14.752C48.867 15.1147 49.1337 15.552 49.315 16.064C49.507 16.5653 49.5977 17.1147 49.587 17.712L49.571 18.4H42.739L42.371 17.056H47.923L47.667 17.328V16.976C47.635 16.6453 47.5283 16.3573 47.347 16.112C47.1657 15.856 46.931 15.6587 46.643 15.52C46.3657 15.3707 46.0563 15.296 45.715 15.296C45.1923 15.296 44.7497 15.3973 44.387 15.6C44.035 15.8027 43.7683 16.096 43.587 16.48C43.4057 16.8533 43.315 17.3227 43.315 17.888C43.315 18.432 43.427 18.9067 43.651 19.312C43.8857 19.7173 44.211 20.032 44.627 20.256C45.0537 20.4693 45.5497 20.576 46.115 20.576C46.5097 20.576 46.8723 20.512 47.203 20.384C47.5337 20.256 47.891 20.0267 48.275 19.696L49.251 21.056C48.963 21.3227 48.6323 21.552 48.259 21.744C47.8963 21.9253 47.5123 22.0693 47.107 22.176C46.7017 22.2827 46.3017 22.336 45.907 22.336Z"
        fill="white"
      />
      <path
        d="M54.094 22.336C53.4007 22.336 52.7713 22.144 52.206 21.76C51.6407 21.376 51.1873 20.8533 50.846 20.192C50.5047 19.5307 50.334 18.7787 50.334 17.936C50.334 17.0933 50.5047 16.3413 50.846 15.68C51.1873 15.0187 51.6513 14.5013 52.238 14.128C52.8247 13.7547 53.486 13.568 54.222 13.568C54.6487 13.568 55.038 13.632 55.39 13.76C55.742 13.8773 56.0513 14.048 56.318 14.272C56.5847 14.496 56.8033 14.752 56.974 15.04C57.1553 15.328 57.278 15.6373 57.342 15.968L56.91 15.856V13.744H58.894V22.176H56.894V20.16L57.358 20.08C57.2833 20.368 57.1447 20.6507 56.942 20.928C56.75 21.1947 56.5047 21.4347 56.206 21.648C55.918 21.8507 55.5927 22.016 55.23 22.144C54.878 22.272 54.4993 22.336 54.094 22.336ZM54.638 20.592C55.0967 20.592 55.502 20.48 55.854 20.256C56.206 20.032 56.478 19.7227 56.67 19.328C56.8727 18.9227 56.974 18.4587 56.974 17.936C56.974 17.424 56.8727 16.9707 56.67 16.576C56.478 16.1813 56.206 15.872 55.854 15.648C55.502 15.424 55.0967 15.312 54.638 15.312C54.1793 15.312 53.774 15.424 53.422 15.648C53.0807 15.872 52.814 16.1813 52.622 16.576C52.43 16.9707 52.334 17.424 52.334 17.936C52.334 18.4587 52.43 18.9227 52.622 19.328C52.814 19.7227 53.0807 20.032 53.422 20.256C53.774 20.48 54.1793 20.592 54.638 20.592Z"
        fill="white"
      />
      <path
        d="M64.3716 22.336C63.5823 22.336 62.873 22.144 62.2436 21.76C61.6143 21.376 61.1183 20.8533 60.7556 20.192C60.393 19.5307 60.2116 18.784 60.2116 17.952C60.2116 17.12 60.393 16.3733 60.7556 15.712C61.1183 15.0507 61.6143 14.528 62.2436 14.144C62.873 13.76 63.5823 13.568 64.3716 13.568C65.129 13.568 65.817 13.712 66.4356 14C67.0543 14.288 67.5343 14.688 67.8756 15.2L66.7876 16.512C66.6276 16.288 66.425 16.0853 66.1796 15.904C65.9343 15.7227 65.673 15.5787 65.3956 15.472C65.1183 15.3653 64.841 15.312 64.5636 15.312C64.0943 15.312 63.673 15.4293 63.2996 15.664C62.937 15.888 62.649 16.2027 62.4356 16.608C62.2223 17.0027 62.1156 17.4507 62.1156 17.952C62.1156 18.4533 62.2223 18.9013 62.4356 19.296C62.6596 19.6907 62.9583 20.0053 63.3316 20.24C63.705 20.4747 64.121 20.592 64.5796 20.592C64.857 20.592 65.1236 20.5493 65.3796 20.464C65.6463 20.368 65.897 20.2347 66.1316 20.064C66.3663 19.8933 66.585 19.68 66.7876 19.424L67.8756 20.752C67.513 21.2213 67.0116 21.6053 66.3716 21.904C65.7423 22.192 65.0756 22.336 64.3716 22.336Z"
        fill="white"
      />
      <path
        d="M69.8726 22.176V11.6H71.8406V22.176H69.8726ZM68.2086 15.568V13.744H73.6806V15.568H68.2086Z"
        fill="white"
      />
      <path
        d="M82.9945 22.336C82.1092 22.336 81.3252 22.1493 80.6425 21.776C79.9705 21.4027 79.4425 20.896 79.0585 20.256C78.6852 19.6053 78.4985 18.864 78.4985 18.032C78.4985 17.3707 78.6052 16.768 78.8185 16.224C79.0318 15.68 79.3252 15.2107 79.6985 14.816C80.0825 14.4107 80.5358 14.1013 81.0585 13.888C81.5918 13.664 82.1732 13.552 82.8025 13.552C83.3572 13.552 83.8745 13.6587 84.3545 13.872C84.8345 14.0853 85.2505 14.3787 85.6025 14.752C85.9545 15.1147 86.2212 15.552 86.4025 16.064C86.5945 16.5653 86.6852 17.1147 86.6745 17.712L86.6585 18.4H79.8265L79.4585 17.056H85.0105L84.7545 17.328V16.976C84.7225 16.6453 84.6158 16.3573 84.4345 16.112C84.2532 15.856 84.0185 15.6587 83.7305 15.52C83.4532 15.3707 83.1438 15.296 82.8025 15.296C82.2798 15.296 81.8372 15.3973 81.4745 15.6C81.1225 15.8027 80.8558 16.096 80.6745 16.48C80.4932 16.8533 80.4025 17.3227 80.4025 17.888C80.4025 18.432 80.5145 18.9067 80.7385 19.312C80.9732 19.7173 81.2985 20.032 81.7145 20.256C82.1412 20.4693 82.6372 20.576 83.2025 20.576C83.5972 20.576 83.9598 20.512 84.2905 20.384C84.6212 20.256 84.9785 20.0267 85.3625 19.696L86.3385 21.056C86.0505 21.3227 85.7198 21.552 85.3465 21.744C84.9838 21.9253 84.5998 22.0693 84.1945 22.176C83.7892 22.2827 83.3892 22.336 82.9945 22.336Z"
        fill="white"
      />
      <path
        d="M87.9655 22.176V13.744H89.9015L89.9335 15.44L89.6135 15.568C89.7095 15.2907 89.8535 15.0347 90.0455 14.8C90.2375 14.5547 90.4668 14.3467 90.7335 14.176C91.0002 13.9947 91.2828 13.856 91.5815 13.76C91.8802 13.6533 92.1842 13.6 92.4935 13.6C92.9522 13.6 93.3575 13.6747 93.7095 13.824C94.0722 13.9627 94.3708 14.1867 94.6055 14.496C94.8508 14.8053 95.0322 15.2 95.1495 15.68L94.8455 15.616L94.9735 15.36C95.0908 15.104 95.2562 14.8747 95.4695 14.672C95.6828 14.4587 95.9228 14.272 96.1895 14.112C96.4562 13.9413 96.7335 13.8133 97.0215 13.728C97.3202 13.6427 97.6135 13.6 97.9015 13.6C98.5415 13.6 99.0748 13.728 99.5015 13.984C99.9282 14.24 100.248 14.6293 100.462 15.152C100.675 15.6747 100.782 16.32 100.782 17.088V22.176H98.7975V17.216C98.7975 16.7893 98.7388 16.4373 98.6215 16.16C98.5148 15.8827 98.3442 15.68 98.1095 15.552C97.8855 15.4133 97.6028 15.344 97.2615 15.344C96.9948 15.344 96.7388 15.392 96.4935 15.488C96.2588 15.5733 96.0562 15.7013 95.8855 15.872C95.7148 16.032 95.5815 16.2187 95.4855 16.432C95.3895 16.6453 95.3415 16.88 95.3415 17.136V22.176H93.3575V17.2C93.3575 16.7947 93.2988 16.4587 93.1815 16.192C93.0642 15.9147 92.8935 15.7067 92.6695 15.568C92.4455 15.4187 92.1735 15.344 91.8535 15.344C91.5868 15.344 91.3362 15.392 91.1015 15.488C90.8668 15.5733 90.6642 15.696 90.4935 15.856C90.3228 16.016 90.1895 16.2027 90.0935 16.416C89.9975 16.6293 89.9495 16.864 89.9495 17.12V22.176H87.9655Z"
        fill="white"
      />
      <path
        d="M105.73 22.336C105.037 22.336 104.408 22.144 103.842 21.76C103.277 21.376 102.824 20.8533 102.482 20.192C102.141 19.5307 101.97 18.7787 101.97 17.936C101.97 17.0933 102.141 16.3413 102.482 15.68C102.824 15.0187 103.288 14.5013 103.874 14.128C104.461 13.7547 105.122 13.568 105.858 13.568C106.285 13.568 106.674 13.632 107.026 13.76C107.378 13.8773 107.688 14.048 107.954 14.272C108.221 14.496 108.44 14.752 108.61 15.04C108.792 15.328 108.914 15.6373 108.978 15.968L108.546 15.856V13.744H110.53V22.176H108.53V20.16L108.994 20.08C108.92 20.368 108.781 20.6507 108.578 20.928C108.386 21.1947 108.141 21.4347 107.842 21.648C107.554 21.8507 107.229 22.016 106.866 22.144C106.514 22.272 106.136 22.336 105.73 22.336ZM106.274 20.592C106.733 20.592 107.138 20.48 107.49 20.256C107.842 20.032 108.114 19.7227 108.306 19.328C108.509 18.9227 108.61 18.4587 108.61 17.936C108.61 17.424 108.509 16.9707 108.306 16.576C108.114 16.1813 107.842 15.872 107.49 15.648C107.138 15.424 106.733 15.312 106.274 15.312C105.816 15.312 105.41 15.424 105.058 15.648C104.717 15.872 104.45 16.1813 104.258 16.576C104.066 16.9707 103.97 17.424 103.97 17.936C103.97 18.4587 104.066 18.9227 104.258 19.328C104.45 19.7227 104.717 20.032 105.058 20.256C105.41 20.48 105.816 20.592 106.274 20.592Z"
        fill="white"
      />
      <path
        d="M112.616 22.176V13.744H114.584V22.176H112.616ZM113.576 11.952C113.181 11.952 112.872 11.856 112.648 11.664C112.435 11.4613 112.328 11.1787 112.328 10.816C112.328 10.4747 112.44 10.1973 112.664 9.984C112.888 9.77067 113.192 9.664 113.576 9.664C113.981 9.664 114.291 9.76534 114.504 9.968C114.728 10.16 114.84 10.4427 114.84 10.816C114.84 11.1467 114.728 11.4187 114.504 11.632C114.28 11.8453 113.971 11.952 113.576 11.952Z"
        fill="white"
      />
      <path d="M116.675 22.176V10.336H118.659V22.176H116.675Z" fill="white" />
      <defs>
        <clipPath id="clip0_27_291">
          <rect width="32" height="32" rx="8" fill="white" />
        </clipPath>
      </defs>
    </svg>
  ),
);

Logo.displayName = 'Logo';



================================================
FILE: packages/email/.react-email/src/components/send.tsx
================================================
import * as Popover from '@radix-ui/react-popover';
import * as React from 'react';
import { inter } from '../app/layout';
import { Button } from './button';
import { Text } from './text';

export const Send = ({ markup }: { markup: string }) => {
  const [to, setTo] = React.useState('');
  const [subject, setSubject] = React.useState('Testing React Email');
  const [isSending, setIsSending] = React.useState(false);

  const onFormSubmit = async (e: React.FormEvent) => {
    try {
      e.preventDefault();
      setIsSending(true);

      const response = await fetch('https://react.email/api/send/test', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          to,
          subject,
          html: markup,
        }),
      });

      if (response.status === 429) {
        const { error } = await response.json();
        alert(error);
      }
    } catch (e) {
      alert('Something went wrong. Please try again.');
    } finally {
      setIsSending(false);
    }
  };

  return (
    <Popover.Root>
      <Popover.Trigger asChild>
        <button className="box-border outline-none self-center w-20 h-5 flex items-center justify-center rounded-lg text-center transition duration-300 ease-in-out border border-slate-6 text-slate-11 text-sm px-4 py-4 hover:border-slate-12 hover:text-slate-12 font-sans">
          Send
        </button>
      </Popover.Trigger>
      <Popover.Anchor />
      <Popover.Portal>
        <Popover.Content
          align="end"
          className={`w-80 -mt-10 p-3 bg-black border border-slate-6 text-slate-11 rounded-lg font-sans ${inter.variable}`}
        >
          <Popover.Close
            aria-label="Close"
            className="absolute right-2 flex items-center justify-center w-6 h-6 text-xs text-slate-11 hover:text-slate-12 transition duration-300 ease-in-out rounded-full"
          >
            âœ•
          </Popover.Close>
          <form onSubmit={onFormSubmit} className="mt-1">
            <label
              htmlFor="to"
              className="text-slate-10 text-xs uppercase mb-2 block"
            >
              Recipient
            </label>
            <input
              autoFocus={true}
              className="appearance-none rounded-lg px-2 py-1 mb-3 outline-none w-full bg-slate-3 border placeholder-slate-8 border-slate-6 text-slate-12 text-sm focus:ring-1 focus:ring-slate-12 transition duration-300 ease-in-out"
              onChange={(e) => setTo(e.target.value)}
              defaultValue={to}
              placeholder="you@example.com"
              type="email"
              id="to"
              required
            />
            <label
              htmlFor="subject"
              className="text-slate-10 text-xs uppercase mb-2 block"
            >
              Subject
            </label>
            <input
              className="appearance-none rounded-lg px-2 py-1 mb-3 outline-none w-full bg-slate-3 border placeholder-slate-8 border-slate-6 text-slate-12 text-sm focus:ring-1 focus:ring-slate-12 transition duration-300 ease-in-out"
              onChange={(e) => setSubject(e.target.value)}
              defaultValue={subject}
              placeholder="My Email"
              type="text"
              id="subject"
              required
            />
            <input
              type="checkbox"
              className="appearance-none checked:bg-blue-500"
            />
            <div className="flex items-center justify-between">
              <Text className="inline-block" size="1">
                Powered by{' '}
                <a
                  className="hover:text-slate-12 transition ease-in-out duration-300"
                  href="https://resend.com"
                  target="_blank"
                  rel="noreferrer"
                >
                  Resend
                </a>
              </Text>
              <Button
                type="submit"
                disabled={subject.length === 0 || to.length === 0 || isSending}
                className="disabled:bg-slate-11 disabled:border-transparent"
              >
                Send
              </Button>
            </div>
          </form>
        </Popover.Content>
      </Popover.Portal>
    </Popover.Root>
  );
};



================================================
FILE: packages/email/.react-email/src/components/shell.tsx
================================================
import * as React from 'react';
import { Sidebar } from './sidebar';
import { Topbar } from './topbar';

type ShellElement = React.ElementRef<'div'>;
type RootProps = React.ComponentPropsWithoutRef<'div'>;

interface ShellProps extends RootProps {
  navItems: string[];
  markup?: string;
  activeView?: string;
  setActiveView?: (view: string) => void;
}

export const Shell = React.forwardRef<ShellElement, Readonly<ShellProps>>(
  (
    { title, navItems, children, markup, activeView, setActiveView },
    forwardedRef,
  ) => {
    return (
      <div ref={forwardedRef} className="flex justify-between h-screen">
        <Sidebar navItems={navItems} title={title} />
        <main className="w-[calc(100%_-_275px)] bg-slate-2">
          {title && (
            <Topbar
              title={title}
              activeView={activeView}
              setActiveView={setActiveView}
              markup={markup}
            />
          )}
          <div className="relative h-[calc(100vh_-_70px)] overflow-auto">
            <div className="mx-auto">{children}</div>
          </div>
        </main>
      </div>
    );
  },
);

Shell.displayName = 'Shell';



================================================
FILE: packages/email/.react-email/src/components/sidebar.tsx
================================================
import * as Collapsible from '@radix-ui/react-collapsible';
import classnames from 'classnames';
import { LayoutGroup, motion } from 'framer-motion';
import Link from 'next/link';
import * as React from 'react';
import { Heading } from './heading';
import { Logo } from './logo';

type SidebarElement = React.ElementRef<'aside'>;
type RootProps = React.ComponentPropsWithoutRef<'aside'>;

interface SidebarProps extends RootProps {
  navItems: string[];
  title?: string;
}

export const Sidebar = React.forwardRef<SidebarElement, Readonly<SidebarProps>>(
  ({ className, navItems, title, ...props }, forwardedRef) => {
    return (
      <aside
        ref={forwardedRef}
        className="px-6 min-w-[275px] max-w-[275px] flex flex-col gap-4 border-r border-slate-6"
        {...props}
      >
        <div className="h-[70px] flex items-center">
          <Logo />
        </div>

        <nav className="flex flex-col gap-4">
          <Collapsible.Root defaultOpen>
            <Collapsible.Trigger
              className={classnames('flex items-center gap-1', {
                'cursor-default': navItems && navItems.length === 0,
              })}
            >
              <svg
                className="text-slate-11"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M19.25 17.25V9.75C19.25 8.64543 18.3546 7.75 17.25 7.75H4.75V17.25C4.75 18.3546 5.64543 19.25 6.75 19.25H17.25C18.3546 19.25 19.25 18.3546 19.25 17.25Z"
                  stroke="currentColor"
                  strokeWidth="1.5"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
                <path
                  d="M13.5 7.5L12.5685 5.7923C12.2181 5.14977 11.5446 4.75 10.8127 4.75H6.75C5.64543 4.75 4.75 5.64543 4.75 6.75V11"
                  stroke="currentColor"
                  strokeWidth="1.5"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
              </svg>

              <div className="flex items-center text-slate-11 transition ease-in-out duration-200 hover:text-slate-12">
                <Heading
                  as="h3"
                  color="gray"
                  size="2"
                  weight="medium"
                  className="transition ease-in-out duration-200 hover:text-slate-12"
                >
                  All emails
                </Heading>
                {navItems && navItems.length > 0 && (
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M12 15L8.5359 9.75L15.4641 9.75L12 15Z"
                      fill="currentColor"
                    />
                  </svg>
                )}
              </div>
            </Collapsible.Trigger>

            {navItems && navItems.length > 0 && (
              <Collapsible.Content className="relative mt-3">
                <div className="absolute left-2.5  w-px h-full bg-slate-6" />

                <div className="py-2 flex flex-col truncate">
                  <LayoutGroup id="sidebar">
                    {navItems &&
                      navItems.map((item) => {
                        const isCurrentPage = title === item;
                        return (
                          <Link key={item} href={`/preview/${item}`}>
                            <motion.span
                              className={classnames(
                                'text-[14px] flex items-center font-medium gap-2 w-full pl-4 h-8 rounded-md text-slate-11 relative transition ease-in-out duration-200',
                                {
                                  'text-cyan-11': isCurrentPage,
                                  'hover:text-slate-12': title !== item,
                                },
                              )}
                            >
                              {isCurrentPage && (
                                <motion.span
                                  layoutId="sidebar"
                                  className="absolute left-0 right-0 top-0 bottom-0 rounded-md bg-cyan-5"
                                  initial={{ opacity: 0 }}
                                  animate={{ opacity: 1 }}
                                  exit={{ opacity: 0 }}
                                >
                                  <div className="bg-cyan-11 w-px absolute top-1 left-2.5 h-6" />
                                </motion.span>
                              )}
                              <svg
                                className="flex-shrink-0"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                              >
                                <path
                                  d="M7.75 19.25H16.25C17.3546 19.25 18.25 18.3546 18.25 17.25V9L14 4.75H7.75C6.64543 4.75 5.75 5.64543 5.75 6.75V17.25C5.75 18.3546 6.64543 19.25 7.75 19.25Z"
                                  stroke="currentColor"
                                  strokeOpacity="0.927"
                                  strokeWidth="1.5"
                                  strokeLinecap="round"
                                  strokeLinejoin="round"
                                />
                                <path
                                  d="M18 9.25H13.75V5"
                                  stroke="currentColor"
                                  strokeOpacity="0.927"
                                  strokeWidth="1.5"
                                  strokeLinecap="round"
                                  strokeLinejoin="round"
                                />
                              </svg>
                              {item}
                            </motion.span>
                          </Link>
                        );
                      })}
                  </LayoutGroup>
                </div>
              </Collapsible.Content>
            )}
          </Collapsible.Root>
        </nav>
      </aside>
    );
  },
);

Sidebar.displayName = 'Sidebar';



================================================
FILE: packages/email/.react-email/src/components/text.tsx
================================================
import * as SlotPrimitive from '@radix-ui/react-slot';
import classnames from 'classnames';
import * as React from 'react';
import { As, unreachable } from '../utils';

export type TextSize = '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9';
export type TextColor = 'gray' | 'white';
export type TextTransform = 'uppercase' | 'lowercase' | 'capitalize';
export type TextWeight = 'normal' | 'medium';

interface TextOwnProps {
  size?: TextSize;
  color?: TextColor;
  transform?: TextTransform;
  weight?: TextWeight;
}

type TextProps = As<'span', 'div', 'p'> & TextOwnProps;

export const Text = React.forwardRef<HTMLSpanElement, Readonly<TextProps>>(
  (
    {
      as: Tag = 'span',
      size = '2',
      color = 'gray',
      transform,
      weight = 'normal',
      className,
      children,
      ...props
    },
    forwardedRef,
  ) => (
    <SlotPrimitive.Slot
      ref={forwardedRef}
      className={classnames(
        className,
        transform,
        getSizesClassNames(size),
        getColorClassNames(color),
        getWeightClassNames(weight),
      )}
      {...props}
    >
      <Tag>{children}</Tag>
    </SlotPrimitive.Slot>
  ),
);

const getSizesClassNames = (size: TextSize | undefined) => {
  switch (size) {
    case '1':
      return 'text-xs';
    case undefined:
    case '2':
      return 'text-sm';
    case '3':
      return 'text-base';
    case '4':
      return 'text-lg';
    case '5':
      return ['text-17px', 'md:text-xl tracking-[-0.16px]'];
    case '6':
      return 'text-2xl tracking-[-0.288px]';
    case '7':
      return 'text-[28px] leading-[34px] tracking-[-0.416px]';
    case '8':
      return 'text-[35px] leading-[42px] tracking-[-0.64px]';
    case '9':
      return 'text-6xl leading-[73px] tracking-[-0.896px]';
    default:
      return unreachable(size);
  }
};

const getColorClassNames = (color: TextColor | undefined) => {
  switch (color) {
    case 'white':
      return 'text-slate-12';
    case undefined:
    case 'gray':
      return 'text-slate-11';
    default:
      return unreachable(color);
  }
};

const getWeightClassNames = (weight: TextWeight | undefined) => {
  switch (weight) {
    case undefined:
    case 'normal':
      return 'font-normal';
    case 'medium':
      return 'font-medium';
    default:
      return unreachable(weight);
  }
};

Text.displayName = 'Text';



================================================
FILE: packages/email/.react-email/src/components/tooltip-content.tsx
================================================
import * as TooltipPrimitive from '@radix-ui/react-tooltip';
import classnames from 'classnames';
import * as React from 'react';
import { inter } from '../app/layout';

type ContentElement = React.ElementRef<typeof TooltipPrimitive.Content>;
type ContentProps = React.ComponentPropsWithoutRef<
  typeof TooltipPrimitive.Content
>;

export interface TooltipProps extends ContentProps {}

export const TooltipContent = React.forwardRef<
  ContentElement,
  Readonly<TooltipProps>
>(({ sideOffset = 6, children, ...props }, forwardedRef) => (
  <TooltipPrimitive.Portal>
    <TooltipPrimitive.Content
      {...props}
      ref={forwardedRef}
      className={classnames(
        'bg-black border border-slate-6 z-20 px-3 py-2 rounded-md text-xs',
        `${inter.variable} font-sans`,
      )}
      sideOffset={sideOffset}
    >
      {children}
    </TooltipPrimitive.Content>
  </TooltipPrimitive.Portal>
));

TooltipContent.displayName = 'TooltipContent';



================================================
FILE: packages/email/.react-email/src/components/tooltip.tsx
================================================
import * as TooltipPrimitive from '@radix-ui/react-tooltip';
import * as React from 'react';
import { TooltipContent } from './tooltip-content';

type RootProps = React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Root>;

export interface TooltipProps extends RootProps {}

export const TooltipRoot: React.FC<Readonly<TooltipProps>> = ({
  children,
  ...props
}) => <TooltipPrimitive.Root {...props}>{children}</TooltipPrimitive.Root>;

export const Tooltip = Object.assign(TooltipRoot, {
  Arrow: TooltipPrimitive.TooltipArrow,
  Provider: TooltipPrimitive.TooltipProvider,
  Content: TooltipContent,
  Trigger: TooltipPrimitive.TooltipTrigger,
});



================================================
FILE: packages/email/.react-email/src/components/topbar.tsx
================================================
import * as ToggleGroup from '@radix-ui/react-toggle-group';
import classnames from 'classnames';
import { LayoutGroup, motion } from 'framer-motion';
import * as React from 'react';
import { Heading } from './heading';
import { Send } from './send';

type TopbarElement = React.ElementRef<'header'>;
type RootProps = React.ComponentPropsWithoutRef<'header'>;

interface TopbarProps extends RootProps {
  title: string;
  activeView?: string;
  markup?: string;
  setActiveView?: (view: string) => void;
}

export const Topbar = React.forwardRef<TopbarElement, Readonly<TopbarProps>>(
  (
    { className, title, markup, activeView, setActiveView, ...props },
    forwardedRef,
  ) => {
    const columnWidth = 'w-[200px]';

    return (
      <header
        ref={forwardedRef}
        className={classnames(
          'bg-black flex relative items-center px-6 justify-between h-[70px] border-b border-slate-6',
          className,
        )}
        {...props}
      >
        <div className={`flex items-center overflow-hidden ${columnWidth}`}>
          <Heading as="h2" size="2" weight="medium" className="truncate">
            {title}
          </Heading>
        </div>

        <div className={`${columnWidth}`}>
          <LayoutGroup id="topbar">
            {setActiveView && (
              <ToggleGroup.Root
                className="inline-block items-center bg-slate-2 border border-slate-6 rounded-md overflow-hidden"
                type="single"
                value={activeView}
                aria-label="View mode"
                onValueChange={(value) => {
                  if (!value) return;
                  setActiveView(value);
                }}
              >
                <ToggleGroup.Item value="desktop">
                  <motion.div
                    className={classnames(
                      'text-sm font-medium px-3 py-2 transition ease-in-out duration-200 relative hover:text-slate-12',
                      {
                        'text-slate-11': activeView === 'source',
                        'text-slate-12': activeView === 'desktop',
                      },
                    )}
                  >
                    {activeView === 'desktop' && (
                      <motion.span
                        layoutId="topbar"
                        className="absolute left-0 right-0 top-0 bottom-0 bg-slate-4"
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                      />
                    )}
                    Desktop
                  </motion.div>
                </ToggleGroup.Item>
                <ToggleGroup.Item value="source">
                  <motion.div
                    className={classnames(
                      'text-sm font-medium px-3 py-2 transition ease-in-out duration-200 relative hover:text-slate-12',
                      {
                        'text-slate-11': activeView === 'desktop',
                        'text-slate-12': activeView === 'source',
                      },
                    )}
                  >
                    {activeView === 'source' && (
                      <motion.span
                        layoutId="nav"
                        className="absolute left-0 right-0 top-0 bottom-0 bg-slate-4"
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                      />
                    )}
                    Source
                  </motion.div>
                </ToggleGroup.Item>
              </ToggleGroup.Root>
            )}
          </LayoutGroup>
        </div>

        {markup && (
          <div className={`flex justify-end ${columnWidth}`}>
            <Send markup={markup} />
          </div>
        )}
      </header>
    );
  },
);

Topbar.displayName = 'Topbar';



================================================
FILE: packages/email/.react-email/src/styles/globals.css
================================================
@tailwind base;
@tailwind components;
@tailwind utilities;



================================================
FILE: packages/email/.react-email/src/utils/as.ts
================================================
export type As<
  DefaultTag extends React.ElementType,
  T1 extends React.ElementType,
  T2 extends React.ElementType = T1,
  T3 extends React.ElementType = T1,
  T4 extends React.ElementType = T1,
  T5 extends React.ElementType = T1,
> =
  | (React.ComponentPropsWithRef<DefaultTag> & {
      as?: DefaultTag;
    })
  | (React.ComponentPropsWithRef<T1> & {
      as: T1;
    })
  | (React.ComponentPropsWithRef<T2> & {
      as: T2;
    })
  | (React.ComponentPropsWithRef<T3> & {
      as: T3;
    })
  | (React.ComponentPropsWithRef<T4> & {
      as: T4;
    })
  | (React.ComponentPropsWithRef<T5> & {
      as: T5;
    });



================================================
FILE: packages/email/.react-email/src/utils/copy-text-to-clipboard.ts
================================================
export const copyTextToClipboard = async (text: string) => {
  try {
    await navigator.clipboard.writeText(text);
  } catch {
    throw new Error('Not able to copy');
  }
};



================================================
FILE: packages/email/.react-email/src/utils/get-emails.ts
================================================
import { promises as fs } from 'fs';
import path from 'path';

export const CONTENT_DIR = 'emails';

export const getEmails = async () => {
  const emailsDirectory = path.join(process.cwd(), CONTENT_DIR);
  const filenames = await fs.readdir(emailsDirectory);
  const emails = filenames
    .map((file) => file.replace(/\.(jsx|tsx)$/g, ''))
    .filter((file) => file !== 'components');
  return { emails, filenames };
};



================================================
FILE: packages/email/.react-email/src/utils/index.ts
================================================
export * from './as';
export * from './copy-text-to-clipboard';
export * from './unreachable';



================================================
FILE: packages/email/.react-email/src/utils/language-map.ts
================================================
const languageMap = {
  jsx: 'React',
  markup: 'HTML',
  markdown: 'Plain Text',
};

export default languageMap;



================================================
FILE: packages/email/.react-email/src/utils/unreachable.ts
================================================
export const unreachable = (
  condition: never,
  message = `Entered unreachable code. Received '${condition}'.`,
): never => {
  throw new TypeError(message);
};



================================================
FILE: packages/shared/eslint.config.js
================================================
import baseConfig from "@kan/eslint-config/base";

/** @type {import('typescript-eslint').Config} */
export default [
  {
    ignores: [],
  },
  ...baseConfig,
];



================================================
FILE: packages/shared/package.json
================================================
{
  "name": "@kan/shared",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./src/index.ts"
    },
    "./utils": {
      "types": "./dist/utils/index.d.ts",
      "default": "./src/utils/index.ts"
    },
    "./constants": {
      "types": "./dist/constants/index.d.ts",
      "default": "./src/constants/index.ts"
    }
  },
  "license": "GPL-3.0",
  "scripts": {
    "build": "tsc",
    "clean": "git clean -xdf .cache .turbo dist node_modules",
    "dev": "tsc",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "typecheck": "tsc --noEmit --emitDeclarationOnly false"
  },
  "devDependencies": {
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config",
  "dependencies": {
    "@aws-sdk/client-s3": "^3.802.0",
    "@aws-sdk/s3-request-presigner": "^3.812.0",
    "date-fns": "^4.1.0",
    "jose": "^6.1.2",
    "nanoid": "^5.0.9",
    "next-runtime-env": "^1.7.2"
  }
}



================================================
FILE: packages/shared/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/internal-package.json",
  "compilerOptions": {},
  "include": ["*.ts", "src"],
  "exclude": ["node_modules"]
}



================================================
FILE: packages/shared/src/index.ts
================================================
export const name = "shared";

export * from "./constants";
export * from "./utils";
export * from "./permissions";



================================================
FILE: packages/shared/src/permissions.ts
================================================
export const permissionActions = [
  "view",
  "create",
  "edit",
  "delete",
  "manage",
] as const;
export type PermissionAction = (typeof permissionActions)[number];

export const permissionResources = [
  "workspace",
  "board",
  "list",
  "card",
  "comment",
  "member",
] as const;
export type PermissionResource = (typeof permissionResources)[number];

export const allPermissions = [
  "workspace:view",
  "workspace:edit",
  "workspace:delete",
  "workspace:manage",
  "board:view",
  "board:create",
  "board:edit",
  "board:delete",
  "list:view",
  "list:create",
  "list:edit",
  "list:delete",
  "card:view",
  "card:create",
  "card:edit",
  "card:delete",
  "comment:view",
  "comment:create",
  "comment:edit",
  "comment:delete",
  "member:view",
  "member:invite",
  "member:edit",
  "member:remove",
] as const;

export type Permission = (typeof allPermissions)[number];

export const roleHierarchy = {
  admin: 100,
  member: 50,
  guest: 10,
} as const;

export type Role = keyof typeof roleHierarchy;
export const roles = Object.keys(roleHierarchy) as Role[];

export const defaultRolePermissions: Record<Role, readonly Permission[]> = {
  admin: allPermissions,
  member: [
    "workspace:view",
    "board:view",
    "board:create",
    "list:view",
    "list:create",
    "list:edit",
    "list:delete",
    "card:view",
    "card:create",
    "card:edit",
    "card:delete",
    "comment:view",
    "comment:create",
    "comment:edit",
    "comment:delete",
    "member:view",
  ],

  guest: [
    "workspace:view",
    "board:view",
    "list:view",
    "card:view",
    "comment:view",
    "member:view",
  ],
} as const;


export const permissionCategories = {
  workspace: {
    label: "Workspace",
    permissions: [
      "workspace:view",
      "workspace:edit",
      "workspace:delete",
      "workspace:manage",
    ] as const,
  },
  board: {
    label: "Boards",
    permissions: [
      "board:view",
      "board:create",
      "board:edit",
      "board:delete",
    ] as const,
  },
  list: {
    label: "Lists",
    permissions: [
      "list:view",
      "list:create",
      "list:edit",
      "list:delete",
    ] as const,
  },
  card: {
    label: "Cards",
    permissions: [
      "card:view",
      "card:create",
      "card:edit",
      "card:delete",
    ] as const,
  },
  comment: {
    label: "Comments",
    permissions: [
      "comment:view",
      "comment:create",
      "comment:edit",
      "comment:delete",
    ] as const,
  },
  member: {
    label: "Members",
    permissions: [
      "member:view",
      "member:invite",
      "member:edit",
      "member:remove",
    ] as const,
  },
} as const;

export function getDefaultPermissions(role: Role): readonly Permission[] {
  return defaultRolePermissions[role];
}

export function getRoleLevel(role: Role): number {
  return roleHierarchy[role];
}

export function canManageRole(managerRole: Role, targetRole: Role): boolean {
  return roleHierarchy[managerRole] >= roleHierarchy[targetRole];
}

export function hasPermissionInDefaults(
  role: Role,
  permission: Permission,
): boolean {
  return defaultRolePermissions[role].includes(permission);
}




================================================
FILE: packages/shared/src/constants/colours.ts
================================================
export const colours: { name: string; code: string }[] = [
  { name: "Teal", code: "#0d9488" },
  { name: "Green", code: "#65a30d" },
  { name: "Blue", code: "#0284c7" },
  { name: "Purple", code: "#4f46e5" },
  { name: "Yellow", code: "#ca8a04" },
  { name: "Orange", code: "#ea580c" },
  { name: "Red", code: "#dc2626" },
  { name: "Pink", code: "#db2777" },
] as const;

export type Colour = (typeof colours)[number];



================================================
FILE: packages/shared/src/constants/index.ts
================================================
export * from "./colours";



================================================
FILE: packages/shared/src/utils/dueDateFilters.ts
================================================
import { addDays, endOfDay, startOfDay } from "date-fns";

export type DueDateFilterKey =
  | "overdue"
  | "today"
  | "tomorrow"
  | "next-week"
  | "next-month"
  | "no-due-date";

export interface DueDateFilter {
  startDate?: Date;
  endDate?: Date;
  hasNoDueDate?: boolean;
}

export const convertDueDateFiltersToRanges = (
  filters: DueDateFilterKey[],
): DueDateFilter[] => {
  if (!filters.length) return [];

  const today = startOfDay(new Date());
  const tomorrow = addDays(today, 1);
  const nextWeekEnd = addDays(today, 8);
  const nextMonthEnd = addDays(today, 31);

  return filters.map((filter) => {
    switch (filter) {
      case "overdue":
        return {
          endDate: today,
        };
      case "today":
        return {
          startDate: today,
          endDate: endOfDay(today),
        };
      case "tomorrow":
        return {
          startDate: tomorrow,
          endDate: endOfDay(tomorrow),
        };
      case "next-week": {
        return {
          startDate: today,
          endDate: nextWeekEnd,
        };
      }
      case "next-month": {
        return {
          startDate: nextWeekEnd,
          endDate: nextMonthEnd,
        };
      }
      case "no-due-date":
        return {
          hasNoDueDate: true,
        };
      default:
        return {};
    }
  });
};



================================================
FILE: packages/shared/src/utils/email.ts
================================================
import { SignJWT } from "jose";
import { env } from "next-runtime-env";

const encoder = new TextEncoder();

/**
 * Creates a longâ€‘lived unsubscribe link for a given user/subscriber.
 *
 * `${NEXT_PUBLIC_BASE_URL}/unsubscribe?token=<jwt>`
 *
 * The JWT payload only contains the subscriberId. There is no expiry
 * on purpose â€“ unsubscribe links should remain valid indefinitely.
 *
 */
export async function createEmailUnsubscribeLink(
  userId: string,
): Promise<string | null> {
  const baseUrl = env("NEXT_PUBLIC_BASE_URL");
  const secret = process.env.EMAIL_UNSUBSCRIBE_SECRET;

  if (!baseUrl || !secret) {
    // Environment not configured for unsubscribe links.
    return null;
  }

  const token = await new SignJWT({ subscriberId: userId })
    .setProtectedHeader({ alg: "HS256" })
    // No expiration on purpose; unsubscribe links are longâ€‘lived.
    .sign(encoder.encode(secret));

  return `${baseUrl}/unsubscribe?token=${encodeURIComponent(token)}`;
}



================================================
FILE: packages/shared/src/utils/generateSlug.ts
================================================
export function generateSlug(text: string): string {
  return text
    .toLowerCase()
    .trim()
    .replace(/[^\w\s-]/g, "") // Remove special characters
    .replace(/\s+/g, "-") // Replace spaces with hyphens
    .replace(/-+/g, "-"); // Remove consecutive hyphens
}



================================================
FILE: packages/shared/src/utils/generateUID.ts
================================================
import { customAlphabet } from "nanoid";

const alphabet = "0123456789abcdefghijklmnopqrstuvwxyz";
const length = 12;

const nanoid = customAlphabet(alphabet, length);

export function generateUID() {
  return nanoid();
}



================================================
FILE: packages/shared/src/utils/index.ts
================================================
export * from "./generateUID";
export * from "./generateSlug";
export * from "./subscriptions";
export * from "./email";
export * from "./dueDateFilters";
export * from "./s3";
export * from "./mentions";



================================================
FILE: packages/shared/src/utils/mentions.ts
================================================
/**
 * Parses mention data-id attributes from HTML content
 * Mentions are stored as: <span data-type="mention" data-id="..." data-label="...">@label</span>
 * @param htmlContent - The HTML content to parse
 * @returns Array of unique mention public IDs
 */
export function parseMentionsFromHTML(htmlContent: string): string[] {
  if (!htmlContent) return [];

  // Match all mention spans with data-id attributes
  const mentionRegex = /<span[^>]*data-type="mention"[^>]*data-id="([^"]+)"[^>]*>/gi;
  const matches = Array.from(htmlContent.matchAll(mentionRegex));
  
  // Extract unique mention IDs
  const mentionIds = matches
    .map((match) => match[1])
    .filter((id): id is string => !!id && id.length >= 12);

  // Return unique IDs
  return Array.from(new Set(mentionIds));
}




================================================
FILE: packages/shared/src/utils/s3.ts
================================================
import {
  DeleteObjectCommand,
  GetObjectCommand,
  PutObjectCommand,
  S3Client,
} from "@aws-sdk/client-s3";
import { getSignedUrl } from "@aws-sdk/s3-request-presigner";
import { env } from "next-runtime-env";

export function createS3Client() {
  const credentials =
    process.env.S3_ACCESS_KEY_ID && process.env.S3_SECRET_ACCESS_KEY
      ? {
          accessKeyId: process.env.S3_ACCESS_KEY_ID,
          secretAccessKey: process.env.S3_SECRET_ACCESS_KEY,
        }
      : undefined;

  return new S3Client({
    region: process.env.S3_REGION ?? "",
    endpoint: process.env.S3_ENDPOINT ?? "",
    forcePathStyle: process.env.S3_FORCE_PATH_STYLE === "true",
    credentials,
  });
}

export async function generateUploadUrl(
  bucket: string,
  key: string,
  contentType: string,
  expiresIn = 3600,
) {
  const client = createS3Client();
  return getSignedUrl(
    client,
    new PutObjectCommand({
      Bucket: bucket,
      Key: key,
      ContentType: contentType,
      // Don't set ACL for private files
    }),
    { expiresIn },
  );
}

export async function generateDownloadUrl(
  bucket: string,
  key: string,
  expiresIn = 3600,
) {
  const client = createS3Client();
  return getSignedUrl(
    client,
    new GetObjectCommand({
      Bucket: bucket,
      Key: key,
    }),
    { expiresIn },
  );
}

export async function deleteObject(bucket: string, key: string) {
  const client = createS3Client();
  await client.send(
    new DeleteObjectCommand({
      Bucket: bucket,
      Key: key,
    }),
  );
}

/**
 * Generate presigned URL for an avatar image
 * Returns the URL as-is if it's already a full URL (external provider)
 * Returns presigned URL if it's an S3 key
 * Returns null if image key is missing, bucket is not configured, or URL generation fails
 */
export async function generateAvatarUrl(
  imageKey: string | null | undefined,
  expiresIn = 86400, // 24 hours
): Promise<string | null> {
  if (!imageKey) {
    return null;
  }

  if (imageKey.startsWith("http://") || imageKey.startsWith("https://")) {
    return imageKey;
  }

  const bucket = env("NEXT_PUBLIC_AVATAR_BUCKET_NAME");
  if (!bucket) {
    return null;
  }

  try {
    return await generateDownloadUrl(bucket, imageKey, expiresIn);
  } catch {
    // If URL generation fails, return null
    return null;
  }
}

/**
 * Generate presigned URL for an attachment
 * Returns null if attachment key is missing, bucket is not configured, or URL generation fails
 */
export async function generateAttachmentUrl(
  attachmentKey: string | null | undefined,
  expiresIn = 86400, // 24 hours
): Promise<string | null> {
  if (!attachmentKey) {
    return null;
  }

  const bucket = env("NEXT_PUBLIC_ATTACHMENTS_BUCKET_NAME");
  if (!bucket) {
    return null;
  }

  try {
    return await generateDownloadUrl(bucket, attachmentKey, expiresIn);
  } catch {
    // If URL generation fails, return null
    return null;
  }
}




================================================
FILE: packages/shared/src/utils/subscriptions.ts
================================================
export type SubscriptionStatus =
  | "active"
  | "trialing"
  | "past_due"
  | "canceled"
  | "unpaid";
export type SubscriptionPlan = "team" | "pro";

export interface Subscription {
  id: number | null;
  plan: string;
  status: string;
  seats: number | null;
  unlimitedSeats: boolean;
  periodStart: Date | null;
  periodEnd: Date | null;
  referenceId: string | null;
  stripeSubscriptionId: string | null;
  stripeCustomerId: string | null;
  createdAt: Date;
  updatedAt: Date;
}

const ACTIVE_STATUSES = ["active", "trialing", "past_due"];

export const getActiveSubscriptions = (
  subscriptions: Subscription[] | undefined,
) => {
  if (!subscriptions) return [];
  return subscriptions.filter((sub) => ACTIVE_STATUSES.includes(sub.status));
};

export const getSubscriptionByPlan = (
  subscriptions: Subscription[] | undefined,
  plan: SubscriptionPlan,
) => {
  if (!subscriptions) return undefined;
  return subscriptions.find(
    (sub) => sub.plan === plan && ACTIVE_STATUSES.includes(sub.status),
  );
};

export const hasActiveSubscription = (
  subscriptions: Subscription[] | undefined,
  plan: SubscriptionPlan,
) => {
  return getSubscriptionByPlan(subscriptions, plan) !== undefined;
};

export const hasUnlimitedSeats = (
  subscriptions: Subscription[] | undefined,
) => {
  const activeSubscriptions = getActiveSubscriptions(subscriptions);
  return activeSubscriptions.some((sub) => sub.unlimitedSeats);
};



================================================
FILE: packages/stripe/eslint.config.js
================================================
import baseConfig from "@kan/eslint-config/base";

/** @type {import('typescript-eslint').Config} */
export default [
  {
    ignores: [],
  },
  ...baseConfig,
];



================================================
FILE: packages/stripe/package.json
================================================
{
  "name": "@kan/stripe",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "exports": {
    ".": "./src/index.ts"
  },
  "license": "GPL-3.0",
  "scripts": {
    "build": "tsc",
    "clean": "git clean -xdf .cache .turbo dist node_modules",
    "dev": "tsc",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "typecheck": "tsc --noEmit --emitDeclarationOnly false"
  },
  "devDependencies": {
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config",
  "dependencies": {
    "stripe": "^18.2.0"
  }
}



================================================
FILE: packages/stripe/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/internal-package.json",
  "compilerOptions": {},
  "include": ["*.ts", "src"],
  "exclude": ["node_modules"]
}



================================================
FILE: packages/stripe/src/index.ts
================================================
import { Stripe } from "stripe";

export const name = "stripe";

const stripeSecretKey = process.env.STRIPE_SECRET_KEY;

const createStripeClient = () => {
  if (!stripeSecretKey) {
    throw new Error("STRIPE_SECRET_KEY is not set");
  }

  const stripe = new Stripe(stripeSecretKey, {
    apiVersion: "2025-08-27.basil",
  });

  return stripe;
};

export const updateSubscriptionSeats = async (
  stripeSubscriptionId: string,
  seatIncrement = 1,
): Promise<Stripe.Subscription> => {
  const stripe = createStripeClient();

  // First, retrieve the current subscription to get the subscription items
  const subscription = await stripe.subscriptions.retrieve(
    stripeSubscriptionId,
    {
      expand: ["items"],
    },
  );

  if (!subscription.items.data.length) {
    throw new Error(
      `No subscription items found for subscription ${stripeSubscriptionId}`,
    );
  }

  // Get the first subscription item
  const subscriptionItem = subscription.items.data[0];
  if (!subscriptionItem) {
    throw new Error(
      `No subscription item found for subscription ${stripeSubscriptionId}`,
    );
  }

  const currentQuantity = subscriptionItem.quantity ?? 1;
  const newQuantity = currentQuantity + seatIncrement;

  // Ensure we don't go below 1 seat
  if (newQuantity < 1) {
    throw new Error(
      `Cannot reduce seats below 1. Current: ${currentQuantity}, Requested change: ${seatIncrement}`,
    );
  }

  // Update the subscription with the new quantity and immediate invoicing
  const updatedSubscription = await stripe.subscriptions.update(
    stripeSubscriptionId,
    {
      items: [
        {
          id: subscriptionItem.id,
          quantity: newQuantity,
        },
      ],
      proration_behavior: "create_prorations",
    },
  );

  return updatedSubscription;
};

export const getCancellationDetails = async (
  stripeSubscriptionId: string,
): Promise<Stripe.Subscription.CancellationDetails | null> => {
  const stripe = createStripeClient();
  const stripeSubscription =
    await stripe.subscriptions.retrieve(stripeSubscriptionId);
  return stripeSubscription.cancellation_details ?? null;
};

export { createStripeClient };



================================================
FILE: tooling/eslint/base.js
================================================
/// <reference types="./types.d.ts" />

import * as path from "node:path";
import { includeIgnoreFile } from "@eslint/compat";
import eslint from "@eslint/js";
import importPlugin from "eslint-plugin-import";
import turboPlugin from "eslint-plugin-turbo";
import tseslint from "typescript-eslint";

/**
 * All packages that leverage t3-env should use this rule
 */
export const restrictEnvAccess = tseslint.config(
  { ignores: ["**/env.ts"] },
  {
    files: ["**/*.js", "**/*.ts", "**/*.tsx"],
    rules: {
      "no-restricted-properties": [
        "error",
        {
          object: "process",
          property: "env",
          message:
            "Use `import { env } from '~/env'` instead to ensure validated types.",
        },
      ],
      "no-restricted-imports": [
        "error",
        {
          name: "process",
          importNames: ["env"],
          message:
            "Use `import { env } from '~/env'` instead to ensure validated types.",
        },
      ],
    },
  },
);

export default tseslint.config(
  // Ignore files not tracked by VCS and any config files
  includeIgnoreFile(path.join(import.meta.dirname, "../../.gitignore")),
  { ignores: ["**/*.config.*"] },
  {
    files: ["**/*.js", "**/*.ts", "**/*.tsx"],
    plugins: {
      import: importPlugin,
      turbo: turboPlugin,
    },
    extends: [
      eslint.configs.recommended,
      ...tseslint.configs.recommended,
      ...tseslint.configs.recommendedTypeChecked,
      ...tseslint.configs.stylisticTypeChecked,
    ],
    rules: {
      ...turboPlugin.configs.recommended.rules,
      "@typescript-eslint/no-unused-vars": [
        "error",
        { argsIgnorePattern: "^_", varsIgnorePattern: "^_" },
      ],
      "@typescript-eslint/consistent-type-imports": [
        "warn",
        { prefer: "type-imports", fixStyle: "separate-type-imports" },
      ],
      "@typescript-eslint/no-misused-promises": [
        2,
        { checksVoidReturn: { attributes: false } },
      ],
      "@typescript-eslint/no-unnecessary-condition": [
        "error",
        {
          allowConstantLoopConditions: true,
        },
      ],
      "@typescript-eslint/no-non-null-assertion": "error",
      "import/consistent-type-specifier-style": ["error", "prefer-top-level"],
    },
  },
  {
    linterOptions: { reportUnusedDisableDirectives: true },
    languageOptions: { parserOptions: { projectService: true } },
  },
);


================================================
FILE: tooling/eslint/nextjs.js
================================================
import nextPlugin from "@next/eslint-plugin-next";

/** @type {Awaited<import('typescript-eslint').Config>} */
export default [
  {
    files: ["**/*.ts", "**/*.tsx"],
    plugins: {
      "@next/next": nextPlugin,
    },
    rules: {
      ...nextPlugin.configs.recommended.rules,
      ...nextPlugin.configs["core-web-vitals"].rules,
      // TypeError: context.getAncestors is not a function
      "@next/next/no-duplicate-head": "off",
    },
  },
];


================================================
FILE: tooling/eslint/package.json
================================================
{
  "name": "@kan/eslint-config",
  "private": true,
  "version": "0.3.0",
  "type": "module",
  "exports": {
    "./base": "./base.js",
    "./nextjs": "./nextjs.js",
    "./react": "./react.js"
  },
  "scripts": {
    "clean": "git clean -xdf .cache .turbo node_modules",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "@eslint/compat": "^1.2.3",
    "@next/eslint-plugin-next": "^14.2.15",
    "eslint-plugin-import": "^2.31.0",
    "eslint-plugin-jsx-a11y": "^6.10.2",
    "eslint-plugin-react": "^7.37.2",
    "eslint-plugin-react-hooks": "^5.0.0",
    "eslint-plugin-turbo": "^2.3.1",
    "typescript-eslint": "^8.15.0"
  },
  "devDependencies": {
    "@kan/prettier-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "@types/eslint__js": "8.42.3",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config"
}


================================================
FILE: tooling/eslint/react.js
================================================
import reactPlugin from "eslint-plugin-react";
import hooksPlugin from "eslint-plugin-react-hooks";

/** @type {Awaited<import('typescript-eslint').Config>} */
export default [
  {
    files: ["**/*.ts", "**/*.tsx"],
    plugins: {
      react: reactPlugin,
      "react-hooks": hooksPlugin,
    },
    rules: {
      ...reactPlugin.configs["jsx-runtime"].rules,
      ...hooksPlugin.configs.recommended.rules,
    },
    languageOptions: {
      globals: {
        React: "writable",
      },
    },
  },
];


================================================
FILE: tooling/eslint/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/base.json",
  "include": ["."],
  "exclude": ["node_modules"]
}


================================================
FILE: tooling/eslint/types.d.ts
================================================
/**
 * Since the ecosystem hasn't fully migrated to ESLint's new FlatConfig system yet,
 * we "need" to type some of the plugins manually :(
 */

declare module "eslint-plugin-import" {
  import type { Linter, Rule } from "eslint";

  export const configs: {
    recommended: { rules: Linter.RulesRecord };
  };
  export const rules: Record<string, Rule.RuleModule>;
}

declare module "eslint-plugin-react" {
  import type { Linter, Rule } from "eslint";

  export const configs: {
    recommended: { rules: Linter.RulesRecord };
    all: { rules: Linter.RulesRecord };
    "jsx-runtime": { rules: Linter.RulesRecord };
  };
  export const rules: Record<string, Rule.RuleModule>;
}

declare module "eslint-plugin-react-hooks" {
  import type { Linter, Rule } from "eslint";

  export const configs: {
    recommended: {
      rules: {
        "rules-of-hooks": Linter.RuleEntry;
        "exhaustive-deps": Linter.RuleEntry;
      };
    };
  };
  export const rules: Record<string, Rule.RuleModule>;
}

declare module "@next/eslint-plugin-next" {
  import type { Linter, Rule } from "eslint";

  export const configs: {
    recommended: { rules: Linter.RulesRecord };
    "core-web-vitals": { rules: Linter.RulesRecord };
  };
  export const rules: Record<string, Rule.RuleModule>;
}


================================================
FILE: tooling/prettier/index.js
================================================
import { fileURLToPath } from "url";

/** @typedef {import("prettier").Config} PrettierConfig */
/** @typedef {import("prettier-plugin-tailwindcss").PluginOptions} TailwindConfig */
/** @typedef {import("@ianvs/prettier-plugin-sort-imports").PluginConfig} SortImportsConfig */

/** @type { PrettierConfig | SortImportsConfig | TailwindConfig } */
const config = {
  plugins: [
    "@ianvs/prettier-plugin-sort-imports",
    "prettier-plugin-tailwindcss",
  ],
  tailwindConfig: fileURLToPath(
    new URL("../../tooling/tailwind/web.ts", import.meta.url),
  ),
  tailwindFunctions: ["cn", "cva"],
  importOrder: [
    "<TYPES>",
    "^(next/(.*)$)|^(next$)",
    "<THIRD_PARTY_MODULES>",
    "",
    "<TYPES>^@kan",
    "^@kan/(.*)$",
    "",
    "<TYPES>^[.|..|~]",
    "^~/",
    "^[../]",
    "^[./]",
  ],
  importOrderParserPlugins: ["typescript", "jsx", "decorators-legacy"],
  importOrderTypeScriptVersion: "4.4.0",
  overrides: [
    {
      files: "*.json.hbs",
      options: {
        parser: "json",
      },
    },
    {
      files: "*.js.hbs",
      options: {
        parser: "babel",
      },
    },
  ],
};

export default config;


================================================
FILE: tooling/prettier/package.json
================================================
{
  "name": "@kan/prettier-config",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "exports": {
    ".": "./index.js"
  },
  "scripts": {
    "clean": "git clean -xdf .cache .turbo node_modules",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "@ianvs/prettier-plugin-sort-imports": "^4.4.0",
    "prettier": "catalog:",
    "prettier-plugin-tailwindcss": "^0.6.9"
  },
  "devDependencies": {
    "@kan/tsconfig": "workspace:*",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config"
}


================================================
FILE: tooling/prettier/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/base.json",
  "include": ["."],
  "exclude": ["node_modules"]
}


================================================
FILE: tooling/tailwind/eslint.config.js
================================================
import baseConfig from "@kan/eslint-config/base";

export default [...baseConfig];


================================================
FILE: tooling/tailwind/package.json
================================================
{
  "name": "@kan/tailwind-config",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "exports": {
    "./web": "./web.ts"
  },
  "license": "MIT",
  "scripts": {
    "clean": "git clean -xdf .cache .turbo node_modules",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "@tailwindcss/forms": "^0.5.6",
    "postcss": "^8.4.49",
    "tailwind-scrollbar": "^3.0.5",
    "tailwindcss": "catalog:"
  },
  "devDependencies": {
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config"
}



================================================
FILE: tooling/tailwind/tsconfig.json
================================================
{
  "extends": "@kan/tsconfig/base.json",
  "include": ["."],
  "exclude": ["node_modules"]
}


================================================
FILE: tooling/tailwind/web.ts
================================================
import type { Config } from "tailwindcss";
import forms from "@tailwindcss/forms";
import scrollbar from "tailwind-scrollbar";

export default {
  content: ["./src/**/*.tsx"],
  darkMode: "class",
  theme: {
    extend: {
      fontFamily: {
        sans: ["var(--font-plus-jakarta-sans), Plus Jakarta Sans"],
      },
      fontSize: {
        sm: "0.8rem",
      },
      boxShadow: {
        "3xl-dark": "0px 16px 70px rgba(0, 0, 0, 0.5)",
        "3xl-light":
          "rgba(0, 0, 0, 0.12) 0px 4px 30px, rgba(0, 0, 0, 0.04) 0px 3px 17px, rgba(0, 0, 0, 0.04) 0px 2px 8px, rgba(0, 0, 0, 0.04) 0px 1px 1px",
      },
      animation: {
        "border-spin": "border-spin 4s linear infinite",
        "fade-down": "fade-down 0.5s ease-out",
        "fade-in": "fade-in 0.5s ease-out",
        scroll: "scroll 40s linear infinite",
      },

      keyframes: {
        "border-spin": {
          from: { transform: "rotate(0deg)" },
          to: { transform: "rotate(360deg)" },
        },
        "fade-down": {
          "0%": {
            opacity: "0",
            transform: "translateY(-20px)",
          },
          "100%": {
            opacity: "1",
            transform: "translateY(0)",
          },
        },
        "fade-in": {
          "0%": {
            opacity: "0",
          },
          "100%": {
            opacity: "1",
          },
        },
        scroll: {
          "0%": {
            transform: "translateX(0)",
          },
          "100%": {
            transform: "translateX(calc(-50% - 1.5rem))",
          },
        },
      },
      colors: {
        "dark-50": "#161616",
        "dark-100": "#1c1c1c",
        "dark-200": "#232323",
        "dark-300": "#282828",
        "dark-400": "#2e2e2e",
        "dark-500": "#343434",
        "dark-600": "#3e3e3e",
        "dark-700": "#505050",
        "dark-800": "#707070",
        "dark-900": "#7e7e7e",
        "dark-950": "#bbb",
        "dark-1000": "#ededed",
        "light-50": "hsl(0deg 0% 98.8%)",
        "light-100": "hsl(0deg 0% 97.3%)",
        "light-200": "hsl(0deg 0% 95.3%)",
        "light-300": "hsl(0deg 0% 92.9%)",
        "light-400": "hsl(0deg 0% 91%)",
        "light-500": "hsl(0deg 0% 88.6%)",
        "light-600": "hsl(0deg 0% 85.9%)",
        "light-700": "hsl(0deg 0% 78%)",
        "light-800": "hsl(0deg 0% 56.1%)",
        "light-900": "hsl(0deg 0% 52.2%)",
        "light-950": "hsl(0deg 0% 43.5%)",
        "light-1000": "hsl(0deg 0% 9%)",
      },
      screens: {
        "2xl": "1600px",
      },
    },
  },
  plugins: [forms, scrollbar],
} satisfies Config;



================================================
FILE: tooling/typescript/base.json
================================================
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "compilerOptions": {
    "esModuleInterop": true,
    "skipLibCheck": true,
    "target": "ES2022",
    "lib": ["ES2022"],
    "allowJs": true,
    "resolveJsonModule": true,
    "moduleDetection": "force",
    "isolatedModules": true,

    "incremental": true,
    "disableSourceOfProjectReferenceRedirect": true,
    "tsBuildInfoFile": "${configDir}/.cache/tsbuildinfo.json",

    "strict": true,
    "noUncheckedIndexedAccess": true,
    "checkJs": true,

    "module": "Preserve",
    "moduleResolution": "Bundler",
    "noEmit": true,
    "noImplicitAny": true
  },
  "exclude": ["node_modules", "build", "dist", ".next", ".expo"]
}


================================================
FILE: tooling/typescript/internal-package.json
================================================
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "./base.json",
  "compilerOptions": {
    "declaration": true,
    "declarationMap": true,
    "emitDeclarationOnly": true,
    "noEmit": false,
    "outDir": "${configDir}/dist"
  }
}


================================================
FILE: tooling/typescript/package.json
================================================
{
  "name": "@kan/tsconfig",
  "private": true,
  "version": "0.1.0",
  "files": [
    "*.json"
  ]
}


================================================
FILE: turbo/generators/config.ts
================================================
import { execSync } from "node:child_process";
import type { PlopTypes } from "@turbo/gen";

interface PackageJson {
  name: string;
  scripts: Record<string, string>;
  dependencies: Record<string, string>;
  devDependencies: Record<string, string>;
}

export default function generator(plop: PlopTypes.NodePlopAPI): void {
  plop.setGenerator("init", {
    description: "Generate a new package for the Kan Monorepo",
    prompts: [
      {
        type: "input",
        name: "name",
        message:
          "What is the name of the package? (You can skip the `@kan/` prefix)",
      },
      {
        type: "input",
        name: "deps",
        message:
          "Enter a space separated list of dependencies you would like to install",
      },
    ],
    actions: [
      (answers) => {
        if ("name" in answers && typeof answers.name === "string") {
          if (answers.name.startsWith("@kan/")) {
            answers.name = answers.name.replace("@kan/", "");
          }
        }
        return "Config sanitized";
      },
      {
        type: "add",
        path: "packages/{{ name }}/eslint.config.js",
        templateFile: "templates/eslint.config.js.hbs",
      },
      {
        type: "add",
        path: "packages/{{ name }}/package.json",
        templateFile: "templates/package.json.hbs",
      },
      {
        type: "add",
        path: "packages/{{ name }}/tsconfig.json",
        templateFile: "templates/tsconfig.json.hbs",
      },
      {
        type: "add",
        path: "packages/{{ name }}/src/index.ts",
        template: "export const name = '{{ name }}';",
      },
      {
        type: "modify",
        path: "packages/{{ name }}/package.json",
        async transform(content, answers) {
          if ("deps" in answers && typeof answers.deps === "string") {
            const pkg = JSON.parse(content) as PackageJson;
            for (const dep of answers.deps.split(" ").filter(Boolean)) {
              const version = await fetch(
                `https://registry.npmjs.org/-/package/${dep}/dist-tags`,
              )
                .then((res) => res.json())
                .then((json) => json.latest);
              if (!pkg.dependencies) pkg.dependencies = {};
              pkg.dependencies[dep] = `^${version}`;
            }
            return JSON.stringify(pkg, null, 2);
          }
          return content;
        },
      },
      async (answers) => {
        /**
         * Install deps and format everything
         */
        if ("name" in answers && typeof answers.name === "string") {
          // execSync("pnpm dlx sherif@latest --fix", {
          //   stdio: "inherit",
          // });
          execSync("pnpm i", { stdio: "inherit" });
          execSync(
            `pnpm prettier --write packages/${answers.name}/** --list-different`,
          );
          return "Package scaffolded";
        }
        return "Package not scaffolded";
      },
    ],
  });
}



================================================
FILE: turbo/generators/templates/eslint.config.js.hbs
================================================
import baseConfig from "@kan/eslint-config/base";

/** @type {import('typescript-eslint').Config} */
export default [
  {
    ignores: [],
  },
  ...baseConfig,
];



================================================
FILE: turbo/generators/templates/package.json.hbs
================================================
{
  "name": "@kan/{{ name }}",
  "private": true,
  "version": "0.1.0",
  "type": "module",
  "exports": {
    ".": "./src/index.ts"
  },
  "license": "MIT",
  "scripts": {
    "build": "tsc",
    "clean": "git clean -xdf .cache .turbo dist node_modules",
    "dev": "tsc",
    "format": "prettier --check . --ignore-path ../../.gitignore",
    "lint": "eslint",
    "typecheck": "tsc --noEmit --emitDeclarationOnly false"
  },
  "devDependencies": {
    "@kan/eslint-config": "workspace:*",
    "@kan/prettier-config": "workspace:*",
    "@kan/tsconfig": "workspace:*",
    "eslint": "catalog:",
    "prettier": "catalog:",
    "typescript": "catalog:"
  },
  "prettier": "@kan/prettier-config"
}



================================================
FILE: turbo/generators/templates/tsconfig.json.hbs
================================================
{
  "extends": "@kan/tsconfig/internal-package.json",
  "compilerOptions": {},
  "include": ["*.ts", "src"],
  "exclude": ["node_modules"]
}



================================================
FILE: .github/funding.yml
================================================
github: [kanbn]



================================================
FILE: .github/ISSUE_TEMPLATE/bug_report.md
================================================
---
name: "\U0001F41B Bug Report"
about: Create a report to help us improve
title: ''
labels: bug
assignees: ''

---

## ğŸ› Bug Report

**Describe the bug**
A clear and concise description of what the bug is.

**To Reproduce**
Steps to reproduce the behavior:

1. Go to '...'
2. Click on '...'
3. Scroll down to '...'
4. See error

**Expected behavior**
A clear and concise description of what you expected to happen.

**Screenshots**
If applicable, add screenshots to help explain your problem.

**Environment (please complete the following information):**

- OS: [e.g. macOS, Windows, Linux]
- Browser [e.g. chrome, safari]
- Node version [e.g. 20]
- App version/commit [if applicable]

**Additional context**
Add any other context about the problem here.



================================================
FILE: .github/ISSUE_TEMPLATE/feature_request.md
================================================
---
name: "âœ¨ Feature Request"
about: Suggest an idea for this project
title: ''
labels: feature
assignees: ''

---

## âœ¨ Feature Request

**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]

**Describe the solution you'd like**
A clear and concise description of what you want to happen.

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

**Additional context**
Add any other context or screenshots about the feature request here.

**Implementation ideas (optional)**
If you have any ideas about how this feature could be implemented, please share them here.

**Would you like to work on this feature?**

- [ ] Yes, I'd like to help implement this feature
- [ ] No, I'm just suggesting the feature



================================================
FILE: .github/workflows/docker-publish.yml
================================================
name: Docker

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

on:
  schedule:
    - cron: "21 21 * * *"
  push:
    branches: ["main"]
    # Publish semver tags as releases.
    tags: ["v*.*.*"]
  pull_request:
    branches: ["main"]

env:
  # Use docker.io for Docker Hub if empty
  REGISTRY: ghcr.io
  # github.repository as <account>/<repo>
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
      # This is used to complete the identity challenge
      # with sigstore/fulcio when running outside of PRs.
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Install the cosign tool except on PR
      # https://github.com/sigstore/cosign-installer
      - name: Install cosign
        if: github.event_name != 'pull_request'
        uses: sigstore/cosign-installer@59acb6260d9c0ba8f4a2f9d9b48431a222b68e20 #v3.5.0
        with:
          cosign-release: "v2.2.4"

      # Set up BuildKit Docker container builder to be able to build
      # multi-platform images and export cache
      # https://github.com/docker/setup-buildx-action
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@f95db51fddba0c2d1ec667646a06c2ce06100226 # v3.0.0

      # Login against a Docker registry except on PR
      # https://github.com/docker/login-action
      - name: Log into registry ${{ env.REGISTRY }}
        if: github.event_name != 'pull_request'
        uses: docker/login-action@343f7c4344506bcbf9b4de18042ae17996df046d # v3.0.0
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Extract metadata (tags, labels) for Docker
      # https://github.com/docker/metadata-action
      - name: Extract Docker metadata
        id: meta
        uses: docker/metadata-action@96383f45573cb7f253c731d3b3ab81c87ef81934 # v5.0.0
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
          tags: |
            type=ref,event=branch
            type=ref,event=pr
            type=semver,pattern={{version}}
            type=semver,pattern={{major}}.{{minor}}
            type=semver,pattern={{major}}
            type=raw,value=latest,enable={{is_default_branch}}

      # Extract version from git tag or ref
      # Uses git describe to get latest tag + commit hash in SemVer format: 1.2.3+abc1234
      - name: Extract version
        id: version
        run: |
          if [[ "${{ github.ref_type }}" == "tag" ]]; then
            VERSION="${{ github.ref_name }}"
            # Remove 'v' prefix if present
            VERSION="${VERSION#v}"
          else
            # Use git describe and simplify: v1.2.3-5-gabc1234 -> 1.2.3+abc1234
            GIT_DESCRIBE=$(git describe --tags --always --long 2>/dev/null || echo "")
            if [[ -n "$GIT_DESCRIBE" ]]; then
              # Match pattern: v1.2.3-5-gabc1234 (tag-commits-gcommit)
              if [[ "$GIT_DESCRIBE" =~ ^v?([0-9]+\.[0-9]+\.[0-9]+)-[0-9]+-g([a-f0-9]+)$ ]]; then
                # Format as tag+commit (SemVer build metadata)
                TAG_VERSION="${BASH_REMATCH[1]}"
                COMMIT_HASH="${BASH_REMATCH[2]}"
                VERSION="${TAG_VERSION}+${COMMIT_HASH:0:7}"
              elif [[ "$GIT_DESCRIBE" =~ ^v?([0-9]+\.[0-9]+\.[0-9]+)$ ]]; then
                # Exactly on a tag
                VERSION="${BASH_REMATCH[1]}"
              else
                # Fallback: just commit hash
                COMMIT_SHA="${{ github.sha }}"
                VERSION="${COMMIT_SHA:0:7}"
              fi
            else
              # No tags exist, use commit hash
              COMMIT_SHA="${{ github.sha }}"
              VERSION="${COMMIT_SHA:0:7}"
            fi
          fi
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Version: $VERSION"

      # Build and push Docker image with Buildx (don't push on PR)
      # https://github.com/docker/build-push-action
      - name: Build and push Docker image
        id: build-and-push
        uses: docker/build-push-action@0565240e2d4ab88bba5387d719585280857ece09 # v5.0.0
        with:
          context: .
          file: apps/web/Dockerfile
          push: ${{ github.event_name != 'pull_request' }}
          platforms: linux/amd64,linux/arm64
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          build-args: |
            APP_VERSION=${{ steps.version.outputs.version }}
          cache-from: type=gha
          cache-to: type=gha,mode=max

      # Sign the resulting Docker image digest except on PRs.
      # This will only write to the public Rekor transparency log when the Docker
      # repository is public to avoid leaking data.  If you would like to publish
      # transparency data even for private images, pass --force to cosign below.
      # https://github.com/sigstore/cosign
      - name: Sign the published Docker image
        if: ${{ github.event_name != 'pull_request' }}
        env:
          # https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions#using-an-intermediate-environment-variable
          TAGS: ${{ steps.meta.outputs.tags }}
          DIGEST: ${{ steps.build-and-push.outputs.digest }}
        # This step uses the identity token to provision an ephemeral certificate
        # against the sigstore community Fulcio instance.
        run: echo "${TAGS}" | xargs -I {} cosign sign --yes {}@${DIGEST}


